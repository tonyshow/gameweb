System.register([],(function(t,e){"use strict";return{execute:function(){function i(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function r(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}function n(){return(n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}).apply(this,arguments)}function s(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function a(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function h(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t){if(t){if("string"==typeof t)return o(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?o(t,void 0):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(i=t[Symbol.iterator]()).next.bind(i)}function l(t,e,i,r){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function u(t,e,i,r,n){var s={};return Object.keys(r).forEach((function(t){s[t]=r[t]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=i.slice().reverse().reduce((function(i,r){return r(t,e,i)||i}),s),n&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(n):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(t,e,s),s=null),s}t({BitMask:Bt,CCClass:Ae,CacheMode:void 0,DebugMode:void 0,EAxisDirection:void 0,ERigidBodyType:void 0,Enum:Pt,Eventify:ir,GFXAPI:void 0,GFXAddress:void 0,GFXAttributeName:void 0,GFXBlendFactor:void 0,GFXBlendOp:void 0,GFXBufferAccessBit:void 0,GFXBufferFlagBit:void 0,GFXBufferUsageBit:void 0,GFXClearFlag:void 0,GFXColorMask:void 0,GFXCommandBufferType:void 0,GFXComparisonFunc:void 0,GFXCullMode:void 0,GFXDescriptorType:void 0,GFXDynamicStateFlagBit:void 0,GFXFeature:void 0,GFXFilter:void 0,GFXFormat:void 0,GFXFormatSize:Gl,GFXFormatSurfaceSize:Hl,GFXFormatType:void 0,GFXLoadOp:void 0,GFXMemoryUsageBit:void 0,GFXObjectType:void 0,GFXPipelineBindPoint:void 0,GFXPolygonMode:void 0,GFXPrimitiveMode:void 0,GFXQueueType:void 0,GFXSampleCount:void 0,GFXShadeModel:void 0,GFXShaderStageFlagBit:void 0,GFXStencilFace:void 0,GFXStencilOp:void 0,GFXStoreOp:void 0,GFXSurfaceTransform:void 0,GFXTextureFlagBit:void 0,GFXTextureLayout:void 0,GFXTextureType:void 0,GFXTextureUsageBit:void 0,GFXType:void 0,HorizontalTextAlignment:void 0,InstanceMaterialType:void 0,Overflow:void 0,SystemEventType:void 0,VerticalTextAlignment:void 0,WorldNode3DToLocalNodeUI:iR,WorldNode3DToWorldNodeUI:rR,absMax:Xr,absMaxComponent:jr,approx:Or,assert:b,assertID:L,bezier:NG,bezierByTime:GG,ccenum:Ft,clamp:Ir,clamp01:Mr,color:Js,computeRatioByType:jG,deserialize:IR,earcut:ggt,equals:xr,error:S,errorID:B,find:Wb,fragmentText:sd,getBaselineOffset:function(){return 0},getError:F,getPathFromRoot:function(t,e){for(var i=t,r="";null!==i&&i!==e;)r=i.name+"/"+r,i=i.parent;return r.slice(0,-1)},getWorldTransformUntilRoot:by,instantiate:YR,inverseLerp:Wr,isCustomTargetModifier:BV,isDisplayStats:D,isElementModifier:MV,isPropertyModifier:IV,isUnicodeCJK:ed,isUnicodeSpace:id,isValid:qi,lerp:Br,log:T,logID:x,markAsWarning:void 0,mat4:js,murmurhash2_32_gc:ou,nextPow2:Gr,pingPong:Vr,pseudoRandom:Ur,pseudoRandomRange:kr,pseudoRandomRangeInt:zr,quat:zs,randomRange:Fr,randomRangeInt:Dr,rect:Zs,removeProperty:void 0,repeat:Hr,replaceProperty:void 0,safeMeasureText:rd,sampleAnimationCurve:WG,setDefaultLogTimes:function(t){t>0&&(sa=t)},setDisplayStats:U,size:qs,toDegree:Nr,toRadian:Pr,tween:vrt,tweenUtil:yrt,v2:As,v3:xs,v4:Is,warn:E,warnID:I});var c="undefined"==typeof window?global:window,_=t("cclegacy",{_global:c});_.internal={},c.CC_BUILD=!0,c.CC_TEST=!1,c.CC_EDITOR=!1,c.CC_PREVIEW=!1,c.CC_DEV=!1,c.CC_DEBUG=!1,c.CC_JSB=!1,c.CC_BYTEDANCE=!1,c.CC_WECHAT=!1,c.CC_ALIPAY=!1,c.CC_XIAOMI=!1,c.CC_BAIDU=!1,c.CC_COCOSPLAY=!1,c.CC_HUAWEI=!1,c.CC_OPPO=!1,c.CC_VIVO=!1,c.CC_MINIGAME=!1,c.CC_RUNTIME_BASED=!1,c.CC_SUPPORT_JIT=!0,c.CocosEngine=_.ENGINE_VERSION="3.0.0",c.cc=_;var d="https://github.com/cocos-creator/engine/blob/3d/EngineErrorMap.md",p=null,f=console.log.bind(console),m=f,g=f,v=function(t,e){if(!t){for(var i=arguments.length,r=new Array(i>2?i-2:0),n=2;n<i;n++)r[n-2]=arguments[n];console.log("ASSERT: "+y.apply(void 0,[e].concat(r)))}};function y(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return _.js.formatStr.apply(null,[t].concat(i))}function T(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return f.apply(void 0,[t].concat(i))}function E(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return m.apply(void 0,[t].concat(i))}function S(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return g.apply(void 0,[t].concat(i))}function b(t,e){for(var i=arguments.length,r=new Array(i>2?i-2:0),n=2;n<i;n++)r[n-2]=arguments[n];return v.apply(void 0,[t,e].concat(r))}function A(t){if(f=m=g=v=function(){},t!==P.NONE){if(t>P.ERROR){var e=function(t){if(_.game.canvas){if(!p){var e=document.createElement("Div");e.setAttribute("id","logInfoDiv"),e.setAttribute("width","200"),e.setAttribute("height",_.game.canvas.height);var i=e.style;i.zIndex="99999",i.position="absolute",i.top=i.left="0",(p=document.createElement("textarea")).setAttribute("rows","20"),p.setAttribute("cols","30"),p.setAttribute("disabled","true");var r=p.style;r.backgroundColor="transparent",r.borderBottom="1px solid #cccccc",r.borderTopWidth=r.borderLeftWidth=r.borderRightWidth="0px",r.borderTopStyle=r.borderLeftStyle=r.borderRightStyle="none",r.padding="0px",r.margin="0px",e.appendChild(p),_.game.canvas.parentNode.appendChild(e)}p.value=p.value+t+"\r\n",p.scrollTop=p.scrollHeight}};g=function(t){for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];e("ERROR :  "+y.apply(void 0,[t].concat(r)))},v=function(t,i){if(!t){for(var r=arguments.length,n=new Array(r>2?r-2:0),s=2;s<r;s++)n[s-2]=arguments[s];e("ASSERT: "+y.apply(void 0,[i].concat(n)))}},t!==P.ERROR_FOR_WEB_PAGE&&(m=function(t){for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];e("WARN :  "+y.apply(void 0,[t].concat(r)))}),t===P.INFO_FOR_WEB_PAGE&&(f=function(t){for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];e(y.apply(void 0,[t].concat(r)))})}else console&&console.log.apply&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),g=console.error.bind?console.error.bind(console):function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return console.error.apply(console,[t].concat(i))},v=function(t,e){if(!t){for(var i=arguments.length,r=new Array(i>2?i-2:0),n=2;n<i;n++)r[n-2]=arguments[n];var s=y.apply(void 0,[e].concat(r));throw new Error(s)}});t!==P.ERROR&&(m=console.warn.bind?console.warn.bind(console):function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return console.warn.apply(console,[t].concat(i))}),t===P.INFO&&(f=console.log.bind?console.log.bind(console):function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return console.log.apply(console,[t].concat(i))})}}function C(t){S(t.stack||t)}function w(t){return function(e){for(var i=t+" "+e+", please go to "+d+"#"+e+" to see details.",r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];return 0===n.length?i:i+" Arguments: "+n.join(", ")}}var R=w("Log");function x(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];T(R.apply(void 0,[t].concat(i)))}var O=w("Warning");function I(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];E(O.apply(void 0,[t].concat(i)))}var M=w("Error");function B(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];S(M.apply(void 0,[t].concat(i)))}var P,N=w("Assert");function L(t,e){if(!t){for(var i=arguments.length,r=new Array(i>2?i-2:0),n=2;n<i;n++)r[n-2]=arguments[n];b(!1,N.apply(void 0,[e].concat(r)))}}function F(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return M.apply(void 0,[t].concat(i))}function D(){return!!_.profiler&&_.profiler.isShowingStats()}function U(t){_.profiler&&(t?_.profiler.showStats():_.profiler.hideStats(),_.game.config.showFPS=!!t)}!function(t){t[t.NONE=0]="NONE",t[t.INFO=1]="INFO",t[t.WARN=2]="WARN",t[t.ERROR=3]="ERROR",t[t.INFO_FOR_WEB_PAGE=4]="INFO_FOR_WEB_PAGE",t[t.WARN_FOR_WEB_PAGE=5]="WARN_FOR_WEB_PAGE",t[t.ERROR_FOR_WEB_PAGE=6]="ERROR_FOR_WEB_PAGE"}(P||(P=t("DebugMode",{})));var k=Object.freeze({__proto__:null,log:T,warn:E,error:S,assert:b,_resetDebugSetting:A,_throw:C,logID:x,warnID:I,errorID:B,assertID:L,get DebugMode(){return P},getError:F,isDisplayStats:D,setDisplayStats:U}),z=function(){function t(t){this.i=0,this.array=t}var e=t.prototype;return e.remove=function(t){var e=this.array.indexOf(t);e>=0&&this.removeAt(e)},e.removeAt=function(t){this.array.splice(t,1),t<=this.i&&--this.i},e.fastRemove=function(t){var e=this.array.indexOf(t);e>=0&&this.fastRemoveAt(e)},e.fastRemoveAt=function(t){var e=this.array;e[t]=e[e.length-1],--e.length,t<=this.i&&--this.i},e.push=function(t){this.array.push(t)},r(t,[{key:"length",get:function(){return this.array.length},set:function(t){this.array.length=t,this.i>=t&&(this.i=t-1)}}]),t}();function G(t,e){t.splice(e,1)}function H(t,e){var i=t.indexOf(e);return i>=0&&(G(t,i),!0)}function V(t,e){return t.indexOf(e)>=0}var W=Object.freeze({__proto__:null,removeAt:G,fastRemoveAt:function(t,e){var i=t.length;e<0||e>=i||(t[e]=t[i-1],t.length=i-1)},remove:H,fastRemove:function(t,e){var i=t.indexOf(e);i>=0&&(t[i]=t[t.length-1],--t.length)},removeIf:function(t,e){var i=t.findIndex(e);if(i>=0){var r=t[i];return G(t,i),r}},verifyType:function(t,e){if(t&&t.length>0)for(var i,r=h(t);!(i=r()).done;)if(!(i.value instanceof e))return x(1300),!1;return!0},removeArray:function(t,e){for(var i=0,r=e.length;i<r;i++)H(t,e[i])},appendObjectsAt:function(t,e,i){return t.splice.apply(t,[i,0].concat(e)),t},contains:V,copy:function(t){for(var e=t.length,i=new Array(e),r=0;r<e;r+=1)i[r]=t[r];return i},MutableForwardIterator:z}),j=function(){function t(t){this.id=void 0,this.prefix=void 0,this.id=0|998*Math.random(),this.prefix=t?t+".":""}return t.prototype.getNewId=function(){return this.prefix+ ++this.id},t}();j.global=new j("global");var X=new j("TmpCId."),Y="undefined"==typeof Symbol?"__aliases__":Symbol("[[Aliases]]");function q(t){return"number"==typeof t||t instanceof Number}function K(t){return"string"==typeof t||t instanceof String}function Z(t){for(var e in t)return!1;return!0}var Q,J=(Q={value:void 0,enumerable:!1,writable:!1,configurable:!0},function(t,e,i,r,n){Q.value=i,Q.writable=r,Q.enumerable=n,Object.defineProperty(t,e,Q),Q.value=void 0}),$=function(){var t={get:void 0,set:void 0,enumerable:!1};return function(e,i,r,n,s,a){void 0===s&&(s=!1),void 0===a&&(a=!1),"boolean"==typeof n&&(s=n,n=void 0),t.get=r,t.set=n,t.enumerable=s,t.configurable=a,Object.defineProperty(e,i,t),t.get=void 0,t.set=void 0}}(),tt=function(){var t={get:void 0,enumerable:!1,configurable:!1};return function(e,i,r,n,s){t.get=r,t.enumerable=n,t.configurable=s,Object.defineProperty(e,i,t),t.get=void 0}}(),et=function(){var t={set:void 0,enumerable:!1,configurable:!1};return function(e,i,r,n,s){t.set=r,t.enumerable=n,t.configurable=s,Object.defineProperty(e,i,t),t.set=void 0}}();function it(t){var e=Object.create(null);return t&&(e["."]=1,e["/"]=1,delete e["."],delete e["/"]),e}function rt(t){if("function"==typeof t){var e=t.prototype;if(e&&e.hasOwnProperty("__classname__")&&e.__classname__)return e.__classname__;var i="";if(t.name&&(i=t.name),t.toString){var r,n=t.toString();(r="["===n.charAt(0)?n.match(/\[\w+\s*(\w+)\]/):n.match(/function\s*(\w+)/))&&2===r.length&&(i=r[1])}return"Object"!==i?i:""}return t&&t.constructor?rt(t.constructor):""}function nt(t,e,i,r){var n=/([^.]+)$/,s=n.exec(e)[0],a=n.exec(i)[0];function o(){return this[a]}r?$(t,s,o,(function(t){this[a]=t})):tt(t,s,o)}function st(t,e,i,r){for(var n in i)nt(t,e+"."+n,i[n],r)}var at=/(%d)|(%s)/,ot=/%s/;function ht(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];if(0===arguments.length)return"";if(0===i.length)return""+t;var n="string"==typeof t&&at.test(t);if(n)for(var s,a=h(i);!(s=a()).done;){var o=s.value,l="number"==typeof o?at:ot;if(l.test(t)){var u=""+o;t=t.replace(l,u)}else t+=" "+o}else for(var c,_=h(i);!(c=_()).done;){var d=c.value;t+=" "+d}return t}function lt(){for(var t=arguments.length-1,e=new Array(t),i=0;i<t;++i)e[i]=arguments[i+1];return e}function ut(t,e){for(;t;){var i=Object.getOwnPropertyDescriptor(t,e);if(i)return i;t=Object.getPrototypeOf(t)}return null}function ct(t,e,i){var r=ut(e,t);r&&Object.defineProperty(i,t,r)}function _t(t){t=t||{};for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];for(var n=0,s=i;n<s.length;n++){var a=s[n];if(a){if("object"!=typeof a){B(5402,a);continue}for(var o in a)o in t||ct(o,a,t)}}return t}function dt(t){t=t||{};for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];for(var n=0,s=i;n<s.length;n++){var a=s[n];if(a){if("object"!=typeof a){B(5403,a);continue}for(var o in a)ct(o,a,t)}}return t}function pt(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t.prototype=Object.create(e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),t}function ft(t){var e=t.prototype,i=e&&Object.getPrototypeOf(e);return i&&i.constructor}function mt(t,e){if(t&&e){if("function"!=typeof t)return!1;if("function"!=typeof e)return!1;if(t===e)return!0;for(;;){if(!(t=ft(t)))return!1;if(t===e)return!0}}return!1}function gt(t){for(var e=0,i=Object.keys(t);e<i.length;e++)delete t[i[e]]}var vt=it(!0),yt=it(!0);function Tt(t,e){return function(i,r){if(r.prototype.hasOwnProperty(t)&&delete e[r.prototype[t]],J(r.prototype,t,i),i){var n=e[i];n&&n!==r?S("A Class already exists with the same "+t+' : "'+i+'".'):e[i]=r}}}var Et=Tt("__cid__",vt),St=Tt("__classname__",yt);function bt(t,e){if(St(t,e),!e.prototype.hasOwnProperty("__cid__")){var i=t||X.getNewId();i&&Et(i,e)}}function At(t,e){var i=yt[e],r=vt[e],n=!0;if(i&&i!==t&&(S('"'+e+'" has already been set as name or alias of another class.'),n=!1),r&&r!==t&&(S('"'+e+'" has already been set as id or alias of another class.'),n=!1),n){var s=t[Y];s||(s=[],t[Y]=s),s.push(e),yt[e]=t,vt[e]=t}}function Ct(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];for(var r=0,n=e;r<n.length;r++){var s=n[r],a=s.prototype,o=a.__cid__;o&&delete vt[o];var h=a.__classname__;h&&delete yt[h];var l=a[Y];if(l)for(var u=0;u<l.length;++u){var c=l[u];delete yt[c],delete vt[c]}}}function wt(t){return vt[t]}function Rt(t){return yt[t]}function xt(t,e){if(e=void 0===e||e,"function"==typeof t&&t.prototype.hasOwnProperty("__cid__"))return t.prototype.__cid__;if(t&&t.constructor){var i=t.constructor.prototype;if(i&&i.hasOwnProperty("__cid__"))return t.__cid__}return""}var Ot=function(){var t=e.prototype;function e(t,e){this.count=void 0,this._pool=void 0,this._cleanup=void 0;var i=void 0===e?t:e,r=void 0===e?null:t;this.count=0,this._pool=new Array(i),this._cleanup=r}return t.get=function(){return this._get()},t._get=function(){if(this.count>0){--this.count;var t=this._pool[this.count];return this._pool[this.count]=null,t}return null},t.put=function(t){var e=this._pool;if(this.count<e.length){if(this._cleanup&&!1===this._cleanup(t))return;e[this.count]=t,++this.count}},t.resize=function(t){t>=0&&(this._pool.length=t,this.count>t&&(this.count=t))},e}(),It=W,Mt={IDGenerator:j,Pool:Ot,array:W,isNumber:q,isString:K,isEmptyObject:Z,getPropertyDescriptor:ut,addon:_t,mixin:dt,extend:pt,getSuper:ft,isChildClassOf:mt,clear:gt,value:J,getset:$,get:tt,set:et,unregisterClass:Ct,getClassName:rt,setClassName:bt,setClassAlias:At,getClassByName:Rt,get _registeredClassNames(){return Object.assign({},yt)},set _registeredClassNames(t){gt(yt),Object.assign(yt,t)},get _registeredClassIds(){return Object.assign({},vt)},set _registeredClassIds(t){gt(vt),Object.assign(vt,t)},_getClassId:xt,_setClassId:Et,_getClassById:wt,obsolete:nt,obsoletes:st,formatStr:ht,shiftArguments:lt,createMap:it};function Bt(t){if("__bitmask__"in t)return t;J(t,"__bitmask__",null,!0);for(var e=-1,i=Object.keys(t),r=0;r<i.length;r++){var n=i[r],s=t[n];if(-1===s)s=++e,t[n]=s;else if("number"==typeof s)e=s;else if("string"==typeof s&&Number.isInteger(parseFloat(n)))continue;var a=""+s;n!==a&&J(t,a,n)}return t}function Pt(t){return"__enums__"in t?t:(J(t,"__enums__",null,!0),Pt.update(t))}function Nt(t){t.hasOwnProperty("__enums__")}function Lt(t){Nt(t);var e=t.__enums__||[];for(var i in e.length=0,t){var r=t[i];Number.isInteger(r)&&e.push({name:i,value:r})}return e.sort((function(t,e){return t.value-e.value})),t.__enums__=e,e}function Ft(t){"__enums__"in t||J(t,"__enums__",null,!0)}_.js=Mt,t("js",Object.freeze({__proto__:null,array:It,js:Mt,IDGenerator:j,Pool:Ot,isNumber:q,isString:K,isEmptyObject:Z,value:J,getset:$,get:tt,set:et,createMap:it,getClassName:rt,obsolete:nt,obsoletes:st,formatStr:ht,shiftArguments:lt,getPropertyDescriptor:ut,addon:_t,mixin:dt,extend:pt,getSuper:ft,isChildClassOf:mt,clear:gt,_idToClass:vt,_nameToClass:yt,_setClassId:Et,setClassName:bt,setClassAlias:At,unregisterClass:Ct,_getClassById:wt,getClassByName:Rt,_getClassId:xt})),Bt.isBitMask=function(t){return t&&t.hasOwnProperty("__bitmask__")},Bt.getList=function(t){if(t.__bitmask__)return t.__bitmask__;var e=t.__bitmask__=[];for(var i in t){var r=t[i];Number.isInteger(r)&&e.push({name:i,value:r})}return e.sort((function(t,e){return t.value-e.value})),e},_.BitMask=Bt,Pt.update=function(t){for(var e=-1,i=Object.keys(t),r=0;r<i.length;r++){var n=i[r],s=t[n];if(-1===s)s=++e,t[n]=s;else if("number"==typeof s)e=s;else if("string"==typeof s&&Number.isInteger(parseFloat(n)))continue;var a=""+s;n!==a&&J(t,a,n)}return Array.isArray(t.__enums__)&&Lt(t),t},Pt||(Pt=t("Enum",{})),Pt.isEnum=function(t){return t&&t.hasOwnProperty("__enums__")},Pt.getList=function(t){return Nt(t),t.__enums__?t.__enums__:Lt(t)},_.Enum=Pt;var Dt=t("ValueType",function(){function t(){}var e=t.prototype;return e.clone=function(){return B(100,rt(this)+".clone"),this},e.equals=function(){return!1},e.set=function(){B(100,rt(this)+".set")},e.toString=function(){return""+{}},t}());bt("cc.ValueType",Dt),_.ValueType=Dt;var Ut=t("macro",{SUPPORT_TEXTURE_FORMATS:[".astc",".pkm",".pvr",".webp",".jpg",".jpeg",".bmp",".png"],KEY:{none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},RAD:Math.PI/180,DEG:180/Math.PI,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1.192092896e-7,ORIENTATION_PORTRAIT:1,ORIENTATION_LANDSCAPE:2,ORIENTATION_AUTO:3,ENABLE_TILEDMAP_CULLING:!0,TOUCH_TIMEOUT:5e3,ENABLE_TRANSPARENT_CANVAS:!1,ENABLE_WEBGL_ANTIALIAS:!0,CLEANUP_IMAGE_CACHE:!1,ENABLE_MULTI_TOUCH:!0});_.macro=Ut;for(var kt=/^(?:cc|dragonBones|sp|ccsg)\..+/,zt=new Array(123),Gt=0;Gt<123;++Gt)zt[Gt]=64;for(var Ht=0;Ht<64;++Ht)zt["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(Ht)]=Ht;var Vt=zt;function Wt(t,e,i){function r(t,e,i,r){var n=Object.getOwnPropertyDescriptor(t,e);if(n)n.get&&(t[i]=n.get),n.set&&r&&(t[r]=n.set);else{var s=t[i];$(t,e,s,t[r])}}for(var n,s=t.prototype,a=0;a<e.length;a++){var o=(n=e[a])[0].toUpperCase()+n.slice(1);r(s,n,"get"+o,"set"+o)}for(n in i){var h=i[n];r(s,n,h[0],h[1])}}function jt(t,e,i,r){var n=t[e];n?Array.isArray(n)?r?(n.push(n[0]),n[0]=i):n.push(i):t[e]=r?[i,n]:[n,i]:t[e]=i}function Xt(t,e){if("function"==typeof t.contains)return t.contains(e);if("function"==typeof t.compareDocumentPosition)return!!(16&t.compareDocumentPosition(e));var i=e.parentNode;if(i)do{if(i===t)return!0;i=i.parentNode}while(null!==i);return!1}function Yt(t){return"object"==typeof window&&"function"==typeof Node?t instanceof Node:t&&"object"==typeof t&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName}function qt(t,e,i){t&&setTimeout((function(){t(e,i)}),0)}function Kt(t){return!(!t||t.constructor!==Object)&&Z(t)}function Zt(t,e,i){if(e>i){var r=e;e=i,i=r}return t<e?e:t<i?t:i}function Qt(t){return t*Ut.RAD}function Jt(t){return t*Ut.DEG}function $t(t,e){var i=e?Object.create(e):{};return J(t,"__attrs__",i),i}function te(t){if("function"!=typeof t)return $t(t,ie(t.constructor));for(var e,i=_.Class.getInheritanceChain(t),r=i.length-1;r>=0;r--){var n=i[r];n.hasOwnProperty("__attrs__")&&n.__attrs__||$t(n,(e=i[r+1])&&e.__attrs__)}return $t(t,(e=i[0])&&e.__attrs__),t.__attrs__}function ee(t,e){var i=ie(t),r=e+"$_$",n={};for(var s in i)s.startsWith(r)&&(n[s.slice(r.length)]=i[s]);return n}function ie(t){return t.hasOwnProperty("__attrs__")&&t.__attrs__||te(t)}function re(t,e,i,r){ie(t)[e+"$_$"+i]=r}_.misc={BUILTIN_CLASSID_RE:kt,BASE64_VALUES:Vt,propertyDefine:Wt,pushToMap:jt,contains:Xt,isDomNode:Yt,callInNextTick:qt,isPlainEmptyObj_DEV:Kt,clampf:Zt,degreesToRadians:Qt,radiansToDegrees:Jt},t("misc",Object.freeze({__proto__:null,BUILTIN_CLASSID_RE:kt,BASE64_VALUES:Vt,propertyDefine:Wt,pushToMap:jt,contains:Xt,isDomNode:Yt,callInNextTick:qt,tryCatchFunctor_EDITOR:function(t){return Function("target","try {\n  target."+t+"();\n}\ncatch (e) {\n  cc._throw(e);\n}")},isPlainEmptyObj_DEV:Kt,clampf:Zt,degreesToRadians:Qt,radiansToDegrees:Jt}));var ne=function(){function t(t,e){this.name=void 0,this.default=void 0,this.name=t,this.default=e}return t.prototype.toString=function(){return this.name},t}(),se=t("CCInteger",new ne("Integer",0));_.Integer=se,_.CCInteger=se;var ae=t("CCFloat",new ne("Float",0));_.Float=ae,_.CCFloat=ae;var oe=t("CCBoolean",new ne("Boolean",!1));_.Boolean=oe,_.CCBoolean=oe;var he=t("CCString",new ne("String",""));function le(t,e){return function(i,r){var n='"'+rt(i)+"."+r+'"',s=ee(i,r),a=s.type;if(a===se||a===ae?a="Number":a!==he&&a!==oe||(a=""+a),a===t){if(s.hasOwnProperty("default")){var o=s.default;if(void 0!==o&&!Array.isArray(o)&&!Kt(o)){var h=typeof o,l=t.toLowerCase();if(h===l)if("object"===l){if(!o||o instanceof s.ctor)return;I(3605,n,rt(s.ctor))}else"Number"!==t&&I(3606,e,n,t);else{if("function"===h)return;t===he.default&&null==o?I(3607,n):I(3611,e,n,h)}delete s.type}}}else I(3604,n)}}_.String=he,_.CCString=he;var ue=Object.freeze({__proto__:null,DELIMETER:"$_$",createAttrsSingle:$t,createAttrs:te,attr:ee,getClassAttrs:ie,setClassAttr:re,PrimitiveType:ne,CCInteger:se,CCFloat:ae,CCBoolean:oe,CCString:he,getTypeChecker_ET:le,getObjTypeChecker_ET:function(t){return function(e,i){le("Object","type")(e,i);var r=ie(e)[i+"$_$default"],n=_.Class.getDefault(r);if(!Array.isArray(n)&&mt(t,_.ValueType)){var s=rt(t),a=ht('No need to specify the "type" of "%s.%s" because %s is a child class of ValueType.',rt(e),i,s);r?T(a):I(3612,a,s,rt(e),i,s)}}}}),ce={default:{},serializable:{},editorOnly:{},formerlySerializedAs:{}};function _e(t,e,i,r){if(!t.get&&!t.set&&t.hasOwnProperty("default")){var n="_N$"+e;t.get=function(){return this[n]},t.set=function(t){var e=this[n];this[n]=t,i.call(this,e)};var s={};for(var a in r[n]=s,ce){var o=ce[a];t.hasOwnProperty(a)&&(s[a]=t[a],o.canUsedInGet||delete t[a])}}}function de(t,e,i,r){if(Array.isArray(e)){if(!(e.length>0))return B(5508,i,r);t.type=e=e[0]}"function"==typeof e&&(e===String?t.type=_.String:e===Boolean?t.type=_.Boolean:e===Number&&(t.type=_.Float))}function pe(t,e,i){var r=t?{_short:!0}:{_short:!0,default:e};return i&&(r.type=i),r}function fe(t,e){if(!t||t.constructor!==Object){if(Array.isArray(t)&&t.length>0)return pe(e,[],t);if("function"==typeof t){var i=t;return pe(e,mt(i,_.ValueType)?new i:null,i)}return pe(e,t instanceof ne?t.default:t)}return null}var me=[];function ge(){return me[me.length-1]}_._RF={push:function(t,e,i,r){void 0===i&&(i=e,e=""),me.push({uuid:e,script:i,module:t,exports:t.exports,beh:null,importMeta:r})},pop:function(){var t=me.pop(),e=t.module,i=e.exports;if(i===t.exports){for(var r in i)return;e.exports=i=t.cls}},peek:ge};var ve={datas:null,push:function(t){if(this.datas)this.datas.push(t);else{this.datas=[t];var e=this;setTimeout((function(){e.init()}),0)}},init:function(){var t=this.datas;if(t){for(var e=0;e<t.length;++e){var i=t[e],r=i.cls,n=i.props;"function"==typeof n&&(n=n());var s=rt(r);n?be(r,s,n,r.$super,i.mixins):B(3633,s)}this.datas=null}}};function ye(t,e,i,r){re(t,i,"default",r.default),function(t,e){!function(t,e){t.indexOf(e)<0&&t.push(e)}(t.__props__,e)}(t,i),we(t,r,e,i)}function Te(t,e,i,r){var n=r.get;r.set,n&&(we(t,r,e,i),re(t,i,"serializable",!1))}function Ee(t){return"function"==typeof t?t():t}function Se(t,e,i){for(var r in e)t.hasOwnProperty(r)||i&&!i(r)||Object.defineProperty(t,r,ut(e,r))}function be(t,e,i,r,n){if(t.__props__=[],r&&r.__props__&&(t.__props__=r.__props__.slice()),n)for(var s=0;s<n.length;++s){var a=n[s];a.__props__&&(t.__props__=t.__props__.concat(a.__props__.filter((function(e){return t.__props__.indexOf(e)<0}))))}if(i)for(var o in function(t,e){for(var i in t){var r=t[i],n=fe(r,!1);if(n&&(r=t[i]=n),r){var s=r.notify;s&&_e(r,i,s,t),"type"in r&&de(r,r.type,e,i)}}}(i,e),i){var h=i[o];"default"in h?ye(t,e,o,h):Te(t,e,o,h)}var l=ie(t);t.__values__=t.__props__.filter((function(t){return!1!==l[t+"$_$serializable"]}))}function Ae(t){var e=t.name,i=t.extends,r=t.mixins,n=function(t,e,i,r){var n=_.Component,s=ge();if(s&&mt(e,n)){if(mt(s.cls,n))return B(3615),null;t=t||s.script}var a=function(t,e,i,r){var n=r.ctor,s=[n],a=n;J(a,"__ctors__",s.length>0?s:null,!0);var o=a.prototype;if(e&&(a.$super=e),i){for(var h=i.length-1;h>=0;h--){var l=i[h];Se(o,l.prototype),Ae._isCCClass(l)&&Se(ie(a),ie(l))}o.constructor=a}return bt(t,a),a}(t,e,i,r);if(s)if(mt(e,n)){var o=s.uuid;o&&Et(o,a),s.cls=a}else mt(s.cls,n)||(s.cls=a);return a}(e,i,r,t);e||(e=_.js.getClassName(n)),n._sealed=!0,i&&(i._sealed=!1);var s=t.properties;"function"==typeof s||i&&null===i.__props__||r&&r.some((function(t){return null===t.__props__}))?(ve.push({cls:n,props:s,mixins:r}),n.__props__=n.__values__=null):be(n,e,s,i,t.mixins);var a=t.editor;return a&&mt(i,_.Component)&&_.Component._registerEditorProps(n,a),n}Ae._isCCClass=function(t){var e;return null==t||null===(e=t.hasOwnProperty)||void 0===e?void 0:e.call(t,"__ctors__")},Ae.fastDefine=function(t,e,i){bt(t,e);for(var r=e.__props__=e.__values__=Object.keys(i),n=ie(e),s=0;s<r.length;s++){var a=r[s];n[a+"$_$visible"]=!1,n[a+"$_$default"]=i[a]}},Ae.Attr=ue,Ae.attr=ee,Ae.getInheritanceChain=function(t){for(var e=[];t=ft(t);)t!==Object&&e.push(t);return e};var Ce={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"};function we(t,e,i,r){var n=null,s="";function a(){return s=r+"$_$",n=ie(t)}"type"in e&&void 0===e.type&&I(3660,r,i);var o=e.type;o&&(Ce[o]?(n||a())[s+"type"]=o:"Object"===o||("object"==typeof o?Pt.isEnum(o)?((n||a())[s+"type"]="Enum",n[s+"enumList"]=Pt.getList(o)):Bt.isBitMask(o)&&((n||a())[s+"type"]="BitMask",n[s+"bitmaskList"]=Bt.getList(o)):"function"==typeof o&&((n||a())[s+"type"]="Object",n[s+"ctor"]=o)));var h,l=function(t,i){if(t in e){var r=e[t];typeof r===i&&((n||a())[s+t]=r)}};e.editorOnly&&((n||a())[s+"editorOnly"]=!0),e.__noImplicit?(n||a())[s+"serializable"]=null!==(h=e.serializable)&&void 0!==h&&h:!1===e.serializable&&((n||a())[s+"serializable"]=!1),l("formerlySerializedAs","string");var u=e.range;u&&Array.isArray(u)&&u.length>=2&&((n||a())[s+"min"]=u[0],n[s+"max"]=u[1],u.length>2&&(n[s+"step"]=u[2])),l("min","number"),l("max","number"),l("step","number")}Ae.isArray=function(t){return t=Ee(t),Array.isArray(t)},Ae.getDefault=Ee,Ae.escapeForJS=function(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")},Ae.IDENTIFIER_RE=/^[A-Za-z_$][0-9A-Za-z_$]*$/,Ae.getNewValueTypeCode=function(t){for(var e=rt(t),i=t.constructor,r="new "+e+"(",n=0;n<i.__props__.length;n++)r+=t[i.__props__[n]],n<i.__props__.length-1&&(r+=",");return r+")"},_.Class=Ae;var Re=function(){},xe=function(){return Re},Oe=Ie((function(){}));function Ie(t){return function(e){return"function"==typeof e?t(e):function(i){return t(i,e)}}}function Me(t){return function(e){return function(i){!function(t,e,i){var r=Be(t);if(r){var n=Pe(r,"proto");Pe(n,"editor")[e]=i}}(i,t,e)}}}function Be(t){return Pe(t,"__ccclassCache__")}function Pe(t,e){return t[e]||(t[e]={})}var Ne=Ie((function(t,e){var i=Mt.getSuper(t);i===Object&&(i=null);var r={name:e,extends:i,ctor:t},n=t.__ccclassCache__;if(n){var s=n.proto;s&&Mt.mixin(r,s),t.__ccclassCache__=void 0}return Ae(r)})),Le=Me("requireComponent"),Fe=Me("executionOrder"),De=Oe;function Ue(t,e,i){var r=null;function n(t,e,i){var n=Be(t.constructor);if(n){var s=Pe(n,"proto"),a=Pe(s,"properties");!function(t,e,i,r,n,s){var a,o=n&&(n.get||n.set);r&&(a=fe(r,o));var h=e[i],l=Mt.mixin(h||{},a||r||{});if(o)n.get&&(l.get=n.get),n.set&&(l.set=n.set);else{var u;if(n)n.initializer&&(u=function(t){var e;try{e=t()}catch(e){return t}return"object"!=typeof e||null===e?e:t}(n.initializer));else{var c=s.default||(s.default=function(t){var e;try{e=new t}catch(t){return{}}return e}(t));c.hasOwnProperty(i)&&(u=c[i])}l.default=u}e[i]=l}(t.constructor,a,e,r,i,n)}}return void 0===t?Ue({type:void 0}):void 0===e?(r=t,n):void n(t,e,i)}var ke=function(t,e,i){return Ue(He({}))(t,e,i)};function ze(t){return Ue(He({formerlySerializedAs:t}))}var Ge=function(t,e,i){return Ue({editorOnly:!0})(t,e,i)};function He(t){return t.__noImplicit=!0,"serializable"in t||(t.serializable=!0),t}var Ve=Oe,We=xe,je=Oe,Xe=xe,Ye=xe,qe=xe,Ke=Re,Ze=xe,Qe=Re,Je=xe,$e=xe,ti=xe,ei=xe,ii=xe,ri=xe,ni=Re,si=xe,ai=xe,oi=Re,hi=Re,li=Re,ui=pi(se),ci=pi(ae),_i=pi(oe),di=pi(he);function pi(t){return Ue({type:t})}var fi=function(t,e,i){return Ue({__noImplicit:!0,override:!0})(t,e,i)},mi=function(){function t(t){this._map=null,this._count=0,t?(this._map=t,this._count=Object.keys(t).length):(this._map=Mt.createMap(!0),this._count=0)}var e=t.prototype;return e.add=function(t,e){return t in this._map||this._count++,this._map[t]=e},e.get=function(t){return this._map[t]},e.has=function(t){return t in this._map},e.remove=function(t){var e=this._map[t];return t in this._map&&(delete this._map[t],this._count--),e},e.clear=function(){0!==this._count&&(this._map=Mt.createMap(!0),this._count=0)},e.forEach=function(t){for(var e in this._map)t(this._map[e],e)},e.find=function(t){for(var e in this._map)if(t(this._map[e],e))return this._map[e];return null},e.destroy=function(){this._map=null},r(t,[{key:"count",get:function(){return this._count}}]),t}(),gi=function(){function t(e,i){this.id=t._pipelineId++,this.name="",this.pipes=[],this.name=e;for(var r=0,n=i.length;r<n;r++)this.pipes.push(i[r])}var e=t.prototype;return e.insert=function(t,e){if(!(e>this.pipes.length))return this.pipes.splice(e,0,t),this;I(4921)},e.append=function(t){return this.pipes.push(t),this},e.remove=function(t){return this.pipes.splice(t,1),this},e.sync=function(t){var e=this.pipes;if(0!==e.length){t.isFinish=!1;for(var i=0,r=e.length;i<r;){var n=(0,e[i])(t);if(n)return t.isFinish=!0,n;++i!==r&&(t.input=t.output,t.output=null)}return t.isFinish=!0,t.output}},e.async=function(t){0!==this.pipes.length&&(t.isFinish=!1,this._flow(0,t))},e._flow=function(t,e){var i=this;(0,this.pipes[t])(e,(function(r){r?(e.isFinish=!0,e.dispatch("complete",r)):++t<i.pipes.length?(e.input=e.output,e.output=null,i._flow(t,e)):(e.isFinish=!0,e.dispatch("complete",r,e.output))}))},t}();gi._pipelineId=0;var vi,yi=new mi,Ti=new mi,Ei=new mi,Si=new mi,bi=new gi("normal load",[]),Ai=new gi("fetch",[]),Ci=new gi("transform url",[]);!function(t){t.UUID="uuid",t.PATH="path",t.DIR="dir",t.URL="url",t.SCENE="scene"}(vi||(vi={}));var wi,Ri={default:{priority:0},preload:{maxConcurrency:6,maxRequestsPerFrame:2,priority:-1},scene:{maxConcurrency:20,maxRequestsPerFrame:20,priority:1},bundle:{maxConcurrency:20,maxRequestsPerFrame:20,priority:2},remote:{maxRetryCount:4}};!function(t){t.RESOURCES="resources",t.MAIN="main",t.START_SCENE="start-scene"}(wi||(wi={}));var xi=function(){function t(e){this.id=t._taskId++,this.onComplete=null,this.onProgress=null,this.onError=null,this.source=null,this.output=null,this.input=null,this.progress=null,this.options=null,this.isFinish=!0,this.set(e)}t.create=function(e){var i;return 0!==t._deadPool.length?(i=t._deadPool.pop()).set(e):i=new t(e),i};var e=t.prototype;return e.set=function(t){void 0===t&&(t=Object.create(null)),this.onComplete=t.onComplete||null,this.onProgress=t.onProgress||null,this.onError=t.onError||null,this.source=this.input=t.input,this.output=null,this.progress=t.progress,this.options=t.options||Object.create(null)},e.dispatch=function(t,e,i,r,n){switch(t){case"complete":this.onComplete&&this.onComplete(e,i);break;case"progress":this.onProgress&&this.onProgress(e,i,r,n);break;case"error":this.onError&&this.onError(e,i,r,n);break;default:var s="on"+t[0].toUpperCase()+t.substr(1);"function"==typeof this[s]&&this[s](e,i,r,n)}},e.recycle=function(){t._deadPool.length!==t.MAX_DEAD_NUM&&(this.onComplete=null,this.onProgress=null,this.onError=null,this.source=this.output=this.input=null,this.progress=null,this.options=null,t._deadPool.push(this))},t}();xi.MAX_DEAD_NUM=500,xi._taskId=0,xi._deadPool=[];var Oi="0123456789abcdef".split(""),Ii=["","","",""],Mi=Ii.concat(Ii,"-",Ii,"-",Ii,"-",Ii,"-",Ii,Ii,Ii),Bi=Mi.map((function(t,e){return"-"===t?NaN:e})).filter(isFinite);function Pi(t){var e=t.split("@")[0];if(22!==e.length)return t;Mi[0]=t[0],Mi[1]=t[1];for(var i=2,r=2;i<22;i+=2){var n=Vt[t.charCodeAt(i)],s=Vt[t.charCodeAt(i+1)];Mi[Bi[r++]]=Oi[n>>2],Mi[Bi[r++]]=Oi[(3&n)<<2|s>>4],Mi[Bi[r++]]=Oi[15&s]}return t.replace(e,Mi.join(""))}var Ni=/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/;function Li(t){var e=t.match(Ni);return e?e[1]:""}function Fi(t,e){(e=e||Object.create(null)).__isNative__=e.isNative,e.ext=e.nativeExt;var i=Si.find((function(e){return!!e.getAssetInfo(t)}));return i&&(e.bundle=i.name),ki(t,e)}function Di(t){return t&&(t instanceof _.SceneAsset||t instanceof _.Scene)}function Ui(t){return t&&(46===t.charCodeAt(0)&&47===t.charCodeAt(1)?t=t.slice(2):47===t.charCodeAt(0)&&(t=t.slice(1))),t}function ki(t,e){var i=xi.create({input:t,options:e}),r=[];try{for(var n,s=h(Ci.sync(i));!(n=s()).done;){var a=n.value,o=a.url;a.recycle(),r.push(o)}}catch(t){for(var l,u=h(i.output);!(l=u()).done;)l.value.recycle();S(t.message,t.stack)}return i.recycle(),r.length>1?r:r[0]}var zi=Object.freeze({__proto__:null,getUuidFromURL:Li,getUrlWithUuid:Fi,isScene:Di,normalize:Ui,transform:ki,decodeUuid:Pi}),Gi=t("Event",function(){function t(t,e){this.type=void 0,this.bubbles=void 0,this.target=null,this.currentTarget=null,this.eventPhase=0,this.propagationStopped=!1,this.propagationImmediateStopped=!1,this.type=t,this.bubbles=!!e}var e=t.prototype;return e.unuse=function(){this.type=t.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=t.NONE,this.propagationStopped=!1,this.propagationImmediateStopped=!1},e.reuse=function(t,e){this.type=t,this.bubbles=e||!1},e.isStopped=function(){return this.propagationStopped||this.propagationImmediateStopped},e.getCurrentTarget=function(){return this.currentTarget},e.getType=function(){return this.type},t}());Gi.NO_TYPE="no_type",Gi.TOUCH="touch",Gi.MOUSE="mouse",Gi.KEYBOARD="keyboard",Gi.ACCELERATION="acceleration",Gi.NONE=0,Gi.CAPTURING_PHASE=1,Gi.AT_TARGET=2,Gi.BUBBLING_PHASE=3,_.Event=Gi;var Hi=t("Pool",function(){function t(t,e){this._ctor=void 0,this._elementsPerBatch=void 0,this._nextAvail=void 0,this._freepool=[],this._ctor=t,this._elementsPerBatch=Math.max(e,1),this._nextAvail=this._elementsPerBatch-1;for(var i=0;i<this._elementsPerBatch;++i)this._freepool.push(t())}var e=t.prototype;return e.alloc=function(){if(this._nextAvail<0){for(var t=this._elementsPerBatch,e=0;e<t;e++)this._freepool.push(this._ctor());this._nextAvail=t-1}var i=this._freepool[this._nextAvail--];return this._freepool.length--,i},e.free=function(t){this._freepool.push(t),this._nextAvail++},e.freeArray=function(t){Array.prototype.push.apply(this._freepool,t),this._nextAvail+=t.length},e.destroy=function(t){if(t)for(var e=0;e<=this._nextAvail;e++)t(this._freepool[e]);this._freepool.length=0,this._nextAvail=-1},t}()),Vi=t("RecyclePool",function(){function t(t,e){this._fn=void 0,this._count=0,this._data=void 0,this._fn=t,this._data=new Array(e);for(var i=0;i<e;++i)this._data[i]=t()}var e=t.prototype;return e.reset=function(){this._count=0},e.resize=function(t){if(t>this._data.length)for(var e=this._data.length;e<t;++e)this._data[e]=this._fn()},e.add=function(){return this._count>=this._data.length&&this.resize(2*this._data.length),this._data[this._count++]},e.removeAt=function(t){if(!(t>=this._count)){var e=this._count-1,i=this._data[t];this._data[t]=this._data[e],this._data[e]=i,this._count-=1}},r(t,[{key:"length",get:function(){return this._count}},{key:"data",get:function(){return this._data}}]),t}()),Wi=t("CachedArray",function(){function t(t,e){this.array=void 0,this.length=0,this._compareFn=void 0,this.array=new Array(t),this.length=0,this._compareFn=void 0!==e?e:function(t,e){return t-e}}var e=t.prototype;return e.push=function(t){this.array[this.length++]=t},e.pop=function(){return this.array[--this.length]},e.get=function(t){return this.array[t]},e.clear=function(){this.length=0},e.destroy=function(){this.length=0,this.array.length=0},e.sort=function(){this.array.length=this.length,this.array.sort(this._compareFn)},e.concat=function(t){for(var e=0;e<t.length;++e)this.array[this.length++]=t[e]},e.fastRemove=function(t){if(!(t>=this.length||t<0)){var e=--this.length;this.array[t]=this.array[e]}},e.indexOf=function(t){return this.array.indexOf(t)},t}());t("memop",Object.freeze({__proto__:null,Pool:Hi,RecyclePool:Vi,CachedArray:Wi}));var ji=[],Xi=t("CCObject",function(){function t(t){void 0===t&&(t=""),this._objFlags=void 0,this._name=void 0,this._name=t,this._objFlags=0}t._deferredDestroy=function(){for(var t=ji.length,e=0;e<t;++e){var i=ji[e];1&i._objFlags||i._destroyImmediate()}t===ji.length?ji.length=0:ji.splice(0,t)};var e=t.prototype;return e.destroy=function(){return 1&this._objFlags?(I(5e3),!1):!(4&this._objFlags||(this._objFlags|=4,ji.push(this),0))},e._destruct=function(){var t=this.constructor,e=t.__destruct__;e||(e=function(t,e){var i,r=t instanceof _._BaseNode||t instanceof _.Component,n=r?"_id":null,s={};for(i in t)if(t.hasOwnProperty(i)){if(i===n)continue;switch(typeof t[i]){case"string":s[i]="";break;case"object":case"function":s[i]=null}}if(Ae._isCCClass(e))for(var a=_.Class.Attr.getClassAttrs(e),o=e.__props__,h=0;h<o.length;h++){var l=(i=o[h])+_.Class.Attr.DELIMETER+"default";if(l in a){if(r&&"_id"===i)continue;switch(typeof a[l]){case"string":s[i]="";break;case"object":case"function":s[i]=null;break;case"undefined":s[i]=void 0}}}var u="";for(i in s){var c;c=Ae.IDENTIFIER_RE.test(i)?"o."+i+"=":"o["+Ae.escapeForJS(i)+"]=";var d=s[i];""===d&&(d='""'),u+=c+d+";\n"}return Function("o",u)}(this,t),J(t,"__destruct__",e,!0)),e(this)},e._destroyImmediate=function(){1&this._objFlags?B(5e3):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),this._objFlags|=1)},r(t,[{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"isValid",get:function(){return!(1&this._objFlags)}}]),t}()),Yi=Xi.prototype;function qi(t,e){return"object"==typeof t?!(!t||t._objFlags&(e?5:1)):void 0!==t}Yi._deserialize=null,Yi._onPreDestroy=null,Ae.fastDefine("cc.Object",Xi,{_name:"",_objFlags:0}),J(Xi,"Flags",{Destroyed:1,DontSave:8,EditorOnly:16,Dirty:32,DontDestroy:64,PersistentMask:-4192741,Destroying:128,Deactivating:256,LockedInEditor:512,HideInHierarchy:1024,IsPreloadStarted:8192,IsOnLoadStarted:32768,IsOnLoadCalled:16384,IsOnEnableCalled:2048,IsStartCalled:65536,IsEditorOnEnableCalled:4096,IsPositionLocked:1<<21,IsRotationLocked:1<<17,IsScaleLocked:1<<18,IsAnchorLocked:1<<19,IsSizeLocked:1<<20}),_.isValid=qi,_.Object=Xi;var Ki=It.fastRemoveAt;function Zi(){}var Qi=function(){function t(){this.callback=Zi,this.target=void 0,this.once=!1}var e=t.prototype;return e.set=function(t,e,i){this.callback=t||Zi,this.target=e,this.once=!!i},e.reset=function(){this.target=void 0,this.callback=Zi,this.once=!1},e.check=function(){return!(this.target instanceof Xi&&!qi(this.target,!0))},t}(),Ji=new Hi((function(){return new Qi}),32),$i=function(){function t(){this.callbackInfos=[],this.isInvoking=!1,this.containCanceled=!1}var e=t.prototype;return e.removeByCallback=function(t){for(var e=0;e<this.callbackInfos.length;++e){var i=this.callbackInfos[e];i&&i.callback===t&&(i.reset(),Ji.free(i),Ki(this.callbackInfos,e),--e)}},e.removeByTarget=function(t){for(var e=0;e<this.callbackInfos.length;++e){var i=this.callbackInfos[e];i&&i.target===t&&(i.reset(),Ji.free(i),Ki(this.callbackInfos,e),--e)}},e.cancel=function(t){var e=this.callbackInfos[t];e&&(e.reset(),this.isInvoking?this.callbackInfos[t]=null:Ki(this.callbackInfos,t),Ji.free(e)),this.containCanceled=!0},e.cancelAll=function(){for(var t=0;t<this.callbackInfos.length;t++){var e=this.callbackInfos[t];e&&(e.reset(),Ji.free(e),this.callbackInfos[t]=null)}this.containCanceled=!0},e.purgeCanceled=function(){for(var t=this.callbackInfos.length-1;t>=0;--t)this.callbackInfos[t]||Ki(this.callbackInfos,t);this.containCanceled=!1},e.clear=function(){this.cancelAll(),this.callbackInfos.length=0,this.isInvoking=!1,this.containCanceled=!1},t}(),tr=new Hi((function(){return new $i}),16),er=function(){function t(){this._callbackTable=it(!0)}var e=t.prototype;return e.on=function(t,e,i,r){if(!this.hasEventListener(t,e,i)){var n=this._callbackTable[t];n||(n=this._callbackTable[t]=tr.alloc());var s=Ji.alloc();s.set(e,i,r),n.callbackInfos.push(s)}return e},e.hasEventListener=function(t,e,i){var r=this._callbackTable&&this._callbackTable[t];if(!r)return!1;var n=r.callbackInfos;if(!e){if(r.isInvoking){for(var s=0;s<n.length;++s)if(n[s])return!0;return!1}return n.length>0}for(var a=0;a<n.length;++a){var o=n[a];if(o&&o.check()&&o.callback===e&&o.target===i)return!0}return!1},e.removeAll=function(t){if("string"==typeof t){var e=this._callbackTable&&this._callbackTable[t];e&&(e.isInvoking?e.cancelAll():(e.clear(),tr.free(e),delete this._callbackTable[t]))}else if(t)for(var i in this._callbackTable){var r=this._callbackTable[i];if(r.isInvoking)for(var n=r.callbackInfos,s=0;s<n.length;++s){var a=n[s];a&&a.target===t&&r.cancel(s)}else r.removeByTarget(t)}},e.off=function(t,e,i){var r=this._callbackTable&&this._callbackTable[t];if(r){var n=r.callbackInfos;if(e)for(var s=0;s<n.length;++s){var a=n[s];if(a&&a.callback===e&&a.target===i){r.cancel(s);break}}else this.removeAll(t)}},e.emit=function(t,e,i,r,n,s){var a=this._callbackTable&&this._callbackTable[t];if(a){var o=!a.isInvoking;a.isInvoking=!0;for(var h=a.callbackInfos,l=0,u=h.length;l<u;++l){var c=h[l];if(c){var _=c.callback,d=c.target;c.once&&this.off(t,_,d),c.check()?d?_.call(d,e,i,r,n,s):_(e,i,r,n,s):this.off(t,_,d)}}o&&(a.isInvoking=!1,a.containCanceled&&a.purgeCanceled())}},e.clear=function(){for(var t in this._callbackTable){var e=this._callbackTable[t];e&&(e.clear(),tr.free(e),delete this._callbackTable[t])}},t}();function ir(t){for(var e=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._callbackTable=it(!0),e}s(e,t);var i=e.prototype;return i.once=function(t,e,i){return this.on(t,e,i,!0)},i.targetOff=function(t){this.removeAll(t)},e}(t),i=er.prototype,r=Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i)),n=0;n<r.length;++n){var a=r[n];if(!(a in e.prototype)){var o=Object.getOwnPropertyDescriptor(i,a);o&&Object.defineProperty(e.prototype,a,o)}}return e}var rr=t("EventTarget",ir((function(){})));_.EventTarget=rr;var nr,sr,ar,or,hr,lr=/(\.[^\.\/\?\\]*)(\?.*)?$/,ur=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,cr=/[^\.\/]+\/\.\.\//;function _r(){for(var t="",e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];for(var n=0,s=i;n<s.length;n++){var a=s[n];t=(t+(""===t?"":"/")+a).replace(/(\/|\\\\)$/,"")}return t}function dr(t){var e=lr.exec(t);return e?e[1]:""}function pr(t){if(t){var e=t.lastIndexOf(".");if(-1!==e)return t.substring(0,e)}return t}function fr(t,e){var i=t.indexOf("?");i>0&&(t=t.substring(0,i));var r=/(\/|\\)([^\/\\]+)$/g.exec(t.replace(/(\/|\\)$/,""));if(!r)return t;var n=r[2];return e&&t.substring(t.length-e.length).toLowerCase()===e.toLowerCase()?n.substring(0,n.length-e.length):n}function mr(t){var e=ur.exec(t);return e?e[2]:""}function gr(t,e){e=e||"";var i=t.indexOf("?"),r="";return i>0&&(r=t.substring(i),t=t.substring(0,i)),(i=t.lastIndexOf("."))<0?t+e+r:t.substring(0,i)+e+r}function vr(t,e,i){if(0===e.indexOf("."))return gr(t,e);var r=t.indexOf("?"),n="",s=i?dr(t):"";return r>0&&(n=t.substring(r),t=t.substring(0,r)),r=(r=t.lastIndexOf("/"))<=0?0:r+1,t.substring(0,r)+e+s+n}function yr(t){var e=t=String(t);do{e=t,t=t.replace(cr,"")}while(e.length!==t.length);return t}function Tr(t){return t.replace(/[\/\\]$/,"")}function Er(){return _.sys.os===_.sys.OS_WINDOWS?"\\":"/"}t("path",Object.freeze({__proto__:null,join:_r,extname:dr,mainFileName:pr,basename:fr,dirname:mr,changeExtname:gr,changeBasename:vr,_normalize:yr,stripSep:Tr,getSeperator:Er}));var Sr=t("Asset",Ne("cc.Asset")((hr=or=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).loaded=!0,l(e,"_native",ar,a(e)),e._nativeUrl="",e._file=null,e._ref=0,Object.defineProperty(a(e),"_uuid",{value:"",writable:!0}),e}s(e,t),e.deserialize=function(t){return _.deserialize(t)},r(e,[{key:"nativeUrl",get:function(){if(!this._nativeUrl){if(!this._native)return"";var t=this._native;if(47===t.charCodeAt(0))return t.slice(1);46===t.charCodeAt(0)?this._nativeUrl=Fi(this._uuid,{nativeExt:t,isNative:!0}):this._nativeUrl=Fi(this._uuid,{__nativeName__:t,nativeExt:dr(t),isNative:!0})}return this._nativeUrl}},{key:"_nativeAsset",get:function(){return this._file},set:function(t){this._file=t}}]);var i=e.prototype;return i.toString=function(){return this.nativeUrl},i.serialize=function(){},i._setRawAsset=function(t,e){void 0===e&&(e=!0),this._native=!1!==e?t||"":"/"+t},i.addRef=function(){return this._ref++,_.assetManager._releaseManager.removeFromDeleteQueue(this),this},i.decRef=function(t){return void 0===t&&(t=!0),this._ref>0&&this._ref--,t&&_.assetManager._releaseManager.tryRelease(this),this},i.onLoaded=function(){},r(e,[{key:"_nativeDep",get:function(){if(this._native)return{__isNative__:!0,uuid:this._uuid,ext:this._native}}},{key:"refCount",get:function(){return this._ref}}]),e}(ir(Xi)),or.preventDeferredLoadDependents=!1,or.preventPreloadNativeObject=!1,ar=u((sr=hr).prototype,"_native",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),u(sr.prototype,"_nativeAsset",[Ue],Object.getOwnPropertyDescriptor(sr.prototype,"_nativeAsset"),sr.prototype),nr=sr))||nr);Sr.prototype.createNode=null,_.Asset=Sr;var br={INITIALIZING:0,PLAYING:1,STOPPED:2},Ar=function(){function t(t){var e=this;this._state=br.STOPPED,this._duration=0,this._clip=void 0,this._onHide=void 0,this._onShow=void 0,this._interrupted=!1,this._blocking=!1,this._duration=t.duration,this._clip=t.audioClip,this._onHide=function(){e._blocking=!0,e._state===br.PLAYING&&(e.pause(),e._interrupted=!0)},this._onShow=function(){e._blocking=!1,e._interrupted&&(e.play(),e._interrupted=!1)},_.game.on(_.Game.EVENT_HIDE,this._onHide),_.game.on(_.Game.EVENT_SHOW,this._onShow)}var e=t.prototype;return e.getState=function(){return this._state},e.getDuration=function(){return this._duration},e.destroy=function(){_.game.off(_.Game.EVENT_HIDE,this._onHide),_.game.off(_.Game.EVENT_SHOW,this._onShow)},t}();_.internal.AudioPlayer=Ar;var Cr=Math.PI/180,wr=180/Math.PI,Rr=t("EPSILON",1e-6);function xr(t,e){return Math.abs(t-e)<=Rr*Math.max(1,Math.abs(t),Math.abs(e))}function Or(t,e,i){return i=i||Rr,Math.abs(t-e)<=i}function Ir(t,e,i){if(e>i){var r=e;e=i,i=r}return t<e?e:t>i?i:t}function Mr(t){return t<0?0:t>1?1:t}function Br(t,e,i){return t+(e-t)*i}function Pr(t){return t*Cr}function Nr(t){return t*wr}var Lr=t("random",Math.random);function Fr(t,e){return Math.random()*(e-t)+t}function Dr(t,e){return Math.floor(Fr(t,e))}function Ur(t){return(t=(9301*t+49297)%233280)/233280}function kr(t,e,i){return Ur(t)*(i-e)+e}function zr(t,e,i){return Math.floor(kr(t,e,i))}function Gr(t){return--t,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function Hr(t,e){return t-Math.floor(t/e)*e}function Vr(t,e){return t=Hr(t,2*e),e-Math.abs(t-e)}function Wr(t,e,i){return(i-t)/(e-t)}function jr(t){return Math.abs(t.x)>Math.abs(t.y)?Math.abs(t.x)>Math.abs(t.z)?t.x:t.z:Math.abs(t.y)>Math.abs(t.z)?t.y:t.z}function Xr(t,e){return Math.abs(t)>Math.abs(e)?t:e}var Yr,qr="undefined"==typeof window?global:window;!function(t){t[t.NONE=0]="NONE",t[t.LAN=1]="LAN",t[t.WWAN=2]="WWAN"}(Yr||(Yr={}));var Kr,Zr,Qr,Jr=t("sys",{NetworkType:Yr,LANGUAGE_ENGLISH:"en",LANGUAGE_CHINESE:"zh",LANGUAGE_FRENCH:"fr",LANGUAGE_ITALIAN:"it",LANGUAGE_GERMAN:"de",LANGUAGE_SPANISH:"es",LANGUAGE_DUTCH:"du",LANGUAGE_RUSSIAN:"ru",LANGUAGE_KOREAN:"ko",LANGUAGE_JAPANESE:"ja",LANGUAGE_HUNGARIAN:"hu",LANGUAGE_PORTUGUESE:"pt",LANGUAGE_ARABIC:"ar",LANGUAGE_NORWEGIAN:"no",LANGUAGE_POLISH:"pl",LANGUAGE_TURKISH:"tr",LANGUAGE_UKRAINIAN:"uk",LANGUAGE_ROMANIAN:"ro",LANGUAGE_BULGARIAN:"bg",LANGUAGE_UNKNOWN:"unknown",OS_IOS:"iOS",OS_ANDROID:"Android",OS_WINDOWS:"Windows",OS_LINUX:"Linux",OS_OSX:"OS X",OS_UNKNOWN:"Unknown",UNKNOWN:-1,WIN32:0,LINUX:1,MACOS:2,ANDROID:3,IPHONE:4,IPAD:5,BLACKBERRY:6,NACL:7,EMSCRIPTEN:8,TIZEN:9,WINRT:10,WP8:11,MOBILE_BROWSER:100,DESKTOP_BROWSER:101,EDITOR_PAGE:102,EDITOR_CORE:103,WECHAT_GAME:104,QQ_PLAY:105,FB_PLAYABLE_ADS:106,BAIDU_MINI_GAME:107,VIVO_MINI_GAME:108,OPPO_MINI_GAME:109,HUAWEI_QUICK_GAME:110,XIAOMI_QUICK_GAME:111,COCOSPLAY:112,ALIPAY_MINI_GAME:113,QTT_MINI_GAME:116,BYTEDANCE_MINI_GAME:117,LINKSURE_MINI_GAME:119,BROWSER_TYPE_WECHAT:"wechat",BROWSER_TYPE_COCOSPLAY:"cocosplay",BROWSER_TYPE_HUAWEI_GAME:"huaweiquickgame",BROWSER_TYPE_OPPO_GAME:"oppogame",BROWSER_TYPE_VIVO_GAME:"vivogame",BROWSER_TYPE_XIAOMI_GAME:"xiaomigame",BROWSER_TYPE_ANDROID:"androidbrowser",BROWSER_TYPE_IE:"ie",BROWSER_TYPE_EDGE:"edge",BROWSER_TYPE_QQ:"qqbrowser",BROWSER_TYPE_MOBILE_QQ:"mqqbrowser",BROWSER_TYPE_UC:"ucbrowser",BROWSER_TYPE_UCBS:"ucbs",BROWSER_TYPE_360:"360browser",BROWSER_TYPE_BAIDU_APP:"baiduboxapp",BROWSER_TYPE_BAIDU:"baidubrowser",BROWSER_TYPE_MAXTHON:"maxthon",BROWSER_TYPE_OPERA:"opera",BROWSER_TYPE_OUPENG:"oupeng",BROWSER_TYPE_MIUI:"miuibrowser",BROWSER_TYPE_FIREFOX:"firefox",BROWSER_TYPE_SAFARI:"safari",BROWSER_TYPE_CHROME:"chrome",BROWSER_TYPE_LIEBAO:"liebao",BROWSER_TYPE_QZONE:"qzone",BROWSER_TYPE_SOUGOU:"sogou",BROWSER_TYPE_HUAWEI:"huawei",BROWSER_TYPE_UNKNOWN:"unknown",isNative:!1,isBrowser:"object"==typeof window&&"object"==typeof document&&!0,isMobile:!1,isLittleEndian:(Kr=new ArrayBuffer(2),new DataView(Kr).setInt16(0,256,!0),256===new Int16Array(Kr)[0]),platform:-1,language:"unknown",languageCode:"unknown",os:"Unknown",osVersion:"",osMainVersion:0,browserType:"unknown",browserVersion:"",windowPixelResolution:null,capabilities:null,localStorage:null,__audioSupport:null,__videoSupport:null,getNetworkType:function(){return Yr.LAN},getBatteryLevel:function(){return 1},garbageCollect:function(){},isObjectValid:function(t){return null!=t},dump:function(){var t="";t+="isMobile : "+this.isMobile+"\r\n",t+="language : "+this.language+"\r\n",t+="browserType : "+this.browserType+"\r\n",t+="browserVersion : "+this.browserVersion+"\r\n",t+="capabilities : "+JSON.stringify(this.capabilities)+"\r\n",t+="os : "+this.os+"\r\n",t+="osVersion : "+this.osVersion+"\r\n",t+="platform : "+this.platform+"\r\n",T(t+="Using "+(_.game.renderType===_.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n")},openURL:function(t){window.open(t)},now:function(){return Date.now?Date.now():+new Date},restartVM:function(){},getSafeAreaRect:function(){var t=_.view.getVisibleSize();return _.rect(0,0,t.width,t.height)}});if(qr.__globalAdapter&&qr.__globalAdapter.adaptSys)qr.__globalAdapter.adaptSys(Jr);else{var $r=window,tn=$r.navigator,en=document,rn=en.documentElement,nn=tn.userAgent.toLowerCase();Jr.isMobile=/mobile|android|iphone|ipad/.test(nn),Jr.platform=Jr.isMobile?Jr.MOBILE_BROWSER:Jr.DESKTOP_BROWSER;var sn=tn.language;Jr.languageCode=sn.toLowerCase(),sn=(sn=sn||tn.browserLanguage)?sn.split("-")[0]:Jr.LANGUAGE_ENGLISH,Jr.language=sn;var an=!1,on=!1,hn="",ln=0,un=/android\s*(\d+(?:\.\d+)*)/i.exec(nn)||/android\s*(\d+(?:\.\d+)*)/i.exec(tn.platform);un&&(an=!0,hn=un[1]||"",ln=parseInt(hn)||0),(un=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(nn))?(on=!0,hn=un[2]||"",ln=parseInt(hn)||0):(/(iPhone|iPad|iPod)/.exec(tn.platform)||"MacIntel"===tn.platform&&tn.maxTouchPoints&&tn.maxTouchPoints>1)&&(on=!0,hn="",ln=0);var cn=Jr.OS_UNKNOWN;-1!==tn.appVersion.indexOf("Win")?cn=Jr.OS_WINDOWS:on?cn=Jr.OS_IOS:-1!==tn.appVersion.indexOf("Mac")?cn=Jr.OS_OSX:-1!==tn.appVersion.indexOf("X11")&&-1===tn.appVersion.indexOf("Linux")?cn=Jr.OS_UNIX:an?cn=Jr.OS_ANDROID:-1===tn.appVersion.indexOf("Linux")&&-1===nn.indexOf("ubuntu")||(cn=Jr.OS_LINUX),Jr.os=cn,Jr.osVersion=hn,Jr.osMainVersion=ln,Jr.browserType=Jr.BROWSER_TYPE_UNKNOWN,function(){var t=/mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|ucbs|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|miuibrowser/i.exec(nn)||/qq|qqbrowser|ucbrowser|ubrowser|edge|HuaweiBrowser/i.exec(nn)||/chrome|safari|firefox|trident|opera|opr\/|oupeng/i.exec(nn),e=t?t[0].toLowerCase():Jr.BROWSER_TYPE_UNKNOWN;("safari"===e&&an||"qq"===e&&nn.match(/android.*applewebkit/i))&&(e=Jr.BROWSER_TYPE_ANDROID);var i={micromessenger:Jr.BROWSER_TYPE_WECHAT,trident:Jr.BROWSER_TYPE_IE,edge:Jr.BROWSER_TYPE_EDGE,"360 aphone":Jr.BROWSER_TYPE_360,mxbrowser:Jr.BROWSER_TYPE_MAXTHON,"opr/":Jr.BROWSER_TYPE_OPERA,ubrowser:Jr.BROWSER_TYPE_UC,huaweibrowser:Jr.BROWSER_TYPE_HUAWEI};Jr.browserType=i[e]||e}(),Jr.browserVersion="",(Qr=nn.match(/(mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|uc|ucbs|360 aphone|360|baiduboxapp|baidu|maxthon|mxbrowser|miui(?:.hybrid)?)(mobile)?(browser)?\/?([\d.]+)/i))||(Qr=nn.match(/(qq|chrome|safari|firefox|trident|opera|opr\/|oupeng)(mobile)?(browser)?\/?([\d.]+)/i)),Jr.browserVersion=Qr?Qr[4]:"";var _n=window.innerWidth||document.documentElement.clientWidth,dn=window.innerHeight||document.documentElement.clientHeight,pn=window.devicePixelRatio||1;Jr.windowPixelResolution={width:pn*_n,height:pn*dn};var fn,mn=document.createElement("canvas");try{var gn=Jr.localStorage=$r.localStorage;gn.setItem("storage",""),gn.removeItem("storage"),gn=null}catch(Fa){var vn=function(){I(5200)};Jr.localStorage={getItem:vn,setItem:vn,removeItem:vn,clear:vn}}try{fn=mn.toDataURL("image/webp").startsWith("data:image/webp")}catch(Fa){fn=!1}var yn=!!mn.getContext("2d"),Tn=!1;$r.WebGLRenderingContext&&(Tn=!0);var En,Sn=Jr.capabilities={canvas:yn,opengl:Tn,webp:fn,imageBitmap:!1};"undefined"!=typeof createImageBitmap&&"undefined"!=typeof Blob&&(mn.width=mn.height=2,createImageBitmap(mn,{}).then((function(t){Sn.imageBitmap=!0,t.close&&t.close()})).catch((function(){}))),(void 0!==rn.ontouchstart||void 0!==en.ontouchstart||tn.msPointerEnabled)&&(Sn.touches=!0),void 0!==rn.onmouseup&&(Sn.mouse=!0),void 0!==rn.onkeyup&&(Sn.keyboard=!0),($r.DeviceMotionEvent||$r.DeviceOrientationEvent)&&(Sn.accelerometer=!0),En={ONLY_ONE:!1,WEB_AUDIO:!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),DELAY_CREATE_CTX:!1},Jr.os===Jr.OS_IOS&&(En.USE_LOADER_EVENT="loadedmetadata"),Jr.browserType===Jr.BROWSER_TYPE_FIREFOX&&(En.DELAY_CREATE_CTX=!0,En.USE_LOADER_EVENT="canplay"),Jr.os===Jr.OS_ANDROID&&Jr.browserType===Jr.BROWSER_TYPE_UC&&(En.ONE_SOURCE=!0);try{En.WEB_AUDIO&&(En._context=null,Object.defineProperty(En,"context",{get:function(){return this._context?this._context:this._context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)}}))}catch(S){En.WEB_AUDIO=!1,x(5201)}var bn=[];(Zr=document.createElement("audio")).canPlayType&&(Zr.canPlayType('audio/ogg; codecs="vorbis"')&&bn.push(".ogg"),Zr.canPlayType("audio/mpeg")&&bn.push(".mp3"),Zr.canPlayType('audio/wav; codecs="1"')&&bn.push(".wav"),Zr.canPlayType("audio/mp4")&&bn.push(".mp4"),Zr.canPlayType("audio/x-m4a")&&bn.push(".m4a")),En.format=bn,Jr.__audioSupport=En,Jr.__videoSupport={format:[]},function(){var t=document.createElement("video");if(t.canPlayType){var e=Jr.__videoSupport.format;["mp4","webm"].forEach((function(i){t.canPlayType("video/"+i)&&e.push("."+i)})),Jr.__videoSupport.format=e}}()}_.sys=Jr;var An=Jr.__audioSupport;function Cn(t){return new Promise((function(e,i){var r=document.createElement("audio");r.src=t;var n=function(){clearTimeout(s),r.removeEventListener("canplaythrough",a,!1),r.removeEventListener("error",o,!1),An.USE_LOADER_EVENT&&r.removeEventListener(An.USE_LOADER_EVENT,a,!1)},s=setTimeout((function(){0===r.readyState?o():a()}),8e3),a=function(){n(),e(r)},o=function(){n(),i("load audio failure - "+t)};r.addEventListener("canplaythrough",a,!1),r.addEventListener("error",o,!1),An.USE_LOADER_EVENT&&r.addEventListener(An.USE_LOADER_EVENT,a,!1)}))}var wn=function(){function t(){this._playingAudios=void 0,this._playingAudios=[]}var e=t.prototype;return e.addPlaying=function(t){this._playingAudios.push(t)},e.removePlaying=function(t){var e=this._playingAudios.indexOf(t);e>-1&&this._playingAudios.splice(e,1)},t}();wn.maxAudioChannel=24,_.internal.AudioManager=wn;var Rn=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e.prototype.discardOnePlayingIfNeeded=function(){if(!(this._playingAudios.length<wn.maxAudioChannel)){var t,e,i=this._playingAudios.findIndex((function(t){return t instanceof HTMLAudioElement}));i>-1?(t=this._playingAudios[i],this._playingAudios.splice(i,1),t.pause(),t.src=""):null===(e=t=this._playingAudios.shift())||void 0===e||e.stop()}},e}(wn),xn=function(t){function e(i){var r;return(r=t.call(this,i)||this)._volume=1,r._loop=!1,r._nativeAudio=void 0,r._cbRegistered=!1,r._remove_cb=void 0,r._post_play=void 0,r._on_gesture=void 0,r._post_gesture=void 0,r._nativeAudio=i.nativeAudio,r._remove_cb=function(){r._cbRegistered&&(_.game.canvas.removeEventListener("touchend",r._on_gesture),_.game.canvas.removeEventListener("mouseup",r._on_gesture),r._cbRegistered=!1)},r._post_play=function(){r._state=br.PLAYING,r._clip.emit("started"),r._remove_cb(),e._manager.addPlaying(a(r))},r._post_gesture=function(){r._interrupted?(r._post_play(),r._interrupted=!1):(r._nativeAudio.pause(),r._nativeAudio.currentTime=0)},r._on_gesture=function(){if(r._nativeAudio){var t=r._nativeAudio.play();if(!t)return r._state=br.PLAYING,void _.director.once(_.Director.EVENT_AFTER_UPDATE,r._post_gesture);t.then(r._post_gesture),r._remove_cb()}},r._nativeAudio.volume=r._volume,r._nativeAudio.loop=r._loop,r._nativeAudio.addEventListener("ended",(function(){r._state=br.STOPPED,r._nativeAudio.currentTime=0,r._clip.emit("ended"),e._manager.removePlaying(a(r))})),_.game.canvas.addEventListener("touchend",r._on_gesture),_.game.canvas.addEventListener("mouseup",r._on_gesture),r._cbRegistered=!0,r}s(e,t);var i=e.prototype;return i.play=function(){var t=this;if(this._nativeAudio)if(this._blocking)this._interrupted=!0;else{this._state===br.PLAYING&&(this.pause(),this.setCurrentTime(0)),e._manager.discardOnePlayingIfNeeded();var i=this._nativeAudio.play();if(!i)return this._state=br.PLAYING,void _.director.once(_.Director.EVENT_AFTER_UPDATE,this._post_play);i.then(this._post_play).catch((function(){t._interrupted=!0}))}},i.pause=function(){this._nativeAudio&&(this._interrupted=!1,this._state===br.PLAYING&&(this._nativeAudio.pause(),this._state=br.STOPPED,e._manager.removePlaying(this)))},i.stop=function(){this._nativeAudio&&(this._nativeAudio.currentTime=0,this._interrupted=!1,this._state===br.PLAYING&&(this._nativeAudio.pause(),this._state=br.STOPPED,e._manager.removePlaying(this)))},i.playOneShot=function(t){void 0===t&&(t=1),Cn(this._nativeAudio.src).then((function(i){e._manager.discardOnePlayingIfNeeded(),i.volume=t,i.play(),e._manager.addPlaying(i),i.addEventListener("ended",(function(){e._manager.removePlaying(i)}))}),(function(t){console.error(t)}))},i.setCurrentTime=function(t){this._nativeAudio&&(this._nativeAudio.currentTime=Ir(t,0,this._duration))},i.getCurrentTime=function(){return this._nativeAudio?this._nativeAudio.currentTime:0},i.setVolume=function(t){this._volume=t,this._nativeAudio&&(this._nativeAudio.volume=t)},i.getVolume=function(){return this._nativeAudio?this._nativeAudio.volume:this._volume},i.setLoop=function(t){this._loop=t,this._nativeAudio&&(this._nativeAudio.loop=t)},i.getLoop=function(){return this._loop},i.destroy=function(){this._nativeAudio&&(this._nativeAudio.src=""),t.prototype.destroy.call(this)},e}(Ar);xn._manager=new Rn;var On,In,Mn,Bn,Pn,Nn,Ln,Fn,Dn=Jr.__audioSupport,Un=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e.prototype.discardOnePlayingIfNeeded=function(){var t;if(!(this._playingAudios.length<wn.maxAudioChannel)){var e,i=this._playingAudios.findIndex((function(t){return t instanceof AudioBufferSourceNode}));i>-1?(e=this._playingAudios[i],this._playingAudios.splice(i,1)):e=this._playingAudios.shift(),null===(t=e)||void 0===t||t.stop()}},e}(wn),kn=function(t){function e(e){var i;return(i=t.call(this,e)||this)._startTime=0,i._offset=0,i._volume=1,i._loop=!1,i._currentTimer=0,i._nativeAudio=void 0,i._context=void 0,i._sourceNode=void 0,i._gainNode=void 0,i._startInvoked=!1,i._onEndedCB=void 0,i._onGestureCB=void 0,i._onGestureProceedCB=void 0,i._nativeAudio=e.nativeAudio,i._context=Dn.context,i._sourceNode=i._context.createBufferSource(),i._gainNode=i._context.createGain(),i._gainNode.connect(i._context.destination),i._onEndedCB=i._onEnded.bind(a(i)),i._onGestureCB=i._onGesture.bind(a(i)),i._onGestureProceedCB=i._onGestureProceed.bind(a(i)),"running"!==i._context.state&&i._context.resume&&(_.game.canvas.addEventListener("touchend",i._onGestureCB),_.game.canvas.addEventListener("mouseup",i._onGestureCB)),i}s(e,t);var i=e.prototype;return i.play=function(){if(this._nativeAudio){if(this._state===br.PLAYING&&(this.pause(),this.setCurrentTime(0)),this._blocking||"running"!==this._context.state)return this._interrupted=!0,void("interrupted"!==this._context.state&&"suspended"!==this._context.state||!this._context.resume||this._onGesture());this._doPlay()}},i.pause=function(){this._interrupted=!1,this._state===br.PLAYING&&(this._doStop(),this._offset+=this._context.currentTime-this._startTime,this._state=br.STOPPED,clearInterval(this._currentTimer))},i.stop=function(){this._offset=0,this._interrupted=!1,this._state===br.PLAYING&&(this._doStop(),this._state=br.STOPPED,clearInterval(this._currentTimer))},i.playOneShot=function(t){if(void 0===t&&(t=1),this._nativeAudio){e._manager.discardOnePlayingIfNeeded();var i=this._context.createGain();i.connect(this._context.destination),i.gain.value=t;var r=this._context.createBufferSource();r.buffer=this._nativeAudio,r.loop=!1,r.connect(i),r.start(),e._manager.addPlaying(r),r.onended=function(){e._manager.removePlaying(r)}}},i.setCurrentTime=function(t){this._offset=Ir(t,0,this._nativeAudio&&this._nativeAudio.duration||this._duration),this._state===br.PLAYING&&(this._doStop(),this._doPlay())},i.getCurrentTime=function(){return this._state!==br.PLAYING?this._offset:this._context.currentTime-this._startTime+this._offset},i.setVolume=function(t,e){if(this._volume=t,!e&&this._gainNode.gain.setTargetAtTime)try{this._gainNode.gain.setTargetAtTime(t,this._context.currentTime,0)}catch(e){this._gainNode.gain.setTargetAtTime(t,this._context.currentTime,.01)}else this._gainNode.gain.value=t},i.getVolume=function(){return this._volume},i.setLoop=function(t){this._loop=t,this._sourceNode.loop=t},i.getLoop=function(){return this._loop},i.destroy=function(){t.prototype.destroy.call(this)},i._doPlay=function(){var t=this;e._manager.discardOnePlayingIfNeeded(),this._state=br.PLAYING,this._sourceNode=this._context.createBufferSource(),this._sourceNode.buffer=this._nativeAudio,this._sourceNode.loop=this._loop,this._sourceNode.connect(this._gainNode),this._startTime=this._context.currentTime,this._startInvoked=!1,_.director.once(_.Director.EVENT_AFTER_UPDATE,this._playAndEmit,this),clearInterval(this._currentTimer),this._currentTimer=window.setInterval((function(){t._onEnded(),clearInterval(t._currentTimer),t._sourceNode.loop&&(t._currentTimer=window.setInterval(t._onEndedCB,1e3*t._nativeAudio.duration))}),1e3*(this._nativeAudio.duration-this._offset))},i._doStop=function(){this._startInvoked?this._sourceNode.stop():_.director.off(_.Director.EVENT_AFTER_UPDATE,this._playAndEmit,this),e._manager.removePlaying(this)},i._playAndEmit=function(){this._sourceNode.start(0,this._offset),this._clip.emit("started"),this._startInvoked=!0,e._manager.addPlaying(this)},i._onEnded=function(){this._offset=0,this._startTime=this._context.currentTime,this._sourceNode.loop||(this._clip.emit("ended"),this._state=br.STOPPED,e._manager.removePlaying(this))},i._onGestureProceed=function(){this._interrupted&&(this._doPlay(),this._interrupted=!1),_.game.canvas.removeEventListener("touchend",this._onGestureCB),_.game.canvas.removeEventListener("mouseup",this._onGestureCB)},i._onGesture=function(){"running"!==this._context.state?this._context.resume().then(this._onGestureProceedCB):this._onGestureProceed()},e}(Ar);kn._manager=new Un;var zn=Pt({WEB_AUDIO:0,DOM_AUDIO:1,JSB_AUDIO:2,UNKNOWN_AUDIO:3}),Gn=t("AudioClip",(On=Ne("cc.AudioClip"),In=pi(zn),On((Fn=Ln=function(t){function e(){var e;return l(e=t.call(this)||this,"_duration",Pn,a(e)),l(e,"_loadMode",Nn,a(e)),e._nativeAudio=null,e._player=null,e.loaded=!1,e}s(e,t);var i=e.prototype;return i.destroy=function(){return this._player&&this._player.destroy(),t.prototype.destroy.call(this)},i.play=function(){this._player&&this._player.play()},i.pause=function(){this._player&&this._player.pause()},i.stop=function(){this._player&&this._player.stop()},i.playOneShot=function(t){this._player&&this._player.playOneShot(t)},i.setCurrentTime=function(t){this._player&&this._player.setCurrentTime(t)},i.getCurrentTime=function(){return this._player?this._player.getCurrentTime():0},i.getDuration=function(){return this._player?this._player.getDuration():this._duration},i.setVolume=function(t,e){this._player&&this._player.setVolume(t,e||!1)},i.getVolume=function(){return this._player?this._player.getVolume():1},i.setLoop=function(t){this._player&&this._player.setLoop(t)},i.getLoop=function(){return!!this._player&&this._player.getLoop()},i._getPlayer=function(t){var e;return"undefined"!=typeof AudioBuffer&&t instanceof AudioBuffer?(e=kn,this._loadMode=zn.WEB_AUDIO):(e=xn,this._loadMode=zn.DOM_AUDIO),e},r(e,[{key:"_nativeAsset",set:function(t){if(this._nativeAudio=t,t){var e=this._getPlayer(t);this._player=new e({nativeAudio:t,duration:this._duration,audioClip:this}),this.loaded=!0,this.emit("load")}else this._player=null,this._loadMode=zn.UNKNOWN_AUDIO,this._duration=0,this.loaded=!1},get:function(){return this._nativeAudio}},{key:"_nativeDep",get:function(){return{uuid:this._uuid,audioLoadMode:this.loadMode,ext:this._native,__isNative__:!0}}},{key:"loadMode",get:function(){return this._loadMode}},{key:"state",get:function(){return this._player?this._player.getState():br.INITIALIZING}}]),e}(Sr),Ln.PlayingState=br,Ln.AudioType=zn,Ln.preventDeferredLoadDependents=!0,Pn=u((Bn=Fn).prototype,"_duration",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Nn=u(Bn.prototype,"_loadMode",[In],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zn.UNKNOWN_AUDIO}}),u(Bn.prototype,"_nativeDep",[fi],Object.getOwnPropertyDescriptor(Bn.prototype,"_nativeDep"),Bn.prototype),Mn=Bn))||Mn));function Hn(t,e,i,r){var n=new XMLHttpRequest,s="download failed: "+t+", status: ";if(n.open("GET",t,!0),void 0!==e.xhrResponseType&&(n.responseType=e.xhrResponseType),void 0!==e.xhrWithCredentials&&(n.withCredentials=e.xhrWithCredentials),void 0!==e.xhrMimeType&&n.overrideMimeType&&n.overrideMimeType(e.xhrMimeType),void 0!==e.xhrTimeout&&(n.timeout=e.xhrTimeout),e.xhrHeader)for(var a in e.xhrHeader)n.setRequestHeader(a,e.xhrHeader[a]);return n.onload=function(){200===n.status||0===n.status?r&&r(null,n.response):r&&r(new Error(s+n.status+"(no response)"))},i&&(n.onprogress=function(t){t.lengthComputable&&i(t.loaded,t.total)}),n.onerror=function(){r&&r(new Error(s+n.status+"(error)"))},n.ontimeout=function(){r&&r(new Error(s+n.status+"(time out)"))},n.onabort=function(){r&&r(new Error(s+n.status+"(abort)"))},n.send(null),n}_.AudioClip=Gn;var Vn,Wn,jn,Xn=Jr.__audioSupport,Yn=Xn.format;function qn(t,e,i){Cn(t).then((function(t){i(null,t)}),(function(t){T(t),i(new Error(t),null)}))}function Kn(t,e,i){e.xhrResponseType="arraybuffer",Hn(t,e,e.onFileProgress,i)}function Zn(t,e,i){0!==Yn.length?(Xn.WEB_AUDIO&&e.audioLoadMode!==zn.DOM_AUDIO?Kn:qn)(t,e,i):i(new Error(F(4927)))}var Qn=t("Script",Ne("cc.Script")(Vn=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e}(Sr))||Vn);_._Script=Qn;var Jn=t("JavaScript",Ne("cc.JavaScript")(Wn=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e}(Qn))||Wn);_._JavaScript=Jn;var $n,ts,es,is,rs,ns,ss,as,os,hs,ls,us=t("TypeScript",Ne("cc.TypeScript")(jn=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e}(Qn))||jn);_._TypeScript=us;var cs=new j("Comp"),_s=Xi.Flags.IsOnLoadCalled,ds=t("Component",($n=Ne("cc.Component"),ts=Je(),es=pi(Qn),is=$e(),$n((ls=hs=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"node",ss,a(e)),l(e,"_enabled",as,a(e)),l(e,"__prefab",os,a(e)),e._sceneGetter=null,e._id=cs.getNewId(),e}s(e,t);var i=e.prototype;return i._getRenderScene=function(){return this._sceneGetter?this._sceneGetter():this.node.scene._renderScene},i.addComponent=function(t){return this.node.addComponent(t)},i.getComponent=function(t){return this.node.getComponent(t)},i.getComponents=function(t){return this.node.getComponents(t)},i.getComponentInChildren=function(t){return this.node.getComponentInChildren(t)},i.getComponentsInChildren=function(t){return this.node.getComponentsInChildren(t)},i.destroy=function(){return!!t.prototype.destroy.call(this)&&(this._enabled&&this.node.activeInHierarchy&&_.director._compScheduler.disableComp(this),!0)},i._onPreDestroy=function(){this.unscheduleAllCallbacks(),_.director._nodeActivator.destroyComp(this),this.node._removeComponent(this)},i._instantiate=function(t){return t||(t=_.instantiate._clone(this,this)),t.node=null,t},i.schedule=function(t,e,i,r){void 0===e&&(e=0),void 0===i&&(i=_.macro.REPEAT_FOREVER),void 0===r&&(r=0),L(t,1619),L((e=e||0)>=0,1620),i=isNaN(i)?_.macro.REPEAT_FOREVER:i,r=r||0;var n=_.director.getScheduler(),s=n.isTargetPaused(this);n.schedule(t,this,e,i,r,s)},i.scheduleOnce=function(t,e){void 0===e&&(e=0),this.schedule(t,0,0,e)},i.unschedule=function(t){t&&_.director.getScheduler().unschedule(t,this)},i.unscheduleAllCallbacks=function(){_.director.getScheduler().unscheduleAllForTarget(this)},r(e,[{key:"name",get:function(){if(this._name)return this._name;var t=rt(this),e=t.lastIndexOf(".");return e>=0&&(t=t.slice(e+1)),this.node.name+"<"+t+">"},set:function(t){this._name=t}},{key:"uuid",get:function(){return this._id}},{key:"__scriptAsset",get:function(){return null}},{key:"enabled",get:function(){return this._enabled},set:function(t){if(this._enabled!==t&&(this._enabled=t,this.node.activeInHierarchy)){var e=_.director._compScheduler;t?e.enableComp(this):e.disableComp(this)}}},{key:"enabledInHierarchy",get:function(){return this._enabled&&this.node&&this.node.activeInHierarchy}},{key:"_isOnLoadCalled",get:function(){return this._objFlags&_s}}]),e}(Xi),hs.system=null,u((ns=ls).prototype,"__scriptAsset",[ts,es,is,li],Object.getOwnPropertyDescriptor(ns.prototype,"__scriptAsset"),ns.prototype),ss=u(ns.prototype,"node",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),as=u(ns.prototype,"_enabled",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),os=u(ns.prototype,"__prefab",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rs=ns))||rs)),ps=ds.prototype;function fs(t){return(t>0)-(t<0)}function ms(t){var e,i;return e=(t>65535)<<4,e|=i=((t>>>=e)>255)<<3,e|=i=((t>>>=i)>15)<<2,(e|=i=((t>>>=i)>3)<<1)|(t>>>=i)>>1}function gs(t){var e=32;return(t&=-t)&&e--,65535&t&&(e-=16),16711935&t&&(e-=8),252645135&t&&(e-=4),858993459&t&&(e-=2),1431655765&t&&(e-=1),e}function vs(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,1+(t|=t>>>16)}ps.update=null,ps.lateUpdate=null,ps.__preload=null,ps.onLoad=null,ps.start=null,ps.onEnable=null,ps.onDisable=null,ps.onDestroy=null,ps.onFocusInEditor=null,ps.onLostFocusInEditor=null,ps.resetInEditor=null,ps._getLocalBounds=null,ps.onRestore=null,ds._requireComponent=null,ds._executionOrder=0,J(ds,"_registerEditorProps",(function(t,e){var i=e.requireComponent;i&&(t._requireComponent=i);var r=e.executionOrder;r&&"number"==typeof r&&(t._executionOrder=r)})),_.Component=ds;var ys=new Array(256);!function(t){for(var e=0;e<256;++e){var i=e,r=e,n=7;for(i>>>=1;i;i>>>=1)r<<=1,r|=1&i,--n;t[e]=r<<n&255}}(ys);var Ts=Object.freeze({__proto__:null,INT_BITS:32,INT_MAX:2147483647,INT_MIN:-1<<31,sign:fs,abs:function(t){var e=t>>31;return(t^e)-e},min:function(t,e){return e^(t^e)&-(t<e)},max:function(t,e){return t^(t^e)&-(t<e)},isPow2:function(t){return!(t&t-1||!t)},log2:ms,log10:function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},popCount:function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},countTrailingZeros:gs,nextPow2:vs,prevPow2:function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},parity:function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1},reverse:function(t){return ys[255&t]<<24|ys[t>>>8&255]<<16|ys[t>>>16&255]<<8|ys[t>>>24&255]},interleave2:function(t,e){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))<<1},deinterleave2:function(t,e){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>e&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},interleave3:function(t,e,i){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2))<<1)|(i=1227133513&((i=3272356035&((i=251719695&((i=4278190335&((i&=1023)|i<<16))|i<<8))|i<<4))|i<<2))<<2},deinterleave3:function(t,e){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>e&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},nextCombination:function(t){var e=t|t-1;return e+1|(~e&-~e)-1>>>gs(t)+1}});t("bits",Ts);var Es=t("Vec2",function(t){function e(e,i){var r;return r=t.call(this)||this,e&&"object"==typeof e?(r.x=e.x,r.y=e.y):(r.x=e||0,r.y=i||0),r}s(e,t),e.clone=function(t){return new e(t.x,t.y)},e.copy=function(t,e){return t.x=e.x,t.y=e.y,t},e.set=function(t,e,i){return t.x=e,t.y=i,t},e.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t},e.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t},e.multiply=function(t,e,i){return t.x=e.x*i.x,t.y=e.y*i.y,t},e.divide=function(t,e,i){return t.x=e.x/i.x,t.y=e.y/i.y,t},e.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t},e.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t},e.min=function(t,e,i){return t.x=Math.min(e.x,i.x),t.y=Math.min(e.y,i.y),t},e.max=function(t,e,i){return t.x=Math.max(e.x,i.x),t.y=Math.max(e.y,i.y),t},e.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t},e.multiplyScalar=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t},e.scaleAndAdd=function(t,e,i,r){return t.x=e.x+i.x*r,t.y=e.y+i.y*r,t},e.distance=function(t,e){var i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)},e.squaredDistance=function(t,e){var i=e.x-t.x,r=e.y-t.y;return i*i+r*r},e.len=function(t){var e=t.x,i=t.y;return Math.sqrt(e*e+i*i)},e.lengthSqr=function(t){var e=t.x,i=t.y;return e*e+i*i},e.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t},e.inverse=function(t,e){return t.x=1/e.x,t.y=1/e.y,t},e.inverseSafe=function(t,e){var i=e.x,r=e.y;return Math.abs(i)<Rr?t.x=0:t.x=1/i,Math.abs(r)<Rr?t.y=0:t.y=1/r,t},e.normalize=function(t,e){var i=e.x,r=e.y,n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n),t.x=i*n,t.y=r*n),t},e.dot=function(t,e){return t.x*e.x+t.y*e.y},e.cross=function(t,e,i){return t.x=t.y=0,t.z=e.x*i.y-e.y*i.x,t},e.lerp=function(t,e,i,r){var n=e.x,s=e.y;return t.x=n+r*(i.x-n),t.y=s+r*(i.y-s),t},e.random=function(t,e){e=e||1;var i=2*Lr()*Math.PI;return t.x=Math.cos(i)*e,t.y=Math.sin(i)*e,t},e.transformMat3=function(t,e,i){var r=e.x,n=e.y;return t.x=i.m00*r+i.m03*n+i.m06,t.y=i.m01*r+i.m04*n+i.m07,t},e.transformMat4=function(t,e,i){var r=e.x,n=e.y;return t.x=i.m00*r+i.m04*n+i.m12,t.y=i.m01*r+i.m05*n+i.m13,t},e.str=function(t){return"Vec2("+t.x+", "+t.y+")"},e.toArray=function(t,e,i){return void 0===i&&(i=0),t[i+0]=e.x,t[i+1]=e.y,t},e.fromArray=function(t,e,i){return void 0===i&&(i=0),t.x=e[i+0],t.y=e[i+1],t},e.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y},e.equals=function(t,e,i){return void 0===i&&(i=Rr),Math.abs(t.x-e.x)<=i*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=i*Math.max(1,Math.abs(t.y),Math.abs(e.y))},e.angle=function(t,i){e.normalize(Ss,t),e.normalize(bs,i);var r=e.dot(Ss,bs);return r>1?0:r<-1?Math.PI:Math.acos(r)};var i=e.prototype;return i.clone=function(){return new e(this.x,this.y)},i.set=function(t,e){return t&&"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t||0,this.y=e||0),this},i.equals=function(t,e){return void 0===e&&(e=Rr),Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))},i.equals2f=function(t,e,i){return void 0===i&&(i=Rr),Math.abs(this.x-t)<=i*Math.max(1,Math.abs(this.x),Math.abs(t))&&Math.abs(this.y-e)<=i*Math.max(1,Math.abs(this.y),Math.abs(e))},i.strictEquals=function(t){return t&&this.x===t.x&&this.y===t.y},i.strictEquals2f=function(t,e){return this.x===t&&this.y===e},i.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},i.lerp=function(t,e){var i=this.x,r=this.y;return this.x=i+e*(t.x-i),this.y=r+e*(t.y-r),this},i.clampf=function(t,e){return this.x=Ir(this.x,t.x,e.x),this.y=Ir(this.y,t.y,e.y),this},i.add=function(t){return this.x=this.x+t.x,this.y=this.y+t.y,this},i.add2f=function(t,e){return this.x=this.x+t,this.y=this.y+e,this},i.subtract=function(t){return this.x=this.x-t.x,this.y=this.y-t.y,this},i.subtract2f=function(t,e){return this.x=this.x-t,this.y=this.y-e,this},i.multiplyScalar=function(t){return"object"==typeof t&&console.warn("should use Vec2.multiply for vector * vector operation"),this.x=this.x*t,this.y=this.y*t,this},i.multiply=function(t){return"object"!=typeof t&&console.warn("should use Vec2.scale for vector * scalar operation"),this.x=this.x*t.x,this.y=this.y*t.y,this},i.multiply2f=function(t,e){return this.x=this.x*t,this.y=this.y*e,this},i.divide=function(t){return this.x=this.x/t.x,this.y=this.y/t.y,this},i.divide2f=function(t,e){return this.x=this.x/t,this.y=this.y/e,this},i.negative=function(){return this.x=-this.x,this.y=-this.y,this},i.dot=function(t){return this.x*t.x+this.y*t.y},i.cross=function(t){return this.x*t.y-this.y*t.x},i.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.lengthSqr=function(){return this.x*this.x+this.y*this.y},i.normalize=function(){var t=this.x,e=this.y,i=t*t+e*e;return i>0&&(i=1/Math.sqrt(i),this.x=this.x*i,this.y=this.y*i),this},i.angle=function(t){var e=this.lengthSqr(),i=t.lengthSqr();if(0===e||0===i)return console.warn("Can't get angle between zero vector"),0;var r=this.dot(t)/Math.sqrt(e*i);return r=Ir(r,-1,1),Math.acos(r)},i.signAngle=function(t){var e=this.angle(t);return this.cross(t)<0?-e:e},i.rotate=function(t){var e=this.x,i=this.y,r=Math.sin(t),n=Math.cos(t);return this.x=n*e-r*i,this.y=r*e+n*i,this},i.project=function(t){var e=this.dot(t)/t.dot(t);return this.x=t.x*e,this.y=t.y*e,this},i.transformMat4=function(t){var e=this.x,i=this.y;return this.x=t.m00*e+t.m04*i+t.m12,this.y=t.m01*e+t.m05*i+t.m13,this},e}(Dt));Es.ZERO=Object.freeze(new Es(0,0)),Es.ONE=Object.freeze(new Es(1,1)),Es.NEG_ONE=Object.freeze(new Es(-1,-1)),Es.UNIT_X=Object.freeze(new Es(1,0)),Es.UNIT_Y=Object.freeze(new Es(0,1));var Ss=new Es,bs=new Es;function As(t,e){return new Es(t,e)}Ae.fastDefine("cc.Vec2",Es,{x:0,y:0}),_.Vec2=Es,_.v2=As;var Cs=t("Vec3",function(t){function e(e,i,r){var n;return n=t.call(this)||this,e&&"object"==typeof e?(n.x=e.x,n.y=e.y,n.z=e.z):(n.x=e||0,n.y=i||0,n.z=r||0),n}s(e,t),e.zero=function(t){return t.x=0,t.y=0,t.z=0,t},e.clone=function(t){return new e(t.x,t.y,t.z)},e.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t},e.set=function(t,e,i,r){return t.x=e,t.y=i,t.z=r,t},e.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t.z=e.z+i.z,t},e.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t.z=e.z-i.z,t},e.multiply=function(t,e,i){return t.x=e.x*i.x,t.y=e.y*i.y,t.z=e.z*i.z,t},e.divide=function(t,e,i){return t.x=e.x/i.x,t.y=e.y/i.y,t.z=e.z/i.z,t},e.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t.z=Math.ceil(e.z),t},e.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t.z=Math.floor(e.z),t},e.min=function(t,e,i){return t.x=Math.min(e.x,i.x),t.y=Math.min(e.y,i.y),t.z=Math.min(e.z,i.z),t},e.max=function(t,e,i){return t.x=Math.max(e.x,i.x),t.y=Math.max(e.y,i.y),t.z=Math.max(e.z,i.z),t},e.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t.z=Math.round(e.z),t},e.multiplyScalar=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t},e.scaleAndAdd=function(t,e,i,r){return t.x=e.x+i.x*r,t.y=e.y+i.y*r,t.z=e.z+i.z*r,t},e.distance=function(t,e){var i=e.x-t.x,r=e.y-t.y,n=e.z-t.z;return Math.sqrt(i*i+r*r+n*n)},e.squaredDistance=function(t,e){var i=e.x-t.x,r=e.y-t.y,n=e.z-t.z;return i*i+r*r+n*n},e.len=function(t){var e=t.x,i=t.y,r=t.z;return Math.sqrt(e*e+i*i+r*r)},e.lengthSqr=function(t){var e=t.x,i=t.y,r=t.z;return e*e+i*i+r*r},e.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t},e.invert=function(t,e){return t.x=1/e.x,t.y=1/e.y,t.z=1/e.z,t},e.invertSafe=function(t,e){var i=e.x,r=e.y,n=e.z;return Math.abs(i)<Rr?t.x=0:t.x=1/i,Math.abs(r)<Rr?t.y=0:t.y=1/r,Math.abs(n)<Rr?t.z=0:t.z=1/n,t},e.normalize=function(t,e){var i=e.x,r=e.y,n=e.z,s=i*i+r*r+n*n;return s>0&&(s=1/Math.sqrt(s),t.x=i*s,t.y=r*s,t.z=n*s),t},e.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},e.cross=function(t,e,i){var r=e.x,n=e.y,s=e.z,a=i.x,o=i.y,h=i.z;return t.x=n*h-s*o,t.y=s*a-r*h,t.z=r*o-n*a,t},e.lerp=function(t,e,i,r){return t.x=e.x+r*(i.x-e.x),t.y=e.y+r*(i.y-e.y),t.z=e.z+r*(i.z-e.z),t},e.random=function(t,e){e=e||1;var i=2*Lr()*Math.PI,r=2*Lr()-1,n=Math.sqrt(1-r*r);return t.x=n*Math.cos(i)*e,t.y=n*Math.sin(i)*e,t.z=r*e,t},e.transformMat4=function(t,e,i){var r=e.x,n=e.y,s=e.z,a=i.m03*r+i.m07*n+i.m11*s+i.m15;return a=a?Math.abs(1/a):1,t.x=(i.m00*r+i.m04*n+i.m08*s+i.m12)*a,t.y=(i.m01*r+i.m05*n+i.m09*s+i.m13)*a,t.z=(i.m02*r+i.m06*n+i.m10*s+i.m14)*a,t},e.transformMat4Normal=function(t,e,i){var r=e.x,n=e.y,s=e.z,a=i.m03*r+i.m07*n+i.m11*s;return a=a?Math.abs(1/a):1,t.x=(i.m00*r+i.m04*n+i.m08*s)*a,t.y=(i.m01*r+i.m05*n+i.m09*s)*a,t.z=(i.m02*r+i.m06*n+i.m10*s)*a,t},e.transformMat3=function(t,e,i){var r=e.x,n=e.y,s=e.z;return t.x=r*i.m00+n*i.m03+s*i.m06,t.y=r*i.m01+n*i.m04+s*i.m07,t.z=r*i.m02+n*i.m05+s*i.m08,t},e.transformAffine=function(t,e,i){var r=e.x,n=e.y,s=e.z;return t.x=i.m00*r+i.m04*n+i.m08*s+i.m12,t.y=i.m01*r+i.m05*n+i.m09*s+i.m13,t.x=i.m02*r+i.m06*n+i.m10*s+i.m14,t},e.transformQuat=function(t,e,i){var r=i.w*e.x+i.y*e.z-i.z*e.y,n=i.w*e.y+i.z*e.x-i.x*e.z,s=i.w*e.z+i.x*e.y-i.y*e.x,a=-i.x*e.x-i.y*e.y-i.z*e.z;return t.x=r*i.w+a*-i.x+n*-i.z-s*-i.y,t.y=n*i.w+a*-i.y+s*-i.x-r*-i.z,t.z=s*i.w+a*-i.z+r*-i.y-n*-i.x,t},e.transformRTS=function(t,e,i,r,n){var s=e.x*n.x,a=e.y*n.y,o=e.z*n.z,h=i.w*s+i.y*o-i.z*a,l=i.w*a+i.z*s-i.x*o,u=i.w*o+i.x*a-i.y*s,c=-i.x*s-i.y*a-i.z*o;return t.x=h*i.w+c*-i.x+l*-i.z-u*-i.y+r.x,t.y=l*i.w+c*-i.y+u*-i.x-h*-i.z+r.y,t.z=u*i.w+c*-i.z+h*-i.y-l*-i.x+r.z,t},e.transformInverseRTS=function(t,e,i,r,n){var s=e.x-r.x,a=e.y-r.y,o=e.z-r.z,h=i.w*s-i.y*o+i.z*a,l=i.w*a-i.z*s+i.x*o,u=i.w*o-i.x*a+i.y*s,c=i.x*s+i.y*a+i.z*o;return t.x=(h*i.w+c*i.x+l*i.z-u*i.y)/n.x,t.y=(l*i.w+c*i.y+u*i.x-h*i.z)/n.y,t.z=(u*i.w+c*i.z+h*i.y-l*i.x)/n.z,t},e.rotateX=function(t,e,i,r){var n=e.x-i.x,s=e.y-i.y,a=e.z-i.z,o=Math.cos(r),h=Math.sin(r),l=n,u=s*o-a*h,c=s*h+a*o;return t.x=l+i.x,t.y=u+i.y,t.z=c+i.z,t},e.rotateY=function(t,e,i,r){var n=e.x-i.x,s=e.y-i.y,a=e.z-i.z,o=Math.cos(r),h=Math.sin(r),l=a*h+n*o,u=s,c=a*o-n*h;return t.x=l+i.x,t.y=u+i.y,t.z=c+i.z,t},e.rotateZ=function(t,e,i,r){var n=e.x-i.x,s=e.y-i.y,a=e.z-i.z,o=Math.cos(r),h=Math.sin(r),l=n*o-s*h,u=n*h+s*o,c=a;return t.x=l+i.x,t.y=u+i.y,t.z=c+i.z,t},e.toArray=function(t,e,i){return void 0===i&&(i=0),t[i+0]=e.x,t[i+1]=e.y,t[i+2]=e.z,t},e.fromArray=function(t,e,i){return void 0===i&&(i=0),t.x=e[i+0],t.y=e[i+1],t.z=e[i+2],t},e.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z},e.equals=function(t,e,i){void 0===i&&(i=Rr);var r=t.x,n=t.y,s=t.z,a=e.x,o=e.y,h=e.z;return Math.abs(r-a)<=i*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-o)<=i*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(s-h)<=i*Math.max(1,Math.abs(s),Math.abs(h))},e.angle=function(t,i){e.normalize(ws,t),e.normalize(Rs,i);var r=e.dot(ws,Rs);return r>1?0:r<-1?Math.PI:Math.acos(r)},e.projectOnPlane=function(t,i,r){return e.subtract(t,i,e.project(t,i,r))},e.project=function(t,i,r){var n=e.lengthSqr(r);return n<1e-6?e.set(t,0,0,0):e.multiplyScalar(t,r,e.dot(i,r)/n)};var i=e.prototype;return i.clone=function(){return new e(this.x,this.y,this.z)},i.set=function(t,e,i){return t&&"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t||0,this.y=e||0,this.z=i||0),this},i.equals=function(t,e){return void 0===e&&(e=Rr),Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))&&Math.abs(this.z-t.z)<=e*Math.max(1,Math.abs(this.z),Math.abs(t.z))},i.equals3f=function(t,e,i,r){return void 0===r&&(r=Rr),Math.abs(this.x-t)<=r*Math.max(1,Math.abs(this.x),Math.abs(t))&&Math.abs(this.y-e)<=r*Math.max(1,Math.abs(this.y),Math.abs(e))&&Math.abs(this.z-i)<=r*Math.max(1,Math.abs(this.z),Math.abs(i))},i.strictEquals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},i.strictEquals3f=function(t,e,i){return this.x===t&&this.y===e&&this.z===i},i.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+")"},i.lerp=function(t,e){return this.x=this.x+e*(t.x-this.x),this.y=this.y+e*(t.y-this.y),this.z=this.z+e*(t.z-this.z),this},i.add=function(t){return this.x=this.x+t.x,this.y=this.y+t.y,this.z=this.z+t.z,this},i.add3f=function(t,e,i){return this.x=this.x+t,this.y=this.y+e,this.z=this.z+i,this},i.subtract=function(t){return this.x=this.x-t.x,this.y=this.y-t.y,this.z=this.z-t.z,this},i.subtract3f=function(t,e,i){return this.x=this.x-t,this.y=this.y-e,this.z=this.z-i,this},i.multiplyScalar=function(t){return"object"==typeof t&&console.warn("should use Vec3.multiply for vector * vector operation"),this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this},i.multiply=function(t){return"object"!=typeof t&&console.warn("should use Vec3.scale for vector * scalar operation"),this.x=this.x*t.x,this.y=this.y*t.y,this.z=this.z*t.z,this},i.multiply3f=function(t,e,i){return this.x=this.x*t,this.y=this.y*e,this.z=this.z*i,this},i.divide=function(t){return this.x=this.x/t.x,this.y=this.y/t.y,this.z=this.z/t.z,this},i.divide3f=function(t,e,i){return this.x=this.x/t,this.y=this.y/e,this.z=this.z/i,this},i.negative=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},i.clampf=function(t,e){return this.x=Ir(this.x,t.x,e.x),this.y=Ir(this.y,t.y,e.y),this.z=Ir(this.z,t.z,e.z),this},i.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},i.cross=function(t){var e=this.x,i=this.y,r=this.z,n=t.x,s=t.y,a=t.z;return this.x=i*a-r*s,this.y=r*n-e*a,this.z=e*s-i*n,this},i.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},i.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z},i.normalize=function(){var t=this.x,e=this.y,i=this.z,r=t*t+e*e+i*i;return r>0&&(r=1/Math.sqrt(r),this.x=t*r,this.y=e*r,this.z=i*r),this},i.transformMat4=function(t){var e=this.x,i=this.y,r=this.z,n=t.m03*e+t.m07*i+t.m11*r+t.m15;return n=n?1/n:1,this.x=(t.m00*e+t.m04*i+t.m08*r+t.m12)*n,this.y=(t.m01*e+t.m05*i+t.m09*r+t.m13)*n,this.z=(t.m02*e+t.m06*i+t.m10*r+t.m14)*n,this},e}(Dt));Cs.UNIT_X=Object.freeze(new Cs(1,0,0)),Cs.UNIT_Y=Object.freeze(new Cs(0,1,0)),Cs.UNIT_Z=Object.freeze(new Cs(0,0,1)),Cs.RIGHT=Object.freeze(new Cs(1,0,0)),Cs.UP=Object.freeze(new Cs(0,1,0)),Cs.FORWARD=Object.freeze(new Cs(0,0,-1)),Cs.ZERO=Object.freeze(new Cs(0,0,0)),Cs.ONE=Object.freeze(new Cs(1,1,1)),Cs.NEG_ONE=Object.freeze(new Cs(-1,-1,-1));var ws=new Cs,Rs=new Cs;function xs(t,e,i){return new Cs(t,e,i)}Ae.fastDefine("cc.Vec3",Cs,{x:0,y:0,z:0}),_.Vec3=Cs,_.v3=xs;var Os=t("Vec4",function(t){function e(e,i,r,n){var s;return s=t.call(this)||this,e&&"object"==typeof e?(s.x=e.x,s.y=e.y,s.z=e.z,s.w=e.w):(s.x=e||0,s.y=i||0,s.z=r||0,s.w=n||0),s}s(e,t),e.clone=function(t){return new e(t.x,t.y,t.z,t.w)},e.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t},e.set=function(t,e,i,r,n){return t.x=e,t.y=i,t.z=r,t.w=n,t},e.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t.z=e.z+i.z,t.w=e.w+i.w,t},e.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t.z=e.z-i.z,t.w=e.w-i.w,t},e.multiply=function(t,e,i){return t.x=e.x*i.x,t.y=e.y*i.y,t.z=e.z*i.z,t.w=e.w*i.w,t},e.divide=function(t,e,i){return t.x=e.x/i.x,t.y=e.y/i.y,t.z=e.z/i.z,t.w=e.w/i.w,t},e.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t.z=Math.ceil(e.z),t.w=Math.ceil(e.w),t},e.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t.z=Math.floor(e.z),t.w=Math.floor(e.w),t},e.min=function(t,e,i){return t.x=Math.min(e.x,i.x),t.y=Math.min(e.y,i.y),t.z=Math.min(e.z,i.z),t.w=Math.min(e.w,i.w),t},e.max=function(t,e,i){return t.x=Math.max(e.x,i.x),t.y=Math.max(e.y,i.y),t.z=Math.max(e.z,i.z),t.w=Math.max(e.w,i.w),t},e.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t.z=Math.round(e.z),t.w=Math.round(e.w),t},e.multiplyScalar=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t.w=e.w*i,t},e.scaleAndAdd=function(t,e,i,r){return t.x=e.x+i.x*r,t.y=e.y+i.y*r,t.z=e.z+i.z*r,t.w=e.w+i.w*r,t},e.distance=function(t,e){var i=e.x-t.x,r=e.y-t.y,n=e.z-t.z,s=e.w-t.w;return Math.sqrt(i*i+r*r+n*n+s*s)},e.squaredDistance=function(t,e){var i=e.x-t.x,r=e.y-t.y,n=e.z-t.z,s=e.w-t.w;return i*i+r*r+n*n+s*s},e.len=function(t){var e=t.x,i=t.y,r=t.z,n=t.w;return Math.sqrt(e*e+i*i+r*r+n*n)},e.lengthSqr=function(t){var e=t.x,i=t.y,r=t.z,n=t.w;return e*e+i*i+r*r+n*n},e.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t},e.inverse=function(t,e){return t.x=1/e.x,t.y=1/e.y,t.z=1/e.z,t.w=1/e.w,t},e.inverseSafe=function(t,e){var i=e.x,r=e.y,n=e.z,s=e.w;return Math.abs(i)<Rr?t.x=0:t.x=1/i,Math.abs(r)<Rr?t.y=0:t.y=1/r,Math.abs(n)<Rr?t.z=0:t.z=1/n,Math.abs(s)<Rr?t.w=0:t.w=1/s,t},e.normalize=function(t,e){var i=e.x,r=e.y,n=e.z,s=e.w,a=i*i+r*r+n*n+s*s;return a>0&&(a=1/Math.sqrt(a),t.x=i*a,t.y=r*a,t.z=n*a,t.w=s*a),t},e.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},e.lerp=function(t,e,i,r){return t.x=e.x+r*(i.x-e.x),t.y=e.y+r*(i.y-e.y),t.z=e.z+r*(i.z-e.z),t.w=e.w+r*(i.w-e.w),t},e.random=function(t,e){e=e||1;var i=2*Lr()*Math.PI,r=2*Lr()-1,n=Math.sqrt(1-r*r);return t.x=n*Math.cos(i)*e,t.y=n*Math.sin(i)*e,t.z=r*e,t.w=0,t},e.transformMat4=function(t,e,i){var r=e.x,n=e.y,s=e.z,a=e.w;return t.x=i.m00*r+i.m04*n+i.m08*s+i.m12*a,t.y=i.m01*r+i.m05*n+i.m09*s+i.m13*a,t.z=i.m02*r+i.m06*n+i.m10*s+i.m14*a,t.w=i.m03*r+i.m07*n+i.m11*s+i.m15*a,t},e.transformAffine=function(t,e,i){var r=e.x,n=e.y,s=e.z,a=e.w;return t.x=i.m00*r+i.m01*n+i.m02*s+i.m03*a,t.y=i.m04*r+i.m05*n+i.m06*s+i.m07*a,t.x=i.m08*r+i.m09*n+i.m10*s+i.m11*a,t.w=e.w,t},e.transformQuat=function(t,e,i){var r=e.x,n=e.y,s=e.z,a=i.x,o=i.y,h=i.z,l=i.w,u=l*r+o*s-h*n,c=l*n+h*r-a*s,_=l*s+a*n-o*r,d=-a*r-o*n-h*s;return t.x=u*l+d*-a+c*-h-_*-o,t.y=c*l+d*-o+_*-a-u*-h,t.z=_*l+d*-h+u*-o-c*-a,t.w=e.w,t},e.toArray=function(t,e,i){return void 0===i&&(i=0),t[i+0]=e.x,t[i+1]=e.y,t[i+2]=e.z,t[i+3]=e.w,t},e.fromArray=function(t,e,i){return void 0===i&&(i=0),t.x=e[i+0],t.y=e[i+1],t.z=e[i+2],t.w=e[i+3],t},e.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w},e.equals=function(t,e,i){return void 0===i&&(i=Rr),Math.abs(t.x-e.x)<=i*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=i*Math.max(1,Math.abs(t.y),Math.abs(e.y))&&Math.abs(t.z-e.z)<=i*Math.max(1,Math.abs(t.z),Math.abs(e.z))&&Math.abs(t.w-e.w)<=i*Math.max(1,Math.abs(t.w),Math.abs(e.w))};var i=e.prototype;return i.clone=function(){return new e(this.x,this.y,this.z,this.w)},i.set=function(t,e,i,r){return t&&"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=r||0),this},i.equals=function(t,e){return void 0===e&&(e=Rr),Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))&&Math.abs(this.z-t.z)<=e*Math.max(1,Math.abs(this.z),Math.abs(t.z))&&Math.abs(this.w-t.w)<=e*Math.max(1,Math.abs(this.w),Math.abs(t.w))},i.equals4f=function(t,e,i,r,n){return void 0===n&&(n=Rr),Math.abs(this.x-t)<=n*Math.max(1,Math.abs(this.x),Math.abs(t))&&Math.abs(this.y-e)<=n*Math.max(1,Math.abs(this.y),Math.abs(e))&&Math.abs(this.z-i)<=n*Math.max(1,Math.abs(this.z),Math.abs(i))&&Math.abs(this.w-r)<=n*Math.max(1,Math.abs(this.w),Math.abs(r))},i.strictEquals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},i.strictEquals4f=function(t,e,i,r){return this.x===t&&this.y===e&&this.z===i&&this.w===r},i.lerp=function(t,e){var i=this.x,r=this.y,n=this.z,s=this.w;return this.x=i+e*(t.x-i),this.y=r+e*(t.y-r),this.z=n+e*(t.z-n),this.w=s+e*(t.w-s),this},i.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+", "+this.w.toFixed(2)+")"},i.clampf=function(t,e){return this.x=Ir(this.x,t.x,e.x),this.y=Ir(this.y,t.y,e.y),this.z=Ir(this.z,t.z,e.z),this.w=Ir(this.w,t.w,e.w),this},i.add=function(t){return this.x=this.x+t.x,this.y=this.y+t.y,this.z=this.z+t.z,this.w=this.w+t.w,this},i.add4f=function(t,e,i,r){return this.x=this.x+t,this.y=this.y+e,this.z=this.z+i,this.w=this.w+r,this},i.subtract=function(t){return this.x=this.x-t.x,this.y=this.y-t.y,this.z=this.z-t.z,this.w=this.w-t.w,this},i.subtract4f=function(t,e,i,r){return this.x=this.x-t,this.y=this.y-e,this.z=this.z-i,this.w=this.w-r,this},i.multiplyScalar=function(t){return"object"==typeof t&&console.warn("should use Vec4.multiply for vector * vector operation"),this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this.w=this.w*t,this},i.multiply=function(t){return"object"!=typeof t&&console.warn("should use Vec4.scale for vector * scalar operation"),this.x=this.x*t.x,this.y=this.y*t.y,this.z=this.z*t.z,this.w=this.w*t.w,this},i.multiply4f=function(t,e,i,r){return this.x=this.x*t,this.y=this.y*e,this.z=this.z*i,this.w=this.w*r,this},i.divide=function(t){return this.x=this.x/t.x,this.y=this.y/t.y,this.z=this.z/t.z,this.w=this.w/t.w,this},i.divide4f=function(t,e,i,r){return this.x=this.x/t,this.y=this.y/e,this.z=this.z/i,this.w=this.w/r,this},i.negative=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},i.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},i.cross=function(t){var e=this.x,i=this.y,r=this.z,n=t.x,s=t.y,a=t.z;return this.x=i*a-r*s,this.y=r*n-e*a,this.z=e*s-i*n,this},i.length=function(){var t=this.x,e=this.y,i=this.z,r=this.w;return Math.sqrt(t*t+e*e+i*i+r*r)},i.lengthSqr=function(){var t=this.x,e=this.y,i=this.z,r=this.w;return t*t+e*e+i*i+r*r},i.normalize=function(){var t=this.x,e=this.y,i=this.z,r=this.w,n=t*t+e*e+i*i+r*r;return n>0&&(n=1/Math.sqrt(n),this.x=t*n,this.y=e*n,this.z=i*n,this.w=r*n),this},i.transformMat4=function(t){var e=this.x,i=this.y,r=this.z,n=this.w;return this.x=t.m00*e+t.m04*i+t.m08*r+t.m12*n,this.y=t.m01*e+t.m05*i+t.m09*r+t.m13*n,this.z=t.m02*e+t.m06*i+t.m10*r+t.m14*n,this.w=t.m03*e+t.m07*i+t.m11*r+t.m15*n,this},e}(Dt));function Is(t,e,i,r){return new Os(t,e,i,r)}Os.ZERO=Object.freeze(new Os(0,0,0,0)),Os.ONE=Object.freeze(new Os(1,1,1,1)),Os.NEG_ONE=Object.freeze(new Os(-1,-1,-1,-1)),Ae.fastDefine("cc.Vec4",Os,{x:0,y:0,z:0,w:0}),_.Vec4=Os,_.v4=Is;var Ms=t("Mat3",function(t){function e(e,i,r,n,s,a,o,h,l){var u;return void 0===e&&(e=1),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===s&&(s=1),void 0===a&&(a=0),void 0===o&&(o=0),void 0===h&&(h=0),void 0===l&&(l=1),u=t.call(this)||this,"object"==typeof e?(u.m00=e.m00,u.m01=e.m01,u.m02=e.m02,u.m03=e.m03,u.m04=e.m04,u.m05=e.m05,u.m06=e.m06,u.m07=e.m07,u.m08=e.m08):(u.m00=e,u.m01=i,u.m02=r,u.m03=n,u.m04=s,u.m05=a,u.m06=o,u.m07=h,u.m08=l),u}s(e,t),e.clone=function(t){return new e(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08)},e.copy=function(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t},e.set=function(t,e,i,r,n,s,a,o,h,l){return t.m00=e,t.m01=i,t.m02=r,t.m03=n,t.m04=s,t.m05=a,t.m06=o,t.m07=h,t.m08=l,t},e.identity=function(t){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=1,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t},e.transpose=function(t,e){if(t===e){var i=e.m01,r=e.m02,n=e.m05;t.m01=e.m03,t.m02=e.m06,t.m03=i,t.m05=e.m07,t.m06=r,t.m07=n}else t.m00=e.m00,t.m01=e.m03,t.m02=e.m06,t.m03=e.m01,t.m04=e.m04,t.m05=e.m07,t.m06=e.m02,t.m07=e.m05,t.m08=e.m08;return t},e.invert=function(t,e){var i=e.m00,r=e.m01,n=e.m02,s=e.m03,a=e.m04,o=e.m05,h=e.m06,l=e.m07,u=e.m08,c=u*a-o*l,_=-u*s+o*h,d=l*s-a*h,p=i*c+r*_+n*d;return 0===p?(t.m00=0,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=0,t.m06=0,t.m07=0,t.m08=0,t):(p=1/p,t.m00=c*p,t.m01=(-u*r+n*l)*p,t.m02=(o*r-n*a)*p,t.m03=_*p,t.m04=(u*i-n*h)*p,t.m05=(-o*i+n*s)*p,t.m06=d*p,t.m07=(-l*i+r*h)*p,t.m08=(a*i-r*s)*p,t)},e.determinant=function(t){var e=t.m00,i=t.m01,r=t.m02,n=t.m03,s=t.m04,a=t.m05,o=t.m06,h=t.m07,l=t.m08;return e*(l*s-a*h)+i*(-l*n+a*o)+r*(h*n-s*o)},e.multiply=function(t,e,i){var r=e.m00,n=e.m01,s=e.m02,a=e.m03,o=e.m04,h=e.m05,l=e.m06,u=e.m07,c=e.m08,_=i.m00,d=i.m01,p=i.m02,f=i.m03,m=i.m04,g=i.m05,v=i.m06,y=i.m07,T=i.m08;return t.m00=_*r+d*a+p*l,t.m01=_*n+d*o+p*u,t.m02=_*s+d*h+p*c,t.m03=f*r+m*a+g*l,t.m04=f*n+m*o+g*u,t.m05=f*s+m*h+g*c,t.m06=v*r+y*a+T*l,t.m07=v*n+y*o+T*u,t.m08=v*s+y*h+T*c,t},e.multiplyMat4=function(t,e,i){var r=e.m00,n=e.m01,s=e.m02,a=e.m03,o=e.m04,h=e.m05,l=e.m06,u=e.m07,c=e.m08,_=i.m00,d=i.m01,p=i.m02,f=i.m04,m=i.m05,g=i.m06,v=i.m08,y=i.m09,T=i.m10;return t.m00=_*r+d*a+p*l,t.m01=_*n+d*o+p*u,t.m02=_*s+d*h+p*c,t.m03=f*r+m*a+g*l,t.m04=f*n+m*o+g*u,t.m05=f*s+m*h+g*c,t.m06=v*r+y*a+T*l,t.m07=v*n+y*o+T*u,t.m08=v*s+y*h+T*c,t},e.transform=function(t,e,i){var r=e.m00,n=e.m01,s=e.m02,a=e.m03,o=e.m04,h=e.m05,l=e.m06,u=e.m07,c=e.m08,_=i.x,d=i.y;return t.m00=r,t.m01=n,t.m02=s,t.m03=a,t.m04=o,t.m05=h,t.m06=_*r+d*a+l,t.m07=_*n+d*o+u,t.m08=_*s+d*h+c,t},e.scale=function(t,e,i){var r=i.x,n=i.y;return t.m00=r*e.m00,t.m01=r*e.m01,t.m02=r*e.m02,t.m03=n*e.m03,t.m04=n*e.m04,t.m05=n*e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t},e.rotate=function(t,e,i){var r=e.m00,n=e.m01,s=e.m02,a=e.m03,o=e.m04,h=e.m05,l=e.m06,u=e.m07,c=e.m08,_=Math.sin(i),d=Math.cos(i);return t.m00=d*r+_*a,t.m01=d*n+_*o,t.m02=d*s+_*h,t.m03=d*a-_*r,t.m04=d*o-_*n,t.m05=d*h-_*s,t.m06=l,t.m07=u,t.m08=c,t},e.fromMat4=function(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m04,t.m04=e.m05,t.m05=e.m06,t.m06=e.m08,t.m07=e.m09,t.m08=e.m10,t},e.fromViewUp=function(t,i,r){return Cs.lengthSqr(i)<Rr*Rr?(e.identity(t),t):(r=r||Cs.UNIT_Y,Cs.normalize(Bs,Cs.cross(Bs,r,i)),Cs.lengthSqr(Bs)<Rr*Rr?(e.identity(t),t):(Cs.cross(Ps,i,Bs),e.set(t,Bs.x,Bs.y,Bs.z,Ps.x,Ps.y,Ps.z,i.x,i.y,i.z),t))},e.fromTranslation=function(t,e){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=1,t.m05=0,t.m06=e.x,t.m07=e.y,t.m08=1,t},e.fromScaling=function(t,e){return t.m00=e.x,t.m01=0,t.m02=0,t.m03=0,t.m04=e.y,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t},e.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t.m00=r,t.m01=i,t.m02=0,t.m03=-i,t.m04=r,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t},e.fromQuat=function(t,e){var i=e.x,r=e.y,n=e.z,s=e.w,a=i+i,o=r+r,h=n+n,l=i*a,u=r*a,c=r*o,_=n*a,d=n*o,p=n*h,f=s*a,m=s*o,g=s*h;return t.m00=1-c-p,t.m03=u-g,t.m06=_+m,t.m01=u+g,t.m04=1-l-p,t.m07=d-f,t.m02=_-m,t.m05=d+f,t.m08=1-l-c,t},e.inverseTransposeMat4=function(t,e){var i=e.m00,r=e.m01,n=e.m02,s=e.m03,a=e.m04,o=e.m05,h=e.m06,l=e.m07,u=e.m08,c=e.m09,_=e.m10,d=e.m11,p=e.m12,f=e.m13,m=e.m14,g=e.m15,v=i*o-r*a,y=i*h-n*a,T=i*l-s*a,E=r*h-n*o,S=r*l-s*o,b=n*l-s*h,A=u*f-c*p,C=u*m-_*p,w=u*g-d*p,R=c*m-_*f,x=c*g-d*f,O=_*g-d*m,I=v*O-y*x+T*R+E*w-S*C+b*A;return I?(I=1/I,t.m00=(o*O-h*x+l*R)*I,t.m01=(h*w-a*O-l*C)*I,t.m02=(a*x-o*w+l*A)*I,t.m03=(n*x-r*O-s*R)*I,t.m04=(i*O-n*w+s*C)*I,t.m05=(r*w-i*x-s*A)*I,t.m06=(f*b-m*S+g*E)*I,t.m07=(m*T-p*b-g*y)*I,t.m08=(p*S-f*T+g*v)*I,t):null},e.toArray=function(t,e,i){return void 0===i&&(i=0),t[i+0]=e.m00,t[i+1]=e.m01,t[i+2]=e.m02,t[i+3]=e.m03,t[i+4]=e.m04,t[i+5]=e.m05,t[i+6]=e.m06,t[i+7]=e.m07,t[i+8]=e.m08,t},e.fromArray=function(t,e,i){return void 0===i&&(i=0),t.m00=e[i+0],t.m01=e[i+1],t.m02=e[i+2],t.m03=e[i+3],t.m04=e[i+4],t.m05=e[i+5],t.m06=e[i+6],t.m07=e[i+7],t.m08=e[i+8],t},e.add=function(t,e,i){return t.m00=e.m00+i.m00,t.m01=e.m01+i.m01,t.m02=e.m02+i.m02,t.m03=e.m03+i.m03,t.m04=e.m04+i.m04,t.m05=e.m05+i.m05,t.m06=e.m06+i.m06,t.m07=e.m07+i.m07,t.m08=e.m08+i.m08,t},e.subtract=function(t,e,i){return t.m00=e.m00-i.m00,t.m01=e.m01-i.m01,t.m02=e.m02-i.m02,t.m03=e.m03-i.m03,t.m04=e.m04-i.m04,t.m05=e.m05-i.m05,t.m06=e.m06-i.m06,t.m07=e.m07-i.m07,t.m08=e.m08-i.m08,t},e.multiplyScalar=function(t,e,i){return t.m00=e.m00*i,t.m01=e.m01*i,t.m02=e.m02*i,t.m03=e.m03*i,t.m04=e.m04*i,t.m05=e.m05*i,t.m06=e.m06*i,t.m07=e.m07*i,t.m08=e.m08*i,t},e.multiplyScalarAndAdd=function(t,e,i,r){return t.m00=i.m00*r+e.m00,t.m01=i.m01*r+e.m01,t.m02=i.m02*r+e.m02,t.m03=i.m03*r+e.m03,t.m04=i.m04*r+e.m04,t.m05=i.m05*r+e.m05,t.m06=i.m06*r+e.m06,t.m07=i.m07*r+e.m07,t.m08=i.m08*r+e.m08,t},e.strictEquals=function(t,e){return t.m00===e.m00&&t.m01===e.m01&&t.m02===e.m02&&t.m03===e.m03&&t.m04===e.m04&&t.m05===e.m05&&t.m06===e.m06&&t.m07===e.m07&&t.m08===e.m08},e.equals=function(t,e,i){return void 0===i&&(i=Rr),Math.abs(t.m00-e.m00)<=i*Math.max(1,Math.abs(t.m00),Math.abs(e.m00))&&Math.abs(t.m01-e.m01)<=i*Math.max(1,Math.abs(t.m01),Math.abs(e.m01))&&Math.abs(t.m02-e.m02)<=i*Math.max(1,Math.abs(t.m02),Math.abs(e.m02))&&Math.abs(t.m03-e.m03)<=i*Math.max(1,Math.abs(t.m03),Math.abs(e.m03))&&Math.abs(t.m04-e.m04)<=i*Math.max(1,Math.abs(t.m04),Math.abs(e.m04))&&Math.abs(t.m05-e.m05)<=i*Math.max(1,Math.abs(t.m05),Math.abs(e.m05))&&Math.abs(t.m06-e.m06)<=i*Math.max(1,Math.abs(t.m06),Math.abs(e.m06))&&Math.abs(t.m07-e.m07)<=i*Math.max(1,Math.abs(t.m07),Math.abs(e.m07))&&Math.abs(t.m08-e.m08)<=i*Math.max(1,Math.abs(t.m08),Math.abs(e.m08))};var i=e.prototype;return i.clone=function(){var t=this;return new e(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08)},i.set=function(t,e,i,r,n,s,a,o,h){return void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=1),void 0===s&&(s=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===h&&(h=1),"object"==typeof t?(this.m00=t.m00,this.m01=t.m01,this.m02=t.m02,this.m03=t.m03,this.m04=t.m04,this.m05=t.m05,this.m06=t.m06,this.m07=t.m07,this.m08=t.m08):(this.m00=t,this.m01=e,this.m02=i,this.m03=r,this.m04=n,this.m05=s,this.m06=a,this.m07=o,this.m08=h),this},i.equals=function(t,e){return void 0===e&&(e=Rr),Math.abs(this.m00-t.m00)<=e*Math.max(1,Math.abs(this.m00),Math.abs(t.m00))&&Math.abs(this.m01-t.m01)<=e*Math.max(1,Math.abs(this.m01),Math.abs(t.m01))&&Math.abs(this.m02-t.m02)<=e*Math.max(1,Math.abs(this.m02),Math.abs(t.m02))&&Math.abs(this.m03-t.m03)<=e*Math.max(1,Math.abs(this.m03),Math.abs(t.m03))&&Math.abs(this.m04-t.m04)<=e*Math.max(1,Math.abs(this.m04),Math.abs(t.m04))&&Math.abs(this.m05-t.m05)<=e*Math.max(1,Math.abs(this.m05),Math.abs(t.m05))&&Math.abs(this.m06-t.m06)<=e*Math.max(1,Math.abs(this.m06),Math.abs(t.m06))&&Math.abs(this.m07-t.m07)<=e*Math.max(1,Math.abs(this.m07),Math.abs(t.m07))&&Math.abs(this.m08-t.m08)<=e*Math.max(1,Math.abs(this.m08),Math.abs(t.m08))},i.strictEquals=function(t){return this.m00===t.m00&&this.m01===t.m01&&this.m02===t.m02&&this.m03===t.m03&&this.m04===t.m04&&this.m05===t.m05&&this.m06===t.m06&&this.m07===t.m07&&this.m08===t.m08},i.toString=function(){var t=this;return"[\n"+t.m00+", "+t.m01+", "+t.m02+",\n"+t.m03+",\n"+t.m04+", "+t.m05+",\n"+t.m06+", "+t.m07+",\n"+t.m08+"\n]"},i.identity=function(){return this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m04=1,this.m05=0,this.m06=0,this.m07=0,this.m08=1,this},i.transpose=function(){var t=this.m01,e=this.m02,i=this.m05;return this.m01=this.m03,this.m02=this.m06,this.m03=t,this.m05=this.m07,this.m06=e,this.m07=i,this},i.invert=function(){var t=this.m00,e=this.m01,i=this.m02,r=this.m03,n=this.m04,s=this.m05,a=this.m06,o=this.m07,h=this.m08,l=h*n-s*o,u=-h*r+s*a,c=o*r-n*a,_=t*l+e*u+i*c;return 0===_?(this.set(0,0,0,0,0,0,0,0,0),this):(_=1/_,this.m00=l*_,this.m01=(-h*e+i*o)*_,this.m02=(s*e-i*n)*_,this.m03=u*_,this.m04=(h*t-i*a)*_,this.m05=(-s*t+i*r)*_,this.m06=c*_,this.m07=(-o*t+e*a)*_,this.m08=(n*t-e*r)*_,this)},i.determinant=function(){var t=this.m00,e=this.m01,i=this.m02,r=this.m03,n=this.m04,s=this.m05,a=this.m06,o=this.m07,h=this.m08;return t*(h*n-s*o)+e*(-h*r+s*a)+i*(o*r-n*a)},i.add=function(t){return this.m00=this.m00+t.m00,this.m01=this.m01+t.m01,this.m02=this.m02+t.m02,this.m03=this.m03+t.m03,this.m04=this.m04+t.m04,this.m05=this.m05+t.m05,this.m06=this.m06+t.m06,this.m07=this.m07+t.m07,this.m08=this.m08+t.m08,this},i.subtract=function(t){return this.m00=this.m00-t.m00,this.m01=this.m01-t.m01,this.m02=this.m02-t.m02,this.m03=this.m03-t.m03,this.m04=this.m04-t.m04,this.m05=this.m05-t.m05,this.m06=this.m06-t.m06,this.m07=this.m07-t.m07,this.m08=this.m08-t.m08,this},i.multiply=function(t){var e=this.m00,i=this.m01,r=this.m02,n=this.m03,s=this.m04,a=this.m05,o=this.m06,h=this.m07,l=this.m08,u=t.m00,c=t.m01,_=t.m02,d=t.m03,p=t.m04,f=t.m05,m=t.m06,g=t.m07,v=t.m08;return this.m00=u*e+c*n+_*o,this.m01=u*i+c*s+_*h,this.m02=u*r+c*a+_*l,this.m03=d*e+p*n+f*o,this.m04=d*i+p*s+f*h,this.m05=d*r+p*a+f*l,this.m06=m*e+g*n+v*o,this.m07=m*i+g*s+v*h,this.m08=m*r+g*a+v*l,this},i.multiplyScalar=function(t){return this.m00=this.m00*t,this.m01=this.m01*t,this.m02=this.m02*t,this.m03=this.m03*t,this.m04=this.m04*t,this.m05=this.m05*t,this.m06=this.m06*t,this.m07=this.m07*t,this.m08=this.m08*t,this},i.scale=function(t){var e=t.x,i=t.y;return this.m00=e*this.m00,this.m01=e*this.m01,this.m02=e*this.m02,this.m03=i*this.m03,this.m04=i*this.m04,this.m05=i*this.m05,this.m06=this.m06,this.m07=this.m07,this.m08=this.m08,this},i.rotate=function(t){var e=this.m00,i=this.m01,r=this.m02,n=this.m03,s=this.m04,a=this.m05,o=this.m06,h=this.m07,l=this.m08,u=Math.sin(t),c=Math.cos(t);return this.m00=c*e+u*n,this.m01=c*i+u*s,this.m02=c*r+u*a,this.m03=c*n-u*e,this.m04=c*s-u*i,this.m05=c*a-u*r,this.m06=o,this.m07=h,this.m08=l,this},i.fromQuat=function(t){var e=t.x,i=t.y,r=t.z,n=t.w,s=e+e,a=i+i,o=r+r,h=e*s,l=i*s,u=i*a,c=r*s,_=r*a,d=r*o,p=n*s,f=n*a,m=n*o;return this.m00=1-u-d,this.m03=l-m,this.m06=c+f,this.m01=l+m,this.m04=1-h-d,this.m07=_-p,this.m02=c-f,this.m05=_+p,this.m08=1-h-u,this},e}(Dt));Ms.IDENTITY=Object.freeze(new Ms);var Bs=new Cs,Ps=new Cs;Ae.fastDefine("cc.Mat3",Ms,{m00:1,m01:0,m02:0,m03:0,m04:1,m05:0,m06:0,m07:0,m08:1}),_.Mat3=Ms;var Ns=t("Quat",function(t){function e(e,i,r,n){var s;return s=t.call(this)||this,e&&"object"==typeof e?(s.x=e.x,s.y=e.y,s.z=e.z,s.w=e.w):(s.x=e||0,s.y=i||0,s.z=r||0,s.w=null!=n?n:1),s}s(e,t),e.clone=function(t){return new e(t.x,t.y,t.z,t.w)},e.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t},e.set=function(t,e,i,r,n){return t.x=e,t.y=i,t.z=r,t.w=n,t},e.identity=function(t){return t.x=0,t.y=0,t.z=0,t.w=1,t},e.rotationTo=function(t,i,r){var n=Cs.dot(i,r);return n<-.999999?(Cs.cross(Ds,Cs.UNIT_X,i),Ds.length()<1e-6&&Cs.cross(Ds,Cs.UNIT_Y,i),Cs.normalize(Ds,Ds),e.fromAxisAngle(t,Ds,Math.PI),t):n>.999999?(t.x=0,t.y=0,t.z=0,t.w=1,t):(Cs.cross(Ds,i,r),t.x=Ds.x,t.y=Ds.y,t.z=Ds.z,t.w=1+n,e.normalize(t,t))},e.getAxisAngle=function(t,e){var i=2*Math.acos(e.w),r=Math.sin(i/2);return 0!==r?(t.x=e.x/r,t.y=e.y/r,t.z=e.z/r):(t.x=1,t.y=0,t.z=0),i},e.multiply=function(t,e,i){var r=e.x*i.w+e.w*i.x+e.y*i.z-e.z*i.y,n=e.y*i.w+e.w*i.y+e.z*i.x-e.x*i.z,s=e.z*i.w+e.w*i.z+e.x*i.y-e.y*i.x,a=e.w*i.w-e.x*i.x-e.y*i.y-e.z*i.z;return t.x=r,t.y=n,t.z=s,t.w=a,t},e.multiplyScalar=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t.w=e.w*i,t},e.scaleAndAdd=function(t,e,i,r){return t.x=e.x+i.x*r,t.y=e.y+i.y*r,t.z=e.z+i.z*r,t.w=e.w+i.w*r,t},e.rotateX=function(t,e,i){i*=.5;var r=Math.sin(i),n=Math.cos(i),s=e.x,a=e.y,o=e.z,h=e.w;return t.x=s*n+h*r,t.y=a*n+o*r,t.z=o*n-a*r,t.w=h*n-s*r,t},e.rotateY=function(t,e,i){i*=.5;var r=Math.sin(i),n=Math.cos(i),s=e.x,a=e.y,o=e.z,h=e.w;return t.x=s*n-o*r,t.y=a*n+h*r,t.z=o*n+s*r,t.w=h*n-a*r,t},e.rotateZ=function(t,e,i){i*=.5;var r=Math.sin(i),n=Math.cos(i),s=e.x,a=e.y,o=e.z,h=e.w;return t.x=s*n+a*r,t.y=a*n-s*r,t.z=o*n+h*r,t.w=h*n-o*r,t},e.rotateAround=function(t,i,r,n){return e.invert(Ls,i),Cs.transformQuat(Ds,r,Ls),e.fromAxisAngle(Ls,Ds,n),e.multiply(t,i,Ls),t},e.rotateAroundLocal=function(t,i,r,n){return e.fromAxisAngle(Ls,r,n),e.multiply(t,i,Ls),t},e.calculateW=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=Math.sqrt(Math.abs(1-e.x*e.x-e.y*e.y-e.z*e.z)),t},e.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},e.lerp=function(t,e,i,r){return t.x=e.x+r*(i.x-e.x),t.y=e.y+r*(i.y-e.y),t.z=e.z+r*(i.z-e.z),t.w=e.w+r*(i.w-e.w),t},e.slerp=function(t,e,i,r){var n=0,s=0,a=i.x,o=i.y,h=i.z,l=i.w,u=e.x*i.x+e.y*i.y+e.z*i.z+e.w*i.w;if(u<0&&(u=-u,a=-a,o=-o,h=-h,l=-l),1-u>1e-6){var c=Math.acos(u),_=Math.sin(c);n=Math.sin((1-r)*c)/_,s=Math.sin(r*c)/_}else n=1-r,s=r;return t.x=n*e.x+s*a,t.y=n*e.y+s*o,t.z=n*e.z+s*h,t.w=n*e.w+s*l,t},e.sqlerp=function(t,i,r,n,s,a){return e.slerp(Ls,i,s,a),e.slerp(Fs,r,n,a),e.slerp(t,Ls,Fs,2*a*(1-a)),t},e.invert=function(t,e){var i=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w,r=i?1/i:0;return t.x=-e.x*r,t.y=-e.y*r,t.z=-e.z*r,t.w=e.w*r,t},e.conjugate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=e.w,t},e.len=function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w)},e.lengthSqr=function(t){return t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w},e.normalize=function(t,e){var i=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w;return i>0&&(i=1/Math.sqrt(i),t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t.w=e.w*i),t},e.fromAxes=function(t,i,r,n){return Ms.set(Us,i.x,i.y,i.z,r.x,r.y,r.z,n.x,n.y,n.z),e.normalize(t,e.fromMat3(t,Us))},e.fromViewUp=function(t,i,r){return Ms.fromViewUp(Us,i,r),e.normalize(t,e.fromMat3(t,Us))},e.fromAxisAngle=function(t,e,i){i*=.5;var r=Math.sin(i);return t.x=r*e.x,t.y=r*e.y,t.z=r*e.z,t.w=Math.cos(i),t},e.fromMat3=function(t,e){var i=e.m00,r=e.m03,n=e.m06,s=e.m01,a=e.m04,o=e.m07,h=e.m02,l=e.m05,u=e.m08,c=i+a+u;if(c>0){var _=.5/Math.sqrt(c+1);t.w=.25/_,t.x=(l-o)*_,t.y=(n-h)*_,t.z=(s-r)*_}else if(i>a&&i>u){var d=2*Math.sqrt(1+i-a-u);t.w=(l-o)/d,t.x=.25*d,t.y=(r+s)/d,t.z=(n+h)/d}else if(a>u){var p=2*Math.sqrt(1+a-i-u);t.w=(n-h)/p,t.x=(r+s)/p,t.y=.25*p,t.z=(o+l)/p}else{var f=2*Math.sqrt(1+u-i-a);t.w=(s-r)/f,t.x=(n+h)/f,t.y=(o+l)/f,t.z=.25*f}return t},e.fromEuler=function(t,e,i,r){e*=ks,i*=ks,r*=ks;var n=Math.sin(e),s=Math.cos(e),a=Math.sin(i),o=Math.cos(i),h=Math.sin(r),l=Math.cos(r);return t.x=n*o*l+s*a*h,t.y=s*a*l+n*o*h,t.z=s*o*h-n*a*l,t.w=s*o*l-n*a*h,t},e.fromAngleZ=function(t,e){return e*=ks,t.x=t.y=0,t.z=Math.sin(e),t.w=Math.cos(e),t},e.toAxisX=function(t,e){var i=2*e.y,r=2*e.z;return t.x=1-i*e.y-r*e.z,t.y=i*e.x+r*e.w,t.z=r*e.x+i*e.w,t},e.toAxisY=function(t,e){var i=2*e.x,r=2*e.y,n=2*e.z;return t.x=r*e.x-n*e.w,t.y=1-i*e.x-n*e.z,t.z=n*e.y+i*e.w,t},e.toAxisZ=function(t,e){var i=2*e.x,r=2*e.y,n=2*e.z;return t.x=n*e.x-r*e.w,t.y=n*e.y-i*e.w,t.z=1-i*e.x-r*e.y,t},e.toEuler=function(t,e,i){var r=e.x,n=e.y,s=e.z,a=e.w,o=0,h=0,l=0,u=r*n+s*a;if(u>.499999)o=0,h=Nr(2*Math.atan2(r,a)),l=90;else if(u<-.499999)o=0,h=-Nr(2*Math.atan2(r,a)),l=-90;else{var c=r*r,_=n*n,d=s*s;o=Nr(Math.atan2(2*r*a-2*n*s,1-2*c-2*d)),h=Nr(Math.atan2(2*n*a-2*r*s,1-2*_-2*d)),l=Nr(Math.asin(2*u)),i&&(o=-180*Math.sign(o+1e-6)+o,h=-180*Math.sign(h+1e-6)+h,l=180*Math.sign(l+1e-6)-l)}return t.x=o,t.y=h,t.z=l,t},e.toArray=function(t,e,i){return void 0===i&&(i=0),t[i+0]=e.x,t[i+1]=e.y,t[i+2]=e.z,t[i+3]=e.w,t},e.fromArray=function(t,e,i){return void 0===i&&(i=0),t.x=e[i+0],t.y=e[i+1],t.z=e[i+2],t.w=e[i+3],t},e.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w},e.equals=function(t,e,i){return void 0===i&&(i=Rr),Math.abs(t.x-e.x)<=i*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=i*Math.max(1,Math.abs(t.y),Math.abs(e.y))&&Math.abs(t.z-e.z)<=i*Math.max(1,Math.abs(t.z),Math.abs(e.z))&&Math.abs(t.w-e.w)<=i*Math.max(1,Math.abs(t.w),Math.abs(e.w))};var i=e.prototype;return i.clone=function(){return new e(this.x,this.y,this.z,this.w)},i.set=function(t,e,i,r){return t&&"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=null!=r?r:1),this},i.equals=function(t,e){return void 0===e&&(e=Rr),Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))&&Math.abs(this.z-t.z)<=e*Math.max(1,Math.abs(this.z),Math.abs(t.z))&&Math.abs(this.w-t.w)<=e*Math.max(1,Math.abs(this.w),Math.abs(t.w))},i.strictEquals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},i.getEulerAngles=function(t){return e.toEuler(t,this)},i.lerp=function(t,e){return this.x=this.x+e*(t.x-this.x),this.y=this.y+e*(t.y-this.y),this.z=this.z+e*(t.z-this.z),this.w=this.w+e*(t.w-this.w),this},i.slerp=function(t,i){return e.slerp(this,this,t,i)},i.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},i.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},e}(Dt));Ns.IDENTITY=Object.freeze(new Ns);var Ls=new Ns,Fs=new Ns,Ds=new Cs,Us=new Ms,ks=.5*Math.PI/180;function zs(t,e,i,r){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),new Ns(t,e,i,r)}Ae.fastDefine("cc.Quat",Ns,{x:0,y:0,z:0,w:1}),_.Quat=Ns,_.quat=zs;var Gs=Object.freeze([Object.freeze([1,0,0,1]),Object.freeze([0,1,-1,0]),Object.freeze([-1,0,0,-1]),Object.freeze([0,-1,1,0])]),Hs=t("Mat4",function(t){function e(e,i,r,n,s,a,o,h,l,u,c,_,d,p,f,m){var g;return void 0===e&&(e=1),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===a&&(a=1),void 0===o&&(o=0),void 0===h&&(h=0),void 0===l&&(l=0),void 0===u&&(u=0),void 0===c&&(c=1),void 0===_&&(_=0),void 0===d&&(d=0),void 0===p&&(p=0),void 0===f&&(f=0),void 0===m&&(m=1),(g=t.call(this)||this).m00=void 0,g.m01=void 0,g.m02=void 0,g.m03=void 0,g.m04=void 0,g.m05=void 0,g.m06=void 0,g.m07=void 0,g.m08=void 0,g.m09=void 0,g.m10=void 0,g.m11=void 0,g.m12=void 0,g.m13=void 0,g.m14=void 0,g.m15=void 0,"object"==typeof e?(g.m00=e.m00,g.m01=e.m01,g.m02=e.m02,g.m03=e.m03,g.m04=e.m04,g.m05=e.m05,g.m06=e.m06,g.m07=e.m07,g.m08=e.m08,g.m09=e.m09,g.m10=e.m10,g.m11=e.m11,g.m12=e.m12,g.m13=e.m13,g.m14=e.m14,g.m15=e.m15):(g.m00=e,g.m01=i,g.m02=r,g.m03=n,g.m04=s,g.m05=a,g.m06=o,g.m07=h,g.m08=l,g.m09=u,g.m10=c,g.m11=_,g.m12=d,g.m13=p,g.m14=f,g.m15=m),g}s(e,t),e.clone=function(t){return new e(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08,t.m09,t.m10,t.m11,t.m12,t.m13,t.m14,t.m15)},e.copy=function(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t.m09=e.m09,t.m10=e.m10,t.m11=e.m11,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15,t},e.set=function(t,e,i,r,n,s,a,o,h,l,u,c,_,d,p,f,m){return t.m00=e,t.m01=i,t.m02=r,t.m03=n,t.m04=s,t.m05=a,t.m06=o,t.m07=h,t.m08=l,t.m09=u,t.m10=c,t.m11=_,t.m12=d,t.m13=p,t.m14=f,t.m15=m,t},e.identity=function(t){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=1,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=1,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.transpose=function(t,e){if(t===e){var i=e.m01,r=e.m02,n=e.m03,s=e.m06,a=e.m07,o=e.m11;t.m01=e.m04,t.m02=e.m08,t.m03=e.m12,t.m04=i,t.m06=e.m09,t.m07=e.m13,t.m08=r,t.m09=s,t.m11=e.m14,t.m12=n,t.m13=a,t.m14=o}else t.m00=e.m00,t.m01=e.m04,t.m02=e.m08,t.m03=e.m12,t.m04=e.m01,t.m05=e.m05,t.m06=e.m09,t.m07=e.m13,t.m08=e.m02,t.m09=e.m06,t.m10=e.m10,t.m11=e.m14,t.m12=e.m03,t.m13=e.m07,t.m14=e.m11,t.m15=e.m15;return t},e.invert=function(t,e){var i=e.m00,r=e.m01,n=e.m02,s=e.m03,a=e.m04,o=e.m05,h=e.m06,l=e.m07,u=e.m08,c=e.m09,_=e.m10,d=e.m11,p=e.m12,f=e.m13,m=e.m14,g=e.m15,v=i*o-r*a,y=i*h-n*a,T=i*l-s*a,E=r*h-n*o,S=r*l-s*o,b=n*l-s*h,A=u*f-c*p,C=u*m-_*p,w=u*g-d*p,R=c*m-_*f,x=c*g-d*f,O=_*g-d*m,I=v*O-y*x+T*R+E*w-S*C+b*A;return 0===I?(t.m00=0,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=0,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=0,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=0,t):(I=1/I,t.m00=(o*O-h*x+l*R)*I,t.m01=(n*x-r*O-s*R)*I,t.m02=(f*b-m*S+g*E)*I,t.m03=(_*S-c*b-d*E)*I,t.m04=(h*w-a*O-l*C)*I,t.m05=(i*O-n*w+s*C)*I,t.m06=(m*T-p*b-g*y)*I,t.m07=(u*b-_*T+d*y)*I,t.m08=(a*x-o*w+l*A)*I,t.m09=(r*w-i*x-s*A)*I,t.m10=(p*S-f*T+g*v)*I,t.m11=(c*T-u*S-d*v)*I,t.m12=(o*C-a*R-h*A)*I,t.m13=(i*R-r*C+n*A)*I,t.m14=(f*y-p*E-m*v)*I,t.m15=(u*E-c*y+_*v)*I,t)},e.determinant=function(t){var e=t.m00,i=t.m01,r=t.m02,n=t.m03,s=t.m04,a=t.m05,o=t.m06,h=t.m07,l=t.m08,u=t.m09,c=t.m10,_=t.m11,d=t.m12,p=t.m13,f=t.m14,m=t.m15;return(e*a-i*s)*(c*m-_*f)-(e*o-r*s)*(u*m-_*p)+(e*h-n*s)*(u*f-c*p)+(i*o-r*a)*(l*m-_*d)-(i*h-n*a)*(l*f-c*d)+(r*h-n*o)*(l*p-u*d)},e.multiply=function(t,e,i){var r=e.m00,n=e.m01,s=e.m02,a=e.m03,o=e.m04,h=e.m05,l=e.m06,u=e.m07,c=e.m08,_=e.m09,d=e.m10,p=e.m11,f=e.m12,m=e.m13,g=e.m14,v=e.m15,y=i.m00,T=i.m01,E=i.m02,S=i.m03;return t.m00=y*r+T*o+E*c+S*f,t.m01=y*n+T*h+E*_+S*m,t.m02=y*s+T*l+E*d+S*g,t.m03=y*a+T*u+E*p+S*v,y=i.m04,T=i.m05,E=i.m06,S=i.m07,t.m04=y*r+T*o+E*c+S*f,t.m05=y*n+T*h+E*_+S*m,t.m06=y*s+T*l+E*d+S*g,t.m07=y*a+T*u+E*p+S*v,y=i.m08,T=i.m09,E=i.m10,S=i.m11,t.m08=y*r+T*o+E*c+S*f,t.m09=y*n+T*h+E*_+S*m,t.m10=y*s+T*l+E*d+S*g,t.m11=y*a+T*u+E*p+S*v,y=i.m12,T=i.m13,E=i.m14,S=i.m15,t.m12=y*r+T*o+E*c+S*f,t.m13=y*n+T*h+E*_+S*m,t.m14=y*s+T*l+E*d+S*g,t.m15=y*a+T*u+E*p+S*v,t},e.transform=function(t,e,i){var r=i.x,n=i.y,s=i.z;if(e===t)t.m12=e.m00*r+e.m04*n+e.m08*s+e.m12,t.m13=e.m01*r+e.m05*n+e.m09*s+e.m13,t.m14=e.m02*r+e.m06*n+e.m10*s+e.m14,t.m15=e.m03*r+e.m07*n+e.m11*s+e.m15;else{var a=e.m00,o=e.m01,h=e.m02,l=e.m03,u=e.m04,c=e.m05,_=e.m06,d=e.m07,p=e.m08,f=e.m09,m=e.m10,g=e.m11;e.m12,e.m13,e.m14,e.m15,t.m00=a,t.m01=o,t.m02=h,t.m03=l,t.m04=u,t.m05=c,t.m06=_,t.m07=d,t.m08=p,t.m09=f,t.m10=m,t.m11=g,t.m12=a*r+u*n+p*s+e.m12,t.m13=o*r+c*n+f*s+e.m13,t.m14=h*r+_*n+m*s+e.m14,t.m15=l*r+d*n+g*s+e.m15}return t},e.translate=function(t,e,i){return console.warn("function changed"),e===t?(t.m12+=i.x,t.m13+=i.y,t.m14+=i.z):(t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t.m09=e.m09,t.m10=e.m10,t.m11=e.m11,t.m12+=i.x,t.m13+=i.y,t.m14+=i.z,t.m15=e.m15),t},e.scale=function(t,e,i){var r=i.x,n=i.y,s=i.z;return t.m00=e.m00*r,t.m01=e.m01*r,t.m02=e.m02*r,t.m03=e.m03*r,t.m04=e.m04*n,t.m05=e.m05*n,t.m06=e.m06*n,t.m07=e.m07*n,t.m08=e.m08*s,t.m09=e.m09*s,t.m10=e.m10*s,t.m11=e.m11*s,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15,t},e.rotate=function(t,e,i,r){var n=r.x,s=r.y,a=r.z,o=Math.sqrt(n*n+s*s+a*a);if(Math.abs(o)<Rr)return null;n*=o=1/o,s*=o,a*=o;var h=Math.sin(i),l=Math.cos(i),u=1-l,c=e.m00,_=e.m01,d=e.m02,p=e.m03,f=e.m04,m=e.m05,g=e.m06,v=e.m07,y=e.m08,T=e.m09,E=e.m10,S=e.m11,b=n*n*u+l,A=s*n*u+a*h,C=a*n*u-s*h,w=n*s*u-a*h,R=s*s*u+l,x=a*s*u+n*h,O=n*a*u+s*h,I=s*a*u-n*h,M=a*a*u+l;return t.m00=c*b+f*A+y*C,t.m01=_*b+m*A+T*C,t.m02=d*b+g*A+E*C,t.m03=p*b+v*A+S*C,t.m04=c*w+f*R+y*x,t.m05=_*w+m*R+T*x,t.m06=d*w+g*R+E*x,t.m07=p*w+v*R+S*x,t.m08=c*O+f*I+y*M,t.m09=_*O+m*I+T*M,t.m10=d*O+g*I+E*M,t.m11=p*O+v*I+S*M,e!==t&&(t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t},e.rotateX=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),s=e.m04,a=e.m05,o=e.m06,h=e.m07,l=e.m08,u=e.m09,c=e.m10,_=e.m11;return e!==t&&(t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t.m04=s*n+l*r,t.m05=a*n+u*r,t.m06=o*n+c*r,t.m07=h*n+_*r,t.m08=l*n-s*r,t.m09=u*n-a*r,t.m10=c*n-o*r,t.m11=_*n-h*r,t},e.rotateY=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),s=e.m00,a=e.m01,o=e.m02,h=e.m03,l=e.m08,u=e.m09,c=e.m10,_=e.m11;return e!==t&&(t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t.m00=s*n-l*r,t.m01=a*n-u*r,t.m02=o*n-c*r,t.m03=h*n-_*r,t.m08=s*r+l*n,t.m09=a*r+u*n,t.m10=o*r+c*n,t.m11=h*r+_*n,t},e.rotateZ=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),s=e.m00,a=e.m01,o=e.m02,h=e.m03,l=e.m04,u=e.m05,c=e.m06,_=e.m07;return e!==t&&(t.m08=e.m08,t.m09=e.m09,t.m10=e.m10,t.m11=e.m11,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t.m00=s*n+l*r,t.m01=a*n+u*r,t.m02=o*n+c*r,t.m03=h*n+_*r,t.m04=l*n-s*r,t.m05=u*n-a*r,t.m06=c*n-o*r,t.m07=_*n-h*r,t},e.fromTranslation=function(t,e){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=1,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=1,t.m11=0,t.m12=e.x,t.m13=e.y,t.m14=e.z,t.m15=1,t},e.fromScaling=function(t,e){return t.m00=e.x,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=e.y,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=e.z,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.fromRotation=function(t,e,i){var r=i.x,n=i.y,s=i.z,a=Math.sqrt(r*r+n*n+s*s);if(Math.abs(a)<Rr)return null;r*=a=1/a,n*=a,s*=a;var o=Math.sin(e),h=Math.cos(e),l=1-h;return t.m00=r*r*l+h,t.m01=n*r*l+s*o,t.m02=s*r*l-n*o,t.m03=0,t.m04=r*n*l-s*o,t.m05=n*n*l+h,t.m06=s*n*l+r*o,t.m07=0,t.m08=r*s*l+n*o,t.m09=n*s*l-r*o,t.m10=s*s*l+h,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.fromXRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=r,t.m06=i,t.m07=0,t.m08=0,t.m09=-i,t.m10=r,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.fromYRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t.m00=r,t.m01=0,t.m02=-i,t.m03=0,t.m04=0,t.m05=1,t.m06=0,t.m07=0,t.m08=i,t.m09=0,t.m10=r,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.fromZRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t.m00=r,t.m01=i,t.m02=0,t.m03=0,t.m04=-i,t.m05=r,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=1,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.fromRT=function(t,e,i){var r=e.x,n=e.y,s=e.z,a=e.w,o=r+r,h=n+n,l=s+s,u=r*o,c=r*h,_=r*l,d=n*h,p=n*l,f=s*l,m=a*o,g=a*h,v=a*l;return t.m00=1-(d+f),t.m01=c+v,t.m02=_-g,t.m03=0,t.m04=c-v,t.m05=1-(u+f),t.m06=p+m,t.m07=0,t.m08=_+g,t.m09=p-m,t.m10=1-(u+d),t.m11=0,t.m12=i.x,t.m13=i.y,t.m14=i.z,t.m15=1,t},e.getTranslation=function(t,e){return t.x=e.m12,t.y=e.m13,t.z=e.m14,t},e.getScaling=function(t,e){var i=Ws.m00=e.m00,r=Ws.m01=e.m01,n=Ws.m02=e.m02,s=Ws.m03=e.m04,a=Ws.m04=e.m05,o=Ws.m05=e.m06,h=Ws.m06=e.m08,l=Ws.m07=e.m09,u=Ws.m08=e.m10;return t.x=Math.sqrt(i*i+r*r+n*n),t.y=Math.sqrt(s*s+a*a+o*o),t.z=Math.sqrt(h*h+l*l+u*u),Ms.determinant(Ws)<0&&(t.x*=-1),t},e.getRotation=function(t,e){var i=e.m00+e.m05+e.m10,r=0;return i>0?(r=2*Math.sqrt(i+1),t.w=.25*r,t.x=(e.m06-e.m09)/r,t.y=(e.m08-e.m02)/r,t.z=(e.m01-e.m04)/r):e.m00>e.m05&&e.m00>e.m10?(r=2*Math.sqrt(1+e.m00-e.m05-e.m10),t.w=(e.m06-e.m09)/r,t.x=.25*r,t.y=(e.m01+e.m04)/r,t.z=(e.m08+e.m02)/r):e.m05>e.m10?(r=2*Math.sqrt(1+e.m05-e.m00-e.m10),t.w=(e.m08-e.m02)/r,t.x=(e.m01+e.m04)/r,t.y=.25*r,t.z=(e.m06+e.m09)/r):(r=2*Math.sqrt(1+e.m10-e.m00-e.m05),t.w=(e.m01-e.m04)/r,t.x=(e.m08+e.m02)/r,t.y=(e.m06+e.m09)/r,t.z=.25*r),t},e.toRTS=function(t,e,i,r){r.x=Cs.set(Vs,t.m00,t.m01,t.m02).length(),Ws.m00=t.m00/r.x,Ws.m01=t.m01/r.x,Ws.m02=t.m02/r.x,r.y=Cs.set(Vs,t.m04,t.m05,t.m06).length(),Ws.m03=t.m04/r.y,Ws.m04=t.m05/r.y,Ws.m05=t.m06/r.y,r.z=Cs.set(Vs,t.m08,t.m09,t.m10).length(),Ws.m06=t.m08/r.z,Ws.m07=t.m09/r.z,Ws.m08=t.m10/r.z,Ms.determinant(Ws)<0&&(r.x*=-1,Ws.m00*=-1,Ws.m01*=-1,Ws.m02*=-1),Ns.fromMat3(e,Ws),Cs.set(i,t.m12,t.m13,t.m14)},e.fromRTS=function(t,e,i,r){var n=e.x,s=e.y,a=e.z,o=e.w,h=n+n,l=s+s,u=a+a,c=n*h,_=n*l,d=n*u,p=s*l,f=s*u,m=a*u,g=o*h,v=o*l,y=o*u,T=r.x,E=r.y,S=r.z;return t.m00=(1-(p+m))*T,t.m01=(_+y)*T,t.m02=(d-v)*T,t.m03=0,t.m04=(_-y)*E,t.m05=(1-(c+m))*E,t.m06=(f+g)*E,t.m07=0,t.m08=(d+v)*S,t.m09=(f-g)*S,t.m10=(1-(c+p))*S,t.m11=0,t.m12=i.x,t.m13=i.y,t.m14=i.z,t.m15=1,t},e.fromRTSOrigin=function(t,e,i,r,n){var s=e.x,a=e.y,o=e.z,h=e.w,l=s+s,u=a+a,c=o+o,_=s*l,d=s*u,p=s*c,f=a*u,m=a*c,g=o*c,v=h*l,y=h*u,T=h*c,E=r.x,S=r.y,b=r.z,A=n.x,C=n.y,w=n.z;return t.m00=(1-(f+g))*E,t.m01=(d+T)*E,t.m02=(p-y)*E,t.m03=0,t.m04=(d-T)*S,t.m05=(1-(_+g))*S,t.m06=(m+v)*S,t.m07=0,t.m08=(p+y)*b,t.m09=(m-v)*b,t.m10=(1-(_+f))*b,t.m11=0,t.m12=i.x+A-(t.m00*A+t.m04*C+t.m08*w),t.m13=i.y+C-(t.m01*A+t.m05*C+t.m09*w),t.m14=i.z+w-(t.m02*A+t.m06*C+t.m10*w),t.m15=1,t},e.fromQuat=function(t,e){var i=e.x,r=e.y,n=e.z,s=e.w,a=i+i,o=r+r,h=n+n,l=i*a,u=r*a,c=r*o,_=n*a,d=n*o,p=n*h,f=s*a,m=s*o,g=s*h;return t.m00=1-c-p,t.m01=u+g,t.m02=_-m,t.m03=0,t.m04=u-g,t.m05=1-l-p,t.m06=d+f,t.m07=0,t.m08=_+m,t.m09=d-f,t.m10=1-l-c,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.frustum=function(t,e,i,r,n,s,a){var o=1/(i-e),h=1/(n-r),l=1/(s-a);return t.m00=2*s*o,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=2*s*h,t.m06=0,t.m07=0,t.m08=(i+e)*o,t.m09=(n+r)*h,t.m10=(a+s)*l,t.m11=-1,t.m12=0,t.m13=0,t.m14=a*s*2*l,t.m15=0,t},e.perspective=function(t,e,i,r,n,s,a,o,h){void 0===s&&(s=!0),void 0===a&&(a=-1),void 0===o&&(o=1),void 0===h&&(h=0);var l=1/Math.tan(e/2),u=1/(r-n),c=s?l/i:l,_=(s?l:l*i)*o,d=Gs[h];return t.m00=c*d[0],t.m01=c*d[1],t.m02=0,t.m03=0,t.m04=_*d[2],t.m05=_*d[3],t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=(n-a*r)*u,t.m11=-1,t.m12=0,t.m13=0,t.m14=n*r*u*(1-a),t.m15=0,t},e.ortho=function(t,e,i,r,n,s,a,o,h,l){void 0===o&&(o=-1),void 0===h&&(h=1),void 0===l&&(l=0);var u=1/(e-i),c=1/(r-n)*h,_=1/(s-a),d=-2*u,p=-2*c,f=(e+i)*u,m=(n+r)*c,g=Gs[l];return t.m00=d*g[0],t.m01=d*g[1],t.m02=0,t.m03=0,t.m04=p*g[2],t.m05=p*g[3],t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=_*(1-o),t.m11=0,t.m12=f*g[0]+m*g[2],t.m13=f*g[1]+m*g[3],t.m14=(s-o*a)*_,t.m15=1,t},e.lookAt=function(t,e,i,r){var n=e.x,s=e.y,a=e.z,o=r.x,h=r.y,l=r.z,u=n-i.x,c=s-i.y,_=a-i.z,d=1/Math.sqrt(u*u+c*c+_*_),p=h*(_*=d)-l*(c*=d),f=l*(u*=d)-o*_,m=o*c-h*u,g=c*(m*=d=1/Math.sqrt(p*p+f*f+m*m))-_*(f*=d),v=_*(p*=d)-u*m,y=u*f-c*p;return t.m00=p,t.m01=g,t.m02=u,t.m03=0,t.m04=f,t.m05=v,t.m06=c,t.m07=0,t.m08=m,t.m09=y,t.m10=_,t.m11=0,t.m12=-(p*n+f*s+m*a),t.m13=-(g*n+v*s+y*a),t.m14=-(u*n+c*s+_*a),t.m15=1,t},e.inverseTranspose=function(t,e){var i=e.m00,r=e.m01,n=e.m02,s=e.m03,a=e.m04,o=e.m05,h=e.m06,l=e.m07,u=e.m08,c=e.m09,_=e.m10,d=e.m11,p=e.m12,f=e.m13,m=e.m14,g=e.m15,v=i*o-r*a,y=i*h-n*a,T=i*l-s*a,E=r*h-n*o,S=r*l-s*o,b=n*l-s*h,A=u*f-c*p,C=u*m-_*p,w=u*g-d*p,R=c*m-_*f,x=c*g-d*f,O=_*g-d*m,I=v*O-y*x+T*R+E*w-S*C+b*A;return I?(I=1/I,t.m00=(o*O-h*x+l*R)*I,t.m01=(h*w-a*O-l*C)*I,t.m02=(a*x-o*w+l*A)*I,t.m03=0,t.m04=(n*x-r*O-s*R)*I,t.m05=(i*O-n*w+s*C)*I,t.m06=(r*w-i*x-s*A)*I,t.m07=0,t.m08=(f*b-m*S+g*E)*I,t.m09=(m*T-p*b-g*y)*I,t.m10=(p*S-f*T+g*v)*I,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t):null},e.toArray=function(t,e,i){return void 0===i&&(i=0),t[i+0]=e.m00,t[i+1]=e.m01,t[i+2]=e.m02,t[i+3]=e.m03,t[i+4]=e.m04,t[i+5]=e.m05,t[i+6]=e.m06,t[i+7]=e.m07,t[i+8]=e.m08,t[i+9]=e.m09,t[i+10]=e.m10,t[i+11]=e.m11,t[i+12]=e.m12,t[i+13]=e.m13,t[i+14]=e.m14,t[i+15]=e.m15,t},e.fromArray=function(t,e,i){return void 0===i&&(i=0),t.m00=e[i+0],t.m01=e[i+1],t.m02=e[i+2],t.m03=e[i+3],t.m04=e[i+4],t.m05=e[i+5],t.m06=e[i+6],t.m07=e[i+7],t.m08=e[i+8],t.m09=e[i+9],t.m10=e[i+10],t.m11=e[i+11],t.m12=e[i+12],t.m13=e[i+13],t.m14=e[i+14],t.m15=e[i+15],t},e.add=function(t,e,i){return t.m00=e.m00+i.m00,t.m01=e.m01+i.m01,t.m02=e.m02+i.m02,t.m03=e.m03+i.m03,t.m04=e.m04+i.m04,t.m05=e.m05+i.m05,t.m06=e.m06+i.m06,t.m07=e.m07+i.m07,t.m08=e.m08+i.m08,t.m09=e.m09+i.m09,t.m10=e.m10+i.m10,t.m11=e.m11+i.m11,t.m12=e.m12+i.m12,t.m13=e.m13+i.m13,t.m14=e.m14+i.m14,t.m15=e.m15+i.m15,t},e.subtract=function(t,e,i){return t.m00=e.m00-i.m00,t.m01=e.m01-i.m01,t.m02=e.m02-i.m02,t.m03=e.m03-i.m03,t.m04=e.m04-i.m04,t.m05=e.m05-i.m05,t.m06=e.m06-i.m06,t.m07=e.m07-i.m07,t.m08=e.m08-i.m08,t.m09=e.m09-i.m09,t.m10=e.m10-i.m10,t.m11=e.m11-i.m11,t.m12=e.m12-i.m12,t.m13=e.m13-i.m13,t.m14=e.m14-i.m14,t.m15=e.m15-i.m15,t},e.multiplyScalar=function(t,e,i){return t.m00=e.m00*i,t.m01=e.m01*i,t.m02=e.m02*i,t.m03=e.m03*i,t.m04=e.m04*i,t.m05=e.m05*i,t.m06=e.m06*i,t.m07=e.m07*i,t.m08=e.m08*i,t.m09=e.m09*i,t.m10=e.m10*i,t.m11=e.m11*i,t.m12=e.m12*i,t.m13=e.m13*i,t.m14=e.m14*i,t.m15=e.m15*i,t},e.multiplyScalarAndAdd=function(t,e,i,r){return t.m00=e.m00+i.m00*r,t.m01=e.m01+i.m01*r,t.m02=e.m02+i.m02*r,t.m03=e.m03+i.m03*r,t.m04=e.m04+i.m04*r,t.m05=e.m05+i.m05*r,t.m06=e.m06+i.m06*r,t.m07=e.m07+i.m07*r,t.m08=e.m08+i.m08*r,t.m09=e.m09+i.m09*r,t.m10=e.m10+i.m10*r,t.m11=e.m11+i.m11*r,t.m12=e.m12+i.m12*r,t.m13=e.m13+i.m13*r,t.m14=e.m14+i.m14*r,t.m15=e.m15+i.m15*r,t},e.strictEquals=function(t,e){return t.m00===e.m00&&t.m01===e.m01&&t.m02===e.m02&&t.m03===e.m03&&t.m04===e.m04&&t.m05===e.m05&&t.m06===e.m06&&t.m07===e.m07&&t.m08===e.m08&&t.m09===e.m09&&t.m10===e.m10&&t.m11===e.m11&&t.m12===e.m12&&t.m13===e.m13&&t.m14===e.m14&&t.m15===e.m15},e.equals=function(t,e,i){return void 0===i&&(i=Rr),Math.abs(t.m00-e.m00)<=i*Math.max(1,Math.abs(t.m00),Math.abs(e.m00))&&Math.abs(t.m01-e.m01)<=i*Math.max(1,Math.abs(t.m01),Math.abs(e.m01))&&Math.abs(t.m02-e.m02)<=i*Math.max(1,Math.abs(t.m02),Math.abs(e.m02))&&Math.abs(t.m03-e.m03)<=i*Math.max(1,Math.abs(t.m03),Math.abs(e.m03))&&Math.abs(t.m04-e.m04)<=i*Math.max(1,Math.abs(t.m04),Math.abs(e.m04))&&Math.abs(t.m05-e.m05)<=i*Math.max(1,Math.abs(t.m05),Math.abs(e.m05))&&Math.abs(t.m06-e.m06)<=i*Math.max(1,Math.abs(t.m06),Math.abs(e.m06))&&Math.abs(t.m07-e.m07)<=i*Math.max(1,Math.abs(t.m07),Math.abs(e.m07))&&Math.abs(t.m08-e.m08)<=i*Math.max(1,Math.abs(t.m08),Math.abs(e.m08))&&Math.abs(t.m09-e.m09)<=i*Math.max(1,Math.abs(t.m09),Math.abs(e.m09))&&Math.abs(t.m10-e.m10)<=i*Math.max(1,Math.abs(t.m10),Math.abs(e.m10))&&Math.abs(t.m11-e.m11)<=i*Math.max(1,Math.abs(t.m11),Math.abs(e.m11))&&Math.abs(t.m12-e.m12)<=i*Math.max(1,Math.abs(t.m12),Math.abs(e.m12))&&Math.abs(t.m13-e.m13)<=i*Math.max(1,Math.abs(t.m13),Math.abs(e.m13))&&Math.abs(t.m14-e.m14)<=i*Math.max(1,Math.abs(t.m14),Math.abs(e.m14))&&Math.abs(t.m15-e.m15)<=i*Math.max(1,Math.abs(t.m15),Math.abs(e.m15))};var i=e.prototype;return i.clone=function(){return new e(this.m00,this.m01,this.m02,this.m03,this.m04,this.m05,this.m06,this.m07,this.m08,this.m09,this.m10,this.m11,this.m12,this.m13,this.m14,this.m15)},i.set=function(t,e,i,r,n,s,a,o,h,l,u,c,_,d,p,f){return void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===s&&(s=1),void 0===a&&(a=0),void 0===o&&(o=0),void 0===h&&(h=0),void 0===l&&(l=0),void 0===u&&(u=1),void 0===c&&(c=0),void 0===_&&(_=0),void 0===d&&(d=0),void 0===p&&(p=0),void 0===f&&(f=1),"object"==typeof t?(this.m01=t.m01,this.m02=t.m02,this.m03=t.m03,this.m04=t.m04,this.m05=t.m05,this.m06=t.m06,this.m07=t.m07,this.m08=t.m08,this.m09=t.m09,this.m10=t.m10,this.m11=t.m11,this.m12=t.m12,this.m13=t.m13,this.m14=t.m14,this.m15=t.m15,this.m00=t.m00):(this.m01=e,this.m02=i,this.m03=r,this.m04=n,this.m05=s,this.m06=a,this.m07=o,this.m08=h,this.m09=l,this.m10=u,this.m11=c,this.m12=_,this.m13=d,this.m14=p,this.m15=f,this.m00=t),this},i.equals=function(t,e){return void 0===e&&(e=Rr),Math.abs(this.m00-t.m00)<=e*Math.max(1,Math.abs(this.m00),Math.abs(t.m00))&&Math.abs(this.m01-t.m01)<=e*Math.max(1,Math.abs(this.m01),Math.abs(t.m01))&&Math.abs(this.m02-t.m02)<=e*Math.max(1,Math.abs(this.m02),Math.abs(t.m02))&&Math.abs(this.m03-t.m03)<=e*Math.max(1,Math.abs(this.m03),Math.abs(t.m03))&&Math.abs(this.m04-t.m04)<=e*Math.max(1,Math.abs(this.m04),Math.abs(t.m04))&&Math.abs(this.m05-t.m05)<=e*Math.max(1,Math.abs(this.m05),Math.abs(t.m05))&&Math.abs(this.m06-t.m06)<=e*Math.max(1,Math.abs(this.m06),Math.abs(t.m06))&&Math.abs(this.m07-t.m07)<=e*Math.max(1,Math.abs(this.m07),Math.abs(t.m07))&&Math.abs(this.m08-t.m08)<=e*Math.max(1,Math.abs(this.m08),Math.abs(t.m08))&&Math.abs(this.m09-t.m09)<=e*Math.max(1,Math.abs(this.m09),Math.abs(t.m09))&&Math.abs(this.m10-t.m10)<=e*Math.max(1,Math.abs(this.m10),Math.abs(t.m10))&&Math.abs(this.m11-t.m11)<=e*Math.max(1,Math.abs(this.m11),Math.abs(t.m11))&&Math.abs(this.m12-t.m12)<=e*Math.max(1,Math.abs(this.m12),Math.abs(t.m12))&&Math.abs(this.m13-t.m13)<=e*Math.max(1,Math.abs(this.m13),Math.abs(t.m13))&&Math.abs(this.m14-t.m14)<=e*Math.max(1,Math.abs(this.m14),Math.abs(t.m14))&&Math.abs(this.m15-t.m15)<=e*Math.max(1,Math.abs(this.m15),Math.abs(t.m15))},i.strictEquals=function(t){return this.m00===t.m00&&this.m01===t.m01&&this.m02===t.m02&&this.m03===t.m03&&this.m04===t.m04&&this.m05===t.m05&&this.m06===t.m06&&this.m07===t.m07&&this.m08===t.m08&&this.m09===t.m09&&this.m10===t.m10&&this.m11===t.m11&&this.m12===t.m12&&this.m13===t.m13&&this.m14===t.m14&&this.m15===t.m15},i.toString=function(){return"[\n"+this.m00+", "+this.m01+", "+this.m02+", "+this.m03+",\n"+this.m04+", "+this.m05+", "+this.m06+", "+this.m07+",\n"+this.m08+", "+this.m09+", "+this.m10+", "+this.m11+",\n"+this.m12+", "+this.m13+", "+this.m14+", "+this.m15+"\n]"},i.identity=function(){return this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m04=0,this.m05=1,this.m06=0,this.m07=0,this.m08=0,this.m09=0,this.m10=1,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=1,this},i.zero=function(){return this.m00=0,this.m01=0,this.m02=0,this.m03=0,this.m04=0,this.m05=0,this.m06=0,this.m07=0,this.m08=0,this.m09=0,this.m10=0,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=0,this},i.transpose=function(){var t=this.m01,e=this.m02,i=this.m03,r=this.m06,n=this.m07,s=this.m11;return this.m01=this.m04,this.m02=this.m08,this.m03=this.m12,this.m04=t,this.m06=this.m09,this.m07=this.m13,this.m08=e,this.m09=r,this.m11=this.m14,this.m12=i,this.m13=n,this.m14=s,this},i.invert=function(){var t=this.m00,e=this.m01,i=this.m02,r=this.m03,n=this.m04,s=this.m05,a=this.m06,o=this.m07,h=this.m08,l=this.m09,u=this.m10,c=this.m11,_=this.m12,d=this.m13,p=this.m14,f=this.m15,m=t*s-e*n,g=t*a-i*n,v=t*o-r*n,y=e*a-i*s,T=e*o-r*s,E=i*o-r*a,S=h*d-l*_,b=h*p-u*_,A=h*f-c*_,C=l*p-u*d,w=l*f-c*d,R=u*f-c*p,x=m*R-g*w+v*C+y*A-T*b+E*S;return 0===x?(this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this):(x=1/x,this.m00=(s*R-a*w+o*C)*x,this.m01=(i*w-e*R-r*C)*x,this.m02=(d*E-p*T+f*y)*x,this.m03=(u*T-l*E-c*y)*x,this.m04=(a*A-n*R-o*b)*x,this.m05=(t*R-i*A+r*b)*x,this.m06=(p*v-_*E-f*g)*x,this.m07=(h*E-u*v+c*g)*x,this.m08=(n*w-s*A+o*S)*x,this.m09=(e*A-t*w-r*S)*x,this.m10=(_*T-d*v+f*m)*x,this.m11=(l*v-h*T-c*m)*x,this.m12=(s*b-n*C-a*S)*x,this.m13=(t*C-e*b+i*S)*x,this.m14=(d*g-_*y-p*m)*x,this.m15=(h*y-l*g+u*m)*x,this)},i.determinant=function(){var t=this.m00,e=this.m01,i=this.m02,r=this.m03,n=this.m04,s=this.m05,a=this.m06,o=this.m07,h=this.m08,l=this.m09,u=this.m10,c=this.m11,_=this.m12,d=this.m13,p=this.m14,f=this.m15;return(t*s-e*n)*(u*f-c*p)-(t*a-i*n)*(l*f-c*d)+(t*o-r*n)*(l*p-u*d)+(e*a-i*s)*(h*f-c*_)-(e*o-r*s)*(h*p-u*_)+(i*o-r*a)*(h*d-l*_)},i.add=function(t){return this.m00+=t.m00,this.m01+=t.m01,this.m02+=t.m02,this.m03+=t.m03,this.m04+=t.m04,this.m05+=t.m05,this.m06+=t.m06,this.m07+=t.m07,this.m08+=t.m08,this.m09+=t.m09,this.m10+=t.m10,this.m11+=t.m11,this.m12+=t.m12,this.m13+=t.m13,this.m14+=t.m14,this.m15+=t.m15,this},i.subtract=function(t){return this.m00-=t.m00,this.m01-=t.m01,this.m02-=t.m02,this.m03-=t.m03,this.m04-=t.m04,this.m05-=t.m05,this.m06-=t.m06,this.m07-=t.m07,this.m08-=t.m08,this.m09-=t.m09,this.m10-=t.m10,this.m11-=t.m11,this.m12-=t.m12,this.m13-=t.m13,this.m14-=t.m14,this.m15-=t.m15,this},i.multiply=function(t){var e=this.m00,i=this.m01,r=this.m02,n=this.m03,s=this.m04,a=this.m05,o=this.m06,h=this.m07,l=this.m08,u=this.m09,c=this.m10,_=this.m11,d=this.m12,p=this.m13,f=this.m14,m=this.m15,g=t.m00,v=t.m01,y=t.m02,T=t.m03;return this.m00=g*e+v*s+y*l+T*d,this.m01=g*i+v*a+y*u+T*p,this.m02=g*r+v*o+y*c+T*f,this.m03=g*n+v*h+y*_+T*m,g=t.m04,v=t.m05,y=t.m06,T=t.m07,this.m04=g*e+v*s+y*l+T*d,this.m05=g*i+v*a+y*u+T*p,this.m06=g*r+v*o+y*c+T*f,this.m07=g*n+v*h+y*_+T*m,g=t.m08,v=t.m09,y=t.m10,T=t.m11,this.m08=g*e+v*s+y*l+T*d,this.m09=g*i+v*a+y*u+T*p,this.m10=g*r+v*o+y*c+T*f,this.m11=g*n+v*h+y*_+T*m,g=t.m12,v=t.m13,y=t.m14,T=t.m15,this.m12=g*e+v*s+y*l+T*d,this.m13=g*i+v*a+y*u+T*p,this.m14=g*r+v*o+y*c+T*f,this.m15=g*n+v*h+y*_+T*m,this},i.multiplyScalar=function(t){return this.m00*=t,this.m01*=t,this.m02*=t,this.m03*=t,this.m04*=t,this.m05*=t,this.m06*=t,this.m07*=t,this.m08*=t,this.m09*=t,this.m10*=t,this.m11*=t,this.m12*=t,this.m13*=t,this.m14*=t,this.m15*=t,this},i.translate=function(t){return console.warn("function changed"),this.m12+=t.x,this.m13+=t.y,this.m14+=t.z,this},i.scale=function(t){var e=t.x,i=t.y,r=t.z;return this.m00*=e,this.m01*=e,this.m02*=e,this.m03*=e,this.m04*=i,this.m05*=i,this.m06*=i,this.m07*=i,this.m08*=r,this.m09*=r,this.m10*=r,this.m11*=r,this},i.rotate=function(t,e){var i=e.x,r=e.y,n=e.z,s=Math.sqrt(i*i+r*r+n*n);if(Math.abs(s)<Rr)return null;i*=s=1/s,r*=s,n*=s;var a=Math.sin(t),o=Math.cos(t),h=1-o,l=this.m00,u=this.m01,c=this.m02,_=this.m03,d=this.m04,p=this.m05,f=this.m06,m=this.m07,g=this.m08,v=this.m09,y=this.m10,T=this.m11,E=i*i*h+o,S=r*i*h+n*a,b=n*i*h-r*a,A=i*r*h-n*a,C=r*r*h+o,w=n*r*h+i*a,R=i*n*h+r*a,x=r*n*h-i*a,O=n*n*h+o;return this.m00=l*E+d*S+g*b,this.m01=u*E+p*S+v*b,this.m02=c*E+f*S+y*b,this.m03=_*E+m*S+T*b,this.m04=l*A+d*C+g*w,this.m05=u*A+p*C+v*w,this.m06=c*A+f*C+y*w,this.m07=_*A+m*C+T*w,this.m08=l*R+d*x+g*O,this.m09=u*R+p*x+v*O,this.m10=c*R+f*x+y*O,this.m11=_*R+m*x+T*O,this},i.getTranslation=function(t){return t.x=this.m12,t.y=this.m13,t.z=this.m14,t},i.getScale=function(t){var e=Ws.m00=this.m00,i=Ws.m01=this.m01,r=Ws.m02=this.m02,n=Ws.m03=this.m04,s=Ws.m04=this.m05,a=Ws.m05=this.m06,o=Ws.m06=this.m08,h=Ws.m07=this.m09,l=Ws.m08=this.m10;return t.x=Math.sqrt(e*e+i*i+r*r),t.y=Math.sqrt(n*n+s*s+a*a),t.z=Math.sqrt(o*o+h*h+l*l),Ms.determinant(Ws)<0&&(t.x*=-1),t},i.getRotation=function(t){var e=this.m00+this.m05+this.m10,i=0;return e>0?(i=2*Math.sqrt(e+1),t.w=.25*i,t.x=(this.m06-this.m09)/i,t.y=(this.m08-this.m02)/i,t.z=(this.m01-this.m04)/i):this.m00>this.m05&&this.m00>this.m10?(i=2*Math.sqrt(1+this.m00-this.m05-this.m10),t.w=(this.m06-this.m09)/i,t.x=.25*i,t.y=(this.m01+this.m04)/i,t.z=(this.m08+this.m02)/i):this.m05>this.m10?(i=2*Math.sqrt(1+this.m05-this.m00-this.m10),t.w=(this.m08-this.m02)/i,t.x=(this.m01+this.m04)/i,t.y=.25*i,t.z=(this.m06+this.m09)/i):(i=2*Math.sqrt(1+this.m10-this.m00-this.m05),t.w=(this.m01-this.m04)/i,t.x=(this.m08+this.m02)/i,t.y=(this.m06+this.m09)/i,t.z=.25*i),t},i.fromRTS=function(t,e,i){var r=t.x,n=t.y,s=t.z,a=t.w,o=r+r,h=n+n,l=s+s,u=r*o,c=r*h,_=r*l,d=n*h,p=n*l,f=s*l,m=a*o,g=a*h,v=a*l,y=i.x,T=i.y,E=i.z;return this.m00=(1-(d+f))*y,this.m01=(c+v)*y,this.m02=(_-g)*y,this.m03=0,this.m04=(c-v)*T,this.m05=(1-(u+f))*T,this.m06=(p+m)*T,this.m07=0,this.m08=(_+g)*E,this.m09=(p-m)*E,this.m10=(1-(u+d))*E,this.m11=0,this.m12=e.x,this.m13=e.y,this.m14=e.z,this.m15=1,this},i.fromQuat=function(t){var e=t.x,i=t.y,r=t.z,n=t.w,s=e+e,a=i+i,o=r+r,h=e*s,l=i*s,u=i*a,c=r*s,_=r*a,d=r*o,p=n*s,f=n*a,m=n*o;return this.m00=1-u-d,this.m01=l+m,this.m02=c-f,this.m03=0,this.m04=l-m,this.m05=1-h-d,this.m06=_+p,this.m07=0,this.m08=c+f,this.m09=_-p,this.m10=1-h-u,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=1,this},e}(Dt));Hs.IDENTITY=Object.freeze(new Hs);var Vs=new Cs,Ws=new Ms;function js(t,e,i,r,n,s,a,o,h,l,u,c,_,d,p,f){return new Hs(t,e,i,r,n,s,a,o,h,l,u,c,_,d,p,f)}Ae.fastDefine("cc.Mat4",Hs,{m00:1,m01:0,m02:0,m03:0,m04:0,m05:1,m06:0,m07:0,m08:0,m09:0,m10:1,m11:0,m12:0,m13:0,m14:0,m15:1}),_.Mat4=Hs,_.mat4=js;var Xs=t("AffineTransform",function(){function t(t,e,i,r,n,s){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===n&&(n=0),void 0===s&&(s=0),this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=s}return t.identity=function(){return new t},t.clone=function(e){return new t(e.a,e.b,e.c,e.d,e.tx,e.ty)},t.concat=function(t,e,i){var r=e.a,n=e.b,s=e.c,a=e.d,o=e.tx,h=e.ty;t.a=r*i.a+n*i.c,t.b=r*i.b+n*i.d,t.c=s*i.a+a*i.c,t.d=s*i.b+a*i.d,t.tx=o*i.a+h*i.c+i.tx,t.ty=o*i.b+h*i.d+i.ty},t.invert=function(t,e){var i=1/(e.a*e.d-e.b*e.c);t.a=i*e.d,t.b=-i*e.b,t.c=-i*e.c,t.d=i*e.a,t.tx=i*(e.c*e.ty-e.d*e.tx),t.ty=i*(e.b*e.tx-e.a*e.ty)},t.fromMat4=function(t,e){t.a=e.m00,t.b=e.m01,t.c=e.m04,t.d=e.m05,t.tx=e.m12,t.ty=e.m13},t.transformVec2=function(t,e,i,r){var n,s;void 0===r?(r=i,n=e.x,s=e.y):(n=e,s=i),t.x=r.a*n+r.c*s+r.tx,t.y=r.b*n+r.d*s+r.ty},t.transformSize=function(t,e,i){t.width=i.a*e.width+i.c*e.height,t.height=i.b*e.width+i.d*e.height},t.transformRect=function(t,e,i){var r=e.x+e.width,n=e.y+e.height,s=i.a*e.x+i.c*e.y+i.tx,a=i.b*e.x+i.d*e.y+i.ty,o=i.a*r+i.c*e.y+i.tx,h=i.b*r+i.d*e.y+i.ty,l=i.a*e.x+i.c*n+i.tx,u=i.b*e.x+i.d*n+i.ty,c=i.a*r+i.c*n+i.tx,_=i.b*r+i.d*n+i.ty,d=Math.min(s,o,l,c),p=Math.max(s,o,l,c),f=Math.min(a,h,u,_),m=Math.max(a,h,u,_);t.x=d,t.y=f,t.width=p-d,t.height=m-f},t.transformObb=function(t,e,i,r,n,s){var a=s.a*n.x+s.c*n.y+s.tx,o=s.b*n.x+s.d*n.y+s.ty,h=s.a*n.width,l=s.b*n.width,u=s.c*n.height,c=s.d*n.height;e.x=a,e.y=o,i.x=h+a,i.y=l+o,t.x=u+a,t.y=c+o,r.x=h+u+a,r.y=l+c+o},t}());_.AffineTransform=Xs;var Ys=t("Size",function(t){function e(e,i){var r;return r=t.call(this)||this,e&&"object"==typeof e?(r.width=e.width,r.height=e.height):(r.width=e||0,r.height=i||0),r}s(e,t),e.lerp=function(t,e,i,r){return t.width=e.width+(i.width-e.width)*r,t.height=e.height+(i.height-e.height)*r,t},r(e,[{key:"x",set:function(t){this.width=t},get:function(){return this.width}},{key:"y",set:function(t){this.height=t},get:function(){return this.height}}]);var i=e.prototype;return i.clone=function(){return new e(this.width,this.height)},i.set=function(t,e){return t&&"object"==typeof t?(this.height=t.height,this.width=t.width):(this.width=t||0,this.height=e||0),this},i.equals=function(t){return this.width===t.width&&this.height===t.height},i.lerp=function(t,e){return this.width=this.width+(t.width-this.width)*e,this.height=this.height+(t.height-this.height)*e,this},i.toString=function(){return"("+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},e}(Dt));function qs(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),new Ys(t,e)}Ys.ZERO=Object.freeze(new Ys(0,0)),Ys.ONE=Object.freeze(new Ys(1,1)),Ae.fastDefine("cc.Size",Ys,{width:0,height:0}),_.size=qs,_.Size=Ys;var Ks=t("Rect",function(t){function e(e,i,r,n){var s;return(s=t.call(this)||this).T=void 0,e&&"object"==typeof e?(s.y=e.y,s.width=e.width,s.height=e.height,s.x=e.x):(s.x=e||0,s.y=i||0,s.width=r||0,s.height=n||0),s}s(e,t),e.fromMinMax=function(t,e,i){var r=Math.min(e.x,i.x),n=Math.min(e.y,i.y),s=Math.max(e.x,i.x),a=Math.max(e.y,i.y);return t.x=r,t.y=n,t.width=s-r,t.height=a-n,t},e.lerp=function(t,e,i,r){var n=e.x,s=e.y,a=e.width,o=e.height;return t.x=n+(i.x-n)*r,t.y=s+(i.y-s)*r,t.width=a+(i.width-a)*r,t.height=o+(i.height-o)*r,t},e.intersection=function(t,e,i){var r=e.x,n=e.y,s=e.x+e.width,a=e.y+e.height,o=i.x,h=i.y,l=i.x+i.width,u=i.y+i.height;return t.x=Math.max(r,o),t.y=Math.max(n,h),t.width=Math.min(s,l)-t.x,t.height=Math.min(a,u)-t.y,t},e.union=function(t,e,i){var r=e.x,n=e.y,s=e.width,a=e.height,o=i.x,h=i.y,l=i.width,u=i.height;return t.x=Math.min(r,o),t.y=Math.min(n,h),t.width=Math.max(r+s,o+l)-t.x,t.height=Math.max(n+a,h+u)-t.y,t},r(e,[{key:"xMin",get:function(){return this.x},set:function(t){this.width+=this.x-t,this.x=t}},{key:"yMin",get:function(){return this.y},set:function(t){this.height+=this.y-t,this.y=t}},{key:"xMax",get:function(){return this.x+this.width},set:function(t){this.width=t-this.x}},{key:"yMax",get:function(){return this.y+this.height},set:function(t){this.height=t-this.y}},{key:"center",get:function(){return new Es(this.x+.5*this.width,this.y+.5*this.height)},set:function(t){this.x=t.x-.5*this.width,this.y=t.y-.5*this.height}},{key:"origin",get:function(){return new Es(this.x,this.y)},set:function(t){this.x=t.x,this.y=t.y}},{key:"size",get:function(){return new Ys(this.width,this.height)},set:function(t){this.width=t.width,this.height=t.height}},{key:"z",set:function(t){this.width=t},get:function(){return this.width}},{key:"w",set:function(t){this.height=t},get:function(){return this.height}}]);var i=e.prototype;return i.clone=function(){return new e(this.x,this.y,this.width,this.height)},i.set=function(t,e,i,r){return t&&"object"==typeof t?(this.y=t.y,this.width=t.width,this.height=t.height,this.x=t.x):(this.x=t||0,this.y=e||0,this.width=i||0,this.height=r||0),this},i.equals=function(t){return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},i.lerp=function(t,e){var i=this.x,r=this.y,n=this.width,s=this.height;return this.x=i+(t.x-i)*e,this.y=r+(t.y-r)*e,this.width=n+(t.width-n)*e,this.height=s+(t.height-s)*e,this},i.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},i.intersects=function(t){var e=this.x+this.width,i=this.y+this.height,r=t.x+t.width,n=t.y+t.height;return!(e<t.x||r<this.x||i<t.y||n<this.y)},i.contains=function(t){return this.x<=t.x&&this.x+this.width>=t.x&&this.y<=t.y&&this.y+this.height>=t.y},i.containsRect=function(t){return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height},i.transformMat4=function(t){var e=this.x,i=this.y,r=e+this.width,n=i+this.height,s=t.m00*e+t.m04*i+t.m12,a=t.m01*e+t.m05*i+t.m13,o=t.m00*r+t.m04*i+t.m12,h=t.m01*r+t.m05*i+t.m13,l=t.m00*e+t.m04*n+t.m12,u=t.m01*e+t.m05*n+t.m13,c=t.m00*r+t.m04*n+t.m12,_=t.m01*r+t.m05*n+t.m13,d=Math.min(s,o,l,c),p=Math.max(s,o,l,c),f=Math.min(a,h,u,_),m=Math.max(a,h,u,_);return this.x=d,this.y=f,this.width=p-d,this.height=m-f,this},i.transformMat4ToPoints=function(t,e,i,r,n){var s=this.x,a=this.y,o=s+this.width,h=a+this.height;e.x=t.m00*s+t.m04*a+t.m12,e.y=t.m01*s+t.m05*a+t.m13,n.x=t.m00*o+t.m04*a+t.m12,n.y=t.m01*o+t.m05*a+t.m13,i.x=t.m00*s+t.m04*h+t.m12,i.y=t.m01*s+t.m05*h+t.m13,r.x=t.m00*o+t.m04*h+t.m12,r.y=t.m01*o+t.m05*h+t.m13},e}(Dt));function Zs(t,e,i,r){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),new Ks(t,e,i,r)}Ae.fastDefine("cc.Rect",Ks,{x:0,y:0,width:0,height:0}),_.Rect=Ks,_.rect=Zs;var Qs=t("Color",function(t){function e(e,i,r,n){var s;return(s=t.call(this)||this)._val=0,"string"==typeof e?s.fromHEX(e):void 0!==i?s.set(e,i,r,n):s.set(e),s}s(e,t),e.clone=function(t){var i=new e;return t._val?i._val=t._val:i._val=(t.a<<24>>>0)+(t.b<<16)+(t.g<<8)+t.r,i},e.copy=function(t,e){return t.r=e.r,t.g=e.g,t.b=e.b,t.a=e.a,t},e.set=function(t,e,i,r,n){return t.r=e,t.g=i,t.b=r,t.a=n,t},e.fromHEX=function(t,e){return e=0===e.indexOf("#")?e.substring(1):e,t.r=parseInt(e.substr(0,2),16)||0,t.g=parseInt(e.substr(2,2),16)||0,t.b=parseInt(e.substr(4,2),16)||0,t.a=parseInt(e.substr(6,2),16)||255,t._val=(t.a<<24>>>0)+(t.b<<16)+(t.g<<8)+t.r,t},e.add=function(t,e,i){return t.r=e.r+i.r,t.g=e.g+i.g,t.b=e.b+i.b,t.a=e.a+i.a,t},e.subtract=function(t,e,i){return t.r=e.r-i.r,t.g=e.g-i.g,t.b=e.b-i.b,t.a=e.a-i.a,t},e.multiply=function(t,e,i){return t.r=e.r*i.r,t.g=e.g*i.g,t.b=e.b*i.b,t.a=e.a*i.a,t},e.divide=function(t,e,i){return t.r=e.r/i.r,t.g=e.g/i.g,t.b=e.b/i.b,t.a=e.a/i.a,t},e.scale=function(t,e,i){return t.r=e.r*i,t.g=e.g*i,t.b=e.b*i,t.a=e.a*i,t},e.lerp=function(t,e,i,r){var n=e.r,s=e.g,a=e.b,o=e.a;return n+=(i.r-n)*r,s+=(i.g-s)*r,a+=(i.b-a)*r,o+=(i.a-o)*r,t._val=Math.floor((o<<24>>>0)+(a<<16)+(s<<8)+n),t},e.toArray=function(t,i,r){void 0===r&&(r=0);var n=i instanceof e||i.a>1?1/255:1;return t[r+0]=i.r*n,t[r+1]=i.g*n,t[r+2]=i.b*n,t[r+3]=i.a*n,t},e.fromArray=function(t,e,i){return void 0===i&&(i=0),e.r=255*t[i+0],e.g=255*t[i+1],e.b=255*t[i+2],e.a=255*t[i+3],e},e.strictEquals=function(t,e){return t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a},e.equals=function(t,e,i){return void 0===i&&(i=Rr),Math.abs(t.r-e.r)<=i*Math.max(1,Math.abs(t.r),Math.abs(e.r))&&Math.abs(t.g-e.g)<=i*Math.max(1,Math.abs(t.g),Math.abs(e.g))&&Math.abs(t.b-e.b)<=i*Math.max(1,Math.abs(t.b),Math.abs(e.b))&&Math.abs(t.a-e.a)<=i*Math.max(1,Math.abs(t.a),Math.abs(e.a))},e.hex=function(t){return(255*t.r<<24|255*t.g<<16|255*t.b<<8|255*t.a)>>>0},r(e,[{key:"r",get:function(){return 255&this._val},set:function(t){t=~~Ir(t,0,255),this._val=(4294967040&this._val|t)>>>0}},{key:"g",get:function(){return(65280&this._val)>>8},set:function(t){t=~~Ir(t,0,255),this._val=(4294902015&this._val|t<<8)>>>0}},{key:"b",get:function(){return(16711680&this._val)>>16},set:function(t){t=~~Ir(t,0,255),this._val=(4278255615&this._val|t<<16)>>>0}},{key:"a",get:function(){return(4278190080&this._val)>>>24},set:function(t){t=~~Ir(t,0,255),this._val=(16777215&this._val|t<<24)>>>0}},{key:"x",get:function(){return this.r*(1/255)},set:function(t){this.r=255*t}},{key:"y",get:function(){return this.g*(1/255)},set:function(t){this.g=255*t}},{key:"z",get:function(){return this.b*(1/255)},set:function(t){this.b=255*t}},{key:"w",get:function(){return this.a*(1/255)},set:function(t){this.a=255*t}}]);var i=e.prototype;return i.clone=function(){var t=new e;return t._val=this._val,t},i.equals=function(t){return t&&this._val===t._val},i.lerp=function(t,e){var i=this.r,r=this.g,n=this.b,s=this.a;return i+=(t.r-i)*e,r+=(t.g-r)*e,n+=(t.b-n)*e,s+=(t.a-s)*e,this._val=Math.floor((s<<24>>>0)+(n<<16)+(r<<8)+i),this},i.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},i.toCSS=function(t){return void 0===t&&(t="rgba"),"rgba"===t?"rgba("+this.r+","+this.g+","+this.b+","+(this.a*(1/255)).toFixed(2)+")":"rgb"===t?"rgb("+this.r+","+this.g+","+this.b+")":"#"+this.toHEX(t)},i.fromHEX=function(t){t=0===t.indexOf("#")?t.substring(1):t;var e=parseInt(t.substr(0,2),16)||0,i=parseInt(t.substr(2,2),16)||0,r=parseInt(t.substr(4,2),16)||0,n=parseInt(t.substr(6,2),16)||255;return this._val=(n<<24>>>0)+(r<<16)+(i<<8)+(0|e),this},i.toHEX=function(t){void 0===t&&(t="#rrggbb");var e=[(this.r<16?"0":"")+this.r.toString(16),(this.g<16?"0":"")+this.g.toString(16),(this.b<16?"0":"")+this.b.toString(16)];return"#rgb"===t?(e[0]=e[0][0],e[1]=e[1][0],e[2]=e[2][0]):"#rrggbbaa"===t&&e.push((this.a<16?"0":"")+this.a.toString(16)),e.join("")},i.toRGBValue=function(){return 16777215&this._val},i.fromHSV=function(t,e,i){var r=0,n=0,s=0;if(0===e)r=n=s=i;else if(0===i)r=n=s=0;else{1===t&&(t=0),t*=6;var a=Math.floor(t),o=t-a,h=i*(1-e),l=i*(1-e*o),u=i*(1-e*(1-o));switch(a){case 0:r=i,n=u,s=h;break;case 1:r=l,n=i,s=h;break;case 2:r=h,n=i,s=u;break;case 3:r=h,n=l,s=i;break;case 4:r=u,n=h,s=i;break;case 5:r=i,n=h,s=l}}return r*=255,n*=255,s*=255,this._val=(this.a<<24>>>0)+(s<<16)+(n<<8)+(0|r),this},i.toHSV=function(){var t=this.r*(1/255),e=this.g*(1/255),i=this.b*(1/255),r={h:0,s:0,v:0},n=Math.max(t,e,i),s=Math.min(t,e,i),a=0;return r.v=n,r.s=n?(n-s)/n:0,r.s?(a=n-s,r.h=t===n?(e-i)/a:e===n?2+(i-t)/a:4+(t-e)/a,r.h/=6,r.h<0&&(r.h+=1)):r.h=0,r},i.set=function(t,e,i,r){return"object"==typeof t?null!=t._val?this._val=t._val:(e=t.g||0,i=t.b||0,r="number"==typeof t.a?t.a:255,t=t.r||0,this._val=(r<<24>>>0)+(i<<16)+(e<<8)+(0|t)):(t=t||0,e=e||0,i=i||0,r="number"==typeof r?r:255,this._val=(r<<24>>>0)+(i<<16)+(e<<8)+(0|t)),this},i.multiply=function(t){var e=(255&this._val)*t.r>>8,i=(65280&this._val)*t.g>>8,r=(16711680&this._val)*t.b>>8,n=((4278190080&this._val)>>>8)*t.a;return this._val=4278190080&n|16711680&r|65280&i|255&e,this},i._set_r_unsafe=function(t){return this._val=(4294967040&this._val|t)>>>0,this},i._set_g_unsafe=function(t){return this._val=(4294902015&this._val|t<<8)>>>0,this},i._set_b_unsafe=function(t){return this._val=(4278255615&this._val|t<<16)>>>0,this},i._set_a_unsafe=function(t){return this._val=(16777215&this._val|t<<24)>>>0,this},e}(Dt));function Js(t,e,i,r){return new Qs(t,e,i,r)}Qs.WHITE=Object.freeze(new Qs(255,255,255,255)),Qs.GRAY=Object.freeze(new Qs(127,127,127,255)),Qs.BLACK=Object.freeze(new Qs(0,0,0,255)),Qs.TRANSPARENT=Object.freeze(new Qs(0,0,0,0)),Qs.RED=Object.freeze(new Qs(255,0,0,255)),Qs.GREEN=Object.freeze(new Qs(0,255,0,255)),Qs.BLUE=Object.freeze(new Qs(0,0,255,255)),Qs.CYAN=Object.freeze(new Qs(0,255,255,255)),Qs.MAGENTA=Object.freeze(new Qs(255,0,255,255)),Qs.YELLOW=Object.freeze(new Qs(255,255,0,255)),Ae.fastDefine("cc.Color",Qs,{r:0,g:0,b:0,a:255}),_.Color=Qs,_.color=Js;var $s,ta,ea,ia,ra,na,sa=10,aa=0,oa=new Map;ia=function(t,e,i,r,n,s){var a=oa.get(s);a&&a.logTimes>a.count&&(n("'%s' is deprecated, please use '%s' instead.",t+"."+e,i+"."+r),a.count++)},$s=t("replaceProperty",(function(t,e,i){null!=t&&i.forEach((function(i){var r=aa++;oa.set(r,{id:r,count:0,logTimes:void 0!==i.logTimes?i.logTimes:sa});var n=null!=i.target?i.target:t,s=null!=i.newName?i.newName:i.name,a=null!=i.targetName?i.targetName:e,o=n==t;if(null!=i.customFunction)t[i.name]=function(){var t;return ia(e,i.name,a,s,E,r),(t=i.customFunction).call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))};else if(null!=i.customSetter||null!=i.customGetter){var h=null!=i.customSetter,l=null!=i.customGetter;h&&l?Object.defineProperty(t,i.name,{get:function(){return ia(e,i.name,a,s,E,r),i.customGetter.call(this)},set:function(t){ia(e,i.name,a,s,E,r),i.customSetter.call(this,t)},enumerable:!1}):h?Object.defineProperty(t,i.name,{set:function(t){ia(e,i.name,a,s,E,r),i.customSetter.call(this,t)},enumerable:!1}):l&&Object.defineProperty(t,i.name,{get:function(){return ia(e,i.name,a,s,E,r),i.customGetter.call(this)},enumerable:!1})}else Object.defineProperty(t,i.name,{get:function(){return ia(e,i.name,a,s,E,r),o?this[s]:n[s]},set:function(t){ia(e,i.name,a,s,E,r),o?this[s]=t:n[s]=t},enumerable:!1})}))})),na=function(t,e,i,r,n){var s=oa.get(r),a=void 0===n?"":"("+n+")";s&&s.logTimes>s.count&&(i("'%s' has been removed. "+a,t+"."+e),s.count++)},ta=t("removeProperty",(function(t,e,i){null!=t&&i.forEach((function(i){var r=aa++;oa.set(r,{id:r,count:0,logTimes:void 0!==i.logTimes?i.logTimes:sa}),Object.defineProperty(t,i.name,{get:function(){return na(e,i.name,S,r,i.suggest)},set:function(){na(e,i.name,S,r,i.suggest)},enumerable:!1})}))})),ra=function(t,e,i,r,n){var s=oa.get(r),a=void 0===n?"":"("+n+")";s&&s.logTimes>s.count&&(i("'%s' is deprecated. "+a,t+"."+e),s.count++)},ea=t("markAsWarning",(function(t,e,i){if(null!=t){var r=function(t,e,i,r,n,s){if(t.get){var a=t.get();t.get=function(){return ra(e,i,r,n,s),a.call(this)}}if(t.set){var o=Object.create(t.set);t.set=function(t){ra(e,i,r,n,s),o.call(this,t)}}};i.forEach((function(i){var n=i.name,s=Object.getOwnPropertyDescriptor(t,n);if(s){var a=aa++;if(oa.set(a,{id:a,count:0,logTimes:void 0!==i.logTimes?i.logTimes:sa}),null!=s.value)if("function"==typeof s.value){var o=s.value;t[n]=function(){return ra(e,n,E,a,i.suggest),o.call.apply(o,[this].concat(Array.prototype.slice.call(arguments)))}}else r(s,e,n,E,a,i.suggest);else r(s,e,n,E,a,i.suggest);Object.defineProperty(t,n,{enumerable:!1})}}))}})),$s(Es,"Vec2",[{name:"sub",newName:"subtract",target:Es,targetName:"Vec2"},{name:"mul",newName:"multiply",target:Es,targetName:"Vec2"},{name:"div",newName:"divide",target:Es,targetName:"Vec2"},{name:"dist",newName:"distance",target:Es,targetName:"Vec2"},{name:"sqrDist",newName:"squaredDistance",target:Es,targetName:"Vec2"},{name:"mag",newName:"len",target:Es,targetName:"Vec2"},{name:"sqrMag",newName:"lengthSqr",target:Es,targetName:"Vec2"},{name:"scale",newName:"multiplyScalar",target:Es,targetName:"Vec2"},{name:"exactEquals",newName:"strictEquals",target:Es,targetName:"Vec2"}]),$s(Es.prototype,"Vec2",[{name:"mag",newName:"length",target:Es.prototype,targetName:"Vec2"},{name:"magSqr",newName:"lengthSqr",target:Es.prototype,targetName:"Vec2"},{name:"scale",newName:"multiplyScalar",target:Es.prototype,targetName:"Vec2"},{name:"exactEquals",newName:"strictEquals",target:Es.prototype,targetName:"Vec2"}]),$s(Cs,"Vec3",[{name:"sub",newName:"subtract",target:Cs,targetName:"Vec3"},{name:"mul",newName:"multiply",target:Cs,targetName:"Vec3"},{name:"div",newName:"divide",target:Cs,targetName:"Vec3"},{name:"dist",newName:"distance",target:Cs,targetName:"Vec3"},{name:"sqrDist",newName:"squaredDistance",target:Cs,targetName:"Vec3"},{name:"mag",newName:"len",target:Cs,targetName:"Vec3"},{name:"sqrMag",newName:"lengthSqr",target:Cs,targetName:"Vec3"},{name:"scale",newName:"multiplyScalar",target:Cs,targetName:"Vec3"},{name:"exactEquals",newName:"strictEquals",target:Cs,targetName:"Vec3"}]),$s(Cs.prototype,"Vec3",[{name:"mag",newName:"length",target:Cs.prototype,targetName:"Vec3"},{name:"magSqr",newName:"lengthSqr",target:Cs.prototype,targetName:"Vec3"},{name:"scale",newName:"multiplyScalar",target:Cs.prototype,targetName:"Vec3"},{name:"exactEquals",newName:"strictEquals",target:Cs.prototype,targetName:"Vec3"}]),$s(Os,"Vec4",[{name:"sub",newName:"subtract",target:Os,targetName:"Vec4"},{name:"mul",newName:"multiply",target:Os,targetName:"Vec4"},{name:"div",newName:"divide",target:Os,targetName:"Vec4"},{name:"dist",newName:"distance",target:Os,targetName:"Vec4"},{name:"sqrDist",newName:"squaredDistance",target:Os,targetName:"Vec4"},{name:"mag",newName:"len",target:Os,targetName:"Vec4"},{name:"sqrMag",newName:"lengthSqr",target:Os,targetName:"Vec4"},{name:"scale",newName:"multiplyScalar",target:Os,targetName:"Vec4"},{name:"exactEquals",newName:"strictEquals",target:Os,targetName:"Vec4"}]),$s(Os.prototype,"Vec4",[{name:"mag",newName:"length",target:Os.prototype,targetName:"Vec4"},{name:"magSqr",newName:"lengthSqr",target:Os.prototype,targetName:"Vec4"},{name:"scale",newName:"multiplyScalar",target:Os.prototype,targetName:"Vec4"},{name:"exactEquals",newName:"strictEquals",target:Os.prototype,targetName:"Vec4"}]),$s(Ns,"Quat",[{name:"mag",newName:"len",target:Ns,targetName:"Quat"},{name:"mul",newName:"multiply",target:Ns,targetName:"Quat"},{name:"sqrMag",newName:"lengthSqr",target:Ns,targetName:"Quat"},{name:"scale",newName:"multiplyScalar",target:Ns,targetName:"Quat"},{name:"exactEquals",newName:"strictEquals",target:Ns,targetName:"Quat"}]),$s(Ns.prototype,"Quat",[{name:"scale",newName:"multiplyScalar",target:Ns.prototype,targetName:"Quat"},{name:"exactEquals",newName:"strictEquals",target:Ns.prototype,targetName:"Quat"}]),$s(Qs,"Color",[{name:"sub",newName:"subtract",target:Qs,targetName:"Color"},{name:"mul",newName:"multiply",target:Qs,targetName:"Color"},{name:"div",newName:"divide",target:Qs,targetName:"Color"},{name:"exactEquals",newName:"strictEquals",target:Qs,targetName:"Color"},{name:"fromHex",newName:"fromHEX",customFunction:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var r=e[1].toString(16);return _.Color.fromHEX(e[0],r)}}]),$s(Ms,"Mat3",[{name:"sub",newName:"subtract",target:Ms,targetName:"Mat3"},{name:"mul",newName:"multiply",target:Ms,targetName:"Mat3"},{name:"exactEquals",newName:"strictEquals",target:Ms,targetName:"Mat3"},{name:"transfrom",newName:"transform",target:Ms,targetName:"Mat3"}]),$s(Ms.prototype,"Mat3",[{name:"sub",newName:"subtract",target:Ms.prototype,targetName:"Mat3"},{name:"mul",newName:"multiply",target:Ms.prototype,targetName:"Mat3"},{name:"mulScalar",newName:"multiplyScalar",target:Ms.prototype,targetName:"Mat3"},{name:"exactEquals",newName:"strictEquals",target:Ms.prototype,targetName:"Mat3"}]),$s(Hs,"Mat4",[{name:"sub",newName:"subtract",target:Hs,targetName:"Mat4"},{name:"mul",newName:"multiply",target:Hs,targetName:"Mat4"},{name:"exactEquals",newName:"strictEquals",target:Hs,targetName:"Mat4"}]),$s(Hs.prototype,"Mat4",[{name:"sub",newName:"subtract",target:Hs.prototype,targetName:"Mat4"},{name:"mul",newName:"multiply",target:Hs.prototype,targetName:"Mat4"},{name:"mulScalar",newName:"multiplyScalar",target:Hs.prototype,targetName:"Mat4"},{name:"exactEquals",newName:"strictEquals",target:Hs.prototype,targetName:"Mat4"}]);var ha,la,ua,ca,_a,da,pa,fa,ma,ga,va,ya,Ta,Ea,Sa,ba,Aa,Ca=Object.freeze({__proto__:null,bits:Ts,Vec2:Es,v2:As,Vec3:Cs,v3:xs,Vec4:Os,v4:Is,Quat:Ns,quat:zs,Mat3:Ms,Mat4:Hs,mat4:js,AffineTransform:Xs,Size:Ys,size:qs,Rect:Ks,rect:Zs,Color:Qs,color:Js,EPSILON:Rr,equals:xr,approx:Or,clamp:Ir,clamp01:Mr,lerp:Br,toRadian:Pr,toDegree:Nr,random:Lr,randomRange:Fr,randomRangeInt:Dr,pseudoRandom:Ur,pseudoRandomRange:kr,pseudoRandomRangeInt:zr,nextPow2:Gr,repeat:Hr,pingPong:Vr,inverseLerp:Wr,absMaxComponent:jr,absMax:Xr});t("math",Ca);var wa,Ra=(ha=Ne("cc.AudioSource"),la=qe(),ua=We(),ca=pi(Gn),_a=pi(Gn),da=$e(),pa=$e(),fa=$e(),ma=ti(),ga=$e(),wa=ha(va=la(va=ua((Aa=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"_clip",Ta,a(e)),l(e,"_loop",Ea,a(e)),l(e,"_playOnAwake",Sa,a(e)),l(e,"_volume",ba,a(e)),e._cachedCurrentTime=0,e}s(e,t);var i=e.prototype;return i.onLoad=function(){this._syncStates(),this._playOnAwake&&this.play()},i.onDisable=function(){this.pause()},i.onDestroy=function(){this.stop()},i.play=function(){this._clip&&this._clip.play()},i.pause=function(){this._clip&&this._clip.pause()},i.stop=function(){this._clip&&this._clip.stop()},i.playOneShot=function(t,e){void 0===e&&(e=1),t.playOneShot(this._volume*e)},i._syncStates=function(){this._clip&&(this._clip.setCurrentTime(this._cachedCurrentTime),this._clip.setLoop(this._loop),this._clip.setVolume(this._volume,!0),this._volume=this._clip.getVolume())},r(e,[{key:"clip",set:function(t){this._clip=t,this._syncStates()},get:function(){return this._clip}},{key:"loop",set:function(t){this._loop=t,this._clip&&this._clip.setLoop(t)},get:function(){return this._loop}},{key:"playOnAwake",set:function(t){this._playOnAwake=t},get:function(){return this._playOnAwake}},{key:"volume",set:function(t){isNaN(t)?console.warn("illegal audio volume!"):(t=Ir(t,0,1),this._clip?(this._clip.setVolume(t),this._volume=this._clip.getVolume()):this._volume=t)},get:function(){return this._volume}},{key:"currentTime",set:function(t){isNaN(t)?console.warn("illegal audio time!"):(t=Ir(t,0,this.duration),this._cachedCurrentTime=t,this._clip&&this._clip.setCurrentTime(this._cachedCurrentTime))},get:function(){return this._clip?this._clip.getCurrentTime():this._cachedCurrentTime}},{key:"duration",get:function(){return this._clip?this._clip.getDuration():0}},{key:"state",get:function(){return this._clip?this._clip.state:Gn.PlayingState.INITIALIZING}},{key:"playing",get:function(){return this.state===Gn.PlayingState.PLAYING}}]),e}(ds),Ta=u((ya=Aa).prototype,"_clip",[ca],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ea=u(ya.prototype,"_loop",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Sa=u(ya.prototype,"_playOnAwake",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ba=u(ya.prototype,"_volume",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),u(ya.prototype,"clip",[_a,da],Object.getOwnPropertyDescriptor(ya.prototype,"clip"),ya.prototype),u(ya.prototype,"loop",[pa],Object.getOwnPropertyDescriptor(ya.prototype,"loop"),ya.prototype),u(ya.prototype,"playOnAwake",[fa],Object.getOwnPropertyDescriptor(ya.prototype,"playOnAwake"),ya.prototype),u(ya.prototype,"volume",[ma,ga],Object.getOwnPropertyDescriptor(ya.prototype,"volume"),ya.prototype),va=ya))||va)||va)||va,t({AudioSource:wa,AudioSourceComponent:wa}),wa);_.AudioSourceComponent=Ra,Mt.setClassAlias(Ra,"cc.AudioSourceComponent"),_.log=T,_.warn=E,_.error=S,_.assert=b,_._throw=C,_.logID=x,_.warnID=I,_.errorID=B,_.assertID=L,_.debug=k,_.path={join:_r,extname:dr,mainFileName:pr,basename:fr,dirname:mr,changeExtname:gr,changeBasename:vr,_normalize:yr,stripSep:Tr,get sep(){return Er()}};var xa={SHAPE_RAY:1,SHAPE_LINE:2,SHAPE_SPHERE:4,SHAPE_AABB:8,SHAPE_OBB:16,SHAPE_PLANE:32,SHAPE_TRIANGLE:64,SHAPE_FRUSTUM:128,SHAPE_FRUSTUM_ACCURATE:256,SHAPE_CAPSULE:512},Oa=new Cs,Ia=new Cs,Ma=new Cs,Ba=new Cs,Pa=new Cs,Na=new Cs,La=new Array(3),Fa=new Array(3);function Da(t,e){return Cs.dot(e.n,t)-e.d}function Ua(t,e,i){return Cs.copy(t,e),Cs.subtract(Pa,i.center,i.halfExtents),Cs.add(Na,i.center,i.halfExtents),t.x=t.x<Pa.x?Pa.x:t.x,t.y=t.y<Pa.y?Pa.y:t.y,t.z=t.z<Pa.z?Pa.z:t.z,t.x=t.x>Na.x?Na.x:t.x,t.y=t.y>Na.y?Na.y:t.y,t.z=t.z>Na.z?Na.z:t.z,t}function ka(t,e,i){Cs.set(Oa,i.orientation.m00,i.orientation.m01,i.orientation.m02),Cs.set(Ia,i.orientation.m03,i.orientation.m04,i.orientation.m05),Cs.set(Ma,i.orientation.m06,i.orientation.m07,i.orientation.m08),La[0]=Oa,La[1]=Ia,La[2]=Ma,Fa[0]=i.halfExtents.x,Fa[1]=i.halfExtents.y,Fa[2]=i.halfExtents.z,Cs.subtract(Ba,e,i.center),Cs.set(t,i.center.x,i.center.y,i.center.z);for(var r=0;r<3;r++){var n=Cs.dot(Ba,La[r]);n>Fa[r]&&(n=Fa[r]),n<-Fa[r]&&(n=-Fa[r]),t.x+=n*La[r].x,t.y+=n*La[r].y,t.z+=n*La[r].z}return t}var za,Ga,Ha,Va,Wa,ja,Xa,Ya,qa,Ka,Za,Qa,Ja,$a,to,eo,io,ro,no,so,ao,oo,ho,lo=Object.freeze({__proto__:null,point_plane:Da,pt_point_plane:function(t,e,i){var r=Da(e,i);return Cs.subtract(t,e,Cs.multiplyScalar(t,i.n,r))},pt_point_aabb:Ua,pt_point_obb:ka,pt_point_line:function(t,e,i,r){Cs.subtract(Oa,i,r);var n=Oa,s=Cs.lengthSqr(n);if(0==s)Cs.copy(t,i);else{Cs.subtract(Oa,e,i);var a=Cs.dot(Oa,n)/s;a<0?Cs.copy(t,i):a>1?Cs.copy(t,r):Cs.scaleAndAdd(t,i,n,a)}}}),uo=function(){function t(t,e,i,r,n,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===s&&(s=-1),this.o=void 0,this.d=void 0,this._type=void 0,this._type=xa.SHAPE_RAY,this.o=new Cs(t,e,i),this.d=new Cs(r,n,s)}return t.create=function(e,i,r,n,s,a){return void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===a&&(a=1),new t(e,i,r,n,s,a)},t.clone=function(e){return new t(e.o.x,e.o.y,e.o.z,e.d.x,e.d.y,e.d.z)},t.copy=function(t,e){return Cs.copy(t.o,e.o),Cs.copy(t.d,e.d),t},t.fromPoints=function(t,e,i){return Cs.copy(t.o,e),Cs.normalize(t.d,Cs.subtract(t.d,i,e)),t},t.set=function(t,e,i,r,n,s,a){return t.o.x=e,t.o.y=i,t.o.z=r,t.d.x=n,t.d.y=s,t.d.z=a,t},r(t,[{key:"type",get:function(){return this._type}}]),t.prototype.computeHit=function(t,e){Cs.normalize(t,this.d),Cs.scaleAndAdd(t,this.o,t,e)},t}(),co=function(){function t(t,e,i){this._arrayBuffers=[],this._chunkSize=void 0,this._chunkSize=i*(1<<e)}return t.prototype.allocateNewChunk=function(){return new ArrayBuffer(this._chunkSize)},t}(),_o=function(){},po=function(){function t(){}var e=t.prototype;return e.alloc=function(t,e){return new ArrayBuffer(e)},e.free=function(){},t}();!function(t){t[t.UINT32=0]="UINT32",t[t.FLOAT32=1]="FLOAT32",t[t.NEVER=2]="NEVER"}(ho||(ho={}));var fo,mo=function(){function t(t,e,i,r){void 0===r&&(r=8),this._dataType=void 0,this._elementCount=void 0,this._entryBits=void 0,this._stride=void 0,this._entriesPerChunk=void 0,this._entryMask=void 0,this._chunkMask=void 0,this._poolFlag=void 0,this._arrayBuffers=[],this._freelists=[],this._uint32BufferViews=[],this._float32BufferViews=[],this._hasUint32=!1,this._hasFloat32=!1,this._nativePool=void 0,this._elementCount=i.COUNT,this._entryBits=r,this._dataType=e,this._stride=4*this._elementCount,this._entriesPerChunk=1<<r,this._entryMask=this._entriesPerChunk-1,this._poolFlag=1<<30,this._chunkMask=~(this._entryMask|this._poolFlag),this._nativePool=new co(t,r,this._stride);var n=ho.NEVER,s=!1,a=!1;for(var o in e){if(s=this._hasFloat32,(a=this._hasUint32)&&s)break;n=e[o],s||n!==ho.FLOAT32?a||n!==ho.UINT32||(this._hasUint32=!0):this._hasFloat32=!0}}var e=t.prototype;return e.alloc=function(){for(var t=0;t<this._freelists.length;t++){var e=this._freelists[t];if(e.length){var i=e[e.length-1];return e.length--,(t<<this._entryBits)+i+this._poolFlag}}for(var r=this._nativePool.allocateNewChunk(),n=[],s=[],a=[],o=this._hasFloat32,h=this._hasUint32,l=0;l<this._entriesPerChunk;l++)o&&n.push(new Float32Array(r,this._stride*l,this._elementCount)),h&&s.push(new Uint32Array(r,this._stride*l,this._elementCount)),l&&a.push(l);return this._arrayBuffers.push(r),h&&this._uint32BufferViews.push(s),o&&this._float32BufferViews.push(n),this._freelists.push(a),(t<<this._entryBits)+this._poolFlag},e.get=function(t,e){var i=(this._chunkMask&t)>>this._entryBits,r=this._entryMask&t;return(this._dataType[e]===ho.UINT32?this._uint32BufferViews:this._float32BufferViews)[i][r][e]},e.set=function(t,e,i){var r=(this._chunkMask&t)>>this._entryBits,n=this._entryMask&t;(this._dataType[e]===ho.UINT32?this._uint32BufferViews:this._float32BufferViews)[r][n][e]=i},e.setVec2=function(){},e.setVec3=function(){},e.setVec4=function(){},e.setMat4=function(){},e.free=function(t){var e=(this._chunkMask&t)>>this._entryBits,i=this._entryMask&t;(this._hasUint32?this._uint32BufferViews:this._float32BufferViews)[e][i].fill(0),this._freelists[e].push(i)},t}(),go=function(){function t(t,e,i){this._ctor=void 0,this._dtor=void 0,this._indexMask=void 0,this._poolFlag=void 0,this._array=[],this._freelist=[],this._nativePool=void 0,this._ctor=e,i&&(this._dtor=i),this._poolFlag=1<<29,this._indexMask=~this._poolFlag,this._nativePool=new _o(t,this._array)}var e=t.prototype;return e.alloc=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var r=this._freelist,n=-1;if(r.length)n=r[r.length-1],r.length--,this._array[n]=this._ctor(arguments,this._array[n]);else{n=this._array.length;var s=this._ctor(arguments);if(!s)return 0;this._array.push(s)}return n+this._poolFlag},e.get=function(t){var e=this._indexMask&t;return this._array[e]},e.free=function(t){var e=this._indexMask&t;this._dtor&&(this._array[e]=this._dtor(this._array[e])),this._freelist.push(e)},t}(),vo=function(){function t(t){this._nativeBufferAllocator=void 0,this._buffers=new Map,this._nextBufferIdx=0,this._poolFlag=void 0,this._bufferIdxMask=void 0,this._poolFlag=1<<30,this._bufferIdxMask=~this._poolFlag,this._nativeBufferAllocator=new po(t)}var e=t.prototype;return e.alloc=function(t){var e=this._nextBufferIdx++,i=this._nativeBufferAllocator.alloc(e,t);return this._buffers.set(e,i),e|this._poolFlag},e.free=function(t){var e=this._bufferIdxMask&t;this._buffers.get(e)&&(this._nativeBufferAllocator.free(e),this._buffers.delete(e))},e.getBuffer=function(t){var e=this._bufferIdxMask&t;return this._buffers.get(e)||null},t}(),yo=function(t){function e(e,i,r,n){var s;return(s=t.call(this,e)||this)._viewCtor=void 0,s._size=void 0,s._step=void 0,s._viewCtor=i,s._size=r*i.BYTES_PER_ELEMENT,s._step=n||r,s}s(e,t);var i=e.prototype;return i.alloc=function(){var t=this._nextBufferIdx++,e=this._nativeBufferAllocator.alloc(t,this._size);return this._buffers.set(t,new this._viewCtor(e)),t|this._poolFlag},i.getBuffer=function(){return null},i.assign=function(t,e,i){var r=this._bufferIdxMask&t,n=this._buffers.get(r);if(n){var s=e+1;if(s>=n.length){for(var a=n.length;s>=a;)a+=this._step;a*=this._viewCtor.BYTES_PER_ELEMENT;var o=new this._viewCtor(this._nativeBufferAllocator.alloc(r,a));o.set(n),n=o,this._buffers.set(r,n)}n[s]=i;var h=n[0];n[0]=s>h?s:h}},i.erase=function(t,e){var i=this._bufferIdxMask&t,r=this._buffers.get(i);if(r&&!(e>=r[0])){for(var n=e+1;n<r[0];++n)r[n]=r[n+1];--r[0]}},i.push=function(t,e){var i=this._bufferIdxMask&t,r=this._buffers.get(i);r&&this.assign(t,r[0],e)},i.pop=function(t){var e=this._bufferIdxMask&t,i=this._buffers.get(e);i&&0!==i[0]&&--i[0]},i.clear=function(t){var e=this._bufferIdxMask&t,i=this._buffers.get(e);i&&(i[0]=0)},i.get=function(t,e){var i=this._bufferIdxMask&t,r=this._buffers.get(i);return!r||e>=r[0]?0:r[e+1]},i.length=function(t){var e=this._bufferIdxMask&t,i=this._buffers.get(e);return i?i[0]:0},e}(vo);function To(t,e,i,r){void 0===r&&(r=!0);for(var n=e.length(t),s=0;s<n;s++){var a=e.get(t,s);a&&i.free(a)}r?e.free(t):e.clear(t)}!function(t){t[t.ATTRIBUTE=0]="ATTRIBUTE",t[t.DESCRIPTOR_SETS=1]="DESCRIPTOR_SETS",t[t.SHADER=2]="SHADER",t[t.INPUT_ASSEMBLER=3]="INPUT_ASSEMBLER",t[t.PIPELINE_LAYOUT=4]="PIPELINE_LAYOUT",t[t.FRAMEBUFFER=5]="FRAMEBUFFER",t[t.PASS=100]="PASS",t[t.SUB_MODEL=101]="SUB_MODEL",t[t.MODEL=102]="MODEL",t[t.SCENE=103]="SCENE",t[t.CAMERA=104]="CAMERA",t[t.NODE=105]="NODE",t[t.ROOT=106]="ROOT",t[t.AABB=107]="AABB",t[t.RENDER_WINDOW=108]="RENDER_WINDOW",t[t.FRUSTUM=109]="FRUSTUM",t[t.AMBIENT=110]="AMBIENT",t[t.FOG=111]="FOG",t[t.SKYBOX=112]="SKYBOX",t[t.SHADOW=113]="SHADOW",t[t.LIGHT=114]="LIGHT",t[t.SPHERE=115]="SPHERE",t[t.INSTANCED_ATTRIBUTE=116]="INSTANCED_ATTRIBUTE",t[t.FLAT_BUFFER=117]="FLAT_BUFFER",t[t.SUB_MESH=118]="SUB_MESH",t[t.RASTERIZER_STATE=119]="RASTERIZER_STATE",t[t.DEPTH_STENCIL_STATE=120]="DEPTH_STENCIL_STATE",t[t.BLEND_TARGET=121]="BLEND_TARGET",t[t.BLEND_STATE=122]="BLEND_STATE",t[t.SUB_MODEL_ARRAY=200]="SUB_MODEL_ARRAY",t[t.MODEL_ARRAY=201]="MODEL_ARRAY",t[t.ATTRIBUTE_ARRAY=202]="ATTRIBUTE_ARRAY",t[t.FLAT_BUFFER_ARRAY=203]="FLAT_BUFFER_ARRAY",t[t.INSTANCED_BUFFER_ARRAY=204]="INSTANCED_BUFFER_ARRAY",t[t.LIGHT_ARRAY=205]="LIGHT_ARRAY",t[t.BLEND_TARGET_ARRAY=206]="BLEND_TARGET_ARRAY",t[t.RAW_BUFFER=300]="RAW_BUFFER",t[t.RAW_OBJECT=400]="RAW_OBJECT"}(fo||(fo={}));var Eo,So=new go(fo.SHADER,(function(t,e){return e?(e.initialize(t[1]),e):t[0].createShader(t[1])}),(function(t){return t&&t.destroy(),t})),bo=new go(fo.DESCRIPTOR_SETS,(function(t,e){return e?(e.initialize(t[1]),e):t[0].createDescriptorSet(t[1])}),(function(t){return t&&t.destroy(),t})),Ao=new go(fo.INPUT_ASSEMBLER,(function(t,e){return e?(e.initialize(t[1]),e):t[0].createInputAssembler(t[1])}),(function(t){return t&&t.destroy(),t})),Co=new go(fo.PIPELINE_LAYOUT,(function(t,e){return e?(e.initialize(t[1]),e):t[0].createPipelineLayout(t[1])}),(function(t){return t&&t.destroy(),t})),wo=new go(fo.FRAMEBUFFER,(function(t,e){return e?(e.initialize(t[1]),e):t[0].createFramebuffer(t[1])}),(function(t){return t&&t.destroy(),t})),Ro=new yo(fo.SUB_MODEL_ARRAY,Uint32Array,8,4),xo=new yo(fo.MODEL_ARRAY,Uint32Array,32,16),Oo=new yo(fo.ATTRIBUTE_ARRAY,Uint32Array,8,4),Io=new yo(fo.FLAT_BUFFER_ARRAY,Uint32Array,8,4),Mo=new yo(fo.LIGHT_ARRAY,Uint32Array,8,4),Bo=new yo(fo.BLEND_TARGET_ARRAY,Uint32Array,8,4),Po=new vo(fo.RAW_BUFFER),No=new go(fo.RAW_OBJECT,(function(t){return t[0]||{}}),(function(){}));!function(t){t[t.PRIORITY=0]="PRIORITY",t[t.STAGE=1]="STAGE",t[t.PHASE=2]="PHASE",t[t.BATCHING_SCHEME=3]="BATCHING_SCHEME",t[t.PRIMITIVE=4]="PRIMITIVE",t[t.DYNAMIC_STATES=5]="DYNAMIC_STATES",t[t.HASH=6]="HASH",t[t.RASTERIZER_STATE=7]="RASTERIZER_STATE",t[t.DEPTH_STENCIL_STATE=8]="DEPTH_STENCIL_STATE",t[t.BLEND_STATE=9]="BLEND_STATE",t[t.DESCRIPTOR_SET=10]="DESCRIPTOR_SET",t[t.PIPELINE_LAYOUT=11]="PIPELINE_LAYOUT",t[t.COUNT=12]="COUNT"}(Eo||(Eo={}));var Lo,Fo=((za={})[Eo.PRIORITY]=ho.UINT32,za[Eo.STAGE]=ho.UINT32,za[Eo.PHASE]=ho.UINT32,za[Eo.BATCHING_SCHEME]=ho.UINT32,za[Eo.PRIMITIVE]=ho.UINT32,za[Eo.DYNAMIC_STATES]=ho.UINT32,za[Eo.HASH]=ho.UINT32,za[Eo.RASTERIZER_STATE]=ho.UINT32,za[Eo.DEPTH_STENCIL_STATE]=ho.UINT32,za[Eo.BLEND_STATE]=ho.UINT32,za[Eo.DESCRIPTOR_SET]=ho.UINT32,za[Eo.PIPELINE_LAYOUT]=ho.UINT32,za[Eo.COUNT]=ho.NEVER,za),Do=new mo(fo.PASS,Fo,Eo);!function(t){t[t.PRIORITY=0]="PRIORITY",t[t.PASS_COUNT=1]="PASS_COUNT",t[t.PASS_0=2]="PASS_0",t[t.PASS_1=3]="PASS_1",t[t.PASS_2=4]="PASS_2",t[t.PASS_3=5]="PASS_3",t[t.SHADER_0=6]="SHADER_0",t[t.SHADER_1=7]="SHADER_1",t[t.SHADER_2=8]="SHADER_2",t[t.SHADER_3=9]="SHADER_3",t[t.DESCRIPTOR_SET=10]="DESCRIPTOR_SET",t[t.INPUT_ASSEMBLER=11]="INPUT_ASSEMBLER",t[t.SUB_MESH=12]="SUB_MESH",t[t.COUNT=13]="COUNT"}(Lo||(Lo={}));var Uo,ko=((Ga={})[Lo.PRIORITY]=ho.UINT32,Ga[Lo.PASS_COUNT]=ho.UINT32,Ga[Lo.PASS_0]=ho.UINT32,Ga[Lo.PASS_1]=ho.UINT32,Ga[Lo.PASS_2]=ho.UINT32,Ga[Lo.PASS_3]=ho.UINT32,Ga[Lo.SHADER_0]=ho.UINT32,Ga[Lo.SHADER_1]=ho.UINT32,Ga[Lo.SHADER_2]=ho.UINT32,Ga[Lo.SHADER_3]=ho.UINT32,Ga[Lo.DESCRIPTOR_SET]=ho.UINT32,Ga[Lo.INPUT_ASSEMBLER]=ho.UINT32,Ga[Lo.SUB_MESH]=ho.UINT32,Ga[Lo.COUNT]=ho.NEVER,Ga),zo=new mo(fo.SUB_MODEL,ko,Lo);!function(t){t[t.ENABLED=0]="ENABLED",t[t.VIS_FLAGS=1]="VIS_FLAGS",t[t.CAST_SHADOW=2]="CAST_SHADOW",t[t.RECEIVE_SHADOW=3]="RECEIVE_SHADOW",t[t.WORLD_BOUNDS=4]="WORLD_BOUNDS",t[t.NODE=5]="NODE",t[t.TRANSFORM=6]="TRANSFORM",t[t.SUB_MODEL_ARRAY=7]="SUB_MODEL_ARRAY",t[t.INSTANCED_BUFFER=8]="INSTANCED_BUFFER",t[t.INSTANCED_ATTR_ARRAY=9]="INSTANCED_ATTR_ARRAY",t[t.COUNT=10]="COUNT"}(Uo||(Uo={}));var Go,Ho=((Ha={})[Uo.ENABLED]=ho.UINT32,Ha[Uo.VIS_FLAGS]=ho.UINT32,Ha[Uo.CAST_SHADOW]=ho.UINT32,Ha[Uo.RECEIVE_SHADOW]=ho.UINT32,Ha[Uo.WORLD_BOUNDS]=ho.UINT32,Ha[Uo.NODE]=ho.UINT32,Ha[Uo.TRANSFORM]=ho.UINT32,Ha[Uo.SUB_MODEL_ARRAY]=ho.UINT32,Ha[Uo.INSTANCED_BUFFER]=ho.UINT32,Ha[Uo.INSTANCED_ATTR_ARRAY]=ho.UINT32,Ha[Uo.COUNT]=ho.NEVER,Ha),Vo=new mo(fo.MODEL,Ho,Uo);!function(t){t[t.CENTER=0]="CENTER",t[t.HALF_EXTENSION=3]="HALF_EXTENSION",t[t.COUNT=6]="COUNT"}(Go||(Go={}));var Wo,jo=((Va={})[Go.CENTER]=ho.FLOAT32,Va[Go.HALF_EXTENSION]=ho.FLOAT32,Va[Go.COUNT]=ho.NEVER,Va),Xo=new mo(fo.AABB,jo,Go);!function(t){t[t.MAIN_LIGHT=0]="MAIN_LIGHT",t[t.MODEL_ARRAY=1]="MODEL_ARRAY",t[t.SPHERE_LIGHT_ARRAY=2]="SPHERE_LIGHT_ARRAY",t[t.SPOT_LIGHT_ARRAY=3]="SPOT_LIGHT_ARRAY",t[t.COUNT=4]="COUNT"}(Wo||(Wo={}));var Yo,qo=((Wa={})[Wo.MAIN_LIGHT]=ho.UINT32,Wa[Wo.MODEL_ARRAY]=ho.UINT32,Wa[Wo.SPHERE_LIGHT_ARRAY]=ho.UINT32,Wa[Wo.SPOT_LIGHT_ARRAY]=ho.UINT32,Wa[Wo.COUNT]=ho.NEVER,Wa),Ko=new mo(fo.SCENE,qo,Wo);!function(t){t[t.WIDTH=0]="WIDTH",t[t.HEIGHT=1]="HEIGHT",t[t.EXPOSURE=2]="EXPOSURE",t[t.CLEAR_FLAG=3]="CLEAR_FLAG",t[t.CLEAR_DEPTH=4]="CLEAR_DEPTH",t[t.CLEAR_STENCIL=5]="CLEAR_STENCIL",t[t.NODE=6]="NODE",t[t.SCENE=7]="SCENE",t[t.FRUSTUM=8]="FRUSTUM",t[t.FORWARD=9]="FORWARD",t[t.POSITION=12]="POSITION",t[t.VIEW_PORT=15]="VIEW_PORT",t[t.CLEAR_COLOR=19]="CLEAR_COLOR",t[t.MAT_VIEW=23]="MAT_VIEW",t[t.MAT_VIEW_PROJ=39]="MAT_VIEW_PROJ",t[t.MAT_VIEW_PROJ_INV=55]="MAT_VIEW_PROJ_INV",t[t.MAT_PROJ=71]="MAT_PROJ",t[t.MAT_PROJ_INV=87]="MAT_PROJ_INV",t[t.COUNT=103]="COUNT"}(Yo||(Yo={}));var Zo,Qo=((ja={})[Yo.WIDTH]=ho.UINT32,ja[Yo.HEIGHT]=ho.UINT32,ja[Yo.EXPOSURE]=ho.FLOAT32,ja[Yo.CLEAR_FLAG]=ho.UINT32,ja[Yo.CLEAR_DEPTH]=ho.FLOAT32,ja[Yo.CLEAR_STENCIL]=ho.UINT32,ja[Yo.NODE]=ho.UINT32,ja[Yo.SCENE]=ho.UINT32,ja[Yo.FRUSTUM]=ho.UINT32,ja[Yo.FORWARD]=ho.FLOAT32,ja[Yo.POSITION]=ho.FLOAT32,ja[Yo.VIEW_PORT]=ho.FLOAT32,ja[Yo.CLEAR_COLOR]=ho.FLOAT32,ja[Yo.MAT_VIEW]=ho.FLOAT32,ja[Yo.MAT_VIEW_PROJ]=ho.FLOAT32,ja[Yo.MAT_VIEW_PROJ_INV]=ho.FLOAT32,ja[Yo.MAT_PROJ]=ho.FLOAT32,ja[Yo.MAT_PROJ_INV]=ho.FLOAT32,ja[Yo.COUNT]=ho.NEVER,ja),Jo=new mo(fo.CAMERA,Qo,Yo);!function(t){t[t.FLAGS_CHANGED=0]="FLAGS_CHANGED",t[t.LAYER=1]="LAYER",t[t.WORLD_SCALE=2]="WORLD_SCALE",t[t.WORLD_POSITION=5]="WORLD_POSITION",t[t.WORLD_ROTATION=8]="WORLD_ROTATION",t[t.WORLD_MATRIX=12]="WORLD_MATRIX",t[t.COUNT=28]="COUNT"}(Zo||(Zo={}));var $o=((Xa={})[Zo.FLAGS_CHANGED]=ho.UINT32,Xa[Zo.LAYER]=ho.UINT32,Xa[Zo.WORLD_SCALE]=ho.FLOAT32,Xa[Zo.WORLD_POSITION]=ho.FLOAT32,Xa[Zo.WORLD_ROTATION]=ho.FLOAT32,Xa[Zo.WORLD_MATRIX]=ho.FLOAT32,Xa[Zo.COUNT]=ho.NEVER,Xa);delete Zo[Zo.COUNT],Zo[Zo.COUNT=Zo.LAYER+1]="COUNT";var th,eh=new mo(fo.NODE,$o,Zo);!function(t){t[t.CUMULATIVE_TIME=0]="CUMULATIVE_TIME",t[t.FRAME_TIME=1]="FRAME_TIME",t[t.COUNT=2]="COUNT"}(th||(th={}));var ih,rh=((Ya={})[th.CUMULATIVE_TIME]=ho.FLOAT32,Ya[th.FRAME_TIME]=ho.FLOAT32,Ya[th.COUNT]=ho.NEVER,Ya),nh=new mo(fo.ROOT,rh,th,1);!function(t){t[t.HAS_ON_SCREEN_ATTACHMENTS=0]="HAS_ON_SCREEN_ATTACHMENTS",t[t.HAS_OFF_SCREEN_ATTACHMENTS=1]="HAS_OFF_SCREEN_ATTACHMENTS",t[t.FRAMEBUFFER=2]="FRAMEBUFFER",t[t.COUNT=3]="COUNT"}(ih||(ih={}));var sh,ah=((qa={})[ih.HAS_ON_SCREEN_ATTACHMENTS]=ho.UINT32,qa[ih.HAS_OFF_SCREEN_ATTACHMENTS]=ho.UINT32,qa[ih.FRAMEBUFFER]=ho.UINT32,qa[ih.COUNT]=ho.NEVER,qa),oh=new mo(fo.RENDER_WINDOW,ah,ih,2);!function(t){t[t.VERTICES=0]="VERTICES",t[t.PLANES=24]="PLANES",t[t.COUNT=48]="COUNT"}(sh||(sh={}));var hh,lh=((Ka={})[sh.VERTICES]=ho.FLOAT32,Ka[sh.PLANES]=ho.FLOAT32,Ka[sh.COUNT]=ho.NEVER,Ka),uh=new mo(fo.FRUSTUM,lh,sh);!function(t){t[t.ENABLE=0]="ENABLE",t[t.ILLUM=1]="ILLUM",t[t.SKY_COLOR=2]="SKY_COLOR",t[t.GROUND_ALBEDO=6]="GROUND_ALBEDO",t[t.COUNT=10]="COUNT"}(hh||(hh={}));var ch=((Za={})[hh.ENABLE]=ho.UINT32,Za[hh.ILLUM]=ho.FLOAT32,Za[hh.SKY_COLOR]=ho.FLOAT32,Za[hh.GROUND_ALBEDO]=ho.FLOAT32,Za[hh.COUNT]=ho.NEVER,Za);delete hh[hh.COUNT],hh[hh.COUNT=hh.ILLUM+1]="COUNT";var _h,dh=new mo(fo.AMBIENT,ch,hh,1);!function(t){t[t.ENABLE=0]="ENABLE",t[t.IS_RGBE=1]="IS_RGBE",t[t.USE_IBL=2]="USE_IBL",t[t.MODEL=3]="MODEL",t[t.COUNT=4]="COUNT"}(_h||(_h={}));var ph,fh=((Qa={})[_h.ENABLE]=ho.UINT32,Qa[_h.IS_RGBE]=ho.UINT32,Qa[_h.USE_IBL]=ho.UINT32,Qa[_h.MODEL]=ho.UINT32,Qa[_h.COUNT]=ho.NEVER,Qa),mh=new mo(fo.SKYBOX,fh,_h,1);!function(t){t[t.ENABLE=0]="ENABLE",t[t.TYPE=1]="TYPE",t[t.DENSITY=2]="DENSITY",t[t.START=3]="START",t[t.END=4]="END",t[t.ATTEN=5]="ATTEN",t[t.TOP=6]="TOP",t[t.RANGE=7]="RANGE",t[t.COLOR=8]="COLOR",t[t.COUNT=12]="COUNT"}(ph||(ph={}));var gh=((Ja={})[ph.ENABLE]=ho.UINT32,Ja[ph.TYPE]=ho.UINT32,Ja[ph.DENSITY]=ho.FLOAT32,Ja[ph.START]=ho.FLOAT32,Ja[ph.END]=ho.FLOAT32,Ja[ph.ATTEN]=ho.FLOAT32,Ja[ph.TOP]=ho.FLOAT32,Ja[ph.RANGE]=ho.FLOAT32,Ja[ph.COLOR]=ho.FLOAT32,Ja[ph.COUNT]=ho.NEVER,Ja);delete ph[ph.COUNT],ph[ph.COUNT=ph.RANGE+1]="COUNT";var vh,yh=new mo(fo.FOG,gh,ph);!function(t){t[t.ENABLE=0]="ENABLE",t[t.DIRTY=1]="DIRTY",t[t.TYPE=2]="TYPE",t[t.DISTANCE=3]="DISTANCE",t[t.INSTANCE_PASS=4]="INSTANCE_PASS",t[t.PLANAR_PASS=5]="PLANAR_PASS",t[t.PLANAR_SHADER=6]="PLANAR_SHADER",t[t.NEAR=7]="NEAR",t[t.FAR=8]="FAR",t[t.ASPECT=9]="ASPECT",t[t.PCF_TYPE=10]="PCF_TYPE",t[t.SHADOW_MAP_DIRTY=11]="SHADOW_MAP_DIRTY",t[t.BIAS=12]="BIAS",t[t.ORTHO_SIZE=13]="ORTHO_SIZE",t[t.AUTO_ADAPT=14]="AUTO_ADAPT",t[t.COLOR=15]="COLOR",t[t.SIZE=19]="SIZE",t[t.NORMAL=21]="NORMAL",t[t.MAT_LIGHT=24]="MAT_LIGHT",t[t.COUNT=40]="COUNT"}(vh||(vh={}));var Th=(($a={})[vh.ENABLE]=ho.UINT32,$a[vh.DIRTY]=ho.UINT32,$a[vh.TYPE]=ho.UINT32,$a[vh.DISTANCE]=ho.FLOAT32,$a[vh.INSTANCE_PASS]=ho.UINT32,$a[vh.PLANAR_PASS]=ho.UINT32,$a[vh.PLANAR_SHADER]=ho.UINT32,$a[vh.NEAR]=ho.FLOAT32,$a[vh.FAR]=ho.FLOAT32,$a[vh.ASPECT]=ho.FLOAT32,$a[vh.PCF_TYPE]=ho.UINT32,$a[vh.SHADOW_MAP_DIRTY]=ho.UINT32,$a[vh.BIAS]=ho.FLOAT32,$a[vh.ORTHO_SIZE]=ho.FLOAT32,$a[vh.AUTO_ADAPT]=ho.UINT32,$a[vh.COLOR]=ho.FLOAT32,$a[vh.SIZE]=ho.FLOAT32,$a[vh.NORMAL]=ho.FLOAT32,$a[vh.MAT_LIGHT]=ho.FLOAT32,$a[vh.COUNT]=ho.NEVER,$a);delete vh[vh.COUNT],vh[vh.COUNT=vh.AUTO_ADAPT+1]="COUNT";var Eh,Sh=new mo(fo.SHADOW,Th,vh,1);!function(t){t[t.USE_COLOR_TEMPERATURE=0]="USE_COLOR_TEMPERATURE",t[t.ILLUMINANCE=1]="ILLUMINANCE",t[t.NODE=2]="NODE",t[t.RANGE=3]="RANGE",t[t.TYPE=4]="TYPE",t[t.AABB=5]="AABB",t[t.FRUSTUM=6]="FRUSTUM",t[t.SIZE=7]="SIZE",t[t.SPOT_ANGLE=8]="SPOT_ANGLE",t[t.ASPECT=9]="ASPECT",t[t.DIRECTION=10]="DIRECTION",t[t.COLOR=13]="COLOR",t[t.COLOR_TEMPERATURE_RGB=16]="COLOR_TEMPERATURE_RGB",t[t.POSITION=19]="POSITION",t[t.COUNT=22]="COUNT"}(Eh||(Eh={}));var bh,Ah=((to={})[Eh.USE_COLOR_TEMPERATURE]=ho.UINT32,to[Eh.ILLUMINANCE]=ho.FLOAT32,to[Eh.NODE]=ho.UINT32,to[Eh.RANGE]=ho.FLOAT32,to[Eh.TYPE]=ho.UINT32,to[Eh.AABB]=ho.UINT32,to[Eh.FRUSTUM]=ho.UINT32,to[Eh.SIZE]=ho.FLOAT32,to[Eh.SPOT_ANGLE]=ho.FLOAT32,to[Eh.ASPECT]=ho.FLOAT32,to[Eh.DIRECTION]=ho.FLOAT32,to[Eh.COLOR]=ho.FLOAT32,to[Eh.COLOR_TEMPERATURE_RGB]=ho.FLOAT32,to[Eh.POSITION]=ho.FLOAT32,to[Eh.COUNT]=ho.NEVER,to),Ch=new mo(fo.LIGHT,Ah,Eh,3);!function(t){t[t.RADIUS=0]="RADIUS",t[t.CENTER=1]="CENTER",t[t.COUNT=4]="COUNT"}(bh||(bh={}));var wh=((eo={})[bh.RADIUS]=ho.FLOAT32,eo[bh.CENTER]=ho.FLOAT32,eo[bh.COUNT]=ho.NEVER,eo);delete bh[bh.COUNT],bh[bh.COUNT=bh.RADIUS+1]="COUNT";var Rh,xh=new mo(fo.SPHERE,wh,bh,3);!function(t){t[t.STRIDE=0]="STRIDE",t[t.AMOUNT=1]="AMOUNT",t[t.BUFFER=2]="BUFFER",t[t.COUNT=3]="COUNT"}(Rh||(Rh={}));var Oh,Ih=((io={})[Rh.STRIDE]=ho.UINT32,io[Rh.AMOUNT]=ho.UINT32,io[Rh.BUFFER]=ho.UINT32,io[Rh.COUNT]=ho.NEVER,io),Mh=new mo(fo.FLAT_BUFFER,Ih,Rh,3);!function(t){t[t.FLAT_BUFFER_ARRAY=0]="FLAT_BUFFER_ARRAY",t[t.COUNT=1]="COUNT"}(Oh||(Oh={}));var Bh,Ph=((ro={})[Oh.FLAT_BUFFER_ARRAY]=ho.UINT32,ro[Oh.COUNT]=ho.NEVER,ro),Nh=new mo(fo.SUB_MESH,Ph,Oh,3);!function(t){t[t.IS_DISCARD=0]="IS_DISCARD",t[t.POLYGO_MODEL=1]="POLYGO_MODEL",t[t.SHADE_MODEL=2]="SHADE_MODEL",t[t.CULL_MODE=3]="CULL_MODE",t[t.IS_FRONT_FACE_CCW=4]="IS_FRONT_FACE_CCW",t[t.DEPTH_BIAS_ENABLED=5]="DEPTH_BIAS_ENABLED",t[t.DEPTH_BIAS=6]="DEPTH_BIAS",t[t.DEPTH_BIAS_CLAMP=7]="DEPTH_BIAS_CLAMP",t[t.DEPTH_BIAS_SLOP=8]="DEPTH_BIAS_SLOP",t[t.IS_DEPTH_CLIP=9]="IS_DEPTH_CLIP",t[t.IS_MULTI_SAMPLE=10]="IS_MULTI_SAMPLE",t[t.LINE_WIDTH=11]="LINE_WIDTH",t[t.COUNT=12]="COUNT"}(Bh||(Bh={}));var Lh,Fh=((no={})[Bh.IS_DISCARD]=ho.UINT32,no[Bh.POLYGO_MODEL]=ho.UINT32,no[Bh.SHADE_MODEL]=ho.UINT32,no[Bh.CULL_MODE]=ho.UINT32,no[Bh.IS_FRONT_FACE_CCW]=ho.UINT32,no[Bh.DEPTH_BIAS_ENABLED]=ho.UINT32,no[Bh.DEPTH_BIAS]=ho.FLOAT32,no[Bh.DEPTH_BIAS_CLAMP]=ho.FLOAT32,no[Bh.DEPTH_BIAS_SLOP]=ho.FLOAT32,no[Bh.IS_DEPTH_CLIP]=ho.UINT32,no[Bh.IS_MULTI_SAMPLE]=ho.UINT32,no[Bh.LINE_WIDTH]=ho.FLOAT32,no[Bh.COUNT]=ho.NEVER,no),Dh=new mo(fo.RASTERIZER_STATE,Fh,Bh,9);!function(t){t[t.DEPTH_TEST=0]="DEPTH_TEST",t[t.DEPTH_WRITE=1]="DEPTH_WRITE",t[t.DEPTH_FUNC=2]="DEPTH_FUNC",t[t.STENCIL_TEST_FRONT=3]="STENCIL_TEST_FRONT",t[t.STENCIL_FUNC_FRONT=4]="STENCIL_FUNC_FRONT",t[t.STENCIL_READ_MASK_FRONT=5]="STENCIL_READ_MASK_FRONT",t[t.STENCIL_WRITE_MASK_FRONT=6]="STENCIL_WRITE_MASK_FRONT",t[t.STENCIL_FAIL_OP_FRONT=7]="STENCIL_FAIL_OP_FRONT",t[t.STENCIL_Z_FAIL_OP_FRONT=8]="STENCIL_Z_FAIL_OP_FRONT",t[t.STENCIL_PASS_OP_FRONT=9]="STENCIL_PASS_OP_FRONT",t[t.STENCIL_REF_FRONT=10]="STENCIL_REF_FRONT",t[t.STENCIL_TEST_BACK=11]="STENCIL_TEST_BACK",t[t.STENCIL_FUNC_BACK=12]="STENCIL_FUNC_BACK",t[t.STENCIL_READ_MADK_BACK=13]="STENCIL_READ_MADK_BACK",t[t.STENCIL_WRITE_MASK_BACK=14]="STENCIL_WRITE_MASK_BACK",t[t.STENCIL_FAIL_OP_BACK=15]="STENCIL_FAIL_OP_BACK",t[t.STENCIL_Z_FAIL_OP_BACK=16]="STENCIL_Z_FAIL_OP_BACK",t[t.STENCIL_PASS_OP_BACK=17]="STENCIL_PASS_OP_BACK",t[t.STENCIL_REF_BACK=18]="STENCIL_REF_BACK",t[t.COUNT=19]="COUNT"}(Lh||(Lh={}));var Uh,kh=((so={})[Lh.DEPTH_TEST]=ho.UINT32,so[Lh.DEPTH_WRITE]=ho.UINT32,so[Lh.DEPTH_FUNC]=ho.UINT32,so[Lh.STENCIL_TEST_FRONT]=ho.UINT32,so[Lh.STENCIL_FUNC_FRONT]=ho.UINT32,so[Lh.STENCIL_READ_MASK_FRONT]=ho.UINT32,so[Lh.STENCIL_WRITE_MASK_FRONT]=ho.UINT32,so[Lh.STENCIL_FAIL_OP_FRONT]=ho.UINT32,so[Lh.STENCIL_Z_FAIL_OP_FRONT]=ho.UINT32,so[Lh.STENCIL_PASS_OP_FRONT]=ho.UINT32,so[Lh.STENCIL_REF_FRONT]=ho.UINT32,so[Lh.STENCIL_TEST_BACK]=ho.UINT32,so[Lh.STENCIL_FUNC_BACK]=ho.UINT32,so[Lh.STENCIL_READ_MADK_BACK]=ho.UINT32,so[Lh.STENCIL_WRITE_MASK_BACK]=ho.UINT32,so[Lh.STENCIL_FAIL_OP_BACK]=ho.UINT32,so[Lh.STENCIL_Z_FAIL_OP_BACK]=ho.UINT32,so[Lh.STENCIL_PASS_OP_BACK]=ho.UINT32,so[Lh.STENCIL_REF_BACK]=ho.UINT32,so[Lh.COUNT]=ho.NEVER,so),zh=new mo(fo.DEPTH_STENCIL_STATE,kh,Lh,9);!function(t){t[t.BLEND=0]="BLEND",t[t.BLEND_SRC=1]="BLEND_SRC",t[t.BLEND_DST=2]="BLEND_DST",t[t.BLEND_EQ=3]="BLEND_EQ",t[t.BLEND_SRC_ALPHA=4]="BLEND_SRC_ALPHA",t[t.BLEND_DST_ALPHA=5]="BLEND_DST_ALPHA",t[t.BLEND_ALPHA_EQ=6]="BLEND_ALPHA_EQ",t[t.BLEND_COLOR_MASK=7]="BLEND_COLOR_MASK",t[t.COUNT=8]="COUNT"}(Uh||(Uh={})),(ao={})[Uh.BLEND]=ho.UINT32,ao[Uh.BLEND_SRC]=ho.UINT32,ao[Uh.BLEND_DST]=ho.UINT32,ao[Uh.BLEND_EQ]=ho.UINT32,ao[Uh.BLEND_SRC_ALPHA]=ho.UINT32,ao[Uh.BLEND_DST_ALPHA]=ho.UINT32,ao[Uh.BLEND_ALPHA_EQ]=ho.UINT32,ao[Uh.BLEND_COLOR_MASK]=ho.UINT32,ao[Uh.COUNT]=ho.NEVER;var Gh,Hh=new mo(fo.BLEND_TARGET,kh,Uh,9);!function(t){t[t.IS_A2C=0]="IS_A2C",t[t.IS_INDEPEND=1]="IS_INDEPEND",t[t.BLEND_COLOR=2]="BLEND_COLOR",t[t.BLEND_TARGET=6]="BLEND_TARGET",t[t.COUNT=7]="COUNT"}(Gh||(Gh={}));var Vh=((oo={})[Gh.IS_A2C]=ho.UINT32,oo[Gh.IS_INDEPEND]=ho.UINT32,oo[Gh.BLEND_COLOR]=ho.FLOAT32,oo[Gh.BLEND_TARGET]=ho.UINT32,oo[Gh.COUNT]=ho.NEVER,oo),Wh=new mo(fo.BLEND_STATE,Vh,Gh,9),jh=new Cs,Xh=new Cs,Yh=new Cs,qh=new Cs;function Kh(t){return Math.max(Math.max(t.x,t.y),t.z)}var Zh,Qh=function(){function t(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),this._center=new Cs(0,0,0),this._poolHandle=0,this._type=void 0,this._type=xa.SHAPE_SPHERE,this._center=new Cs(t,e,i),this._poolHandle=xh.alloc(),xh.setVec3(this._poolHandle,bh.CENTER,this._center),xh.set(this._poolHandle,bh.RADIUS,r)}t.create=function(e,i,r,n){return new t(e,i,r,n)},t.clone=function(e){return new t(e.center.x,e.center.y,e.center.z,e.radius)},t.copy=function(t,e){return Cs.copy(t.center,e.center),t.radius=e.radius,t},t.fromPoints=function(t,e,i){return Cs.multiplyScalar(t.center,Cs.add(jh,e,i),.5),t.radius=.5*Cs.subtract(jh,i,e).length(),t},t.set=function(t,e,i,r,n){return t.center.x=e,t.center.y=i,t.center.z=r,t.radius=n,t},t.mergePoint=function(t,e,i){if(e.radius<0)return t.center.set(i),t.radius=0,t;Cs.subtract(Xh,i,e.center);var r=Xh.length();if(r>e.radius){var n=.5*(r-e.radius);t.radius+=n,Cs.multiplyScalar(Xh,Xh,n/r),Cs.add(t.center,t.center,Xh)}return t},t.mergeAABB=function(e,i,r){return r.getBoundary(Yh,qh),t.mergePoint(e,i,Yh),t.mergePoint(e,i,qh),e},r(t,[{key:"center",get:function(){return this._center},set:function(t){this._center=t,xh.setVec3(this._poolHandle,bh.CENTER,this._center)}},{key:"radius",get:function(){return xh.get(this._poolHandle,bh.RADIUS)},set:function(t){xh.set(this._poolHandle,bh.RADIUS,t)}},{key:"handle",get:function(){return this._poolHandle}},{key:"type",get:function(){return this._type}}]);var e=t.prototype;return e.destroy=function(){this._poolHandle&&(xh.free(this._poolHandle),this._poolHandle=0)},e.clone=function(){return t.clone(this)},e.copy=function(e){return t.copy(this,e)},e.getBoundary=function(t,e){Cs.set(t,this.center.x-this.radius,this.center.y-this.radius,this.center.z-this.radius),Cs.set(e,this.center.x+this.radius,this.center.y+this.radius,this.center.z+this.radius)},e.transform=function(t,e,i,r,n){Cs.transformMat4(n.center,this.center,t),n.radius=this.radius*Kh(r)},e.translateAndRotate=function(t,e,i){Cs.transformMat4(i.center,this.center,t)},e.setScale=function(t,e){e.radius=this.radius*Kh(t)},t}(),Jh=function(){function t(t,e,i,r,n,s,a,o,h){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===n&&(n=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===o&&(o=1),void 0===h&&(h=0),this.a=void 0,this.b=void 0,this.c=void 0,this._type=void 0,this._type=xa.SHAPE_TRIANGLE,this.a=new Cs(t,e,i),this.b=new Cs(r,n,s),this.c=new Cs(a,o,h)}return t.create=function(e,i,r,n,s,a,o,h,l){return void 0===e&&(e=1),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===h&&(h=0),void 0===l&&(l=1),new t(e,i,r,n,s,a,o,h,l)},t.clone=function(e){return new t(e.a.x,e.a.y,e.a.z,e.b.x,e.b.y,e.b.z,e.c.x,e.c.y,e.c.z)},t.copy=function(t,e){return Cs.copy(t.a,e.a),Cs.copy(t.b,e.b),Cs.copy(t.c,e.c),t},t.fromPoints=function(t,e,i,r){return Cs.copy(t.a,e),Cs.copy(t.b,i),Cs.copy(t.c,r),t},t.set=function(t,e,i,r,n,s,a,o,h,l){return t.a.x=e,t.a.y=i,t.a.z=r,t.b.x=n,t.b.y=s,t.b.z=a,t.c.x=o,t.c.y=h,t.c.z=l,t},r(t,[{key:"type",get:function(){return this._type}}]),t}(),$h=t("GFX_MAX_ATTACHMENTS",4);!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.BUFFER=1]="BUFFER",t[t.TEXTURE=2]="TEXTURE",t[t.RENDER_PASS=3]="RENDER_PASS",t[t.FRAMEBUFFER=4]="FRAMEBUFFER",t[t.SAMPLER=5]="SAMPLER",t[t.SHADER=6]="SHADER",t[t.DESCRIPTOR_SET_LAYOUT=7]="DESCRIPTOR_SET_LAYOUT",t[t.PIPELINE_LAYOUT=8]="PIPELINE_LAYOUT",t[t.PIPELINE_STATE=9]="PIPELINE_STATE",t[t.DESCRIPTOR_SET=10]="DESCRIPTOR_SET",t[t.INPUT_ASSEMBLER=11]="INPUT_ASSEMBLER",t[t.COMMAND_BUFFER=12]="COMMAND_BUFFER",t[t.FENCE=13]="FENCE",t[t.QUEUE=14]="QUEUE",t[t.WINDOW=15]="WINDOW"}(Zh||(Zh=t("GFXObjectType",{})));var tl,el,il,rl,nl,sl,al,ol,hl,ll,ul,cl,_l,dl,pl,fl,ml,gl,vl,yl,Tl,El,Sl,bl,Al,Cl,wl,Rl,xl,Ol,Il,Ml,Bl,Pl,Nl,Ll,Fl,Dl=t("GFXObject",function(){function t(t){this._gfxType=Zh.UNKNOWN,this._gfxType=t}return r(t,[{key:"gfxType",get:function(){return this._gfxType}}]),t}());!function(t){t.ATTR_POSITION="a_position",t.ATTR_NORMAL="a_normal",t.ATTR_TANGENT="a_tangent",t.ATTR_BITANGENT="a_bitangent",t.ATTR_WEIGHTS="a_weights",t.ATTR_JOINTS="a_joints",t.ATTR_COLOR="a_color",t.ATTR_COLOR1="a_color1",t.ATTR_COLOR2="a_color2",t.ATTR_TEX_COORD="a_texCoord",t.ATTR_TEX_COORD1="a_texCoord1",t.ATTR_TEX_COORD2="a_texCoord2",t.ATTR_TEX_COORD3="a_texCoord3",t.ATTR_TEX_COORD4="a_texCoord4",t.ATTR_TEX_COORD5="a_texCoord5",t.ATTR_TEX_COORD6="a_texCoord6",t.ATTR_TEX_COORD7="a_texCoord7",t.ATTR_TEX_COORD8="a_texCoord8",t.ATTR_BATCH_ID="a_batch_id",t.ATTR_BATCH_UV="a_batch_uv"}(tl||(tl=t("GFXAttributeName",{}))),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.BOOL=1]="BOOL",t[t.BOOL2=2]="BOOL2",t[t.BOOL3=3]="BOOL3",t[t.BOOL4=4]="BOOL4",t[t.INT=5]="INT",t[t.INT2=6]="INT2",t[t.INT3=7]="INT3",t[t.INT4=8]="INT4",t[t.UINT=9]="UINT",t[t.UINT2=10]="UINT2",t[t.UINT3=11]="UINT3",t[t.UINT4=12]="UINT4",t[t.FLOAT=13]="FLOAT",t[t.FLOAT2=14]="FLOAT2",t[t.FLOAT3=15]="FLOAT3",t[t.FLOAT4=16]="FLOAT4",t[t.MAT2=17]="MAT2",t[t.MAT2X3=18]="MAT2X3",t[t.MAT2X4=19]="MAT2X4",t[t.MAT3X2=20]="MAT3X2",t[t.MAT3=21]="MAT3",t[t.MAT3X4=22]="MAT3X4",t[t.MAT4X2=23]="MAT4X2",t[t.MAT4X3=24]="MAT4X3",t[t.MAT4=25]="MAT4",t[t.SAMPLER1D=26]="SAMPLER1D",t[t.SAMPLER1D_ARRAY=27]="SAMPLER1D_ARRAY",t[t.SAMPLER2D=28]="SAMPLER2D",t[t.SAMPLER2D_ARRAY=29]="SAMPLER2D_ARRAY",t[t.SAMPLER3D=30]="SAMPLER3D",t[t.SAMPLER_CUBE=31]="SAMPLER_CUBE",t[t.COUNT=32]="COUNT"}(el||(el=t("GFXType",{}))),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.A8=1]="A8",t[t.L8=2]="L8",t[t.LA8=3]="LA8",t[t.R8=4]="R8",t[t.R8SN=5]="R8SN",t[t.R8UI=6]="R8UI",t[t.R8I=7]="R8I",t[t.R16F=8]="R16F",t[t.R16UI=9]="R16UI",t[t.R16I=10]="R16I",t[t.R32F=11]="R32F",t[t.R32UI=12]="R32UI",t[t.R32I=13]="R32I",t[t.RG8=14]="RG8",t[t.RG8SN=15]="RG8SN",t[t.RG8UI=16]="RG8UI",t[t.RG8I=17]="RG8I",t[t.RG16F=18]="RG16F",t[t.RG16UI=19]="RG16UI",t[t.RG16I=20]="RG16I",t[t.RG32F=21]="RG32F",t[t.RG32UI=22]="RG32UI",t[t.RG32I=23]="RG32I",t[t.RGB8=24]="RGB8",t[t.SRGB8=25]="SRGB8",t[t.RGB8SN=26]="RGB8SN",t[t.RGB8UI=27]="RGB8UI",t[t.RGB8I=28]="RGB8I",t[t.RGB16F=29]="RGB16F",t[t.RGB16UI=30]="RGB16UI",t[t.RGB16I=31]="RGB16I",t[t.RGB32F=32]="RGB32F",t[t.RGB32UI=33]="RGB32UI",t[t.RGB32I=34]="RGB32I",t[t.RGBA8=35]="RGBA8",t[t.BGRA8=36]="BGRA8",t[t.SRGB8_A8=37]="SRGB8_A8",t[t.RGBA8SN=38]="RGBA8SN",t[t.RGBA8UI=39]="RGBA8UI",t[t.RGBA8I=40]="RGBA8I",t[t.RGBA16F=41]="RGBA16F",t[t.RGBA16UI=42]="RGBA16UI",t[t.RGBA16I=43]="RGBA16I",t[t.RGBA32F=44]="RGBA32F",t[t.RGBA32UI=45]="RGBA32UI",t[t.RGBA32I=46]="RGBA32I",t[t.R5G6B5=47]="R5G6B5",t[t.R11G11B10F=48]="R11G11B10F",t[t.RGB5A1=49]="RGB5A1",t[t.RGBA4=50]="RGBA4",t[t.RGB10A2=51]="RGB10A2",t[t.RGB10A2UI=52]="RGB10A2UI",t[t.RGB9E5=53]="RGB9E5",t[t.D16=54]="D16",t[t.D16S8=55]="D16S8",t[t.D24=56]="D24",t[t.D24S8=57]="D24S8",t[t.D32F=58]="D32F",t[t.D32F_S8=59]="D32F_S8",t[t.BC1=60]="BC1",t[t.BC1_ALPHA=61]="BC1_ALPHA",t[t.BC1_SRGB=62]="BC1_SRGB",t[t.BC1_SRGB_ALPHA=63]="BC1_SRGB_ALPHA",t[t.BC2=64]="BC2",t[t.BC2_SRGB=65]="BC2_SRGB",t[t.BC3=66]="BC3",t[t.BC3_SRGB=67]="BC3_SRGB",t[t.BC4=68]="BC4",t[t.BC4_SNORM=69]="BC4_SNORM",t[t.BC5=70]="BC5",t[t.BC5_SNORM=71]="BC5_SNORM",t[t.BC6H_UF16=72]="BC6H_UF16",t[t.BC6H_SF16=73]="BC6H_SF16",t[t.BC7=74]="BC7",t[t.BC7_SRGB=75]="BC7_SRGB",t[t.ETC_RGB8=76]="ETC_RGB8",t[t.ETC2_RGB8=77]="ETC2_RGB8",t[t.ETC2_SRGB8=78]="ETC2_SRGB8",t[t.ETC2_RGB8_A1=79]="ETC2_RGB8_A1",t[t.ETC2_SRGB8_A1=80]="ETC2_SRGB8_A1",t[t.ETC2_RGBA8=81]="ETC2_RGBA8",t[t.ETC2_SRGB8_A8=82]="ETC2_SRGB8_A8",t[t.EAC_R11=83]="EAC_R11",t[t.EAC_R11SN=84]="EAC_R11SN",t[t.EAC_RG11=85]="EAC_RG11",t[t.EAC_RG11SN=86]="EAC_RG11SN",t[t.PVRTC_RGB2=87]="PVRTC_RGB2",t[t.PVRTC_RGBA2=88]="PVRTC_RGBA2",t[t.PVRTC_RGB4=89]="PVRTC_RGB4",t[t.PVRTC_RGBA4=90]="PVRTC_RGBA4",t[t.PVRTC2_2BPP=91]="PVRTC2_2BPP",t[t.PVRTC2_4BPP=92]="PVRTC2_4BPP",t[t.ASTC_RGBA_4x4=93]="ASTC_RGBA_4x4",t[t.ASTC_RGBA_5x4=94]="ASTC_RGBA_5x4",t[t.ASTC_RGBA_5x5=95]="ASTC_RGBA_5x5",t[t.ASTC_RGBA_6x5=96]="ASTC_RGBA_6x5",t[t.ASTC_RGBA_6x6=97]="ASTC_RGBA_6x6",t[t.ASTC_RGBA_8x5=98]="ASTC_RGBA_8x5",t[t.ASTC_RGBA_8x6=99]="ASTC_RGBA_8x6",t[t.ASTC_RGBA_8x8=100]="ASTC_RGBA_8x8",t[t.ASTC_RGBA_10x5=101]="ASTC_RGBA_10x5",t[t.ASTC_RGBA_10x6=102]="ASTC_RGBA_10x6",t[t.ASTC_RGBA_10x8=103]="ASTC_RGBA_10x8",t[t.ASTC_RGBA_10x10=104]="ASTC_RGBA_10x10",t[t.ASTC_RGBA_12x10=105]="ASTC_RGBA_12x10",t[t.ASTC_RGBA_12x12=106]="ASTC_RGBA_12x12",t[t.ASTC_SRGBA_4x4=107]="ASTC_SRGBA_4x4",t[t.ASTC_SRGBA_5x4=108]="ASTC_SRGBA_5x4",t[t.ASTC_SRGBA_5x5=109]="ASTC_SRGBA_5x5",t[t.ASTC_SRGBA_6x5=110]="ASTC_SRGBA_6x5",t[t.ASTC_SRGBA_6x6=111]="ASTC_SRGBA_6x6",t[t.ASTC_SRGBA_8x5=112]="ASTC_SRGBA_8x5",t[t.ASTC_SRGBA_8x6=113]="ASTC_SRGBA_8x6",t[t.ASTC_SRGBA_8x8=114]="ASTC_SRGBA_8x8",t[t.ASTC_SRGBA_10x5=115]="ASTC_SRGBA_10x5",t[t.ASTC_SRGBA_10x6=116]="ASTC_SRGBA_10x6",t[t.ASTC_SRGBA_10x8=117]="ASTC_SRGBA_10x8",t[t.ASTC_SRGBA_10x10=118]="ASTC_SRGBA_10x10",t[t.ASTC_SRGBA_12x10=119]="ASTC_SRGBA_12x10",t[t.ASTC_SRGBA_12x12=120]="ASTC_SRGBA_12x12"}(il||(il=t("GFXFormat",{}))),function(t){t[t.NONE=0]="NONE",t[t.TRANSFER_SRC=1]="TRANSFER_SRC",t[t.TRANSFER_DST=2]="TRANSFER_DST",t[t.INDEX=4]="INDEX",t[t.VERTEX=8]="VERTEX",t[t.UNIFORM=16]="UNIFORM",t[t.STORAGE=32]="STORAGE",t[t.INDIRECT=64]="INDIRECT"}(rl||(rl=t("GFXBufferUsageBit",{}))),function(t){t[t.NONE=0]="NONE",t[t.DEVICE=1]="DEVICE",t[t.HOST=2]="HOST"}(nl||(nl=t("GFXMemoryUsageBit",{}))),function(t){t[t.NONE=0]="NONE",t[t.BAKUP_BUFFER=4]="BAKUP_BUFFER"}(sl||(sl=t("GFXBufferFlagBit",{}))),function(t){t[t.NONE=0]="NONE",t[t.READ=1]="READ",t[t.WRITE=2]="WRITE"}(al||(al=t("GFXBufferAccessBit",{}))),function(t){t[t.POINT_LIST=0]="POINT_LIST",t[t.LINE_LIST=1]="LINE_LIST",t[t.LINE_STRIP=2]="LINE_STRIP",t[t.LINE_LOOP=3]="LINE_LOOP",t[t.LINE_LIST_ADJACENCY=4]="LINE_LIST_ADJACENCY",t[t.LINE_STRIP_ADJACENCY=5]="LINE_STRIP_ADJACENCY",t[t.ISO_LINE_LIST=6]="ISO_LINE_LIST",t[t.TRIANGLE_LIST=7]="TRIANGLE_LIST",t[t.TRIANGLE_STRIP=8]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=9]="TRIANGLE_FAN",t[t.TRIANGLE_LIST_ADJACENCY=10]="TRIANGLE_LIST_ADJACENCY",t[t.TRIANGLE_STRIP_ADJACENCY=11]="TRIANGLE_STRIP_ADJACENCY",t[t.TRIANGLE_PATCH_ADJACENCY=12]="TRIANGLE_PATCH_ADJACENCY",t[t.QUAD_PATCH_LIST=13]="QUAD_PATCH_LIST"}(ol||(ol=t("GFXPrimitiveMode",{}))),function(t){t[t.FILL=0]="FILL",t[t.POINT=1]="POINT",t[t.LINE=2]="LINE"}(hl||(hl=t("GFXPolygonMode",{}))),function(t){t[t.GOURAND=0]="GOURAND",t[t.FLAT=1]="FLAT"}(ll||(ll=t("GFXShadeModel",{}))),function(t){t[t.NONE=0]="NONE",t[t.FRONT=1]="FRONT",t[t.BACK=2]="BACK"}(ul||(ul=t("GFXCullMode",{}))),function(t){t[t.NEVER=0]="NEVER",t[t.LESS=1]="LESS",t[t.EQUAL=2]="EQUAL",t[t.LESS_EQUAL=3]="LESS_EQUAL",t[t.GREATER=4]="GREATER",t[t.NOT_EQUAL=5]="NOT_EQUAL",t[t.GREATER_EQUAL=6]="GREATER_EQUAL",t[t.ALWAYS=7]="ALWAYS"}(cl||(cl=t("GFXComparisonFunc",{}))),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=1]="KEEP",t[t.REPLACE=2]="REPLACE",t[t.INCR=3]="INCR",t[t.DECR=4]="DECR",t[t.INVERT=5]="INVERT",t[t.INCR_WRAP=6]="INCR_WRAP",t[t.DECR_WRAP=7]="DECR_WRAP"}(_l||(_l=t("GFXStencilOp",{}))),function(t){t[t.ADD=0]="ADD",t[t.SUB=1]="SUB",t[t.REV_SUB=2]="REV_SUB",t[t.MIN=3]="MIN",t[t.MAX=4]="MAX"}(dl||(dl=t("GFXBlendOp",{}))),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_ALPHA=2]="SRC_ALPHA",t[t.DST_ALPHA=3]="DST_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=4]="ONE_MINUS_SRC_ALPHA",t[t.ONE_MINUS_DST_ALPHA=5]="ONE_MINUS_DST_ALPHA",t[t.SRC_COLOR=6]="SRC_COLOR",t[t.DST_COLOR=7]="DST_COLOR",t[t.ONE_MINUS_SRC_COLOR=8]="ONE_MINUS_SRC_COLOR",t[t.ONE_MINUS_DST_COLOR=9]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=10]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=11]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=12]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=13]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=14]="ONE_MINUS_CONSTANT_ALPHA"}(pl||(pl=t("GFXBlendFactor",{}))),function(t){t[t.NONE=0]="NONE",t[t.R=1]="R",t[t.G=2]="G",t[t.B=4]="B",t[t.A=8]="A",t[t.ALL=15]="ALL"}(fl||(fl=t("GFXColorMask",{}))),function(t){t[t.NONE=0]="NONE",t[t.POINT=1]="POINT",t[t.LINEAR=2]="LINEAR",t[t.ANISOTROPIC=3]="ANISOTROPIC"}(ml||(ml=t("GFXFilter",{}))),function(t){t[t.WRAP=0]="WRAP",t[t.MIRROR=1]="MIRROR",t[t.CLAMP=2]="CLAMP",t[t.BORDER=3]="BORDER"}(gl||(gl=t("GFXAddress",{}))),function(t){t[t.TEX1D=0]="TEX1D",t[t.TEX2D=1]="TEX2D",t[t.TEX3D=2]="TEX3D",t[t.CUBE=3]="CUBE",t[t.TEX1D_ARRAY=4]="TEX1D_ARRAY",t[t.TEX2D_ARRAY=5]="TEX2D_ARRAY"}(vl||(vl=t("GFXTextureType",{}))),function(t){t[t.NONE=0]="NONE",t[t.TRANSFER_SRC=1]="TRANSFER_SRC",t[t.TRANSFER_DST=2]="TRANSFER_DST",t[t.SAMPLED=4]="SAMPLED",t[t.STORAGE=8]="STORAGE",t[t.COLOR_ATTACHMENT=16]="COLOR_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=32]="DEPTH_STENCIL_ATTACHMENT",t[t.TRANSIENT_ATTACHMENT=64]="TRANSIENT_ATTACHMENT",t[t.INPUT_ATTACHMENT=128]="INPUT_ATTACHMENT"}(yl||(yl=t("GFXTextureUsageBit",{}))),function(t){t[t.X1=0]="X1",t[t.X2=1]="X2",t[t.X4=2]="X4",t[t.X8=3]="X8",t[t.X16=4]="X16",t[t.X32=5]="X32",t[t.X64=6]="X64"}(Tl||(Tl=t("GFXSampleCount",{}))),function(t){t[t.NONE=0]="NONE",t[t.GEN_MIPMAP=1]="GEN_MIPMAP",t[t.CUBEMAP=2]="CUBEMAP",t[t.BAKUP_BUFFER=4]="BAKUP_BUFFER"}(El||(El=t("GFXTextureFlagBit",{}))),function(t){t[t.NONE=0]="NONE",t[t.VERTEX=1]="VERTEX",t[t.CONTROL=2]="CONTROL",t[t.EVALUATION=4]="EVALUATION",t[t.GEOMETRY=8]="GEOMETRY",t[t.FRAGMENT=16]="FRAGMENT",t[t.COMPUTE=32]="COMPUTE",t[t.ALL=63]="ALL"}(Sl||(Sl=t("GFXShaderStageFlagBit",{}))),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.UNIFORM_BUFFER=1]="UNIFORM_BUFFER",t[t.DYNAMIC_UNIFORM_BUFFER=2]="DYNAMIC_UNIFORM_BUFFER",t[t.STORAGE_BUFFER=4]="STORAGE_BUFFER",t[t.DYNAMIC_STORAGE_BUFFER=8]="DYNAMIC_STORAGE_BUFFER",t[t.SAMPLER=16]="SAMPLER"}(bl||(bl=t("GFXDescriptorType",{}))),function(t){t[t.PRIMARY=0]="PRIMARY",t[t.SECONDARY=1]="SECONDARY"}(Al||(Al=t("GFXCommandBufferType",{}))),function(t){t[t.LOAD=0]="LOAD",t[t.CLEAR=1]="CLEAR",t[t.DISCARD=2]="DISCARD"}(Cl||(Cl=t("GFXLoadOp",{}))),function(t){t[t.STORE=0]="STORE",t[t.DISCARD=1]="DISCARD"}(wl||(wl=t("GFXStoreOp",{}))),function(t){t[t.UNDEFINED=0]="UNDEFINED",t[t.GENERAL=1]="GENERAL",t[t.COLOR_ATTACHMENT_OPTIMAL=2]="COLOR_ATTACHMENT_OPTIMAL",t[t.DEPTH_STENCIL_ATTACHMENT_OPTIMAL=3]="DEPTH_STENCIL_ATTACHMENT_OPTIMAL",t[t.DEPTH_STENCIL_READONLY_OPTIMAL=4]="DEPTH_STENCIL_READONLY_OPTIMAL",t[t.SHADER_READONLY_OPTIMAL=5]="SHADER_READONLY_OPTIMAL",t[t.TRANSFER_SRC_OPTIMAL=6]="TRANSFER_SRC_OPTIMAL",t[t.TRANSFER_DST_OPTIMAL=7]="TRANSFER_DST_OPTIMAL",t[t.PREINITIALIZED=8]="PREINITIALIZED",t[t.PRESENT_SRC=9]="PRESENT_SRC"}(Rl||(Rl=t("GFXTextureLayout",{}))),function(t){t[t.GRAPHICS=0]="GRAPHICS",t[t.COMPUTE=1]="COMPUTE",t[t.RAY_TRACING=2]="RAY_TRACING"}(xl||(xl=t("GFXPipelineBindPoint",{}))),function(t){t[t.NONE=0]="NONE",t[t.VIEWPORT=1]="VIEWPORT",t[t.SCISSOR=2]="SCISSOR",t[t.LINE_WIDTH=4]="LINE_WIDTH",t[t.DEPTH_BIAS=8]="DEPTH_BIAS",t[t.BLEND_CONSTANTS=16]="BLEND_CONSTANTS",t[t.DEPTH_BOUNDS=32]="DEPTH_BOUNDS",t[t.STENCIL_WRITE_MASK=64]="STENCIL_WRITE_MASK",t[t.STENCIL_COMPARE_MASK=128]="STENCIL_COMPARE_MASK"}(Ol||(Ol=t("GFXDynamicStateFlagBit",{}))),function(t){t[t.FRONT=0]="FRONT",t[t.BACK=1]="BACK",t[t.ALL=2]="ALL"}(Il||(Il=t("GFXStencilFace",{}))),function(t){t[t.GRAPHICS=0]="GRAPHICS",t[t.COMPUTE=1]="COMPUTE",t[t.TRANSFER=2]="TRANSFER"}(Ml||(Ml=t("GFXQueueType",{}))),function(t){t[t.NONE=0]="NONE",t[t.COLOR=1]="COLOR",t[t.DEPTH=2]="DEPTH",t[t.STENCIL=4]="STENCIL",t[t.DEPTH_STENCIL=6]="DEPTH_STENCIL",t[t.ALL=7]="ALL"}(Bl||(Bl=t("GFXClearFlag",{}))),function(t){t[t.NONE=0]="NONE",t[t.UNORM=1]="UNORM",t[t.SNORM=2]="SNORM",t[t.UINT=3]="UINT",t[t.INT=4]="INT",t[t.UFLOAT=5]="UFLOAT",t[t.FLOAT=6]="FLOAT"}(Pl||(Pl=t("GFXFormatType",{}))),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.GLES2=1]="GLES2",t[t.GLES3=2]="GLES3",t[t.METAL=3]="METAL",t[t.VULKAN=4]="VULKAN",t[t.WEBGL=5]="WEBGL",t[t.WEBGL2=6]="WEBGL2",t[t.WEBGPU=7]="WEBGPU"}(Nl||(Nl=t("GFXAPI",{}))),function(t){t[t.IDENTITY=0]="IDENTITY",t[t.ROTATE_90=1]="ROTATE_90",t[t.ROTATE_180=2]="ROTATE_180",t[t.ROTATE_270=3]="ROTATE_270"}(Ll||(Ll=t("GFXSurfaceTransform",{}))),function(t){t[t.COLOR_FLOAT=0]="COLOR_FLOAT",t[t.COLOR_HALF_FLOAT=1]="COLOR_HALF_FLOAT",t[t.TEXTURE_FLOAT=2]="TEXTURE_FLOAT",t[t.TEXTURE_HALF_FLOAT=3]="TEXTURE_HALF_FLOAT",t[t.TEXTURE_FLOAT_LINEAR=4]="TEXTURE_FLOAT_LINEAR",t[t.TEXTURE_HALF_FLOAT_LINEAR=5]="TEXTURE_HALF_FLOAT_LINEAR",t[t.FORMAT_R11G11B10F=6]="FORMAT_R11G11B10F",t[t.FORMAT_D16=7]="FORMAT_D16",t[t.FORMAT_D16S8=8]="FORMAT_D16S8",t[t.FORMAT_D24=9]="FORMAT_D24",t[t.FORMAT_D24S8=10]="FORMAT_D24S8",t[t.FORMAT_D32F=11]="FORMAT_D32F",t[t.FORMAT_D32FS8=12]="FORMAT_D32FS8",t[t.FORMAT_ETC1=13]="FORMAT_ETC1",t[t.FORMAT_ETC2=14]="FORMAT_ETC2",t[t.FORMAT_DXT=15]="FORMAT_DXT",t[t.FORMAT_PVRTC=16]="FORMAT_PVRTC",t[t.FORMAT_ASTC=17]="FORMAT_ASTC",t[t.FORMAT_RGB8=18]="FORMAT_RGB8",t[t.MSAA=19]="MSAA",t[t.ELEMENT_INDEX_UINT=20]="ELEMENT_INDEX_UINT",t[t.INSTANCED_ARRAYS=21]="INSTANCED_ARRAYS",t[t.MULTIPLE_RENDER_TARGETS=22]="MULTIPLE_RENDER_TARGETS",t[t.BLEND_MINMAX=23]="BLEND_MINMAX",t[t.DEPTH_BOUNDS=24]="DEPTH_BOUNDS",t[t.LINE_WIDTH=25]="LINE_WIDTH",t[t.STENCIL_WRITE_MASK=26]="STENCIL_WRITE_MASK",t[t.STENCIL_COMPARE_MASK=27]="STENCIL_COMPARE_MASK",t[t.COUNT=28]="COUNT"}(Fl||(Fl=t("GFXFeature",{})));var Ul=t("GFXFormatInfo",(function(t,e,i,r,n,s,a,o){this.name=t,this.size=e,this.count=i,this.type=r,this.hasAlpha=n,this.hasDepth=s,this.hasStencil=a,this.isCompressed=o})),kl=t("GFXMemoryStatus",(function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.bufferSize=t,this.textureSize=e})),zl=t("GFXFormatInfos",Object.freeze([new Ul("UNKNOWN",0,0,Pl.NONE,!1,!1,!1,!1),new Ul("A8",1,1,Pl.UNORM,!0,!1,!1,!1),new Ul("L8",1,1,Pl.UNORM,!1,!1,!1,!1),new Ul("LA8",1,2,Pl.UNORM,!0,!1,!1,!1),new Ul("R8",1,1,Pl.UNORM,!1,!1,!1,!1),new Ul("R8SN",1,1,Pl.SNORM,!1,!1,!1,!1),new Ul("R8UI",1,1,Pl.UINT,!1,!1,!1,!1),new Ul("R8I",1,1,Pl.INT,!1,!1,!1,!1),new Ul("R16F",2,1,Pl.FLOAT,!1,!1,!1,!1),new Ul("R16UI",2,1,Pl.UINT,!1,!1,!1,!1),new Ul("R16I",2,1,Pl.INT,!1,!1,!1,!1),new Ul("R32F",4,1,Pl.FLOAT,!1,!1,!1,!1),new Ul("R32UI",4,1,Pl.UINT,!1,!1,!1,!1),new Ul("R32I",4,1,Pl.INT,!1,!1,!1,!1),new Ul("RG8",2,2,Pl.UNORM,!1,!1,!1,!1),new Ul("RG8SN",2,2,Pl.SNORM,!1,!1,!1,!1),new Ul("RG8UI",2,2,Pl.UINT,!1,!1,!1,!1),new Ul("RG8I",2,2,Pl.INT,!1,!1,!1,!1),new Ul("RG16F",4,2,Pl.FLOAT,!1,!1,!1,!1),new Ul("RG16UI",4,2,Pl.UINT,!1,!1,!1,!1),new Ul("RG16I",4,2,Pl.INT,!1,!1,!1,!1),new Ul("RG32F",8,2,Pl.FLOAT,!1,!1,!1,!1),new Ul("RG32UI",8,2,Pl.UINT,!1,!1,!1,!1),new Ul("RG32I",8,2,Pl.INT,!1,!1,!1,!1),new Ul("RGB8",3,3,Pl.UNORM,!1,!1,!1,!1),new Ul("SRGB8",3,3,Pl.UNORM,!1,!1,!1,!1),new Ul("RGB8SN",3,3,Pl.SNORM,!1,!1,!1,!1),new Ul("RGB8UI",3,3,Pl.UINT,!1,!1,!1,!1),new Ul("RGB8I",3,3,Pl.INT,!1,!1,!1,!1),new Ul("RGB16F",6,3,Pl.FLOAT,!1,!1,!1,!1),new Ul("RGB16UI",6,3,Pl.UINT,!1,!1,!1,!1),new Ul("RGB16I",6,3,Pl.INT,!1,!1,!1,!1),new Ul("RGB32F",12,3,Pl.FLOAT,!1,!1,!1,!1),new Ul("RGB32UI",12,3,Pl.UINT,!1,!1,!1,!1),new Ul("RGB32I",12,3,Pl.INT,!1,!1,!1,!1),new Ul("RGBA8",4,4,Pl.UNORM,!0,!1,!1,!1),new Ul("BGRA8",4,4,Pl.UNORM,!0,!1,!1,!1),new Ul("SRGB8_A8",4,4,Pl.UNORM,!0,!1,!1,!1),new Ul("RGBA8SN",4,4,Pl.SNORM,!0,!1,!1,!1),new Ul("RGBA8UI",4,4,Pl.UINT,!0,!1,!1,!1),new Ul("RGBA8I",4,4,Pl.INT,!0,!1,!1,!1),new Ul("RGBA16F",8,4,Pl.FLOAT,!0,!1,!1,!1),new Ul("RGBA16UI",8,4,Pl.UINT,!0,!1,!1,!1),new Ul("RGBA16I",8,4,Pl.INT,!0,!1,!1,!1),new Ul("RGBA32F",16,4,Pl.FLOAT,!0,!1,!1,!1),new Ul("RGBA32UI",16,4,Pl.UINT,!0,!1,!1,!1),new Ul("RGBA32I",16,4,Pl.INT,!0,!1,!1,!1),new Ul("R5G6B5",2,3,Pl.UNORM,!1,!1,!1,!1),new Ul("R11G11B10F",4,3,Pl.FLOAT,!1,!1,!1,!1),new Ul("RGB5A1",2,4,Pl.UNORM,!0,!1,!1,!1),new Ul("RGBA4",2,4,Pl.UNORM,!0,!1,!1,!1),new Ul("RGB10A2",2,4,Pl.UNORM,!0,!1,!1,!1),new Ul("RGB10A2UI",2,4,Pl.UINT,!0,!1,!1,!1),new Ul("RGB9E5",2,4,Pl.FLOAT,!0,!1,!1,!1),new Ul("D16",2,1,Pl.UINT,!1,!0,!1,!1),new Ul("D16S8",3,2,Pl.UINT,!1,!0,!0,!1),new Ul("D24",3,1,Pl.UINT,!1,!0,!1,!1),new Ul("D24S8",4,2,Pl.UINT,!1,!0,!0,!1),new Ul("D32F",4,1,Pl.FLOAT,!1,!0,!1,!1),new Ul("D32FS8",5,2,Pl.FLOAT,!1,!0,!0,!1),new Ul("BC1",1,3,Pl.UNORM,!1,!1,!1,!0),new Ul("BC1_ALPHA",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("BC1_SRGB",1,3,Pl.UNORM,!1,!1,!1,!0),new Ul("BC1_SRGB_ALPHA",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("BC2",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("BC2_SRGB",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("BC3",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("BC3_SRGB",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("BC4",1,1,Pl.UNORM,!1,!1,!1,!0),new Ul("BC4_SNORM",1,1,Pl.SNORM,!1,!1,!1,!0),new Ul("BC5",1,2,Pl.UNORM,!1,!1,!1,!0),new Ul("BC5_SNORM",1,2,Pl.SNORM,!1,!1,!1,!0),new Ul("BC6H_UF16",1,3,Pl.UFLOAT,!1,!1,!1,!0),new Ul("BC6H_SF16",1,3,Pl.FLOAT,!1,!1,!1,!0),new Ul("BC7",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("BC7_SRGB",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ETC_RGB8",1,3,Pl.UNORM,!1,!1,!1,!0),new Ul("ETC2_RGB8",1,3,Pl.UNORM,!1,!1,!1,!0),new Ul("ETC2_SRGB8",1,3,Pl.UNORM,!1,!1,!1,!0),new Ul("ETC2_RGB8_A1",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ETC2_SRGB8_A1",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ETC2_RGBA8",2,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ETC2_SRGB8_A8",2,4,Pl.UNORM,!0,!1,!1,!0),new Ul("EAC_R11",1,1,Pl.UNORM,!1,!1,!1,!0),new Ul("EAC_R11SN",1,1,Pl.SNORM,!1,!1,!1,!0),new Ul("EAC_RG11",2,2,Pl.UNORM,!1,!1,!1,!0),new Ul("EAC_RG11SN",2,2,Pl.SNORM,!1,!1,!1,!0),new Ul("PVRTC_RGB2",2,3,Pl.UNORM,!1,!1,!1,!0),new Ul("PVRTC_RGBA2",2,4,Pl.UNORM,!0,!1,!1,!0),new Ul("PVRTC_RGB4",2,3,Pl.UNORM,!1,!1,!1,!0),new Ul("PVRTC_RGBA4",2,4,Pl.UNORM,!0,!1,!1,!0),new Ul("PVRTC2_2BPP",2,4,Pl.UNORM,!0,!1,!1,!0),new Ul("PVRTC2_4BPP",2,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_RGBA_4x4",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_RGBA_5x4",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_RGBA_5x5",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_RGBA_6x5",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_RGBA_6x6",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_RGBA_8x5",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_RGBA_8x6",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_RGBA_8x8",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_RGBA_10x5",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_RGBA_10x6",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_RGBA_10x8",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_RGBA_10x10",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_RGBA_12x10",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_RGBA_12x12",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_SRGBA_4x4",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_SRGBA_5x4",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_SRGBA_5x5",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_SRGBA_6x5",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_SRGBA_6x6",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_SRGBA_8x5",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_SRGBA_8x6",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_SRGBA_8x8",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_SRGBA_10x5",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_SRGBA_10x6",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_SRGBA_10x8",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_SRGBA_10x10",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_SRGBA_12x10",1,4,Pl.UNORM,!0,!1,!1,!0),new Ul("ASTC_SRGBA_12x12",1,4,Pl.UNORM,!0,!1,!1,!0)]));function Gl(t,e,i,r){if(!zl[t].isCompressed)return e*i*r*zl[t].size;switch(t){case il.BC1:case il.BC1_ALPHA:case il.BC1_SRGB:case il.BC1_SRGB_ALPHA:return Math.ceil(e/4)*Math.ceil(i/4)*8*r;case il.BC2:case il.BC2_SRGB:case il.BC3:case il.BC3_SRGB:case il.BC4:case il.BC4_SNORM:case il.BC6H_SF16:case il.BC6H_UF16:case il.BC7:case il.BC7_SRGB:return Math.ceil(e/4)*Math.ceil(i/4)*16*r;case il.BC5:case il.BC5_SNORM:return Math.ceil(e/4)*Math.ceil(i/4)*32*r;case il.ETC_RGB8:case il.ETC2_RGB8:case il.ETC2_SRGB8:case il.ETC2_RGB8_A1:case il.EAC_R11:case il.EAC_R11SN:return Math.ceil(e/4)*Math.ceil(i/4)*8*r;case il.ETC2_RGBA8:case il.ETC2_SRGB8_A1:case il.EAC_RG11:case il.EAC_RG11SN:return Math.ceil(e/4)*Math.ceil(i/4)*16*r;case il.PVRTC_RGB2:case il.PVRTC_RGBA2:case il.PVRTC2_2BPP:return Math.ceil(Math.max(e,16)*Math.max(i,8)/4)*r;case il.PVRTC_RGB4:case il.PVRTC_RGBA4:case il.PVRTC2_4BPP:return Math.ceil(Math.max(e,8)*Math.max(i,8)/2)*r;case il.ASTC_RGBA_4x4:case il.ASTC_SRGBA_4x4:return Math.ceil(e/4)*Math.ceil(i/4)*16*r;case il.ASTC_RGBA_5x4:case il.ASTC_SRGBA_5x4:return Math.ceil(e/5)*Math.ceil(i/4)*16*r;case il.ASTC_RGBA_5x5:case il.ASTC_SRGBA_5x5:return Math.ceil(e/5)*Math.ceil(i/5)*16*r;case il.ASTC_RGBA_6x5:case il.ASTC_SRGBA_6x5:return Math.ceil(e/6)*Math.ceil(i/5)*16*r;case il.ASTC_RGBA_6x6:case il.ASTC_SRGBA_6x6:return Math.ceil(e/6)*Math.ceil(i/6)*16*r;case il.ASTC_RGBA_8x5:case il.ASTC_SRGBA_8x5:return Math.ceil(e/8)*Math.ceil(i/5)*16*r;case il.ASTC_RGBA_8x6:case il.ASTC_SRGBA_8x6:return Math.ceil(e/8)*Math.ceil(i/6)*16*r;case il.ASTC_RGBA_8x8:case il.ASTC_SRGBA_8x8:return Math.ceil(e/8)*Math.ceil(i/8)*16*r;case il.ASTC_RGBA_10x5:case il.ASTC_SRGBA_10x5:return Math.ceil(e/10)*Math.ceil(i/5)*16*r;case il.ASTC_RGBA_10x6:case il.ASTC_SRGBA_10x6:return Math.ceil(e/10)*Math.ceil(i/6)*16*r;case il.ASTC_RGBA_10x8:case il.ASTC_SRGBA_10x8:return Math.ceil(e/10)*Math.ceil(i/8)*16*r;case il.ASTC_RGBA_10x10:case il.ASTC_SRGBA_10x10:return Math.ceil(e/10)*Math.ceil(i/10)*16*r;case il.ASTC_RGBA_12x10:case il.ASTC_SRGBA_12x10:return Math.ceil(e/12)*Math.ceil(i/10)*16*r;case il.ASTC_RGBA_12x12:case il.ASTC_SRGBA_12x12:return Math.ceil(e/12)*Math.ceil(i/12)*16*r;default:return 0}}function Hl(t,e,i,r,n){for(var s=0,a=0;a<n;++a)s+=Gl(t,e,i,r),e=Math.max(e>>1,1),i=Math.max(i>>1,1);return s}var Vl=[0,4,8,12,16,4,8,12,16,4,8,12,16,4,8,12,16,16,24,32,24,36,48,32,48,64,4,4,4,4,4,4];function Wl(t){return Vl[t]||0}function jl(t){var e=t.size/t.count;switch(t.type){case Pl.UNORM:case Pl.UINT:switch(e){case 1:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array}break;case Pl.SNORM:case Pl.INT:switch(e){case 1:return Int8Array;case 2:return Int16Array;case 4:return Int32Array}break;case Pl.FLOAT:return Float32Array}return Float32Array}var Xl=t("GFXDrawInfo",(function(t,e,i,r,n,s,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===a&&(a=0),this.vertexCount=t,this.firstVertex=e,this.indexCount=i,this.firstIndex=r,this.vertexOffset=n,this.instanceCount=s,this.firstInstance=a})),Yl=t("GFX_DRAW_INFO_SIZE",28),ql=t("GFXIndirectBuffer",(function(t){void 0===t&&(t=[]),this.drawInfos=t})),Kl=t("GFXBufferInfo",(function(t,e,i,r,n){void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=sl.NONE),this.usage=t,this.memUsage=e,this.size=i,this.stride=r,this.flags=n})),Zl=t("GFXBufferViewInfo",(function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this.buffer=t,this.offset=e,this.range=i})),Ql=t("GFXBuffer",function(t){function e(e){var i;return(i=t.call(this,Zh.BUFFER)||this)._device=void 0,i._usage=rl.NONE,i._memUsage=nl.NONE,i._size=0,i._stride=1,i._count=0,i._flags=sl.NONE,i._bakcupBuffer=null,i._indirectBuffer=null,i._isBufferView=!1,i._device=e,i}return s(e,t),r(e,[{key:"usage",get:function(){return this._usage}},{key:"memUsage",get:function(){return this._memUsage}},{key:"size",get:function(){return this._size}},{key:"stride",get:function(){return this._stride}},{key:"count",get:function(){return this._count}},{key:"flags",get:function(){return this._flags}},{key:"backupBuffer",get:function(){return this._bakcupBuffer}}]),e}(Dl)),Jl=t("GFXCommandBufferInfo",(function(t,e){void 0===e&&(e=Al.PRIMARY),this.queue=t,this.type=e})),$l=t("GFXCommandBuffer",function(t){function e(e){var i;return(i=t.call(this,Zh.COMMAND_BUFFER)||this)._device=void 0,i._queue=null,i._type=Al.PRIMARY,i._numDrawCalls=0,i._numInstances=0,i._numTris=0,i._device=e,i}return s(e,t),r(e,[{key:"type",get:function(){return this._type}},{key:"queue",get:function(){return this._queue}},{key:"numDrawCalls",get:function(){return this._numDrawCalls}},{key:"numInstances",get:function(){return this._numInstances}},{key:"numTris",get:function(){return this._numTris}}]),e}(Dl));Ft(il);var tu=t("GFXBindingMappingInfo",(function(t,e,i){void 0===t&&(t=[]),void 0===e&&(e=[]),void 0===i&&(i=0),this.bufferOffsets=t,this.samplerOffsets=e,this.flexibleSet=i})),eu=t("GFXDeviceInfo",(function(t,e,i,r,n,s,a){void 0===e&&(e=!0),void 0===i&&(i=!0),void 0===r&&(r=1),void 0===n&&(n=1),void 0===s&&(s=1),void 0===a&&(a=new tu),this.canvasElm=t,this.isAntialias=e,this.isPremultipliedAlpha=i,this.devicePixelRatio=r,this.nativeWidth=n,this.nativeHeight=s,this.bindingMappingInfo=a})),iu=t("GFXDevice",function(){function t(){this._canvas=null,this._canvas2D=null,this._gfxAPI=Nl.UNKNOWN,this._transform=Ll.IDENTITY,this._deviceName="",this._renderer="",this._vendor="",this._version="",this._features=new Array(Fl.COUNT),this._queue=null,this._cmdBuff=null,this._devicePixelRatio=1,this._width=0,this._height=0,this._nativeWidth=0,this._nativeHeight=0,this._maxVertexAttributes=0,this._maxVertexUniformVectors=0,this._maxFragmentUniformVectors=0,this._maxTextureUnits=0,this._maxVertexTextureUnits=0,this._maxUniformBufferBindings=0,this._maxUniformBlockSize=0,this._maxTextureSize=0,this._maxCubeMapTextureSize=0,this._uboOffsetAlignment=1,this._depthBits=0,this._stencilBits=0,this._colorFmt=il.UNKNOWN,this._depthStencilFmt=il.UNKNOWN,this._macros=new Map,this._numDrawCalls=0,this._numInstances=0,this._numTris=0,this._memoryStatus=new kl,this._clipSpaceMinZ=-1,this._screenSpaceSignY=1,this._UVSpaceSignY=-1}return t.prototype.hasFeature=function(t){return this._features[t]},r(t,[{key:"canvas",get:function(){return this._canvas}},{key:"canvas2D",get:function(){return this._canvas2D}},{key:"gfxAPI",get:function(){return this._gfxAPI}},{key:"queue",get:function(){return this._queue}},{key:"commandBuffer",get:function(){return this._cmdBuff}},{key:"devicePixelRatio",get:function(){return this._devicePixelRatio}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"nativeWidth",get:function(){return this._nativeWidth}},{key:"nativeHeight",get:function(){return this._nativeHeight}},{key:"renderer",get:function(){return this._renderer}},{key:"vendor",get:function(){return this._vendor}},{key:"maxVertexAttributes",get:function(){return this._maxVertexAttributes}},{key:"maxVertexUniformVectors",get:function(){return this._maxVertexUniformVectors}},{key:"maxFragmentUniformVectors",get:function(){return this._maxFragmentUniformVectors}},{key:"maxTextureUnits",get:function(){return this._maxTextureUnits}},{key:"maxVertexTextureUnits",get:function(){return this._maxVertexTextureUnits}},{key:"maxUniformBufferBindings",get:function(){return this._maxUniformBufferBindings}},{key:"maxUniformBlockSize",get:function(){return this._maxUniformBlockSize}},{key:"maxTextureSize",get:function(){return this._maxTextureSize}},{key:"maxCubeMapTextureSize",get:function(){return this._maxCubeMapTextureSize}},{key:"uboOffsetAlignment",get:function(){return this._uboOffsetAlignment}},{key:"depthBits",get:function(){return this._depthBits}},{key:"stencilBits",get:function(){return this._stencilBits}},{key:"colorFormat",get:function(){return this._colorFmt}},{key:"depthStencilFormat",get:function(){return this._depthStencilFmt}},{key:"macros",get:function(){return this._macros}},{key:"numDrawCalls",get:function(){return this._numDrawCalls}},{key:"numInstances",get:function(){return this._numInstances}},{key:"numTris",get:function(){return this._numTris}},{key:"memoryStatus",get:function(){return this._memoryStatus}},{key:"clipSpaceMinZ",get:function(){return this._clipSpaceMinZ}},{key:"screenSpaceSignY",get:function(){return this._screenSpaceSignY}},{key:"UVSpaceSignY",get:function(){return this._UVSpaceSignY}},{key:"surfaceTransform",get:function(){return this._transform}}]),t}()),ru=t("GFXFramebufferInfo",(function(t,e,i,r,n){void 0===e&&(e=[]),void 0===i&&(i=null),void 0===r&&(r=[]),void 0===n&&(n=0),this.renderPass=t,this.colorTextures=e,this.depthStencilTexture=i,this.colorMipmapLevels=r,this.depStencilMipmapLevel=n})),nu=t("GFXFramebuffer",function(t){function e(e){var i;return(i=t.call(this,Zh.FRAMEBUFFER)||this)._device=void 0,i._renderPass=null,i._colorTextures=[],i._depthStencilTexture=null,i._device=e,i}return s(e,t),r(e,[{key:"renderPass",get:function(){return this._renderPass}},{key:"colorTextures",get:function(){return this._colorTextures}},{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}}]),e}(Dl)),su=String.prototype.charCodeAt;function au(t){return this[t]}function ou(t,e){for(var i=t.length,r=e^i,n=0,s="string"==typeof t?su:au;i>=4;){var a=255&s.call(t,n)|(255&s.call(t,++n))<<8|(255&s.call(t,++n))<<16|(255&s.call(t,++n))<<24;a=1540483477*(65535&a)+((1540483477*(a>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),i-=4,++n}switch(i){case 3:r^=(255&s.call(t,n+2))<<16;case 2:r^=(255&s.call(t,n+1))<<8;case 1:r=1540483477*(65535&(r^=255&s.call(t,n)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}var hu=t("GFXAttribute",(function(t,e,i,r,n,s){void 0===t&&(t=""),void 0===e&&(e=il.UNKNOWN),void 0===i&&(i=!1),void 0===r&&(r=0),void 0===n&&(n=!1),void 0===s&&(s=0),this.name=t,this.format=e,this.isNormalized=i,this.stream=r,this.isInstanced=n,this.location=s})),lu=t("GFXInputAssemblerInfo",(function(t,e,i,r){void 0===t&&(t=[]),void 0===e&&(e=[]),void 0===i&&(i=null),void 0===r&&(r=null),this.attributes=t,this.vertexBuffers=e,this.indexBuffer=i,this.indirectBuffer=r})),uu=t("GFXInputAssembler",function(t){function e(e){var i;return(i=t.call(this,Zh.INPUT_ASSEMBLER)||this)._device=void 0,i._attributes=[],i._vertexBuffers=[],i._indexBuffer=null,i._vertexCount=0,i._firstVertex=0,i._indexCount=0,i._firstIndex=0,i._vertexOffset=0,i._instanceCount=0,i._firstInstance=0,i._attributesHash=0,i._indirectBuffer=null,i._device=e,i}s(e,t),r(e,[{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"attributes",get:function(){return this._attributes}},{key:"attributesHash",get:function(){return this._attributesHash}},{key:"vertexCount",get:function(){return this._vertexCount},set:function(t){this._vertexCount=t}},{key:"firstVertex",get:function(){return this._firstVertex},set:function(t){this._firstVertex=t}},{key:"indexCount",get:function(){return this._indexCount},set:function(t){this._indexCount=t}},{key:"firstIndex",get:function(){return this._firstIndex},set:function(t){this._firstIndex=t}},{key:"vertexOffset",get:function(){return this._vertexOffset},set:function(t){this._vertexOffset=t}},{key:"instanceCount",get:function(){return this._instanceCount},set:function(t){this._instanceCount=t}},{key:"firstInstance",get:function(){return this._firstInstance},set:function(t){this._firstInstance=t}},{key:"indirectBuffer",get:function(){return this._indirectBuffer}}]);var i=e.prototype;return i.getVertexBuffer=function(t){return void 0===t&&(t=0),t<this._vertexBuffers.length?this._vertexBuffers[t]:null},i.computeAttributesHash=function(){for(var t="attrs",e=0;e<this.attributes.length;++e){var i=this.attributes[e];t+=","+i.name+","+i.format+","+i.isNormalized+","+i.stream+","+i.isInstanced}return ou(t,666)},e}(Dl)),cu=t("GFXRect",(function(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=1),void 0===r&&(r=1),this.x=t,this.y=e,this.width=i,this.height=r})),_u=t("GFXViewport",(function(t,e,i,r,n,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===s&&(s=1),this.left=t,this.top=e,this.width=i,this.height=r,this.minDepth=n,this.maxDepth=s})),du=t("GFXColor",(function(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.x=t,this.y=e,this.z=i,this.w=r})),pu=t("GFXOffset",(function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.x=t,this.y=e,this.z=i})),fu=t("GFXExtent",(function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=1),this.width=t,this.height=e,this.depth=i})),mu=t("GFXTextureSubres",(function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=1),this.mipLevel=t,this.baseArrayLayer=e,this.layerCount=i})),gu=t("GFXTextureCopy",(function(t,e,i,r,n){void 0===t&&(t=new mu),void 0===e&&(e=new pu),void 0===i&&(i=new mu),void 0===r&&(r=new pu),void 0===n&&(n=new fu),this.srcSubres=t,this.srcOffset=e,this.dstSubres=i,this.dstOffset=r,this.extent=n})),vu=t("GFXBufferTextureCopy",(function(t,e,i,r,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=new pu),void 0===r&&(r=new fu),void 0===n&&(n=new mu),this.buffStride=t,this.buffTexHeight=e,this.texOffset=i,this.texExtent=r,this.texSubres=n})),yu=t("GFXRasterizerState",function(){function t(t,e,i,r,n,s,a,o,h,l,u,c){void 0===t&&(t=!1),void 0===e&&(e=hl.FILL),void 0===i&&(i=ll.GOURAND),void 0===r&&(r=ul.BACK),void 0===n&&(n=!0),void 0===s&&(s=!1),void 0===a&&(a=0),void 0===o&&(o=0),void 0===h&&(h=0),void 0===l&&(l=!0),void 0===u&&(u=!1),void 0===c&&(c=1),this.isDiscard=t,this.polygonMode=e,this.shadeModel=i,this.cullMode=r,this.isFrontFaceCCW=n,this.depthBiasEnabled=s,this.depthBias=a,this.depthBiasClamp=o,this.depthBiasSlop=h,this.isDepthClip=l,this.isMultisample=u,this.lineWidth=c}var e=t.prototype;return e.reset=function(){this.isDiscard=!1,this.polygonMode=hl.FILL,this.shadeModel=ll.GOURAND,this.cullMode=ul.BACK,this.isFrontFaceCCW=!0,this.depthBiasEnabled=!1,this.depthBias=0,this.depthBiasClamp=0,this.depthBiasSlop=0,this.isDepthClip=!0,this.isMultisample=!1,this.lineWidth=1},e.assign=function(t){Object.assign(this,t)},e.destroy=function(){},r(t,[{key:"handle",get:function(){return 0}}]),t}()),Tu=t("GFXDepthStencilState",function(){function t(t,e,i,r,n,s,a,o,h,l,u,c,_,d,p,f,m,g,v){void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===i&&(i=cl.LESS),void 0===r&&(r=!1),void 0===n&&(n=cl.ALWAYS),void 0===s&&(s=65535),void 0===a&&(a=65535),void 0===o&&(o=_l.KEEP),void 0===h&&(h=_l.KEEP),void 0===l&&(l=_l.KEEP),void 0===u&&(u=1),void 0===c&&(c=!1),void 0===_&&(_=cl.ALWAYS),void 0===d&&(d=65535),void 0===p&&(p=65535),void 0===f&&(f=_l.KEEP),void 0===m&&(m=_l.KEEP),void 0===g&&(g=_l.KEEP),void 0===v&&(v=1),this.depthTest=t,this.depthWrite=e,this.depthFunc=i,this.stencilTestFront=r,this.stencilFuncFront=n,this.stencilReadMaskFront=s,this.stencilWriteMaskFront=a,this.stencilFailOpFront=o,this.stencilZFailOpFront=h,this.stencilPassOpFront=l,this.stencilRefFront=u,this.stencilTestBack=c,this.stencilFuncBack=_,this.stencilReadMaskBack=d,this.stencilWriteMaskBack=p,this.stencilFailOpBack=f,this.stencilZFailOpBack=m,this.stencilPassOpBack=g,this.stencilRefBack=v}var e=t.prototype;return e.reset=function(){this.depthTest=!0,this.depthWrite=!0,this.depthFunc=cl.LESS,this.stencilTestFront=!1,this.stencilFuncFront=cl.ALWAYS,this.stencilReadMaskFront=65535,this.stencilWriteMaskFront=65535,this.stencilFailOpFront=_l.KEEP,this.stencilZFailOpFront=_l.KEEP,this.stencilPassOpFront=_l.KEEP,this.stencilRefFront=1,this.stencilTestBack=!1,this.stencilFuncBack=cl.ALWAYS,this.stencilReadMaskBack=65535,this.stencilWriteMaskBack=65535,this.stencilFailOpBack=_l.KEEP,this.stencilZFailOpBack=_l.KEEP,this.stencilPassOpBack=_l.KEEP,this.stencilRefBack=1},e.assign=function(t){Object.assign(this,t)},e.destroy=function(){},r(t,[{key:"handle",get:function(){return 0}}]),t}()),Eu=t("GFXBlendTarget",function(){function t(t,e,i,r,n,s,a,o){void 0===t&&(t=!1),void 0===e&&(e=pl.ONE),void 0===i&&(i=pl.ZERO),void 0===r&&(r=dl.ADD),void 0===n&&(n=pl.ONE),void 0===s&&(s=pl.ZERO),void 0===a&&(a=dl.ADD),void 0===o&&(o=fl.ALL),this.blend=t,this.blendSrc=e,this.blendDst=i,this.blendEq=r,this.blendSrcAlpha=n,this.blendDstAlpha=s,this.blendAlphaEq=a,this.blendColorMask=o}var e=t.prototype;return e.reset=function(){this.blend=!1,this.blendSrc=pl.ONE,this.blendDst=pl.ZERO,this.blendEq=dl.ADD,this.blendSrcAlpha=pl.ONE,this.blendDstAlpha=pl.ZERO,this.blendAlphaEq=dl.ADD,this.blendColorMask=fl.ALL},e.assign=function(t){Object.assign(this,t)},e.destroy=function(){},r(t,[{key:"handle",get:function(){return 0}}]),t}()),Su=t("GFXBlendState",function(){function t(t,e,i,r){void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===i&&(i=new du),void 0===r&&(r=[new Eu]),this.isA2C=t,this.isIndepend=e,this.blendColor=i,this.targets=r}var e=t.prototype;return e.setTarget=function(t,e){var i=this.targets[t];i||(i=this.targets[t]=new Eu),Object.assign(i,e)},e.reset=function(){this.isA2C=!1,this.isIndepend=!1,this.blendColor.x=0,this.blendColor.y=0,this.blendColor.z=0,this.blendColor.w=0,this.targets.length=1,this.targets[0].reset()},e.destroy=function(){},r(t,[{key:"handle",get:function(){return 0}}]),t}()),bu=t("GFXInputState",(function(t){void 0===t&&(t=[]),this.attributes=t})),Au=t("GFXPipelineStateInfo",(function(t,e,i,r,n,s,a,o,h){void 0===o&&(o=ol.TRIANGLE_LIST),void 0===h&&(h=Ol.NONE),this.shader=t,this.pipelineLayout=e,this.renderPass=i,this.inputState=r,this.rasterizerState=n,this.depthStencilState=s,this.blendState=a,this.primitive=o,this.dynamicStates=h})),Cu=t("GFXPipelineState",function(t){function e(e){var i;return(i=t.call(this,Zh.PIPELINE_STATE)||this)._device=void 0,i._shader=null,i._pipelineLayout=null,i._primitive=ol.TRIANGLE_LIST,i._is=null,i._rs=null,i._dss=null,i._bs=null,i._dynamicStates=Ol.NONE,i._renderPass=null,i._device=e,i}return s(e,t),r(e,[{key:"shader",get:function(){return this._shader}},{key:"pipelineLayout",get:function(){return this._pipelineLayout}},{key:"primitive",get:function(){return this._primitive}},{key:"rasterizerState",get:function(){return this._rs}},{key:"depthStencilState",get:function(){return this._dss}},{key:"blendState",get:function(){return this._bs}},{key:"inputState",get:function(){return this._is}},{key:"dynamicStates",get:function(){return this._dynamicStates}},{key:"renderPass",get:function(){return this._renderPass}}]),e}(Dl)),wu=t("GFXQueueInfo",(function(t){void 0===t&&(t=Ml.GRAPHICS),this.type=t})),Ru=t("GFXQueue",function(t){function e(e){var i;return(i=t.call(this,Zh.QUEUE)||this)._device=void 0,i._type=Ml.GRAPHICS,i._isAsync=!1,i._device=e,i}return s(e,t),r(e,[{key:"type",get:function(){return this._type}}]),e.prototype.isAsync=function(){return this._isAsync},e}(Dl)),xu=t("GFXColorAttachment",(function(t,e,i,r,n,s){void 0===t&&(t=il.UNKNOWN),void 0===e&&(e=1),void 0===i&&(i=Cl.CLEAR),void 0===r&&(r=wl.STORE),void 0===n&&(n=Rl.UNDEFINED),void 0===s&&(s=Rl.PRESENT_SRC),this.format=t,this.sampleCount=e,this.loadOp=i,this.storeOp=r,this.beginLayout=n,this.endLayout=s})),Ou=t("GFXDepthStencilAttachment",(function(t,e,i,r,n,s,a,o){void 0===t&&(t=il.UNKNOWN),void 0===e&&(e=1),void 0===i&&(i=Cl.CLEAR),void 0===r&&(r=wl.STORE),void 0===n&&(n=Cl.CLEAR),void 0===s&&(s=wl.STORE),void 0===a&&(a=Rl.UNDEFINED),void 0===o&&(o=Rl.DEPTH_STENCIL_ATTACHMENT_OPTIMAL),this.format=t,this.sampleCount=e,this.depthLoadOp=i,this.depthStoreOp=r,this.stencilLoadOp=n,this.stencilStoreOp=s,this.beginLayout=a,this.endLayout=o})),Iu=t("GFXSubPassInfo",(function(t,e,i,r,n,s){void 0===t&&(t=xl.GRAPHICS),void 0===e&&(e=[]),void 0===i&&(i=[]),void 0===r&&(r=[]),void 0===n&&(n=-1),void 0===s&&(s=[]),this.bindPoint=t,this.inputs=e,this.colors=i,this.resolves=r,this.depthStencil=n,this.preserves=s})),Mu=t("GFXRenderPassInfo",(function(t,e,i){void 0===t&&(t=[]),void 0===e&&(e=null),void 0===i&&(i=[]),this.colorAttachments=t,this.depthStencilAttachment=e,this.subPasses=i})),Bu=t("GFXRenderPass",function(t){function e(e){var i;return(i=t.call(this,Zh.RENDER_PASS)||this)._device=void 0,i._colorInfos=[],i._depthStencilInfo=null,i._subPasses=[],i._hash=0,i._device=e,i}return s(e,t),r(e,[{key:"colorAttachments",get:function(){return this._colorInfos}},{key:"depthStencilAttachment",get:function(){return this._depthStencilInfo}},{key:"subPasses",get:function(){return this._subPasses}},{key:"hash",get:function(){return this._hash}}]),e.prototype.computeHash=function(){var t="";if(this._subPasses.length)for(var e=0;e<this._subPasses.length;++e){var i=this._subPasses[e];if(i.inputs.length){t+="ia";for(var r=0;r<i.inputs.length;++r){var n=this._colorInfos[i.inputs[r]];t+=","+n.format+","+n.sampleCount}}if(i.colors.length){t+="ca";for(var s=0;s<i.inputs.length;++s){var a=this._colorInfos[i.inputs[s]];t+=","+a.format+","+a.sampleCount}}if(i.depthStencil>=0){var o=this._colorInfos[i.depthStencil];t+="ds,"+o.format+","+o.sampleCount}}else{t+="ca";for(var h=0;h<this._colorInfos.length;++h){var l=this._colorInfos[h];t+=","+l.format+","+l.sampleCount}var u=this._depthStencilInfo;u&&(t+="ds,"+u.format+","+u.sampleCount)}return ou(t,666)},e}(Dl)),Pu=t("GFXSamplerInfo",(function(t,e,i,r,n,s,a,o,h,l,u,c){void 0===t&&(t=ml.LINEAR),void 0===e&&(e=ml.LINEAR),void 0===i&&(i=ml.NONE),void 0===r&&(r=gl.WRAP),void 0===n&&(n=gl.WRAP),void 0===s&&(s=gl.WRAP),void 0===a&&(a=16),void 0===o&&(o=cl.NEVER),void 0===h&&(h=new du),void 0===l&&(l=0),void 0===u&&(u=0),void 0===c&&(c=0),this.minFilter=t,this.magFilter=e,this.mipFilter=i,this.addressU=r,this.addressV=n,this.addressW=s,this.maxAnisotropy=a,this.cmpFunc=o,this.borderColor=h,this.minLOD=l,this.maxLOD=u,this.mipLODBias=c})),Nu=t("GFXSampler",function(t){function e(e){var i;return(i=t.call(this,Zh.SAMPLER)||this)._device=void 0,i._minFilter=ml.LINEAR,i._magFilter=ml.LINEAR,i._mipFilter=ml.NONE,i._addressU=gl.WRAP,i._addressV=gl.WRAP,i._addressW=gl.WRAP,i._maxAnisotropy=16,i._cmpFunc=cl.NEVER,i._borderColor=new du,i._minLOD=0,i._maxLOD=0,i._mipLODBias=0,i._device=e,i}return s(e,t),r(e,[{key:"minFilter",get:function(){return this._minFilter}},{key:"magFilter",get:function(){return this._magFilter}},{key:"mipFilter",get:function(){return this._mipFilter}},{key:"addressU",get:function(){return this._addressU}},{key:"addressV",get:function(){return this._addressV}},{key:"addressW",get:function(){return this._addressW}},{key:"maxAnisotropy",get:function(){return this._maxAnisotropy}},{key:"cmpFunc",get:function(){return this._cmpFunc}},{key:"borderColor",get:function(){return this._borderColor}},{key:"minLOD",get:function(){return this._minLOD}},{key:"maxLOD",get:function(){return this._maxLOD}},{key:"mipLODBias",get:function(){return this._mipLODBias}}]),e}(Dl)),Lu=t("GFXShaderStage",(function(t,e){void 0===t&&(t=Sl.NONE),void 0===e&&(e=""),this.stage=t,this.source=e})),Fu=t("GFXUniform",(function(t,e,i){void 0===t&&(t=""),void 0===e&&(e=el.UNKNOWN),void 0===i&&(i=1),this.name=t,this.type=e,this.count=i})),Du=t("GFXUniformBlock",(function(t,e,i,r,n){void 0===t&&(t=-1),void 0===e&&(e=-1),void 0===i&&(i=""),void 0===r&&(r=[]),void 0===n&&(n=1),this.set=t,this.binding=e,this.name=i,this.members=r,this.count=n})),Uu=t("GFXUniformSampler",(function(t,e,i,r,n){void 0===t&&(t=-1),void 0===e&&(e=-1),void 0===i&&(i=""),void 0===r&&(r=el.UNKNOWN),void 0===n&&(n=1),this.set=t,this.binding=e,this.name=i,this.type=r,this.count=n})),ku=t("GFXShaderInfo",(function(t,e,i,r,n){void 0===t&&(t=""),void 0===e&&(e=[]),void 0===i&&(i=[]),void 0===r&&(r=[]),void 0===n&&(n=[]),this.name=t,this.stages=e,this.attributes=i,this.blocks=r,this.samplers=n})),zu=t("GFXShader",function(t){function e(i){var r;return(r=t.call(this,Zh.SHADER)||this)._device=void 0,r._id=void 0,r._name="",r._stages=[],r._attributes=[],r._blocks=[],r._samplers=[],r._device=i,r._id=e._shaderIdGen++,r}return s(e,t),r(e,[{key:"id",get:function(){return this._id}},{key:"name",get:function(){return this._name}},{key:"attributes",get:function(){return this._attributes}},{key:"blocks",get:function(){return this._blocks}},{key:"samplers",get:function(){return this._samplers}}]),e}(Dl));zu._shaderIdGen=0;var Gu=t("GFXTextureInfo",(function(t,e,i,r,n,s,a,o,h,l){void 0===e&&(e=yl.NONE),void 0===i&&(i=il.UNKNOWN),void 0===r&&(r=0),void 0===n&&(n=0),void 0===s&&(s=El.NONE),void 0===a&&(a=1),void 0===o&&(o=1),void 0===h&&(h=Tl.X1),void 0===l&&(l=1),this.type=t,this.usage=e,this.format=i,this.width=r,this.height=n,this.flags=s,this.layerCount=a,this.levelCount=o,this.samples=h,this.depth=l})),Hu=t("GFXTextureViewInfo",(function(t,e,i,r,n,s,a){void 0===e&&(e=vl.TEX2D),void 0===i&&(i=il.UNKNOWN),void 0===r&&(r=0),void 0===n&&(n=1),void 0===s&&(s=0),void 0===a&&(a=1),this.texture=t,this.type=e,this.format=i,this.baseLevel=r,this.levelCount=n,this.baseLayer=s,this.layerCount=a}));function Vu(t){return t>0&&0==(t&t-1)}var Wu=t("GFXTexture",function(t){function e(e){var i;return(i=t.call(this,Zh.TEXTURE)||this)._device=void 0,i._type=vl.TEX2D,i._usage=yl.NONE,i._format=il.UNKNOWN,i._width=0,i._height=0,i._depth=1,i._layerCount=1,i._levelCount=1,i._samples=Tl.X1,i._flags=El.NONE,i._isPowerOf2=!1,i._size=0,i._buffer=null,i._device=e,i}return s(e,t),r(e,[{key:"type",get:function(){return this._type}},{key:"usage",get:function(){return this._usage}},{key:"format",get:function(){return this._format}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"depth",get:function(){return this._depth}},{key:"layerCount",get:function(){return this._layerCount}},{key:"levelCount",get:function(){return this._levelCount}},{key:"samples",get:function(){return this._samples}},{key:"flags",get:function(){return this._flags}},{key:"size",get:function(){return this._size}},{key:"buffer",get:function(){return this._buffer}}]),e}(Dl)),ju={Device:iu,Buffer:Ql,Texture:Wu,Sampler:Nu,Shader:zu,InputAssembler:uu,RenderPass:Bu,Framebuffer:nu,PipelineState:Cu,CommandBuffer:$l,Queue:Ru,FormatSize:Gl,FormatSurfaceSize:Hl,GetTypeSize:Wl,getTypedArrayConstructor:jl,MAX_ATTACHMENTS:$h,ObjectType:Zh,Obj:Dl,AttributeName:tl,Type:el,Format:il,BufferUsageBit:rl,MemoryUsageBit:nl,BufferFlagBit:sl,BufferAccessBit:al,PrimitiveMode:ol,PolygonMode:hl,ShadeModel:ll,CullMode:ul,ComparisonFunc:cl,StencilOp:_l,BlendOp:dl,BlendFactor:pl,ColorMask:fl,Filter:ml,Address:gl,TextureType:vl,TextureUsageBit:yl,SampleCount:Tl,TextureFlagBit:El,ShaderStageFlagBit:Sl,DescriptorType:bl,CommandBufferType:Al,LoadOp:Cl,StoreOp:wl,TextureLayout:Rl,PipelineBindPoint:xl,DynamicStateFlagBit:Ol,StencilFace:Il,QueueType:Ml,Rect:cu,Viewport:_u,Color:du,ClearFlag:Bl,Offset:pu,Extent:fu,TextureSubres:mu,TextureCopy:gu,BufferTextureCopy:vu,FormatType:Pl,FormatInfo:Ul,MemoryStatus:kl,FormatInfos:zl},Xu=t("GFX_DESCRIPTOR_BUFFER_TYPE",bl.UNIFORM_BUFFER|bl.DYNAMIC_UNIFORM_BUFFER|bl.STORAGE_BUFFER|bl.DYNAMIC_STORAGE_BUFFER),Yu=t("GFX_DESCRIPTOR_SAMPLER_TYPE",bl.SAMPLER),qu=t("GFXDescriptorSetInfo",(function(t){this.layout=t})),Ku=t("GFXDescriptorSet",function(t){function e(e){var i;return(i=t.call(this,Zh.DESCRIPTOR_SET)||this)._device=void 0,i._layout=null,i._buffers=[],i._textures=[],i._samplers=[],i._isDirty=!1,i._device=e,i}s(e,t),r(e,[{key:"layout",get:function(){return this._layout}}]);var i=e.prototype;return i.bindBuffer=function(t,e,i){void 0===i&&(i=0);var r=this._layout.bindingIndices[t],n=this._layout.bindings[r];if(n)if(n.descriptorType&Xu){var s=this._layout.descriptorIndices[t];this._buffers[s+i]!==e&&(this._buffers[s+i]=e,this._isDirty=!0)}else console.warn("Setting binding is not DescriptorType.UNIFORM_BUFFER.")},i.bindSampler=function(t,e,i){void 0===i&&(i=0);var r=this._layout.bindingIndices[t],n=this._layout.bindings[r];if(n)if(n.descriptorType&Yu){var s=this._layout.descriptorIndices[t];this._samplers[s+i]!==e&&(this._samplers[s+i]=e,this._isDirty=!0)}else console.warn("Setting binding is not DescriptorType.SAMPLER.")},i.bindTexture=function(t,e,i){void 0===i&&(i=0);var r=this._layout.bindingIndices[t],n=this._layout.bindings[r];if(n)if(n.descriptorType&Yu){var s=this._layout.descriptorIndices[t];this._textures[s+i]!==e&&(this._textures[s+i]=e,this._isDirty=!0)}else console.warn("Setting binding is not DescriptorType.SAMPLER.")},i.getBuffer=function(t,e){void 0===e&&(e=0);var i=this._layout.descriptorIndices[t];return this._buffers[i+e]},i.getSampler=function(t,e){void 0===e&&(e=0);var i=this._layout.descriptorIndices[t];return this._samplers[i+e]},i.getTexture=function(t,e){void 0===e&&(e=0);var i=this._layout.descriptorIndices[t];return this._textures[i+e]},e}(Dl)),Zu=t("GFXDescriptorSetLayoutBinding",(function(t,e,i,r,n){void 0===t&&(t=-1),void 0===e&&(e=bl.UNKNOWN),void 0===i&&(i=0),void 0===r&&(r=Sl.NONE),void 0===n&&(n=[]),this.binding=t,this.descriptorType=e,this.count=i,this.stageFlags=r,this.immutableSamplers=n})),Qu=t("GFXDescriptorSetLayoutInfo",(function(t){void 0===t&&(t=[]),this.bindings=t})),Ju=t("GFX_DESCRIPTOR_DYNAMIC_TYPE",bl.DYNAMIC_STORAGE_BUFFER|bl.DYNAMIC_UNIFORM_BUFFER),$u=t("GFXDescriptorSetLayout",function(t){function e(e){var i;return(i=t.call(this,Zh.DESCRIPTOR_SET_LAYOUT)||this)._device=void 0,i._bindings=[],i._bindingIndices=[],i._descriptorIndices=[],i._device=e,i}return s(e,t),r(e,[{key:"bindings",get:function(){return this._bindings}},{key:"bindingIndices",get:function(){return this._bindingIndices}},{key:"descriptorIndices",get:function(){return this._descriptorIndices}}]),e}(Dl)),tc=t("GFXPipelineLayoutInfo",(function(t){void 0===t&&(t=[]),this.setLayouts=t})),ec=t("GFXPipelineLayout",function(t){function e(e){var i;return(i=t.call(this,Zh.PIPELINE_LAYOUT)||this)._device=void 0,i._setLayouts=[],i._device=e,i}return s(e,t),r(e,[{key:"setLayouts",get:function(){return this._setLayouts}}]),e}(Dl)),ic=t("GFXFenceInfo",(function(){})),rc=t("GFXFence",function(t){function e(e){var i;return(i=t.call(this,Zh.FENCE)||this)._device=void 0,i._device=e,i}return s(e,t),e}(Dl));$s(_,"cc",[{name:"GFXDynamicState",newName:"DynamicStateFlagBit"},{name:"GFXBindingType",newName:"DescriptorType"},{name:"GFXBindingLayout",newName:"DescriptorSet"}]),ta($l.prototype,"CommandBuffer.prototype",[{name:"bindBindingLayout",suggest:"Use `bindDescriptorSet` instead"}]);var nc,sc={MAX_ATTACHMENTS:"GFX_MAX_ATTACHMENTS",Obj:"GFXObject",getTypedArrayConstructor:""};for(var ac in ju){var oc=sc[ac];""!==oc&&(void 0===oc&&(oc="GFX"+ac),$s(_,"cc",[{name:oc,newName:ac,target:_.gfx,targetName:"cc.gfx"}]))}_.gfx=ju,t("gfx",Object.freeze({__proto__:null,DESCRIPTOR_BUFFER_TYPE:Xu,DESCRIPTOR_SAMPLER_TYPE:Yu,DescriptorSetInfo:qu,DescriptorSet:Ku,DrawInfo:Xl,DRAW_INFO_SIZE:Yl,IndirectBuffer:ql,BufferInfo:Kl,BufferViewInfo:Zl,Buffer:Ql,CommandBufferInfo:Jl,CommandBuffer:$l,MAX_ATTACHMENTS:$h,get ObjectType(){return Zh},Obj:Dl,get AttributeName(){return tl},get Type(){return el},get Format(){return il},get BufferUsageBit(){return rl},get MemoryUsageBit(){return nl},get BufferFlagBit(){return sl},get BufferAccessBit(){return al},get PrimitiveMode(){return ol},get PolygonMode(){return hl},get ShadeModel(){return ll},get CullMode(){return ul},get ComparisonFunc(){return cl},get StencilOp(){return _l},get BlendOp(){return dl},get BlendFactor(){return pl},get ColorMask(){return fl},get Filter(){return ml},get Address(){return gl},get TextureType(){return vl},get TextureUsageBit(){return yl},get SampleCount(){return Tl},get TextureFlagBit(){return El},get ShaderStageFlagBit(){return Sl},get DescriptorType(){return bl},get CommandBufferType(){return Al},get LoadOp(){return Cl},get StoreOp(){return wl},get TextureLayout(){return Rl},get PipelineBindPoint(){return xl},get DynamicStateFlagBit(){return Ol},get StencilFace(){return Il},get QueueType(){return Ml},get ClearFlag(){return Bl},get FormatType(){return Pl},get API(){return Nl},get SurfaceTransform(){return Ll},get Feature(){return Fl},FormatInfo:Ul,MemoryStatus:kl,FormatInfos:zl,FormatSize:Gl,FormatSurfaceSize:Hl,GetTypeSize:Wl,getTypedArrayConstructor:jl,Rect:cu,Viewport:_u,Color:du,Offset:pu,Extent:fu,TextureSubres:mu,TextureCopy:gu,BufferTextureCopy:vu,BindingMappingInfo:tu,DeviceInfo:eu,Device:iu,FramebufferInfo:ru,Framebuffer:nu,Attribute:hu,InputAssemblerInfo:lu,InputAssembler:uu,DescriptorSetLayoutBinding:Zu,DescriptorSetLayoutInfo:Qu,DESCRIPTOR_DYNAMIC_TYPE:Ju,DescriptorSetLayout:$u,PipelineLayoutInfo:tc,PipelineLayout:ec,RasterizerState:yu,DepthStencilState:Tu,BlendTarget:Eu,BlendState:Su,InputState:bu,PipelineStateInfo:Au,PipelineState:Cu,FenceInfo:ic,Fence:rc,QueueInfo:wu,Queue:Ru,ColorAttachment:xu,DepthStencilAttachment:Ou,SubPassInfo:Iu,RenderPassInfo:Mu,RenderPass:Bu,SamplerInfo:Pu,Sampler:Nu,ShaderStage:Lu,Uniform:Fu,UniformBlock:Du,UniformSampler:Uu,ShaderInfo:ku,Shader:zu,TextureInfo:Gu,TextureViewInfo:Hu,IsPowerOf2:Vu,Texture:Wu})),function(t){t[t.ALL=0]="ALL",t[t.CLOSEST=1]="CLOSEST",t[t.ANY=2]="ANY"}(nc||(nc={}));var hc,lc,uc,cc,_c,dc,pc,fc,mc=(hc=new Cs(0,0,0),function(t,e){var i=Cs.dot(t.d,e.n);if(Math.abs(i)<Number.EPSILON)return 0;Cs.multiplyScalar(hc,e.n,e.d);var r=Cs.dot(Cs.subtract(hc,hc,t.o),e.n)/i;return r<0?0:r}),gc=(lc=new Cs(0,0,0),uc=new Cs(0,0,0),cc=new Cs(0,0,0),_c=new Cs(0,0,0),dc=new Cs(0,0,0),function(t,e,i){Cs.subtract(lc,e.b,e.a),Cs.subtract(uc,e.c,e.a),Cs.cross(cc,t.d,uc);var r=Cs.dot(lc,cc);if(r<Number.EPSILON&&(!i||r>-Number.EPSILON))return 0;var n=1/r;Cs.subtract(_c,t.o,e.a);var s=Cs.dot(_c,cc)*n;if(s<0||s>1)return 0;Cs.cross(dc,_c,lc);var a=Cs.dot(t.d,dc)*n;if(a<0||s+a>1)return 0;var o=Cs.dot(uc,dc)*n;return o<0?0:o}),vc=function(){var t=new Cs(0,0,0);return function(e,i){var r=i.radius,n=i.center,s=e.o,a=e.d,o=r*r;Cs.subtract(t,n,s);var h=t.lengthSqr(),l=Cs.dot(t,a),u=o-(h-l*l);if(u<0)return 0;var c=Math.sqrt(u),_=h<o?l+c:l-c;return _<0?0:_}}(),yc=(pc=new Cs,fc=new Cs,function(t,e){return Cs.subtract(pc,e.center,e.halfExtents),Cs.add(fc,e.center,e.halfExtents),Tc(t,pc,fc)});function Tc(t,e,i){var r=t.o,n=t.d,s=1/n.x,a=1/n.y,o=1/n.z,h=(e.x-r.x)*s,l=(i.x-r.x)*s,u=(e.y-r.y)*a,c=(i.y-r.y)*a,_=(e.z-r.z)*o,d=(i.z-r.z)*o,p=Math.max(Math.max(Math.min(h,l),Math.min(u,c)),Math.min(_,d)),f=Math.min(Math.min(Math.max(h,l),Math.max(u,c)),Math.max(_,d));return f<0||p>f?0:p>0?p:f}var Ec,Sc,bc=function(){var t=new Cs,e=new Cs,i=new Cs,r=new Cs,n=new Cs,s=new Cs,a=new Cs,o=new Array(3),h=new Array(3),l=new Array(3),u=new Array(6);return function(c,_){o[0]=_.halfExtents.x,o[1]=_.halfExtents.y,o[2]=_.halfExtents.z,t=_.center,e=c.o,i=c.d,Cs.set(r,_.orientation.m00,_.orientation.m01,_.orientation.m02),Cs.set(n,_.orientation.m03,_.orientation.m04,_.orientation.m05),Cs.set(s,_.orientation.m06,_.orientation.m07,_.orientation.m08),Cs.subtract(a,t,e),h[0]=Cs.dot(r,i),h[1]=Cs.dot(n,i),h[2]=Cs.dot(s,i),l[0]=Cs.dot(r,a),l[1]=Cs.dot(n,a),l[2]=Cs.dot(s,a);for(var d=0;d<3;++d){if(0===h[d]){if(-l[d]-o[d]>0||-l[d]+o[d]<0)return 0;h[d]=1e-7}u[2*d+0]=(l[d]+o[d])/h[d],u[2*d+1]=(l[d]-o[d])/h[d]}var p=Math.max(Math.max(Math.min(u[0],u[1]),Math.min(u[2],u[3])),Math.min(u[4],u[5])),f=Math.min(Math.min(Math.max(u[0],u[1]),Math.max(u[2],u[3])),Math.max(u[4],u[5]));return f<0||p>f?0:p>0?p:f}}(),Ac=function(){var t=new Cs,e=new Cs,i=new Cs,r=new Cs,n=new Cs,s=new Cs,a=new Cs,o=new Qh;return function(h,l){var u=l.radius*l.radius,c=Cs.normalize(t,h.d),_=l.ellipseCenter0,d=l.ellipseCenter1,p=Cs.subtract(e,d,_);if(p.equals(Cs.ZERO))return o.radius=l.radius,o.center.set(l.ellipseCenter0),a_.raySphere(h,o);var f=h.o,m=Cs.subtract(i,f,_),g=Cs.cross(r,c,p),v=g.lengthSqr();if(0===v){o.radius=l.radius;var y=Cs.subtract(n,d,f);return m.lengthSqr()<y.lengthSqr()?o.center.set(l.ellipseCenter0):o.center.set(l.ellipseCenter1),a_.raySphere(h,o)}var T=Cs.cross(n,m,p),E=p.lengthSqr(),S=2*Cs.dot(g,T),b=S*S-4*v*(T.lengthSqr()-u*E);if(b<0)return 0;var A=(-S-Math.sqrt(b))/(2*v);if(A<0){o.radius=l.radius;var C=Cs.subtract(s,d,f);return m.lengthSqr()<C.lengthSqr()?o.center.set(l.ellipseCenter0):o.center.set(l.ellipseCenter1),a_.raySphere(h,o)}var w=Cs.scaleAndAdd(s,h.o,c,A),R=Cs.subtract(a,w,_),x=Cs.dot(R,p)/E;return x>=0&&x<=1?A:x<0?(o.radius=l.radius,o.center.set(l.ellipseCenter0),a_.raySphere(h,o)):x>1?(o.radius=l.radius,o.center.set(l.ellipseCenter1),a_.raySphere(h,o)):0}}(),Cc=function(){var t=Jh.create(),e={distance:1/0,doubleSided:!1,mode:nc.ANY},i=0,r=function(t,e,r,n,s,a){t===nc.CLOSEST?(i>e||0===i)&&(i=e,a&&(0===a.length?a.push({distance:e,vertexIndex0:r/3,vertexIndex1:n/3,vertexIndex2:s/3}):(a[0].distance=e,a[0].vertexIndex0=r/3,a[0].vertexIndex1=n/3,a[0].vertexIndex2=s/3))):(i=e,a&&a.push({distance:e,vertexIndex0:r/3,vertexIndex1:n/3,vertexIndex2:s/3}))};return function(n,s,a){if(i=0,0===s.geometricInfo.positions.length)return i;var o=void 0===a?e:a;if(Tc(n,s.geometricInfo.boundingBox.min,s.geometricInfo.boundingBox.max)){var h=s.primitiveMode,l=s.geometricInfo;!function(e,i,n,s,a){if(n===ol.TRIANGLE_LIST)for(var o=i.length,h=0;h<o;h+=3){var l=3*i[h],u=3*i[h+1],c=3*i[h+2];Cs.set(t.a,e[l],e[l+1],e[l+2]),Cs.set(t.b,e[u],e[u+1],e[u+2]),Cs.set(t.c,e[c],e[c+1],e[c+2]);var _=a_.rayTriangle(s,t,a.doubleSided);if(!(0===_||_>a.distance)&&(r(a.mode,_,l,u,c,a.result),a.mode===nc.ANY))return _}else if(n===ol.TRIANGLE_STRIP)for(var d=i.length-2,p=0,f=0;f<d;f+=1){var m=3*i[f-p],g=3*i[f+p+1],v=3*i[f+2];Cs.set(t.a,e[m],e[m+1],e[m+2]),Cs.set(t.b,e[g],e[g+1],e[g+2]),Cs.set(t.c,e[v],e[v+1],e[v+2]),p=~p;var y=a_.rayTriangle(s,t,a.doubleSided);if(!(0===y||y>a.distance)&&(r(a.mode,y,m,g,v,a.result),a.mode===nc.ANY))return y}else if(n===ol.TRIANGLE_FAN){var T=i.length-1,E=3*i[0];Cs.set(t.a,e[E],e[E+1],e[E+2]);for(var S=1;S<T;S+=1){var b=3*i[S],A=3*i[S+1];Cs.set(t.b,e[b],e[b+1],e[b+2]),Cs.set(t.c,e[A],e[A+1],e[A+2]);var C=a_.rayTriangle(s,t,a.doubleSided);if(!(0===C||C>a.distance)&&(r(a.mode,C,E,b,A,a.result),a.mode===nc.ANY))return C}}}(l.positions,l.indices,h,n,o)}return i}}(),wc=(Ec=0,Sc={distance:1/0,doubleSided:!1,mode:nc.ANY},function(t,e,i){Ec=0;var r=void 0===i?Sc:i,n=e.renderingSubMeshes.length,s=e.struct.minPosition,a=e.struct.maxPosition;if(s&&a&&!Tc(t,s,a))return Ec;for(var o=0;o<n;o++){var h=e.renderingSubMeshes[o],l=Cc(t,h,r);if(l)if(r.mode===nc.CLOSEST)(0===Ec||Ec>l)&&(Ec=l,r.subIndices&&(r.subIndices[0]=o));else if(Ec=l,r.subIndices&&r.subIndices.push(o),r.mode===nc.ANY)return l}return Ec&&r.mode===nc.CLOSEST&&(r.result&&(r.result[0].distance=Ec,r.result.length=1),r.subIndices&&(r.subIndices.length=1)),Ec}),Rc=function(){var t=0,e={distance:1/0,doubleSided:!1,mode:nc.ANY},i=new uo,r=new Hs;return function(n,s,a){t=0;var o=void 0===a?e:a,h=s.worldBounds;if(h&&!yc(n,h))return t;uo.copy(i,n),s.node&&(Hs.invert(r,s.node.getWorldMatrix(r)),Cs.transformMat4(i.o,n.o,r),Cs.transformMat4Normal(i.d,n.d,r));for(var l=s.subModels,u=0;u<l.length;u++){var c=l[u].subMesh,_=Cc(i,c,o);if(_)if(o.mode===nc.CLOSEST)(0===t||t>_)&&(t=_,o.subIndices&&(o.subIndices[0]=u));else if(t=_,o.subIndices&&o.subIndices.push(u),o.mode===nc.ANY)return _}return t&&o.mode===nc.CLOSEST&&(o.result&&(o.result[0].distance=t,o.result.length=1),o.subIndices&&(o.subIndices.length=1)),t}}(),xc=function(){var t=new Cs(0,0,0);return function(e,i){Cs.subtract(t,e.e,e.s);var r=(i.d-Cs.dot(e.s,i.n))/Cs.dot(t,i.n);return r<0||r>1?0:r}}(),Oc=function(){var t=new Cs(0,0,0),e=new Cs(0,0,0),i=new Cs(0,0,0),r=new Cs(0,0,0),n=new Cs(0,0,0),s=new Cs(0,0,0);return function(a,o,h){Cs.subtract(t,o.b,o.a),Cs.subtract(e,o.c,o.a),Cs.subtract(i,a.s,a.e),Cs.cross(n,t,e);var l=Cs.dot(i,n);if(l<=0)return 0;Cs.subtract(r,a.s,o.a);var u=Cs.dot(r,n);if(u<0||u>l)return 0;Cs.cross(s,i,r);var c=Cs.dot(e,s);if(c<0||c>l)return 0;var _=-Cs.dot(t,s);if(_<0||c+_>l)return 0;if(h){var d=1/l,p=1-(c*=d)-(_*=d);Cs.set(h,o.a.x*p+o.b.x*c+o.c.x*_,o.a.y*p+o.b.y*c+o.c.y*_,o.a.z*p+o.b.z*c+o.c.z*_)}return 1}}(),Ic=new uo;function Mc(t,e){Ic.o.set(t.s),Cs.subtract(Ic.d,t.e,t.s),Ic.d.normalize();var i=yc(Ic,e);return i<=t.length()?i:0}function Bc(t,e){Ic.o.set(t.s),Cs.subtract(Ic.d,t.e,t.s),Ic.d.normalize();var i=bc(Ic,e);return i<=t.length()?i:0}function Pc(t,e){Ic.o.set(t.s),Cs.subtract(Ic.d,t.e,t.s),Ic.d.normalize();var i=vc(Ic,e);return i<=t.length()?i:0}var Nc,Lc,Fc,Dc,Uc=(Nc=new Cs,Lc=new Cs,Fc=new Cs,Dc=new Cs,function(t,e){return Cs.subtract(Nc,t.center,t.halfExtents),Cs.add(Lc,t.center,t.halfExtents),Cs.subtract(Fc,e.center,e.halfExtents),Cs.add(Dc,e.center,e.halfExtents),Nc.x<=Dc.x&&Lc.x>=Fc.x&&Nc.y<=Dc.y&&Lc.y>=Fc.y&&Nc.z<=Dc.z&&Lc.z>=Fc.z});function kc(t,e,i,r,n,s){Cs.set(s[0],t.x+i.x*e.x+r.x*e.y+n.x*e.z,t.y+i.y*e.x+r.y*e.y+n.y*e.z,t.z+i.z*e.x+r.z*e.y+n.z*e.z),Cs.set(s[1],t.x-i.x*e.x+r.x*e.y+n.x*e.z,t.y-i.y*e.x+r.y*e.y+n.y*e.z,t.z-i.z*e.x+r.z*e.y+n.z*e.z),Cs.set(s[2],t.x+i.x*e.x-r.x*e.y+n.x*e.z,t.y+i.y*e.x-r.y*e.y+n.y*e.z,t.z+i.z*e.x-r.z*e.y+n.z*e.z),Cs.set(s[3],t.x+i.x*e.x+r.x*e.y-n.x*e.z,t.y+i.y*e.x+r.y*e.y-n.y*e.z,t.z+i.z*e.x+r.z*e.y-n.z*e.z),Cs.set(s[4],t.x-i.x*e.x-r.x*e.y-n.x*e.z,t.y-i.y*e.x-r.y*e.y-n.y*e.z,t.z-i.z*e.x-r.z*e.y-n.z*e.z),Cs.set(s[5],t.x+i.x*e.x-r.x*e.y-n.x*e.z,t.y+i.y*e.x-r.y*e.y-n.y*e.z,t.z+i.z*e.x-r.z*e.y-n.z*e.z),Cs.set(s[6],t.x-i.x*e.x+r.x*e.y-n.x*e.z,t.y-i.y*e.x+r.y*e.y-n.y*e.z,t.z-i.z*e.x+r.z*e.y-n.z*e.z),Cs.set(s[7],t.x-i.x*e.x-r.x*e.y+n.x*e.z,t.y-i.y*e.x-r.y*e.y+n.y*e.z,t.z-i.z*e.x-r.z*e.y+n.z*e.z)}function zc(t,e){for(var i=Cs.dot(e,t[0]),r=i,n=1;n<8;++n){var s=Cs.dot(e,t[n]);i=s<i?s:i,r=s>r?s:r}return[i,r]}var Gc,Hc=function(){for(var t=new Array(15),e=0;e<15;e++)t[e]=new Cs(0,0,0);for(var i=new Array(8),r=new Array(8),n=0;n<8;n++)i[n]=new Cs(0,0,0),r[n]=new Cs(0,0,0);var s=new Cs,a=new Cs;return function(e,n){Cs.set(t[0],1,0,0),Cs.set(t[1],0,1,0),Cs.set(t[2],0,0,1),Cs.set(t[3],n.orientation.m00,n.orientation.m01,n.orientation.m02),Cs.set(t[4],n.orientation.m03,n.orientation.m04,n.orientation.m05),Cs.set(t[5],n.orientation.m06,n.orientation.m07,n.orientation.m08);for(var o=0;o<3;++o)Cs.cross(t[6+3*o],t[o],t[0]),Cs.cross(t[7+3*o],t[o],t[1]),Cs.cross(t[7+3*o],t[o],t[2]);Cs.subtract(s,e.center,e.halfExtents),Cs.add(a,e.center,e.halfExtents),function(t,e,i){Cs.set(i[0],t.x,e.y,e.z),Cs.set(i[1],t.x,e.y,t.z),Cs.set(i[2],t.x,t.y,e.z),Cs.set(i[3],t.x,t.y,t.z),Cs.set(i[4],e.x,e.y,e.z),Cs.set(i[5],e.x,e.y,t.z),Cs.set(i[6],e.x,t.y,e.z),Cs.set(i[7],e.x,t.y,t.z)}(s,a,i),kc(n.center,n.halfExtents,t[3],t[4],t[5],r);for(var h=0;h<15;++h){var l=zc(i,t[h]),u=zc(r,t[h]);if(u[0]>l[1]||l[0]>u[1])return 0}return 1}}(),Vc=function(t,e){var i=t.halfExtents.x*Math.abs(e.n.x)+t.halfExtents.y*Math.abs(e.n.y)+t.halfExtents.z*Math.abs(e.n.z),r=Cs.dot(e.n,t.center);return r+i<e.d?-1:r-i>e.d?0:1},Wc=function(t,e){for(var i=0;i<e.planes.length;i++)if(-1===Vc(t,e.planes[i]))return 0;return 1},jc=function(){for(var t=new Array(8),e=0,i=0,r=0;r<t.length;r++)t[r]=new Cs(0,0,0);return function(r,n){for(var s=0,a=!1,o=0;o<n.planes.length;o++){if(-1===(s=Vc(r,n.planes[o])))return 0;1===s&&(a=!0)}if(!a)return 1;for(var h=0;h<n.vertices.length;h++)Cs.subtract(t[h],n.vertices[h],r.center);e=0,i=0;for(var l=0;l<n.vertices.length;l++)t[l].x>r.halfExtents.x?e++:t[l].x<-r.halfExtents.x&&i++;if(e===n.vertices.length||i===n.vertices.length)return 0;e=0,i=0;for(var u=0;u<n.vertices.length;u++)t[u].y>r.halfExtents.y?e++:t[u].y<-r.halfExtents.y&&i++;if(e===n.vertices.length||i===n.vertices.length)return 0;e=0,i=0;for(var c=0;c<n.vertices.length;c++)t[c].z>r.halfExtents.z?e++:t[c].z<-r.halfExtents.z&&i++;return e===n.vertices.length||i===n.vertices.length?0:1}}(),Xc=function(){var t=new Cs(0,0,0),e=new Ms;return function(i,r){return Cs.subtract(t,r,i.center),Cs.transformMat3(t,t,Ms.transpose(e,i.orientation)),n=t,s=i.halfExtents,Math.abs(n.x)<s.x&&Math.abs(n.y)<s.y&&Math.abs(n.z)<s.z;var n,s}}(),Yc=(Gc=function(t,e,i,r){return Math.abs(t.x*e+t.y*i+t.z*r)},function(t,e){var i=t.halfExtents.x*Gc(e.n,t.orientation.m00,t.orientation.m01,t.orientation.m02)+t.halfExtents.y*Gc(e.n,t.orientation.m03,t.orientation.m04,t.orientation.m05)+t.halfExtents.z*Gc(e.n,t.orientation.m06,t.orientation.m07,t.orientation.m08),r=Cs.dot(e.n,t.center);return r+i<e.d?-1:r-i>e.d?0:1}),qc=function(t,e){for(var i=0;i<e.planes.length;i++)if(-1===Yc(t,e.planes[i]))return 0;return 1},Kc=function(){for(var t=new Array(8),e=0,i=0,r=0,n=0;n<t.length;n++)t[n]=new Cs(0,0,0);var s=function(t,e,i,r){return t.x*e+t.y*i+t.z*r};return function(n,a){for(var o=0,h=!1,l=0;l<a.planes.length;l++){if(-1===(o=Yc(n,a.planes[l])))return 0;1===o&&(h=!0)}if(!h)return 1;for(var u=0;u<a.vertices.length;u++)Cs.subtract(t[u],a.vertices[u],n.center);i=0,r=0;for(var c=0;c<a.vertices.length;c++)(e=s(t[c],n.orientation.m00,n.orientation.m01,n.orientation.m02))>n.halfExtents.x?i++:e<-n.halfExtents.x&&r++;if(i===a.vertices.length||r===a.vertices.length)return 0;i=0,r=0;for(var _=0;_<a.vertices.length;_++)(e=s(t[_],n.orientation.m03,n.orientation.m04,n.orientation.m05))>n.halfExtents.y?i++:e<-n.halfExtents.y&&r++;if(i===a.vertices.length||r===a.vertices.length)return 0;i=0,r=0;for(var d=0;d<a.vertices.length;d++)(e=s(t[d],n.orientation.m06,n.orientation.m07,n.orientation.m08))>n.halfExtents.z?i++:e<-n.halfExtents.z&&r++;return i===a.vertices.length||r===a.vertices.length?0:1}}(),Zc=function(){for(var t=new Array(15),e=0;e<15;e++)t[e]=new Cs(0,0,0);for(var i=new Array(8),r=new Array(8),n=0;n<8;n++)i[n]=new Cs(0,0,0),r[n]=new Cs(0,0,0);return function(e,n){Cs.set(t[0],e.orientation.m00,e.orientation.m01,e.orientation.m02),Cs.set(t[1],e.orientation.m03,e.orientation.m04,e.orientation.m05),Cs.set(t[2],e.orientation.m06,e.orientation.m07,e.orientation.m08),Cs.set(t[3],n.orientation.m00,n.orientation.m01,n.orientation.m02),Cs.set(t[4],n.orientation.m03,n.orientation.m04,n.orientation.m05),Cs.set(t[5],n.orientation.m06,n.orientation.m07,n.orientation.m08);for(var s=0;s<3;++s)Cs.cross(t[6+3*s],t[s],t[0]),Cs.cross(t[7+3*s],t[s],t[1]),Cs.cross(t[7+3*s],t[s],t[2]);kc(e.center,e.halfExtents,t[0],t[1],t[2],i),kc(n.center,n.halfExtents,t[3],t[4],t[5],r);for(var a=0;a<15;++a){var o=zc(i,t[a]),h=zc(r,t[a]);if(h[0]>o[1]||o[0]>h[1])return 0}return 1}}(),Qc=function(){for(var t=new Qh,e=new Cs,i=new Cs,r=new Cs,n=new Array(8),s=0;s<8;s++)n[s]=new Cs;for(var a=new Array(8),o=0;o<8;o++)a[o]=new Cs;return function(s,o){if(0===Cs.squaredDistance(o.ellipseCenter0,o.ellipseCenter1))return t.radius=o.radius,t.center.set(o.ellipseCenter0),a_.sphereOBB(t,s);e.x=s.orientation.m00,e.y=s.orientation.m01,e.z=s.orientation.m02,i.x=s.orientation.m03,i.y=s.orientation.m04,i.z=s.orientation.m05,r.x=s.orientation.m06,r.y=s.orientation.m07,r.z=s.orientation.m08,kc(s.center,s.halfExtents,e,i,r,n);var h=a,l=Cs.copy(h[0],e),u=Cs.copy(h[1],i),c=Cs.copy(h[2],r);Cs.subtract(h[3],o.center,s.center).normalize();var _=Cs.subtract(h[4],o.ellipseCenter0,o.ellipseCenter1);_.normalize(),Cs.cross(h[5],l,_),Cs.cross(h[6],u,_),Cs.cross(h[7],c,_);for(var d=0;d<8;++d){var p=zc(n,h[d]),f=Cs.dot(h[d],o.ellipseCenter0),m=Cs.dot(h[d],o.ellipseCenter1),g=Math.max(f,m),v=Math.min(f,m)-o.radius,y=g+o.radius;if(v>p[1]||p[0]>y)return 0}return 1}}(),Jc=function(t,e){var i=Cs.dot(e.n,t.center),r=t.radius*e.n.length();return i+r<e.d?-1:i-r>e.d?0:1},$c=function(t,e){for(var i=0;i<e.planes.length;i++)if(-1===Jc(t,e.planes[i]))return 0;return 1},t_=function(){var t=new Cs(0,0,0),e=[1,-1,1,-1,1,-1];return function(i,r){for(var n=0;n<6;n++){var s=r.planes[n],a=i.radius,o=i.center,h=s.n,l=s.d,u=Cs.dot(h,o);if(u+a<l)return 0;if(!(u-a>l)){Cs.add(t,o,Cs.multiplyScalar(t,h,a));for(var c=0;c<6;c++)if(c!==n&&c!==n+e[n]){var _=r.planes[c];if(Cs.dot(_.n,t)<_.d)return 0}}}return 1}}(),e_=function(t,e){var i=t.radius+e.radius;return Cs.squaredDistance(t.center,e.center)<i*i},i_=function(){var t=new Cs;return function(e,i){return Ua(t,e.center,i),Cs.squaredDistance(e.center,t)<e.radius*e.radius}}(),r_=function(){var t=new Cs;return function(e,i){return ka(t,e.center,i),Cs.squaredDistance(e.center,t)<e.radius*e.radius}}(),n_=function(){var t=new Cs,e=new Cs;return function(i,r){var n=i.radius+r.radius,s=n*n,a=Cs.squaredDistance(r.ellipseCenter0,r.ellipseCenter1);if(0===a)return Cs.squaredDistance(i.center,r.center)<s;Cs.subtract(t,i.center,r.ellipseCenter0),Cs.subtract(e,r.ellipseCenter1,r.ellipseCenter0);var o=Cs.dot(t,e)/a;return o<0?Cs.squaredDistance(i.center,r.ellipseCenter0)<s:o>1?Cs.squaredDistance(i.center,r.ellipseCenter1)<s:(Cs.scaleAndAdd(t,r.ellipseCenter0,e,o),Cs.squaredDistance(i.center,t)<s)}}(),s_=function(){var t=new Cs,e=new Cs,i=new Cs,r=new Cs,n=new Cs,s=new Cs;return function(a,o){var h,l,u,c,_=Cs.subtract(t,a.ellipseCenter1,a.ellipseCenter0),d=Cs.subtract(e,o.ellipseCenter1,o.ellipseCenter0),p=Cs.subtract(i,a.ellipseCenter0,o.ellipseCenter0),f=Cs.dot(_,_),m=Cs.dot(_,d),g=Cs.dot(d,d),v=Cs.dot(_,p),y=Cs.dot(d,p),T=f*g-m*m,E=T,S=T;T<Rr?(l=0,E=1,c=y,S=g):(c=f*y-m*v,(l=m*y-g*v)<0?(l=0,c=y,S=g):l>E&&(l=E,c=y+m,S=g)),c<0?(c=0,-v<0?l=0:-v>f?l=E:(l=-v,E=f)):c>S&&(c=S,-v+m<0?l=0:-v+m>f?l=E:(l=-v+m,E=f)),h=Math.abs(l)<Rr?0:l/E,u=Math.abs(c)<Rr?0:c/S;var b=r;b.set(p),b.add(Cs.multiplyScalar(n,_,h)),b.subtract(Cs.multiplyScalar(s,d,u));var A=a.radius+o.radius;return b.lengthSqr()<A*A}}(),a_={raySphere:vc,rayAABB:yc,rayOBB:bc,rayPlane:mc,rayTriangle:gc,rayCapsule:Ac,raySubMesh:Cc,rayMesh:wc,rayModel:Rc,lineSphere:Pc,lineAABB:Mc,lineOBB:Bc,linePlane:xc,lineTriangle:Oc,sphereWithSphere:e_,sphereAABB:i_,sphereOBB:r_,spherePlane:Jc,sphereFrustum:$c,sphereFrustumAccurate:t_,sphereCapsule:n_,aabbWithAABB:Uc,aabbWithOBB:Hc,aabbPlane:Vc,aabbFrustum:Wc,aabbFrustumAccurate:jc,obbWithOBB:Zc,obbPlane:Yc,obbFrustum:qc,obbFrustumAccurate:Kc,obbPoint:Xc,obbCapsule:Qc,capsuleWithCapsule:s_,resolve:function(t,e,i){void 0===i&&(i=null);var r=t._type,n=e._type,s=this[r|n];return r<n?s(t,e,i):s(e,t,i)}};a_[xa.SHAPE_RAY|xa.SHAPE_SPHERE]=vc,a_[xa.SHAPE_RAY|xa.SHAPE_AABB]=yc,a_[xa.SHAPE_RAY|xa.SHAPE_OBB]=bc,a_[xa.SHAPE_RAY|xa.SHAPE_PLANE]=mc,a_[xa.SHAPE_RAY|xa.SHAPE_TRIANGLE]=gc,a_[xa.SHAPE_RAY|xa.SHAPE_CAPSULE]=Ac,a_[xa.SHAPE_LINE|xa.SHAPE_SPHERE]=Pc,a_[xa.SHAPE_LINE|xa.SHAPE_AABB]=Mc,a_[xa.SHAPE_LINE|xa.SHAPE_OBB]=Bc,a_[xa.SHAPE_LINE|xa.SHAPE_PLANE]=xc,a_[xa.SHAPE_LINE|xa.SHAPE_TRIANGLE]=Oc,a_[xa.SHAPE_SPHERE]=e_,a_[xa.SHAPE_SPHERE|xa.SHAPE_AABB]=i_,a_[xa.SHAPE_SPHERE|xa.SHAPE_OBB]=r_,a_[xa.SHAPE_SPHERE|xa.SHAPE_PLANE]=Jc,a_[xa.SHAPE_SPHERE|xa.SHAPE_FRUSTUM]=$c,a_[xa.SHAPE_SPHERE|xa.SHAPE_FRUSTUM_ACCURATE]=t_,a_[xa.SHAPE_SPHERE|xa.SHAPE_CAPSULE]=n_,a_[xa.SHAPE_AABB]=Uc,a_[xa.SHAPE_AABB|xa.SHAPE_OBB]=Hc,a_[xa.SHAPE_AABB|xa.SHAPE_PLANE]=Vc,a_[xa.SHAPE_AABB|xa.SHAPE_FRUSTUM]=Wc,a_[xa.SHAPE_AABB|xa.SHAPE_FRUSTUM_ACCURATE]=jc,a_[xa.SHAPE_OBB]=Zc,a_[xa.SHAPE_OBB|xa.SHAPE_PLANE]=Yc,a_[xa.SHAPE_OBB|xa.SHAPE_FRUSTUM]=qc,a_[xa.SHAPE_OBB|xa.SHAPE_FRUSTUM_ACCURATE]=Kc,a_[xa.SHAPE_OBB|xa.SHAPE_CAPSULE]=Qc,a_[xa.SHAPE_CAPSULE]=s_;var o_=function(){function t(t,e,i,r,n,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===s&&(s=-1),this.s=void 0,this.e=void 0,this._type=void 0,this._type=xa.SHAPE_LINE,this.s=new Cs(t,e,i),this.e=new Cs(r,n,s)}return t.create=function(e,i,r,n,s,a){return new t(e,i,r,n,s,a)},t.clone=function(e){return new t(e.s.x,e.s.y,e.s.z,e.e.x,e.e.y,e.e.z)},t.copy=function(t,e){return Cs.copy(t.s,e.s),Cs.copy(t.e,e.e),t},t.fromPoints=function(t,e,i){return Cs.copy(t.s,e),Cs.copy(t.e,i),t},t.set=function(t,e,i,r,n,s,a){return t.s.x=e,t.s.y=i,t.s.z=r,t.e.x=n,t.e.y=s,t.e.z=a,t},t.len=function(t){return Cs.distance(t.s,t.e)},r(t,[{key:"type",get:function(){return this._type}}]),t.prototype.length=function(){return Cs.distance(this.s,this.e)},t}(),h_=new Cs(0,0,0),l_=new Cs(0,0,0),u_=_.mat4(),c_=_.v4(),__=function(){function t(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=1),void 0===i&&(i=0),void 0===r&&(r=0),this.n=void 0,this.d=void 0,this._type=void 0,this._type=xa.SHAPE_PLANE,this.n=new Cs(t,e,i),this.d=r}return t.create=function(e,i,r,n){return new t(e,i,r,n)},t.clone=function(e){return new t(e.n.x,e.n.y,e.n.z,e.d)},t.copy=function(t,e){return Cs.copy(t.n,e.n),t.d=e.d,t},t.fromPoints=function(t,e,i,r){return Cs.subtract(h_,i,e),Cs.subtract(l_,r,e),Cs.normalize(t.n,Cs.cross(t.n,h_,l_)),t.d=Cs.dot(t.n,e),t},t.set=function(t,e,i,r,n){return t.n.x=e,t.n.y=i,t.n.z=r,t.d=n,t},t.fromNormalAndPoint=function(t,e,i){return Cs.copy(t.n,e),t.d=Cs.dot(e,i),t},t.normalize=function(t,e){var i=e.n.length();return Cs.normalize(t.n,e.n),i>0&&(t.d=e.d/i),t},r(t,[{key:"type",get:function(){return this._type}},{key:"x",set:function(t){this.n.x=t},get:function(){return this.n.x}},{key:"y",set:function(t){this.n.y=t},get:function(){return this.n.y}},{key:"z",set:function(t){this.n.z=t},get:function(){return this.n.z}},{key:"w",set:function(t){this.d=t},get:function(){return this.d}}]),t.prototype.transform=function(t){Hs.invert(u_,t),Hs.transpose(u_,u_),Os.set(c_,this.n.x,this.n.y,this.n.z,this.d),Os.transformMat4(c_,c_,u_),Cs.set(this.n,c_.x,c_.y,c_.z),this.d=c_.w},t}(),d_=new Cs,p_=new Cs,f_=new Cs,m_=new Cs,g_=new Ms,v_=function(t,e,i){g_.m00=Math.abs(i.m00),g_.m01=Math.abs(i.m01),g_.m02=Math.abs(i.m02),g_.m03=Math.abs(i.m04),g_.m04=Math.abs(i.m05),g_.m05=Math.abs(i.m06),g_.m06=Math.abs(i.m08),g_.m07=Math.abs(i.m09),g_.m08=Math.abs(i.m10),Cs.transformMat3(t,e,g_)},y_=function(){function t(t,e,i,r,n,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===n&&(n=1),void 0===s&&(s=1),this.center=void 0,this.halfExtents=void 0,this._type=void 0,this._type=xa.SHAPE_AABB,this.center=new Cs(t,e,i),this.halfExtents=new Cs(r,n,s)}t.create=function(e,i,r,n,s,a){return new t(e,i,r,n,s,a)},t.clone=function(e){return new t(e.center.x,e.center.y,e.center.z,e.halfExtents.x,e.halfExtents.y,e.halfExtents.z)},t.copy=function(t,e){return Cs.copy(t.center,e.center),Cs.copy(t.halfExtents,e.halfExtents),t},t.fromPoints=function(t,e,i){return Cs.add(d_,i,e),Cs.subtract(p_,i,e),Cs.multiplyScalar(t.center,d_,.5),Cs.multiplyScalar(t.halfExtents,p_,.5),t},t.set=function(t,e,i,r,n,s,a){return Cs.set(t.center,e,i,r),Cs.set(t.halfExtents,n,s,a),t},t.merge=function(e,i,r){return Cs.subtract(d_,i.center,i.halfExtents),Cs.subtract(p_,r.center,r.halfExtents),Cs.add(f_,i.center,i.halfExtents),Cs.add(m_,r.center,r.halfExtents),Cs.max(m_,f_,m_),Cs.min(f_,d_,p_),t.fromPoints(e,f_,m_)},t.toBoundingSphere=function(t,e){e.getBoundary(d_,p_),t.center.set(d_),t.radius=0,Cs.subtract(f_,p_,t.center);var i=f_.length(),r=.5*i;return t.radius+=r,Cs.multiplyScalar(f_,f_,r/i),Cs.add(t.center,t.center,f_),t},t.transform=function(t,e,i){return Cs.transformMat4(t.center,e.center,i),v_(t.halfExtents,e.halfExtents,i),t},r(t,[{key:"type",get:function(){return this._type}}]);var e=t.prototype;return e.getBoundary=function(t,e){Cs.subtract(t,this.center,this.halfExtents),Cs.add(e,this.center,this.halfExtents)},e.transform=function(t,e,i,r,n){Cs.transformMat4(n.center,this.center,t),v_(n.halfExtents,this.halfExtents,t)},e.clone=function(){return t.clone(this)},e.copy=function(e){return t.copy(this,e)},t}(),T_=new Cs,E_=new Cs,S_=new Ms,b_=function(){function t(t,e,i,r,n,s,a,o,h,l,u,c,_,d,p){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===n&&(n=1),void 0===s&&(s=1),void 0===a&&(a=1),void 0===o&&(o=0),void 0===h&&(h=0),void 0===l&&(l=0),void 0===u&&(u=1),void 0===c&&(c=0),void 0===_&&(_=0),void 0===d&&(d=0),void 0===p&&(p=1),this.center=void 0,this.halfExtents=void 0,this.orientation=void 0,this._type=void 0,this._type=xa.SHAPE_OBB,this.center=new Cs(t,e,i),this.halfExtents=new Cs(r,n,s),this.orientation=new Ms(a,o,h,l,u,c,_,d,p)}t.create=function(e,i,r,n,s,a,o,h,l,u,c,_,d,p,f){return new t(e,i,r,n,s,a,o,h,l,u,c,_,d,p,f)},t.clone=function(e){return new t(e.center.x,e.center.y,e.center.z,e.halfExtents.x,e.halfExtents.y,e.halfExtents.z,e.orientation.m00,e.orientation.m01,e.orientation.m02,e.orientation.m03,e.orientation.m04,e.orientation.m05,e.orientation.m06,e.orientation.m07,e.orientation.m08)},t.copy=function(t,e){return Cs.copy(t.center,e.center),Cs.copy(t.halfExtents,e.halfExtents),Ms.copy(t.orientation,e.orientation),t},t.fromPoints=function(t,e,i){return Cs.multiplyScalar(t.center,Cs.add(T_,e,i),.5),Cs.multiplyScalar(t.halfExtents,Cs.subtract(E_,i,e),.5),Ms.identity(t.orientation),t},t.set=function(t,e,i,r,n,s,a,o,h,l,u,c,_,d,p,f){return Cs.set(t.center,e,i,r),Cs.set(t.halfExtents,n,s,a),Ms.set(t.orientation,o,h,l,u,c,_,d,p,f),t},r(t,[{key:"type",get:function(){return this._type}}]);var e=t.prototype;return e.getBoundary=function(t,e){var i,r,n;i=T_,r=this.halfExtents,n=this.orientation,S_.m00=Math.abs(n.m00),S_.m01=Math.abs(n.m01),S_.m02=Math.abs(n.m02),S_.m03=Math.abs(n.m03),S_.m04=Math.abs(n.m04),S_.m05=Math.abs(n.m05),S_.m06=Math.abs(n.m06),S_.m07=Math.abs(n.m07),S_.m08=Math.abs(n.m08),Cs.transformMat3(i,r,S_),Cs.subtract(t,this.center,T_),Cs.add(e,this.center,T_)},e.transform=function(t,e,i,r,n){Cs.transformMat4(n.center,this.center,t),Ms.fromQuat(n.orientation,i),Cs.multiply(n.halfExtents,this.halfExtents,r)},e.translateAndRotate=function(t,e,i){Cs.transformMat4(i.center,this.center,t),Ms.fromQuat(i.orientation,e)},e.setScale=function(t,e){Cs.multiply(e.halfExtents,this.halfExtents,t)},t}(),A_=function(){function t(t,e,i){void 0===t&&(t=.5),void 0===e&&(e=.5),void 0===i&&(i=1),this._type=void 0,this.radius=void 0,this.halfHeight=void 0,this.axis=void 0,this.center=void 0,this.rotation=void 0,this.ellipseCenter0=void 0,this.ellipseCenter1=void 0,this._type=xa.SHAPE_CAPSULE,this.radius=t,this.halfHeight=e,this.axis=i,this.center=new Cs,this.rotation=new Ns,this.ellipseCenter0=new Cs(0,e,0),this.ellipseCenter1=new Cs(0,-e,0),this.updateCache()}r(t,[{key:"type",get:function(){return this._type}}]);var e=t.prototype;return e.transform=function(t,e,i,r,n){var s=r,a=jr(s);n.radius=this.radius*Math.abs(a);var o=(this.halfHeight+this.radius)*Math.abs(s.y)-n.radius;o<0&&(o=0),n.halfHeight=o,Cs.transformMat4(n.center,this.center,t),Ns.multiply(n.rotation,this.rotation,i),n.updateCache()},e.updateCache=function(){this.updateLocalCenter(),Cs.transformQuat(this.ellipseCenter0,this.ellipseCenter0,this.rotation),Cs.transformQuat(this.ellipseCenter1,this.ellipseCenter1,this.rotation),this.ellipseCenter0.add(this.center),this.ellipseCenter1.add(this.center)},e.updateLocalCenter=function(){var t=this.halfHeight;switch(this.axis){case 0:this.ellipseCenter0.set(t,0,0),this.ellipseCenter1.set(-t,0,0);break;case 1:this.ellipseCenter0.set(0,t,0),this.ellipseCenter1.set(0,-t,0);break;case 2:this.ellipseCenter0.set(0,0,t),this.ellipseCenter1.set(0,0,-t)}},t}(),C_=new Array(8);C_[0]=new Cs(1,1,1),C_[1]=new Cs(-1,1,1),C_[2]=new Cs(-1,-1,1),C_[3]=new Cs(1,-1,1),C_[4]=new Cs(1,1,-1),C_[5]=new Cs(-1,1,-1),C_[6]=new Cs(-1,-1,-1),C_[7]=new Cs(1,-1,-1);var w_,R_,x_=function(){function t(){this._type=void 0,this.planes=void 0,this.vertices=void 0,this._type=xa.SHAPE_FRUSTUM,this.planes=new Array(6);for(var t=0;t<6;++t)this.planes[t]=__.create(0,0,0,0);this.vertices=new Array(8);for(var e=0;e<8;++e)this.vertices[e]=new Cs}t.create=function(){return new t},t.clone=function(e){return t.copy(new t,e)},t.copy=function(t,e){t._type=e._type;for(var i=0;i<6;++i)__.copy(t.planes[i],e.planes[i]);for(var r=0;r<8;++r)Cs.copy(t.vertices[r],e.vertices[r]);return t},r(t,[{key:"accurate",set:function(t){this._type=t?xa.SHAPE_FRUSTUM_ACCURATE:xa.SHAPE_FRUSTUM}},{key:"type",get:function(){return this._type}}]);var e=t.prototype;return e.update=function(t,e){if(Cs.set(this.planes[0].n,t.m03+t.m00,t.m07+t.m04,t.m11+t.m08),this.planes[0].d=-(t.m15+t.m12),Cs.set(this.planes[1].n,t.m03-t.m00,t.m07-t.m04,t.m11-t.m08),this.planes[1].d=-(t.m15-t.m12),Cs.set(this.planes[2].n,t.m03+t.m01,t.m07+t.m05,t.m11+t.m09),this.planes[2].d=-(t.m15+t.m13),Cs.set(this.planes[3].n,t.m03-t.m01,t.m07-t.m05,t.m11-t.m09),this.planes[3].d=-(t.m15-t.m13),Cs.set(this.planes[4].n,t.m03+t.m02,t.m07+t.m06,t.m11+t.m10),this.planes[4].d=-(t.m15+t.m14),Cs.set(this.planes[5].n,t.m03-t.m02,t.m07-t.m06,t.m11-t.m10),this.planes[5].d=-(t.m15-t.m14),this._type===xa.SHAPE_FRUSTUM_ACCURATE){for(var i=0;i<6;i++){var r=this.planes[i],n=1/r.n.length();Cs.multiplyScalar(r.n,r.n,n),r.d*=n}for(var s=0;s<8;s++)Cs.transformMat4(this.vertices[s],C_[s],e)}},e.transform=function(t){if(this._type===xa.SHAPE_FRUSTUM_ACCURATE){for(var e=0;e<8;e++)Cs.transformMat4(this.vertices[e],this.vertices[e],t);__.fromPoints(this.planes[0],this.vertices[1],this.vertices[5],this.vertices[6]),__.fromPoints(this.planes[1],this.vertices[3],this.vertices[7],this.vertices[4]),__.fromPoints(this.planes[2],this.vertices[6],this.vertices[7],this.vertices[3]),__.fromPoints(this.planes[3],this.vertices[0],this.vertices[4],this.vertices[5]),__.fromPoints(this.planes[4],this.vertices[2],this.vertices[3],this.vertices[0]),__.fromPoints(this.planes[0],this.vertices[7],this.vertices[6],this.vertices[5])}},t}();function O_(t,e){if(e&&0!==t){for(var i=e.vertices,r=sh.VERTICES,n=0;n<8;++n)uh.setVec3(t,r,i[n]),r+=3;for(var s=e.planes,a=sh.PLANES,o=0;o<6;o++,a+=4)uh.setVec4(t,a,s[o])}}x_.createOrtho=function(){var t=new Cs;return function(e,i,r,n,s,a){var o=i/2,h=r/2;Cs.set(t,o,h,n),Cs.transformMat4(e.vertices[0],t,a),Cs.set(t,-o,h,n),Cs.transformMat4(e.vertices[1],t,a),Cs.set(t,-o,-h,n),Cs.transformMat4(e.vertices[2],t,a),Cs.set(t,o,-h,n),Cs.transformMat4(e.vertices[3],t,a),Cs.set(t,o,h,s),Cs.transformMat4(e.vertices[4],t,a),Cs.set(t,-o,h,s),Cs.transformMat4(e.vertices[5],t,a),Cs.set(t,-o,-h,s),Cs.transformMat4(e.vertices[6],t,a),Cs.set(t,o,-h,s),Cs.transformMat4(e.vertices[7],t,a),__.fromPoints(e.planes[0],e.vertices[1],e.vertices[6],e.vertices[5]),__.fromPoints(e.planes[1],e.vertices[3],e.vertices[4],e.vertices[7]),__.fromPoints(e.planes[2],e.vertices[6],e.vertices[3],e.vertices[7]),__.fromPoints(e.planes[3],e.vertices[0],e.vertices[5],e.vertices[4]),__.fromPoints(e.planes[4],e.vertices[2],e.vertices[0],e.vertices[3]),__.fromPoints(e.planes[0],e.vertices[7],e.vertices[5],e.vertices[6])}}(),function(t){t[t.Default=0]="Default",t[t.Normal=1]="Normal",t[t.Loop=2]="Loop",t[t.ShouldWrap=4]="ShouldWrap",t[t.Clamp=8]="Clamp",t[t.PingPong=22]="PingPong",t[t.Reverse=36]="Reverse"}(w_||(w_={})),function(t){t[t.Default=w_.Default]="Default",t[t.Normal=w_.Normal]="Normal",t[t.Reverse=w_.Reverse]="Reverse",t[t.Loop=w_.Loop]="Loop",t[t.LoopReverse=w_.Loop|w_.Reverse]="LoopReverse",t[t.PingPong=w_.PingPong]="PingPong",t[t.PingPongReverse=w_.PingPong|w_.Reverse]="PingPongReverse"}(R_||(R_={})),Ft(R_);var I_=function(){function t(t){this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0,t&&this.set(t)}return t.prototype.set=function(t){this.ratio=t.ratio,this.time=t.time,this.direction=t.direction,this.stopped=t.stopped,this.iterations=t.iterations,this.frameIndex=t.frameIndex},t}(),M_=Pt({Default:w_.Default,Normal:w_.Normal,Clamp:w_.Clamp,Loop:w_.Loop,PingPong:w_.PingPong}),B_=function(){this.time=0,this.value=0,this.inTangent=0,this.outTangent=0};Ae.fastDefine("cc.Keyframe",B_,{time:0,value:0,inTangent:0,outTangent:0});var P_=function(){function t(){this.index=void 0,this.time=void 0,this.endTime=void 0,this.coefficient=void 0,this.index=-1,this.time=0,this.endTime=0,this.coefficient=new Float32Array(4)}return t.prototype.evaluate=function(t){return e=t-this.time,i=this.coefficient,e*(e*(e*i[0]+i[1])+i[2])+i[3];var e,i},t}(),N_=function(){function t(e){void 0===e&&(e=null),this.keyFrames=void 0,this.preWrapMode=M_.Loop,this.postWrapMode=M_.Clamp,this.cachedKey=void 0,this.keyFrames=e||[].concat(t.defaultKF),this.cachedKey=new P_}var e=t.prototype;return e.addKey=function(t){null==this.keyFrames&&(this.keyFrames=[]),this.keyFrames.push(t)},e.evaluate_slow=function(t){var e=t,i=t<0?this.preWrapMode:this.postWrapMode,r=this.keyFrames[0].time,n=this.keyFrames[this.keyFrames.length-1].time;switch(i){case M_.Loop:e=Hr(t-r,n-r)+r;break;case M_.PingPong:e=Vr(t-r,n-r)+r;break;case M_.Default:case M_.Normal:case M_.Clamp:e=Ir(t,r,n)}var s=0;if(e>this.keyFrames[0].time)if(e>=this.keyFrames[this.keyFrames.length-1].time)s=this.keyFrames.length-2;else for(var a=0;a<this.keyFrames.length-1;a++)if(e>=this.keyFrames[0].time&&e<=this.keyFrames[a+1].time){s=a;break}var o=this.keyFrames[s],h=this.keyFrames[s+1],l=Wr(o.time,h.time,e),u=h.time-o.time,c=o.outTangent*u,_=h.inTangent*u,d=l*l,p=d*l,f=p-2*d+l,m=p-d,g=-2*p+3*d;return(2*p-3*d+1)*o.value+f*c+m*_+g*h.value},e.evaluate=function(t){var e=t,i=t<0?this.preWrapMode:this.postWrapMode,r=this.keyFrames[0].time,n=this.keyFrames[this.keyFrames.length-1].time;switch(i){case M_.Loop:e=Hr(t-r,n-r)+r;break;case M_.PingPong:e=Vr(t-r,n-r)+r;break;case M_.Default:case M_.Normal:case M_.Clamp:e=Ir(t,r,n)}if(e>=this.cachedKey.time&&e<this.cachedKey.endTime)return this.cachedKey.evaluate(e);var s=this.findIndex(this.cachedKey,e),a=Math.min(s+1,this.keyFrames.length-1);return this.calcOptimizedKey(this.cachedKey,s,a),this.cachedKey.evaluate(e)},e.calcOptimizedKey=function(t,e,i){var r=this.keyFrames[e],n=this.keyFrames[i];t.index=e,t.time=r.time,t.endTime=n.time;var s=n.time-r.time,a=n.value-r.value,o=1/(s*s),h=r.outTangent*s,l=n.inTangent*s;t.coefficient[0]=(h+l-a-a)*o/s,t.coefficient[1]=(a+a+a-h-h-l)*o,t.coefficient[2]=r.outTangent,t.coefficient[3]=r.value},e.findIndex=function(t,e){var i=t.index;if(-1!==i)if(e>this.keyFrames[i].time)for(var r=0;r<3;r++){var n=i+r;if(n+1<this.keyFrames.length&&this.keyFrames[n+1].time>e)return n}else for(var s=0;s<3;s++){var a=i-s;if(a>=0&&this.keyFrames[a-1].time<=e)return a-1}for(var o=0,h=this.keyFrames.length,l=Math.floor((o+h)/2);h-o>1;)this.keyFrames[l].time>=e?h=l:o=l+1,l=Math.floor((o+h)/2);return o},t}();function L_(t,e){console.warn(t+" is deprecated, please use "+e+" instead.")}N_.defaultKF=[{time:0,value:1,inTangent:0,outTangent:0},{time:1,value:1,inTangent:0,outTangent:0}],Ae.fastDefine("cc.AnimationCurve",N_,{preWrapMode:M_.Default,postWrapMode:M_.Default,keyFrames:[]}),$s(o_.prototype,"line",[{name:"mag",newName:"len"},{name:"magnitude",newName:"len"}]),ta(a_,"intersect",[{name:"line_quad"}]),$s(a_,"intersect",[{name:"ray_aabb",newName:"rayAABB"},{name:"ray_plane",newName:"rayPlane"},{name:"ray_triangle",newName:"rayTriangle"},{name:"ray_sphere",newName:"raySphere"},{name:"ray_obb",newName:"rayOBB"},{name:"ray_capsule",newName:"rayCapsule"},{name:"ray_subMesh",newName:"raySubMesh"},{name:"ray_mesh",newName:"rayMesh"},{name:"ray_model",newName:"rayModel"},{name:"line_plane",newName:"linePlane"},{name:"line_triangle",newName:"lineTriangle"},{name:"line_aabb",newName:"lineAABB"},{name:"line_obb",newName:"lineOBB"},{name:"line_sphere",newName:"lineSphere"},{name:"aabb_aabb",newName:"aabbWithAABB"},{name:"aabb_obb",newName:"aabbWithOBB"},{name:"aabb_plane",newName:"aabbPlane"},{name:"aabb_frustum",newName:"aabbFrustum"},{name:"aabbFrustum_accurate",newName:"aabbFrustumAccurate"},{name:"obb_point",newName:"obbPoint"},{name:"obb_plane",newName:"obbPlane"},{name:"obb_frustum",newName:"obbFrustum"},{name:"obbFrustum_accurate",newName:"obbFrustumAccurate"},{name:"obb_obb",newName:"obbWithOBB"},{name:"obb_capsule",newName:"obbCapsule"},{name:"sphere_plane",newName:"spherePlane"},{name:"sphere_frustum",newName:"sphereFrustum"},{name:"sphereFrustum_accurate",newName:"sphereFrustumAccurate"},{name:"sphere_sphere",newName:"sphereWithSphere"},{name:"sphere_aabb",newName:"sphereAABB"},{name:"sphere_obb",newName:"sphereOBB"},{name:"sphere_capsule",newName:"sphereCapsule"},{name:"capsule_capsule",newName:"capsuleWithCapsule"}]);var F_=function(t){function e(){var e;return e=t.call(this)||this,L_("line","Line"),e}return s(e,t),e}(o_),D_=function(t){function e(){var e;return e=t.call(this)||this,L_("plane","Plane"),e}return s(e,t),e}(__),U_=function(t){function e(){var e;return e=t.call(this)||this,L_("ray","Ray"),e}return s(e,t),e}(uo),k_=function(t){function e(){var e;return e=t.call(this)||this,L_("triangle","Triangle"),e}return s(e,t),e}(Jh),z_=function(t){function e(){var e;return e=t.call(this)||this,L_("sphere","Sphere"),e}return s(e,t),e}(Qh),G_=function(t){function e(){var e;return e=t.call(this)||this,L_("aabb","AABB"),e}return s(e,t),e}(y_),H_=function(t){function e(){var e;return e=t.call(this)||this,L_("obb","OBB"),e}return s(e,t),e}(b_),V_=function(t){function e(){var e;return e=t.call(this)||this,L_("capsule","Capsule"),e}return s(e,t),e}(A_),W_=function(t){function e(){var e;return e=t.call(this)||this,L_("frustum","Frustum"),e}return s(e,t),e}(x_),j_=Object.freeze({__proto__:null,distance:lo,enums:xa,intersect:a_,Line:o_,Plane:__,Ray:uo,Triangle:Jh,Sphere:Qh,AABB:y_,OBB:b_,Capsule:A_,Frustum:x_,Keyframe:B_,AnimationCurve:N_,get ERaycastMode(){return nc},line:F_,plane:D_,ray:U_,triangle:k_,sphere:z_,aabb:G_,obb:H_,capsule:V_,frustum:W_});t("geometry",j_);var X_=t("BASELINE_RATIO",.26),Y_=t("MIDDLE_RATIO",(X_+1)/2-X_);var q_=new Ot(2);q_.get=function(){return this._get()||{key:"",value:0,prev:null,next:null}};var K_=new(function(){function t(t){this.count=0,this.limit=0,this.datas={},this.limit=t}var e=t.prototype;return e.moveToHead=function(t){t.next=this.head,t.prev=null,this.head&&(this.head.prev=t),this.head=t,this.tail||(this.tail=t),this.count++,this.datas[t.key]=t},e.put=function(t,e){var i=q_.get();if(i.key=t,i.value=e,this.count>=this.limit){var r=this.tail;delete this.datas[r.key],this.count--,this.tail=r.prev,this.tail.next=null,r.prev=null,r.next=null,q_.put(r)}this.moveToHead(i)},e.remove=function(t){t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev,delete this.datas[t.key],this.count--},e.get=function(t){var e=this.datas[t];return e?(this.remove(e),this.moveToHead(e),e.value):null},e.clear=function(){this.count=0,this.datas={},this.head=null,this.tail=null},e.has=function(t){return!!this.datas[t]},e.delete=function(t){var e=this.datas[t];this.remove(e)},t}())(100),Z_=/([a-zA-Z0-9--]+|\S)/,Q_=/^[!,.:;'}\]%\?>]/,J_=/([a-zA-Z0-9--]+|\S)$/,$_=/[a-zA-Z0-9--]+$/,td=/^[a-zA-Z0-9--]/;function ed(t){return/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/.test(t)||/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g.test(t)||/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/.test(t)}function id(t){var e=t.charCodeAt(0);return e>=9&&e<=13||32===e||133===e||160===e||5760===e||e>=8192&&e<=8202||8232===e||8233===e||8239===e||8287===e||12288===e}function rd(t,e,i){var r=(i||t.font)+""+e,n=K_.get(r);if(null!==n)return n;var s=t.measureText(e),a=s&&s.width||0;return K_.put(r,a),a}function nd(t,e,i){var r=e,n=i,s=t[e];if(s>="\udc00"&&s<="\udfff"&&r--,void 0!==i)if(i-1!==e){var a=t[i-1];a>="\ud800"&&a<="\udbff"&&n--}else s>="\ud800"&&s<="\udbff"&&n++;return t.substring(r,n)}function sd(t,e,i,r){var n=[];if(0===t.length||i<0)return n.push(""),n;for(var s=t;e>i&&s.length>1;){for(var a=s.length*(i/e)|0,o=nd(s,a),h=e-r(o),l=o,u=0,c=0;h>i&&c++<10;)a*=i/h,h=e-r(o=nd(s,a|=0));for(c=0;h<=i&&c++<10;){if(o){var _=Z_.exec(o);u=_?_[0].length:1,l=o}h=e-r(o=nd(s,a+=u))}0==(a-=u)?(a=1,l=nd(s,1)):1===a&&s[0]>="\ud800"&&s[0]<="\udbff"&&(a=2,l=nd(s,2));var d=nd(s,0,a),p=void 0;Q_.test(l||o)&&(0==(a-=(p=J_.exec(d))?p[0].length:0)&&(a=1),l=nd(s,a),d=nd(s,0,a)),td.test(l)&&(p=$_.exec(d))&&d!==p[0]&&(l=nd(s,a-=p[0].length),d=nd(s,0,a)),(0===n.length||(d=d.trim()).length>0)&&n.push(d),e=r(s=l||o)}return(0===n.length||(s=s.trim()).length>0)&&n.push(s),n}var ad,od,hd,ld,ud,cd,_d,dd,pd,fd,md=/^(click)(\s)*=|(param)(\s)*=/,gd=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*align(\s)*=|(\s)*offset(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/,vd=t("HtmlTextParser",function(){function t(){this._specialSymbolArray=[],this._stack=[],this._resultObjectArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"])}var e=t.prototype;return e.parse=function(t){this._resultObjectArray.length=0,this._stack.length=0;for(var e=0,i=t.length;e<i;){var r=t.indexOf(">",e),n=-1;if(r>=0&&(n=t.lastIndexOf("<",r))<e-1&&(n=t.indexOf("<",r+1),r=t.indexOf(">",n+1)),n<0)this._stack.pop(),this._processResult(t.substring(e)),e=i;else{var s=t.substring(e,n),a=t.substring(n+1,r);""===a&&(s=t.substring(e,r+1)),this._processResult(s),-1===r?r=n:"/"===t.charAt(n+1)?this._stack.pop():this._addToStack(a),e=r+1}}return this._resultObjectArray},e._attributeToObject=function(t){var e={},i=(t=t.trim()).match(/^(color|size)(\s)*=/),r="",n=0,s="";if(i){if(r=i[0],""===(t=t.substring(r.length).trim()))return e;switch(n=t.indexOf(" "),r[0]){case"c":e.color=n>-1?t.substring(0,n).trim():t;break;case"s":e.size=parseInt(t)}return n>-1&&(s=t.substring(n+1).trim(),e.event=this._processEventHandler(s)),e}if((i=t.match(/^(br(\s)*\/)/))&&i[0].length>0&&(r=i[0].trim()).startsWith("br")&&"/"===r[r.length-1])return e.isNewLine=!0,this._resultObjectArray.push({text:"",style:{isNewLine:!0}}),e;var a="";if((i=t.match(/^(img(\s)*src(\s)*=[^>]+\/)/))&&i[0].length>0&&(r=i[0].trim()).startsWith("img")&&"/"===r[r.length-1]){var o;i=t.match(gd);for(var h=!1;i;){if(r=(t=t.substring(t.indexOf(i[0]))).substr(0,i[0].length),o=(n=(a=t.substring(r.length).trim()).indexOf(" "))>-1?a.substr(0,n):a,r=(r=r.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),t=a.substring(n).trim(),o.endsWith("/")&&(o=o.slice(0,-1)),"src"===r){switch(o.charCodeAt(0)){case 34:case 39:h=!0,o=o.slice(1,-1)}e.isImage=!0,e.src=o}else if("height"===r)e.imageHeight=parseInt(o);else if("width"===r)e.imageWidth=parseInt(o);else if("align"===r){switch(o.charCodeAt(0)){case 34:case 39:o=o.slice(1,-1)}e.imageAlign=o.toLowerCase()}else"offset"===r?e.imageOffset=o:"click"===r&&(e.event=this._processEventHandler(r+"="+o));e.event&&"param"===r&&(e.event[r]=o.replace(/^\"|\"$/g,"")),i=t.match(gd)}return h&&e.isImage&&this._resultObjectArray.push({text:"",style:e}),{}}if(i=t.match(/^(outline(\s)*[^>]*)/)){var l={color:"#ffffff",width:1};if(t=i[0].substring("outline".length).trim()){var u,c=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(i=t.match(c);i;)r=(t=t.substring(t.indexOf(i[0]))).substr(0,i[0].length),u=(n=(a=t.substring(r.length).trim()).indexOf(" "))>-1?a.substr(0,n):a,r=(r=r.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),t=a.substring(n).trim(),"click"===r?e.event=this._processEventHandler(r+"="+u):"color"===r?l.color=u:"width"===r&&(l.width=parseInt(u)),e.event&&"param"===r&&(e.event[r]=u.replace(/^\"|\"$/g,"")),i=t.match(c)}e.outline=l}if((i=t.match(/^(on|u|b|i)(\s)*/))&&i[0].length>0){switch(r=i[0],t=t.substring(r.length).trim(),r[0]){case"u":e.underline=!0;break;case"i":e.italic=!0;break;case"b":e.bold=!0}if(""===t)return e;e.event=this._processEventHandler(t)}return e},e._processEventHandler=function(t){for(var e=new Map,i=0,r=!1,n=t.match(md);n;){var s=n[0],a="";if(r=!1,'"'===(t=t.substring(s.length).trim()).charAt(0))(i=t.indexOf('"',1))>-1&&(a=t.substring(1,i).trim(),r=!0),i++;else if("'"===t.charAt(0))(i=t.indexOf("'",1))>-1&&(a=t.substring(1,i).trim(),r=!0),i++;else{var o=t.match(/(\S)+/);i=(a=o?o[0]:"").length}r&&(e[s=s.substring(0,s.length-1).trim()]=a),n=(t=t.substring(i).trim()).match(md)}return e},e._addToStack=function(t){var e=this._attributeToObject(t);if(0===this._stack.length)this._stack.push(e);else{if(e.isNewLine||e.isImage)return;var i=this._stack[this._stack.length-1];for(var r in i)e[r]||(e[r]=i[r]);this._stack.push(e)}},e._processResult=function(t){0!==t.length&&(t=this._escapeSpecialSymbol(t),this._stack.length>0?this._resultObjectArray.push({text:t,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:t}))},e._escapeSpecialSymbol=function(t){for(var e,i=h(this._specialSymbolArray);!(e=i()).done;){var r=e.value,n=r[0],s=r[1];t=t.replace(n,s)}return t},t}()),yd=t("PrefabInfo",Ne("cc.PrefabInfo")((hd=u((od=function(){l(this,"root",hd,this),l(this,"asset",ld,this),l(this,"fileId",ud,this),l(this,"sync",cd,this),l(this,"_synced",_d,this)}).prototype,"root",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ld=u(od.prototype,"asset",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ud=u(od.prototype,"fileId",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),cd=u(od.prototype,"sync",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_d=u(od.prototype,"_synced",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{default:!1,serializable:!1}}}),ad=od))||ad);_._PrefabInfo=yd,t("CompPrefabInfo",Ne("cc.CompPrefabInfo ")((fd=u((pd=function(){l(this,"fileId",fd,this)}).prototype,"fileId",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),dd=pd))||dd);var Td,Ed=function(){function t(){this._arrayBufferOrPaddings=[],this._length=0}var e=t.prototype;return e.setNextAlignment=function(t){if(0!==t){var e=this._length%t;if(0!==e){var i=t-e;this._arrayBufferOrPaddings.push(i),this._length+=i}}},e.addBuffer=function(t){var e=this._length;return this._arrayBufferOrPaddings.push(t),this._length+=t.byteLength,e},e.getLength=function(){return this._length},e.getCombined=function(){var t=new Uint8Array(this._length),e=0;return this._arrayBufferOrPaddings.forEach((function(i){"number"==typeof i?e+=i:(t.set(new Uint8Array(i),e),e+=i.byteLength)})),t.buffer},t}(),Sd=((Td={})[Pl.UNORM]="Uint",Td[Pl.SNORM]="Int",Td[Pl.UINT]="Uint",Td[Pl.INT]="Int",Td[Pl.UFLOAT]="Float",Td[Pl.FLOAT]="Float",Td.default="Uint",Td);function bd(t){return(Sd[t.type]||Sd.default)+t.size/t.count*8}function Ad(t,e,i,r,n){void 0===i&&(i=il.R32F),void 0===r&&(r=0),void 0===n&&(n=0);var s=zl[i];n||(n=s.size);for(var a="set"+bd(s),o=s.size/s.count,h=Math.floor(e.length/s.count),l=Jr.isLittleEndian,u=0;u<h;++u)for(var c=r+n*u,_=0;_<s.count;++_){var d=c+o*_;t[a](d,e[s.count*u+_],l)}}function Cd(t,e,i,r,n,s){void 0===e&&(e=il.R32F),void 0===i&&(i=0),void 0===r&&(r=t.byteLength-i),void 0===n&&(n=0),void 0===s&&(s=[]);var a=zl[e];n||(n=a.size);for(var o="get"+bd(a),h=a.size/a.count,l=Math.floor(r/n),u=Jr.isLittleEndian,c=0;c<l;++c)for(var _=i+n*c,d=0;d<a.count;++d){var p=_+h*d;s[a.count*c+d]=t[o](p,u)}return s}function wd(t,e,i,r,n,s,a){void 0===i&&(i=il.R32F),void 0===r&&(r=0),void 0===n&&(n=t.byteLength-r),void 0===s&&(s=0),a||(a=new DataView(t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)));var o=zl[i];s||(s=o.size);for(var h="set"+bd(o),l="get"+bd(o),u=o.size/o.count,c=Math.floor(n/s),_=Jr.isLittleEndian,d=0;d<c;++d)for(var p=r+s*d,f=0;f<o.count;++f){var m=p+u*f,g=t[l](m,_);a[h](m,e(g,f,t),_)}return a}var Rd,xd,Od,Id,Md,Bd,Pd,Nd=1024;function Ld(t){return _.sys.capabilities.imageBitmap&&t instanceof ImageBitmap}!function(t){t[t.RGB565=il.R5G6B5]="RGB565",t[t.RGB5A1=il.RGB5A1]="RGB5A1",t[t.RGBA4444=il.RGBA4]="RGBA4444",t[t.RGB888=il.RGB8]="RGB888",t[t.RGB32F=il.RGB32F]="RGB32F",t[t.RGBA8888=il.RGBA8]="RGBA8888",t[t.RGBA32F=il.RGBA32F]="RGBA32F",t[t.A8=il.A8]="A8",t[t.I8=il.L8]="I8",t[t.AI8=il.LA8]="AI8",t[t.RGB_PVRTC_2BPPV1=il.PVRTC_RGB2]="RGB_PVRTC_2BPPV1",t[t.RGBA_PVRTC_2BPPV1=il.PVRTC_RGBA2]="RGBA_PVRTC_2BPPV1",t[t.RGB_A_PVRTC_2BPPV1=Nd++]="RGB_A_PVRTC_2BPPV1",t[t.RGB_PVRTC_4BPPV1=il.PVRTC_RGB4]="RGB_PVRTC_4BPPV1",t[t.RGBA_PVRTC_4BPPV1=il.PVRTC_RGBA4]="RGBA_PVRTC_4BPPV1",t[t.RGB_A_PVRTC_4BPPV1=Nd++]="RGB_A_PVRTC_4BPPV1",t[t.RGB_ETC1=il.ETC_RGB8]="RGB_ETC1",t[t.RGBA_ETC1=Nd++]="RGBA_ETC1",t[t.RGB_ETC2=il.ETC2_RGB8]="RGB_ETC2",t[t.RGBA_ETC2=il.ETC2_RGBA8]="RGBA_ETC2",t[t.RGBA_ASTC_4x4=il.ASTC_RGBA_4x4]="RGBA_ASTC_4x4",t[t.RGBA_ASTC_5x4=il.ASTC_RGBA_5x4]="RGBA_ASTC_5x4",t[t.RGBA_ASTC_5x5=il.ASTC_RGBA_5x5]="RGBA_ASTC_5x5",t[t.RGBA_ASTC_6x5=il.ASTC_RGBA_6x5]="RGBA_ASTC_6x5",t[t.RGBA_ASTC_6x6=il.ASTC_RGBA_6x6]="RGBA_ASTC_6x6",t[t.RGBA_ASTC_8x5=il.ASTC_RGBA_8x5]="RGBA_ASTC_8x5",t[t.RGBA_ASTC_8x6=il.ASTC_RGBA_8x6]="RGBA_ASTC_8x6",t[t.RGBA_ASTC_8x8=il.ASTC_RGBA_8x8]="RGBA_ASTC_8x8",t[t.RGBA_ASTC_10x5=il.ASTC_RGBA_10x5]="RGBA_ASTC_10x5",t[t.RGBA_ASTC_10x6=il.ASTC_RGBA_10x6]="RGBA_ASTC_10x6",t[t.RGBA_ASTC_10x8=il.ASTC_RGBA_10x8]="RGBA_ASTC_10x8",t[t.RGBA_ASTC_10x10=il.ASTC_RGBA_10x10]="RGBA_ASTC_10x10",t[t.RGBA_ASTC_12x10=il.ASTC_RGBA_12x10]="RGBA_ASTC_12x10",t[t.RGBA_ASTC_12x12=il.ASTC_RGBA_12x12]="RGBA_ASTC_12x12"}(Rd||(Rd={})),function(t){t[t.REPEAT=gl.WRAP]="REPEAT",t[t.CLAMP_TO_EDGE=gl.CLAMP]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=gl.MIRROR]="MIRRORED_REPEAT",t[t.CLAMP_TO_BORDER=gl.BORDER]="CLAMP_TO_BORDER"}(xd||(xd={})),function(t){t[t.NONE=ml.NONE]="NONE",t[t.LINEAR=ml.LINEAR]="LINEAR",t[t.NEAREST=ml.POINT]="NEAREST"}(Od||(Od={}));var Fd,Dd=t("ImageAsset",Ne("cc.ImageAsset")((Pd=Bd=function(t){function e(e){var i;return(i=t.call(this)||this)._nativeData=void 0,i._tex=void 0,i._exportedExts=void 0,i._format=Rd.RGBA8888,i._width=0,i._height=0,i.loaded=!1,i._nativeData={_data:null,width:0,height:0,format:0,_compressed:!1},void 0!==e&&i.reset(e),i}s(e,t),r(e,[{key:"_nativeAsset",get:function(){return this._nativeData},set:function(t){t instanceof HTMLElement||Ld(t)||(t.format=t.format||this._format),this.reset(t)}},{key:"data",get:function(){return this._nativeData&&((t=this._nativeData)instanceof HTMLImageElement||t instanceof HTMLCanvasElement||Ld(t))?this._nativeData:this._nativeData&&this._nativeData._data;var t}},{key:"width",get:function(){return this._nativeData.width||this._width}},{key:"height",get:function(){return this._nativeData.height||this._height}},{key:"format",get:function(){return this._format}},{key:"isCompressed",get:function(){return this._format>=Rd.RGB_ETC1&&this._format<=Rd.RGBA_ASTC_12x12||this._format>=Rd.RGB_A_PVRTC_2BPPV1&&this._format<=Rd.RGBA_ETC1}},{key:"url",get:function(){return this.nativeUrl}},{key:"_texture",set:function(t){this._tex=t},get:function(){if(!this._tex){var t=new _.Texture2D;t.name=this.nativeUrl,t.image=this,this._tex=t}return this._tex}}]);var i=e.prototype;return i.reset=function(t){var e=this;Ld(t)?(this._nativeData=t,this._onDataComplete()):t instanceof HTMLElement?(this._nativeData=t,t.complete||t instanceof HTMLCanvasElement?this._onDataComplete():(this.loaded=!1,t.addEventListener("load",(function(){e._onDataComplete()})),t.addEventListener("error",(function(t){I(3119,t.message)})))):(this._nativeData=t,this._format=t.format,this._onDataComplete())},i.destroy=function(){return this.data&&this.data instanceof HTMLImageElement?(this.data.src="",this._setRawAsset("")):Ld(this.data)&&this.data.close&&this.data.close(),t.prototype.destroy.call(this)},i._serialize=function(){},i._deserialize=function(t){var i="";"string"==typeof t?i=t:(this._width=t.w,this._height=t.h,i=t.fmt);for(var r,n=_.director.root?_.director.root.device:null,s=i.split("_"),a="",o=Number.MAX_VALUE,l=this._format,u="",c=_.macro.SUPPORT_TEXTURE_FORMATS,d=h(s);!(r=d()).done;){var p=r.value.split("@"),f=parseInt(p[0],void 0),m=e.extnames[f]||p[0],g=c.indexOf(m);if(-1!==g&&g<o){var v=p[1]?parseInt(p[1]):this._format;if(!(".astc"!==m||n&&n.hasFeature(Fl.FORMAT_ASTC)))continue;if(!(".pvr"!==m||n&&n.hasFeature(Fl.FORMAT_PVRTC)))continue;if(!(v!==Rd.RGB_ETC1&&v!==Rd.RGBA_ETC1||n&&n.hasFeature(Fl.FORMAT_ETC1)))continue;if(!(v!==Rd.RGB_ETC2&&v!==Rd.RGBA_ETC2||n&&n.hasFeature(Fl.FORMAT_ETC2)))continue;if(".webp"===m&&!_.sys.capabilities.webp)continue;o=g,u=m,l=v}else a||(a=m)}u?(this._setRawAsset(u),this._format=l):a?(this._setRawAsset(a),I(3120,a,a)):I(3121)},i._onDataComplete=function(){this.loaded=!0,this.emit("load")},e}(Sr),Bd.extnames=[".png",".jpg",".jpeg",".bmp",".webp",".pvr",".pkm",".astc"],u((Md=Pd).prototype,"_nativeAsset",[fi],Object.getOwnPropertyDescriptor(Md.prototype,"_nativeAsset"),Md.prototype),Id=Md))||Id);_.ImageAsset=Dd,function(t){t[t.minFilter=0]="minFilter",t[t.magFilter=1]="magFilter",t[t.mipFilter=2]="mipFilter",t[t.addressU=3]="addressU",t[t.addressV=4]="addressV",t[t.addressW=5]="addressW",t[t.maxAnisotropy=6]="maxAnisotropy",t[t.cmpFunc=7]="cmpFunc",t[t.minLOD=8]="minLOD",t[t.maxLOD=9]="maxLOD",t[t.mipLODBias=10]="mipLODBias",t[t.total=11]="total"}(Fd||(Fd={}));var Ud=[ml.LINEAR,ml.LINEAR,ml.NONE,gl.WRAP,gl.WRAP,gl.WRAP,8,cl.NEVER,0,0,0],kd=Hd(Ud),zd=new du,Gd=new Pu;function Hd(t){for(var e=0,i=0,r=0;r<Ud.length;r++)switch(e=t[r]||Ud[r],r){case Fd.minFilter:i|=e;break;case Fd.magFilter:i|=e<<2;break;case Fd.mipFilter:i|=e<<4;break;case Fd.addressU:i|=e<<6;break;case Fd.addressV:i|=e<<8;break;case Fd.addressW:i|=e<<10;break;case Fd.maxAnisotropy:i|=e<<12;break;case Fd.cmpFunc:i|=e<<16;break;case Fd.minLOD:i|=e<<20;break;case Fd.maxLOD:i|=e<<24;break;case Fd.mipLODBias:i|=e<<28}return i}var Vd,Wd,jd,Xd,Yd,qd,Kd,Zd,Qd,Jd,$d,tp,ep=new(function(){function t(){this._cache={}}return t.prototype.getSampler=function(t,e){return e||(e=kd),this._cache[e]||(Gd.minFilter=3&e,Gd.magFilter=e>>2&3,Gd.mipFilter=e>>4&3,Gd.addressU=e>>6&3,Gd.addressV=e>>8&3,Gd.addressW=e>>10&3,Gd.maxAnisotropy=e>>12&15,Gd.cmpFunc=e>>16&15,Gd.minLOD=e>>20&15,Gd.maxLOD=e>>24&15,Gd.mipLODBias=e>>28&15,Gd.borderColor=zd,this._cache[e]=t.createSampler(Gd))},t}());_.samplerLib=ep;var ip,rp=new j("Tex"),np=Ne("cc.TextureBase")((tp=$d=function(t){function e(){var e;return l(e=t.call(this)||this,"_format",jd,a(e)),l(e,"_minFilter",Xd,a(e)),l(e,"_magFilter",Yd,a(e)),l(e,"_mipFilter",qd,a(e)),l(e,"_wrapS",Kd,a(e)),l(e,"_wrapT",Zd,a(e)),l(e,"_wrapR",Qd,a(e)),l(e,"_anisotropy",Jd,a(e)),e._width=1,e._height=1,e._id=void 0,e._samplerInfo=[],e._samplerHash=0,e._gfxSampler=null,e._gfxDevice=null,e._textureHash=0,e._id=rp.getNewId(),e.loaded=!1,e._gfxDevice=e._getGFXDevice(),e._textureHash=ou(e._id,666),e}s(e,t),r(e,[{key:"isCompressed",get:function(){return this._format>=Rd.RGB_ETC1&&this._format<=Rd.RGBA_PVRTC_4BPPV1}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]);var i=e.prototype;return i.getId=function(){return this._id},i.getPixelFormat=function(){return this._format},i.getAnisotropy=function(){return this._anisotropy},i.setWrapMode=function(t,e,i){this._wrapS=t,this._samplerInfo[Fd.addressU]=t,this._wrapT=e,this._samplerInfo[Fd.addressV]=e,void 0!==i&&(this._wrapR=i,this._samplerInfo[Fd.addressW]=i),this._samplerHash=Hd(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=ep.getSampler(this._gfxDevice,this._samplerHash))},i.setFilters=function(t,e){this._minFilter=t,this._samplerInfo[Fd.minFilter]=t,this._magFilter=e,this._samplerInfo[Fd.magFilter]=e,this._samplerHash=Hd(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=ep.getSampler(this._gfxDevice,this._samplerHash))},i.setMipFilter=function(t){this._mipFilter=t,this._samplerInfo[Fd.mipFilter]=t,this._samplerInfo[Fd.maxLOD]=t===Od.NONE?0:15,this._samplerHash=Hd(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=ep.getSampler(this._gfxDevice,this._samplerHash))},i.setAnisotropy=function(t){this._anisotropy=t,this._samplerInfo[Fd.maxAnisotropy]=t,this._samplerHash=Hd(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=ep.getSampler(this._gfxDevice,this._samplerHash))},i.destroy=function(){var e=t.prototype.destroy.call(this);return e&&_.director.root&&_.director.root.ui&&_.director.root.ui._releaseDescriptorSetCache(this._textureHash),e},i.getHash=function(){return this._textureHash},i.getGFXTexture=function(){return null},i.getSamplerHash=function(){return this._samplerHash},i.getGFXSampler=function(){return this._gfxSampler||(this._gfxDevice?this._gfxSampler=ep.getSampler(this._gfxDevice,this._samplerHash):B(9302)),this._gfxSampler},i._serialize=function(){},i._deserialize=function(t){var e=t.split(",");e.unshift(""),e.length>=5&&(this.setFilters(parseInt(e[1]),parseInt(e[2])),this.setWrapMode(parseInt(e[3]),parseInt(e[4]))),e.length>=7&&(this.setMipFilter(parseInt(e[5])),this.setAnisotropy(parseInt(e[6])))},i._getGFXDevice=function(){return _.director.root&&_.director.root.device},i._getGFXFormat=function(){return this._getGFXPixelFormat(this._format)},i._setGFXFormat=function(t){this._format=void 0===t?Rd.RGBA8888:t},i._getGFXPixelFormat=function(t){return t===Rd.RGBA_ETC1?t=Rd.RGB_ETC1:t===Rd.RGB_A_PVRTC_4BPPV1?t=Rd.RGB_PVRTC_4BPPV1:t===Rd.RGB_A_PVRTC_2BPPV1&&(t=Rd.RGB_PVRTC_2BPPV1),t},e}(Sr),$d.PixelFormat=Rd,$d.WrapMode=xd,$d.Filter=Od,jd=u((Wd=tp).prototype,"_format",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Rd.RGBA8888}}),Xd=u(Wd.prototype,"_minFilter",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Od.LINEAR}}),Yd=u(Wd.prototype,"_magFilter",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Od.LINEAR}}),qd=u(Wd.prototype,"_mipFilter",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Od.NONE}}),Kd=u(Wd.prototype,"_wrapS",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xd.REPEAT}}),Zd=u(Wd.prototype,"_wrapT",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xd.REPEAT}}),Qd=u(Wd.prototype,"_wrapR",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xd.REPEAT}}),Jd=u(Wd.prototype,"_anisotropy",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 8}}),Vd=Wd))||Vd;_.TextureBase=np;var sp=[new vu];function ap(t){return t&&0==(t&t-1)}var op,hp,lp,up,cp,_p,dp=Ne("cc.SimpleTexture")(ip=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gfxTexture=null,e._mipmapLevel=1,e._textureWidth=0,e._textureHeight=0,e}s(e,t);var i=e.prototype;return i.getGFXTexture=function(){return this._gfxTexture},i.destroy=function(){return this._tryDestroyTexture(),t.prototype.destroy.call(this)},i.updateImage=function(){this.updateMipmaps(0)},i.updateMipmaps=function(){},i.uploadData=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=0),this._gfxTexture&&!(this._mipmapLevel<=e)){var r=this._getGFXDevice();if(r){var n=sp[0];n.texExtent.width=this._textureWidth>>e,n.texExtent.height=this._textureHeight>>e,n.texSubres.mipLevel=e,n.texSubres.baseArrayLayer=i,ArrayBuffer.isView(t)?r.copyBuffersToTexture([t],this._gfxTexture,sp):r.copyTexImagesToTexture([t],this._gfxTexture,sp)}}},i._assignImage=function(t,e,i){var r=this,n=function(){var n=t.data;n&&(r.uploadData(n,e,i),r._checkTextureLoaded(),Ut.CLEANUP_IMAGE_CACHE&&_.assetManager.releaseAsset(t))};if(t.loaded)n();else{if(t.once("load",(function(){n()})),!this.isCompressed){var s=_.builtinResMgr.get("black-texture").image;this.uploadData(s.data,e,i)}_.assetManager.postLoadNative(t)}},i._checkTextureLoaded=function(){this._textureReady()},i._textureReady=function(){this.loaded=!0,this.emit("load")},i._setMipmapLevel=function(t){this._mipmapLevel=t<1?1:t},i._getGfxTextureCreateInfo=function(){return null},i._tryReset=function(){if(this._tryDestroyTexture(),0!==this._mipmapLevel){var t=this._getGFXDevice();t&&this._createTexture(t)}},i._createTexture=function(t){if(0!==this._width&&0!==this._height){var e=El.NONE;this._mipFilter!==Od.NONE&&function(t,e,i){return!(t.gfxAPI===Nl.WEBGL)||ap(e)&&ap(i)}(t,this._width,this._height)&&(this._mipmapLevel=function(t,e){for(var i=Math.max(t,e),r=0;i;)i>>=1,r++;return r}(this._width,this._height),e=El.GEN_MIPMAP);var i=this._getGfxTextureCreateInfo({usage:yl.SAMPLED|yl.TRANSFER_DST,format:this._getGFXFormat(),levelCount:this._mipmapLevel,flags:e});if(i){var r=t.createTexture(i);this._textureWidth=i.width,this._textureHeight=i.height,this._gfxTexture=r}}},i._tryDestroyTexture=function(){this._gfxTexture&&(this._gfxTexture.destroy(),this._gfxTexture=null)},r(e,[{key:"mipmapLevel",get:function(){return this._mipmapLevel}}]),e}(np))||ip;_.SimpleTexture=dp;var pp=t("Texture2D",(op=Ne("cc.Texture2D"),hp=pi([Dd]),op((_p=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"_mipmaps",cp,a(e)),e}s(e,t);var i=e.prototype;return i.initialize=function(){this.mipmaps=this._mipmaps},i.onLoaded=function(){this.initialize()},i.reset=function(t){this._width=t.width,this._height=t.height,this._setGFXFormat(t.format),this._setMipmapLevel(t.mipmapLevel||1),this._tryReset()},i.create=function(t,e,i,r){void 0===i&&(i=Rd.RGBA8888),void 0===r&&(r=1),this.reset({width:t,height:e,format:i,mipmapLevel:r})},i.toString=function(){return 0!==this._mipmaps.length?this._mipmaps[0].url:""},i.updateMipmaps=function(t,e){if(void 0===t&&(t=0),!(t>=this._mipmaps.length))for(var i=Math.min(void 0===e?this._mipmaps.length:e,this._mipmaps.length-t),r=0;r<i;++r){var n=t+r;this._assignImage(this._mipmaps[n],n)}},i.getHtmlElementObj=function(){return this._mipmaps[0]&&this._mipmaps[0].data instanceof HTMLElement?this._mipmaps[0].data:null},i.destroy=function(){return this._mipmaps=[],t.prototype.destroy.call(this)},i.description=function(){return"<cc.Texture2D | Name = "+(this._mipmaps[0]?this._mipmaps[0].url:"")+" | Dimension = "+this.width+" x "+this.height+">"},i.releaseTexture=function(){this.destroy()},i._serialize=function(){},i._deserialize=function(e,i){var r=e;t.prototype._deserialize.call(this,r.base,i),this._mipmaps=new Array(r.mipmaps.length);for(var n=0;n<r.mipmaps.length;++n)if(this._mipmaps[n]=new Dd,r.mipmaps[n]){var s=r.mipmaps[n];i.result.push(this._mipmaps,""+n,s),this._mipmaps[n]._texture=this}},i._getGfxTextureCreateInfo=function(t){var e=new Gu(vl.TEX2D);return e.width=this._width,e.height=this._height,Object.assign(e,t)},i._checkTextureLoaded=function(){for(var e=!0,i=0;i<this._mipmaps.length;++i)if(!this._mipmaps[i].loaded){e=!1;break}e&&t.prototype._textureReady.call(this)},r(e,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(t){var e=this;if(this._mipmaps=t,this._setMipmapLevel(this._mipmaps.length),this._mipmaps.length>0){var i=this._mipmaps[0];this.reset({width:i.width,height:i.height,format:i.format,mipmapLevel:this._mipmaps.length}),this._mipmaps.forEach((function(t,i){e._assignImage(t,i)}))}else this.reset({width:0,height:0,mipmapLevel:this._mipmaps.length})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(t){this.mipmaps=t?[t]:[]}}]),e}(dp),cp=u((up=_p).prototype,"_mipmaps",[hp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lp=up))||lp));_.Texture2D=pp;var fp,mp,gp={NONE:0,IGNORE_RAYCAST:1<<20,GIZMOS:1<<21,EDITOR:1<<22,UI_3D:1<<23,SCENE_GIZMO:1<<24,UI_2D:1<<25,PROFILER:1<<28,DEFAULT:1<<30,ALL:4294967295},vp=t("Layers",function(){function t(){}return t.makeMaskInclude=function(t){for(var e,i=0,r=h(t);!(e=r()).done;)i|=e.value;return i},t.makeMaskExclude=function(e){return~t.makeMaskInclude(e)},t.addLayer=function(e,i){void 0!==i?i>19||i<0?console.warn("maximum layers reached."):(t.Enum[e]=1<<i,t.Enum[i]=e,t.BitMask[e]=1<<i,t.BitMask[i]=e):console.warn("bitNum can't be undefined")},t.deleteLayer=function(e){e>19||e<0?console.warn("do not change buildin layers."):(delete t.Enum[t.Enum[e]],delete t.Enum[e],delete t.BitMask[t.BitMask[e]],delete t.BitMask[e])},t}());vp.Enum=Pt(gp),vp.BitMask=Bt(n({},gp)),_.Layers=vp,function(t){t[t.DEFAULT=100]="DEFAULT",t[t.UI=200]="UI"}(fp||(fp={})),_.RenderPassStage=fp,function(t){t[t.MIN=0]="MIN",t[t.MAX=255]="MAX",t[t.DEFAULT=128]="DEFAULT"}(mp||(mp={}));var yp,Tp={bindings:[],layouts:{}},Ep={bindings:[],layouts:{}};!function(t){t[t.UBO_GLOBAL=0]="UBO_GLOBAL",t[t.UBO_SHADOW=1]="UBO_SHADOW",t[t.SAMPLER_SHADOWMAP=2]="SAMPLER_SHADOWMAP",t[t.SAMPLER_ENVIRONMENT=3]="SAMPLER_ENVIRONMENT",t[t.SAMPLER_SPOT_LIGHTING_MAP=4]="SAMPLER_SPOT_LIGHTING_MAP",t[t.COUNT=5]="COUNT"}(yp||(yp={}));var Sp,bp=yp.SAMPLER_SHADOWMAP,Ap=yp.COUNT-bp;!function(t){t[t.UBO_LOCAL=0]="UBO_LOCAL",t[t.UBO_FORWARD_LIGHTS=1]="UBO_FORWARD_LIGHTS",t[t.UBO_SKINNING_ANIMATION=2]="UBO_SKINNING_ANIMATION",t[t.UBO_SKINNING_TEXTURE=3]="UBO_SKINNING_TEXTURE",t[t.UBO_MORPH=4]="UBO_MORPH",t[t.SAMPLER_JOINTS=5]="SAMPLER_JOINTS",t[t.SAMPLER_MORPH_POSITION=6]="SAMPLER_MORPH_POSITION",t[t.SAMPLER_MORPH_NORMAL=7]="SAMPLER_MORPH_NORMAL",t[t.SAMPLER_MORPH_TANGENT=8]="SAMPLER_MORPH_TANGENT",t[t.SAMPLER_LIGHTMAP=9]="SAMPLER_LIGHTMAP",t[t.SAMPLER_SPRITE=10]="SAMPLER_SPRITE",t[t.COUNT=11]="COUNT"}(Sp||(Sp={}));var Cp,wp=Sp.SAMPLER_JOINTS,Rp=Sp.COUNT-wp;!function(t){t[t.GLOBAL=0]="GLOBAL",t[t.MATERIAL=1]="MATERIAL",t[t.LOCAL=2]="LOCAL"}(Cp||(Cp={}));var xp=new tu;xp.bufferOffsets=[0,bp+wp,bp],xp.samplerOffsets=[-bp,Ap+Rp,Ap-wp],xp.flexibleSet=1;var Op=function(){};Op.SIZE=4*(Op.COUNT=4+(Op.GLOBAL_FOG_ADD_OFFSET=4+(Op.GLOBAL_FOG_BASE_OFFSET=4+(Op.GLOBAL_FOG_COLOR_OFFSET=4+(Op.AMBIENT_GROUND_OFFSET=4+(Op.AMBIENT_SKY_OFFSET=4+(Op.MAIN_LIT_COLOR_OFFSET=4+(Op.MAIN_LIT_DIR_OFFSET=4+(Op.EXPOSURE_OFFSET=4+(Op.CAMERA_POS_OFFSET=16+(Op.MAT_VIEW_PROJ_INV_OFFSET=16+(Op.MAT_VIEW_PROJ_OFFSET=16+(Op.MAT_PROJ_INV_OFFSET=16+(Op.MAT_PROJ_OFFSET=16+(Op.MAT_VIEW_INV_OFFSET=16+(Op.MAT_VIEW_OFFSET=4+(Op.NATIVE_SIZE_OFFSET=4+(Op.SCREEN_SCALE_OFFSET=4+(Op.SCREEN_SIZE_OFFSET=4+(Op.TIME_OFFSET=0)))))))))))))))))))),Op.NAME="CCGlobal",Op.BINDING=yp.UBO_GLOBAL,Op.DESCRIPTOR=new Zu(Op.BINDING,bl.UNIFORM_BUFFER,1,Sl.ALL),Op.LAYOUT=new Du(Cp.GLOBAL,Op.BINDING,Op.NAME,[new Fu("cc_time",el.FLOAT4,1),new Fu("cc_screenSize",el.FLOAT4,1),new Fu("cc_screenScale",el.FLOAT4,1),new Fu("cc_nativeSize",el.FLOAT4,1),new Fu("cc_matView",el.MAT4,1),new Fu("cc_matViewInv",el.MAT4,1),new Fu("cc_matProj",el.MAT4,1),new Fu("cc_matProjInv",el.MAT4,1),new Fu("cc_matViewProj",el.MAT4,1),new Fu("cc_matViewProjInv",el.MAT4,1),new Fu("cc_cameraPos",el.FLOAT4,1),new Fu("cc_exposure",el.FLOAT4,1),new Fu("cc_mainLitDir",el.FLOAT4,1),new Fu("cc_mainLitColor",el.FLOAT4,1),new Fu("cc_ambientSky",el.FLOAT4,1),new Fu("cc_ambientGround",el.FLOAT4,1),new Fu("cc_fogColor",el.FLOAT4,1),new Fu("cc_fogBase",el.FLOAT4,1),new Fu("cc_fogAdd",el.FLOAT4,1)],1),Tp.layouts[Op.NAME]=Op.LAYOUT,Tp.bindings[Op.BINDING]=Op.DESCRIPTOR;var Ip=function(){};Ip.SIZE=4*(Ip.COUNT=4+(Ip.SHADOW_INFO_OFFSET=4+(Ip.SHADOW_COLOR_OFFSET=16+(Ip.MAT_LIGHT_VIEW_PROJ_OFFSET=16+(Ip.MAT_LIGHT_PLANE_PROJ_OFFSET=0))))),Ip.NAME="CCShadow",Ip.BINDING=yp.UBO_SHADOW,Ip.DESCRIPTOR=new Zu(Ip.BINDING,bl.UNIFORM_BUFFER,1,Sl.ALL),Ip.LAYOUT=new Du(Cp.GLOBAL,Ip.BINDING,Ip.NAME,[new Fu("cc_matLightPlaneProj",el.MAT4,1),new Fu("cc_matLightViewProj",el.MAT4,1),new Fu("cc_shadowColor",el.FLOAT4,1),new Fu("cc_shadowInfo",el.FLOAT4,1)],1),Tp.layouts[Ip.NAME]=Ip.LAYOUT,Tp.bindings[Ip.BINDING]=Ip.DESCRIPTOR;var Mp=yp.SAMPLER_SHADOWMAP,Bp=new Zu(Mp,bl.SAMPLER,1,Sl.FRAGMENT),Pp=new Uu(Cp.GLOBAL,Mp,"cc_shadowMap",el.SAMPLER2D,1);Tp.layouts.cc_shadowMap=Pp,Tp.bindings[Mp]=Bp;var Np=yp.SAMPLER_ENVIRONMENT,Lp=new Zu(Np,bl.SAMPLER,1,Sl.FRAGMENT),Fp=new Uu(Cp.GLOBAL,Np,"cc_environment",el.SAMPLER_CUBE,1);Tp.layouts.cc_environment=Fp,Tp.bindings[Np]=Lp;var Dp=yp.SAMPLER_SPOT_LIGHTING_MAP,Up=new Zu(Dp,bl.SAMPLER,1,Sl.FRAGMENT),kp=new Uu(Cp.GLOBAL,Dp,"cc_spotLightingMap",el.SAMPLER2D,1);Tp.layouts.cc_spotLightingMap=kp,Tp.bindings[Dp]=Up;var zp=function(){};zp.SIZE=4*(zp.COUNT=4+(zp.LIGHTINGMAP_UVPARAM=16+(zp.MAT_WORLD_IT_OFFSET=16+(zp.MAT_WORLD_OFFSET=0)))),zp.NAME="CCLocal",zp.BINDING=Sp.UBO_LOCAL,zp.DESCRIPTOR=new Zu(zp.BINDING,bl.UNIFORM_BUFFER,1,Sl.VERTEX),zp.LAYOUT=new Du(Cp.LOCAL,zp.BINDING,zp.NAME,[new Fu("cc_matWorld",el.MAT4,1),new Fu("cc_matWorldIT",el.MAT4,1),new Fu("cc_lightingMapUVParam",el.FLOAT4,1)],1),Ep.layouts[zp.NAME]=zp.LAYOUT,Ep.bindings[zp.BINDING]=zp.DESCRIPTOR;var Gp=function(){};Gp.BATCHING_COUNT=10,Gp.MAT_WORLDS_OFFSET=0,Gp.SIZE=4*(Gp.COUNT=16*Gp.BATCHING_COUNT),Gp.NAME="CCLocalBatched",Gp.BINDING=Sp.UBO_LOCAL,Gp.DESCRIPTOR=new Zu(Gp.BINDING,bl.UNIFORM_BUFFER,1,Sl.VERTEX),Gp.LAYOUT=new Du(Cp.LOCAL,Gp.BINDING,Gp.NAME,[new Fu("cc_matWorlds",el.MAT4,Gp.BATCHING_COUNT)],1),Ep.layouts[Gp.NAME]=Gp.LAYOUT,Ep.bindings[Gp.BINDING]=Gp.DESCRIPTOR;var Hp=function(){};Hp.LIGHTS_PER_PASS=1,Hp.SIZE=4*(Hp.COUNT=(Hp.LIGHT_DIR_OFFSET=(Hp.LIGHT_SIZE_RANGE_ANGLE_OFFSET=(Hp.LIGHT_COLOR_OFFSET=(Hp.LIGHT_POS_OFFSET=0)+4*Hp.LIGHTS_PER_PASS)+4*Hp.LIGHTS_PER_PASS)+4*Hp.LIGHTS_PER_PASS)+4*Hp.LIGHTS_PER_PASS),Hp.NAME="CCForwardLight",Hp.BINDING=Sp.UBO_FORWARD_LIGHTS,Hp.DESCRIPTOR=new Zu(Hp.BINDING,bl.DYNAMIC_UNIFORM_BUFFER,1,Sl.FRAGMENT),Hp.LAYOUT=new Du(Cp.LOCAL,Hp.BINDING,Hp.NAME,[new Fu("cc_lightPos",el.FLOAT4,Hp.LIGHTS_PER_PASS),new Fu("cc_lightColor",el.FLOAT4,Hp.LIGHTS_PER_PASS),new Fu("cc_lightSizeRangeAngle",el.FLOAT4,Hp.LIGHTS_PER_PASS),new Fu("cc_lightDir",el.FLOAT4,Hp.LIGHTS_PER_PASS)],1),Ep.layouts[Hp.NAME]=Hp.LAYOUT,Ep.bindings[Hp.BINDING]=Hp.DESCRIPTOR;var Vp=function(){};Vp.SIZE=4*(Vp.COUNT=4+(Vp.JOINTS_TEXTURE_INFO_OFFSET=0)),Vp.NAME="CCSkinningTexture",Vp.BINDING=Sp.UBO_SKINNING_TEXTURE,Vp.DESCRIPTOR=new Zu(Vp.BINDING,bl.UNIFORM_BUFFER,1,Sl.VERTEX),Vp.LAYOUT=new Du(Cp.LOCAL,Vp.BINDING,Vp.NAME,[new Fu("cc_jointTextureInfo",el.FLOAT4,1)],1),Ep.layouts[Vp.NAME]=Vp.LAYOUT,Ep.bindings[Vp.BINDING]=Vp.DESCRIPTOR;var Wp=function(){};Wp.SIZE=4*(Wp.COUNT=4+(Wp.JOINTS_ANIM_INFO_OFFSET=0)),Wp.NAME="CCSkinningAnimation",Wp.BINDING=Sp.UBO_SKINNING_ANIMATION,Wp.DESCRIPTOR=new Zu(Wp.BINDING,bl.UNIFORM_BUFFER,1,Sl.VERTEX),Wp.LAYOUT=new Du(Cp.LOCAL,Wp.BINDING,Wp.NAME,[new Fu("cc_jointAnimInfo",el.FLOAT4,1)],1),Ep.layouts[Wp.NAME]=Wp.LAYOUT,Ep.bindings[Wp.BINDING]=Wp.DESCRIPTOR;var jp=function(){};jp.SIZE=4*(jp.COUNT=360+(jp.JOINTS_OFFSET=0)),jp.NAME="CCSkinning",jp.BINDING=Sp.UBO_SKINNING_TEXTURE,jp.DESCRIPTOR=new Zu(jp.BINDING,bl.UNIFORM_BUFFER,1,Sl.VERTEX),jp.LAYOUT=new Du(Cp.LOCAL,jp.BINDING,jp.NAME,[new Fu("cc_joints",el.FLOAT4,90)],1),Ep.layouts[jp.NAME]=jp.LAYOUT,Ep.bindings[jp.BINDING]=jp.DESCRIPTOR;var Xp=function(){};Xp.MAX_MORPH_TARGET_COUNT=60,Xp.OFFSET_OF_WEIGHTS=0,Xp.OFFSET_OF_VERTICES_COUNT=4+(Xp.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT=4+(Xp.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH=4*Xp.MAX_MORPH_TARGET_COUNT)),Xp.COUNT_BASE_4_BYTES=4*Math.ceil(Xp.MAX_MORPH_TARGET_COUNT/4)+4,Xp.SIZE=4*Xp.COUNT_BASE_4_BYTES,Xp.NAME="CCMorph",Xp.BINDING=Sp.UBO_MORPH,Xp.DESCRIPTOR=new Zu(Xp.BINDING,bl.UNIFORM_BUFFER,1,Sl.VERTEX),Xp.LAYOUT=new Du(Cp.LOCAL,Xp.BINDING,Xp.NAME,[new Fu("cc_displacementWeights",el.FLOAT4,Xp.MAX_MORPH_TARGET_COUNT/4),new Fu("cc_displacementTextureInfo",el.FLOAT4,1)],1),Ep.layouts[Xp.NAME]=Xp.LAYOUT,Ep.bindings[Xp.BINDING]=Xp.DESCRIPTOR;var Yp=Sp.SAMPLER_JOINTS,qp=new Zu(Yp,bl.SAMPLER,1,Sl.VERTEX),Kp=new Uu(Cp.LOCAL,Yp,"cc_jointTexture",el.SAMPLER2D,1);Ep.layouts.cc_jointTexture=Kp,Ep.bindings[Yp]=qp;var Zp=Sp.SAMPLER_MORPH_POSITION,Qp=new Zu(Zp,bl.SAMPLER,1,Sl.VERTEX),Jp=new Uu(Cp.LOCAL,Zp,"cc_PositionDisplacements",el.SAMPLER2D,1);Ep.layouts.cc_PositionDisplacements=Jp,Ep.bindings[Zp]=Qp;var $p=Sp.SAMPLER_MORPH_NORMAL,tf=new Zu($p,bl.SAMPLER,1,Sl.VERTEX),ef=new Uu(Cp.LOCAL,$p,"cc_NormalDisplacements",el.SAMPLER2D,1);Ep.layouts.cc_NormalDisplacements=ef,Ep.bindings[$p]=tf;var rf=Sp.SAMPLER_MORPH_TANGENT,nf=new Zu(rf,bl.SAMPLER,1,Sl.VERTEX),sf=new Uu(Cp.LOCAL,rf,"cc_TangentDisplacements",el.SAMPLER2D,1);Ep.layouts.cc_TangentDisplacements=sf,Ep.bindings[rf]=nf;var af=Sp.SAMPLER_LIGHTMAP,of=new Zu(af,bl.SAMPLER,1,Sl.FRAGMENT),hf=new Uu(Cp.LOCAL,af,"cc_lightingMap",el.SAMPLER2D,1);Ep.layouts.cc_lightingMap=hf,Ep.bindings[af]=of;var lf=Sp.SAMPLER_SPRITE,uf=new Zu(lf,bl.SAMPLER,1,Sl.FRAGMENT),cf=new Uu(Cp.LOCAL,lf,"cc_spriteTexture",el.SAMPLER2D,1);Ep.layouts.cc_spriteTexture=cf,Ep.bindings[lf]=uf;var _f=vp.makeMaskExclude([vp.BitMask.UI_2D,vp.BitMask.GIZMOS,vp.BitMask.EDITOR,vp.BitMask.SCENE_GIZMO,vp.BitMask.PROFILER]),df=vp.makeMaskExclude([vp.BitMask.UI_2D,vp.BitMask.PROFILER]),pf=vp.Enum.ALL;t("pipeline",Object.freeze({__proto__:null,PIPELINE_FLOW_FORWARD:"ForwardFlow",PIPELINE_FLOW_SHADOW:"ShadowFlow",PIPELINE_FLOW_SMAA:"SMAAFlow",PIPELINE_FLOW_TONEMAP:"ToneMapFlow",get RenderPassStage(){return fp},get RenderPriority(){return mp},globalDescriptorSetLayout:Tp,localDescriptorSetLayout:Ep,get PipelineGlobalBindings(){return yp},get ModelLocalBindings(){return Sp},get SetIndex(){return Cp},bindingMappingInfo:xp,UBOGlobal:Op,UBOShadow:Ip,UNIFORM_SHADOWMAP_BINDING:Mp,UNIFORM_ENVIRONMENT_BINDING:Np,UNIFORM_SPOT_LIGHTING_MAP_TEXTURE_BINDING:Dp,UBOLocal:zp,INST_MAT_WORLD:"a_matWorld0",UBOLocalBatched:Gp,UBOForwardLight:Hp,JOINT_UNIFORM_CAPACITY:30,UBOSkinningTexture:Vp,UBOSkinningAnimation:Wp,INST_JOINT_ANIM_INFO:"a_jointAnimInfo",UBOSkinning:jp,UBOMorph:Xp,UNIFORM_JOINT_TEXTURE_BINDING:Yp,UNIFORM_POSITION_MORPH_TEXTURE_BINDING:Zp,UNIFORM_NORMAL_MORPH_TEXTURE_BINDING:$p,UNIFORM_TANGENT_MORPH_TEXTURE_BINDING:rf,UNIFORM_LIGHTMAP_TEXTURE_BINDING:af,UNIFORM_SPRITE_TEXTURE_BINDING:lf,CAMERA_DEFAULT_MASK:_f,CAMERA_EDITOR_MASK:df,MODEL_ALWAYS_MASK:pf}));var ff,mf,gf,vf,yf,Tf,Ef=function(){function t(t,e){if(this._mesh=void 0,this._subMeshRenderings=[],this._mesh=t,this._mesh.struct.morph){var i=this._mesh.struct.primitives.length;this._subMeshRenderings=new Array(i).fill(null);for(var r=0;r<i;++r){var n=this._mesh.struct.morph.subMeshMorphs[r];n&&(n.targets.length>Xp.MAX_MORPH_TARGET_COUNT?I(10002,Xp.MAX_MORPH_TARGET_COUNT,n.targets.length):this._subMeshRenderings[r]=new Sf(this._mesh,r,this._mesh.struct.morph,e))}}}return t.prototype.createInstance=function(){for(var t=this,e=this._mesh.struct.primitives.length,i=new Array(e),r=0;r<e;++r){var n,s;i[r]=null!==(n=null===(s=this._subMeshRenderings[r])||void 0===s?void 0:s.createInstance())&&void 0!==n?n:null}return{setWeights:function(t,e){var r;null===(r=i[t])||void 0===r||r.setWeights(e)},requiredPatches:function(e){t._mesh.struct.morph;var r=t._mesh.struct.morph.subMeshMorphs[e],n=i[e];if(null!==n){var s=[{name:"CC_USE_MORPH",value:!0},{name:"CC_MORPH_TARGET_COUNT",value:r.targets.length}];return r.attributes.includes(tl.ATTR_POSITION)&&s.push({name:"CC_MORPH_TARGET_HAS_POSITION",value:!0}),r.attributes.includes(tl.ATTR_NORMAL)&&s.push({name:"CC_MORPH_TARGET_HAS_NORMAL",value:!0}),r.attributes.includes(tl.ATTR_TANGENT)&&s.push({name:"CC_MORPH_TARGET_HAS_TANGENT",value:!0}),s.push.apply(s,n.requiredPatches()),s}},adaptPipelineState:function(t,e){var r;null===(r=i[t])||void 0===r||r.adaptPipelineState(e)},destroy:function(){for(var t,e=h(i);!(t=e()).done;){var r=t.value;null==r||r.destroy()}}}},t}(),Sf=function(){function t(t,e,i,r){this._gfxDevice=void 0,this._subMeshMorph=void 0,this._textureInfo=void 0,this._attributes=void 0,this._verticesCount=void 0,this._gfxDevice=r;var n=i.subMeshMorphs[e];this._subMeshMorph=n,wf(t,e,r);var s=t.struct.vertexBundles[t.struct.primitives[e].vertexBundelIndices[0]].view.count;this._verticesCount=s;var a=n.targets.length,o=Cf(r,s*a);this._textureInfo={width:o.width,height:o.height},this._attributes=n.attributes.map((function(e,i){var r=o.create(),a=r.valueView;return n.targets.forEach((function(e,r){for(var n=e.displacements[i],o=new Float32Array(t.data.buffer,t.data.byteOffset+n.offset,n.count),h=s*r*4,l=0;l<s;++l)a[h+4*l+0]=o[3*l+0],a[h+4*l+1]=o[3*l+1],a[h+4*l+2]=o[3*l+2]})),r.updatePixels(),{name:e,morphTexture:r}}))}var e=t.prototype;return e.destroy=function(){for(var t,e=h(this._attributes);!(t=e()).done;)t.value.morphTexture.destroy()},e.createInstance=function(){var t=this,e=new Af(this._gfxDevice,this._subMeshMorph.targets.length);return e.setMorphTextureInfo(this._textureInfo.width,this._textureInfo.height),e.setVerticesCount(this._verticesCount),e.commit(),{setWeights:function(t){e.setWeights(t),e.commit()},requiredPatches:function(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0}]},adaptPipelineState:function(i){for(var r,n=h(t._attributes);!(r=n()).done;){var s=r.value,a=void 0;switch(s.name){case tl.ATTR_POSITION:a=Zp;break;case tl.ATTR_NORMAL:a=$p;break;case tl.ATTR_TANGENT:a=rf;break;default:E("Unexpected attribute!")}void 0!==a&&(i.bindSampler(a,s.morphTexture.sampler),i.bindTexture(a,s.morphTexture.texture))}i.bindBuffer(Xp.BINDING,e.buffer),i.update()},destroy:function(){}}},t}(),bf=(function(){function t(t,e,i,r){this._gfxDevice=void 0,this._attributes=[],this._gfxDevice=r;var n=i.subMeshMorphs[e];wf(t,e,r),this._attributes=n.attributes.map((function(e,i){return{name:e,targets:n.targets.map((function(e){return{displacements:new Float32Array(t.data.buffer,t.data.byteOffset+e.displacements[i].offset,e.displacements[i].count)}}))}}))}t.prototype.createInstance=function(){return new bf(this,this._attributes[0].targets[0].displacements.length/3,this._gfxDevice)},r(t,[{key:"data",get:function(){return this._attributes}}])}(),function(){function t(t,e,i){this._attributes=void 0,this._owner=void 0,this._morphUniforms=void 0,this._owner=t,this._morphUniforms=new Af(i,0);var r=Cf(i,e);this._morphUniforms.setMorphTextureInfo(r.width,r.height),this._morphUniforms.commit(),this._attributes=this._owner.data.map((function(t){var e=r.create();return{attributeName:t.name,morphTexture:e}}))}var e=t.prototype;return e.setWeights=function(t){for(var e=0;e<this._attributes.length;++e){var i=this._attributes[e],r=i.morphTexture.valueView,n=this._owner.data[e];t.length,n.targets.length;for(var s=0;s<n.targets.length;++s){var a=n.targets[s].displacements,o=t[s],h=a.length/3;if(0===s)for(var l=0;l<h;++l)r[4*l+0]=a[3*l+0]*o,r[4*l+1]=a[3*l+1]*o,r[4*l+2]=a[3*l+2]*o;else for(var u=0;u<h;++u)r[4*u+0]+=a[3*u+0]*o,r[4*u+1]+=a[3*u+1]*o,r[4*u+2]+=a[3*u+2]*o}i.morphTexture.updatePixels()}},e.requiredPatches=function(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0},{name:"CC_MORPH_PRECOMPUTED",value:!0}]},e.adaptPipelineState=function(t){for(var e,i=h(this._attributes);!(e=i()).done;){var r=e.value,n=void 0;switch(r.attributeName){case tl.ATTR_POSITION:n=Zp;break;case tl.ATTR_NORMAL:n=$p;break;case tl.ATTR_TANGENT:n=rf;break;default:E("Unexpected attribute!")}void 0!==n&&(t.bindSampler(n,r.morphTexture.sampler),t.bindTexture(n,r.morphTexture.texture))}t.bindBuffer(Xp.BINDING,this._morphUniforms.buffer),t.update()},e.destroy=function(){this._morphUniforms.destroy();for(var t=0;t<this._attributes.length;++t)this._attributes[t].morphTexture.destroy()},t}()),Af=function(){function t(t,e){this._targetCount=void 0,this._localBuffer=void 0,this._remoteBuffer=void 0,this._targetCount=e,this._localBuffer=new DataView(new ArrayBuffer(Xp.SIZE)),this._remoteBuffer=t.createBuffer(new Kl(rl.UNIFORM|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,Xp.SIZE,Xp.SIZE))}var e=t.prototype;return e.destroy=function(){this._remoteBuffer.destroy()},e.setWeights=function(t){t.length,this._targetCount;for(var e=0;e<t.length;++e)this._localBuffer.setFloat32(Xp.OFFSET_OF_WEIGHTS+4*e,t[e],_.sys.isLittleEndian)},e.setMorphTextureInfo=function(t,e){this._localBuffer.setFloat32(Xp.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH,t,_.sys.isLittleEndian),this._localBuffer.setFloat32(Xp.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT,e,_.sys.isLittleEndian)},e.setVerticesCount=function(t){this._localBuffer.setFloat32(Xp.OFFSET_OF_VERTICES_COUNT,t,_.sys.isLittleEndian)},e.commit=function(){this._remoteBuffer.update(this._localBuffer.buffer,this._localBuffer.byteOffset,this._localBuffer.byteLength)},r(t,[{key:"buffer",get:function(){return this._remoteBuffer}}]),t}();function Cf(t,e){var i,r,n,s;t.hasFeature(Fl.TEXTURE_FLOAT)?(i=e,n=16,r=pp.PixelFormat.RGBA32F,s=Float32Array):(i=4*e,n=4,r=pp.PixelFormat.RGBA8888,s=Uint8Array);var a=function(t){t<5&&(t=5);var e=ms(vs(t)),i=e>>1;return{width:1<<(1&e?i+1:i),height:1<<i}}(i),o=a.width,h=a.height;return{width:o,height:h,create:function(){var e=new ArrayBuffer(o*h*n),i=new Float32Array(e),a=s===Float32Array?i:new s(e),l=new Dd({width:o,height:h,_data:a,_compressed:!1,format:r}),u=new pp;u.setFilters(pp.Filter.NEAREST,pp.Filter.NEAREST),u.setMipFilter(pp.Filter.NONE),u.setWrapMode(pp.WrapMode.CLAMP_TO_EDGE,pp.WrapMode.CLAMP_TO_EDGE,pp.WrapMode.CLAMP_TO_EDGE),u.image=l,u.getGFXTexture()||E("Unexpected: failed to create morph texture?");var c=ep.getSampler(t,u.getSamplerHash());return{get texture(){return u.getGFXTexture()},get sampler(){return c},get valueView(){return i},destroy:function(){u.destroy()},updatePixels:function(){u.uploadData(a)}}}}}function wf(t,e,i){t.renderingSubMeshes[e].enableVertexIdChannel(i)}function Rf(t){switch(t){case 1:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array;default:return Uint8Array}}var xf=t("RenderingSubMesh",function(){function t(t,e,i,r,n){void 0===r&&(r=null),void 0===n&&(n=null),this.mesh=void 0,this.subMeshIdx=void 0,this._flatBuffers=[],this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0,this._vertexIdChannel=void 0,this._geometricInfo=void 0,this._vertexBuffers=void 0,this._attributes=void 0,this._indexBuffer=null,this._indirectBuffer=null,this._primitiveMode=void 0,this._iaInfo=void 0,this._handle=0,this._attributes=e,this._vertexBuffers=t,this._indexBuffer=r,this._indirectBuffer=n,this._primitiveMode=i,this._iaInfo=new lu(e,t,r,n),this._handle=Nh.alloc();var s=Io.alloc();Nh.set(this._handle,Oh.FLAT_BUFFER_ARRAY,s)}var e=t.prototype;return e.genFlatBuffers=function(){if(!this._flatBuffers.length&&this.mesh&&void 0!==this.subMeshIdx){var t=this.mesh,e=0,i=t.struct.primitives[this.subMeshIdx],r=Nh.get(this._handle,Oh.FLAT_BUFFER_ARRAY);i.indexView&&(e=i.indexView.count);for(var n=0;n<i.vertexBundelIndices.length;n++){var s=i.vertexBundelIndices[n],a=t.struct.vertexBundles[s],o=i.indexView?i.indexView.count:a.view.count,h=a.view.stride,l=h*o,u=new Uint8Array(t.data.buffer,a.view.offset,a.view.length),c=Po.alloc(i.indexView?l:a.view.length),_=Mh.alloc();Mh.set(_,Rh.STRIDE,h),Mh.set(_,Rh.AMOUNT,o),Mh.set(_,Rh.BUFFER,c),Io.push(r,_);var d=Po.getBuffer(c),p=new Uint8Array(d);if(i.indexView){for(var f=t.readIndices(this.subMeshIdx),m=0;m<e;++m)for(var g=m*h,v=f[m]*h,y=0;y<h;++y)p[g+y]=u[v+y];this._flatBuffers.push({stride:h,count:o,buffer:p})}else p.set(t.data.subarray(a.view.offset,a.view.offset+a.view.length)),this._flatBuffers.push({stride:h,count:o,buffer:p})}}},e.destroy=function(){for(var t=0;t<this.vertexBuffers.length;t++)this.vertexBuffers[t].destroy();if(this.vertexBuffers.length=0,this._indexBuffer&&(this._indexBuffer.destroy(),this._indexBuffer=null),this._jointMappedBuffers&&this._jointMappedBufferIndices){for(var e=0;e<this._jointMappedBufferIndices.length;e++)this._jointMappedBuffers[this._jointMappedBufferIndices[e]].destroy();this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0}this._indirectBuffer&&(this._indirectBuffer.destroy(),this._indirectBuffer=null),this._handle&&(To(Nh.get(this._handle,Oh.FLAT_BUFFER_ARRAY),Io,Mh),Nh.free(this._handle),this._handle=0)},e.enableVertexIdChannel=function(t){if(!this._vertexIdChannel){var e=this.vertexBuffers.length,i=this.attributes.length,r=this._allocVertexIdBuffer(t);this._vertexBuffers.push(r),this._attributes.push(new hu("a_vertexId",il.R32F,!1,e)),this._iaInfo.attributes=this._attributes,this._iaInfo.vertexBuffers=this._vertexBuffers,this._vertexIdChannel={stream:e,index:i}}},e._allocVertexIdBuffer=function(t){for(var e=0===this.vertexBuffers.length||0===this.vertexBuffers[0].stride?0:this.vertexBuffers[0].size/this.vertexBuffers[0].stride,i=new Float32Array(e),r=0;r<e;++r)i[r]=r+.5;var n=t.createBuffer(new Kl(rl.VERTEX|rl.TRANSFER_DST,nl.DEVICE,i.byteLength,i.BYTES_PER_ELEMENT));return n.update(i),n},r(t,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"indirectBuffer",get:function(){return this._indirectBuffer}},{key:"primitiveMode",get:function(){return this._primitiveMode}},{key:"geometricInfo",get:function(){if(this._geometricInfo)return this._geometricInfo;if(void 0===this.mesh)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:Cs.ZERO,max:Cs.ZERO}};if(void 0===this.subMeshIdx)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:Cs.ZERO,max:Cs.ZERO}};var t=this.mesh,e=this.subMeshIdx,i=t.readAttribute(e,tl.ATTR_POSITION),r=t.readIndices(e),n=new Cs,s=new Cs,a=this.attributes.find((function(t){return t.name===tl.ATTR_POSITION}));if(a){var o=zl[a.format].count;2===o?(n.set(i[0],i[1],0),s.set(i[0],i[1],0)):(n.set(i[0],i[1],i[2]),s.set(i[0],i[1],i[2]));for(var h=0;h<i.length;h+=o)2===o?(n.x=i[h]>n.x?i[h]:n.x,n.y=i[h+1]>n.y?i[h+1]:n.y,s.x=i[h]<s.x?i[h]:s.x,s.y=i[h+1]<s.y?i[h+1]:s.y):(n.x=i[h]>n.x?i[h]:n.x,n.y=i[h+1]>n.y?i[h+1]:n.y,n.z=i[h+2]>n.z?i[h+2]:n.z,s.x=i[h]<s.x?i[h]:s.x,s.y=i[h+1]<s.y?i[h+1]:s.y,s.z=i[h+2]<s.z?i[h+2]:s.z)}return this._geometricInfo={positions:i,indices:r,boundingBox:{max:n,min:s}},this._geometricInfo}},{key:"flatBuffers",get:function(){return this._flatBuffers}},{key:"jointMappedBuffers",get:function(){var t=this;if(this._jointMappedBuffers)return this._jointMappedBuffers;var e=this._jointMappedBuffers=[],i=this._jointMappedBufferIndices=[];if(!this.mesh||void 0===this.subMeshIdx)return this._jointMappedBuffers=this.vertexBuffers;var r,n,s=this.mesh.struct,a=s.primitives[this.subMeshIdx];if(!s.jointMaps||void 0===a.jointMapIndex||!s.jointMaps[a.jointMapIndex])return this._jointMappedBuffers=this.vertexBuffers;for(var o=_.director.root.device,h=0;h<a.vertexBundelIndices.length;h++){var l=s.vertexBundles[a.vertexBundelIndices[h]];n=0,r=il.UNKNOWN;for(var u=0;u<l.attributes.length;u++){var c=l.attributes[u];if(c.name===tl.ATTR_JOINTS){r=c.format;break}n+=zl[c.format].size}r?function(){var u=new Uint8Array(t.mesh.data.buffer,l.view.offset,l.view.length),c=new DataView(u.slice().buffer),_=s.jointMaps[a.jointMapIndex];wd(c,(function(t){return _.indexOf(t)}),r,n,l.view.length,l.view.stride,c);var d=o.createBuffer(new Kl(rl.VERTEX|rl.TRANSFER_DST,nl.DEVICE,l.view.length,l.view.stride));d.update(c.buffer),e.push(d),i.push(h)}():e.push(this.vertexBuffers[a.vertexBundelIndices[h]])}return this._vertexIdChannel&&e.push(this._allocVertexIdBuffer(o)),e}},{key:"iaInfo",get:function(){return this._iaInfo}},{key:"handle",get:function(){return this._handle}}]),t}()),Of=new Cs,If=new Cs,Mf=new Uint8Array,Bf=t("Mesh",Ne("cc.Mesh")((Tf=function(t){function e(){var e;return(e=t.call(this)||this).morphRendering=null,l(e,"_struct",gf,a(e)),l(e,"_dataLength",vf,a(e)),l(e,"_hash",yf,a(e)),e._data=Mf,e._initialized=!1,e._renderingSubMeshes=null,e._boneSpaceBounds=new Map,e._jointBufferIndices=null,e.loaded=!1,e}s(e,t),r(e,[{key:"_nativeAsset",get:function(){return this._data.buffer},set:function(t){this._data.byteLength===t.byteLength?this._data.set(new Uint8Array(t)):this._data=new Uint8Array(t),this.loaded=!0,this.emit("load")}},{key:"subMeshCount",get:function(){var t=this.renderingSubMeshes;return t?t.length:0}},{key:"minPosition",get:function(){return this.struct.minPosition}},{key:"maxPosition",get:function(){return this.struct.maxPosition}},{key:"struct",get:function(){return this._struct}},{key:"data",get:function(){return this._data}},{key:"hash",get:function(){return this._hash||(this._hash=ou(this._data,666)),this._hash}},{key:"jointBufferIndices",get:function(){return this._jointBufferIndices?this._jointBufferIndices:this._jointBufferIndices=this._struct.primitives.map((function(t){return t.jointMapIndex||0}))}},{key:"renderingSubMeshes",get:function(){return this.initialize(),this._renderingSubMeshes}}]);var i=e.prototype;return i.initialize=function(){var t=this;if(!this._initialized){this._initialized=!0,this._data.byteLength!==this._dataLength&&(this._data=new Uint8Array(this._dataLength),_.assetManager.postLoadNative(this));for(var e=this._data.buffer,i=_.director.root.device,r=this._createVertexBuffers(i,e),n=[],s=function(s){var a=t._struct.primitives[s];if(0===a.vertexBundelIndices.length)return"continue";var o=null,h=null;if(a.indexView){var l=a.indexView,u=l.stride,c=l.length;if(4===u&&!i.hasFeature(Fl.ELEMENT_INDEX_UINT)){var _=t._struct.vertexBundles[a.vertexBundelIndices[0]].view.count;if(_>=65536)return I(10001,_,65536),"continue";u>>=1,c>>=1}o=i.createBuffer(new Kl(rl.INDEX|rl.TRANSFER_DST,nl.DEVICE,c,u)),h=new(Rf(l.stride))(e,l.offset,l.count),l.stride!==u&&(h=Rf(u).from(h)),t.loaded?o.update(h):t.once("load",(function(){o.update(h)}))}var d=a.vertexBundelIndices.map((function(t){return r[t]})),p=[];if(a.vertexBundelIndices.length>0)for(var f=a.vertexBundelIndices[0],m=t._struct.vertexBundles[f].attributes,g=0;g<m.length;++g){var v=m[g];p[g]=new hu(v.name,v.format,v.isInstanced,v.stream,v.isInstanced,v.location)}var y=new xf(d,p,a.primitiveMode,o);y.mesh=t,y.subMeshIdx=s,n.push(y)},a=0;a<this._struct.primitives.length;a++)s(a);this._renderingSubMeshes=n,this._struct.morph&&(this.morphRendering=function(t,e){return new Ef(t,e)}(this,i))}},i.destroy=function(){return this.destroyRenderingMesh(),t.prototype.destroy.call(this)},i.destroyRenderingMesh=function(){if(this._renderingSubMeshes){for(var t=0;t<this._renderingSubMeshes.length;t++)this._renderingSubMeshes[t].destroy();this._renderingSubMeshes=null,this._initialized=!1}},i.assign=function(t,e){this.reset({struct:t,data:e})},i.reset=function(t){this.destroyRenderingMesh(),this._struct=t.struct,this._data=t.data,this._dataLength=this.data.byteLength,this._hash=0,this.loaded=!0,this.emit("load")},i.getBoneSpaceBounds=function(t){if(this._boneSpaceBounds.has(t.hash))return this._boneSpaceBounds.get(t.hash);var e=[];this._boneSpaceBounds.set(t.hash,e);for(var i=[],r=t.bindposes,n=0;n<r.length;n++)e.push(new y_(1/0,1/0,1/0,-1/0,-1/0,-1/0)),i.push(!1);for(var s=this._struct.primitives,a=0;a<s.length;a++){var o=this.readAttribute(a,tl.ATTR_JOINTS),h=this.readAttribute(a,tl.ATTR_WEIGHTS),l=this.readAttribute(a,tl.ATTR_POSITION);if(o&&h&&l)for(var u=Math.min(o.length/4,h.length/4,l.length/3),c=0;c<u;c++){Cs.set(Of,l[3*c+0],l[3*c+1],l[3*c+2]);for(var _=0;_<4;++_){var d=4*c+_,p=o[d];if(!(0===h[d]||p>=r.length)){Cs.transformMat4(If,Of,r[p]),i[p]=!0;var f=e[p];Cs.min(f.center,f.center,If),Cs.max(f.halfExtents,f.halfExtents,If)}}}}for(var m=0;m<r.length;m++){var g=e[m];i[m]?y_.fromPoints(g,g.center,g.halfExtents):e[m]=null}return e},i.merge=function(t,e,i){if(i&&(!this.loaded||!t.loaded||!this.validateMergingMesh(t)))return!1;var r=new Cs,n=e&&new Ns,s=e&&new y_;if(n&&e.getRotation(n),!this._initialized){var a=JSON.parse(JSON.stringify(t._struct)),o=t._data.slice();if(e){a.maxPosition&&a.minPosition&&(Cs.add(s.center,a.maxPosition,a.minPosition),Cs.multiplyScalar(s.center,s.center,.5),Cs.subtract(s.halfExtents,a.maxPosition,a.minPosition),Cs.multiplyScalar(s.halfExtents,s.halfExtents,.5),y_.transform(s,s,e),Cs.add(a.maxPosition,s.center,s.halfExtents),Cs.subtract(a.minPosition,s.center,s.halfExtents));for(var l=0;l<a.vertexBundles.length;l++)for(var u=a.vertexBundles[l],c=0;c<u.attributes.length;c++)if(u.attributes[c].name===tl.ATTR_POSITION||u.attributes[c].name===tl.ATTR_NORMAL){var _=u.attributes[c].format,d=new DataView(o.buffer,u.view.offset+Pf(u.attributes,c)),p=Ff(d,_),f=Df(d,_);if(!p||!f)continue;for(var m=u.view.count,g=u.view.stride,v=Lf(_),y=0;y<m;y++){var T=y*g,E=T+v,S=E+v;switch(r.set(p(T),p(E),p(S)),u.attributes[c].name){case tl.ATTR_POSITION:r.transformMat4(e);break;case tl.ATTR_NORMAL:Cs.transformQuat(r,r,n)}f(T,r.x),f(E,r.y),f(S,r.z)}}}return this.reset({struct:a,data:o}),this.initialize(),!0}for(var b,A,C,w,R,x=new Ed,O=0,I=0,M=0,B=0,P=0,N=0,L=0,F=0,D=!1,U=new Array(this._struct.vertexBundles.length),k=0;k<this._struct.vertexBundles.length;++k){var z=this._struct.vertexBundles[k],G=t._struct.vertexBundles[k];M=z.view.offset,B=G.view.offset,I=z.view.stride,O=z.view.count+G.view.count,b=new ArrayBuffer(O*I),A=new Uint8Array(b),M+=(C=this._data.subarray(M,M+z.view.length)).length,B+=(w=t._data.subarray(B,B+G.view.length)).length,A.set(C),P=0;for(var H,V=h(z.attributes);!(H=V()).done;){var W=H.value;L=0,D=!1;for(var j,X=h(G.attributes);!(j=X()).done;){var Y=j.value;if(W.name===Y.name&&W.format===Y.format){D=!0;break}L+=zl[Y.format].size}if(D){F=zl[W.format].size,N=z.view.length+P;for(var q=0;q<G.view.count;++q){if(R=w.subarray(L,L+F),A.set(R,N),(W.name===tl.ATTR_POSITION||W.name===tl.ATTR_NORMAL)&&e){var K=new Float32Array(A.buffer,N,3);switch(r.set(K[0],K[1],K[2]),W.name){case tl.ATTR_POSITION:r.transformMat4(e);break;case tl.ATTR_NORMAL:Cs.transformQuat(r,r,n)}K[0]=r.x,K[1]=r.y,K[2]=r.z}N+=z.view.stride,L+=G.view.stride}}P+=zl[W.format].size}U[k]={attributes:z.attributes,view:{offset:x.getLength(),length:b.byteLength,count:O,stride:I}},x.addBuffer(b)}for(var Z,Q,J,$=0,tt=2,et=0,it=new Array(this._struct.primitives.length),rt=0;rt<this._struct.primitives.length;++rt){var nt=this._struct.primitives[rt],st=t._struct.primitives[rt];it[rt]={primitiveMode:nt.primitiveMode,vertexBundelIndices:nt.vertexBundelIndices};for(var at,ot=h(nt.vertexBundelIndices);!(at=ot()).done;){var ht=at.value;et=Math.max(et,this._struct.vertexBundles[ht].view.count)}if(nt.indexView&&st.indexView){$=nt.indexView.count,$+=st.indexView.count,M=nt.indexView.offset,B=st.indexView.offset,tt=$<256?1:$<65536?2:4;var lt=new ArrayBuffer($*tt);if(Z=2===tt?new Uint16Array(lt):1===tt?new Uint8Array(lt):new Uint32Array(lt),Q=2===nt.indexView.stride?new Uint16Array(this._data.buffer,M,nt.indexView.count):1===nt.indexView.stride?new Uint8Array(this._data.buffer,M,nt.indexView.count):new Uint32Array(this._data.buffer,M,nt.indexView.count),tt===nt.indexView.stride)Z.set(Q);else for(var ut=0;ut<nt.indexView.count;++ut)Z[ut]=Q[ut];M+=nt.indexView.length,J=2===st.indexView.stride?new Uint16Array(t._data.buffer,B,st.indexView.count):1===st.indexView.stride?new Uint8Array(t._data.buffer,B,st.indexView.count):new Uint32Array(t._data.buffer,B,st.indexView.count);for(var ct=0;ct<st.indexView.count;++ct)Z[nt.indexView.count+ct]=et+J[ct];B+=st.indexView.length,it[rt].indexView={offset:x.getLength(),length:lt.byteLength,count:$,stride:tt},x.setNextAlignment(tt),x.addBuffer(lt)}}var _t={vertexBundles:U,primitives:it,minPosition:this._struct.minPosition,maxPosition:this._struct.maxPosition};return _t.minPosition&&t._struct.minPosition&&_t.maxPosition&&t._struct.maxPosition&&(e?(Cs.add(s.center,t._struct.maxPosition,t._struct.minPosition),Cs.multiplyScalar(s.center,s.center,.5),Cs.subtract(s.halfExtents,t._struct.maxPosition,t._struct.minPosition),Cs.multiplyScalar(s.halfExtents,s.halfExtents,.5),y_.transform(s,s,e),Cs.add(r,s.center,s.halfExtents),Cs.max(_t.maxPosition,_t.maxPosition,r),Cs.subtract(r,s.center,s.halfExtents),Cs.min(_t.minPosition,_t.minPosition,r)):(Cs.min(_t.minPosition,_t.minPosition,t._struct.minPosition),Cs.max(_t.maxPosition,_t.maxPosition,t._struct.maxPosition))),this.reset({struct:_t,data:new Uint8Array(x.getCombined())}),this.initialize(),!0},i.validateMergingMesh=function(t){if(this._struct.vertexBundles.length!==t._struct.vertexBundles.length)return!1;for(var e=0;e<this._struct.vertexBundles.length;++e){var i=this._struct.vertexBundles[e],r=t._struct.vertexBundles[e];if(i.attributes.length!==r.attributes.length)return!1;for(var n=0;n<i.attributes.length;++n)if(i.attributes[n].format!==r.attributes[n].format)return!1}if(this._struct.primitives.length!==t._struct.primitives.length)return!1;for(var s=0;s<this._struct.primitives.length;++s){var a=this._struct.primitives[s],o=t._struct.primitives[s];if(a.vertexBundelIndices.length!==o.vertexBundelIndices.length)return!1;for(var h=0;h<a.vertexBundelIndices.length;++h)if(a.vertexBundelIndices[h]!==o.vertexBundelIndices[h])return!1;if(a.primitiveMode!==o.primitiveMode)return!1;if(a.indexView){if(void 0===o.indexView)return!1}else if(o.indexView)return!1}return!0},i.readAttribute=function(t,e){var i=this,r=null;return this._accessAttribute(t,e,(function(t,e){var n=t.view.count,s=t.attributes[e].format,a=jl(zl[s]);if(0!==n){var o=new DataView(i._data.buffer,t.view.offset+Pf(t.attributes,e)),h=zl[s],l=Ff(o,s);if(a&&l){for(var u=h.count,c=new a(n*u),_=t.view.stride,d=0;d<n;++d)for(var p=0;p<u;++p)c[u*d+p]=l(_*d+c.BYTES_PER_ELEMENT*p);r=c}}})),r},i.copyAttribute=function(t,e,i,r,n){var s=this,a=!1;return this._accessAttribute(t,e,(function(t,e){var o=t.view.count;if(0!==o){var h=t.attributes[e].format,l=new DataView(s._data.buffer,t.view.offset+Pf(t.attributes,e)),u=new DataView(i,n),c=zl[h],_=Ff(l,h),d=Df(u,h);if(_&&d){for(var p=c.count,f=t.view.stride,m=Lf(h),g=r,v=m,y=0;y<o;++y)for(var T=0;T<p;++T)d(g*y+v*T,_(f*y+m*T));a=!0}}else a=!0})),a},i.readIndices=function(t){if(t>=this._struct.primitives.length)return null;var e=this._struct.primitives[t];if(!e.indexView)return null;var i=e.indexView.stride;return new(1===i?Uint8Array:2===i?Uint16Array:Uint32Array)(this._data.buffer,e.indexView.offset,e.indexView.count)},i.copyIndices=function(t,e){if(t>=this._struct.primitives.length)return!1;var i=this._struct.primitives[t];if(!i.indexView)return!1;for(var r=i.indexView.count,n=1===i.indexView.stride?il.R8UI:2===i.indexView.stride?il.R16UI:il.R32UI,s=Ff(new DataView(this._data.buffer),n),a=0;a<r;++a)e[a]=s(i.indexView.offset+zl[n].size*a);return!0},i._accessAttribute=function(t,e,i){if(!(t>=this._struct.primitives.length))for(var r,n=h(this._struct.primitives[t].vertexBundelIndices);!(r=n()).done;){var s=r.value,a=this._struct.vertexBundles[s],o=a.attributes.findIndex((function(t){return t.name===e}));if(!(o<0)){i(a,o);break}}},i._createVertexBuffers=function(t,e){var i=this;return this._struct.vertexBundles.map((function(r){var n=t.createBuffer(new Kl(rl.VERTEX|rl.TRANSFER_DST,nl.DEVICE,r.view.length,r.view.stride)),s=new Uint8Array(e,r.view.offset,r.view.length);return i.loaded?n.update(s):i.once("load",(function(){n.update(s)})),n}))},e}(Sr),gf=u((mf=Tf).prototype,"_struct",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{vertexBundles:[],primitives:[]}}}),vf=u(mf.prototype,"_dataLength",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),yf=u(mf.prototype,"_hash",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ff=mf))||ff);function Pf(t,e){for(var i=0,r=0;r<e;++r){var n=t[r];i+=zl[n.format].size}return i}_.Mesh=Bf;var Nf=Jr.isLittleEndian;function Lf(t){var e=zl[t];return e.size/e.count}function Ff(t,e){var i=zl[e],r=i.size/i.count;switch(i.type){case Pl.UNORM:switch(r){case 1:return function(e){return t.getUint8(e)};case 2:return function(e){return t.getUint16(e,Nf)};case 4:return function(e){return t.getUint32(e,Nf)}}break;case Pl.SNORM:case Pl.INT:switch(r){case 1:return function(e){return t.getInt8(e)};case 2:return function(e){return t.getInt16(e,Nf)};case 4:return function(e){return t.getInt32(e,Nf)}}break;case Pl.UINT:switch(r){case 1:return function(e){return t.getUint8(e)};case 2:return function(e){return t.getUint16(e,Nf)};case 4:return function(e){return t.getUint32(e,Nf)}}break;case Pl.FLOAT:return function(e){return t.getFloat32(e,Nf)}}return null}function Df(t,e){var i=zl[e],r=i.size/i.count;switch(i.type){case Pl.UNORM:switch(r){case 1:return function(e,i){return t.setUint8(e,i)};case 2:return function(e,i){return t.setUint16(e,i,Nf)};case 4:return function(e,i){return t.setUint32(e,i,Nf)}}break;case Pl.SNORM:case Pl.INT:switch(r){case 1:return function(e,i){return t.setInt8(e,i)};case 2:return function(e,i){return t.setInt16(e,i,Nf)};case 4:return function(e,i){return t.setInt32(e,i,Nf)}}break;case Pl.UINT:switch(r){case 1:return function(e,i){return t.setUint8(e,i)};case 2:return function(e,i){return t.setUint16(e,i,Nf)};case 4:return function(e,i){return t.setUint32(e,i,Nf)}}break;case Pl.FLOAT:return function(e,i){return t.setFloat32(e,i,Nf)}}return null}var Uf,kf,zf,Gf,Hf,Vf=0,Wf={};!function(t){t[t.OPAQUE=0]="OPAQUE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OVERLAY=2]="OVERLAY"}(Uf||(Uf={})),function(t){t[t.DEFAULT=1]="DEFAULT",t[t.FORWARD=2]="FORWARD",t[t.SHADOWCAST=4]="SHADOWCAST"}(kf||(kf={})),function(t){t[t.UBO=0]="UBO",t[t.SAMPLER=1]="SAMPLER"}(Hf||(Hf={}));var jf,Xf=function(t,e,i,r,n){return void 0===n&&(n=0),t<<28&4026531840|r<<22&264241152|e<<20&3145728|i<<14&1032192|16383&n},Yf=function(t){return(4026531840&t)>>>28},qf=function(t){return(264241152&t)>>>22},Kf=function(t){return(1032192&t)>>>14},Zf=function(t){return 16383&t},Qf=function(t,e){return-264241153&t|e<<22&264241152},Jf=((zf={})[el.UNKNOWN]=function(){return console.warn("illegal uniform handle")},zf[el.INT]=function(t,e,i){return void 0===i&&(i=0),t[i]},zf[el.INT2]=function(t,e,i){return void 0===i&&(i=0),Es.fromArray(e,t,i)},zf[el.INT3]=function(t,e,i){return void 0===i&&(i=0),Cs.fromArray(e,t,i)},zf[el.INT4]=function(t,e,i){return void 0===i&&(i=0),Os.fromArray(e,t,i)},zf[el.FLOAT]=function(t,e,i){return void 0===i&&(i=0),t[i]},zf[el.FLOAT2]=function(t,e,i){return void 0===i&&(i=0),Es.fromArray(e,t,i)},zf[el.FLOAT3]=function(t,e,i){return void 0===i&&(i=0),Cs.fromArray(e,t,i)},zf[el.FLOAT4]=function(t,e,i){return void 0===i&&(i=0),Os.fromArray(e,t,i)},zf[el.MAT3]=function(t,e,i){return void 0===i&&(i=0),Ms.fromArray(e,t,i)},zf[el.MAT4]=function(t,e,i){return void 0===i&&(i=0),Hs.fromArray(e,t,i)},zf),$f=((Gf={})[el.UNKNOWN]=function(){return console.warn("illegal uniform handle")},Gf[el.INT]=function(t,e,i){return void 0===i&&(i=0),t[i]=e},Gf[el.INT2]=function(t,e,i){return void 0===i&&(i=0),Es.toArray(t,e,i)},Gf[el.INT3]=function(t,e,i){return void 0===i&&(i=0),Cs.toArray(t,e,i)},Gf[el.INT4]=function(t,e,i){return void 0===i&&(i=0),Os.toArray(t,e,i)},Gf[el.FLOAT]=function(t,e,i){return void 0===i&&(i=0),t[i]=e},Gf[el.FLOAT2]=function(t,e,i){return void 0===i&&(i=0),Es.toArray(t,e,i)},Gf[el.FLOAT3]=function(t,e,i){return void 0===i&&(i=0),Cs.toArray(t,e,i)},Gf[el.FLOAT4]=function(t,e,i){return void 0===i&&(i=0),Os.toArray(t,e,i)},Gf[el.MAT3]=function(t,e,i){return void 0===i&&(i=0),Ms.toArray(t,e,i)},Gf[el.MAT4]=function(t,e,i){return void 0===i&&(i=0),Hs.toArray(t,e,i)},Gf),tm=[Object.freeze([0]),Object.freeze([0,0]),Object.freeze([0,0,0,0]),Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])];function em(t){switch(t){case el.BOOL:case el.INT:case el.UINT:case el.FLOAT:return tm[0];case el.BOOL2:case el.INT2:case el.UINT2:case el.FLOAT2:return tm[1];case el.BOOL4:case el.INT4:case el.UINT4:case el.FLOAT4:return tm[2];case el.MAT4:return tm[3];case el.SAMPLER2D:return"default-texture";case el.SAMPLER_CUBE:return"default-cube-texture"}return tm[0]}function im(t,e){for(var i=Object.entries(e),r=!1,n=0;n<i.length;n++)t[i[n][0]]!==i[n][1]&&(t[i[n][0]]=i[n][1],r=!0);return r}var rm,nm,sm,am,om,hm,lm=[{u:0,v:0},{u:0,v:0},{u:0,v:0},{u:0,v:0}],um=t("SpriteFrame",Ne("cc.SpriteFrame")(jf=function(t){function e(){var e;return(e=t.call(this)||this).vertices=null,e.uv=[],e.uvHash=0,e.unbiasUV=[],e.uvSliced=[],e._rect=new Ks,e._offset=new Es,e._originalSize=new Ys,e._rotated=!1,e._capInsets=[0,0,0,0],e._atlasUuid="",e._texture=void 0,e._isFlipUVY=!1,e._isFlipUVX=!1,e}s(e,t),e.createWithImage=function(t){var i=t instanceof Dd?t:new Dd(t),r=new pp;r.image=i;var n=new e;return n.texture=r,n},r(e,[{key:"insetTop",get:function(){return this._capInsets[1]},set:function(t){this._capInsets[1]!==t&&(this._capInsets[1]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetBottom",get:function(){return this._capInsets[3]},set:function(t){this._capInsets[3]!==t&&(this._capInsets[3]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetLeft",get:function(){return this._capInsets[0]},set:function(t){this._capInsets[0]!==t&&(this._capInsets[0]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetRight",get:function(){return this._capInsets[2]},set:function(t){this._capInsets[2]!==t&&(this._capInsets[2]=t,this._texture&&this._calculateSlicedUV())}},{key:"rect",get:function(){return this._rect},set:function(t){this._rect.equals(t)||(this._rect.set(t),this._texture&&this._calculateUV())}},{key:"originalSize",get:function(){return this._originalSize},set:function(t){this._originalSize.equals(t)||(this._originalSize.set(t),this._texture&&this._calculateUV())}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset.set(t)}},{key:"rotated",get:function(){return this._rotated},set:function(t){this._rotated!==t&&(this._rotated=t,this._texture&&this._calculateUV())}},{key:"texture",get:function(){return this._texture},set:function(t){t?this.reset({texture:t},!0):console.warn("Error Texture in "+this.name)}},{key:"atlasUuid",get:function(){return this._atlasUuid},set:function(t){this._atlasUuid=t}},{key:"width",get:function(){return this._texture.width}},{key:"height",get:function(){return this._texture.height}},{key:"_textureSource",set:function(t){window.Build?this._texture=t:t&&(this._refreshTexture(t),this._calculateUV())}},{key:"flipUVX",get:function(){return this._isFlipUVX},set:function(t){this._isFlipUVX=t,this._calculateUV()}},{key:"flipUVY",get:function(){return this._isFlipUVY},set:function(t){this._isFlipUVY=t,this._calculateUV()}}]);var i=e.prototype;return i.textureLoaded=function(){return this.texture&&this.texture.loaded},i.isRotated=function(){return this._rotated},i.setRotated=function(t){this.rotated=t},i.getRect=function(t){return t?(t.set(this._rect),t):this._rect.clone()},i.setRect=function(t){this.rect=t},i.getOriginalSize=function(t){return t?(t.set(this._originalSize),t):this._originalSize.clone()},i.setOriginalSize=function(t){this.originalSize=t},i.getOffset=function(t){return t?(t.set(this._offset),t):this._offset.clone()},i.setOffset=function(t){this.offset=t},i.getGFXTexture=function(){return this._texture.getGFXTexture()},i.getGFXSampler=function(){return this._texture.getGFXSampler()},i.getHash=function(){return this._texture.getHash()},i.getSamplerHash=function(){return this._texture.getSamplerHash()},i.reset=function(t,e){void 0===e&&(e=!1);var i=!1;e&&(this._originalSize.set(0,0),this._rect.set(0,0,0,0),this._offset.set(0,0),this._capInsets=[0,0,0,0],this._rotated=!1,i=!0),t&&(t.texture&&(this.loaded=!1,this._rect.x=this._rect.y=0,this._rect.width=t.texture.width,this._rect.height=t.texture.height,this._refreshTexture(t.texture),this.checkRect(this._texture)),t.originalSize&&this._originalSize.set(t.originalSize),t.rect&&this._rect.set(t.rect),t.offset&&this._offset.set(t.offset),void 0!==t.borderTop&&(this._capInsets[1]=t.borderTop),void 0!==t.borderBottom&&(this._capInsets[3]=t.borderBottom),void 0!==t.borderLeft&&(this._capInsets[0]=t.borderLeft),void 0!==t.borderRight&&(this._capInsets[2]=t.borderRight),void 0!==t.isRotate&&(this._rotated=!!t.isRotate),void 0!==t.isFlipUv&&(this._isFlipUVY=!!t.isFlipUv),i=!0),i&&this.texture&&this._calculateUV()},i.checkRect=function(t){var e=this._rect,i=e.x,r=e.y;return this._rotated?(i+=e.height,r+=e.width):(i+=e.width,r+=e.height),i>t.width?(B(3300,this.name+"/"+t.name,i,t.width),!1):!(r>t.height&&(B(3301,this.name+"/"+t.name,r,t.height),1))},i.onLoaded=function(){this.loaded=!0,this.emit("load")},i.destroy=function(){return t.prototype.destroy.call(this)},i._calculateSlicedUV=function(){var t=this._rect,e=this.texture,i=e.width,r=e.height,n=this._capInsets[0],s=this._capInsets[2],a=t.width-n-s,o=this._capInsets[1],h=this._capInsets[3],l=t.height-o-h,u=this.uvSliced;if(u.length=0,this._rotated){lm[0].u=(t.x+.5)/i,lm[1].u=(t.x+h)/i,lm[2].u=(t.x+h+l)/i,lm[3].u=(t.x+t.height-.5)/i,lm[3].v=(t.y+.5)/r,lm[2].v=(t.y+n)/r,lm[1].v=(t.y+n+a)/r,lm[0].v=(t.y+t.width-.5)/r;for(var c=0;c<4;++c)for(var _=lm[c],d=0;d<4;++d){var p=lm[3-d];u.push({u:_.u,v:p.v})}}else{lm[0].u=(t.x+.5)/i,lm[1].u=(t.x+n)/i,lm[2].u=(t.x+n+a)/i,lm[3].u=(t.x+t.width-.5)/i,lm[3].v=(t.y+.5)/r,lm[2].v=(t.y+o)/r,lm[1].v=(t.y+o+l)/r,lm[0].v=(t.y+t.height-.5)/r;for(var f=0;f<4;++f)for(var m=lm[f],g=0;g<4;++g){var v=lm[g];u.push({u:v.u,v:m.v})}}},i._calculateUV=function(){var t=this._rect,e=this.uv,i=this.unbiasUV,r=this.texture,n=r.width,s=r.height;if(this._rotated){var a=0===n?0:(t.x+.5)/n,o=0===n?0:(t.x+t.height-.5)/n,h=0===s?0:(t.y+.5)/s,l=0===s?0:(t.y+t.width-.5)/s;this._isFlipUVX&&this._isFlipUVY?(e[0]=o,e[1]=l,e[2]=o,e[3]=h,e[4]=a,e[5]=l,e[6]=a,e[7]=h):this._isFlipUVX?(e[0]=o,e[1]=h,e[2]=o,e[3]=l,e[4]=a,e[5]=h,e[6]=a,e[7]=l):this._isFlipUVY?(e[0]=a,e[1]=l,e[2]=a,e[3]=h,e[4]=o,e[5]=l,e[6]=o,e[7]=h):(e[0]=a,e[1]=h,e[2]=a,e[3]=l,e[4]=o,e[5]=h,e[6]=o,e[7]=l);var u=0===n?0:t.x/n,c=0===n?0:(t.x+t.height)/n,_=0===s?0:t.y/s,d=0===s?0:(t.y+t.width)/s;this._isFlipUVX&&this._isFlipUVY?(i[0]=c,i[1]=d,i[2]=c,i[3]=_,i[4]=u,i[5]=d,i[6]=u,i[7]=_):this._isFlipUVX?(i[0]=c,i[1]=_,i[2]=c,i[3]=d,i[4]=u,i[5]=_,i[6]=u,i[7]=d):this._isFlipUVY?(i[0]=u,i[1]=d,i[2]=u,i[3]=_,i[4]=c,i[5]=d,i[6]=c,i[7]=_):(i[0]=u,i[1]=_,i[2]=u,i[3]=d,i[4]=c,i[5]=_,i[6]=c,i[7]=d)}else{var p=0===n?0:(t.x+.5)/n,f=0===n?0:(t.x+t.width-.5)/n,m=0===s?0:(t.y+t.height-.5)/s,g=0===s?0:(t.y+.5)/s;this._isFlipUVX&&this._isFlipUVY?(e[0]=f,e[1]=g,e[2]=p,e[3]=g,e[4]=f,e[5]=m,e[6]=p,e[7]=m):this._isFlipUVX?(e[0]=f,e[1]=m,e[2]=p,e[3]=m,e[4]=f,e[5]=g,e[6]=p,e[7]=g):this._isFlipUVY?(e[0]=p,e[1]=g,e[2]=f,e[3]=g,e[4]=p,e[5]=m,e[6]=f,e[7]=m):(e[0]=p,e[1]=m,e[2]=f,e[3]=m,e[4]=p,e[5]=g,e[6]=f,e[7]=g);var v=0===n?0:t.x/n,y=0===n?0:(t.x+t.width)/n,T=0===s?0:(t.y+t.height)/s,E=0===s?0:t.y/s;this._isFlipUVX&&this._isFlipUVY?(i[0]=y,i[1]=E,i[2]=v,i[3]=E,i[4]=y,i[5]=T,i[6]=v,i[7]=T):this._isFlipUVX?(i[0]=y,i[1]=T,i[2]=v,i[3]=T,i[4]=y,i[5]=E,i[6]=v,i[7]=E):this._isFlipUVY?(i[0]=v,i[1]=E,i[2]=y,i[3]=E,i[4]=v,i[5]=T,i[6]=y,i[7]=T):(i[0]=v,i[1]=T,i[2]=y,i[3]=T,i[4]=v,i[5]=E,i[6]=y,i[7]=E)}for(var S="",b=0;b<e.length;b++)S+=e[b];this.uvHash=ou(S,666);var A=this.vertices;if(A){A.nu.length=0,A.nv.length=0;for(var C=0;C<A.u.length;C++)A.nu[C]=A.u[C]/n,A.nv[C]=A.v[C]/s}this._calculateSlicedUV()},i._serialize=function(){},i._deserialize=function(t){var e=t,i=e.rect;i&&(this._rect=new Ks(i.x,i.y,i.width,i.height));var r=e.offset;e.offset&&(this._offset=new Es(r.x,r.y));var n=e.originalSize;e.originalSize&&(this._originalSize=new Ys(n.width,n.height)),this._rotated=!!e.rotated,this._name=e.name;var s=e.capInsets;s&&(this._capInsets[0]=s[0],this._capInsets[1]=s[1],this._capInsets[2]=s[2],this._capInsets[3]=s[3]),this.vertices=e.vertices,this.vertices&&(this.vertices.nu=[],this.vertices.nv=[])},i.clone=function(){var t,i,r,n,s,a,o,h,l=new e,u=this.vertices;return l.vertices=u?{x:u.x,y:u.y,triangles:u.triangles,nu:null===(t=u.nu)||void 0===t?void 0:t.slice(0),u:null===(i=u.u)||void 0===i?void 0:i.slice(0),nv:null===(r=u.nv)||void 0===r?void 0:r.slice(0),v:null===(n=u.v)||void 0===n?void 0:n.slice(0)}:null,(s=l.uv).splice.apply(s,[0,l.uv.length].concat(this.uv)),l.uvHash=this.uvHash,(a=l.unbiasUV).splice.apply(a,[0,l.unbiasUV.length].concat(this.unbiasUV)),(o=l.uvSliced).splice.apply(o,[0,l.uvSliced.length].concat(this.uvSliced)),l._rect.set(this._rect),l._offset.set(this._offset),l._originalSize.set(this._originalSize),l._rotated=this._rotated,(h=l._capInsets).splice.apply(h,[0,l._capInsets.length].concat(this._capInsets)),l._atlasUuid=this._atlasUuid,l._texture=this._texture,l._isFlipUVX=this._isFlipUVX,l._isFlipUVY=this._isFlipUVY,l},i._textureLoaded=function(){var t=this._texture,e={},i=!1;0!==this._rect.width&&0!==this._rect.height&&this.checkRect(t)||(e.rect=new Ks(0,0,t.width,t.height),i=!0),(0===this._originalSize.width||0===this._originalSize.height||i)&&(e.originalSize=new Ys(t.width,t.height),i=!0),i&&(this.reset(e),this.onLoaded())},i._refreshTexture=function(t){this._texture=t,t.loaded?this._textureLoaded():t.once("load",this._textureLoaded,this)},e}(Sr))||jf);_.SpriteFrame=um,function(t){t[t.right=0]="right",t[t.left=1]="left",t[t.top=2]="top",t[t.bottom=3]="bottom",t[t.front=4]="front",t[t.back=5]="back"}(hm||(hm={}));var cm=t("TextureCube",Ne("cc.TextureCube")((om=am=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"_mipmaps",sm,a(e)),e}s(e,t),e.fromTexture2DArray=function(t,i){for(var r=[],n=t.length/6,s=0;s<n;s++){var a=6*s;r.push({front:t[a+hm.front].image,back:t[a+hm.back].image,left:t[a+hm.left].image,right:t[a+hm.right].image,top:t[a+hm.top].image,bottom:t[a+hm.bottom].image})}return(i=i||new e).mipmaps=r,i};var i=e.prototype;return i.onLoaded=function(){this.mipmaps=this._mipmaps,this.loaded=!0,this.emit("load")},i.reset=function(t){this._width=t.width,this._height=t.height,this._setGFXFormat(t.format),this._setMipmapLevel(t.mipmapLevel||1),this._tryReset()},i.updateMipmaps=function(t,e){var i=this;if(void 0===t&&(t=0),!(t>=this._mipmaps.length))for(var r=Math.min(void 0===e?this._mipmaps.length:e,this._mipmaps.length-t),n=function(e){var r=t+e;_m(i._mipmaps[r],(function(t,e){i._assignImage(t,r,e)}))},s=0;s<r;++s)n(s)},i.destroy=function(){return this._mipmaps=[],t.prototype.destroy.call(this)},i.releaseTexture=function(){this.mipmaps=[]},i._serialize=function(){},i._deserialize=function(e,i){var r=e;t.prototype._deserialize.call(this,r.base,i),this._mipmaps=new Array(r.mipmaps.length);for(var n=0;n<r.mipmaps.length;++n){this._mipmaps[n]={front:new Dd,back:new Dd,left:new Dd,right:new Dd,top:new Dd,bottom:new Dd};var s=r.mipmaps[n];i.result.push(this._mipmaps[n],"front",s.front),i.result.push(this._mipmaps[n],"back",s.back),i.result.push(this._mipmaps[n],"left",s.left),i.result.push(this._mipmaps[n],"right",s.right),i.result.push(this._mipmaps[n],"top",s.top),i.result.push(this._mipmaps[n],"bottom",s.bottom)}},i._getGfxTextureCreateInfo=function(t){var e=new Gu(vl.CUBE);return e.width=this._width,e.height=this._height,e.layerCount=6,Object.assign(e,t),e.flags=e.flags|El.CUBEMAP,e},r(e,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(t){var e=this;if(this._mipmaps=t,this._setMipmapLevel(this._mipmaps.length),this._mipmaps.length>0){var i=this._mipmaps[0].front;this.reset({width:i.width,height:i.height,format:i.format,mipmapLevel:this._mipmaps.length}),this._mipmaps.forEach((function(t,i){_m(t,(function(t,r){e._assignImage(t,i,r)}))}))}else this.reset({width:0,height:0,mipmapLevel:this._mipmaps.length})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(t){this.mipmaps=t?[t]:[]}}]),e}(dp),am.FaceIndex=hm,sm=u((nm=om).prototype,"_mipmaps",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),rm=nm))||rm);function _m(t,e){e(t.front,hm.front),e(t.back,hm.back),e(t.left,hm.left),e(t.right,hm.right),e(t.top,hm.top),e(t.bottom,hm.bottom)}_.TextureCube=cm;var dm=t("effects",[{name:"billboard",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"billboard|vert:vs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"billboard|vert:vs_main|tinted-fs:add",hash:2143664850,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"builtin",defines:[],binding:1,stageFlags:1,members:[{name:"cc_size_rotation",type:16,count:1}]},{name:"FragConstants",defines:[],binding:2,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:3}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:2}]}]},{name:"clear-stencil",techniques:[{passes:[{blendState:{targets:[{blend:!0}]},rasterizerState:{cullMode:0},program:"clear-stencil|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"clear-stencil|sprite-vs:vert|sprite-fs:frag",hash:1062464958,builtins:{globals:{blocks:[],samplers:[]},locals:{blocks:[],samplers:[]}},defines:[],blocks:[],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0}]}]},{name:"graphics",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:1,blendDst:4,blendSrcAlpha:1,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"graphics|vs:vert|fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"graphics|vs:vert|fs:frag",hash:3946667351,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[],blocks:[],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:1},{name:"a_dist",type:13,count:1,defines:[],stageFlags:1,format:11,location:2}]}]},{name:"particle-gpu",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle-gpu|particle-vs-gpu:gpvs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle-gpu|particle-vs-gpu:gpvs_main|tinted-fs:add",hash:3696836305,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"COLOR_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"ROTATION_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"SIZE_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"FORCE_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"VELOCITY_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"TEXTURE_ANIMATION_MODULE_ENABLE",type:"boolean"},{name:"CC_USE_WORLD_SPACE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"SampleConstants",defines:[],binding:1,stageFlags:1,members:[{name:"u_sampleInfo",type:16,count:1}]},{name:"TickConstants",defines:[],binding:2,stageFlags:1,members:[{name:"u_worldRot",type:16,count:1},{name:"u_timeDelta",type:16,count:1}]},{name:"ColorConstant",defines:["COLOR_OVER_TIME_MODULE_ENABLE"],binding:3,stageFlags:1,members:[{name:"u_color_mode",type:5,count:1}]},{name:"RotationConstant",defines:["ROTATION_OVER_TIME_MODULE_ENABLE"],binding:4,stageFlags:1,members:[{name:"u_rotation_mode",type:5,count:1}]},{name:"SizeConstant",defines:["SIZE_OVER_TIME_MODULE_ENABLE"],binding:5,stageFlags:1,members:[{name:"u_size_mode",type:5,count:1}]},{name:"ForceConstant",defines:["FORCE_OVER_TIME_MODULE_ENABLE"],binding:6,stageFlags:1,members:[{name:"u_force_mode",type:5,count:1},{name:"u_force_space",type:5,count:1}]},{name:"VelocityConstant",defines:["VELOCITY_OVER_TIME_MODULE_ENABLE"],binding:7,stageFlags:1,members:[{name:"u_velocity_mode",type:5,count:1},{name:"u_velocity_space",type:5,count:1}]},{name:"AnimationConstant",defines:["TEXTURE_ANIMATION_MODULE_ENABLE"],binding:8,stageFlags:1,members:[{name:"u_anim_info",type:16,count:1}]},{name:"FragConstants",defines:[],binding:9,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplers:[{name:"color_over_time_tex0",type:28,count:1,defines:["COLOR_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:10},{name:"rotation_over_time_tex0",type:28,count:1,defines:["ROTATION_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:11},{name:"size_over_time_tex0",type:28,count:1,defines:["SIZE_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:12},{name:"force_over_time_tex0",type:28,count:1,defines:["FORCE_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:13},{name:"velocity_over_time_tex0",type:28,count:1,defines:["VELOCITY_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:14},{name:"texture_animation_tex0",type:28,count:1,defines:["TEXTURE_ANIMATION_MODULE_ENABLE"],stageFlags:1,binding:15},{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:16}],attributes:[{name:"a_position_starttime",type:16,count:1,defines:[],stageFlags:1,format:44,location:0},{name:"a_size_uv",type:16,count:1,defines:[],stageFlags:1,format:44,location:1},{name:"a_rotation_uv",type:16,count:1,defines:[],stageFlags:1,format:44,location:2},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_dir_life",type:16,count:1,defines:[],stageFlags:1,format:44,location:4},{name:"a_rndSeed",type:13,count:1,defines:[],stageFlags:1,format:11,location:5},{name:"a_texCoord",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:6},{name:"a_texCoord3",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:7},{name:"a_normal",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:8},{name:"a_color1",type:16,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:44,location:9}]}]},{name:"particle-trail",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle-trail|particle-trail:vs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},frameTile_velLenScale:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle-trail|particle-trail:vs_main|tinted-fs:add",hash:4115155772,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"CC_DRAW_WIRE_FRAME",type:"boolean"},{name:"CC_USE_WORLD_SPACE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"FragConstants",defines:[],binding:1,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:16,count:1,defines:[],stageFlags:1,format:44,location:1},{name:"a_texCoord1",type:15,count:1,defines:[],stageFlags:1,format:32,location:2},{name:"a_texCoord2",type:15,count:1,defines:[],stageFlags:1,format:32,location:3},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:4}]}]},{name:"particle",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle|particle-vs-legacy:lpvs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle|particle-vs-legacy:lpvs_main|tinted-fs:add",hash:66662317,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"CC_USE_WORLD_SPACE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"FragConstants",defines:[],binding:1,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord1",type:15,count:1,defines:[],stageFlags:1,format:32,location:2},{name:"a_texCoord2",type:15,count:1,defines:[],stageFlags:1,format:32,location:3},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:4},{name:"a_color1",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:8},{name:"a_texCoord3",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:6},{name:"a_normal",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:7}]}]},{name:"spine-two-colored",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"spine-two-colored|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{alphaThreshold:{value:[.5],type:13}}}]}],shaders:[{name:"spine-two-colored|sprite-vs:vert|sprite-fs:frag",hash:3853945046,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:["USE_LOCAL"]}],samplers:[{name:"cc_spriteTexture",defines:["USE_TEXTURE"]}]}},defines:[{name:"USE_LOCAL",type:"boolean"},{name:"USE_PIXEL_ALIGNMENT",type:"boolean"},{name:"CC_USE_EMBEDDED_ALPHA",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"USE_TEXTURE",type:"boolean"},{name:"IS_GRAY",type:"boolean"}],blocks:[{name:"ALPHA_TEST_DATA",defines:["USE_ALPHA_TEST"],binding:0,stageFlags:16,members:[{name:"alphaThreshold",type:13,count:1}]}],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:2},{name:"a_color2",type:16,count:1,defines:[],stageFlags:1,format:44,location:3}]}]},{name:"sprite",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"sprite|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{alphaThreshold:{value:[.5],type:13}}}]}],shaders:[{name:"sprite|sprite-vs:vert|sprite-fs:frag",hash:3640649043,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:["USE_LOCAL"]}],samplers:[{name:"cc_spriteTexture",defines:["USE_TEXTURE"]}]}},defines:[{name:"USE_LOCAL",type:"boolean"},{name:"USE_PIXEL_ALIGNMENT",type:"boolean"},{name:"CC_USE_EMBEDDED_ALPHA",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"USE_TEXTURE",type:"boolean"},{name:"IS_GRAY",type:"boolean"}],blocks:[{name:"ALPHA_TEST_DATA",defines:["USE_ALPHA_TEST"],binding:0,stageFlags:16,members:[{name:"alphaThreshold",type:13,count:1}]}],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:2}]}]},{name:"standard",techniques:[{name:"opaque",passes:[{program:"standard|standard-vs:vert|standard-fs:frag",properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},occlusion:{value:[1],type:13,handleInfo:["pbrParams",0,13]},roughness:{value:[.8],type:13,handleInfo:["pbrParams",1,13]},metallic:{value:[.6],type:13,handleInfo:["pbrParams",2,13]},normalStrenth:{value:[1],type:13,handleInfo:["pbrParams",3,13]},emissive:{value:[0,0,0,1],type:16},emissiveScale:{value:[1,1,1],type:15,handleInfo:["emissiveScaleParam",0,15]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},normalMap:{value:"normal",type:28},pbrMap:{value:"grey",type:28},metallicRoughnessMap:{value:"grey",type:28},occlusionMap:{value:"white",type:28},emissiveMap:{value:"grey",type:28},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},pbrParams:{type:16,value:[1,.8,.6,1]},emissiveScaleParam:{type:16,value:[1,1,1,0]},albedoMap:{type:28,value:"grey"}}},{phase:"forward-add",propertyIndex:0,embeddedMacros:{CC_FORWARD_ADD:!0},blendState:{targets:[{blend:!0,blendSrc:1,blendDst:1,blendSrcAlpha:0,blendDstAlpha:1}]},program:"standard|standard-vs:vert|standard-fs:frag",depthStencilState:{depthFunc:2,depthTest:!0,depthWrite:!1},properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},occlusion:{value:[1],type:13,handleInfo:["pbrParams",0,13]},roughness:{value:[.8],type:13,handleInfo:["pbrParams",1,13]},metallic:{value:[.6],type:13,handleInfo:["pbrParams",2,13]},normalStrenth:{value:[1],type:13,handleInfo:["pbrParams",3,13]},emissive:{value:[0,0,0,1],type:16},emissiveScale:{value:[1,1,1],type:15,handleInfo:["emissiveScaleParam",0,15]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},normalMap:{value:"normal",type:28},pbrMap:{value:"grey",type:28},metallicRoughnessMap:{value:"grey",type:28},occlusionMap:{value:"white",type:28},emissiveMap:{value:"grey",type:28},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},pbrParams:{type:16,value:[1,.8,.6,1]},emissiveScaleParam:{type:16,value:[1,1,1,0]},albedoMap:{type:28,value:"grey"}}},{phase:"shadow-caster",propertyIndex:0,rasterizerState:{cullMode:1},program:"standard|shadow-caster-vs:vert|shadow-caster-fs:frag"}]}],shaders:[{name:"standard|standard-vs:vert|standard-fs:frag",hash:3835610303,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCShadow",defines:[]}],samplers:[{name:"cc_environment",defines:["CC_USE_IBL"]},{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]}]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]},{name:"CCForwardLight",defines:["CC_FORWARD_ADD"]}],samplers:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"cc_lightingMap",defines:["USE_LIGHTMAP","!USE_BATCHING","!CC_FORWARD_ADD"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_SUPPORT_FLOAT_TEXTURE",type:"boolean"},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"USE_VERTEX_COLOR",type:"boolean"},{name:"USE_NORMAL_MAP",type:"boolean"},{name:"HAS_SECOND_UV",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_ALBEDO_MAP",type:"boolean"},{name:"ALBEDO_UV",type:"string",options:["v_uv","v_uv1"]},{name:"NORMAL_UV",type:"string",options:["v_uv","v_uv1"]},{name:"PBR_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_PBR_MAP",type:"boolean"},{name:"USE_METALLIC_ROUGHNESS_MAP",type:"boolean"},{name:"USE_OCCLUSION_MAP",type:"boolean"},{name:"USE_EMISSIVE_MAP",type:"boolean"},{name:"EMISSIVE_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r"]}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:17,members:[{name:"tilingOffset",type:16,count:1},{name:"albedo",type:16,count:1},{name:"albedoScaleAndCutoff",type:16,count:1},{name:"pbrParams",type:16,count:1},{name:"emissive",type:16,count:1},{name:"emissiveScaleParam",type:16,count:1}]}],samplers:[{name:"albedoMap",type:28,count:1,defines:["USE_ALBEDO_MAP"],stageFlags:16,binding:1},{name:"normalMap",type:28,count:1,defines:["USE_NORMAL_MAP"],stageFlags:16,binding:2},{name:"pbrMap",type:28,count:1,defines:["USE_PBR_MAP"],stageFlags:16,binding:3},{name:"metallicRoughnessMap",type:28,count:1,defines:["USE_METALLIC_ROUGHNESS_MAP"],stageFlags:16,binding:4},{name:"occlusionMap",type:28,count:1,defines:["USE_OCCLUSION_MAP"],stageFlags:16,binding:5},{name:"emissiveMap",type:28,count:1,defines:["USE_EMISSIVE_MAP"],stageFlags:16,binding:6}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:12,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:42,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12},{name:"a_color",type:15,count:1,defines:["USE_VERTEX_COLOR"],stageFlags:1,format:32,location:13},{name:"a_texCoord1",type:14,count:1,defines:[],stageFlags:1,format:21,location:14}]},{name:"standard|shadow-caster-vs:vert|shadow-caster-fs:frag",hash:3020491,builtins:{globals:{blocks:[{name:"CCShadow",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplers:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_SUPPORT_FLOAT_TEXTURE",type:"boolean"},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"HAS_SECOND_UV",type:"boolean"},{name:"USE_ALBEDO_MAP",type:"boolean"},{name:"ALBEDO_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r"]}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:17,members:[{name:"tilingOffset",type:16,count:1},{name:"albedo",type:16,count:1},{name:"albedoScaleAndCutoff",type:16,count:1},{name:"pbrParams",type:16,count:1},{name:"emissive",type:16,count:1},{name:"emissiveScaleParam",type:16,count:1}]}],samplers:[{name:"albedoMap",type:28,count:1,defines:["USE_ALBEDO_MAP"],stageFlags:16,binding:1}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:12,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:42,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12},{name:"a_texCoord1",type:14,count:1,defines:[],stageFlags:1,format:21,location:13}]}]},{name:"terrain",techniques:[{name:"opaque",passes:[{program:"terrain|terrain-vs:vert|terrain-fs:frag",properties:{UVScale:{value:[1,1,1,1],type:16},lightMapUVParam:{value:[0,0,0,0],type:16},metallic:{value:[0,0,0,0],type:16},roughness:{value:[1,1,1,1],type:16},weightMap:{value:"black",type:28},detailMap0:{value:"grey",type:28},detailMap1:{value:"grey",type:28},detailMap2:{value:"grey",type:28},detailMap3:{value:"grey",type:28},normalMap0:{value:"normal-texture",type:28},normalMap1:{value:"normal-texture",type:28},normalMap2:{value:"normal-texture",type:28},normalMap3:{value:"normal-texture",type:28},lightMap:{value:"grey",type:28}}},{phase:"forward-add",propertyIndex:0,embeddedMacros:{CC_FORWARD_ADD:!0},blendState:{targets:[{blend:!0,blendSrc:1,blendDst:1,blendSrcAlpha:0,blendDstAlpha:1}]},program:"terrain|terrain-vs:vert|terrain-fs:frag",depthStencilState:{depthFunc:2,depthTest:!0,depthWrite:!1},properties:{UVScale:{value:[1,1,1,1],type:16},lightMapUVParam:{value:[0,0,0,0],type:16},metallic:{value:[0,0,0,0],type:16},roughness:{value:[1,1,1,1],type:16},weightMap:{value:"black",type:28},detailMap0:{value:"grey",type:28},detailMap1:{value:"grey",type:28},detailMap2:{value:"grey",type:28},detailMap3:{value:"grey",type:28},normalMap0:{value:"normal-texture",type:28},normalMap1:{value:"normal-texture",type:28},normalMap2:{value:"normal-texture",type:28},normalMap3:{value:"normal-texture",type:28},lightMap:{value:"grey",type:28}}},{phase:"shadow-add",propertyIndex:0,rasterizerState:{cullMode:2},program:"terrain|shadow-caster-vs:vert|shadow-caster-fs:frag"}]}],shaders:[{name:"terrain|terrain-vs:vert|terrain-fs:frag",hash:408884017,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCShadow",defines:[]}],samplers:[{name:"cc_environment",defines:["CC_USE_IBL"]},{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]}]},locals:{blocks:[{name:"CCLocal",defines:[]},{name:"CCForwardLight",defines:["CC_FORWARD_ADD"]}],samplers:[]}},defines:[{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"USE_NORMALMAP",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"LAYERS",type:"number",range:[0,4]},{name:"USE_PBR",type:"boolean"}],blocks:[{name:"TexCoords",defines:[],binding:0,stageFlags:1,members:[{name:"UVScale",type:16,count:1},{name:"lightMapUVParam",type:16,count:1}]},{name:"PbrParams",defines:[],binding:1,stageFlags:16,members:[{name:"metallic",type:16,count:1},{name:"roughness",type:16,count:1}]}],samplers:[{name:"weightMap",type:28,count:1,defines:[],stageFlags:16,binding:2},{name:"detailMap0",type:28,count:1,defines:[],stageFlags:16,binding:3},{name:"detailMap1",type:28,count:1,defines:[],stageFlags:16,binding:4},{name:"detailMap2",type:28,count:1,defines:[],stageFlags:16,binding:5},{name:"detailMap3",type:28,count:1,defines:[],stageFlags:16,binding:6},{name:"normalMap0",type:28,count:1,defines:[],stageFlags:16,binding:7},{name:"normalMap1",type:28,count:1,defines:[],stageFlags:16,binding:8},{name:"normalMap2",type:28,count:1,defines:[],stageFlags:16,binding:9},{name:"normalMap3",type:28,count:1,defines:[],stageFlags:16,binding:10},{name:"lightMap",type:28,count:1,defines:[],stageFlags:16,binding:11}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2}]},{name:"terrain|shadow-caster-vs:vert|shadow-caster-fs:frag",hash:3874167763,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCShadow",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[],blocks:[],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2}]}]},{name:"unlit",techniques:[{name:"opaque",passes:[{program:"unlit|unlit-vs:vert|unlit-fs:frag",properties:{mainTexture:{value:"grey",type:28},tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16},colorScale:{value:[1,1,1],type:15,handleInfo:["colorScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["colorScaleAndCutoff",3,13]},color:{type:16,handleInfo:["mainColor",0,16]},colorScaleAndCutoff:{type:16,value:[1,1,1,.5]}}}]}],shaders:[{name:"unlit|unlit-vs:vert|unlit-fs:frag",hash:3822871803,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplers:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_SUPPORT_FLOAT_TEXTURE",type:"boolean"},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"USE_VERTEX_COLOR",type:"boolean"},{name:"USE_TEXTURE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r","g","b"]}],blocks:[{name:"TexCoords",defines:["USE_TEXTURE"],binding:0,stageFlags:1,members:[{name:"tilingOffset",type:16,count:1}]},{name:"Constant",defines:[],binding:1,stageFlags:16,members:[{name:"mainColor",type:16,count:1},{name:"colorScaleAndCutoff",type:16,count:1}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:["USE_TEXTURE"],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:12,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:42,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12},{name:"a_color",type:16,count:1,defines:["USE_VERTEX_COLOR"],stageFlags:1,format:44,location:13}]}]},{name:"planar-shadow",techniques:[{passes:[{phase:"planarShadow",blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"planar-shadow|planar-shadow-vs:vert|planar-shadow-fs:frag",depthStencilState:{depthTest:!0,depthWrite:!1,stencilTestFront:!0,stencilFuncFront:5,stencilPassOpFront:2,stencilRefBack:128,stencilRefFront:128,stencilReadMaskBack:128,stencilReadMaskFront:128,stencilWriteMaskBack:128,stencilWriteMaskFront:128}}]}],shaders:[{name:"planar-shadow|planar-shadow-vs:vert|planar-shadow-fs:frag",hash:1840901952,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCShadow",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplers:[]}},defines:[{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:4},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:5},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:6},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:8}]}]},{name:"skybox",techniques:[{passes:[{rasterizerState:{cullMode:0},program:"skybox|sky-vs:vert|sky-fs:frag",priority:245,depthStencilState:{depthTest:!0,depthWrite:!1}}]}],shaders:[{name:"skybox|sky-vs:vert|sky-fs:frag",hash:2319917655,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]}],samplers:[{name:"cc_environment",defines:[]}]},locals:{blocks:[],samplers:[]}},defines:[{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_RGBE_CUBEMAP",type:"boolean"}],blocks:[],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3}]}]},{name:"profiler",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"profiler|profiler-vs:vert|profiler-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"profiler|profiler-vs:vert|profiler-fs:frag",hash:2029303284,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]}],samplers:[]},locals:{blocks:[],samplers:[]}},defines:[{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"offset",type:16,count:1}]},{name:"PerFrameInfo",defines:[],binding:1,stageFlags:1,members:[{name:"digits",type:16,count:20}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:1}]}]},{name:"splash-screen",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"splash-screen|splash-screen-vs:vert|splash-screen-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"splash-screen|splash-screen-vs:vert|splash-screen-fs:frag",hash:2106901053,builtins:{globals:{blocks:[],samplers:[]},locals:{blocks:[],samplers:[]}},defines:[],blocks:[{name:"splashFrag",defines:[],binding:0,stageFlags:16,members:[{name:"u_precent",type:13,count:1}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:1}],attributes:[{name:"a_position",type:14,count:1,defines:[],stageFlags:1,format:21,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1}]}]}]),pm=new Qu;function fm(t){return Math.ceil(Math.log2(Math.max(t,2)))}function mm(t,e){switch(t.type){case"boolean":return"number"==typeof e?e.toString():e?"1":"0";case"string":return void 0!==e?e:t.options[0];case"number":return void 0!==e?e.toString():t.range[0].toString();default:return console.warn("unknown define type '"+t.type+"'"),"-1"}}function gm(t,e,i,r,n){for(var s=t.builtins[r],a=[],o=function(t){var e=s.blocks[t],r=i.layouts[e.name],o=r&&i.bindings.find((function(t){return t.binding===r.binding}));if(!(r&&o&&o.descriptorType&Xu))return console.warn("builtin UBO '"+e.name+"' not available!"),"continue";a.push(r),n&&!n.includes(o)&&n.push(o)},h=0;h<s.blocks.length;h++)o(h);Array.prototype.unshift.apply(e.gfxBlocks,a);for(var l=[],u=function(t){var e=s.samplers[t],r=i.layouts[e.name],a=r&&i.bindings.find((function(t){return t.binding===r.binding}));if(!(r&&a&&a.descriptorType&Yu))return console.warn("builtin sampler '"+e.name+"' not available!"),"continue";l.push(r),n&&!n.includes(a)&&n.push(a)},c=0;c<s.samplers.length;c++)u(c);Array.prototype.unshift.apply(e.gfxSamplers,l),n&&n.sort((function(t,e){return t.binding-e.binding}))}function vm(t){return t.members.reduce((function(t,e){return t+Wl(e.type)*e.count}),0)}function ym(t,e){for(var i=0;i<t.length;i++){var r=t[i];if("!"===r[0]){if(e[r.slice(1)])return!1}else if(!e[r])return!1}return!0}function Tm(t){switch(t.gfxAPI){case Nl.GLES2:case Nl.WEBGL:return"glsl1";case Nl.GLES3:case Nl.WEBGL2:return"glsl3";default:return"glsl4"}}var Em=new(function(){function t(){this._localBindings={},this._templates={},this._cache={},this._templateInfos={}}var e=t.prototype;return e.register=function(t){for(var e=this._localBindings[t.name]=[],i=0;i<t.shaders.length;i++){var r=this.define(t.shaders[i]);r.effectName=t.name,gm(r,this._templateInfos[r.hash],Ep,"locals",e)}},e.define=function(t){var e=this._templates[t.name];if(e&&e.hash===t.hash)return e;for(var i=n({},t),r=0,s=function(t){var e=i.defines[t],n=1;if("number"===e.type){var s=e.range;n=fm(s[1]-s[0]+1),e._map=function(t){return t-s[0]}}else"string"===e.type?(n=fm(e.options.length),e._map=function(t){return Math.max(0,e.options.findIndex((function(e){return e===t})))}):"boolean"===e.type&&(e._map=function(t){return t?1:0});e._offset=r,r+=n},a=0;a<i.defines.length;a++)s(a);if(r>31&&(i.uber=!0),this._templates[t.name]=i,!this._templateInfos[i.hash]){var o={};o.samplerStartBinding=i.blocks.length,o.gfxBlocks=[],o.gfxSamplers=[],o.bindings=[],o.blockSizes=[];for(var h=0;h<i.blocks.length;h++){var l=i.blocks[h];o.blockSizes.push(vm(l)),o.bindings.push(new Zu(l.binding,l.descriptorType||bl.UNIFORM_BUFFER,1,l.stageFlags)),o.gfxBlocks.push(new Du(Cp.MATERIAL,l.binding,l.name,l.members.map((function(t){return new Fu(t.name,t.type,t.count)})),1))}for(var u=0;u<i.samplers.length;u++){var c=i.samplers[u];o.bindings.push(new Zu(c.binding,c.descriptorType||bl.SAMPLER,c.count,c.stageFlags)),o.gfxSamplers.push(new Uu(Cp.MATERIAL,c.binding,c.name,c.type,c.count))}o.gfxAttributes=[];for(var _=0;_<i.attributes.length;_++){var d=i.attributes[_];o.gfxAttributes.push(new hu(d.name,d.format,d.isNormalized,0,d.isInstanced,d.location))}o.gfxStages=[],o.gfxStages.push(new Lu(Sl.VERTEX,"")),o.gfxStages.push(new Lu(Sl.FRAGMENT,"")),o.handleMap=function(t){for(var e={},i=0;i<t.blocks.length;i++)for(var r=t.blocks[i],n=r.members,s=0,a=0;a<n.length;a++){var o=n[a];e[o.name]=Xf(Hf.UBO,Cp.MATERIAL,r.binding,o.type,s),s+=(Wl(o.type)>>2)*o.count}for(var h=0;h<t.samplers.length;h++){var l=t.samplers[h];e[l.name]=Xf(Hf.SAMPLER,Cp.MATERIAL,l.binding,l.type)}return e}(i),o.hPipelineLayout=0,o.setLayouts=[],this._templateInfos[i.hash]=o}return i},e.getTemplate=function(t){return this._templates[t]},e.getTemplateInfo=function(t){var e=this._templates[t].hash;return this._templateInfos[e]},e.getDescriptorSetLayout=function(t,e,i){void 0===i&&(i=!1);var r=this._templates[e],n=this._templateInfos[r.hash];return n.setLayouts.length||(pm.bindings=n.bindings,n.setLayouts[Cp.MATERIAL]=t.createDescriptorSetLayout(pm),pm.bindings=Ep.bindings,n.setLayouts[Cp.LOCAL]=t.createDescriptorSetLayout(pm)),n.setLayouts[i?Cp.LOCAL:Cp.MATERIAL]},e.hasProgram=function(t){return void 0!==this._templates[t]},e.getKey=function(t,e){var i=this._templates[t],r=i.defines;if(i.uber){for(var n="",s=0;s<r.length;s++){var a=r[s],o=e[a.name];if(o&&a._map){var h=a._map(o);n+=""+a._offset+h+"|"}}return""+n+i.hash}for(var l=0,u=0;u<r.length;u++){var c=r[u],_=e[c.name];_&&c._map&&(l|=c._map(_)<<c._offset)}return l.toString(16)+"|"+i.hash},e.destroyShaderByDefines=function(t){var e=this,i=Object.keys(t);if(i.length)for(var r=i.map((function(e){var i=t[e];return"boolean"==typeof i&&(i=i?"1":"0"),new RegExp(""+e+i)})),n=Object.keys(this._cache).filter((function(t){return r.every((function(i){return i.test(So.get(e._cache[t]).name)}))})),s=0;s<n.length;s++){var a=n[s],o=So.get(this._cache[a]);console.log("destroyed shader "+o.name),o.destroy(),delete this._cache[a]}},e.getGFXShader=function(t,e,i,r,n){Object.assign(i,r.macros),n||(n=this.getKey(e,i));var s=this._cache[n];if(s)return s;var a=this._templates[e],o=this._templateInfos[a.hash];o.hPipelineLayout||(this.getDescriptorSetLayout(t,e),gm(a,o,Tp,"globals"),o.setLayouts[Cp.GLOBAL]=r.descriptorSetLayout,o.hPipelineLayout=Co.alloc(t,new tc(o.setLayouts)));var h=function(t,e){for(var i=[],r=0;r<e.length;r++){var n=e[r],s=n.name,a=t[s],o=mm(n,a),h=!a||"0"===a;i.push({name:s,value:o,isDefault:h})}return i}(i,a.defines),l=h.reduce((function(t,e){return t+"#define "+e.name+" "+e.value+"\n"}),"")+"\n",u=a.glsl3,c=Tm(t);c?u=a[c]:console.error("Invalid GFX API!"),o.gfxStages[0].source=l+u.vert,o.gfxStages[1].source=l+u.frag;var _=function(t,e,i){for(var r=[],n=t.attributes,s=e.gfxAttributes,a=0;a<n.length;a++)ym(n[a].defines,i)&&r.push(s[a]);return r}(a,o,i),d=function(t,e){return t+e.reduce((function(t,e){return e.isDefault?t:t+"|"+e.name+e.value}),"")}(e,h),p=new ku(d,o.gfxStages,_,o.gfxBlocks,o.gfxSamplers);return this._cache[n]=So.alloc(t,p)},t}());_.programLib=Em;var Sm,bm,Am,Cm=function(){function t(){this._device=null,this._resources={}}var i=t.prototype;return i.initBuiltinRes=function(t){var i=this;this._device=t;var r=this._resources,n=document.createElement("canvas"),s=n.getContext("2d"),a=new Dd(n),o=n.width=n.height=2;s.fillStyle="#000",s.fillRect(0,0,o,o);var h=new pp;h._uuid="black-texture",h.image=a,r[h._uuid]=h,s.fillStyle="rgba(0,0,0,0)",s.fillRect(0,0,o,o);for(var l=new Uint8Array(16),u=0;u<l.length;++u)l[u]=0;var c=new pp;c._uuid="empty-texture",c.image=a,c.uploadData(l),r[c._uuid]=c;var d=new cm;d._uuid="black-cube-texture",d.setMipFilter(cm.Filter.NEAREST),d.image={front:new Dd(n),back:new Dd(n),left:new Dd(n),right:new Dd(n),top:new Dd(n),bottom:new Dd(n)},r[d._uuid]=d,s.fillStyle="#777",s.fillRect(0,0,o,o);var p=new pp;p._uuid="grey-texture",p.image=a,r[p._uuid]=p,s.fillStyle="#fff",s.fillRect(0,0,o,o);var f=new pp;f._uuid="white-texture",f.image=a,r[f._uuid]=f;var m=new cm;m._uuid="white-cube-texture",m.setMipFilter(cm.Filter.NEAREST),m.image={front:new Dd(n),back:new Dd(n),left:new Dd(n),right:new Dd(n),top:new Dd(n),bottom:new Dd(n)},r[m._uuid]=m,s.fillStyle="#7f7fff",s.fillRect(0,0,o,o);var g=new pp;g._uuid="normal-texture",g.image=a,r[g._uuid]=g,n.width=n.height=16,s.fillStyle="#ddd",s.fillRect(0,0,16,16),s.fillStyle="#555",s.fillRect(0,0,8,8),s.fillStyle="#555",s.fillRect(8,8,8,8);var v=new pp;v._uuid="default-texture",v.image=a,r[v._uuid]=v;var y=new cm;y.setMipFilter(cm.Filter.NEAREST),y._uuid="default-cube-texture",y.image={front:new Dd(n),back:new Dd(n),left:new Dd(n),right:new Dd(n),top:new Dd(n),bottom:new Dd(n)},r[y._uuid]=y;var T=new um,E=a._texture;T.texture=E,T._uuid="default-spriteframe",r[T._uuid]=T;var S=Tm(t);return S?function(t){switch(t){case"./shader-sources/glsl1.js":return e.import("./glsl1-c67f12b7.js");case"./shader-sources/glsl3.js":return e.import("./glsl3-37fe2e3c.js");case"./shader-sources/glsl4.js":return e.import("./glsl4-b50d187e.js");default:return e.import(t)}}("./shader-sources/"+S+".js").then((function(t){var e=t.default;dm.forEach((function(t,i){var r=Object.assign(new _.EffectAsset,t);r.shaders.forEach((function(t,r){var n=e[i][r];n&&(t[S]=n)})),r.hideInEditor=!0,r.onLoaded()})),i._initMaterials()})):Promise.reject(Error("Failed to initialize builtin shaders: unknown device."))},i.get=function(t){return this._resources[t]},i._initMaterials=function(){var t=this._resources,e=new _.Material;e._uuid="standard-material",e.initialize({effectName:"standard"}),t[e._uuid]=e;var i=new _.Material;i._uuid="missing-effect-material",i.initialize({effectName:"unlit",defines:{USE_COLOR:!0}}),i.setProperty("mainColor",_.color("#ffff00")),t[i._uuid]=i;var r=new _.Material;r._uuid="missing-material",r.initialize({effectName:"unlit",defines:{USE_COLOR:!0}}),r.setProperty("mainColor",_.color("#ff00ff")),t[r._uuid]=r;var n=new _.Material;n._uuid="default-clear-stencil",n.initialize({defines:{USE_TEXTURE:!1},effectName:"clear-stencil"}),t[n._uuid]=n;var s=new _.Material;s._uuid="ui-base-material",s.initialize({defines:{USE_TEXTURE:!1},effectName:"sprite"}),t[s._uuid]=s;var a=new _.Material;a._uuid="ui-sprite-material",a.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"sprite"}),t[a._uuid]=a;var o=new _.Material;o._uuid="ui-alpha-test-material",o.initialize({defines:{USE_TEXTURE:!0,USE_ALPHA_TEST:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"sprite"}),t[o._uuid]=o;var h=new _.Material;h._uuid="ui-sprite-gray-material",h.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!0},effectName:"sprite"}),t[h._uuid]=h;var l=new _.Material;l._uuid="ui-sprite-alpha-sep-material",l.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!0,IS_GRAY:!1},effectName:"sprite"}),t[l._uuid]=l;var u=new _.Material;u._uuid="ui-sprite-gray-alpha-sep-material",u.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!0,IS_GRAY:!0},effectName:"sprite"}),t[u._uuid]=u;var c=new _.Material;c._uuid="ui-graphics-material",c.initialize({effectName:"graphics"}),t[c._uuid]=c;var d=new _.Material;d._uuid="default-particle-material",d.initialize({effectName:"particle"}),t[d._uuid]=d;var p=new _.Material;p._uuid="default-particle-gpu-material",p.initialize({effectName:"particle-gpu"}),t[p._uuid]=p;var f=new _.Material;f._uuid="default-trail-material",f.initialize({effectName:"particle-trail"}),t[f._uuid]=f;var m=new _.Material;m._uuid="default-billboard-material",m.initialize({effectName:"billboard"}),t[m._uuid]=m;var g=new _.Material;g._uuid="ui-spine-two-colored-material",g.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!0,IS_GRAY:!1},effectName:"spine-two-colored"}),t[g._uuid]=g},t}(),wm=t("builtinResMgr",_.builtinResMgr=new Cm),Rm=t("getPhaseID",(Sm=new Map,bm=0,function(t){return"number"==typeof t?t:(Sm.has(t)||(Sm.set(t,1<<bm),bm++),Sm.get(t))})),xm=new Kl(rl.UNIFORM|rl.TRANSFER_DST,nl.HOST|nl.DEVICE),Om=new Zl(null),Im=new qu(null);!function(t){t[t.INSTANCING=1]="INSTANCING",t[t.VB_MERGING=2]="VB_MERGING"}(Am||(Am={}));var Mm=function(){function t(t){this._rootBuffer=null,this._rootBufferDirty=!1,this._buffers=[],this._descriptorSet=null,this._passIndex=0,this._propertyIndex=0,this._programName="",this._dynamics={},this._propertyHandleMap={},this._rootBlock=null,this._blocks=[],this._shaderInfo=null,this._defines={},this._properties={},this._root=void 0,this._device=void 0,this._hShaderDefault=0,this._handle=0,this._bs=new Su,this._dss=new Tu,this._rs=new yu,this._root=t,this._device=t.device}t.fillPipelineInfo=function(t,e){var i=t.handle;void 0!==e.priority&&Do.set(i,Eo.PRIORITY,e.priority),void 0!==e.primitive&&Do.set(i,Eo.PRIMITIVE,e.primitive),void 0!==e.stage&&Do.set(i,Eo.STAGE,e.stage),void 0!==e.dynamicStates&&Do.set(i,Eo.DYNAMIC_STATES,e.dynamicStates),void 0!==e.phase&&Do.set(i,Eo.PHASE,Rm(e.phase));var r=t._bs;if(e.blendState){var n=e.blendState,s=n.targets;s&&s.forEach((function(t,e){r.setTarget(e,t)})),void 0!==n.isA2C&&(r.isA2C=n.isA2C),void 0!==n.isIndepend&&(r.isIndepend=n.isIndepend),void 0!==n.blendColor&&(r.blendColor=n.blendColor)}t._rs.assign(e.rasterizerState),t._dss.assign(e.depthStencilState)},t.getPassHash=function(t,e){var i,r=t.handle,n=e+","+Do.get(r,Eo.PRIMITIVE)+","+Do.get(r,Eo.DYNAMIC_STATES);return n+=function(t){for(var e,i=",bs,"+t.isA2C,r=h(t.targets);!(e=r()).done;){var n=e.value;i+=",bt,"+n.blend+","+n.blendEq+","+n.blendAlphaEq+","+n.blendColorMask,i+=","+n.blendSrc+","+n.blendDst+","+n.blendSrcAlpha+","+n.blendDstAlpha}return i}(t._bs),n+=function(t){var e=",dss,"+t.depthTest+","+t.depthWrite+","+t.depthFunc;return e+=","+t.stencilTestFront+","+t.stencilFuncFront+","+t.stencilRefFront+","+t.stencilReadMaskFront,e+=","+t.stencilFailOpFront+","+t.stencilZFailOpFront+","+t.stencilPassOpFront+","+t.stencilWriteMaskFront,(e+=","+t.stencilTestBack+","+t.stencilFuncBack+","+t.stencilRefBack+","+t.stencilReadMaskBack)+","+t.stencilFailOpBack+","+t.stencilZFailOpBack+","+t.stencilPassOpBack+","+t.stencilWriteMaskBack}(t._dss),ou(n+=",rs,"+(i=t._rs).cullMode+","+i.depthBias+","+i.isFrontFaceCCW,666)};var e=t.prototype;return e.initialize=function(t){this._doInit(t),this.resetUBOs(),this.resetTextures(),this.tryCompile()},e.getHandle=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=el.UNKNOWN);var r=this._propertyHandleMap[t];return r?(i?r=Qf(r,i):e&&(r=Qf(r,qf(r)-e)),r+e):0},e.getBinding=function(e){var i=this.getHandle(e);return i?t.getBindingFromHandle(i):-1},e.setUniform=function(e,i){var r=t.getBindingFromHandle(e),n=t.getTypeFromHandle(e),s=t.getOffsetFromHandle(e),a=this._blocks[r];$f[n](a,i,s),this._rootBufferDirty=!0},e.getUniform=function(e,i){var r=t.getBindingFromHandle(e),n=t.getTypeFromHandle(e),s=t.getOffsetFromHandle(e),a=this._blocks[r];return Jf[n](a,i,s)},e.setUniformArray=function(e,i){for(var r=t.getBindingFromHandle(e),n=t.getTypeFromHandle(e),s=Wl(n)>>2,a=this._blocks[r],o=t.getOffsetFromHandle(e),h=0;h<i.length;h++,o+=s)null!==i[h]&&$f[n](a,i[h],o);this._rootBufferDirty=!0},e.bindTexture=function(t,e,i){this._descriptorSet.bindTexture(t,e,i||0)},e.bindSampler=function(t,e,i){this._descriptorSet.bindSampler(t,e,i||0)},e.setDynamicState=function(t,e){var i=this._dynamics[t];i&&i.value===e||(i.value=e,i.dirty=!0)},e.overridePipelineStates=function(){console.warn("base pass cannot override states, please use pass instance instead.")},e.update=function(){this._rootBufferDirty&&this._rootBuffer&&(this._rootBuffer.update(this._rootBlock),this._rootBufferDirty=!1),this._descriptorSet.update()},e.destroy=function(){for(var t=0;t<this._shaderInfo.blocks.length;t++){var e=this._shaderInfo.blocks[t];this._buffers[e.binding].destroy()}this._buffers=[],this._rootBuffer&&(this._rootBuffer.destroy(),this._rootBlock=null),this._descriptorSet=null,this._rs.destroy(),this._dss.destroy(),this._bs.destroy(),this._handle&&(bo.free(Do.get(this._handle,Eo.DESCRIPTOR_SET)),Do.free(this._handle),this._handle=0)},e.resetUniform=function(e){var i=this.getHandle(e);if(i){var r=t.getTypeFromHandle(i),n=t.getBindingFromHandle(i),s=t.getOffsetFromHandle(i),a=this._blocks[n],o=this._properties[e],h=o&&o.value||em(r);$f[r](a,h,s),this._rootBufferDirty=!0}},e.resetTexture=function(e,i){var r=this.getHandle(e);if(r){var n=t.getTypeFromHandle(r),s=t.getBindingFromHandle(r),a=this._properties[e],o=a&&a.value,h=o?o+"-texture":em(n),l=wm.get(h),u=l&&l.getGFXTexture(),c=a&&void 0!==a.samplerHash?a.samplerHash:l&&l.getSamplerHash(),_=ep.getSampler(this._device,c);this._descriptorSet.bindSampler(s,_,i),this._descriptorSet.bindTexture(s,u,i)}},e.resetUBOs=function(){for(var t=0;t<this._shaderInfo.blocks.length;t++)for(var e=this._shaderInfo.blocks[t],i=this._blocks[e.binding],r=0,n=0;n<e.members.length;n++){for(var s=e.members[n],a=this._properties[s.name],o=a&&a.value||em(s.type),h=(Wl(s.type)>>2)*s.count,l=0;l+o.length<=h;l+=o.length)i.set(o,r+l);r+=h}this._rootBufferDirty=!0},e.resetTextures=function(){for(var t=0;t<this._shaderInfo.samplers.length;t++)for(var e=this._shaderInfo.samplers[t],i=0;i<e.count;i++)this.resetTexture(e.name,i)},e.tryCompile=function(){var e=this._root.pipeline;return!!e&&(this._syncBatchingScheme(),this._hShaderDefault=Em.getGFXShader(this._device,this._programName,this._defines,e),this._hShaderDefault?(Do.set(this._handle,Eo.PIPELINE_LAYOUT,Em.getTemplateInfo(this._programName).hPipelineLayout),Do.set(this._handle,Eo.HASH,t.getPassHash(this,this._hShaderDefault)),!0):(console.warn("create shader "+this._programName+" failed"),!1))},e.getShaderVariant=function(t){if(void 0===t&&(t=null),!this._hShaderDefault&&!this.tryCompile())return console.warn("pass resources incomplete"),0;if(!t)return this._hShaderDefault;for(var e=this._root.pipeline,i=0;i<t.length;i++){var r=t[i];this._defines[r.name]=r.value}for(var n=Em.getGFXShader(this._device,this._programName,this._defines,e),s=0;s<t.length;s++){var a=t[s];delete this._defines[a.name]}return n},e.beginChangeStatesSilently=function(){},e.endChangeStatesSilently=function(){},e._doInit=function(e,i){void 0===i&&(i=!1);var r=this._handle=Do.alloc();Do.set(r,Eo.PRIORITY,mp.DEFAULT),Do.set(r,Eo.STAGE,fp.DEFAULT),Do.set(r,Eo.PHASE,Rm("default")),Do.set(r,Eo.PRIMITIVE,ol.TRIANGLE_LIST),Do.set(r,Eo.RASTERIZER_STATE,this._rs.handle),Do.set(r,Eo.DEPTH_STENCIL_STATE,this._dss.handle),Do.set(r,Eo.BLEND_STATE,this._bs.handle),this._passIndex=e.passIndex,this._propertyIndex=void 0!==e.propertyIndex?e.propertyIndex:e.passIndex,this._programName=e.program,this._defines=i?n({},e.defines):e.defines,this._shaderInfo=Em.getTemplate(e.program),this._properties=e.properties||this._properties;var s=this._device;t.fillPipelineInfo(this,e),e.stateOverrides&&t.fillPipelineInfo(this,e.stateOverrides),Im.layout=Em.getDescriptorSetLayout(this._device,e.program);var a=bo.alloc(this._device,Im);Do.set(this._handle,Eo.DESCRIPTOR_SET,a),this._descriptorSet=bo.get(a);for(var o=this._shaderInfo.blocks,h=Em.getTemplateInfo(e.program),l=h.blockSizes,u=h.handleMap,c=s.uboOffsetAlignment,_=[],d=0,p=0,f=0;f<o.length;f++){var m=l[f];_.push(p),p+=Math.ceil(m/c)*c,d=m}var g=_[_.length-1]+d;g&&(xm.size=16*Math.ceil(g/16),this._rootBuffer=s.createBuffer(xm),this._rootBlock=new ArrayBuffer(g));for(var v=0,y=0;v<o.length;v++){var T=o[v].binding,E=l[v];Om.buffer=this._rootBuffer,Om.offset=_[y++],Om.range=16*Math.ceil(E/16);var S=this._buffers[T]=s.createBuffer(Om);this._blocks[T]=new Float32Array(this._rootBlock,Om.offset,E/Float32Array.BYTES_PER_ELEMENT),this._descriptorSet.bindBuffer(T,S)}var b=this._propertyHandleMap=u,A={};for(var C in this._properties){var w=this._properties[C];w.handleInfo&&(A[C]=this.getHandle.apply(this,w.handleInfo))}Object.assign(b,A)},e._syncBatchingScheme=function(){this._defines.USE_INSTANCING?this._device.hasFeature(Fl.INSTANCED_ARRAYS)?Do.set(this._handle,Eo.BATCHING_SCHEME,Am.INSTANCING):(this._defines.USE_INSTANCING=!1,Do.set(this._handle,Eo.BATCHING_SCHEME,0)):this._defines.USE_BATCHING?Do.set(this._handle,Eo.BATCHING_SCHEME,Am.VB_MERGING):Do.set(this._handle,Eo.BATCHING_SCHEME,0)},r(t,[{key:"root",get:function(){return this._root}},{key:"device",get:function(){return this._device}},{key:"shaderInfo",get:function(){return this._shaderInfo}},{key:"localSetLayout",get:function(){return Em.getDescriptorSetLayout(this._device,this._programName,!0)}},{key:"program",get:function(){return this._programName}},{key:"properties",get:function(){return this._properties}},{key:"defines",get:function(){return this._defines}},{key:"passIndex",get:function(){return this._passIndex}},{key:"propertyIndex",get:function(){return this._propertyIndex}},{key:"dynamics",get:function(){return this._dynamics}},{key:"blocks",get:function(){return this._blocks}},{key:"handle",get:function(){return this._handle}},{key:"priority",get:function(){return Do.get(this._handle,Eo.PRIORITY)}},{key:"primitive",get:function(){return Do.get(this._handle,Eo.PRIMITIVE)}},{key:"stage",get:function(){return Do.get(this._handle,Eo.STAGE)}},{key:"phase",get:function(){return Do.get(this._handle,Eo.PHASE)}},{key:"rasterizerState",get:function(){return this._rs}},{key:"depthStencilState",get:function(){return this._dss}},{key:"blendState",get:function(){return this._bs}},{key:"dynamicStates",get:function(){return Do.get(this._handle,Eo.DYNAMIC_STATES)}},{key:"batchingScheme",get:function(){return Do.get(this._handle,Eo.BATCHING_SCHEME)}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"hash",get:function(){return Do.get(this._handle,Eo.HASH)}},{key:"rootBufferDirty",get:function(){return this._rootBufferDirty}}]),t}();function Bm(t){return--t,t|=t>>16,t|=t>>8,t|=t>>4,t|=t>>2,t|=t>>1,++t}function Pm(t,e){return Math.ceil(t/e)*e}Mm.PropertyType=Hf,Mm.getPropertyTypeFromHandle=Yf,Mm.getTypeFromHandle=qf,Mm.getBindingFromHandle=Kf,Mm.getOffsetFromHandle=Zf;var Nm,Lm,Fm,Dm,Um,km,zm,Gm,Hm,Vm,Wm,jm,Xm,Ym,qm,Km,Zm,Qm,Jm=function(){function t(t){this._device=void 0,this._format=il.UNKNOWN,this._formatSize=0,this._chunks=[],this._chunkCount=0,this._handles=[],this._region0=new vu,this._region1=new vu,this._region2=new vu,this._roundUpFn=null,this._bufferViewCtor=Uint8Array,this._channels=4,this._alignment=1,this._device=t}var e=t.prototype;return e.initialize=function(t){var e=zl[t.format];this._format=t.format,this._formatSize=e.size,this._channels=e.count,this._bufferViewCtor=jl(e),this._roundUpFn=t.roundUpFn||null,this._alignment=t.alignment||1,t.inOrderFree&&(this.alloc=this._McDonaldAlloc)},e.destroy=function(){for(var t=0;t<this._chunkCount;++t)this._chunks[t].texture.destroy();this._chunks.length=0,this._handles.length=0},e.alloc=function(t,e){t=Pm(t,this._alignment);var i=-1,r=-1;if(void 0!==e&&(i=e,r=this._findAvailableSpace(t,i)),r<0)for(var n=0;n<this._chunkCount&&(i=n,!((r=this._findAvailableSpace(t,i))>=0));++n);if(r>=0){var s=this._chunks[i];s.start+=t;var a={chunkIdx:i,start:r,end:r+t,texture:s.texture};return this._handles.push(a),a}var o=Math.sqrt(t/this._formatSize),h=this._roundUpFn&&this._roundUpFn(o,this._formatSize)||Math.max(1024,Bm(o)),l=this._chunks[this.createChunk(h)];l.start+=t;var u={chunkIdx:this._chunkCount-1,start:0,end:t,texture:l.texture};return this._handles.push(u),u},e.free=function(t){for(var e=0;e<this._handles.length;++e)if(this._handles[e]===t)return this._chunks[t.chunkIdx].end=t.end,void this._handles.splice(e,1)},e.createChunk=function(t){var e=t*t*this._formatSize;console.info("TextureBufferPool: Allocate chunk "+this._chunkCount+", size: "+e+", format: "+this._format);var i={texture:this._device.createTexture(new Gu(vl.TEX2D,yl.SAMPLED|yl.TRANSFER_DST,this._format,t,t)),size:e,start:0,end:e};return this._chunks[this._chunkCount]=i,this._chunkCount++},e.update=function(t,e){var i=[],r=[],n=t.start/this._formatSize,s=e.byteLength/this._formatSize,a=n%t.texture.width,o=Math.floor(n/t.texture.width),h=Math.min(t.texture.width-a,s),l=0;a>0&&(this._region0.texOffset.x=a,this._region0.texOffset.y=o,this._region0.texExtent.width=h,this._region0.texExtent.height=1,i.push(new this._bufferViewCtor(e,l*this._formatSize,h*this._channels)),r.push(this._region0),a=0,o+=1,s-=h,l+=h),s>0&&(this._region1.texOffset.x=a,this._region1.texOffset.y=o,s>t.texture.width?(this._region1.texExtent.width=t.texture.width,this._region1.texExtent.height=Math.floor(s/t.texture.width),h=this._region1.texExtent.width*this._region1.texExtent.height):(h=s,this._region1.texExtent.width=h,this._region1.texExtent.height=1),i.push(new this._bufferViewCtor(e,l*this._formatSize,h*this._channels)),r.push(this._region1),a=0,o+=this._region1.texExtent.height,s-=h,l+=h),s>0&&(this._region2.texOffset.x=a,this._region2.texOffset.y=o,this._region2.texExtent.width=s,this._region2.texExtent.height=1,i.push(new this._bufferViewCtor(e,l*this._formatSize,s*this._channels)),r.push(this._region2)),this._device.copyBuffersToTexture(i,t.texture,r)},e._findAvailableSpace=function(t,e){var i=this._chunks[e],r=!1,n=i.start;if(n+t<=i.size)r=!0;else{n=0;for(var s=this._handles.filter((function(t){return t.chunkIdx===e})).sort((function(t,e){return t.start-e.start})),a=0;a<s.length;a++){var o=s[a];if(n+t<=o.start){r=!0;break}n=o.end}!r&&n+t<=i.size&&(r=!0)}return r?n:-1},e._McDonaldAlloc=function(t){t=Pm(t,this._alignment);for(var e=0;e<this._chunkCount;++e){var i=this._chunks[e],r=!1,n=i.start;if(n+t<=i.end?r=!0:n>i.end?n+t<=i.size?r=!0:t<=i.end&&(i.start=n=0,r=!0):n===i.end&&(i.start=n=0,i.end=i.size,t<=i.end&&(r=!0)),r){i.start+=t;var s={chunkIdx:e,start:n,end:n+t,texture:i.texture};return this._handles.push(s),s}}var a=Math.sqrt(t/this._formatSize),o=this._roundUpFn&&this._roundUpFn(a,this._formatSize)||Math.max(1024,Bm(a)),h=this._chunks[this.createChunk(o)];h.start+=t;var l={chunkIdx:this._chunkCount,start:0,end:t,texture:h.texture};return this._handles.push(l),l},t}(),$m=t("EffectAsset",Ne("cc.EffectAsset")((Gm=zm=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"techniques",Fm,a(e)),l(e,"shaders",Dm,a(e)),l(e,"combinations",Um,a(e)),l(e,"hideInEditor",km,a(e)),e}s(e,t),e.register=function(t){e._effects[t.name]=t},e.remove=function(t){if(e._effects[t])delete e._effects[t];else for(var i in e._effects)if(e._effects[i]._uuid===t)return void delete e._effects[i]},e.get=function(t){if(e._effects[t])return e._effects[t];for(var i in e._effects)if(e._effects[i]._uuid===t)return e._effects[i];return null},e.getAll=function(){return e._effects};var i=e.prototype;return i.onLoaded=function(){Em.register(this),e.register(this),_.game.once(_.Game.EVENT_ENGINE_INITED,this._precompile,this)},i._precompile=function(){for(var t=this,e=_.director.root,i=function(i){var r=t.shaders[i],s=t.combinations[i];if(!s)return"continue";Object.keys(s).reduce((function(t,e){return t.reduce((function(t,i){var r=s[e],a=[i].concat([].concat(Array(r.length-1)).map((function(){return n({},i)})));return a.forEach((function(t,i){return t[e]=r[i]})),t.concat(a)}),[])}),[{}]).forEach((function(t){return Em.getGFXShader(e.device,r.name,t,e.pipeline)}))},r=0;r<this.shaders.length;r++)i(r)},i.destroy=function(){return e.remove(this.name),t.prototype.destroy.call(this)},e}(Sr),zm._effects={},Fm=u((Lm=Gm).prototype,"techniques",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Dm=u(Lm.prototype,"shaders",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Um=u(Lm.prototype,"combinations",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),km=u(Lm.prototype,"hideInEditor",[ke,Ge],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Nm=Lm))||Nm);_.EffectAsset=$m;var tg=new j("RenderTex"),eg=new xu;eg.endLayout=Rl.SHADER_READONLY_OPTIMAL;var ig,rg,ng,sg,ag,og,hg,lg,ug,cg,_g=new Ou,dg=new Mu([eg],_g),pg={width:1,height:1,renderPassInfo:dg},fg=t("RenderTexture",(Hm=Ne("cc.RenderTexture"),Vm=ei(),Wm=ii(),jm=ei(),Xm=ii(),Hm((Qm=function(t){function e(){var e;return l(e=t.call(this)||this,"_width",Km,a(e)),l(e,"_height",Zm,a(e)),e._textureHash=0,e._id=void 0,e._window=null,e._id=tg.getNewId(),e._textureHash=ou(e._id,666),e}s(e,t);var i=e.prototype;return i.getHash=function(){return this._textureHash},i.initialize=function(t){this._name=t.name||"",this._width=t.width,this._height=t.height,this._initWindow(t)},i.reset=function(t){this.initialize(t)},i.destroy=function(){return this._window&&(_.director.root.destroyWindow(this._window),this._window=null),t.prototype.destroy.call(this)},i.resize=function(t,e){this._width=t,this._height=e,this._window&&this._window.resize(t,e),this.emit("resize",this._window)},i.getGFXTexture=function(){return this._window&&this._window.framebuffer.colorTextures[0]},i.getGFXSampler=function(){var t=_.director.root;return ep.getSampler(t.device,kd)},i.getSamplerHash=function(){return kd},i.onLoaded=function(){this._initWindow(),this.loaded=!0,this.emit("load")},i._initWindow=function(t){var e=_.director.root;pg.title=this._name,pg.width=this._width,pg.height=this._height,pg.renderPassInfo=t&&t.passInfo?t.passInfo:dg,this._window?(this._window.destroy(),this._window.initialize(e.device,pg)):this._window=e.createWindow(pg)},r(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"window",get:function(){return this._window}}]),e}(Sr),Km=u((qm=Qm).prototype,"_width",[ke,Vm,Wm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Zm=u(qm.prototype,"_height",[ke,jm,Xm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Ym=qm))||Ym));_.RenderTexture=fg;var mg=t("Material",(ig=Ne("cc.Material"),rg=pi($m),ig((cg=function(t){function e(){var e;return l(e=t.call(this)||this,"_effectAsset",ag,a(e)),l(e,"_techIdx",og,a(e)),l(e,"_defines",hg,a(e)),l(e,"_states",lg,a(e)),l(e,"_props",ug,a(e)),e._passes=[],e._hash=0,e.loaded=!1,e}s(e,t),e.getHash=function(t){for(var e,i=0,r=h(t.passes);!(e=r()).done;)i^=e.value.hash;return i};var i=e.prototype;return i.initialize=function(t){this._defines||(this._defines=[]),this._states||(this._states=[]),this._props||(this._props=[]),void 0!==t.technique&&(this._techIdx=t.technique),t.effectAsset?this._effectAsset=t.effectAsset:t.effectName&&(this._effectAsset=$m.get(t.effectName)),t.defines&&this._prepareInfo(t.defines,this._defines),t.states&&this._prepareInfo(t.states,this._states),this._update()},i.reset=function(t){this.initialize(t)},i.destroy=function(){return this._doDestroy(),t.prototype.destroy.call(this)},i.recompileShaders=function(){console.warn("Shaders in material asset '"+this.name+"' cannot be modified at runtime, please instantiate the material first.")},i.overridePipelineStates=function(){console.warn("Pipeline states in material asset '"+this.name+"' cannot be modified at runtime, please instantiate the material first.")},i.onLoaded=function(){this._update(),this.loaded=!0,this.emit("load")},i.resetUniforms=function(t){void 0===t&&(t=!0),this._props.length=this._passes.length;for(var e=0;e<this._props.length;e++)this._props[e]={};if(t)for(var i,r=h(this._passes);!(i=r()).done;){var n=i.value;n.resetUBOs(),n.resetTextures()}},i.setProperty=function(t,e,i){var r=!1;if(void 0===i)for(var n=this._passes,s=n.length,a=0;a<s;a++){var o=n[a];this._uploadProperty(o,t,e)&&(this._props[o.propertyIndex][t]=e,r=!0)}else{if(i>=this._passes.length)return void console.warn("illegal pass index: "+i+".");var h=this._passes[i];this._uploadProperty(h,t,e)&&(this._props[h.propertyIndex][t]=e,r=!0)}r||console.warn("illegal property name: "+t+".")},i.getProperty=function(t,e){if(void 0===e)for(var i=this._props,r=i.length,n=0;n<r;n++){var s=i[n];if(t in s)return s[t]}else{if(e>=this._props.length)return console.warn("illegal pass index: "+e+"."),null;var a=this._props[this._passes[e].propertyIndex];if(t in a)return a[t]}return null},i.copy=function(t){this._techIdx=t._techIdx,this._props.length=t._props.length;for(var e=0;e<t._props.length;e++)this._props[e]=n({},t._props[e]);this._defines.length=t._defines.length;for(var i=0;i<t._defines.length;i++)this._defines[i]=n({},t._defines[i]);this._states.length=t._states.length;for(var r=0;r<t._states.length;r++)this._states[r]=n({},t._states[r]);this._effectAsset=t._effectAsset,this._update()},i._prepareInfo=function(t,e){var i=t;if(!Array.isArray(i)){var r=this._effectAsset?this._effectAsset.techniques[this._techIdx].passes.length:1;i=Array(r).fill(i)}for(var n=0;n<i.length;++n)Object.assign(e[n]||(e[n]={}),i[n])},i._createPasses=function(){var t=this._effectAsset.techniques[this._techIdx||0];if(!t)return[];for(var e=t.passes.length,i=[],r=0;r<e;++r){var n=t.passes[r],s=n.passIndex=r,a=n.defines=this._defines[s]||(this._defines[s]={}),o=n.stateOverrides=this._states[s]||(this._states[s]={});if(void 0!==n.propertyIndex&&(Object.assign(a,this._defines[n.propertyIndex]),Object.assign(o,this._states[n.propertyIndex])),void 0!==n.embeddedMacros&&Object.assign(a,n.embeddedMacros),!n.switch||a[n.switch]){var h=new Mm(_.director.root);h.initialize(n),i.push(h)}}return i},i._update=function(t){var i=this;if(void 0===t&&(t=!0),this._effectAsset){if(this._passes&&this._passes.length)for(var r,n=h(this._passes);!(r=n()).done;)r.value.destroy();this._passes=this._createPasses();var s=this._effectAsset.techniques[this._techIdx].passes.length;if(this._props.length=s,t)this._passes.forEach((function(t,e){var r=i._props[e];for(var n in r||(r=i._props[e]={}),r=i._props[t.propertyIndex])i._uploadProperty(t,n,r[n])}));else for(var a=0;a<this._props.length;a++)this._props[a]={}}else{var o=wm.get("missing-effect-material");o&&(this._passes=o._passes.slice())}this._hash=e.getHash(this)},i._uploadProperty=function(t,e,i){var r=t.getHandle(e);if(!r)return!1;var n=Mm.getPropertyTypeFromHandle(r);if(n===Hf.UBO)Array.isArray(i)?t.setUniformArray(r,i):null!==i?t.setUniform(r,i):t.resetUniform(e);else if(n===Hf.SAMPLER)if(Array.isArray(i))for(var s=0;s<i.length;s++)this._bindTexture(t,r,i[s],s);else i?this._bindTexture(t,r,i):t.resetTexture(e);return!0},i._bindTexture=function(t,e,i,r){var n=Mm.getBindingFromHandle(e);if(i instanceof Wu)t.bindTexture(n,i,r);else if(i instanceof np||i instanceof um||i instanceof fg){var s=i.getGFXTexture();if(!s||!s.width||!s.height)return;t.bindTexture(n,s,r),t.bindSampler(n,i.getGFXSampler(),r)}},i._doDestroy=function(){if(this._passes&&this._passes.length)for(var t,e=h(this._passes);!(t=e()).done;)t.value.destroy();this._effectAsset=null,this._passes.length=0,this._props.length=0,this._defines.length=0,this._states.length=0},r(e,[{key:"effectAsset",get:function(){return this._effectAsset}},{key:"effectName",get:function(){return this._effectAsset?this._effectAsset.name:""}},{key:"technique",get:function(){return this._techIdx}},{key:"passes",get:function(){return this._passes}},{key:"hash",get:function(){return this._hash}},{key:"parent",get:function(){return null}},{key:"owner",get:function(){return null}}]),e}(Sr),ag=u((sg=cg).prototype,"_effectAsset",[rg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),og=u(sg.prototype,"_techIdx",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hg=u(sg.prototype,"_defines",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lg=u(sg.prototype,"_states",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ug=u(sg.prototype,"_props",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ng=sg))||ng));_.Material=mg;var gg,vg,yg,Tg,Eg,Sg,bg,Ag,Cg,wg,Rg,xg,Og,Ig,Mg,Bg,Pg,Ng=function(t){function e(e,i){var r;(r=t.call(this,e.root)||this)._parent=void 0,r._owner=void 0,r._dontNotify=!1,r._parent=e,r._owner=i,r._doInit(r._parent,!0);for(var n=0;n<r._shaderInfo.blocks.length;n++){var s=r._shaderInfo.blocks[n],o=r._blocks[s.binding],h=r._parent.blocks[s.binding];o.set(h)}r._rootBufferDirty=!0;for(var l=r._parent,u=0;u<r._shaderInfo.samplers.length;u++)for(var c=r._shaderInfo.samplers[u],_=0;_<c.count;_++){var d=l._descriptorSet.getSampler(c.binding,_),p=l._descriptorSet.getTexture(c.binding,_);r._descriptorSet.bindSampler(c.binding,d,_),r._descriptorSet.bindTexture(c.binding,p,_)}return t.prototype.tryCompile.call(a(r)),r}s(e,t),r(e,[{key:"parent",get:function(){return this._parent}}]);var i=e.prototype;return i.overridePipelineStates=function(t,e){this._bs.reset(),this._rs.reset(),this._dss.reset(),Mm.fillPipelineInfo(this,t),Mm.fillPipelineInfo(this,e),this._onStateChange()},i.tryCompile=function(e){if(e&&!im(this._defines,e))return!1;var i=t.prototype.tryCompile.call(this);return this._onStateChange(),i},i.beginChangeStatesSilently=function(){this._dontNotify=!0},i.endChangeStatesSilently=function(){this._dontNotify=!1},i._syncBatchingScheme=function(){this._defines.USE_BATCHING=this._defines.USE_INSTANCING=!1,Do.set(this._handle,Eo.BATCHING_SCHEME,0)},i._onStateChange=function(){Do.set(this._handle,Eo.HASH,Mm.getPassHash(this,this._hShaderDefault)),this._owner.onPassStateChange(this._dontNotify)},e}(Mm),Lg=function(t){function e(e){var i;return(i=t.call(this)||this)._passes=[],i._parent=void 0,i._owner=void 0,i._subModelIdx=0,i._parent=e.parent,i._owner=e.owner||null,i._subModelIdx=e.subModelIdx||0,i.copy(i._parent),i}s(e,t),r(e,[{key:"parent",get:function(){return this._parent}},{key:"owner",get:function(){return this._owner}}]);var i=e.prototype;return i.recompileShaders=function(t,e){if(this._passes&&this.effectAsset)if(void 0===e)for(var i,r=h(this._passes);!(i=r()).done;)i.value.tryCompile(t);else this._passes[e].tryCompile(t)},i.overridePipelineStates=function(t,e){if(this._passes&&this.effectAsset){var i=this.effectAsset.techniques[this.technique].passes;if(void 0===e)for(var r=0;r<this._passes.length;r++){var n=this._passes[r],s=this._states[r]||(this._states[r]={});for(var a in t)s[a]=t[a];n.overridePipelineStates(i[n.passIndex],s)}else{var o=this._states[e]||(this._states[e]={});for(var h in t)o[h]=t[h];this._passes[e].overridePipelineStates(i[e],o)}}},i.destroy=function(){return this._doDestroy(),!0},i.onPassStateChange=function(t){this._hash=mg.getHash(this),!t&&this._owner&&this._owner._onRebuildPSO(this._subModelIdx,this)},i._createPasses=function(){var t=[],e=this._parent.passes;if(!e)return t;for(var i=0;i<e.length;++i)t.push(new Ng(e[i],this));return t},e}(mg);!function(t){t.TOUCH_START="touch-start",t.TOUCH_MOVE="touch-move",t.TOUCH_END="touch-end",t.TOUCH_CANCEL="touch-cancel",t.MOUSE_DOWN="mouse-down",t.MOUSE_MOVE="mouse-move",t.MOUSE_UP="mouse-up",t.MOUSE_WHEEL="mouse-wheel",t.MOUSE_ENTER="mouse-enter",t.MOUSE_LEAVE="mouse-leave",t.KEY_DOWN="keydown",t.KEY_UP="keyup",t.DEVICEMOTION="devicemotion",t.TRANSFORM_CHANGED="transform-changed",t.SCENE_CHANGED_FOR_PERSISTS="scene-changed-for-persists",t.SIZE_CHANGED="size-changed",t.ANCHOR_CHANGED="anchor-changed",t.COLOR_CHANGED="color-changed",t.CHILD_ADDED="child-added",t.CHILD_REMOVED="child-removed",t.PARENT_CHANGED="parent-changed",t.NODE_DESTROYED="node-destroyed",t.LAYER_CHANGED="layer-changed"}(gg||(gg=t("SystemEventType",{}))),Ft(gg),_.SystemEventType=gg;var Fg=new Es,Dg=new Es,Ug=new Hs,kg=new Hs,zg=new Hs,Gg=new Hs(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),Hg=new Ks,Vg=function(e){return t({UITransform:e,UITransformComponent:e}),e}((vg=Ne("cc.UITransform"),yg=qe(),Tg=Fe(110),Eg=We(),Sg=si(),bg=$e(),Ag=si(),Cg=$e(),wg=$e(),vg(Rg=yg(Rg=Tg(Rg=Eg(Rg=De(Rg=Ve((Pg=Bg=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"_priority",Og,a(e)),e._canvas=null,l(e,"_contentSize",Ig,a(e)),l(e,"_anchorPoint",Mg,a(e)),e}s(e,t);var i=e.prototype;return i.__preload=function(){this.node._uiProps.uiTransformComp=this},i.onEnable=function(){this._updateVisibility(),this.node.on(gg.PARENT_CHANGED,this._parentChanged,this),this._sortSiblings()},i.onDisable=function(){this.node.off(gg.PARENT_CHANGED,this._parentChanged,this),this._canvas=null},i.onDestroy=function(){this.node._uiProps.uiTransformComp=null},i.setContentSize=function(t,e){var i=this._contentSize;if(void 0===e){if((t=t).width===i.width&&t.height===i.height)return;i.width=t.width,i.height=t.height}else{if(t===i.width&&e===i.height)return;i.width=t,i.height=e}this.node.emit(gg.SIZE_CHANGED)},i.setAnchorPoint=function(t,e){var i=this._anchorPoint;if(void 0===e){if((t=t).x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e}this.node.emit(gg.ANCHOR_CHANGED,this._anchorPoint)},i.isHit=function(t,e){var i=this._contentSize.width,r=this._contentSize.height,n=Fg,s=Dg,a=this._canvas;if(a){a.node.getWorldRT(Ug);var o=Ug.m12,h=Ug.m13,l=_.visibleRect.center;if(Ug.m12=l.x-(Ug.m00*o+Ug.m04*h),Ug.m13=l.y-(Ug.m01*o+Ug.m05*h),Hs.invert(Ug,Ug),Es.transformMat4(n,t,Ug),this.node.getWorldMatrix(zg),Hs.invert(Ug,zg),Hs.strictEquals(Ug,Gg))return!1;if(Es.transformMat4(s,n,Ug),s.x+=this._anchorPoint.x*i,s.y+=this._anchorPoint.y*r,s.x>=0&&s.y>=0&&s.x<=i&&s.y<=r){if(e&&e.mask){for(var u=e.mask,c=this.node,d=0;c&&d<u.index;++d,c=c.parent);if(c===u.node){var p=c.getComponent(_.Mask);return!p||!p.enabledInHierarchy||p.isHit(n)}return e.mask=null,!0}return!0}return!1}},i.convertToNodeSpaceAR=function(t,e){return this.node.getWorldMatrix(zg),Hs.invert(Ug,zg),e||(e=new Cs),Cs.transformMat4(e,t,Ug)},i.convertToWorldSpaceAR=function(t,e){return this.node.getWorldMatrix(zg),e||(e=new Cs),Cs.transformMat4(e,t,zg)},i.getBoundingBox=function(){Hs.fromRTS(kg,this.node.getRotation(),this.node.getPosition(),this.node.getScale());var t=this._contentSize.width,e=this._contentSize.height,i=new Ks(-this._anchorPoint.x*t,-this._anchorPoint.y*e,t,e);return i.transformMat4(kg),i},i.getBoundingBoxToWorld=function(){return this.node.parent?(this.node.parent.getWorldMatrix(zg),this.getBoundingBoxTo(zg)):this.getBoundingBox()},i.getBoundingBoxTo=function(t){Hs.fromRTS(kg,this.node.getRotation(),this.node.getPosition(),this.node.getScale());var i=this._contentSize.width,r=this._contentSize.height,n=new Ks(-this._anchorPoint.x*i,-this._anchorPoint.y*r,i,r);if(Hs.multiply(zg,t,kg),n.transformMat4(zg),!this.node.children)return n;for(var s,a=h(this.node.children);!(s=a()).done;){var o=s.value;if(o&&o.active){var l=o.getComponent(e);if(l){var u=l.getBoundingBoxTo(t);u&&Ks.union(n,n,u)}}}return n},i.getComputeAABB=function(t){var e=this._contentSize.width,i=this._contentSize.height;Hg.set(-this._anchorPoint.x*e,-this._anchorPoint.y*i,e,i),Hg.transformMat4(this.node.worldMatrix);var r=Hg.x+.5*Hg.width,n=Hg.y+.5*Hg.height,s=this.node.worldPosition.z,a=Hg.width/2,o=Hg.height/2;if(null==t)return new y_(r,n,s,a,o,.001);y_.set(t,r,n,s,a,o,.001)},i._updateVisibility=function(){for(var t=this.node;t;){if(t){var e=t.getComponent("cc.Canvas");if(e){this._canvas=e;break}}t=t.parent}},i._parentChanged=function(){this._canvas&&this._canvas.node===this.node||this._sortSiblings()},i._sortSiblings=function(){var t=this.node.parent&&this.node.parent.children;t&&(t.sort((function(t,e){var i=t._uiProps.uiTransformComp,r=e._uiProps.uiTransformComp,n=(i?i.priority:0)-(r?r.priority:0);return 0===n?t.getSiblingIndex()-e.getSiblingIndex():n})),this.node.parent._updateSiblingIndex())},r(e,[{key:"contentSize",get:function(){return this._contentSize},set:function(t){this._contentSize.equals(t)||(this._contentSize.set(t),this.node.emit(gg.SIZE_CHANGED))}},{key:"width",get:function(){return this._contentSize.width},set:function(t){this._contentSize.width!==t&&(this._contentSize.width=t,this.node.emit(gg.SIZE_CHANGED))}},{key:"height",get:function(){return this._contentSize.height},set:function(t){this.contentSize.height!==t&&(this._contentSize.height=t,this.node.emit(gg.SIZE_CHANGED))}},{key:"anchorPoint",get:function(){return this._anchorPoint},set:function(t){this._anchorPoint.equals(t)||(this._anchorPoint.set(t),this.node.emit(gg.ANCHOR_CHANGED,this._anchorPoint))}},{key:"anchorX",get:function(){return this._anchorPoint.x},set:function(t){this._anchorPoint.x!==t&&(this._anchorPoint.x=t,this.node.emit(gg.ANCHOR_CHANGED,this._anchorPoint))}},{key:"anchorY",get:function(){return this._anchorPoint.y},set:function(t){this._anchorPoint.y!==t&&(this._anchorPoint.y=t,this.node.emit(gg.ANCHOR_CHANGED,this._anchorPoint))}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority!==t&&(this._canvas&&this._canvas.node===this.node?I(6706):(this._priority=t,this._sortSiblings()))}},{key:"visibility",get:function(){return this._canvas?this._canvas.visibility:-1}}]),e}(ds),Bg.EventType=gg,u((xg=Pg).prototype,"contentSize",[Sg,bg],Object.getOwnPropertyDescriptor(xg.prototype,"contentSize"),xg.prototype),u(xg.prototype,"anchorPoint",[Ag,Cg],Object.getOwnPropertyDescriptor(xg.prototype,"anchorPoint"),xg.prototype),u(xg.prototype,"priority",[wg],Object.getOwnPropertyDescriptor(xg.prototype,"priority"),xg.prototype),Og=u(xg.prototype,"_priority",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ig=u(xg.prototype,"_contentSize",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ys(100,100)}}),Mg=u(xg.prototype,"_anchorPoint",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Es(.5,.5)}}),Rg=xg))||Rg)||Rg)||Rg)||Rg)||Rg)||Rg)),Wg=function(){function t(t){this._uiComp=null,this.opacity=1,this._uiTransformComp=null,this._node=void 0,this._node=t}return r(t,[{key:"uiTransformComp",get:function(){return this._uiTransformComp||(this._uiTransformComp=this._node.getComponent(Vg)),this._uiTransformComp},set:function(t){this._uiTransformComp=t}},{key:"uiComp",get:function(){return this._uiComp},set:function(t){this._uiComp&&t?I(12002):this._uiComp=t}}]),t}(),jg=new Es,Xg=t("EventMouse",function(t){function e(i,r,n){var s;return(s=t.call(this,Gi.MOUSE,r)||this).movementX=0,s.movementY=0,s.eventType=void 0,s._button=e.BUTTON_MISSING,s._x=0,s._y=0,s._prevX=0,s._prevY=0,s._scrollX=0,s._scrollY=0,s.eventType=i,n&&(s._prevX=n.x,s._prevY=n.y),s}s(e,t);var i=e.prototype;return i.setScrollData=function(t,e){this._scrollX=t,this._scrollY=e},i.getScrollX=function(){return this._scrollX},i.getScrollY=function(){return this._scrollY},i.setLocation=function(t,e){this._x=t,this._y=e},i.getLocation=function(t){return t||(t=new Es),Es.set(t,this._x,this._y),t},i.getLocationInView=function(t){return t||(t=new Es),Es.set(t,this._x,_.view._designResolutionSize.height-this._y),t},i.getUILocation=function(t){return t||(t=new Es),Es.set(t,this._x,this._y),_.view._convertPointWithScale(t),t},i.getPreviousLocation=function(t){return t||(t=new Es),Es.set(t,this._prevX,this._prevY),t},i.getUIPreviousLocation=function(t){return t||(t=new Es),Es.set(t,this._prevX,this._prevY),_.view._convertPointWithScale(t),t},i.getDelta=function(t){return t||(t=new Es),Es.set(t,this._x-this._prevX,this._y-this._prevY),t},i.getDeltaX=function(){return this._x-this._prevX},i.getDeltaY=function(){return this._y-this._prevY},i.getUIDelta=function(t){return t||(t=new Es),Es.set(t,(this._x-this._prevX)/_.view.getScaleX(),(this._y-this._prevY)/_.view.getScaleY()),t},i.getUIDeltaX=function(){return(this._x-this._prevX)/_.view.getScaleX()},i.getUIDeltaY=function(){return(this._y-this._prevY)/_.view.getScaleY()},i.setButton=function(t){this._button=t},i.getButton=function(){return this._button},i.getLocationX=function(){return this._x},i.getLocationY=function(){return this._y},i.getUILocationX=function(){var t=_.view.getViewportRect();return(this._x-t.x)/_.view.getScaleX()},i.getUILocationY=function(){var t=_.view.getViewportRect();return(this._y-t.y)/_.view.getScaleY()},e}(Gi));Xg.NONE=0,Xg.DOWN=1,Xg.UP=2,Xg.MOVE=3,Xg.SCROLL=4,Xg.BUTTON_MISSING=-1,Xg.BUTTON_LEFT=0,Xg.BUTTON_RIGHT=2,Xg.BUTTON_MIDDLE=1,Xg.BUTTON_4=3,Xg.BUTTON_5=4,Xg.BUTTON_6=5,Xg.BUTTON_7=6,Xg.BUTTON_8=7;var Yg=t("EventTouch",function(t){function e(e,i,r,n){var s;return(s=t.call(this,Gi.TOUCH,i)||this).touch=null,s.simulate=!1,s._eventCode=void 0,s._touches=void 0,s._allTouches=void 0,s._eventCode=r||0,s._touches=e||[],s._allTouches=n||[],s}s(e,t);var i=e.prototype;return i.getEventCode=function(){return this._eventCode},i.getTouches=function(){return this._touches},i.getAllTouches=function(){return this._allTouches},i.setLocation=function(t,e){this.touch&&this.touch.setTouchInfo(this.touch.getID(),t,e)},i.getLocation=function(t){return this.touch?this.touch.getLocation(t):new Es},i.getUILocation=function(t){return this.touch?this.touch.getUILocation(t):new Es},i.getLocationInView=function(t){return this.touch?this.touch.getLocationInView(t):new Es},i.getPreviousLocation=function(t){return this.touch?this.touch.getPreviousLocation(t):new Es},i.getStartLocation=function(t){return this.touch?this.touch.getStartLocation(t):new Es},i.getUIStartLocation=function(t){return this.touch?this.touch.getUIStartLocation(t):new Es},i.getID=function(){return this.touch?this.touch.getID():null},i.getDelta=function(t){return this.touch?this.touch.getDelta(t):new Es},i.getUIDelta=function(t){return this.touch?this.touch.getUIDelta(t):new Es},i.getDeltaX=function(){return this.touch?this.touch.getDelta(jg).x:0},i.getDeltaY=function(){return this.touch?this.touch.getDelta(jg).y:0},i.getLocationX=function(){return this.touch?this.touch.getLocationX():0},i.getLocationY=function(){return this.touch?this.touch.getLocationY():0},e}(Gi));Yg.MAX_TOUCHES=5,Yg.BEGAN=0,Yg.MOVED=1,Yg.ENDED=2,Yg.CANCELLED=3;var qg=t("EventAcceleration",function(t){function e(e,i){var r;return(r=t.call(this,Gi.ACCELERATION,i)||this).acc=void 0,r.acc=e,r}return s(e,t),e}(Gi)),Kg=t("EventKeyboard",function(t){function e(e,i,r){var n;return(n=t.call(this,Gi.KEYBOARD,r)||this).keyCode=void 0,n.rawEvent=void 0,n.isPressed=void 0,"number"==typeof e?n.keyCode=e:(n.keyCode=e.keyCode,n.rawEvent=e),n.isPressed=i,n}return s(e,t),e}(Gi));Gi.EventMouse=Xg,Gi.EventTouch=Yg,Gi.EventAcceleration=qg,Gi.EventKeyboard=Kg;var Zg=function(){function t(t,e,i){this.owner=null,this.mask=null,this._previousIn=!1,this._target=null,this._onEvent=void 0,this._type=void 0,this._listenerID=void 0,this._registered=!1,this._fixedPriority=0,this._node=null,this._paused=!0,this._isEnabled=!0,this._onEvent=i,this._type=t||0,this._listenerID=e||""}t.create=function(t){L(t&&t.event,1900);var e=t.event;delete t.event;var i=null;if(e===_.EventListener.TOUCH_ONE_BY_ONE?i=new $g:e===_.EventListener.TOUCH_ALL_AT_ONCE?i=new tv:e===_.EventListener.MOUSE?i=new Jg:e===_.EventListener.KEYBOARD?i=new iv:e===_.EventListener.ACCELERATION&&(i=new ev(t.callback),delete t.callback),i)for(var r=0,n=Object.keys(t);r<n.length;r++){var s=n[r];i[s]=t[s]}return i},r(t,[{key:"onEvent",get:function(){return this._onEvent}}]);var e=t.prototype;return e._setPaused=function(t){this._paused=t},e._isPaused=function(){return this._paused},e._setRegistered=function(t){this._registered=t},e._isRegistered=function(){return this._registered},e._getType=function(){return this._type},e._getListenerID=function(){return this._listenerID},e._setFixedPriority=function(t){this._fixedPriority=t},e._getFixedPriority=function(){return this._fixedPriority},e._setSceneGraphPriority=function(t){this._target=t,this._node=t},e._getSceneGraphPriority=function(){return this._node},e.checkAvailable=function(){return null!==this._onEvent},e.clone=function(){return null},e.setEnabled=function(t){this._isEnabled=t},e.isEnabled=function(){return this._isEnabled},t}();Zg.UNKNOWN=0,Zg.TOUCH_ONE_BY_ONE=1,Zg.TOUCH_ALL_AT_ONCE=2,Zg.KEYBOARD=3,Zg.MOUSE=4,Zg.ACCELERATION=6,Zg.CUSTOM=8,Zg.ListenerID={MOUSE:"__cc_mouse",TOUCH_ONE_BY_ONE:"__cc_touch_one_by_one",TOUCH_ALL_AT_ONCE:"__cc_touch_all_at_once",KEYBOARD:"__cc_keyboard",ACCELERATION:"__cc_acceleration"};var Qg=Zg.ListenerID,Jg=function(t){function e(){var e;return(e=t.call(this,Zg.MOUSE,Qg.MOUSE,null)||this).onMouseDown=null,e.onMouseUp=null,e.onMouseMove=null,e.onMouseScroll=null,e._onEvent=function(t){return e._callback(t)},e}s(e,t);var i=e.prototype;return i._callback=function(t){var e=_.Event.EventMouse;switch(t.eventType){case e.DOWN:this.onMouseDown&&this.onMouseDown(t);break;case e.UP:this.onMouseUp&&this.onMouseUp(t);break;case e.MOVE:this.onMouseMove&&this.onMouseMove(t);break;case e.SCROLL:this.onMouseScroll&&this.onMouseScroll(t)}},i.clone=function(){var t=new e;return t.onMouseDown=this.onMouseDown,t.onMouseUp=this.onMouseUp,t.onMouseMove=this.onMouseMove,t.onMouseScroll=this.onMouseScroll,t},i.checkAvailable=function(){return!0},e}(Zg),$g=function(t){function e(){var e;return(e=t.call(this,Zg.TOUCH_ONE_BY_ONE,Qg.TOUCH_ONE_BY_ONE,null)||this).swallowTouches=!1,e.onTouchBegan=null,e.onTouchMoved=null,e.onTouchEnded=null,e.onTouchCancelled=null,e._claimedTouches=[],e}s(e,t);var i=e.prototype;return i.setSwallowTouches=function(t){this.swallowTouches=t},i.isSwallowTouches=function(){return this.swallowTouches},i.clone=function(){var t=new e;return t.onTouchBegan=this.onTouchBegan,t.onTouchMoved=this.onTouchMoved,t.onTouchEnded=this.onTouchEnded,t.onTouchCancelled=this.onTouchCancelled,t.swallowTouches=this.swallowTouches,t},i.checkAvailable=function(){return!!this.onTouchBegan||(x(1801),!1)},e}(Zg),tv=function(t){function e(){var e;return(e=t.call(this,Zg.TOUCH_ALL_AT_ONCE,Qg.TOUCH_ALL_AT_ONCE,null)||this).onTouchesBegan=null,e.onTouchesMoved=null,e.onTouchesEnded=null,e.onTouchesCancelled=null,e}s(e,t);var i=e.prototype;return i.clone=function(){var t=new e;return t.onTouchesBegan=this.onTouchesBegan,t.onTouchesMoved=this.onTouchesMoved,t.onTouchesEnded=this.onTouchesEnded,t.onTouchesCancelled=this.onTouchesCancelled,t},i.checkAvailable=function(){return null!==this.onTouchesBegan||null!==this.onTouchesMoved||null!==this.onTouchesEnded||null!==this.onTouchesCancelled||(x(1802),!1)},e}(Zg),ev=function(t){function e(e){var i;return(i=t.call(this,Zg.ACCELERATION,Qg.ACCELERATION,null)||this)._onAccelerationEvent=null,i._onEvent=function(t){return i._callback(t)},i._onAccelerationEvent=e,i}s(e,t);var i=e.prototype;return i._callback=function(t){this._onAccelerationEvent&&this._onAccelerationEvent(t.acc,t)},i.checkAvailable=function(){return L(this._onAccelerationEvent,1803),!0},i.clone=function(){return new e(this._onAccelerationEvent)},e}(Zg),iv=function(t){function e(){var e;return(e=t.call(this,Zg.KEYBOARD,Qg.KEYBOARD,null)||this).onKeyPressed=null,e.onKeyReleased=null,e._onEvent=function(t){return e._callback(t)},e}s(e,t);var i=e.prototype;return i._callback=function(t){t.isPressed?this.onKeyPressed&&this.onKeyPressed(t.keyCode,t):this.onKeyReleased&&this.onKeyReleased(t.keyCode,t)},i.clone=function(){var t=new e;return t.onKeyPressed=this.onKeyPressed,t.onKeyReleased=this.onKeyReleased,t},i.checkAvailable=function(){return null!==this.onKeyPressed||null!==this.onKeyReleased||(x(1800),!1)},e}(Zg);_.EventListener=Zg;var rv=Zg.ListenerID,nv=function(){function t(){this.gt0Index=0,this._fixedListeners=[],this._sceneGraphListeners=[]}var e=t.prototype;return e.size=function(){return this._fixedListeners.length+this._sceneGraphListeners.length},e.empty=function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},e.push=function(t){0===t._getFixedPriority()?this._sceneGraphListeners.push(t):this._fixedListeners.push(t)},e.clearSceneGraphListeners=function(){this._sceneGraphListeners.length=0},e.clearFixedListeners=function(){this._fixedListeners.length=0},e.clear=function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0},e.getFixedPriorityListeners=function(){return this._fixedListeners},e.getSceneGraphPriorityListeners=function(){return this._sceneGraphListeners},t}(),sv=function(){function t(){this._listenersMap={},this._priorityDirtyFlagMap={},this._nodeListenersMap={},this._toAddedListeners=[],this._toRemovedListeners=[],this._dirtyListeners=[],this._inDispatch=0,this._isEnabled=!1,this._internalCustomListenerIDs=[],this._currentTouch=null,this._currentTouchListener=null}var e=t.prototype;return e.pauseTarget=function(t,e){if(void 0===e&&(e=!1),t instanceof _._BaseNode){var i=this._nodeListenersMap[t.uuid];if(i)for(var r=0;r<i.length;++r)i[r]._setPaused(!0);if(!0===e){var n=t.children;if(n)for(var s=0;s<n.length;++s){var a=n[s];this.pauseTarget(a,!0)}}}else I(3506)},e.resumeTarget=function(t,e){if(void 0===e&&(e=!1),t instanceof _._BaseNode){var i=this._nodeListenersMap[t.uuid];if(i)for(var r=0;r<i.length;++r)i[r]._setPaused(!1);if(this._setDirtyForNode(t),!0===e&&t.children.length>0){var n=t.children;if(n)for(var s=0;s<n.length;++s){var a=n[s];this.resumeTarget(a,!0)}}}else I(3506)},e.frameUpdateListeners=function(){var t=this._listenersMap,e=this._priorityDirtyFlagMap;for(var i in t)t[i].empty()&&(delete e[i],delete t[i]);var r=this._toAddedListeners;if(0!==r.length){for(var n=0,s=r.length;n<s;n++)this._forceAddEventListener(r[n]);r.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()},e.hasEventListener=function(t){return!!this._getListeners(t)},e.addListener=function(t,e){if(L(t&&e,3503),_.js.isNumber(e)||e instanceof _._BaseNode){if(t instanceof _.EventListener){if(t._isRegistered())return void x(3505)}else L(!_.js.isNumber(e),3504),t=_.EventListener.create(t);if(t.checkAvailable()){if(_.js.isNumber(e)){if(0===e)return void x(3500);t._setSceneGraphPriority(null),t._setFixedPriority(e),t._setRegistered(!0),t._setPaused(!1),this._addListener(t)}else{if(!(i=e)||!i.getComponent("cc.UITransform"))return void x(3512);t._setSceneGraphPriority(e),t._setFixedPriority(0),t._setRegistered(!0),this._addListener(t)}var i;return t}}else I(3506)},e.addCustomListener=function(t,e){var i=Zg.create({event:_.EventListener.CUSTOM,eventName:t,callback:e});return this.addListener(i,1),i},e.removeListener=function(t){if(null!=t){var e=!1,i=this._listenersMap;for(var r in i){var n=i[r],s=n.getFixedPriorityListeners(),a=n.getSceneGraphPriorityListeners();if((e=this._removeListenerInVector(a,t))?this._setDirty(t._getListenerID(),2):(e=this._removeListenerInVector(s,t))&&this._setDirty(t._getListenerID(),1),n.empty()&&(delete this._priorityDirtyFlagMap[t._getListenerID()],delete i[r]),e)break}if(!e)for(var o=this._toAddedListeners,h=o.length-1;h>=0;h--){var l=o[h];if(l===t){_.js.array.removeAt(o,h),l._setRegistered(!1);break}}}},e.removeListeners=function(t,e){if(void 0===e&&(e=!1),_.js.isNumber(t)||t instanceof _._BaseNode)if(void 0!==t._id){var i=this._nodeListenersMap[t._id];if(i){for(var r=_.js.array.copy(i),n=0;n<r.length;++n){var s=r[n];this.removeListener(s)}delete this._nodeListenersMap[t._id]}for(var a=this._toAddedListeners,o=0;o<a.length;){var h=a[o];h._getSceneGraphPriority()===t?(h._setSceneGraphPriority(null),h._setRegistered(!1),a.splice(o,1)):++o}if(!0===e)for(var l=t.getChildren(),u=0;u<l.length;++u){var c=l[u];this.removeListeners(c,!0)}}else t===_.EventListener.TOUCH_ONE_BY_ONE?this._removeListenersForListenerID(rv.TOUCH_ONE_BY_ONE):t===_.EventListener.TOUCH_ALL_AT_ONCE?this._removeListenersForListenerID(rv.TOUCH_ALL_AT_ONCE):t===_.EventListener.MOUSE?this._removeListenersForListenerID(rv.MOUSE):t===_.EventListener.ACCELERATION?this._removeListenersForListenerID(rv.ACCELERATION):t===_.EventListener.KEYBOARD?this._removeListenersForListenerID(rv.KEYBOARD):x(3501);else I(3506)},e.removeCustomListeners=function(t){this._removeListenersForListenerID(t)},e.removeAllListeners=function(){var t=this._listenersMap,e=this._internalCustomListenerIDs;for(var i in t)-1===e.indexOf(i)&&this._removeListenersForListenerID(i)},e.setPriority=function(t,e){if(null!=t){var i=this._listenersMap;for(var r in i){var n=i[r].getFixedPriorityListeners();if(n&&-1!==n.indexOf(t))return null!=t._getSceneGraphPriority()&&x(3502),void(t._getFixedPriority()!==e&&(t._setFixedPriority(e),this._setDirty(t._getListenerID(),1)))}}},e.setEnabled=function(t){this._isEnabled=t},e.isEnabled=function(){return this._isEnabled},e.dispatchEvent=function(t){if(this._isEnabled)if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,t&&t.getType){if(t.getType().startsWith(_.Event.TOUCH))return this._dispatchTouchEvent(t),void this._inDispatch--;var e=function(t){var e=Gi,i=t.type;return i===e.ACCELERATION?rv.ACCELERATION:i===e.KEYBOARD?rv.KEYBOARD:i.startsWith(e.MOUSE)?rv.MOUSE:(i.startsWith(e.TOUCH)&&x(2e3),"")}(t);this._sortEventListeners(e);var i=this._listenersMap[e];null!=i&&(this._dispatchEventToListeners(i,this._onListenerCallback,t),this._onUpdateListeners(i)),this._inDispatch--}else B(3511)},e._onListenerCallback=function(t,e){e.currentTarget=t._target;var i=t.onEvent;return i&&i(e),e.isStopped()},e.dispatchCustomEvent=function(t,e){var i=new _.Event.EventCustom(t);i.setUserData(e),this.dispatchEvent(i)},e._setDirtyForNode=function(t){var e=this._nodeListenersMap[t._id];if(void 0!==e)for(var i=0,r=e.length;i<r;i++){var n=e[i]._getListenerID();null==this._dirtyListeners[n]&&(this._dirtyListeners[n]=!0)}if(t.children.length>0)for(var s=t.children,a=0,o=s?s.length:0;a<o;a++)this._setDirtyForNode(s[a])},e._addListener=function(t){0===this._inDispatch?this._forceAddEventListener(t):this._toAddedListeners.push(t)},e._forceAddEventListener=function(t){var e=t._getListenerID(),i=this._listenersMap[e];if(i||(i=new nv,this._listenersMap[e]=i),i.push(t),0===t._getFixedPriority()){this._setDirty(e,2);var r=t._getSceneGraphPriority();null===r&&x(3507),this._associateNodeAndEventListener(r,t),r.activeInHierarchy&&this.resumeTarget(r)}else this._setDirty(e,1)},e._getListeners=function(t){return this._listenersMap[t]},e._updateDirtyFlagForSceneGraph=function(){var t=this._dirtyListeners;for(var e in t)this._setDirty(e,2);this._dirtyListeners.length=0},e._removeAllListenersInVector=function(t){if(t)for(var e,i=t.length-1;i>=0;i--)(e=t[i])._setRegistered(!1),null!=e._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(e._getSceneGraphPriority(),e),e._setSceneGraphPriority(null)),0===this._inDispatch&&_.js.array.removeAt(t,i)},e._removeListenersForListenerID=function(t){var e=this._listenersMap[t];if(e){var i=e.getFixedPriorityListeners(),r=e.getSceneGraphPriorityListeners();this._removeAllListenersInVector(r),this._removeAllListenersInVector(i),delete this._priorityDirtyFlagMap[t],this._inDispatch||(e.clear(),delete this._listenersMap[t])}for(var n=this._toAddedListeners,s=n.length-1;s>=0;s--){var a=n[s];a&&a._getListenerID()===t&&_.js.array.removeAt(n,s)}},e._sortEventListeners=function(t){var e=0,i=this._priorityDirtyFlagMap;i[t]&&(e=i[t]),0!==e&&(i[t]=0,1&e&&this._sortListenersOfFixedPriority(t),2&e&&_.director.getScene()&&this._sortListenersOfSceneGraphPriority(t))},e._sortListenersOfSceneGraphPriority=function(t){var e=this._getListeners(t);if(e){var i=e.getSceneGraphPriorityListeners();i&&0!==i.length&&e.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes)}},e._sortEventListenersOfSceneGraphPriorityDes=function(t,e){var i=t._getSceneGraphPriority(),r=e._getSceneGraphPriority();if(!(e&&r&&r._activeInHierarchy&&r._uiProps.uiTransformComp))return-1;if(!(t&&i&&i._activeInHierarchy&&i._uiProps.uiTransformComp))return 1;var n=i,s=r,a=!1,o=i._uiProps.uiTransformComp,h=r._uiProps.uiTransformComp;if(o.visibility!==h.visibility)return h.visibility-o.visibility;for(;n.parent._id!==s.parent._id;)n=null===n.parent.parent?(a=!0)&&r:n.parent,s=null===s.parent.parent?(a=!0)&&i:s.parent;if(n._id===s._id){if(n._id===r._id)return-1;if(n._id===i._id)return 1}var l=n.getSiblingIndex(),u=s.getSiblingIndex();return a?l-u:u-l},e._sortListenersOfFixedPriority=function(t){var e=this._listenersMap[t];if(e){var i=e.getFixedPriorityListeners();if(i&&0!==i.length){i.sort(this._sortListenersOfFixedPriorityAsc);for(var r=0,n=i.length;r<n&&!(i[r]._getFixedPriority()>=0);)++r;e.gt0Index=r}}},e._sortListenersOfFixedPriorityAsc=function(t,e){return t._getFixedPriority()-e._getFixedPriority()},e._onUpdateListeners=function(t){var e=t.getFixedPriorityListeners(),i=t.getSceneGraphPriorityListeners(),r=this._toRemovedListeners;if(i)for(var n=i.length-1;n>=0;n--){var s=i[n];if(!s._isRegistered()){_.js.array.removeAt(i,n);var a=r.indexOf(s);-1!==a&&r.splice(a,1)}}if(e)for(var o=e.length-1;o>=0;o--){var h=e[o];if(!h._isRegistered()){_.js.array.removeAt(e,o);var l=r.indexOf(h);-1!==l&&r.splice(l,1)}}i&&0===i.length&&t.clearSceneGraphListeners(),e&&0===e.length&&t.clearFixedListeners()},e._updateTouchListeners=function(){var t=this._inDispatch;if(L(t>0,3508),!(t>1)){var e;(e=this._listenersMap[rv.TOUCH_ONE_BY_ONE])&&this._onUpdateListeners(e),(e=this._listenersMap[rv.TOUCH_ALL_AT_ONCE])&&this._onUpdateListeners(e),L(1===t,3509);var i=this._toAddedListeners;if(0!==i.length){for(var r=0,n=i.length;r<n;r++)this._forceAddEventListener(i[r]);this._toAddedListeners.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()}},e._cleanToRemovedListeners=function(){for(var t=this._toRemovedListeners,e=0;e<t.length;++e){var i=t[e],r=this._listenersMap[i._getListenerID()];if(r){var n=r.getFixedPriorityListeners(),s=r.getSceneGraphPriorityListeners();if(s){var a=s.indexOf(i);-1!==a&&s.splice(a,1)}if(n){var o=n.indexOf(i);-1!==o&&n.splice(o,1)}}}t.length=0},e._onTouchEventCallback=function(t,e){if(!t._isRegistered())return!1;var i=e.event,r=i.touch;i.currentTarget=t._getSceneGraphPriority();var n=!1,s=-1,a=i.getEventCode();if(a===Yg.BEGAN){if(!Ut.ENABLE_MULTI_TOUCH&&av._currentTouch){var o=av._currentTouchListener._node;if(!o||o.activeInHierarchy)return!1}t.onTouchBegan&&(n=t.onTouchBegan(r,i))&&t._isRegistered()&&(t._claimedTouches.push(r),!Ut.ENABLE_MULTI_TOUCH&&av._currentTouch||(av._currentTouch=r),av._currentTouchListener=t)}else if(t._claimedTouches.length>0&&-1!==(s=t._claimedTouches.indexOf(r))){if(n=!0,!Ut.ENABLE_MULTI_TOUCH&&av._currentTouch&&av._currentTouch!==r)return!1;a===Yg.MOVED&&t.onTouchMoved?t.onTouchMoved(r,i):a===Yg.ENDED?(t.onTouchEnded&&t.onTouchEnded(r,i),t._isRegistered()&&t._claimedTouches.splice(s,1),(Ut.ENABLE_MULTI_TOUCH||av._currentTouch===r)&&(av._currentTouch=null),av._currentTouchListener=null):a===Yg.CANCELLED&&(t.onTouchCancelled&&t.onTouchCancelled(r,i),t._isRegistered()&&t._claimedTouches.splice(s,1),(Ut.ENABLE_MULTI_TOUCH||av._currentTouch===r)&&(av._currentTouch=null),av._currentTouchListener=null)}return i.isStopped()?(av._updateTouchListeners(i),!0):!!(n&&t._isRegistered()&&t.swallowTouches)&&(e.needsMutableSet&&e.touches.splice(r,1),!0)},e._dispatchTouchEvent=function(t){this._sortEventListeners(rv.TOUCH_ONE_BY_ONE),this._sortEventListeners(rv.TOUCH_ALL_AT_ONCE);var e=this._getListeners(rv.TOUCH_ONE_BY_ONE),i=this._getListeners(rv.TOUCH_ALL_AT_ONCE);if(null!==e||null!==i){var r=t.getTouches(),n=_.js.array.copy(r),s={event:t,needsMutableSet:e&&i,touches:n,selTouch:null};if(e)for(var a=0;a<r.length;++a){var o=r[a];t.touch=o,t.propagationStopped=t.propagationImmediateStopped=!1,this._dispatchEventToListeners(e,this._onTouchEventCallback,s)}i&&n.length>0&&(this._dispatchEventToListeners(i,this._onTouchesEventCallback,{event:t,touches:n}),t.isStopped())||this._updateTouchListeners(t)}},e._onTouchesEventCallback=function(t,e){if(!t._isRegistered())return!1;var i=e.event,r=e.touches,n=i.getEventCode();return i.currentTarget=t._getSceneGraphPriority(),n===Yg.BEGAN&&t.onTouchesBegan?t.onTouchesBegan(r,i):n===Yg.MOVED&&t.onTouchesMoved?t.onTouchesMoved(r,i):n===Yg.ENDED&&t.onTouchesEnded?t.onTouchesEnded(r,i):n===Yg.CANCELLED&&t.onTouchesCancelled&&t.onTouchesCancelled(r,i),!!i.isStopped()&&(av._updateTouchListeners(i),!0)},e._associateNodeAndEventListener=function(t,e){var i=this._nodeListenersMap[t.uuid];i||(i=[],this._nodeListenersMap[t.uuid]=i),i.push(e)},e._dissociateNodeAndEventListener=function(t,e){var i=this._nodeListenersMap[t.uuid];i&&(_.js.array.remove(i,e),0===i.length&&delete this._nodeListenersMap[t.uuid])},e._dispatchEventToListeners=function(t,e,i){var r=!1,n=t.getFixedPriorityListeners(),s=t.getSceneGraphPriorityListeners(),a=0;if(n&&0!==n.length)for(;a<t.gt0Index;++a){var o=n[a];if(o.isEnabled()&&!o._isPaused()&&o._isRegistered()&&e(o,i)){r=!0;break}}if(s&&!r)for(var h=0;h<s.length;++h){var l=s[h];if(l.isEnabled()&&!l._isPaused()&&l._isRegistered()&&e(l,i)){r=!0;break}}if(n&&!r)for(;a<n.length;++a){var u=n[a];if(u.isEnabled()&&!u._isPaused()&&u._isRegistered()&&e(u,i)){r=!0;break}}},e._setDirty=function(t,e){var i=this._priorityDirtyFlagMap;null==i[t]?i[t]=e:i[t]=e|i[t]},e._sortNumberAsc=function(t,e){return t-e},e._removeListenerInCallback=function(t,e){if(null==t)return!1;for(var i=t.length-1;i>=0;i--){var r=t[i];if(r._onCustomEvent===e||r.onEvent===e)return r._setRegistered(!1),null!=r._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r),r._setSceneGraphPriority(null)),0===this._inDispatch?_.js.array.removeAt(t,i):this._toRemovedListeners.push(r),!0}return!1},e._removeListenerInVector=function(t,e){if(null==t)return!1;for(var i=t.length-1;i>=0;i--){var r=t[i];if(r===e)return r._setRegistered(!1),null!=r._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r),r._setSceneGraphPriority(null)),0===this._inDispatch?_.js.array.removeAt(t,i):this._toRemovedListeners.push(r),!0}return!1},t}(),av=t("eventManager",new sv);_.eventManager=av,Xi.Flags.Destroying;var ov=new Array(16),hv=null,lv=new Es,uv=[gg.TOUCH_START.toString(),gg.TOUCH_MOVE.toString(),gg.TOUCH_END.toString(),gg.TOUCH_CANCEL.toString()],cv=[gg.MOUSE_DOWN.toString(),gg.MOUSE_ENTER.toString(),gg.MOUSE_MOVE.toString(),gg.MOUSE_LEAVE.toString(),gg.MOUSE_UP.toString(),gg.MOUSE_WHEEL.toString()];function _v(t,e){var i=this.owner;return!(!i||!i._uiProps.uiTransformComp||(t.getUILocation(lv),!i._uiProps.uiTransformComp.isHit(lv,this)||(e.type=gg.TOUCH_START.toString(),e.touch=t,e.bubbles=!0,i.dispatchEvent(e),0)))}function dv(t,e){var i=this.owner;if(!i||!i._uiProps.uiTransformComp)return!1;e.type=gg.TOUCH_MOVE.toString(),e.touch=t,e.bubbles=!0,i.dispatchEvent(e)}function pv(t,e){var i=this.owner;i&&i._uiProps.uiTransformComp&&(t.getUILocation(lv),i._uiProps.uiTransformComp.isHit(lv,this)?e.type=gg.TOUCH_END.toString():e.type=gg.TOUCH_CANCEL.toString(),e.touch=t,e.bubbles=!0,i.dispatchEvent(e))}function fv(t,e){var i=this.owner;i&&i._uiProps.uiTransformComp&&(e.type=gg.TOUCH_CANCEL.toString(),e.touch=t,e.bubbles=!0,i.dispatchEvent(e))}function mv(t){var e=this.owner;e&&e._uiProps.uiTransformComp&&(lv=t.getUILocation(),e._uiProps.uiTransformComp.isHit(lv,this)&&(t.type=gg.MOUSE_DOWN.toString(),t.bubbles=!0,e.dispatchEvent(t)))}function gv(t){var e=this.owner;if(e&&e._uiProps.uiTransformComp){if(lv=t.getUILocation(),e._uiProps.uiTransformComp.isHit(lv,this))this._previousIn||(hv&&hv.eventProcessor.mouseListener&&(t.type=gg.MOUSE_LEAVE,hv.dispatchEvent(t),hv.eventProcessor.mouseListener&&(hv.eventProcessor.mouseListener._previousIn=!1)),hv=e,t.type=gg.MOUSE_ENTER.toString(),e.dispatchEvent(t),this._previousIn=!0),t.type=gg.MOUSE_MOVE.toString(),t.bubbles=!0,e.dispatchEvent(t);else{if(!this._previousIn)return;t.type=gg.MOUSE_LEAVE.toString(),e.dispatchEvent(t),this._previousIn=!1,hv=null}t.propagationStopped=!0}}function vv(t){var e=this.owner;e&&e._uiProps.uiTransformComp&&(lv=t.getUILocation(),e._uiProps.uiTransformComp.isHit(lv,this)&&(t.type=gg.MOUSE_UP.toString(),t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0))}function yv(t){var e=this.owner;e&&e._uiProps.uiTransformComp&&(lv=t.getUILocation(),e._uiProps.uiTransformComp.isHit(lv,this)&&(t.type=gg.MOUSE_WHEEL.toString(),t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0))}function Tv(t){var e=_.Mask;if(e)for(var i=0,r=t;r&&_.Node.isNode(r);r=r.parent,++i)if(r.getComponent(e))return{index:i,node:r};return null}function Ev(t,e){if(!t._persistNode){if(t.eventProcessor.bubblingTargets)for(var i=0;i<e.length;++i)if(t.eventProcessor.bubblingTargets.hasEventListener(e[i]))return!0;if(t.eventProcessor.capturingTargets)for(var r=0;r<e.length;++r)if(t.eventProcessor.capturingTargets.hasEventListener(e[r]))return!0;return!1}return!0}var Sv,bv,Av,Cv,wv,Rv,xv,Ov,Iv,Mv=function(){function t(t){this.bubblingTargets=null,this.capturingTargets=null,this.touchListener=null,this.mouseListener=null,this._node=void 0,this._node=t}r(t,[{key:"node",get:function(){return this._node}}]);var e=t.prototype;return e.reattach=function(){if(this.touchListener){var t=this.touchListener.mask=Tv(this._node);this.mouseListener&&(this.mouseListener.mask=t)}else this.mouseListener&&(this.mouseListener.mask=Tv(this._node))},e.destroy=function(){hv===this._node&&(hv=null),(this.touchListener||this.mouseListener)&&(av.removeListeners(this._node),this.touchListener&&(this.touchListener.owner=null,this.touchListener.mask=null,this.touchListener=null),this.mouseListener&&(this.mouseListener.owner=null,this.mouseListener.mask=null,this.mouseListener=null)),this.capturingTargets&&this.capturingTargets.clear(),this.bubblingTargets&&this.bubblingTargets.clear()},e.on=function(t,e,i,r){return this._checknSetupSysEvent(t)?this._onDispatch(t,e,i,r):(this.bubblingTargets||(this.bubblingTargets=new er),this.bubblingTargets.on(t,e,i))},e.once=function(t,e,i,r){var n,s=this;(n=this._checknSetupSysEvent(t)&&r?this.capturingTargets=this.capturingTargets||new er:this.bubblingTargets=this.bubblingTargets||new er).on(t,e,i,!0),n.on(t,(function(){s.off(t,e,i)}),void 0,!0)},e.off=function(t,e,i,r){var n=-1!==uv.indexOf(t),s=!n&&-1!==cv.indexOf(t);n||s?(this._offDispatch(t,e,i,r),n?this.touchListener&&!Ev(this._node,uv)&&(av.removeListener(this.touchListener),this.touchListener=null):s&&this.mouseListener&&!Ev(this._node,cv)&&(av.removeListener(this.mouseListener),this.mouseListener=null)):this.bubblingTargets&&this.bubblingTargets.off(t,e,i)},e.emit=function(t,e,i,r,n,s){this.bubblingTargets&&this.bubblingTargets.emit(t,e,i,r,n,s)},e.dispatchEvent=function(t){!function(t,e){var i,r=0;for(e.target=t,ov.length=0,t.eventProcessor.getCapturingTargets(e.type,ov),e.eventPhase=1,r=ov.length-1;r>=0;--r)if((i=ov[r]).eventProcessor.capturingTargets&&(e.currentTarget=i,i.eventProcessor.capturingTargets.emit(e.type,e,ov),e.propagationStopped))return void(ov.length=0);if(ov.length=0,e.eventPhase=2,e.currentTarget=t,t.eventProcessor.capturingTargets&&t.eventProcessor.capturingTargets.emit(e.type,e),!e.propagationImmediateStopped&&t.eventProcessor.bubblingTargets&&t.eventProcessor.bubblingTargets.emit(e.type,e),!e.propagationStopped&&e.bubbles)for(t.eventProcessor.getBubblingTargets(e.type,ov),e.eventPhase=3,r=0;r<ov.length;++r)if((i=ov[r]).eventProcessor.bubblingTargets&&(e.currentTarget=i,i.eventProcessor.bubblingTargets.emit(e.type,e),e.propagationStopped))return void(ov.length=0);ov.length=0}(this._node,t),ov.length=0},e.hasEventListener=function(t,e,i){var r=!1;return this.bubblingTargets&&(r=this.bubblingTargets.hasEventListener(t,e,i)),!r&&this.capturingTargets&&(r=this.capturingTargets.hasEventListener(t,e,i)),r},e.targetOff=function(t){this.capturingTargets&&this.capturingTargets.removeAll(t),this.bubblingTargets&&this.bubblingTargets.removeAll(t),this.touchListener&&!Ev(this.node,uv)&&(av.removeListener(this.touchListener),this.touchListener=null),this.mouseListener&&!Ev(this.node,cv)&&(av.removeListener(this.mouseListener),this.mouseListener=null)},e.getCapturingTargets=function(t,e){for(var i=this._node.parent;i;)i.eventProcessor.capturingTargets&&i.eventProcessor.capturingTargets.hasEventListener(t)&&e.push(i),i=i.parent},e.getBubblingTargets=function(t,e){for(var i=this._node.parent;i;)i.eventProcessor.bubblingTargets&&i.eventProcessor.bubblingTargets.hasEventListener(t)&&e.push(i),i=i.parent},e._checknSetupSysEvent=function(t){var e=this,i=!1,r=!1;return-1!==uv.indexOf(t)?(this.touchListener||(this.touchListener=_.EventListener.create({event:_.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,owner:this._node,mask:Tv(this._node),onTouchBegan:_v,onTouchMoved:dv,onTouchEnded:pv,onTouchCancelled:fv}),av.addListener(this.touchListener,this._node),i=!0),r=!0):-1!==cv.indexOf(t)&&(this.mouseListener||(this.mouseListener=_.EventListener.create({event:_.EventListener.MOUSE,_previousIn:!1,owner:this._node,mask:Tv(this._node),onMouseDown:mv,onMouseMove:gv,onMouseUp:vv,onMouseScroll:yv}),av.addListener(this.mouseListener,this._node),i=!0),r=!0),i&&!this._node.activeInHierarchy&&_.director.getScheduler().schedule((function(){e._node.activeInHierarchy||av.pauseTarget(e._node)}),this._node,0,0,0,!1),r},e._onDispatch=function(t,e,i,r){if("boolean"==typeof i?(r=i,i=void 0):r=!!r,e){var n=null;return(n=r?this.capturingTargets=this.capturingTargets||new er:this.bubblingTargets=this.bubblingTargets||new er).hasEventListener(t,e,i)||n.on(t,e,i),e}B(6800)},e._offDispatch=function(t,e,i,r){if("boolean"==typeof i?(r=i,i=void 0):r=!!r,e){var n=r?this.capturingTargets:this.bubblingTargets;n&&n.off(t,e,i)}else this.capturingTargets&&this.capturingTargets.removeAll(t),this.bubblingTargets&&this.bubblingTargets.removeAll(t)},t}();_.NodeEventProcessor=Mv;var Bv=Xi.Flags.Destroying,Pv=Xi.Flags.DontDestroy,Nv=Xi.Flags.Deactivating,Lv=(Xi.Flags.Activating,new j("Node"));function Fv(t){return t?"string"==typeof t?Rt(t):t:(B(3804),null)}var Dv,Uv,kv,zv,Gv,Hv,Vv,Wv,jv,Xv,Yv,qv,Kv,Zv=t("BaseNode",Ne("cc.BaseNode")((Iv=Ov=function(t){function e(e){var i;return l(i=t.call(this,e)||this,"_parent",Av,a(i)),l(i,"_children",Cv,a(i)),l(i,"_active",wv,a(i)),l(i,"_components",Rv,a(i)),l(i,"_prefab",xv,a(i)),i._scene=null,i._activeInHierarchy=!1,i._id=Lv.getNewId(),i._name=void 0,i._eventProcessor=new Mv(a(i)),i._eventMask=0,i._siblingIndex=0,i._registerIfAttached=void 0,i._name=void 0!==e?e:"New Node",i}s(e,t),e._setScene=function(t){t instanceof _.Scene?t._scene=t:null==t._parent?S("Node %s(%s) has not attached to a scene.",t.name,t.uuid):t._scene=t._parent._scene},e._findComponent=function(t,e){var i=e,r=t._components;if(i._sealed)for(var n=0;n<r.length;++n){var s=r[n];if(s.constructor===e)return s}else for(var a=0;a<r.length;++a){var o=r[a];if(o instanceof e)return o}return null},e._findComponents=function(t,e,i){var r=e,n=t._components;if(r._sealed)for(var s=0;s<n.length;++s){var a=n[s];a.constructor===e&&i.push(a)}else for(var o=0;o<n.length;++o){var h=n[o];h instanceof e&&i.push(h)}},e._findChildComponent=function(t,i){for(var r=0;r<t.length;++r){var n=t[r],s=e._findComponent(n,i);if(s)return s;if(n._children.length>0&&(s=e._findChildComponent(n._children,i)))return s}return null},e._findChildComponents=function(t,i,r){for(var n=0;n<t.length;++n){var s=t[n];e._findComponents(s,i,r),s._children.length>0&&e._findChildComponents(s._children,i,r)}},r(e,[{key:"components",get:function(){return this._components}},{key:"_persistNode",get:function(){return(this._objFlags&Pv)>0},set:function(t){t?this._objFlags|=Pv:this._objFlags&=~Pv}},{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"uuid",get:function(){return this._id}},{key:"children",get:function(){return this._children}},{key:"active",get:function(){return this._active},set:function(t){if(this._active!==t){this._active=t;var e=this._parent;e&&e._activeInHierarchy&&_.director._nodeActivator.activateNode(this,t)}}},{key:"activeInHierarchy",get:function(){return this._activeInHierarchy}},{key:"parent",get:function(){return this._parent},set:function(t){this.setParent(t)}},{key:"scene",get:function(){return this._scene}},{key:"eventProcessor",get:function(){return this._eventProcessor}}]);var i=e.prototype;return i.attr=function(t){dt(this,t)},i.getParent=function(){return this._parent},i.setParent=function(t,e){if(void 0===e&&(e=!1),this._parent!==t){var i=this._parent,r=t;if(this._parent=r,this._siblingIndex=0,this._onSetParent(i,e),this.emit&&this.emit(gg.PARENT_CHANGED,i),i&&!(i._objFlags&Bv)){var n=i._children.indexOf(this);i._children.splice(n,1),i._updateSiblingIndex(),i.emit&&i.emit(gg.CHILD_REMOVED,this)}r&&(r._children.push(this),this._siblingIndex=r._children.length-1,r.emit&&r.emit(gg.CHILD_ADDED,this)),this._onHierarchyChanged(i)}},i.getChildByUuid=function(t){if(!t)return T("Invalid uuid"),null;for(var e=this._children,i=0,r=e.length;i<r;i++)if(e[i]._id===t)return e[i];return null},i.getChildByName=function(t){if(!t)return T("Invalid name"),null;for(var e=this._children,i=0,r=e.length;i<r;i++)if(e[i]._name===t)return e[i];return null},i.getChildByPath=function(t){for(var e=t.split("/"),i=this,r=function(t){var r=e[t];if(0===r.length)return"continue";var n=i.children.find((function(t){return t.name===r}));if(!n)return{v:null};i=n},n=0;n<e.length;++n){var s=r(n);switch(s){case"continue":continue;default:if("object"==typeof s)return s.v}}return i},i.addChild=function(t){t.setParent(this)},i.insertChild=function(t,e){t.parent=this,t.setSiblingIndex(e)},i.getSiblingIndex=function(){return this._siblingIndex},i.setSiblingIndex=function(t){if(this._parent)if(this._parent._objFlags&Nv)B(3821);else{var e=this._parent._children;t=-1!==t?t:e.length-1;var i=e.indexOf(this);t!==i&&(e.splice(i,1),t<e.length?e.splice(t,0,this):e.push(this),this._parent._updateSiblingIndex(),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(t))}},i.walk=function(t,i){var r=1,n=null,s=null,a=0,o=e._stacks[e._stackId];o||(o=[],e._stacks.push(o)),e._stackId++,o.length=0,o[0]=this;for(var h=null,l=!1;r;)if(s=o[--r])if(!l&&t?t(s):l&&i&&i(s),o[r]=null,l){if(h===this._parent)break;if(l=!1,n)if(n[++a])o[r]=n[a],r++;else if(h&&(o[r]=h,r++,l=!0,h._parent?(a=(n=h._parent._children).indexOf(h),h=h._parent):(h=null,n=null),a<0))break}else s._children.length>0?(h=s,n=s._children,a=0,o[r]=n[a],r++):(o[r]=s,r++,l=!0);o.length=0,e._stackId--},i.removeFromParent=function(){this._parent&&this._parent.removeChild(this)},i.removeChild=function(t){this._children.indexOf(t)>-1&&(t.parent=null)},i.removeAllChildren=function(){for(var t=this._children,e=t.length-1;e>=0;e--){var i=t[e];i&&(i.parent=null)}this._children.length=0},i.isChildOf=function(t){var e=this;do{if(e===t)return!0;e=e._parent}while(e);return!1},i.getComponent=function(t){var i=Fv(t);return i?e._findComponent(this,i):null},i.getComponents=function(t){var i=Fv(t),r=[];return i&&e._findComponents(this,i,r),r},i.getComponentInChildren=function(t){var i=Fv(t);return i?e._findChildComponent(this._children,i):null},i.getComponentsInChildren=function(t){var i=Fv(t),r=[];return i&&(e._findComponents(this,i,r),e._findChildComponents(this._children,i,r)),r},i.addComponent=function(t){var e;if("string"==typeof t){if(!(e=Rt(t)))throw _._RF.peek()&&B(3808,t),TypeError(F(3807,t))}else{if(!t)throw TypeError(F(3804));e=t}if("function"!=typeof e)throw TypeError(F(3809));if(!mt(e,_.Component))throw TypeError(F(3810));var i=e._requireComponent;i&&!this.getComponent(i)&&this.addComponent(i);var r=new e;return r.node=this,this._components.push(r),this._activeInHierarchy&&_.director._nodeActivator.activateComp(r),r},i.removeComponent=function(t){if(t){var e=null;(e=t instanceof ds?t:this.getComponent(t))&&e.destroy()}else B(3813)},i.on=function(t,e,i,r){switch(void 0===r&&(r=!1),t){case gg.TRANSFORM_CHANGED:this._eventMask|=1}this._eventProcessor.on(t,e,i,r)},i.off=function(t,e,i,r){if(void 0===r&&(r=!1),this._eventProcessor.off(t,e,i,r),!this._eventProcessor.hasEventListener(t))switch(t){case gg.TRANSFORM_CHANGED:this._eventMask&=-2}},i.once=function(t,e,i,r){this._eventProcessor.once(t,e,i,r)},i.emit=function(t,e,i,r,n,s){this._eventProcessor.emit(t,e,i,r,n,s)},i.dispatchEvent=function(t){this._eventProcessor.dispatchEvent(t)},i.hasEventListener=function(t,e,i){return this._eventProcessor.hasEventListener(t,e,i)},i.targetOff=function(t){this._eventProcessor.targetOff(t),1&this._eventMask&&!this._eventProcessor.hasEventListener(gg.TRANSFORM_CHANGED)&&(this._eventMask&=-2)},i.destroy=function(){return!!t.prototype.destroy.call(this)&&(this.active=!1,!0)},i.destroyAllChildren=function(){for(var t=this._children,e=0;e<t.length;++e)t[e].destroy()},i._removeComponent=function(t){if(t){if(!(this._objFlags&Bv)){var e=this._components.indexOf(t);-1!==e?this._components.splice(e,1):t.node!==this&&B(3815)}}else B(3814)},i._updateSiblingIndex=function(){for(var t=0;t<this._children.length;++t)this._children[t]._siblingIndex=t},i._onSetParent=function(t){this._parent&&(null!=t&&t._scene===this._parent._scene||null==this._parent._scene||this.walk((function(t){e._setScene(t)})))},i._onPostActivated=function(){},i._onBatchRestored=function(){},i._onBatchCreated=function(){this._parent&&(this._siblingIndex=this._parent.children.indexOf(this))},i._onPreDestroy=function(){this._onPreDestroyBase()},i._onHierarchyChanged=function(t){return this._onHierarchyChangedBase(t)},i._instantiate=function(t){t||(t=_.instantiate._clone(this,this));var e=this._prefab;return e&&this===e.root&&e.sync,t._parent=null,t._onBatchRestored(),t},i._onHierarchyChangedBase=function(){var t=this._parent;!this._persistNode||t instanceof _.Scene||_.game.removePersistRootNode(this);var e=this._active&&!(!t||!t._activeInHierarchy);this._activeInHierarchy!==e&&_.director._nodeActivator.activateNode(this,e)},i._onPreDestroyBase=function(){this._objFlags|=Bv;var t=this._parent,e=!!t&&0!=(t._objFlags&Bv);if(this._persistNode&&_.game.removePersistRootNode(this),!e&&t){this.emit(gg.PARENT_CHANGED,this);var i=t._children.indexOf(this);t._children.splice(i,1),this._siblingIndex=0,t.emit&&t.emit(gg.CHILD_REMOVED,this)}this.emit(gg.NODE_DESTROYED,this),this._eventProcessor.destroy();for(var r=this._children,n=0;n<r.length;++n)r[n]._destroyImmediate();for(var s=this._components,a=0;a<s.length;++a)s[a]._destroyImmediate();return e},e}(Xi),Ov.idGenerator=Lv,Ov._stacks=[[]],Ov._stackId=0,u((bv=Iv).prototype,"_persistNode",[Ue],Object.getOwnPropertyDescriptor(bv.prototype,"_persistNode"),bv.prototype),u(bv.prototype,"name",[Ke],Object.getOwnPropertyDescriptor(bv.prototype,"name"),bv.prototype),u(bv.prototype,"children",[Ke],Object.getOwnPropertyDescriptor(bv.prototype,"children"),bv.prototype),u(bv.prototype,"active",[Ke],Object.getOwnPropertyDescriptor(bv.prototype,"active"),bv.prototype),u(bv.prototype,"activeInHierarchy",[Ke],Object.getOwnPropertyDescriptor(bv.prototype,"activeInHierarchy"),bv.prototype),u(bv.prototype,"parent",[Ke],Object.getOwnPropertyDescriptor(bv.prototype,"parent"),bv.prototype),Av=u(bv.prototype,"_parent",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Cv=u(bv.prototype,"_children",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),wv=u(bv.prototype,"_active",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Rv=u(bv.prototype,"_components",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xv=u(bv.prototype,"_prefab",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Sv=bv))||Sv);_._BaseNode=Zv,function(t){t[t.LOCAL=0]="LOCAL",t[t.WORLD=1]="WORLD"}(Dv||(Dv={})),function(t){t[t.NONE=0]="NONE",t[t.POSITION=1]="POSITION",t[t.ROTATION=2]="ROTATION",t[t.SCALE=4]="SCALE",t[t.RS=t.ROTATION|t.SCALE]="RS",t[t.TRS=t.POSITION|t.ROTATION|t.SCALE]="TRS",t[t.TRS_MASK=~t.TRS]="TRS_MASK"}(Uv||(Uv={})),_.internal.TransformBit=Uv;var Qv,Jv,$v,ty,ey,iy,ry,ny,sy=new Cs,ay=new Ns,oy=new Ns,hy=new Array(10),ly=new Ns,uy=new Ms,cy=new Ms,_y=new Hs,dy=new Map,py=t("Node",(kv=Ne("cc.Node"),zv=pi(Cs),kv((Kv=qv=function(t){function e(e){var i;return(i=t.call(this,e)||this)._uiProps=new Wg(a(i)),i._static=!1,i._pos=new Cs,i._rot=new Ns,i._scale=new Cs(1,1,1),i._mat=new Hs,l(i,"_lpos",Vv,a(i)),l(i,"_lrot",Wv,a(i)),l(i,"_lscale",jv,a(i)),l(i,"_layer",Xv,a(i)),l(i,"_euler",Yv,a(i)),i._dirtyFlags=Uv.NONE,i._eulerDirty=!1,i._poolHandle=0,i._poolHandle=eh.alloc(),eh.set(i._poolHandle,Zo.LAYER,i._layer),eh.setVec3(i._poolHandle,Zo.WORLD_SCALE,i._scale),i}s(e,t),e.isNode=function(t){return t instanceof e&&(t.constructor===e||!(t instanceof _.Scene))};var i=e.prototype;return i.destroy=function(){return this._poolHandle&&(eh.free(this._poolHandle),this._poolHandle=0),t.prototype.destroy.call(this)},i.setParent=function(e,i){void 0===i&&(i=!1),i&&this.updateWorldTransform(),t.prototype.setParent.call(this,e,i)},i._onSetParent=function(e,i){if(t.prototype._onSetParent.call(this,e,i),i){var r=this._parent;r?(r.updateWorldTransform(),Hs.multiply(_y,Hs.invert(_y,r._mat),this._mat),Hs.toRTS(_y,this._lrot,this._lpos,this._lscale)):(Cs.copy(this._lpos,this._pos),Ns.copy(this._lrot,this._rot),Cs.copy(this._lscale,this._scale)),this._eulerDirty=!0}this.invalidateChildren(Uv.TRS)},i._onBatchCreated=function(){t.prototype._onBatchCreated.call(this),this.hasChangedFlags=Uv.TRS,this._dirtyFlags=Uv.TRS;for(var e=this._children.length,i=0;i<e;++i)this._children[i]._onBatchCreated()},i._onBatchRestored=function(){this._onBatchCreated()},i._onBeforeSerialize=function(){this.eulerAngles},i._onPostActivated=function(t){t?(av.resumeTarget(this),this.eventProcessor.reattach(),this.invalidateChildren(Uv.TRS)):av.pauseTarget(this)},i.translate=function(t,e){var i=e||Dv.LOCAL;if(i===Dv.LOCAL)Cs.transformQuat(sy,t,this._lrot),this._lpos.x+=sy.x,this._lpos.y+=sy.y,this._lpos.z+=sy.z;else if(i===Dv.WORLD)if(this._parent){Ns.invert(ay,this._parent.worldRotation),Cs.transformQuat(sy,t,ay);var r=this.worldScale;this._lpos.x+=sy.x/r.x,this._lpos.y+=sy.y/r.y,this._lpos.z+=sy.z/r.z}else this._lpos.x+=t.x,this._lpos.y+=t.y,this._lpos.z+=t.z;this.invalidateChildren(Uv.POSITION),1&this._eventMask&&this.emit(gg.TRANSFORM_CHANGED,Uv.POSITION)},i.rotate=function(t,e){var i=e||Dv.LOCAL;if(Ns.normalize(ay,t),i===Dv.LOCAL)Ns.multiply(this._lrot,this._lrot,ay);else if(i===Dv.WORLD){var r=this.worldRotation;Ns.multiply(oy,ay,r),Ns.invert(ay,r),Ns.multiply(oy,ay,oy),Ns.multiply(this._lrot,this._lrot,oy)}this._eulerDirty=!0,this.invalidateChildren(Uv.ROTATION),1&this._eventMask&&this.emit(gg.TRANSFORM_CHANGED,Uv.ROTATION)},i.lookAt=function(t,e){this.getWorldPosition(sy),Cs.subtract(sy,sy,t),Cs.normalize(sy,sy),Ns.fromViewUp(ay,sy,e),this.setWorldRotation(ay)},i.invalidateChildren=function(t){var e=this.hasChangedFlags;if((this._dirtyFlags&e&t)!==t){this._dirtyFlags|=t,this.hasChangedFlags=e|t;for(var i=t|Uv.POSITION,r=this._children.length,n=0;n<r;++n){var s=this._children[n];s.isValid&&s.invalidateChildren(i)}}},i.updateWorldTransform=function(){if(this._dirtyFlags){for(var t,e=this,i=0;e&&e._dirtyFlags;)hy[i++]=e,e=e._parent;for(var r=0;i;)r|=(t=hy[--i])._dirtyFlags,e?(r&Uv.POSITION&&(Cs.transformMat4(t._pos,t._lpos,e._mat),t._mat.m12=t._pos.x,t._mat.m13=t._pos.y,t._mat.m14=t._pos.z,eh.setVec3(t._poolHandle,Zo.WORLD_POSITION,t._pos)),r&Uv.RS&&(Hs.fromRTS(t._mat,t._lrot,t._lpos,t._lscale),Hs.multiply(t._mat,e._mat,t._mat),r&Uv.ROTATION&&(Ns.multiply(t._rot,e._rot,t._lrot),eh.setVec4(t._poolHandle,Zo.WORLD_ROTATION,t._rot)),Ms.fromQuat(uy,Ns.conjugate(ly,t._rot)),Ms.multiplyMat4(uy,uy,t._mat),t._scale.x=uy.m00,t._scale.y=uy.m04,t._scale.z=uy.m08,eh.setVec3(t._poolHandle,Zo.WORLD_SCALE,t._scale))):(r&Uv.POSITION&&(Cs.copy(t._pos,t._lpos),t._mat.m12=t._pos.x,t._mat.m13=t._pos.y,t._mat.m14=t._pos.z,eh.setVec3(t._poolHandle,Zo.WORLD_POSITION,t._pos)),r&Uv.RS&&(r&Uv.ROTATION&&(Ns.copy(t._rot,t._lrot),eh.setVec4(t._poolHandle,Zo.WORLD_ROTATION,t._rot)),r&Uv.SCALE&&(Cs.copy(t._scale,t._lscale),eh.setVec3(t._poolHandle,Zo.WORLD_SCALE,t._scale),Hs.fromRTS(t._mat,t._rot,t._pos,t._scale)))),r!==Uv.NONE&&eh.setMat4(t._poolHandle,Zo.WORLD_MATRIX,t._mat),t._dirtyFlags=Uv.NONE,e=t}},i.setPosition=function(t,e,i){void 0===e&&void 0===i?Cs.copy(this._lpos,t):void 0===i?Cs.set(this._lpos,t,e,this._lpos.z):Cs.set(this._lpos,t,e,i),this.invalidateChildren(Uv.POSITION),1&this._eventMask&&this.emit(gg.TRANSFORM_CHANGED,Uv.POSITION)},i.getPosition=function(t){return t?Cs.set(t,this._lpos.x,this._lpos.y,this._lpos.z):Cs.copy(new Cs,this._lpos)},i.setRotation=function(t,e,i,r){void 0===e||void 0===i||void 0===r?Ns.copy(this._lrot,t):Ns.set(this._lrot,t,e,i,r),this._eulerDirty=!0,this.invalidateChildren(Uv.ROTATION),1&this._eventMask&&this.emit(gg.TRANSFORM_CHANGED,Uv.ROTATION)},i.setRotationFromEuler=function(t,e,i){var r=void 0===i?this._euler.z:i;Cs.set(this._euler,t,e,r),Ns.fromEuler(this._lrot,t,e,r),this._eulerDirty=!1,this.invalidateChildren(Uv.ROTATION),1&this._eventMask&&this.emit(gg.TRANSFORM_CHANGED,Uv.ROTATION)},i.getRotation=function(t){return t?Ns.set(t,this._lrot.x,this._lrot.y,this._lrot.z,this._lrot.w):Ns.copy(new Ns,this._lrot)},i.setScale=function(t,e,i){void 0===e&&void 0===i?Cs.copy(this._lscale,t):void 0===i?Cs.set(this._lscale,t,e,this._lscale.z):Cs.set(this._lscale,t,e,i),this.invalidateChildren(Uv.SCALE),1&this._eventMask&&this.emit(gg.TRANSFORM_CHANGED,Uv.SCALE)},i.getScale=function(t){return t?Cs.set(t,this._lscale.x,this._lscale.y,this._lscale.z):Cs.copy(new Cs,this._lscale)},i.inverseTransformPoint=function(t,e){Cs.copy(t,e);for(var i=this,r=0;i._parent;)hy[r++]=i,i=i._parent;for(;r>=0;)Cs.transformInverseRTS(t,t,i._lrot,i._lpos,i._lscale),i=hy[--r];return t},i.setWorldPosition=function(t,e,i){void 0===e||void 0===i?Cs.copy(this._pos,t):Cs.set(this._pos,t,e,i),eh.setVec3(this._poolHandle,Zo.WORLD_POSITION,this._pos);var r=this._parent,n=this._lpos;r?(r.updateWorldTransform(),Cs.transformMat4(n,this._pos,Hs.invert(_y,r._mat))):Cs.copy(n,this._pos),this.invalidateChildren(Uv.POSITION),1&this._eventMask&&this.emit(gg.TRANSFORM_CHANGED,Uv.POSITION)},i.getWorldPosition=function(t){return this.updateWorldTransform(),t?Cs.copy(t,this._pos):Cs.copy(new Cs,this._pos)},i.setWorldRotation=function(t,e,i,r){void 0===e||void 0===i||void 0===r?Ns.copy(this._rot,t):Ns.set(this._rot,t,e,i,r),eh.setVec4(this._poolHandle,Zo.WORLD_ROTATION,this._rot),this._parent?(this._parent.updateWorldTransform(),Ns.multiply(this._lrot,Ns.conjugate(this._lrot,this._parent._rot),this._rot)):Ns.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren(Uv.ROTATION),1&this._eventMask&&this.emit(gg.TRANSFORM_CHANGED,Uv.ROTATION)},i.setWorldRotationFromEuler=function(t,e,i){Ns.fromEuler(this._rot,t,e,i),this._parent?(this._parent.updateWorldTransform(),Ns.multiply(this._lrot,Ns.conjugate(this._lrot,this._parent._rot),this._rot)):Ns.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren(Uv.ROTATION),1&this._eventMask&&this.emit(gg.TRANSFORM_CHANGED,Uv.ROTATION)},i.getWorldRotation=function(t){return this.updateWorldTransform(),t?Ns.copy(t,this._rot):Ns.copy(new Ns,this._rot)},i.setWorldScale=function(t,e,i){void 0===e||void 0===i?Cs.copy(this._scale,t):Cs.set(this._scale,t,e,i),eh.setVec3(this._poolHandle,Zo.WORLD_SCALE,this._scale);var r=this._parent;r?(r.updateWorldTransform(),Ms.fromQuat(uy,Ns.conjugate(ly,r._rot)),Ms.multiplyMat4(uy,uy,r._mat),cy.m00=this._scale.x,cy.m04=this._scale.y,cy.m08=this._scale.z,Ms.multiply(uy,cy,Ms.invert(uy,uy)),this._lscale.x=Cs.set(sy,uy.m00,uy.m01,uy.m02).length(),this._lscale.y=Cs.set(sy,uy.m03,uy.m04,uy.m05).length(),this._lscale.z=Cs.set(sy,uy.m06,uy.m07,uy.m08).length()):Cs.copy(this._lscale,this._scale),this.invalidateChildren(Uv.SCALE),1&this._eventMask&&this.emit(gg.TRANSFORM_CHANGED,Uv.SCALE)},i.getWorldScale=function(t){return this.updateWorldTransform(),t?Cs.copy(t,this._scale):Cs.copy(new Cs,this._scale)},i.getWorldMatrix=function(t){this.updateWorldTransform();var e=t||new Hs;return Hs.copy(e,this._mat)},i.getWorldRS=function(t){this.updateWorldTransform();var e=t||new Hs;return Hs.copy(e,this._mat),e.m12=0,e.m13=0,e.m14=0,e},i.getWorldRT=function(t){this.updateWorldTransform();var e=t||new Hs;return Hs.fromRT(e,this._rot,this._pos)},i.setRTS=function(t,e,i){var r=0;t&&(r|=Uv.ROTATION,void 0!==t.w?(Ns.copy(this._lrot,t),this._eulerDirty=!0):(Cs.copy(this._euler,t),Ns.fromEuler(this._lrot,t.x,t.y,t.z),this._eulerDirty=!1)),e&&(Cs.copy(this._lpos,e),r|=Uv.POSITION),i&&(Cs.copy(this._lscale,i),r|=Uv.SCALE),r&&(this.invalidateChildren(r),1&this._eventMask&&this.emit(gg.TRANSFORM_CHANGED,r))},i.pauseSystemEvents=function(t){av.pauseTarget(this,t)},i.resumeSystemEvents=function(t){av.resumeTarget(this,t)},r(e,[{key:"handle",get:function(){return this._poolHandle}},{key:"position",get:function(){return this._lpos},set:function(t){this.setPosition(t)}},{key:"worldPosition",get:function(){return this.updateWorldTransform(),this._pos},set:function(t){this.setWorldPosition(t)}},{key:"rotation",get:function(){return this._lrot},set:function(t){this.setRotation(t)}},{key:"eulerAngles",set:function(t){this.setRotationFromEuler(t.x,t.y,t.z)},get:function(){return this._eulerDirty&&(Ns.toEuler(this._euler,this._lrot),this._eulerDirty=!1),this._euler}},{key:"angle",get:function(){return this._euler.z},set:function(t){Cs.set(this._euler,0,0,t),Ns.fromAngleZ(this._lrot,t),this._eulerDirty=!1,this.invalidateChildren(Uv.ROTATION),1&this._eventMask&&this.emit(gg.TRANSFORM_CHANGED,Uv.ROTATION)}},{key:"worldRotation",get:function(){return this.updateWorldTransform(),this._rot},set:function(t){this.setWorldRotation(t)}},{key:"scale",get:function(){return this._lscale},set:function(t){this.setScale(t)}},{key:"worldScale",get:function(){return this.updateWorldTransform(),this._scale},set:function(t){this.setWorldScale(t)}},{key:"matrix",set:function(t){Hs.toRTS(t,this._lrot,this._lpos,this._lscale),this.invalidateChildren(Uv.TRS),this._eulerDirty=!0,1&this._eventMask&&this.emit(gg.TRANSFORM_CHANGED,Uv.TRS)}},{key:"worldMatrix",get:function(){return this.updateWorldTransform(),this._mat}},{key:"forward",get:function(){return Cs.transformQuat(new Cs,Cs.FORWARD,this.worldRotation)},set:function(t){var e=t.length();Cs.multiplyScalar(sy,t,-1/e),Ns.fromViewUp(ay,sy),this.setWorldRotation(ay)}},{key:"layer",set:function(t){this._layer=t,eh.set(this._poolHandle,Zo.LAYER,this._layer),this.emit(gg.LAYER_CHANGED,this._layer)},get:function(){return this._layer}},{key:"hasChangedFlags",get:function(){return dy.get(this)||0},set:function(t){dy.set(this,t),eh.set(this._poolHandle,Zo.FLAGS_CHANGED,t)}}]),e}(Zv),qv.bookOfChange=dy,qv.EventType=gg,qv.NodeSpace=Dv,qv.TransformDirtyBit=Uv,qv.TransformBit=Uv,Vv=u((Hv=Kv).prototype,"_lpos",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cs}}),Wv=u(Hv.prototype,"_lrot",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ns}}),jv=u(Hv.prototype,"_lscale",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cs(1,1,1)}}),Xv=u(Hv.prototype,"_layer",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return vp.Enum.DEFAULT}}),Yv=u(Hv.prototype,"_euler",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cs}}),u(Hv.prototype,"eulerAngles",[zv],Object.getOwnPropertyDescriptor(Hv.prototype,"eulerAngles"),Hv.prototype),u(Hv.prototype,"angle",[Ke],Object.getOwnPropertyDescriptor(Hv.prototype,"angle"),Hv.prototype),u(Hv.prototype,"layer",[Ke],Object.getOwnPropertyDescriptor(Hv.prototype,"layer"),Hv.prototype),Gv=Hv))||Gv));function fy(t){return"string"==typeof t||"number"==typeof t}function my(t,e){return t instanceof e}_.Node=py;var gy=Ne("cc.animation.HierarchyPath")((ty=function(){function t(t){l(this,"path",$v,this),this.path=t||""}return t.prototype.get=function(t){return t instanceof py?t.getChildByPath(this.path)||(E('Node "'+t.name+'" has no path "'+this.path+'"'),null):(E("Target of hierarchy path should be of type Node."),null)},t}(),$v=u((Jv=ty).prototype,"path",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Qv=Jv))||Qv,vy=Ne("cc.animation.ComponentPath")((ny=function(){function t(t){l(this,"component",ry,this),this.component=t||""}return t.prototype.get=function(t){return t instanceof py?t.getComponent(this.component)||(E('Node "'+t.name+'" has no component "'+this.component+'"'),null):(E("Target of component path should be of type Node."),null)},t}(),ry=u((iy=ny).prototype,"component",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ey=iy))||ey;function yy(t){for(var e=t,i=0;i<(arguments.length<=1?0:arguments.length-1);++i){var r=i+1<1||arguments.length<=i+1?void 0:arguments[i+1];if(fy(r)){if(!(r in e))return E('Target object has no property "'+r+'"'),null;e=e[r]}else e=r.get(e);if(null===e)break}return e}var Ty=t("SkelAnimDataHub",function(){function t(){}return t.getOrExtract=function(e){var i=t.pool.get(e);return i&&i.info.sample===e.sample||(i&&_.director.root.dataPoolManager.releaseAnimationClip(e),i=function(t){var e={};t.curves.forEach((function(t){if(!t.valueAdapter&&my(t.modifiers[0],gy)&&fy(t.modifiers[1])){var i=t.modifiers[0].path,r=e[i];r||(r=e[i]={}),r[t.modifiers[1]]={values:t.data.values,keys:t.data.keys}}}));for(var i=Math.ceil(t.sample*t.duration)+1,r=function(){var r=s[n],a=e[r];if(!a)return"continue";Object.defineProperty(a,"worldMatrix",{get:function(){if(!a._worldMatrix){var n=a.position,s=a.rotation,o=a.scale;Ey(t,n,i),Ey(t,s,i),Ey(t,o,i),function(t,e,i){var r=i.position.values,n=i.rotation.values,s=i.scale.values,a=r.map((function(){return new Hs})),o=e.lastIndexOf("/"),h=null;if(o>0){var l=t[e.substring(0,o)];if(!l)return void console.warn("no data for parent bone?");h=l.worldMatrix.values}for(var u=0;u<r.length;u++){var c=r[u],_=n[u],d=s[u],p=a[u];Hs.fromRTS(p,_,c,d),h&&Hs.multiply(p,h[u],p)}Object.keys(i).forEach((function(t){return delete i[t]})),i._worldMatrix={keys:0,interpolate:!1,values:a}}(e,r,a)}return a._worldMatrix}})},n=0,s=Object.keys(e);n<s.length;n++)r();return{info:{frames:i,sample:t.sample},data:e}}(e),t.pool.set(e,i)),i},t.destroy=function(e){t.pool.delete(e)},t}());function Ey(t,e,i){var r=t.keys[e.keys],n=[];if(r&&1!==r.length)for(var s=e.values[0]instanceof Ns,a=0,o=0;a<i;a++){for(var h=a/t.sample;r[o]<=h;)o++;o>r.length-1?h=r[o=r.length-1]:0===o&&(o=1);var l=e.values[o-1].clone(),u=r[o]-r[o-1],c=u?Mr((h-r[o-1])/u):1;s?l.slerp(e.values[o],c):l.lerp(e.values[o],c),n[a]=l}else for(var _=0;_<i;_++)n[_]=e.values[0].clone();e.values=n}Ty.pool=new Map;var Sy=new Hs;function by(t,e,i){for(Hs.identity(i);t!==e;)Hs.fromRTS(Sy,t.rotation,t.position,t.scale),Hs.multiply(i,Sy,i),t=t.parent;return i}var Ay=function(t,e,i){t[e+0]=i.m00,t[e+1]=i.m01,t[e+2]=i.m02,t[e+3]=i.m12,t[e+4]=i.m04,t[e+5]=i.m05,t[e+6]=i.m06,t[e+7]=i.m13,t[e+8]=i.m08,t[e+9]=i.m09,t[e+10]=i.m10,t[e+11]=i.m14};function Cy(t){return t.hasFeature(Fl.TEXTURE_FLOAT)?il.RGBA32F:il.RGBA8}function wy(t,e){var i=4/Math.sqrt(e);return 12*Math.ceil(Math.max(480*i,t)/12)}new Ns,new Ns,new Cs,new Ns,new Cs;var Ry,xy,Oy,Iy,My,By,Py,Ny,Ly,Fy,Dy,Uy,ky,zy,Gy,Hy,Vy,Wy,jy,Xy,Yy,qy,Ky,Zy=Hd([ml.POINT,ml.POINT,ml.NONE,gl.CLAMP,gl.CLAMP,gl.CLAMP]),Qy=new Cs,Jy=new Cs,$y=new Cs,tT=new Cs,eT=new Hs,iT=new Hs,rT=new y_,nT=Number.MAX_SAFE_INTEGER,sT=function(){function t(t){this._device=void 0,this._pool=void 0,this._textureBuffers=new Map,this._formatSize=void 0,this._pixelsPerJoint=void 0,this._customPool=void 0,this._chunkIdxMap=new Map,this._device=t;var e=Cy(this._device);this._formatSize=zl[e].size,this._pixelsPerJoint=48/this._formatSize,this._pool=new Jm(t),this._pool.initialize({format:e,roundUpFn:wy}),this._customPool=new Jm(t),this._customPool.initialize({format:e,roundUpFn:wy})}r(t,[{key:"pixelsPerJoint",get:function(){return this._pixelsPerJoint}}]);var e=t.prototype;return e.clear=function(){this._pool.destroy(),this._textureBuffers.clear()},e.registerCustomTextureLayouts=function(t){for(var e=0;e<t.length;e++)for(var i=t[e],r=this._customPool.createChunk(i.textureLength),n=0;n<i.contents.length;n++){var s=i.contents[n],a=s.skeleton;this._chunkIdxMap.set(a,r);for(var o=0;o<s.clips.length;o++){var h=s.clips[o];this._chunkIdxMap.set(a^h,r)}}},e.getDefaultPoseTexture=function(t,e,i){var r=0^t.hash,n=this._textureBuffers.get(r)||null;if(n&&n.bounds.has(e.hash))return n.refCount++,n;var s=t.joints,a=t.bindposes,o=null,h=!1,l=s.length;if(n)n.refCount++;else{var u=12*l,c=this._chunkIdxMap.get(r),_=void 0!==c?this._customPool.alloc(u*Float32Array.BYTES_PER_ELEMENT,c):this._pool.alloc(u*Float32Array.BYTES_PER_ELEMENT);if(!_)return n;n={pixelOffset:_.start/this._formatSize,refCount:1,bounds:new Map,skeletonHash:t.hash,clipHash:0,readyToBeDeleted:!1,handle:_},o=new Float32Array(u),h=!0}Cs.set($y,nT,nT,nT),Cs.set(tT,-nT,-nT,-nT);for(var d=e.getBoneSpaceBounds(t),p=0,f=0;p<l;p++,f+=12){var m=i.getChildByPath(s[p]),g=m?by(m,i,eT):t.inverseBindposes[p],v=d[p];v&&(y_.transform(rT,v,g),rT.getBoundary(Qy,Jy),Cs.min($y,$y,Qy),Cs.max(tT,tT,Jy)),h&&(m&&Hs.multiply(g,g,a[p]),Ay(o,f,m?g:Hs.IDENTITY))}var y=[new y_];return n.bounds.set(e.hash,y),y_.fromPoints(y[0],$y,tT),h&&(this._pool.update(n.handle,o.buffer),this._textureBuffers.set(r,n)),n},e.getSequencePoseTexture=function(t,e,i,r){var n=t.hash^e.hash,s=this._textureBuffers.get(n)||null;if(s&&s.bounds.has(i.hash))return s.refCount++,s;var a=t.joints,o=t.bindposes,h=Ty.getOrExtract(e).info.frames,l=null,u=!1,c=a.length;if(s)s.refCount++;else{var _=12*c*h,d=this._chunkIdxMap.get(n),p=void 0!==d?this._customPool.alloc(_*Float32Array.BYTES_PER_ELEMENT,d):this._pool.alloc(_*Float32Array.BYTES_PER_ELEMENT);if(!p)return null;var f=this._createAnimInfos(t,e,r);s={pixelOffset:p.start/this._formatSize,refCount:1,bounds:new Map,skeletonHash:t.hash,clipHash:e.hash,readyToBeDeleted:!1,handle:p,animInfos:f},l=new Float32Array(_),u=!0}var m=i.getBoneSpaceBounds(t),g=[];s.bounds.set(i.hash,g);for(var v=0;v<h;v++)g.push(new y_(nT,nT,nT,-nT,-nT,-nT));for(var y=0,T=0;y<h;y++){for(var E=g[y],S=0;S<c;S++,T+=12){var b=s.animInfos[S],A=b.curveData,C=b.downstream,w=b.bindposeIdx,R=b.bindposeCorrection,x=void 0,O=!0;A&&C?x=Hs.multiply(eT,A[y],C):A?x=A[y]:C?x=C:(x=t.inverseBindposes[w],O=!1);var I=m[S];if(I){var M=R?Hs.multiply(iT,x,R):x;y_.transform(rT,I,M),rT.getBoundary(Qy,Jy),Cs.min(E.center,E.center,Qy),Cs.max(E.halfExtents,E.halfExtents,Jy)}u&&(O&&Hs.multiply(eT,x,o[w]),Ay(l,T,O?eT:Hs.IDENTITY))}y_.fromPoints(E,E.center,E.halfExtents)}return u&&(this._pool.update(s.handle,l.buffer),this._textureBuffers.set(n,s)),s},e.releaseHandle=function(t){if(t.refCount>0&&t.refCount--,!t.refCount&&t.readyToBeDeleted){var e=t.skeletonHash^t.clipHash;(void 0!==this._chunkIdxMap.get(e)?this._customPool:this._pool).free(t.handle),this._textureBuffers.get(e)===t&&this._textureBuffers.delete(e)}},e.releaseSkeleton=function(t){for(var e=this._textureBuffers.values(),i=e.next();!i.done;){var r=i.value;r.skeletonHash===t.hash&&(r.readyToBeDeleted=!0,r.refCount?this._textureBuffers.delete(r.skeletonHash^r.clipHash):this.releaseHandle(r)),i=e.next()}},e.releaseAnimationClip=function(t){for(var e=this._textureBuffers.values(),i=e.next();!i.done;){var r=i.value;r.clipHash===t.hash&&(r.readyToBeDeleted=!0,r.refCount?this._textureBuffers.delete(r.skeletonHash^r.clipHash):this.releaseHandle(r)),i=e.next()}},e._createAnimInfos=function(t,e,i){for(var r=[],n=t.joints,s=t.bindposes,a=n.length,o=Ty.getOrExtract(e),h=0;h<a;h++){for(var l=n[h],u=o.data[l],c=i.getChildByPath(l),_=void 0,d=void 0;!u;){var p=l.lastIndexOf("/");if(l=l.substring(0,p),u=o.data[l],c?(_||(_=new Hs),Hs.fromRTS(eT,c.rotation,c.position,c.scale),Hs.multiply(_,eT,_),c=c.parent):d=l,p<0)break}var f=h,m=void 0;if(void 0!==d&&u){f=h-1;for(var g=0;g<a;g++)if(n[g]===d){f=g,m=new Hs,Hs.multiply(m,s[g],t.inverseBindposes[h]);break}}r.push({curveData:u&&u.worldMatrix.values,downstream:_,bindposeIdx:f,bindposeCorrection:m})}return r},t}(),aT=function(){function t(t){this._pool=new Map,this._device=void 0,this._device=t}var e=t.prototype;return e.getData=function(t){void 0===t&&(t="-1");var e=this._pool.get(t);if(e)return e;var i=this._device.createBuffer(new Kl(rl.UNIFORM|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,Wp.SIZE,Wp.SIZE)),r=new Float32Array([0,0,0,0]);i.update(r);var n={buffer:i,data:r,dirty:!1};return this._pool.set(t,n),n},e.destroy=function(t){var e=this._pool.get(t);e&&(e.buffer.destroy(),this._pool.delete(t))},e.switchClip=function(t){return t.data[0]=0,t.buffer.update(t.data),t.dirty=!1,t},e.clear=function(){for(var t,e=h(this._pool.values());!(t=e()).done;)t.value.buffer.destroy();this._pool.clear()},t}(),oT=new qu(null),hT=function(){function t(){this._device=null,this._passes=null,this._subMesh=null,this._patches=null,this._handle=0,this._priority=mp.DEFAULT,this._inputAssembler=null,this._descriptorSet=null}var e=t.prototype;return e.initialize=function(t,e,i){void 0===i&&(i=null),this._device=_.director.root.device,this._subMesh=t,this._patches=i,this._passes=e,this._handle=zo.alloc(),this._flushPassInfo(),e[0].batchingScheme===Am.VB_MERGING&&this._subMesh.genFlatBuffers(),oT.layout=e[0].localSetLayout;var r=bo.alloc(this._device,oT),n=Ao.alloc(this._device,t.iaInfo);zo.set(this._handle,Lo.PRIORITY,mp.DEFAULT),zo.set(this._handle,Lo.INPUT_ASSEMBLER,n),zo.set(this._handle,Lo.DESCRIPTOR_SET,r),zo.set(this._handle,Lo.SUB_MESH,t.handle),this._inputAssembler=Ao.get(n),this._descriptorSet=bo.get(r)},e.destroy=function(){bo.free(zo.get(this._handle,Lo.DESCRIPTOR_SET)),Ao.free(zo.get(this._handle,Lo.INPUT_ASSEMBLER)),zo.free(this._handle),this._descriptorSet=null,this._inputAssembler=null,this._priority=mp.DEFAULT,this._handle=0,this._patches=null,this._subMesh=null,this._passes=null},e.update=function(){for(var t=0;t<this._passes.length;++t)this._passes[t].update();this._descriptorSet.update()},e.onPipelineStateChanged=function(){var t=this._passes;if(t){for(var e=0;e<t.length;e++){var i=t[e];i.beginChangeStatesSilently(),i.tryCompile(),i.endChangeStatesSilently()}this._flushPassInfo()}},e.onMacroPatchesStateChanged=function(t){this._patches=t;var e=this._passes;if(e){for(var i=0;i<e.length;i++){var r=e[i];r.beginChangeStatesSilently(),r.tryCompile(),r.endChangeStatesSilently()}this._flushPassInfo()}},e._flushPassInfo=function(){var t=this._passes;if(t){zo.set(this._handle,Lo.PASS_COUNT,t.length);for(var e=Lo.PASS_0,i=Lo.SHADER_0,r=0;r<t.length;r++,e++,i++)zo.set(this._handle,e,t[r].handle),zo.set(this._handle,i,t[r].getShaderVariant(this._patches))}},r(t,[{key:"passes",set:function(t){if(this._passes=t,this._flushPassInfo(),this._descriptorSet){bo.free(zo.get(this._handle,Lo.DESCRIPTOR_SET)),oT.layout=t[0].localSetLayout;var e=bo.alloc(this._device,oT);zo.set(this._handle,Lo.DESCRIPTOR_SET,e),this._descriptorSet=bo.get(e)}},get:function(){return this._passes}},{key:"subMesh",set:function(t){this._subMesh=t,this._inputAssembler.destroy(),this._inputAssembler.initialize(t.iaInfo),this._passes[0].batchingScheme===Am.VB_MERGING&&this._subMesh.genFlatBuffers(),zo.set(this._handle,Lo.SUB_MESH,t.handle)},get:function(){return this._subMesh}},{key:"priority",set:function(t){this._priority=t,zo.set(this._handle,Lo.PRIORITY,t)},get:function(){return this._priority}},{key:"handle",get:function(){return this._handle}},{key:"inputAssembler",get:function(){return this._inputAssembler}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"patches",get:function(){return this._patches}}]),t}(),lT=t("RenderStage",(Ry=Ne("RenderStage"),xy=si(),Oy=si(),Iy=si(),Ry((Fy=function(){function t(){l(this,"_name",Py,this),l(this,"_priority",Ny,this),l(this,"_tag",Ly,this)}var e=t.prototype;return e.initialize=function(t){return this._name=t.name,this._priority=t.priority,t.tag&&(this._tag=t.tag),!0},e.activate=function(t,e){this._pipeline=t,this._flow=e},r(t,[{key:"name",get:function(){return this._name}},{key:"priority",get:function(){return this._priority}},{key:"tag",get:function(){return this._tag}}]),t}(),Py=u((By=Fy).prototype,"_name",[xy,ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Ny=u(By.prototype,"_priority",[Oy,ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ly=u(By.prototype,"_tag",[Iy,ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),My=By))||My));_.RenderStage=lT;var uT,cT,_T,dT,pT,fT,mT,gT,vT,yT=t("RenderFlow",(Dy=Ne("RenderFlow"),Uy=si(),ky=si(),zy=si(),Gy=si(),Hy=pi([lT]),Dy((Ky=function(){function t(){l(this,"_name",jy,this),l(this,"_priority",Xy,this),l(this,"_tag",Yy,this),l(this,"_stages",qy,this)}var e=t.prototype;return e.initialize=function(t){return this._name=t.name,this._priority=t.priority,this._stages=t.stages,t.tag&&(this._tag=t.tag),!0},e.activate=function(t){this._pipeline=t,this._stages.sort((function(t,e){return t.priority-e.priority}));for(var e=0,i=this._stages.length;e<i;e++)this._stages[e].activate(t,this)},e.render=function(t){for(var e=0,i=this._stages.length;e<i;e++)this._stages[e].render(t)},e.destroy=function(){for(var t=0,e=this._stages.length;t<e;t++)this._stages[t].destroy();this._stages.length=0},r(t,[{key:"name",get:function(){return this._name}},{key:"priority",get:function(){return this._priority}},{key:"tag",get:function(){return this._tag}},{key:"stages",get:function(){return this._stages}}]),t}(),jy=u((Wy=Ky).prototype,"_name",[Uy,ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Xy=u(Wy.prototype,"_priority",[ky,ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Yy=u(Wy.prototype,"_tag",[zy,ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),qy=u(Wy.prototype,"_stages",[Gy,Hy,ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Vy=Wy))||Vy));_.RenderFlow=yT;var TT,ET,ST,bT,AT,CT,wT,RT,xT,OT,IT,MT,BT,PT,NT,LT,FT,DT,UT,kT,zT,GT,HT,VT,WT,jT,XT,YT,qT,KT,ZT,QT,JT,$T,tE,eE,iE,rE,nE,sE,aE,oE,hE,lE,uE,cE,_E,dE,pE,fE,mE,gE,vE,yE,TE,EE,SE,bE,AE,CE,wE,RE,xE,OE,IE,ME,BE,PE,NE,LE,FE,DE,UE,kE,zE,GE,HE,VE,WE,jE,XE=t("RenderPipeline",(uT=Ne("cc.RenderPipeline"),cT=si(),_T=si(),dT=pi([yT]),uT((vT=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"_tag",mT,a(e)),l(e,"_flows",gT,a(e)),e._macros={},e._commandBuffers=[],e}s(e,t);var i=e.prototype;return i.initialize=function(t){return this._flows=t.flows,t.tag&&(this._tag=t.tag),!0},i.activate=function(){this._device=_.director.root.device;var t=new Qu(Tp.bindings);this._descriptorSetLayout=this._device.createDescriptorSetLayout(t),this._descriptorSet=this._device.createDescriptorSet(new qu(this._descriptorSetLayout));for(var e=0;e<this._flows.length;e++)this._flows[e].activate(this);return!0},i.render=function(t){for(var e=0;e<t.length;e++)for(var i=t[e],r=0;r<i.flows.length;r++)i.flows[r].render(i)},i.destroy=function(){for(var e=0;e<this._flows.length;e++)this._flows[e].destroy();this._flows.length=0,this._descriptorSet&&(this._descriptorSet.destroy(),this._descriptorSet=null);for(var i=0;i<this._commandBuffers.length;i++)this._commandBuffers[i].destroy();return this._commandBuffers.length=0,t.prototype.destroy.call(this)},r(e,[{key:"macros",get:function(){return this._macros}},{key:"tag",get:function(){return this._tag}},{key:"flows",get:function(){return this._flows}},{key:"device",get:function(){return this._device}},{key:"descriptorSetLayout",get:function(){return this._descriptorSetLayout}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"commandBuffers",get:function(){return this._commandBuffers}}]),e}(Sr),mT=u((fT=vT).prototype,"_tag",[cT,ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),gT=u(fT.prototype,"_flows",[_T,dT,ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),pT=fT))||pT));_.RenderPipeline=XE,Ft(vl),Ft(yl),Ft(wl),Ft(Cl),Ft(Rl),function(t){t[t.SCENE=0]="SCENE",t[t.POSTPROCESS=1]="POSTPROCESS",t[t.UI=2]="UI"}(jE||(jE={})),Ft(jE),TT=Ne("RenderTextureDesc"),ET=pi(vl),ST=pi(yl),bT=pi(il),TT((CT=u((AT=function(){l(this,"name",CT,this),l(this,"type",wT,this),l(this,"usage",RT,this),l(this,"format",xT,this),l(this,"width",OT,this),l(this,"height",IT,this)}).prototype,"name",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),wT=u(AT.prototype,"type",[ET],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return vl.TEX2D}}),RT=u(AT.prototype,"usage",[ST],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return yl.COLOR_ATTACHMENT}}),xT=u(AT.prototype,"format",[bT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return il.UNKNOWN}}),OT=u(AT.prototype,"width",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),IT=u(AT.prototype,"height",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),AT));var YE,qE=(MT=Ne("RenderTextureConfig"),BT=pi(fg),MT((LT=u((NT=function(){l(this,"name",LT,this),l(this,"texture",FT,this)}).prototype,"name",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),FT=u(NT.prototype,"texture",[BT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),PT=NT))||PT),KE=(DT=Ne("MaterialConfig"),UT=pi(mg),DT((GT=u((zT=function(){l(this,"name",GT,this),l(this,"material",HT,this)}).prototype,"name",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),HT=u(zT.prototype,"material",[UT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kT=zT))||kT),ZE=(VT=Ne("FrameBufferDesc"),WT=pi([he]),jT=pi(fg),VT((YT=u((XT=function(){l(this,"name",YT,this),l(this,"renderPass",qT,this),l(this,"colorTextures",KT,this),l(this,"depthStencilTexture",ZT,this),l(this,"texture",QT,this)}).prototype,"name",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),qT=u(XT.prototype,"renderPass",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),KT=u(XT.prototype,"colorTextures",[WT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ZT=u(XT.prototype,"depthStencilTexture",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),QT=u(XT.prototype,"texture",[jT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),XT)),JT=Ne("ColorDesc"),$T=pi(il),tE=pi(Cl),eE=pi(wl),iE=pi(Rl),rE=pi(Rl),JT((aE=u((sE=function(){l(this,"format",aE,this),l(this,"loadOp",oE,this),l(this,"storeOp",hE,this),l(this,"sampleCount",lE,this),l(this,"beginLayout",uE,this),l(this,"endLayout",cE,this)}).prototype,"format",[$T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return il.UNKNOWN}}),oE=u(sE.prototype,"loadOp",[tE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Cl.CLEAR}}),hE=u(sE.prototype,"storeOp",[eE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return wl.STORE}}),lE=u(sE.prototype,"sampleCount",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),uE=u(sE.prototype,"beginLayout",[iE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Rl.UNDEFINED}}),cE=u(sE.prototype,"endLayout",[rE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Rl.PRESENT_SRC}}),nE=sE))||nE),QE=(_E=Ne("DepthStencilDesc"),dE=pi(il),pE=pi(Cl),fE=pi(wl),mE=pi(Cl),gE=pi(wl),vE=pi(Rl),yE=pi(Rl),_E((SE=u((EE=function(){l(this,"format",SE,this),l(this,"depthLoadOp",bE,this),l(this,"depthStoreOp",AE,this),l(this,"stencilLoadOp",CE,this),l(this,"stencilStoreOp",wE,this),l(this,"sampleCount",RE,this),l(this,"beginLayout",xE,this),l(this,"endLayout",OE,this)}).prototype,"format",[dE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return il.UNKNOWN}}),bE=u(EE.prototype,"depthLoadOp",[pE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Cl.CLEAR}}),AE=u(EE.prototype,"depthStoreOp",[fE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return wl.STORE}}),CE=u(EE.prototype,"stencilLoadOp",[mE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Cl.CLEAR}}),wE=u(EE.prototype,"stencilStoreOp",[gE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return wl.STORE}}),RE=u(EE.prototype,"sampleCount",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),xE=u(EE.prototype,"beginLayout",[vE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Rl.UNDEFINED}}),OE=u(EE.prototype,"endLayout",[yE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Rl.DEPTH_STENCIL_ATTACHMENT_OPTIMAL}}),TE=EE))||TE);IE=Ne("RenderPassDesc"),ME=pi([ZE]),BE=pi(QE),IE((NE=u((PE=function(){l(this,"index",NE,this),l(this,"colorAttachments",LE,this),l(this,"depthStencilAttachment",FE,this)}).prototype,"index",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),LE=u(PE.prototype,"colorAttachments",[ME],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),FE=u(PE.prototype,"depthStencilAttachment",[BE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new QE}}),PE)),function(t){t[t.FRONT_TO_BACK=0]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=1]="BACK_TO_FRONT"}(YE||(YE={})),Ft(YE);var JE,$E=(DE=Ne("RenderQueueDesc"),UE=pi(YE),kE=pi([he]),DE((HE=u((GE=function(){l(this,"isTransparent",HE,this),l(this,"sortMode",VE,this),l(this,"stages",WE,this)}).prototype,"isTransparent",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),VE=u(GE.prototype,"sortMode",[UE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return YE.FRONT_TO_BACK}}),WE=u(GE.prototype,"stages",[kE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),zE=GE))||zE);!function(t){t[t.GENERAL=100]="GENERAL"}(JE||(JE={}));var tS,eS,iS=t("RenderView",function(){function t(){this._name="",this._window=null,this._priority=0,this._visibility=_f,this._isEnable=!1,this._flows=[]}r(t,[{key:"name",get:function(){return this._name}},{key:"window",get:function(){return this._window},set:function(t){this._window=t}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t,_.director.root&&_.director.root.sortViews()}},{key:"visibility",set:function(t){this._visibility=t},get:function(){return this._visibility}},{key:"camera",get:function(){return this._camera}},{key:"isEnable",get:function(){return this._isEnable}},{key:"flows",get:function(){return this._flows}}]);var e=t.prototype;return e.initialize=function(t){return this._camera=t.camera,this._name=t.name,this.priority=t.priority,this.setExecuteFlows(t.flows),!0},e.destroy=function(){this._window=null,this._priority=0},e.enable=function(t){this._isEnable=t},e.setExecuteFlows=function(t){this._flows.length=0;var e=_.director.root.pipeline.flows;if(t&&1===t.length&&"UIFlow"===t[0]){for(var i=0;i<e.length;i++)if("UIFlow"===e[i].name){this._flows.push(e[i]);break}}else for(var r=0;r<e.length;++r){var n=e[r];(n.tag===jE.SCENE||t&&-1!==t.indexOf(n.name))&&this._flows.push(n)}},e.onGlobalPipelineStateChanged=function(){for(var t=_.director.root.pipeline.flows,e=0;e<this._flows.length;++e)for(var i=this._flows[e],r=0;r<t.length;r++)if(t[r].name===i.name){this._flows[e]=t[r];break}},t}());!function(t){t[t.FORWARD=10]="FORWARD",t[t.UI=20]="UI"}(tS||(tS={})),function(t){t[t.SHADOW=0]="SHADOW",t[t.FORWARD=1]="FORWARD",t[t.UI=10]="UI"}(eS||(eS={}));var rS=t("PipelineStateManager",function(){function t(){}return t.getOrCreatePipelineState=function(t,e,i,r,n){var s=e.handle,a=Do.get(s,Eo.HASH)^r.hash^n.attributesHash^i.id,o=this._PSOHashMap.get(a);if(!o){var h=Co.get(Do.get(s,Eo.PIPELINE_LAYOUT)),l=new bu(n.attributes),u=new Au(i,h,r,l,e.rasterizerState,e.depthStencilState,e.blendState,Do.get(s,Eo.PRIMITIVE),Do.get(s,Eo.DYNAMIC_STATES));o=t.createPipelineState(u),this._PSOHashMap.set(a,o)}return o},t}());function nS(t,e){return t.hash-e.hash||t.depth-e.depth||t.shaderId-e.shaderId}function sS(t,e){return t.hash-e.hash||e.depth-t.depth||t.shaderId-e.shaderId}rS._PSOHashMap=new Map;var aS=function(){function t(t){this.queue=void 0,this._passDesc=void 0,this._passPool=void 0,this._passDesc=t,this._passPool=new Vi((function(){return{hash:0,depth:0,shaderId:0,subModel:null,passIdx:0}}),64),this.queue=new Wi(64,this._passDesc.sortFunc)}var e=t.prototype;return e.clear=function(){this.queue.clear(),this._passPool.reset()},e.insertRenderPass=function(t,e,i){var r=t.model.subModels[e],n=zo.get(r.handle,Lo.PASS_0+i);if(r.passes[i].blendState.targets[0].blend!==this._passDesc.isTransparent||!(Do.get(n,Eo.PHASE)&this._passDesc.phases))return!1;var s=0|Do.get(n,Eo.PRIORITY)<<16|r.priority<<8|i,a=this._passPool.add();return a.hash=s,a.depth=t.depth||0,a.shaderId=zo.get(r.handle,Lo.SHADER_0+i),a.subModel=r,a.passIdx=i,this.queue.push(a),!0},e.sort=function(){this.queue.sort()},e.recordCommandBuffer=function(t,e,i){for(var r=0;r<this.queue.length;++r){var n=this.queue.array[r],s=n.subModel,a=n.passIdx,o=s.inputAssembler,h=s.handle,l=s.passes[a],u=So.get(zo.get(h,Lo.SHADER_0+a)),c=rS.getOrCreatePipelineState(t,l,u,e,o);i.bindPipelineState(c),i.bindDescriptorSet(Cp.MATERIAL,l.descriptorSet),i.bindDescriptorSet(Cp.LOCAL,s.descriptorSet),i.bindInputAssembler(o),i.draw(o)}},t}(),oS=function(){function t(){this.queue=new Set}var e=t.prototype;return e.clear=function(){for(var t=this.queue.values(),e=t.next();!e.done;)e.value.clear(),e=t.next();this.queue.clear()},e.uploadBuffers=function(t){for(var e=this.queue.values(),i=e.next();!i.done;){for(var r=0;r<i.value.batches.length;++r){var n=i.value.batches[r];if(n.mergeCount){for(var s=0;s<n.vbs.length;++s)n.vbs[s].update(n.vbDatas[s]);t.updateBuffer(n.vbIdx,n.vbIdxData.buffer),t.updateBuffer(n.ubo,n.uboData)}}i=e.next()}},e.recordCommandBuffer=function(t,e,i){for(var r=this.queue.values(),n=r.next();!n.done;){for(var s=!1,a=0;a<n.value.batches.length;++a){var o=n.value.batches[a];if(o.mergeCount){if(!s){var h=So.get(o.hShader),l=rS.getOrCreatePipelineState(t,o.pass,h,e,o.ia);i.bindPipelineState(l),i.bindDescriptorSet(Cp.MATERIAL,o.pass.descriptorSet),s=!0}i.bindDescriptorSet(Cp.LOCAL,o.descriptorSet,n.value.dynamicOffsets),i.bindInputAssembler(o.ia),i.draw(o.ia)}}n=r.next()}},t}(),hS=function(){function t(){this.queue=new Set}var e=t.prototype;return e.clear=function(){for(var t=this.queue.values(),e=t.next();!e.done;)e.value.clear(),e=t.next();this.queue.clear()},e.uploadBuffers=function(t){for(var e=this.queue.values(),i=e.next();!i.done;)i.value.hasPendingModels&&i.value.uploadBuffers(t),i=e.next()},e.recordCommandBuffer=function(t,e,i){for(var r=this.queue.values(),n=r.next();!n.done;){var s=n.value,a=s.instances,o=s.pass;if(s.hasPendingModels){i.bindDescriptorSet(Cp.MATERIAL,o.descriptorSet);for(var h=null,l=0;l<a.length;++l){var u=a[l];if(u.count){var c=So.get(u.hShader),_=rS.getOrCreatePipelineState(t,o,c,e,u.ia);h!==_&&(i.bindPipelineState(_),h=_),i.bindDescriptorSet(Cp.LOCAL,bo.get(u.hDescriptorSet),n.value.dynamicOffsets),i.bindInputAssembler(u.ia),i.draw(u.ia)}}}n=r.next()}},t}(),lS=function(){function t(t){this.batches=[],this.dynamicOffsets=[],this._device=void 0,this._device=t.device}t.get=function(e,i){void 0===i&&(i=0);var r=t._buffers;r.has(e)||r.set(e,{});var n=r.get(e);return n[i]||(n[i]=new t(e))};var e=t.prototype;return e.destroy=function(){for(var t=0;t<this.batches.length;++t){for(var e=this.batches[t],i=0;i<e.vbs.length;++i)e.vbs[i].destroy();e.vbIdx.destroy(),e.ia.destroy(),e.ubo.destroy()}this.batches.length=0},e.merge=function(t,e,i){var r=t.subMesh.flatBuffers;if(0!==r.length){for(var n=0,s=0,a=r[0].count,o=t.passes[e],h=zo.get(t.handle,Lo.SHADER_0+e),l=t.descriptorSet,u=!1,c=0;c<this.batches.length;++c){var _=this.batches[c];if(_.vbs.length===r.length&&_.mergeCount<Gp.BATCHING_COUNT){u=!0;for(var d=0;d<_.vbs.length;++d)if(_.vbs[d].stride!==r[d].stride){u=!1;break}if(u){for(var p=0;p<_.vbs.length;++p){var f=r[p],m=_.vbs[p],g=_.vbDatas[p];(n=(a+_.vbCount)*f.stride)>m.size&&(m.resize(n),_.vbDatas[p]=new Uint8Array(n),_.vbDatas[p].set(g)),_.vbDatas[p].set(f.buffer,_.vbCount*f.stride)}var v=_.vbIdxData;(s=4*(a+_.vbCount))>_.vbIdx.size&&(_.vbIdx.resize(s),_.vbIdxData=new Float32Array(s/Float32Array.BYTES_PER_ELEMENT),_.vbIdxData.set(v),v=_.vbIdxData);var y=_.vbCount,T=y+a,E=_.mergeCount;if(v[y]!==E||v[T-1]!==E)for(var S=y;S<T;S++)v[S]=E+.1;return Hs.toArray(_.uboData,i.transform.worldMatrix,Gp.MAT_WORLDS_OFFSET+16*_.mergeCount),_.mergeCount||(l.bindBuffer(Gp.BINDING,_.ubo),l.update(),_.pass=o,_.hShader=h,_.descriptorSet=l),++_.mergeCount,_.vbCount+=a,void(_.ia.vertexCount+=a)}}}for(var b=[],A=[],C=[],w=0;w<r.length;++w){var R=r[w],x=this._device.createBuffer(new Kl(rl.VERTEX|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,R.count*R.stride,R.stride));x.update(R.buffer.buffer),b.push(x),A.push(new Uint8Array(x.size)),C.push(x)}var O=this._device.createBuffer(new Kl(rl.VERTEX|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,4*a,4)),I=new Float32Array(a);I.fill(0),O.update(I),C.push(O);for(var M=t.inputAssembler.attributes,B=new Array(M.length+1),P=0;P<M.length;++P)B[P]=M[P];B[M.length]=new hu("a_dyn_batch_id",il.R32F,!1,r.length);var N=new lu(B,C),L=this._device.createInputAssembler(N),F=this._device.createBuffer(new Kl(rl.UNIFORM|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,Gp.SIZE,Gp.SIZE));l.bindBuffer(Gp.BINDING,F),l.update();var D=new Float32Array(Gp.COUNT);Hs.toArray(D,i.transform.worldMatrix,Gp.MAT_WORLDS_OFFSET),this.batches.push({mergeCount:1,vbs:b,vbDatas:A,vbIdx:O,vbIdxData:I,vbCount:a,ia:L,ubo:F,uboData:D,pass:o,hShader:h,descriptorSet:l})}},e.clear=function(){for(var t=0;t<this.batches.length;++t){var e=this.batches[t];e.vbCount=0,e.mergeCount=0,e.ia.vertexCount=0}},t}();lS._buffers=new Map;var uS,cS=t("InstancedBuffer",function(){function t(t){this.instances=[],this.pass=void 0,this.hasPendingModels=!1,this.dynamicOffsets=[],this._device=void 0,this._device=t.device,this.pass=t}t.get=function(e,i){void 0===i&&(i=0);var r=t._buffers;r.has(e)||r.set(e,{});var n=r.get(e);return n[i]||(n[i]=new t(e))};var e=t.prototype;return e.destroy=function(){for(var t=0;t<this.instances.length;++t){var e=this.instances[t];e.vb.destroy(),e.ia.destroy()}this.instances.length=0},e.merge=function(t,e,i){var r=e.buffer.length;if(r){for(var n=t.inputAssembler,s=t.descriptorSet.getTexture(af),a=zo.get(t.handle,Lo.SHADER_0+i),o=zo.get(t.handle,Lo.DESCRIPTOR_SET),h=0;h<this.instances.length;++h){var l=this.instances[h];if(!(l.ia.indexBuffer!==n.indexBuffer||l.count>=1024)&&l.lightingMap===s){if(l.stride!==r)return;if(l.count>=l.capacity){l.capacity<<=1;var u=l.stride*l.capacity,c=l.data;l.data=new Uint8Array(u),l.data.set(c),l.vb.resize(u)}return l.hShader!==a&&(l.hShader=a),l.hDescriptorSet!==o&&(l.hDescriptorSet=o),l.data.set(e.buffer,l.stride*l.count++),void(this.hasPendingModels=!0)}}for(var _=this._device.createBuffer(new Kl(rl.VERTEX|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,32*r,r)),d=new Uint8Array(32*r),p=n.vertexBuffers.slice(),f=n.attributes.slice(),m=n.indexBuffer,g=0;g<e.attributes.length;g++){var v=e.attributes[g],y=new hu(v.name,v.format,v.isNormalized,p.length,!0);f.push(y)}d.set(e.buffer),p.push(_);var T=new lu(f,p,m),E=this._device.createInputAssembler(T);this.instances.push({count:1,capacity:32,vb:_,data:d,ia:E,stride:r,hShader:a,hDescriptorSet:o,lightingMap:s}),this.hasPendingModels=!0}},e.uploadBuffers=function(t){for(var e=0;e<this.instances.length;++e){var i=this.instances[e];i.count&&(i.ia.instanceCount=i.count,t.updateBuffer(i.vb,i.data))}},e.clear=function(){for(var t=0;t<this.instances.length;++t)this.instances[t].count=0;this.hasPendingModels=!1},t}());function _S(t,e){e<1e3?e=1e3:e>15e3&&(e=15e3);var i=e*e,r=(.860117757+.000154118254*e+1.28641212e-7*i)/(1+.000842420235*e+7.08145163e-7*i),n=(.317398726+422806245e-13*e+4.20481691e-8*i)/(1-289741816e-13*e+1.61456053e-7*i),s=2*r-8*n+4,a=3*r/s,o=2*n/s,h=1/o*a,l=1/o*(1-a-o);t.x=3.2404542*h-1.5371385+-.4985314*l,t.y=-.969266*h+1.8760108+.041556*l,t.z=.0556434*h-.2040259+1.0572252*l}cS._buffers=new Map,function(t){t[t.DIRECTIONAL=0]="DIRECTIONAL",t[t.SPHERE=1]="SPHERE",t[t.SPOT=2]="SPOT",t[t.UNKNOWN=3]="UNKNOWN"}(uS||(uS={}));var dS=function(t){return 4*Math.PI*Math.PI*t*t},pS=function(){function t(){this._color=new Cs(1,1,1),this._colorTemp=6550,this._colorTempRGB=new Cs(1,1,1),this._scene=null,this._node=null,this._name=null,this._handle=0}var e=t.prototype;return e.initialize=function(){this._handle=Ch.alloc(),Ch.setVec3(this._handle,Eh.COLOR,this._color),Ch.setVec3(this._handle,Eh.COLOR_TEMPERATURE_RGB,this._colorTempRGB),Ch.set(this._handle,Eh.TYPE,uS.UNKNOWN)},e.attachToScene=function(t){this._scene=t},e.detachFromScene=function(){this._scene=null},e.destroy=function(){this._name=null,this._node=null,this._handle&&(Ch.free(this._handle),this._handle=0)},e.update=function(){},r(t,[{key:"color",set:function(t){this._color.set(t),Ch.setVec3(this._handle,Eh.COLOR,t)},get:function(){return this._color}},{key:"useColorTemperature",set:function(t){Ch.set(this._handle,Eh.USE_COLOR_TEMPERATURE,t?1:0)},get:function(){return 1===Ch.get(this._handle,Eh.USE_COLOR_TEMPERATURE)}},{key:"colorTemperature",set:function(t){this._colorTemp=t,_S(this._colorTempRGB,this._colorTemp),Ch.setVec3(this._handle,Eh.COLOR_TEMPERATURE_RGB,this._colorTempRGB)},get:function(){return this._colorTemp}},{key:"colorTemperatureRGB",get:function(){return this._colorTempRGB}},{key:"node",set:function(t){this._node=t,this._node&&(this._node.hasChangedFlags|=Uv.ROTATION,Ch.set(this._handle,Eh.NODE,this._node.handle))},get:function(){return this._node}},{key:"type",get:function(){return Ch.get(this._handle,Eh.TYPE)}},{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"scene",get:function(){return this._scene}},{key:"handle",get:function(){return this._handle}}]),t}(),fS=[ml.LINEAR,ml.LINEAR,ml.NONE,gl.CLAMP,gl.CLAMP,gl.CLAMP],mS=new Hi((function(){return{subModel:null,passIdx:-1,dynamicOffsets:[],lights:[]}}),16),gS=new Float32Array(4),vS=Qh.create(0,0,0,1),yS=[],TS=[],ES=new Hs,SS=new Hs;function bS(t,e){return!(!e.worldBounds||a_.aabbWithAABB(e.worldBounds,t.aabb))}function AS(t,e){return!(!e.worldBounds||a_.aabbWithAABB(e.worldBounds,t.aabb)&&a_.aabbFrustum(e.worldBounds,t.frustum))}var CS=Rm("forward-add"),wS=[];function RS(t,e){e.length=0;for(var i=!1,r=0;r<t.length;r++){for(var n=t[r].passes,s=-1,a=0;a<n.length;a++)if(n[a].phase===CS){s=a,i=!0;break}e.push(s)}return i}var xS=function(){function t(t){this._pipeline=void 0,this._device=void 0,this._validLights=[],this._lightPasses=[],this._descriptorSetMap=new Map,this._globalUBO=new Float32Array(Op.COUNT),this._shadowUBO=new Float32Array(Ip.COUNT),this._lightBufferCount=16,this._lightBufferStride=void 0,this._lightBufferElementCount=void 0,this._lightBuffer=void 0,this._firstLightBufferView=void 0,this._lightBufferData=void 0,this._isHDR=void 0,this._fpScale=void 0,this._renderObjects=void 0,this._instancedQueue=void 0,this._batchedQueue=void 0,this._lightMeterScale=1e4,this._sampler=null,this._pipeline=t,this._device=t.device,this._isHDR=t.isHDR,this._fpScale=t.fpScale,this._renderObjects=t.renderObjects,this._instancedQueue=new hS,this._batchedQueue=new oS,this._lightBufferStride=Math.ceil(Hp.SIZE/this._device.uboOffsetAlignment)*this._device.uboOffsetAlignment,this._lightBufferElementCount=this._lightBufferStride/Float32Array.BYTES_PER_ELEMENT,this._lightBuffer=this._device.createBuffer(new Kl(rl.UNIFORM|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,this._lightBufferStride*this._lightBufferCount,this._lightBufferStride)),this._firstLightBufferView=this._device.createBuffer(new Zl(this._lightBuffer,0,Hp.SIZE)),this._lightBufferData=new Float32Array(this._lightBufferElementCount*this._lightBufferCount);var e=Hd(fS);this._sampler=ep.getSampler(this._device,e)}var e=t.prototype;return e.clear=function(){this._instancedQueue.clear(),this._batchedQueue.clear(),this._validLights.length=0;for(var t=0;t<this._lightPasses.length;t++){var e=this._lightPasses[t];e.dynamicOffsets.length=0,e.lights.length=0}mS.freeArray(this._lightPasses),this._lightPasses.length=0},e.destroy=function(){for(var t=Array.from(this._descriptorSetMap.values()),e=0;e<t.length;++e){var i=t[e];i&&(i.getBuffer(Op.BINDING).destroy(),i.getBuffer(Ip.BINDING).destroy(),i.destroy())}this._descriptorSetMap.clear()},e.gatherLightPasses=function(t,e){var i=this._validLights,r=t.camera.scene.sphereLights;this.clear();for(var n=0;n<r.length;n++){var s=r[n];Qh.set(vS,s.position.x,s.position.y,s.position.z,s.range),a_.sphereFrustum(vS,t.camera.frustum)&&(i.push(s),this._getOrCreateDescriptorSet(s))}for(var a=t.camera.scene.spotLights,o=0;o<a.length;o++){var h=a[o];Qh.set(vS,h.position.x,h.position.y,h.position.z,h.range),a_.sphereFrustum(vS,t.camera.frustum)&&(i.push(h),this._getOrCreateDescriptorSet(h))}if(i.length){this._updateUBOs(t,e),this._updateLightDescriptorSet(t,e);for(var l=0;l<this._renderObjects.length;l++){var u=this._renderObjects[l].model,c=u.subModels;if(RS(c,wS)){TS.length=0;for(var _=0;_<i.length;_++){var d=i[_],p=!1;switch(d.type){case uS.SPHERE:p=bS(d,u);break;case uS.SPOT:p=AS(d,u)}p||TS.push(_)}if(TS.length)for(var f=0;f<c.length;f++){var m=wS[f];if(!(m<0)){var g=c[f],v=g.passes[m],y=v.batchingScheme;if(g.descriptorSet.bindBuffer(Hp.BINDING,this._firstLightBufferView),g.descriptorSet.update(),y===Am.INSTANCING)for(var T=0;T<TS.length;T++){var E=TS[T],S=cS.get(v,E);S.merge(g,u.instancedAttributes,m),S.dynamicOffsets[0]=this._lightBufferStride*E,this._instancedQueue.queue.add(S)}else if(y===Am.VB_MERGING)for(var b=0;b<TS.length;b++){var A=TS[b],C=lS.get(v,A);C.merge(g,m,u),C.dynamicOffsets[0]=this._lightBufferStride*A,this._batchedQueue.queue.add(C)}else{var w=mS.alloc();w.subModel=g,w.passIdx=m;for(var R=0;R<TS.length;R++)w.lights.push(i[R]),w.dynamicOffsets.push(this._lightBufferStride*TS[R]);this._lightPasses.push(w)}}}}}this._instancedQueue.uploadBuffers(e),this._batchedQueue.uploadBuffers(e)}},e.recordCommandBuffer=function(t,e,i){this._instancedQueue.recordCommandBuffer(t,e,i),this._batchedQueue.recordCommandBuffer(t,e,i);for(var r=0;r<this._lightPasses.length;r++){var n=this._lightPasses[r],s=n.subModel,a=n.passIdx,o=n.dynamicOffsets,h=n.lights,l=So.get(zo.get(s.handle,Lo.SHADER_0+a)),u=s.passes[a],c=s.inputAssembler,_=rS.getOrCreatePipelineState(t,u,l,e,c),d=bo.get(Do.get(u.handle,Eo.DESCRIPTOR_SET)),p=s.descriptorSet;i.bindPipelineState(_),i.bindDescriptorSet(Cp.MATERIAL,d),i.bindInputAssembler(c);for(var f=0;f<o.length;++f){var m=h[f],g=this._getOrCreateDescriptorSet(m);yS[0]=o[f],i.bindDescriptorSet(Cp.GLOBAL,g),i.bindDescriptorSet(Cp.LOCAL,p,yS),i.draw(c)}}},e._updateLightDescriptorSet=function(t,e){for(var i=this._pipeline.shadows,r=0;r<this._validLights.length;r++){var n=this._validLights[r],s=this._getOrCreateDescriptorSet(n);if(!s)return;switch(s.bindSampler(Mp,this._sampler),s.bindSampler(Dp,this._sampler),s.bindTexture(Mp,wm.get("default-texture").getGFXTexture()),s.update(),this._updateGlobalDescriptorSet(t,e),n.type){case uS.SPHERE:Qs.toArray(this._shadowUBO,i.shadowColor,Ip.SHADOW_COLOR_OFFSET),this._shadowUBO[Ip.SHADOW_INFO_OFFSET+0]=i.size.x,this._shadowUBO[Ip.SHADOW_INFO_OFFSET+1]=i.size.y,this._shadowUBO[Ip.SHADOW_INFO_OFFSET+2]=i.pcf,this._shadowUBO[Ip.SHADOW_INFO_OFFSET+3]=i.bias,s.bindTexture(Dp,wm.get("default-texture").getGFXTexture());break;case uS.SPOT:var a,o=n;Hs.invert(ES,o.node.getWorldMatrix()),Hs.perspective(SS,o.spotAngle,o.aspect,.001,o.range),Hs.multiply(SS,SS,ES),Hs.toArray(this._shadowUBO,SS,Ip.MAT_LIGHT_VIEW_PROJ_OFFSET),Qs.toArray(this._shadowUBO,i.shadowColor,Ip.SHADOW_COLOR_OFFSET),this._shadowUBO[Ip.SHADOW_INFO_OFFSET+0]=i.size.x,this._shadowUBO[Ip.SHADOW_INFO_OFFSET+1]=i.size.y,this._shadowUBO[Ip.SHADOW_INFO_OFFSET+2]=i.pcf,this._shadowUBO[Ip.SHADOW_INFO_OFFSET+3]=i.bias,this._pipeline.shadowFrameBufferMap.has(n)?s.bindTexture(Dp,null===(a=this._pipeline.shadowFrameBufferMap.get(n))||void 0===a?void 0:a.colorTextures[0]):s.bindTexture(Dp,wm.get("default-texture").getGFXTexture())}s.update(),e.updateBuffer(s.getBuffer(Op.BINDING),this._globalUBO),e.updateBuffer(s.getBuffer(Ip.BINDING),this._shadowUBO)}},e._updateGlobalDescriptorSet=function(t){var e=_.director.root,i=this._pipeline.device,r=this._pipeline,n=t.camera,s=n.scene.mainLight,a=r.ambient,o=r.fog,h=this._globalUBO,l=r.shadingScale,u=Math.floor(i.width),c=Math.floor(i.height);h[Op.TIME_OFFSET]=e.cumulativeTime,h[Op.TIME_OFFSET+1]=e.frameTime,h[Op.TIME_OFFSET+2]=_.director.getTotalFrames(),h[Op.SCREEN_SIZE_OFFSET]=i.width,h[Op.SCREEN_SIZE_OFFSET+1]=i.height,h[Op.SCREEN_SIZE_OFFSET+2]=1/h[Op.SCREEN_SIZE_OFFSET],h[Op.SCREEN_SIZE_OFFSET+3]=1/h[Op.SCREEN_SIZE_OFFSET+1],h[Op.SCREEN_SCALE_OFFSET]=n.width/u*l,h[Op.SCREEN_SCALE_OFFSET+1]=n.height/c*l,h[Op.SCREEN_SCALE_OFFSET+2]=1/h[Op.SCREEN_SCALE_OFFSET],h[Op.SCREEN_SCALE_OFFSET+3]=1/h[Op.SCREEN_SCALE_OFFSET+1],h[Op.NATIVE_SIZE_OFFSET]=u,h[Op.NATIVE_SIZE_OFFSET+1]=c,h[Op.NATIVE_SIZE_OFFSET+2]=1/h[Op.NATIVE_SIZE_OFFSET],h[Op.NATIVE_SIZE_OFFSET+3]=1/h[Op.NATIVE_SIZE_OFFSET+1],Hs.toArray(h,n.matView,Op.MAT_VIEW_OFFSET),Hs.toArray(h,n.node.worldMatrix,Op.MAT_VIEW_INV_OFFSET),Hs.toArray(h,n.matProj,Op.MAT_PROJ_OFFSET),Hs.toArray(h,n.matProjInv,Op.MAT_PROJ_INV_OFFSET),Hs.toArray(h,n.matViewProj,Op.MAT_VIEW_PROJ_OFFSET),Hs.toArray(h,n.matViewProjInv,Op.MAT_VIEW_PROJ_INV_OFFSET),Cs.toArray(h,n.position,Op.CAMERA_POS_OFFSET);var d=i.screenSpaceSignY;t.window.hasOffScreenAttachments&&(d*=i.UVSpaceSignY),h[Op.CAMERA_POS_OFFSET+3]=d;var p=n.exposure;if(h[Op.EXPOSURE_OFFSET]=p,h[Op.EXPOSURE_OFFSET+1]=1/p,h[Op.EXPOSURE_OFFSET+2]=this._isHDR?1:0,h[Op.EXPOSURE_OFFSET+3]=this._fpScale/p,s){if(Cs.toArray(h,s.direction,Op.MAIN_LIT_DIR_OFFSET),Cs.toArray(h,s.color,Op.MAIN_LIT_COLOR_OFFSET),s.useColorTemperature){var f=s.colorTemperatureRGB;h[Op.MAIN_LIT_COLOR_OFFSET]*=f.x,h[Op.MAIN_LIT_COLOR_OFFSET+1]*=f.y,h[Op.MAIN_LIT_COLOR_OFFSET+2]*=f.z}this._isHDR?h[Op.MAIN_LIT_COLOR_OFFSET+3]=s.illuminance*this._fpScale:h[Op.MAIN_LIT_COLOR_OFFSET+3]=s.illuminance*p}else Cs.toArray(h,Cs.UNIT_Z,Op.MAIN_LIT_DIR_OFFSET),Os.toArray(h,Os.ZERO,Op.MAIN_LIT_COLOR_OFFSET);var m=a.colorArray;this._isHDR?m[3]=a.skyIllum*this._fpScale:m[3]=a.skyIllum*p,h.set(m,Op.AMBIENT_SKY_OFFSET),h.set(a.albedoArray,Op.AMBIENT_GROUND_OFFSET),o.enabled&&(h.set(o.colorArray,Op.GLOBAL_FOG_COLOR_OFFSET),h[Op.GLOBAL_FOG_BASE_OFFSET]=o.fogStart,h[Op.GLOBAL_FOG_BASE_OFFSET+1]=o.fogEnd,h[Op.GLOBAL_FOG_BASE_OFFSET+2]=o.fogDensity,h[Op.GLOBAL_FOG_ADD_OFFSET]=o.fogTop,h[Op.GLOBAL_FOG_ADD_OFFSET+1]=o.fogRange,h[Op.GLOBAL_FOG_ADD_OFFSET+2]=o.fogAtten)},e._updateUBOs=function(t,e){var i=t.camera.exposure;this._validLights.length>this._lightBufferCount&&(this._firstLightBufferView.destroy(),this._lightBufferCount=Gr(this._validLights.length),this._lightBuffer.resize(this._lightBufferStride*this._lightBufferCount),this._lightBufferData=new Float32Array(this._lightBufferElementCount*this._lightBufferCount),this._firstLightBufferView.initialize(new Zl(this._lightBuffer,0,Hp.SIZE)));for(var r=0,n=0;r<this._validLights.length;r++,n+=this._lightBufferElementCount){var s=this._validLights[r];switch(s.type){case uS.SPHERE:var a=s;if(Cs.toArray(gS,a.position),gS[3]=0,this._lightBufferData.set(gS,n+Hp.LIGHT_POS_OFFSET),gS[0]=a.size,gS[1]=a.range,gS[2]=0,this._lightBufferData.set(gS,n+Hp.LIGHT_SIZE_RANGE_ANGLE_OFFSET),Cs.toArray(gS,s.color),s.useColorTemperature){var o=s.colorTemperatureRGB;gS[0]*=o.x,gS[1]*=o.y,gS[2]*=o.z}this._isHDR?gS[3]=a.luminance*this._fpScale*this._lightMeterScale:gS[3]=a.luminance*i*this._lightMeterScale,this._lightBufferData.set(gS,n+Hp.LIGHT_COLOR_OFFSET);break;case uS.SPOT:var h=s;if(Cs.toArray(gS,h.position),gS[3]=1,this._lightBufferData.set(gS,n+Hp.LIGHT_POS_OFFSET),gS[0]=h.size,gS[1]=h.range,gS[2]=h.spotAngle,this._lightBufferData.set(gS,n+Hp.LIGHT_SIZE_RANGE_ANGLE_OFFSET),Cs.toArray(gS,h.direction),this._lightBufferData.set(gS,n+Hp.LIGHT_DIR_OFFSET),Cs.toArray(gS,s.color),s.useColorTemperature){var l=s.colorTemperatureRGB;gS[0]*=l.x,gS[1]*=l.y,gS[2]*=l.z}this._isHDR?gS[3]=h.luminance*this._fpScale*this._lightMeterScale:gS[3]=h.luminance*i*this._lightMeterScale,this._lightBufferData.set(gS,n+Hp.LIGHT_COLOR_OFFSET)}}e.updateBuffer(this._lightBuffer,this._lightBufferData)},e._getOrCreateDescriptorSet=function(t){if(!this._descriptorSetMap.has(t)){var e=this._device,i=e.createDescriptorSet(new qu(this._pipeline.descriptorSetLayout)),r=e.createBuffer(new Kl(rl.UNIFORM|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,Op.SIZE,Op.SIZE));i.bindBuffer(Op.BINDING,r);var n=e.createBuffer(new Kl(rl.UNIFORM|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,Ip.SIZE,Ip.SIZE));return i.bindBuffer(Ip.BINDING,n),i.update(),this._descriptorSetMap.set(t,i),i}return this._descriptorSetMap.get(t)},t}(),OS=Pt({Planar:0,ShadowMap:1}),IS=Pt({HARD:0,FILTER_X5:1,FILTER_X9:2,FILTER_X25:3}),MS=OS.ShadowMap+1,BS=function(){function t(){this.sphere=new Qh(0,0,0,.01),this.maxReceived=4,this._normal=new Cs(0,1,0),this._shadowColor=new Qs(0,0,0,76),this._matLight=new Hs,this._material=null,this._instancingMaterial=null,this._size=new Es(512,512),this._handle=0,this._handle=Sh.alloc()}r(t,[{key:"enabled",get:function(){return!!Sh.get(this._handle,vh.ENABLE)},set:function(t){Sh.set(this._handle,vh.ENABLE,t?1:0),t||Sh.set(this._handle,vh.TYPE,MS),t?this.activate():this._updatePipeline()}},{key:"normal",get:function(){return this._normal},set:function(t){Cs.copy(this._normal,t),Sh.setVec3(this._handle,vh.NORMAL,this._normal)}},{key:"distance",get:function(){return Sh.get(this._handle,vh.DISTANCE)},set:function(t){Sh.set(this._handle,vh.DISTANCE,t)}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(t){this._shadowColor=t,Sh.setVec4(this._handle,vh.COLOR,t)}},{key:"type",get:function(){return Sh.get(this._handle,vh.TYPE)},set:function(t){Sh.set(this._handle,vh.TYPE,this.enabled?t:MS),this._updatePipeline(),this._updatePlanarInfo()}},{key:"near",get:function(){return Sh.get(this._handle,vh.NEAR)},set:function(t){Sh.set(this._handle,vh.NEAR,t)}},{key:"far",get:function(){return Sh.get(this._handle,vh.FAR)},set:function(t){Sh.set(this._handle,vh.FAR,t)}},{key:"aspect",get:function(){return Sh.get(this._handle,vh.ASPECT)},set:function(t){Sh.set(this._handle,vh.ASPECT,t)}},{key:"orthoSize",get:function(){return Sh.get(this._handle,vh.ORTHO_SIZE)},set:function(t){Sh.set(this._handle,vh.ORTHO_SIZE,t)}},{key:"size",get:function(){return this._size},set:function(t){this._size=t,Sh.setVec2(this._handle,vh.SIZE,this._size)}},{key:"pcf",get:function(){return Sh.get(this._handle,vh.PCF_TYPE)},set:function(t){Sh.set(this._handle,vh.PCF_TYPE,t)}},{key:"shadowMapDirty",get:function(){return!!Sh.get(this._handle,vh.SHADOW_MAP_DIRTY)},set:function(t){Sh.set(this._handle,vh.SHADOW_MAP_DIRTY,t?1:0)}},{key:"bias",get:function(){return Sh.get(this._handle,vh.BIAS)},set:function(t){Sh.set(this._handle,vh.BIAS,t)}},{key:"autoAdapt",get:function(){return!!Sh.get(this._handle,vh.AUTO_ADAPT)},set:function(t){Sh.set(this._handle,vh.AUTO_ADAPT,t?1:0)}},{key:"matLight",get:function(){return this._matLight}},{key:"material",get:function(){return this._material}},{key:"instancingMaterial",get:function(){return this._instancingMaterial}},{key:"handle",get:function(){return this._handle}}]);var e=t.prototype;return e.initialize=function(t){Sh.set(this._handle,vh.TYPE,t.enabled?t.type:MS),Sh.set(this._handle,vh.NEAR,t.near),Sh.set(this._handle,vh.FAR,t.far),Sh.set(this._handle,vh.ASPECT,t.aspect),Sh.set(this._handle,vh.ORTHO_SIZE,t.orthoSize),this._size=t.shadowMapSize,Sh.setVec2(this._handle,vh.SIZE,this._size),Sh.set(this._handle,vh.PCF_TYPE,t.pcf),Cs.copy(this._normal,t.normal),Sh.setVec3(this._handle,vh.NORMAL,this._normal),Sh.set(this._handle,vh.DISTANCE,t.distance),this._shadowColor.set(t.shadowColor),Sh.setVec4(this._handle,vh.COLOR,this._shadowColor),Sh.set(this._handle,vh.BIAS,t.bias),Sh.set(this._handle,vh.ENABLE,t.enabled?1:0),this.maxReceived=t.maxReceived,Sh.set(this._handle,vh.AUTO_ADAPT,t.autoAdapt?1:0)},e.activate=function(){this.enabled&&this.type!==OS.ShadowMap?this._updatePlanarInfo():this._updatePipeline()},e._updatePlanarInfo=function(){this._material||(this._material=new mg,this._material.initialize({effectName:"planar-shadow"}),Sh.set(this._handle,vh.PLANAR_PASS,this._material.passes[0].handle),Sh.set(this._handle,vh.PLANAR_SHADER,this._material.passes[0].getShaderVariant(null))),this._instancingMaterial||(this._instancingMaterial=new mg,this._instancingMaterial.initialize({effectName:"planar-shadow",defines:{USE_INSTANCING:!0}}),Sh.set(this._handle,vh.INSTANCE_PASS,this._instancingMaterial.passes[0].handle))},e._updatePipeline=function(){var t=_.director.root,e=t.pipeline,i=this.enabled&&this.type===OS.ShadowMap;e.macros.CC_RECEIVE_SHADOW!==i&&(e.macros.CC_RECEIVE_SHADOW=i,t.onGlobalPipelineStateChanged())},e.destroy=function(){this._material&&this._material.destroy(),this._instancingMaterial&&this._instancingMaterial.destroy(),this._handle&&(Sh.free(this._handle),this._handle=0),this.sphere.destroy()},t}();BS.MAX_FAR=2e3,BS.COEFFICIENT_OF_EXPANSION=2*Math.sqrt(3),_.Shadows=BS;var PS,NS,LS,FS,DS,US,kS,zS,GS,HS,VS,WS,jS,XS,YS,qS,KS=new y_,ZS=function(){function t(t){this._pendingModels=[],this._instancedQueue=new hS,this._pipeline=void 0,this._pipeline=t}var e=t.prototype;return e.gatherShadowPasses=function(t,e){var i=this._pipeline.shadows;if(i.enabled&&i.type===OS.Planar){var r=t.camera,n=r.scene,s=r.frustum,a=0!=(r.visibility&vp.BitMask.DEFAULT);if(n.mainLight&&a){var o=n.models;this._pendingModels.length=0;var h=cS.get(i.instancingMaterial.passes[0]);this._instancedQueue.clear(),this._instancedQueue.queue.add(h);for(var l=0;l<o.length;l++){var u=o[l];if(u.enabled&&u.node&&u.castShadow&&(!u.worldBounds||(y_.transform(KS,u.worldBounds,i.matLight),a_.aabbFrustum(KS,s))))if(u.isInstancingEnabled)for(var c=0;c<u.subModels.length;c++)h.merge(u.subModels[c],u.instancedAttributes,0);else this._pendingModels.push(u)}this._instancedQueue.uploadBuffers(e)}}},e.recordCommandBuffer=function(t,e,i){var r=this._pipeline.shadows;if(r.enabled&&r.type===OS.Planar&&this._pendingModels.length){this._instancedQueue.recordCommandBuffer(t,e,i);var n=r.material.passes[0],s=bo.get(Do.get(n.handle,Eo.DESCRIPTOR_SET));i.bindDescriptorSet(Cp.MATERIAL,s);for(var a=So.get(Sh.get(r.handle,vh.PLANAR_SHADER)),o=this._pendingModels.length,h=0;h<o;h++)for(var l=this._pendingModels[h],u=0;u<l.subModels.length;u++){var c=l.subModels[u],_=c.inputAssembler,d=rS.getOrCreatePipelineState(t,n,a,e,_);i.bindPipelineState(d),i.bindDescriptorSet(Cp.LOCAL,c.descriptorSet),i.bindInputAssembler(_),i.draw(_)}}},t}(),QS=[new du(0,0,0,1)],JS=t("ForwardStage",(PS=Ne("ForwardStage"),NS=pi([$E]),LS=si(),PS((zS=kS=function(t){function e(){var e;return l(e=t.call(this)||this,"renderQueues",US,a(e)),e._renderQueues=[],e._renderArea=new cu,e._batchedQueue=void 0,e._instancedQueue=void 0,e._phaseID=Rm("default"),e._batchedQueue=new oS,e._instancedQueue=new hS,e}s(e,t);var i=e.prototype;return i.initialize=function(e){return t.prototype.initialize.call(this,e),e.renderQueues&&(this.renderQueues=e.renderQueues),!0},i.activate=function(e,i){t.prototype.activate.call(this,e,i);for(var r=0;r<this.renderQueues.length;r++){for(var n=0,s=0;s<this.renderQueues[r].stages.length;s++)n|=Rm(this.renderQueues[r].stages[s]);var a=nS;switch(this.renderQueues[r].sortMode){case YE.BACK_TO_FRONT:a=sS;break;case YE.FRONT_TO_BACK:a=nS}this._renderQueues[r]=new aS({isTransparent:this.renderQueues[r].isTransparent,phases:n,sortFunc:a})}this._additiveLightQueue=new xS(this._pipeline),this._planarQueue=new ZS(this._pipeline)},i.destroy=function(){},i.render=function(t){this._instancedQueue.clear(),this._batchedQueue.clear();var e=this._pipeline,i=e.device;this._renderQueues.forEach(this.renderQueueClearFunc);for(var r=e.renderObjects,n=0,s=0,a=0,o=0;o<r.length;++o){var h=r[o],l=h.model.subModels;for(n=0;n<l.length;++n){var u=l[n],c=u.passes;for(s=0;s<c.length;++s){var _=c[s];if(_.phase===this._phaseID){var d=_.batchingScheme;if(d===Am.INSTANCING){var p=cS.get(_);p.merge(u,h.model.instancedAttributes,s),this._instancedQueue.queue.add(p)}else if(d===Am.VB_MERGING){var f=lS.get(_);f.merge(u,s,h.model),this._batchedQueue.queue.add(f)}else for(a=0;a<this._renderQueues.length;a++)this._renderQueues[a].insertRenderPass(h,n,s)}}}}this._renderQueues.forEach(this.renderQueueSortFunc);var m=e.commandBuffers[0];this._instancedQueue.uploadBuffers(m),this._batchedQueue.uploadBuffers(m),this._additiveLightQueue.gatherLightPasses(t,m),this._planarQueue.gatherShadowPasses(t,m);var g,v,y=t.camera,T=y.viewport,E=t.window.hasOnScreenAttachments&&i.surfaceTransform%2?y.height:y.width,S=t.window.hasOnScreenAttachments&&i.surfaceTransform%2?y.width:y.height;if(this._renderArea.x=T.x*E,this._renderArea.y=T.y*S,this._renderArea.width=T.width*E*e.shadingScale,this._renderArea.height=T.height*S*e.shadingScale,y.clearFlag&Bl.COLOR)if(e.isHDR){g=QS[0],v=y.clearColor,g.x=v.x*v.x,g.y=v.y*v.y,g.z=v.z*v.z;var b=e.fpScale/y.exposure;QS[0].x*=b,QS[0].y*=b,QS[0].z*=b}else QS[0].x=y.clearColor.x,QS[0].y=y.clearColor.y,QS[0].z=y.clearColor.z;QS[0].w=y.clearColor.w;var A=t.window.framebuffer,C=A.colorTextures[0]?A.renderPass:e.getRenderPass(y.clearFlag);m.beginRenderPass(C,A,this._renderArea,QS,y.clearDepth,y.clearStencil),m.bindDescriptorSet(Cp.GLOBAL,e.descriptorSet),this._renderQueues[0].recordCommandBuffer(i,C,m),this._instancedQueue.recordCommandBuffer(i,C,m),this._batchedQueue.recordCommandBuffer(i,C,m),this._additiveLightQueue.recordCommandBuffer(i,C,m),this._planarQueue.recordCommandBuffer(i,C,m),this._renderQueues[1].recordCommandBuffer(i,C,m),m.endRenderPass()},i.renderQueueClearFunc=function(t){t.clear()},i.renderQueueSortFunc=function(t){t.sort()},e}(lT),kS.initInfo={name:"ForwardStage",priority:tS.FORWARD,tag:0,renderQueues:[{isTransparent:!1,sortMode:YE.FRONT_TO_BACK,stages:["default"]},{isTransparent:!0,sortMode:YE.BACK_TO_FRONT,stages:["default","planarShadow"]}]},US=u((DS=zS).prototype,"renderQueues",[NS,ke,LS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),FS=DS))||FS)),$S=t("ForwardFlow",Ne("ForwardFlow")((VS=HS=function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;return i.initialize=function(e){if(t.prototype.initialize.call(this,e),0===this._stages.length){var i=new JS;i.initialize(JS.initInfo),this._stages.push(i)}return!0},i.activate=function(e){t.prototype.activate.call(this,e)},i.render=function(e){this._pipeline.updateUBOs(e),t.prototype.render.call(this,e)},i.destroy=function(){t.prototype.destroy.call(this)},e}(yT),HS.initInfo={name:"ForwardFlow",priority:eS.FORWARD,stages:[]},GS=VS))||GS);!function(t){t[t.VERTICAL=0]="VERTICAL",t[t.HORIZONTAL=1]="HORIZONTAL"}(WS||(WS={})),function(t){t[t.ORTHO=0]="ORTHO",t[t.PERSPECTIVE=1]="PERSPECTIVE"}(jS||(jS={})),function(t){t[t.F1_8=0]="F1_8",t[t.F2_0=1]="F2_0",t[t.F2_2=2]="F2_2",t[t.F2_5=3]="F2_5",t[t.F2_8=4]="F2_8",t[t.F3_2=5]="F3_2",t[t.F3_5=6]="F3_5",t[t.F4_0=7]="F4_0",t[t.F4_5=8]="F4_5",t[t.F5_0=9]="F5_0",t[t.F5_6=10]="F5_6",t[t.F6_3=11]="F6_3",t[t.F7_1=12]="F7_1",t[t.F8_0=13]="F8_0",t[t.F9_0=14]="F9_0",t[t.F10_0=15]="F10_0",t[t.F11_0=16]="F11_0",t[t.F13_0=17]="F13_0",t[t.F14_0=18]="F14_0",t[t.F16_0=19]="F16_0",t[t.F18_0=20]="F18_0",t[t.F20_0=21]="F20_0",t[t.F22_0=22]="F22_0"}(XS||(XS={})),function(t){t[t.ISO100=0]="ISO100",t[t.ISO200=1]="ISO200",t[t.ISO400=2]="ISO400",t[t.ISO800=3]="ISO800"}(YS||(YS={})),function(t){t[t.D1=0]="D1",t[t.D2=1]="D2",t[t.D4=2]="D4",t[t.D8=3]="D8",t[t.D15=4]="D15",t[t.D30=5]="D30",t[t.D60=6]="D60",t[t.D125=7]="D125",t[t.D250=8]="D250",t[t.D500=9]="D500",t[t.D1000=10]="D1000",t[t.D2000=11]="D2000",t[t.D4000=12]="D4000"}(qS||(qS={}));var tb=[1.8,2,2.2,2.5,2.8,3.2,3.5,4,4.5,5,5.6,6.3,7.1,8,9,10,11,13,14,16,18,20,22],eb=[1,.5,1/4,1/8,1/15,1/30,1/60,.008,.004,.002,.001,5e-4,1/4e3],ib=[100,200,400,800],rb=new Cs,nb=new Cs,sb=new Hs,ab=(new Hs,Bl.STENCIL<<1),ob=[],hb=function(){function t(t){if(this.isWindowSize=!0,this.screenScale=void 0,this._device=void 0,this._scene=null,this._node=null,this._name=null,this._enabled=!1,this._proj=-1,this._aspect=void 0,this._orthoHeight=10,this._fovAxis=WS.VERTICAL,this._fov=Pr(45),this._nearClip=1,this._farClip=1e3,this._clearColor=new du(.2,.2,.2,1),this._viewport=new Ks(0,0,1,1),this._curTransform=Ll.IDENTITY,this._isProjDirty=!0,this._matView=new Hs,this._matViewInv=null,this._matProj=new Hs,this._matProjInv=new Hs,this._matViewProj=new Hs,this._matViewProjInv=new Hs,this._frustum=new x_,this._forward=new Cs,this._position=new Cs,this._view=null,this._visibility=_f,this._priority=0,this._aperture=XS.F16_0,this._apertureValue=void 0,this._shutter=qS.D125,this._shutterValue=0,this._iso=YS.ISO100,this._isoValue=0,this._ec=0,this._poolHandle=0,this._frustumHandle=0,this._device=t,this._apertureValue=tb[this._aperture],this._shutterValue=eb[this._shutter],this._isoValue=ib[this._iso],this._aspect=this.screenScale=1,!ob.length){var e=t.screenSpaceSignY;ob[Ll.IDENTITY]=new Hs(1,0,0,0,0,e),ob[Ll.ROTATE_90]=new Hs(0,1,0,0,-e,0),ob[Ll.ROTATE_180]=new Hs(-1,0,0,0,0,-e),ob[Ll.ROTATE_270]=new Hs(0,-1,0,0,e,0)}}var e=t.prototype;return e.initialize=function(t){this._name=t.name,this._node=t.node,this._proj=t.projection,this._priority=t.priority||0,this._aspect=this.screenScale=1;var e=this._poolHandle=Jo.alloc();Jo.set(e,Yo.WIDTH,1),Jo.set(e,Yo.HEIGHT,1),Jo.set(e,Yo.CLEAR_FLAG,Bl.NONE),Jo.set(e,Yo.CLEAR_DEPTH,1),Jo.set(e,Yo.NODE,this._node.handle),this._scene&&Jo.set(e,Yo.SCENE,this._scene.handle),this.updateExposure(),this._view=_.director.root.createView({camera:this,name:this._name,priority:this._priority,flows:t.flows}),_.director.root.attachCamera(this),this.changeTargetWindow(t.window),console.log("Created Camera: "+this._name+" "+Jo.get(e,Yo.WIDTH)+"x"+Jo.get(e,Yo.HEIGHT))},e.destroy=function(){_.director.root.detachCamera(this),this._view&&(this._view.destroy(),this._view=null),this._name=null,this._poolHandle&&(Jo.free(this._poolHandle),this._poolHandle=0,this._frustumHandle&&(uh.free(this._frustumHandle),this._frustumHandle=0))},e.attachToScene=function(t){this._scene=t,Jo.set(this._poolHandle,Yo.SCENE,t.handle),this._view&&this._view.enable(!0)},e.detachFromScene=function(){this._scene=null,Jo.set(this._poolHandle,Yo.SCENE,0),this._view&&this._view.enable(!1)},e.resize=function(t,e){var i=this._poolHandle;Jo.set(i,Yo.WIDTH,t),Jo.set(i,Yo.HEIGHT,e),this._aspect=t*this._viewport.width/(e*this._viewport.height),this._isProjDirty=!0},e.setFixedSize=function(t,e){var i=this._poolHandle;Jo.set(i,Yo.WIDTH,t),Jo.set(i,Yo.HEIGHT,e),this._aspect=t*this._viewport.width/(e*this._viewport.height),this.isWindowSize=!1},e.update=function(t){if(void 0===t&&(t=!1),this._node){var e=!1;(this._node.hasChangedFlags||t)&&(Hs.invert(this._matView,this._node.worldMatrix),Jo.setMat4(this._poolHandle,Yo.MAT_VIEW,this._matView),this._forward.x=-this._matView.m02,this._forward.y=-this._matView.m06,this._forward.z=-this._matView.m10,this._node.getWorldPosition(this._position),Jo.setVec3(this._poolHandle,Yo.POSITION,this._position),Jo.setVec3(this._poolHandle,Yo.FORWARD,this._forward),e=!0);var i=this._device.surfaceTransform;if(this._isProjDirty||this._curTransform!==i){this._curTransform=i;var r=this._device.screenSpaceSignY;if(this._view&&this._view.window.hasOffScreenAttachments&&(r*=this._device.UVSpaceSignY,i=Ll.IDENTITY),this._proj===jS.PERSPECTIVE)Hs.perspective(this._matProj,this._fov,this._aspect,this._nearClip,this._farClip,this._fovAxis===WS.VERTICAL,this._device.clipSpaceMinZ,r,i);else{var n=this._orthoHeight*this._aspect,s=this._orthoHeight;Hs.ortho(this._matProj,-n,n,-s,s,this._nearClip,this._farClip,this._device.clipSpaceMinZ,r,i)}Hs.invert(this._matProjInv,this._matProj),Jo.setMat4(this._poolHandle,Yo.MAT_PROJ,this._matProj),Jo.setMat4(this._poolHandle,Yo.MAT_PROJ_INV,this._matProjInv),e=!0,this._isProjDirty=!1}e&&(Hs.multiply(this._matViewProj,this._matProj,this._matView),Hs.invert(this._matViewProjInv,this._matViewProj),this._frustum.update(this._matViewProj,this._matViewProjInv),Jo.setMat4(this._poolHandle,Yo.MAT_VIEW_PROJ,this._matViewProj),Jo.setMat4(this._poolHandle,Yo.MAT_VIEW_PROJ_INV,this._matViewProjInv),O_(this._frustumHandle,this._frustum))}},e.changeTargetWindow=function(t){void 0===t&&(t=null);var e=t||_.director.root.mainWindow;e&&this._view&&(this._view.window=e,this.resize(e.width,e.height))},e.screenPointToRay=function(t,e,i){if(!this._node)return null;var r=this._poolHandle,n=Jo.get(r,Yo.WIDTH),s=Jo.get(r,Yo.HEIGHT),a=this._viewport.x*n,o=this._viewport.y*s,h=this._viewport.width*n,l=this._viewport.height*s,u=this._proj===jS.PERSPECTIVE,c=this._device.screenSpaceSignY,_=Gs[this._curTransform];Cs.set(rb,(e-a)/h*2-1,(i-o)/l*2-1,u?1:-1);var d=rb.x,p=rb.y;return rb.x=d*_[0]+p*_[2]*c,rb.y=d*_[1]+p*_[3]*c,Cs.transformMat4(u?rb:t.o,rb,this._matViewProjInv),u?(this._node.getWorldPosition(nb),uo.fromPoints(t,nb,rb)):Cs.transformQuat(t.d,Cs.FORWARD,this._node.worldRotation),t},e.screenToWorld=function(t,e){var i=this._poolHandle,r=Jo.get(i,Yo.WIDTH),n=Jo.get(i,Yo.HEIGHT),s=this._viewport.x*r,a=this._viewport.y*n,o=this._viewport.width*r,h=this._viewport.height*n,l=this._device.screenSpaceSignY,u=Gs[this._curTransform];if(this._proj===jS.PERSPECTIVE){Cs.set(t,(e.x-s)/o*2-1,(e.y-a)/h*2-1,1);var c=t.x,_=t.y;t.x=c*u[0]+_*u[2]*l,t.y=c*u[1]+_*u[3]*l,Cs.transformMat4(t,t,this._matViewProjInv),this._node&&this._node.getWorldPosition(rb),Cs.lerp(t,rb,t,Br(this._nearClip/this._farClip,1,e.z))}else{Cs.set(t,(e.x-s)/o*2-1,(e.y-a)/h*2-1,2*e.z-1);var d=t.x,p=t.y;t.x=d*u[0]+p*u[2]*l,t.y=d*u[1]+p*u[3]*l,Cs.transformMat4(t,t,this._matViewProjInv)}return t},e.worldToScreen=function(t,e){var i=this._poolHandle,r=Jo.get(i,Yo.WIDTH),n=Jo.get(i,Yo.HEIGHT),s=this._viewport.x*r,a=this._viewport.y*n,o=this._viewport.width*r,h=this._viewport.height*n,l=this._device.screenSpaceSignY,u=Gs[this._curTransform];Cs.transformMat4(t,e,this._matViewProj);var c=t.x,_=t.y;return t.x=c*u[0]+_*u[2]*l,t.y=c*u[1]+_*u[3]*l,t.x=s+.5*(t.x+1)*o,t.y=a+.5*(t.y+1)*h,t.z=.5*t.z+.5,t},e.worldMatrixToScreen=function(t,e,i,r){Hs.multiply(t,this._matViewProj,e),Hs.multiply(t,ob[this._curTransform],t);var n=i/2,s=r/2;return Hs.identity(sb),Hs.transform(sb,sb,Cs.set(rb,n,s,0)),Hs.scale(sb,sb,Cs.set(rb,n,s,1)),Hs.multiply(t,sb,t),t},e.updateExposure=function(){var t=Math.log2(this._apertureValue*this._apertureValue/this._shutterValue*100/this._isoValue);Jo.set(this._poolHandle,Yo.EXPOSURE,.833333/Math.pow(2,t))},r(t,[{key:"node",set:function(t){this._node=t},get:function(){return this._node}},{key:"enabled",set:function(t){this._enabled=t,this._view&&this._view.enable(t)},get:function(){return this._enabled}},{key:"view",get:function(){return this._view}},{key:"orthoHeight",set:function(t){this._orthoHeight=t,this._isProjDirty=!0},get:function(){return this._orthoHeight}},{key:"projectionType",set:function(t){this._proj=t,this._isProjDirty=!0},get:function(){return this._proj}},{key:"fovAxis",set:function(t){this._fovAxis=t,this._isProjDirty=!0},get:function(){return this._fovAxis}},{key:"fov",set:function(t){this._fov=t,this._isProjDirty=!0},get:function(){return this._fov}},{key:"nearClip",set:function(t){this._nearClip=t,this._isProjDirty=!0},get:function(){return this._nearClip}},{key:"farClip",set:function(t){this._farClip=t,this._isProjDirty=!0},get:function(){return this._farClip}},{key:"clearColor",set:function(t){this._clearColor.x=t.x,this._clearColor.y=t.y,this._clearColor.z=t.z,this._clearColor.w=t.w,Jo.setVec4(this._poolHandle,Yo.CLEAR_COLOR,t)},get:function(){return this._clearColor}},{key:"viewport",get:function(){return this._viewport},set:function(t){var e=t.x,i=t.width,r=t.height,n=this._device.screenSpaceSignY<0?1-t.y-r:t.y;switch(this._device.surfaceTransform){case Ll.ROTATE_90:this._viewport.x=1-n-r,this._viewport.y=e,this._viewport.width=r,this._viewport.height=i;break;case Ll.ROTATE_180:this._viewport.x=1-e-i,this._viewport.y=1-n-r,this._viewport.width=i,this._viewport.height=r;break;case Ll.ROTATE_270:this._viewport.x=n,this._viewport.y=1-e-i,this._viewport.width=r,this._viewport.height=i;break;case Ll.IDENTITY:this._viewport.x=e,this._viewport.y=n,this._viewport.width=i,this._viewport.height=r}Jo.setVec4(this._poolHandle,Yo.VIEW_PORT,this._viewport),this.resize(this.width,this.height)}},{key:"scene",get:function(){return this._scene}},{key:"name",get:function(){return this._name}},{key:"width",get:function(){return Jo.get(this._poolHandle,Yo.WIDTH)}},{key:"height",get:function(){return Jo.get(this._poolHandle,Yo.HEIGHT)}},{key:"aspect",get:function(){return this._aspect}},{key:"matView",set:function(t){this._matView=t,Jo.setMat4(this._poolHandle,Yo.MAT_VIEW,this._matView)},get:function(){return this._matView}},{key:"matViewInv",set:function(t){this._matViewInv=t},get:function(){return this._matViewInv||this._node.worldMatrix}},{key:"matProj",set:function(t){this._matProj=t,Jo.setMat4(this._poolHandle,Yo.MAT_PROJ,this._matProj)},get:function(){return this._matProj}},{key:"matProjInv",set:function(t){this._matProjInv=t,Jo.setMat4(this._poolHandle,Yo.MAT_PROJ_INV,this._matProjInv)},get:function(){return this._matProjInv}},{key:"matViewProj",set:function(t){this._matViewProj=t,Jo.setMat4(this._poolHandle,Yo.MAT_VIEW_PROJ,this._matViewProj)},get:function(){return this._matViewProj}},{key:"matViewProjInv",set:function(t){this._matViewProjInv=t,Jo.setMat4(this._poolHandle,Yo.MAT_VIEW_PROJ_INV,this._matViewProjInv)},get:function(){return this._matViewProjInv}},{key:"frustum",set:function(t){this._frustum=t,O_(this._frustumHandle,t)},get:function(){return this._frustum}},{key:"forward",set:function(t){this._forward=t,Jo.setVec3(this._poolHandle,Yo.FORWARD,this._forward)},get:function(){return this._forward}},{key:"position",set:function(t){this._position=t,Jo.setVec3(this._poolHandle,Yo.POSITION,this._position)},get:function(){return this._position}},{key:"visibility",set:function(t){this._visibility=t,this._view&&(this._view.visibility=t)},get:function(){return this._visibility}},{key:"priority",get:function(){return this._view?this._view.priority:-1},set:function(t){this._priority=t,this._view&&(this._view.priority=this._priority)}},{key:"aperture",set:function(t){this._aperture=t,this._apertureValue=tb[this._aperture],this.updateExposure()},get:function(){return this._aperture}},{key:"apertureValue",get:function(){return this._apertureValue}},{key:"shutter",set:function(t){this._shutter=t,this._shutterValue=eb[this._shutter],this.updateExposure()},get:function(){return this._shutter}},{key:"shutterValue",get:function(){return this._shutterValue}},{key:"iso",set:function(t){this._iso=t,this._isoValue=ib[this._iso],this.updateExposure()},get:function(){return this._iso}},{key:"isoValue",get:function(){return this._isoValue}},{key:"ec",set:function(t){this._ec=t},get:function(){return this._ec}},{key:"exposure",get:function(){return Jo.get(this._poolHandle,Yo.EXPOSURE)}},{key:"flows",set:function(t){this._view&&this._view.setExecuteFlows(t)}},{key:"clearFlag",get:function(){return Jo.get(this._poolHandle,Yo.CLEAR_FLAG)},set:function(t){Jo.set(this._poolHandle,Yo.CLEAR_FLAG,t)}},{key:"clearDepth",get:function(){return Jo.get(this._poolHandle,Yo.CLEAR_DEPTH)},set:function(t){Jo.set(this._poolHandle,Yo.CLEAR_DEPTH,t)}},{key:"clearStencil",get:function(){return Jo.get(this._poolHandle,Yo.CLEAR_STENCIL)},set:function(t){Jo.set(this._poolHandle,Yo.CLEAR_STENCIL,t)}},{key:"handle",get:function(){return this._poolHandle}}]),t}(),lb=new Cs,ub=new Cs,cb=new Cs,_b=new Hs,db=new y_,pb=!1,fb=[],mb=Qh.create(0,0,0,1),gb=new Hi((function(){return{model:null,depth:0}}),128),vb=new Hi((function(){return{model:null,depth:0}}),128);function yb(t,e){var i=0;t.node&&(Cs.subtract(lb,t.node.worldPosition,e.position),i=Cs.dot(lb,e.forward));var r=gb.alloc();return r.model=t,r.depth=i,r}function Tb(t,e){var i=0;t.node&&(Cs.subtract(lb,t.node.worldPosition,e.position),i=Cs.dot(lb,e.forward));var r=vb.alloc();return r.model=t,r.depth=i,r}function Eb(t,e,i,r){var n=t.shadows;Cs.negate(ub,i);var s=n.sphere.radius*BS.COEFFICIENT_OF_EXPANSION;return Cs.multiplyScalar(cb,ub,s),Cs.add(cb,cb,n.sphere.center),r.set(cb),Hs.fromRT(_b,e,cb),_b}function Sb(t,e){var i=e.camera,r=i.scene,n=r.mainLight,s=t.shadows,a=t.renderObjects;gb.freeArray(a),a.length=0,s.enabled&&Qs.toArray(t.shadowUBO,s.shadowColor,Ip.SHADOW_COLOR_OFFSET),n&&s.type===OS.Planar&&function(t,e){var i=t.shadows,r=e.direction,n=i.normal,s=i.distance+.001,a=1/Cs.dot(n,r),o=r.x*a,h=r.y*a,l=r.z*a,u=n.x,c=n.y,_=n.z,d=i.matLight;d.m00=1-u*o,d.m01=-u*h,d.m02=-u*l,d.m03=0,d.m04=-c*o,d.m05=1-c*h,d.m06=-c*l,d.m07=0,d.m08=-_*o,d.m09=-_*h,d.m10=1-_*l,d.m11=0,d.m12=o*s,d.m13=h*s,d.m14=l*s,d.m15=1,Hs.toArray(t.shadowUBO,i.matLight,Ip.MAT_LIGHT_PLANE_PROJ_OFFSET)}(t,n),t.skybox.enabled&&t.skybox.model&&i.clearFlag&ab&&a.push(yb(t.skybox.model,i));for(var o=r.models,h=0;h<o.length;h++){var l=o[h];if(l.enabled)if(e.visibility&vp.BitMask.UI_2D)(l.node&&e.visibility===l.node.layer||e.visibility===l.visFlags)&&a.push(yb(l,i));else if(l.node&&(e.visibility&l.node.layer)===l.node.layer||e.visibility&l.visFlags){if(l.worldBounds&&!a_.aabbFrustum(l.worldBounds,i.frustum))continue;a.push(yb(l,i))}}}var bb,Ab,Cb,wb,Rb,xb,Ob=new Hs,Ib=new Hs,Mb=new Os,Bb=new Cs,Pb=Rm("shadow-caster"),Nb=function(){function t(t){this._pipeline=void 0,this._subModelsArray=[],this._passArray=[],this._shaderArray=[],this._shadowMapBuffer=void 0,this._device=void 0,this._shadowInfo=void 0,this._descriptorSet=void 0,this._shadowObjects=void 0,this._shadowUBO=void 0,this._instancedQueue=void 0,this._batchedQueue=void 0,this._pipeline=t,this._device=t.device,this._shadowInfo=t.shadows,this._descriptorSet=t.descriptorSet,this._shadowObjects=t.shadowObjects,this._shadowUBO=t.shadowUBO,this._shadowMapBuffer=t.descriptorSet.getBuffer(Ip.BINDING),this._instancedQueue=new hS,this._batchedQueue=new oS}var e=t.prototype;return e.gatherLightPasses=function(t,e){if(this.clear(),t&&this._shadowInfo.enabled&&this._shadowInfo.type===OS.ShadowMap){this._updateUBOs(t);for(var i=0;i<this._shadowObjects.length;i++){var r=this._shadowObjects[i].model;switch(t.type){case uS.DIRECTIONAL:this.add(r,e);break;case uS.SPOT:var n=t;if(r.worldBounds&&(!a_.aabbWithAABB(r.worldBounds,n.aabb)||!a_.aabbFrustum(r.worldBounds,n.frustum)))continue;this.add(r,e)}}}},e.clear=function(){this._subModelsArray.length=0,this._shaderArray.length=0,this._passArray.length=0,this._instancedQueue.clear(),this._batchedQueue.clear()},e.add=function(t,e){var i=t.subModels,r=function(t){for(var e=0;e<t.length;e++)for(var i=t[e].passes,r=0;r<i.length;r++)if(i[r].phase===Pb)return r;return-1}(i);if(!(r<0)){for(var n=0;n<i.length;n++){var s=i[n],a=s.passes[r],o=a.batchingScheme;if(s.descriptorSet.bindBuffer(Ip.BINDING,this._shadowMapBuffer),s.descriptorSet.update(),o===Am.INSTANCING){var h=cS.get(a);h.merge(s,t.instancedAttributes,r),this._instancedQueue.queue.add(h)}else if(a.batchingScheme===Am.VB_MERGING){var l=lS.get(a);l.merge(s,r,t),this._batchedQueue.queue.add(l)}else{var u=So.get(zo.get(s.handle,Lo.SHADER_0+r));this._subModelsArray.push(s),this._shaderArray.push(u),this._passArray.push(a)}}this._instancedQueue.uploadBuffers(e),this._batchedQueue.uploadBuffers(e)}},e.recordCommandBuffer=function(t,e,i){this._instancedQueue.recordCommandBuffer(t,e,i),this._batchedQueue.recordCommandBuffer(t,e,i);for(var r=0;r<this._subModelsArray.length;++r){var n=this._subModelsArray[r],s=this._shaderArray[r],a=this._passArray[r],o=n.inputAssembler,h=rS.getOrCreatePipelineState(t,a,s,e,o),l=a.descriptorSet;i.bindPipelineState(h),i.bindDescriptorSet(Cp.MATERIAL,l),i.bindDescriptorSet(Cp.LOCAL,n.descriptorSet),i.bindInputAssembler(o),i.draw(o)}},e._updateUBOs=function(t){switch(t.type){case uS.DIRECTIONAL:var e,i=t;i.update();var r=0,n=0,s=0;if(this._shadowInfo.autoAdapt){var a;e=Eb(this._pipeline,null===(a=i.node)||void 0===a?void 0:a.getWorldRotation(),i.direction,Bb);var o=this._shadowInfo.sphere.radius;r=o*this._shadowInfo.aspect,n=o;var h=Cs.distance(this._shadowInfo.sphere.center,Bb);s=Math.min(h*BS.COEFFICIENT_OF_EXPANSION,BS.MAX_FAR)}else e=i.node.getWorldMatrix(),r=this._shadowInfo.orthoSize*this._shadowInfo.aspect,n=this._shadowInfo.orthoSize,s=this._shadowInfo.far;Hs.invert(Ob,e);var l=this._device.screenSpaceSignY*this._device.UVSpaceSignY;Hs.ortho(Ib,-r,r,-n,n,this._shadowInfo.near,s,this._device.clipSpaceMinZ,l);break;case uS.SPOT:var u=t;Hs.invert(Ob,u.node.getWorldMatrix()),Hs.perspective(Ib,u.spotAngle,u.aspect,.001,u.range)}Hs.multiply(Ib,Ib,Ob),Hs.toArray(this._shadowUBO,Ib,Ip.MAT_LIGHT_VIEW_PROJ_OFFSET),Qs.toArray(this._shadowUBO,this._shadowInfo.shadowColor,Ip.SHADOW_COLOR_OFFSET),Mb.set(this._shadowInfo.size.x,this._shadowInfo.size.y,this._shadowInfo.pcf,this._shadowInfo.bias),Os.toArray(this._shadowUBO,Mb,Ip.SHADOW_INFO_OFFSET),this._descriptorSet.getBuffer(Ip.BINDING).update(this._shadowUBO)},t}(),Lb=[new du(1,1,1,1)],Fb=t("ShadowStage",Ne("ShadowStage")((Cb=Ab=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._shadowFrameBuffer=null,e._renderArea=new cu,e._light=null,e}s(e,t);var i=e.prototype;return i.setUsage=function(t,e){this._light=t,this._shadowFrameBuffer=e},i.destroy=function(){this._additiveShadowQueue.clear()},i.render=function(t){var e=this._pipeline,i=e.shadows,r=e.commandBuffers[0];if(this._light&&this._shadowFrameBuffer){this._additiveShadowQueue.gatherLightPasses(this._light,r);var n=t.camera,s=n.viewport,a=i.size;this._renderArea.x=s.x*a.x,this._renderArea.y=s.y*a.y,this._renderArea.width=s.width*a.x*e.shadingScale,this._renderArea.height=s.height*a.y*e.shadingScale;var o=e.device,h=this._shadowFrameBuffer.renderPass;r.beginRenderPass(h,this._shadowFrameBuffer,this._renderArea,Lb,n.clearDepth,n.clearStencil),r.bindDescriptorSet(Cp.GLOBAL,e.descriptorSet),this._additiveShadowQueue.recordCommandBuffer(o,h,r),r.endRenderPass()}},i.activate=function(e,i){t.prototype.activate.call(this,e,i),this._additiveShadowQueue=new Nb(e)},e}(lT),Ab.initInfo={name:"ShadowStage",priority:tS.FORWARD,tag:0},bb=Cb))||bb),Db=[ml.LINEAR,ml.LINEAR,ml.NONE,gl.CLAMP,gl.CLAMP,gl.CLAMP],Ub=t("ShadowFlow",Ne("ShadowFlow")((xb=Rb=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._shadowRenderPass=null,e._globalBinding=!1,e}s(e,t);var i=e.prototype;return i.initialize=function(e){if(t.prototype.initialize.call(this,e),0===this._stages.length){var i=new Fb;i.initialize(Fb.initInfo),this._stages.push(i)}return!0},i.render=function(t){var e=this._pipeline,i=e.shadows;if(i.type===OS.ShadowMap){var r=function(t,e){fb.length=0;var i=t.camera.scene;fb.push(i.mainLight);for(var r=i.spotLights,n=0;n<r.length;n++){var s=r[n];Qh.set(mb,s.position.x,s.position.y,s.position.z,s.range),a_.sphereFrustum(mb,t.camera.frustum)&&e>fb.length&&fb.push(s)}return fb}(t,i.maxReceived);!function(t,e){var i=e.camera,r=i.scene,n=t.shadows,s=t.shadowObjects;vb.freeArray(s),s.length=0,pb=!1;for(var a=r.models,o=0;o<a.length;o++){var h=a[o];(h.node&&(e.visibility&h.node.layer)===h.node.layer||e.visibility&h.visFlags)&&h.castShadow&&h.worldBounds&&(pb||(db.copy(h.worldBounds),pb=!0),y_.merge(db,db,h.worldBounds),s.push(Tb(h,i)))}db&&y_.toBoundingSphere(n.sphere,db)}(e,t);for(var n=0;n<r.length;n++){var s=r[n];e.shadowFrameBufferMap.has(s)||this._initShadowFrameBuffer(e,s);var a=e.shadowFrameBufferMap.get(s);i.shadowMapDirty&&this.resizeShadowMap(s,i.size);for(var o=0;o<this._stages.length;o++){var h=this._stages[o];h.setUsage(s,a),h.render(t)}}}},i.destroy=function(){t.prototype.destroy.call(this);for(var e=Array.from(this._pipeline.shadowFrameBufferMap.values()),i=0;i<e.length;i++){var r=e[i];if(r){for(var n=r.colorTextures,s=0;s<n.length;s++){var a=n[i];a&&a.destroy()}n.length=0;var o=r.depthStencilTexture;o&&o.destroy(),r.destroy()}}this._pipeline.shadowFrameBufferMap.clear(),this._shadowRenderPass&&this._shadowRenderPass.destroy(),this._globalBinding=!1},i._initShadowFrameBuffer=function(t,e){var i=t.device,r=t.shadows.size;if(!this._shadowRenderPass){var n=new xu;n.format=il.RGBA8,n.loadOp=Cl.CLEAR,n.storeOp=wl.STORE,n.sampleCount=1,n.beginLayout=Rl.UNDEFINED,n.endLayout=Rl.PRESENT_SRC;var s=new Ou;s.format=i.depthStencilFormat,s.depthLoadOp=Cl.CLEAR,s.depthStoreOp=wl.STORE,s.stencilLoadOp=Cl.CLEAR,s.stencilStoreOp=wl.STORE,s.sampleCount=1,s.beginLayout=Rl.UNDEFINED,s.endLayout=Rl.DEPTH_STENCIL_ATTACHMENT_OPTIMAL;var a=new Mu([n],s);this._shadowRenderPass=i.createRenderPass(a)}var o=[];o.push(i.createTexture(new Gu(vl.TEX2D,yl.COLOR_ATTACHMENT|yl.SAMPLED,il.RGBA8,r.x,r.y)));var h=i.createTexture(new Gu(vl.TEX2D,yl.DEPTH_STENCIL_ATTACHMENT,i.depthStencilFormat,r.x,r.y)),l=i.createFramebuffer(new ru(this._shadowRenderPass,o,h));if(t.shadowFrameBufferMap.set(e,l),!this._globalBinding){var u=Hd(Db),c=ep.getSampler(i,u);t.descriptorSet.bindSampler(Mp,c),t.descriptorSet.bindTexture(Mp,wm.get("default-texture").getGFXTexture()),t.descriptorSet.bindSampler(Dp,c),t.descriptorSet.bindTexture(Dp,wm.get("default-texture").getGFXTexture()),this._globalBinding=!0}e&&e.type===uS.DIRECTIONAL&&t.descriptorSet.bindTexture(Mp,l.colorTextures[0])},i.resizeShadowMap=function(t,e){var i=e.x,r=e.y,n=this._pipeline;if(n.shadowFrameBufferMap.has(t)){var s=n.shadowFrameBufferMap.get(t);if(!s)return;var a=s.colorTextures;if(a&&a.length>0)for(var o=0;o<a.length;o++){var h=a[o];h&&h.resize(i,r)}var l=s.depthStencilTexture;l&&l.resize(i,r);var u=s.renderPass;s.destroy(),s.initialize(new ru(u,a,l))}},e}(yT),Rb.initInfo={name:"ShadowFlow",priority:eS.SHADOW,tag:jE.SCENE,stages:[]},wb=xb))||wb),kb=Pt({LINEAR:0,EXP:1,EXP_SQUARED:2,LAYERED:3}),zb=kb.LAYERED+1,Gb=function(){function t(){this._fogColor=new Qs("#C8C8C8"),this._colorArray=new Float32Array([.2,.2,.2,1]),this._handle=0,this._handle=yh.alloc()}r(t,[{key:"enabled",set:function(t){yh.set(this._handle,ph.ENABLE,t?1:0),t||yh.set(this._handle,ph.TYPE,zb),t?this.activate():this._updatePipeline()},get:function(){return yh.get(this._handle,ph.ENABLE)}},{key:"fogColor",set:function(t){this._fogColor.set(t),Qs.toArray(this._colorArray,this._fogColor),yh.setVec4(this._handle,ph.COLOR,this._fogColor)},get:function(){return this._fogColor}},{key:"type",get:function(){return yh.get(this._handle,ph.TYPE)},set:function(t){yh.set(this._handle,ph.TYPE,this.enabled?t:zb),this.enabled&&this._updatePipeline()}},{key:"fogDensity",get:function(){return yh.get(this._handle,ph.DENSITY)},set:function(t){yh.set(this._handle,ph.DENSITY,t)}},{key:"fogStart",get:function(){return yh.get(this._handle,ph.START)},set:function(t){yh.set(this._handle,ph.START,t)}},{key:"fogEnd",get:function(){return yh.get(this._handle,ph.END)},set:function(t){yh.set(this._handle,ph.END,t)}},{key:"fogAtten",get:function(){return yh.get(this._handle,ph.ATTEN)},set:function(t){yh.set(this._handle,ph.ATTEN,t)}},{key:"fogTop",get:function(){return yh.get(this._handle,ph.TOP)},set:function(t){yh.set(this._handle,ph.TOP,t)}},{key:"fogRange",get:function(){return yh.get(this._handle,ph.RANGE)},set:function(t){yh.set(this._handle,ph.RANGE,t)}},{key:"colorArray",get:function(){return this._colorArray}},{key:"handle",get:function(){return this._handle}}]);var e=t.prototype;return e.initialize=function(t){yh.set(this._handle,ph.ENABLE,t.enabled?1:0),yh.set(this._handle,ph.TYPE,t.enabled?t.type:zb),this._fogColor.set(t.fogColor),Qs.toArray(this._colorArray,this._fogColor),yh.setVec4(this._handle,ph.COLOR,this._fogColor),yh.set(this._handle,ph.DENSITY,t.fogDensity),yh.set(this._handle,ph.START,t.fogStart),yh.set(this._handle,ph.END,t.fogEnd),yh.set(this._handle,ph.ATTEN,t.fogAtten),yh.set(this._handle,ph.TOP,t.fogTop),yh.set(this._handle,ph.RANGE,t.fogRange)},e.activate=function(){this._updatePipeline()},e._updatePipeline=function(){var t=_.director.root,e=this.enabled?this.type:zb,i=t.pipeline;i.macros.CC_USE_FOG!==e&&(i.macros.CC_USE_FOG=e,t.onGlobalPipelineStateChanged())},e.destroy=function(){this._handle&&(yh.free(this._handle),this._handle=0)},t}();_.Fog=Gb;var Hb,Vb=function(){function t(){this._skyColor=new Qs(51,128,204,1),this._groundAlbedo=new Qs(51,51,51,255),this._albedoArray=Float32Array.from([.2,.2,.2,1]),this._colorArray=Float32Array.from([.2,.5,.8,1]),this._handle=0,this._handle=dh.alloc()}r(t,[{key:"colorArray",get:function(){return this._colorArray}},{key:"albedoArray",get:function(){return this._albedoArray}},{key:"enabled",set:function(t){dh.set(this._handle,hh.ENABLE,t?1:0)},get:function(){return dh.get(this._handle,hh.ENABLE)}},{key:"skyColor",get:function(){return this._skyColor},set:function(t){this._skyColor.set(t),Qs.toArray(this._colorArray,this._skyColor),dh.setVec4(this._handle,hh.SKY_COLOR,this._skyColor)}},{key:"skyIllum",get:function(){return dh.get(this._handle,hh.ILLUM)},set:function(t){dh.set(this._handle,hh.ILLUM,t)}},{key:"groundAlbedo",get:function(){return this._groundAlbedo},set:function(t){this._groundAlbedo.set(t),Cs.toArray(this._albedoArray,this._groundAlbedo),dh.setVec4(this._handle,hh.GROUND_ALBEDO,this._groundAlbedo)}},{key:"handle",get:function(){return this._handle}}]);var e=t.prototype;return e.initialize=function(t){this._skyColor.set(t.skyColor),this._groundAlbedo.set(t.groundAlbedo),Qs.toArray(this._colorArray,this._skyColor),Cs.toArray(this._albedoArray,this._groundAlbedo),dh.setVec4(this._handle,hh.SKY_COLOR,this._skyColor),dh.setVec4(this._handle,hh.GROUND_ALBEDO,this._groundAlbedo),dh.set(this._handle,hh.ILLUM,t.skyIllum)},e.destroy=function(){this._handle&&(dh.free(this._handle),this._handle=0)},t}();function Wb(t,e){if(!e){var i=_.director.getScene();if(!i)return null;e=i}return e.getChildByPath(t)}Vb.SUN_ILLUM=65e3,Vb.SKY_ILLUM=2e4,_.Ambient=Vb,_.find=Wb,function(t){t[t.positions=tl.ATTR_POSITION]="positions",t[t.normals=tl.ATTR_NORMAL]="normals",t[t.uvs=tl.ATTR_TEX_COORD]="uvs",t[t.colors=tl.ATTR_COLOR]="colors"}(Hb||(Hb={}));var jb=[new hu(tl.ATTR_POSITION,il.RGB32F),new hu(tl.ATTR_NORMAL,il.RGB32F),new hu(tl.ATTR_TEX_COORD,il.RG32F),new hu(tl.ATTR_TANGENT,il.RGBA32F),new hu(tl.ATTR_COLOR,il.RGBA32F)],Xb=new Cs;function Yb(t,e,i){i=i||{};var r,n=[],s=0,a=[],o=0,l=t.positions.slice();if(l.length>0){if(r=null,t.attributes)for(var u,c=h(t.attributes);!(u=c()).done;){var _=u.value;if(_.name===tl.ATTR_POSITION){r=_;break}}r||(r=jb[0]),n.push(r);var d=zl[r.format];o=Math.max(o,Math.floor(l.length/d.count)),a.push({offset:s,data:l,attribute:r}),s+=d.size}if(t.normals&&t.normals.length>0){if(r=null,t.attributes)for(var p,f=h(t.attributes);!(p=f()).done;){var m=p.value;if(m.name===tl.ATTR_NORMAL){r=m;break}}r||(r=jb[1]);var g=zl[r.format];n.push(r),o=Math.max(o,Math.floor(t.normals.length/g.count)),a.push({offset:s,data:t.normals,attribute:r}),s+=g.size}if(t.uvs&&t.uvs.length>0){if(r=null,t.attributes)for(var v,y=h(t.attributes);!(v=y()).done;){var T=v.value;if(T.name===tl.ATTR_TEX_COORD){r=T;break}}r||(r=jb[2]);var E=zl[r.format];n.push(r),o=Math.max(o,Math.floor(t.uvs.length/E.count)),a.push({offset:s,data:t.uvs,attribute:r}),s+=E.size}if(t.tangents&&t.tangents.length>0){if(r=null,t.attributes)for(var S,b=h(t.attributes);!(S=b()).done;){var A=S.value;if(A.name===tl.ATTR_TANGENT){r=A;break}}r||(r=jb[3]);var C=zl[r.format];n.push(r),o=Math.max(o,Math.floor(t.tangents.length/C.count)),a.push({offset:s,data:t.tangents,attribute:r}),s+=C.size}if(t.colors&&t.colors.length>0){if(r=null,t.attributes)for(var w,R=h(t.attributes);!(w=R()).done;){var x=w.value;if(x.name===tl.ATTR_COLOR){r=x;break}}r||(r=jb[4]);var O=zl[r.format];n.push(r),o=Math.max(o,Math.floor(t.colors.length/O.count)),a.push({offset:s,data:t.colors,attribute:r}),s+=O.size}if(t.customAttributes)for(var I,M=h(t.customAttributes);!(I=M()).done;){var B=I.value,P=zl[B.attr.format];n.push(B.attr),o=Math.max(o,Math.floor(B.values.length/P.count)),a.push({offset:s,data:B.values,attribute:B.attr}),s+=P.size}for(var N=new Ed,L=new ArrayBuffer(o*s),F=new DataView(L),D=0,U=a;D<U.length;D++){var k=U[D];Ad(F,k.data,k.attribute.format,k.offset,s)}N.setNextAlignment(0);var z={attributes:n,view:{offset:N.getLength(),length:L.byteLength,count:o,stride:s}};N.addBuffer(L);var G=null,H=0;if(t.indices){var V=t.indices;H=V.length,G=new ArrayBuffer(2*H),Ad(new DataView(G),V,il.R16UI)}var W={primitiveMode:t.primitiveMode||ol.TRIANGLE_LIST,vertexBundelIndices:[0]};G&&(N.setNextAlignment(2),W.indexView={offset:N.getLength(),length:G.byteLength,count:H,stride:2},N.addBuffer(G));var j=t.minPos;if(!j&&i.calculateBounds){j=Cs.set(new Cs,1/0,1/0,1/0);for(var X=0;X<o;++X)Cs.set(Xb,l[3*X+0],l[3*X+1],l[3*X+2]),Cs.min(j,j,Xb)}var Y=t.maxPos;if(!Y&&i.calculateBounds){Y=Cs.set(new Cs,-1/0,-1/0,-1/0);for(var q=0;q<o;++q)Cs.set(Xb,l[3*q+0],l[3*q+1],l[3*q+2]),Cs.max(Y,Y,Xb)}var K={vertexBundles:[z],primitives:[W]};return j&&(K.minPosition=new Cs(j.x,j.y,j.z)),Y&&(K.maxPosition=new Cs(Y.x,Y.y,Y.z)),e||(e=new Bf),e.reset({struct:K,data:new Uint8Array(N.getCombined())}),e}var qb=Object.freeze({__proto__:null,find:Wb,toPPM:function(t,e,i){return"P3 "+e+" "+i+" 255\n"+t.filter((function(t,e){return e%4<3})).toString()+"\n"},readMesh:function(t,e){void 0===e&&(e=0);for(var i,r={positions:[]},n=new DataView(t.data.buffer,t.data.byteOffset,t.data.byteLength),s=t.struct,a=s.primitives[e],o=h(a.vertexBundelIndices);!(i=o()).done;)for(var l,u=i.value,c=s.vertexBundles[u],_=c.view.offset,d=c.view,p=d.length,f=d.stride,m=h(c.attributes);!(l=m()).done;){var g=l.value,v=Hb[g.name];v&&(r[v]=(r[v]||[]).concat(Cd(n,g.format,_,p,f))),_+=zl[g.format].size}var y=a.indexView;return r.indices=Cd(n,il["R"+8*y.stride+"UI"],y.offset,y.length),r},createMesh:Yb,readBuffer:Cd,writeBuffer:Ad,mapBuffer:wd});function Kb(t){return void 0===(t=t||{}).includeNormal&&(t.includeNormal=!0),void 0===t.includeUV&&(t.includeUV=!0),t}function Zb(t){var e=(t=t||{}).widthSegments||1,i=t.heightSegments||1,r=t.lengthSegments||1,n=(t.width||1)/2,s=(t.height||1)/2,a=(t.length||1)/2,o=[Cs.set(eA,-n,-s,a),Cs.set(iA,n,-s,a),Cs.set(rA,n,s,a),Cs.set(nA,-n,s,a),Cs.set(sA,n,-s,-a),Cs.set(aA,-n,-s,-a),Cs.set(oA,-n,s,-a),Cs.set(hA,n,s,-a)],h=[[2,3,1],[4,5,7],[7,6,2],[1,0,4],[1,4,2],[5,0,6]],l=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],u=[[-1,0,0,1],[-1,0,0,1],[-1,0,0,1],[-1,0,0,1],[0,0,-1,1],[0,0,1,1]],c=[],_=[],d=[],p=[],f=[],m=new Cs(-n,-s,-a),g=new Cs(n,s,a),v=Math.sqrt(n*n+s*s+a*a);function y(t,e,i){var r,n,s,a,m=c.length/3,g=h[t],v=l[t],y=u[t];for(a=0;a<=i;a++)for(s=0;s<=e;s++)if(r=s/e,n=a/i,Cs.lerp(Qb,o[g[0]],o[g[1]],r),Cs.lerp(Jb,o[g[0]],o[g[2]],n),Cs.subtract($b,Jb,o[g[0]]),Cs.add(tA,Qb,$b),c.push(tA.x,tA.y,tA.z),_.push(v[0],v[1],v[2]),d.push(r,n),p.push(y[0],y[1],y[2],y[3]),s<e&&a<i){var T=e+1,E=s+a*T,S=s+(a+1)*T,b=s+1+(a+1)*T,A=s+1+a*T;f.push(m+E,m+A,m+S),f.push(m+S,m+A,m+b)}}return y(0,e,i),y(4,r,i),y(1,e,i),y(5,r,i),y(3,e,r),y(2,e,r),{positions:c,normals:_,uvs:d,tangents:p,indices:f,minPos:m,maxPos:g,boundingRadius:v}}t("utils",qb);var Qb=new Cs,Jb=new Cs,$b=new Cs,tA=new Cs,eA=new Cs,iA=new Cs,rA=new Cs,nA=new Cs,sA=new Cs,aA=new Cs,oA=new Cs,hA=new Cs,lA=new Cs(0,0,0),uA=new Cs(0,0,0);function cA(t,e,i,r){void 0===t&&(t=.5),void 0===e&&(e=.5),void 0===i&&(i=2),void 0===r&&(r={});var n=.5*i,s=r.radialSegments||32,a=r.heightSegments||1,o=void 0===r.capped||r.capped,h=r.arc||2*Math.PI,l=0;o||(t>0&&l++,e>0&&l++);var u=(s+1)*(a+1);o&&(u+=(s+1)*l+s*l);var c=s*a*6;o&&(c+=s*l*3);var _=new Array(c),d=new Array(3*u),p=new Array(3*u),f=new Array(2*u),m=Math.max(t,e),g=new Cs(-m,-n,-m),v=new Cs(m,n,m),y=Math.sqrt(m*m+n*n),T=0,E=0;return function(){for(var r=[],o=t-e,l=o*o/i*Math.sign(o),u=0;u<=a;u++){for(var c=[],m=u/a,g=m*o+e,v=0;v<=s;++v){var y=v/s,S=y*h,b=Math.sin(S),A=Math.cos(S);d[3*T]=g*b,d[3*T+1]=m*i-n,d[3*T+2]=g*A,Cs.normalize(lA,Cs.set(uA,b,-l,A)),p[3*T]=lA.x,p[3*T+1]=lA.y,p[3*T+2]=lA.z,f[2*T]=2*(1-y)%1,f[2*T+1]=m,c.push(T),++T}r.push(c)}for(var C=0;C<a;++C)for(var w=0;w<s;++w){var R=r[C][w],x=r[C+1][w],O=r[C+1][w+1],I=r[C][w+1];_[E]=R,++E,_[E]=I,++E,_[E]=x,++E,_[E]=I,++E,_[E]=O,++E,_[E]=x,++E}}(),o&&(e>0&&S(!1),t>0&&S(!0)),{positions:d,normals:p,uvs:f,indices:_,minPos:g,maxPos:v,boundingRadius:y};function S(i){for(var r=i?t:e,a=i?1:-1,o=T,l=1;l<=s;++l)d[3*T]=0,d[3*T+1]=n*a,d[3*T+2]=0,p[3*T]=0,p[3*T+1]=a,p[3*T+2]=0,f[2*T]=.5,f[2*T+1]=.5,++T;for(var u=T,c=0;c<=s;++c){var m=c/s*h,g=Math.cos(m),v=Math.sin(m);d[3*T]=r*v,d[3*T+1]=n*a,d[3*T+2]=r*g,p[3*T]=0,p[3*T+1]=a,p[3*T+2]=0,f[2*T]=.5-.5*v*a,f[2*T+1]=.5+.5*g,++T}for(var y=0;y<s;++y){var S=o+y,b=u+y;i?(_[E]=b+1,++E,_[E]=S,++E,_[E]=b,++E):(_[E]=S,++E,_[E]=b+1,++E,_[E]=b,++E)}}}var _A=new Cs(0,0,0),dA=new Cs(0,0,0),pA=new Cs(0,0,0),fA=new Cs(0,0,0),mA=new Cs(0,0,0),gA=new Cs(0,0,0),vA=new Cs(0,0,0),yA=new Cs(0,0,0),TA=new Cs(0,0,0),EA=Object.freeze({__proto__:null,box:Zb,cone:function(t,e,i){return void 0===t&&(t=.5),void 0===e&&(e=1),void 0===i&&(i={}),cA(0,t,e,i)},cylinder:cA,plane:function(t){var e=function(t){return(t=Kb(t)).width=t.width||10,t.length=t.length||10,t.widthSegments=t.widthSegments||10,t.lengthSegments=t.lengthSegments||10,t}(t),i=e.width,r=e.length,n=e.widthSegments,s=e.lengthSegments,a=.5*i,o=.5*r,h=[],l=[],u=[],c=new Cs(-a,0,-o),_=new Cs(a,0,o),d=Math.sqrt(i*i+r*r);Cs.set(mA,-a,0,o),Cs.set(gA,a,0,o),Cs.set(vA,-a,0,-o);for(var p=0;p<=s;p++)for(var f=0;f<=n;f++){var m=f/n,g=p/s;if(Cs.lerp(_A,mA,gA,m),Cs.lerp(dA,mA,vA,g),Cs.subtract(pA,dA,mA),Cs.add(fA,_A,pA),h.push(fA.x,fA.y,fA.z),e.includeUV&&l.push(m,g),f<n&&p<s){var v=n+1,y=f+p*v,T=f+(p+1)*v,E=f+1+(p+1)*v,S=f+1+p*v;u.push(y,S,T),u.push(S,E,T)}}var b={positions:h,indices:u,minPos:c,maxPos:_,boundingRadius:d};if(e.includeNormal){var A=(s+1)*(n+1),C=new Array(3*A);b.normals=C;for(var w=0;w<A;++w)C[3*w+0]=0,C[3*w+1]=1,C[3*w+2]=0}return e.includeUV&&(b.uvs=l),b},quad:function(t){var e=Kb(t),i={positions:[-.5,-.5,0,-.5,.5,0,.5,.5,0,.5,-.5,0],indices:[0,3,1,3,2,1],minPos:{x:-.5,y:-.5,z:0},maxPos:{x:.5,y:.5,z:0},boundingRadius:Math.sqrt(.5)};return!1!==e.includeNormal&&(i.normals=[0,0,1,0,0,1,0,0,1,0,0,1]),!1!==e.includeUV&&(i.uvs=[0,0,0,1,1,1,1,0]),i},sphere:function(t,e){void 0===t&&(t=.5),void 0===e&&(e={});for(var i=void 0!==e.segments?e.segments:32,r=[],n=[],s=[],a=[],o=new Cs(-t,-t,-t),h=new Cs(t,t,t),l=t,u=0;u<=i;++u)for(var c=u*Math.PI/i,_=Math.sin(c),d=-Math.cos(c),p=0;p<=i;++p){var f=2*p*Math.PI/i-Math.PI/2,m=Math.sin(f)*_,g=d,v=Math.cos(f)*_,y=p/i,T=u/i;if(r.push(m*t,g*t,v*t),n.push(m,g,v),s.push(y,T),u<i&&p<i){var E=i+1,S=E*u+p,b=E*(u+1)+p,A=E*(u+1)+p+1,C=E*u+p+1;a.push(S,C,b),a.push(C,A,b)}}return{positions:r,indices:a,normals:n,uvs:s,minPos:o,maxPos:h,boundingRadius:l}},torus:function(t,e,i){void 0===t&&(t=.4),void 0===e&&(e=.1),void 0===i&&(i={});for(var r=i.radialSegments||32,n=i.tubularSegments||32,s=i.arc||2*Math.PI,a=[],o=[],h=[],l=[],u=new Cs(-t-e,-e,-t-e),c=new Cs(t+e,e,t+e),_=t+e,d=0;d<=r;d++)for(var p=0;p<=n;p++){var f=p/n,m=d/r,g=f*s,v=m*Math.PI*2,y=(t+e*Math.cos(v))*Math.sin(g),T=e*Math.sin(v),E=(t+e*Math.cos(v))*Math.cos(g),S=Math.sin(g)*Math.cos(v),b=Math.sin(v),A=Math.cos(g)*Math.cos(v);if(a.push(y,T,E),o.push(S,b,A),h.push(f,m),p<n&&d<r){var C=n+1,w=C*d+p,R=C*(d+1)+p,x=C*(d+1)+p+1,O=C*d+p+1;l.push(w,O,R),l.push(O,x,R)}}return{positions:a,normals:o,uvs:h,indices:l,minPos:u,maxPos:c,boundingRadius:_}},capsule:function(t,e,i,r){void 0===t&&(t=.5),void 0===e&&(e=.5),void 0===i&&(i=2),void 0===r&&(r={});var n=i-t-e,s=r.sides||32,a=r.heightSegments||32,o=e/i,h=n/i,l=t/i,u=Math.floor(a*o),c=Math.floor(a*l),_=Math.floor(a*h),d=n+e-i/2,p=e-i/2,f=e-i/2,m=r.arc||2*Math.PI,g=[],v=[],y=[],T=[],E=Math.max(t,e),S=new Cs(-E,-i/2,-E),b=new Cs(E,i/2,E),A=i/2,C=0,w=[];return function(){for(var t=0;t<=u;++t)for(var i=t*Math.PI/u/2,r=Math.sin(i),n=-Math.cos(i),o=0;o<=s;++o){var h=2*o*Math.PI/s-Math.PI/2,l=Math.sin(h)*r,c=n,_=Math.cos(h)*r,d=o/s,p=t/a;if(g.push(l*e,c*e+f,_*e),v.push(l,c,_),y.push(d,p),t<u&&o<s){var m=s+1,E=m*t+o,S=m*(t+1)+o,b=m*(t+1)+o+1,A=m*t+o+1;T.push(E,A,S),T.push(A,b,S)}++C}}(),function(){for(var i=(t-e)/n,r=0;r<=_;r++){for(var a=[],l=r/_,u=l*(t-e)+e,c=0;c<=s;++c){var d=c/s,f=l*h+o,E=d*m-m/4,S=Math.sin(E),b=Math.cos(E);g.push(u*S),g.push(l*n+p),g.push(u*b),Cs.normalize(yA,Cs.set(TA,S,-i,b)),v.push(yA.x),v.push(yA.y),v.push(yA.z),y.push(d,f),a.push(C),++C}w.push(a)}for(var A=0;A<_;++A)for(var R=0;R<s;++R){var x=w[A][R],O=w[A+1][R],I=w[A+1][R+1],M=w[A][R+1];T.push(x),T.push(M),T.push(O),T.push(M),T.push(I),T.push(O)}}(),function(){for(var e=0;e<=c;++e)for(var i=e*Math.PI/c/2+Math.PI/2,r=Math.sin(i),n=-Math.cos(i),o=0;o<=s;++o){var h=2*o*Math.PI/s-Math.PI/2,u=Math.sin(h)*r,p=n,f=Math.cos(h)*r,m=o/s,E=e/a+(1-l);if(g.push(u*t,p*t+d,f*t),v.push(u,p,f),y.push(m,E),e<c&&o<s){var S=s+1,b=S*e+o+w[_][s]+1,A=S*(e+1)+o+w[_][s]+1,C=S*(e+1)+o+1+w[_][s]+1,R=S*e+o+1+w[_][s]+1;T.push(b,R,A),T.push(R,C,A)}}}(),{positions:g,normals:v,uvs:y,indices:T,minPos:S,maxPos:b,boundingRadius:A}},circle:function(t){var e=function(t){return(t=Kb(t)).segments=64,t}(t).segments,i=new Array(3*(e+1));i[0]=0,i[1]=0,i[2]=0;var r=new Array(1+2*e);r[0]=0;for(var n=2*Math.PI/e,s=0;s<e;++s){var a=n*s,o=Math.cos(a),h=Math.sin(a),l=3*(s+1);i[l+0]=o,i[l+1]=h,i[l+2]=0;var u=2*s;r[1+u]=s+1,r[1+(u+1)]=s+2}return e>0&&(r[r.length-1]=1),{positions:i,indices:r,minPos:{x:1,y:1,z:0},maxPos:{x:-1,y:-1,z:0},boundingRadius:1,primitiveMode:ol.TRIANGLE_FAN}},translate:function(t,e){for(var i=e.x||0,r=e.y||0,n=e.z||0,s=Math.floor(t.positions.length/3),a=0;a<s;++a){var o=3*a,h=3*a+1,l=3*a+2;t.positions[o]=t.positions[o]+i,t.positions[h]=t.positions[h]+r,t.positions[l]=t.positions[l]+n}return t.minPos&&(t.minPos.x+=i,t.minPos.y+=r,t.minPos.z+=n),t.maxPos&&(t.maxPos.x+=i,t.maxPos.y+=r,t.maxPos.z+=n),t},scale:function(t,e){for(var i=e.x||0,r=e.y||0,n=e.z||0,s=Math.floor(t.positions.length/3),a=0;a<s;++a){var o=3*a,h=3*a+1,l=3*a+2;t.positions[o]*=i,t.positions[h]*=r,t.positions[l]*=n}return t.minPos&&(t.minPos.x*=i,t.minPos.y*=r,t.minPos.z*=n),t.maxPos&&(t.maxPos.x*=i,t.maxPos.y*=r,t.maxPos.z*=n),t.boundingRadius=Math.max(Math.max(i,r),n),t},wireframed:function(t){var e=t.indices;if(!e)return t;if(t.primitiveMode&&t.primitiveMode!==ol.TRIANGLE_LIST)return t;for(var i=[[0,1],[1,2],[2,0]],r=[],n={},s=0;s<e.length;s+=3)for(var a=0;a<3;++a){var o=e[s+i[a][0]],h=e[s+i[a][1]],l=o>h?h<<16|o:o<<16|h;void 0===n[l]&&(n[l]=0,r.push(o,h))}return t.indices=r,t.primitiveMode=ol.LINE_LIST,t},wireframe:function(t){for(var e=[[0,1],[1,2],[2,0]],i=[],r={},n=0;n<t.length;n+=3)for(var s=0;s<3;++s){var a=t[n+e[s][0]],o=t[n+e[s][1]],h=a>o?o<<16|a:a<<16|o;void 0===r[h]&&(r[h]=0,i.push(a,o))}return i},invWinding:function(t){for(var e=[],i=0;i<t.length;i+=3)e.push(t[i],t[i+2],t[i+1]);return e},toWavefrontOBJ:function(t,e){if(void 0===e&&(e=1),!t.indices||!t.uvs||!t.normals||void 0!==t.primitiveMode&&t.primitiveMode!==ol.TRIANGLE_LIST)return"";for(var i=t.positions,r=t.uvs,n=t.normals,s=t.indices,a=function(t){return s[t]+1+"/"+(s[t]+1)+"/"+(s[t]+1)},o="",h=0;h<i.length;h+=3)o+="v "+i[h]*e+" "+i[h+1]*e+" "+i[h+2]*e+"\n";for(var l=0;l<r.length;l+=2)o+="vt "+r[l]+" "+r[l+1]+"\n";for(var u=0;u<n.length;u+=3)o+="vn "+n[u]+" "+n[u+1]+" "+n[u+2]+"\n";for(var c=0;c<s.length;c+=3)o+="f "+a(c)+" "+a(c+1)+" "+a(c+2)+"\n";return o},normals:function(t,e,i){void 0===i&&(i=1);for(var r=new Array(2*t.length),n=0;n<t.length/3;++n){var s=3*n,a=6*n;r[a+0]=t[s+0],r[a+1]=t[s+1],r[a+2]=t[s+2],r[a+3]=t[s+0]+e[s+0]*i,r[a+4]=t[s+1]+e[s+1]*i,r[a+5]=t[s+2]+e[s+2]*i}return r},applyDefaultGeometryOptions:Kb});t("primitives",EA);var SA,bA,AA,CA,wA,RA,xA,OA,IA=null,MA=null,BA=function(){function t(){this._envmap=null,this._globalDescriptorSet=null,this._model=null,this._default=null,this._handle=0,this._handle=mh.alloc()}r(t,[{key:"model",get:function(){return this._model}},{key:"enabled",get:function(){return mh.get(this._handle,_h.ENABLE)},set:function(t){t?this.activate():this._updatePipeline(),mh.set(this._handle,_h.ENABLE,t?1:0)}},{key:"useIBL",get:function(){return mh.get(this._handle,_h.USE_IBL)},set:function(t){mh.set(this._handle,_h.USE_IBL,t?1:0),this._updatePipeline()}},{key:"isRGBE",get:function(){return mh.get(this._handle,_h.IS_RGBE)},set:function(t){t&&(MA&&MA.recompileShaders({USE_RGBE_CUBEMAP:t}),this._model&&this._model.setSubModelMaterial(0,MA)),mh.set(this._handle,_h.IS_RGBE,t?1:0),this._updatePipeline()}},{key:"envmap",get:function(){return this._envmap},set:function(t){this._envmap=t||this._default,this._envmap&&(_.director.root.pipeline.ambient.albedoArray[3]=this._envmap.mipmapLevel,this._updateGlobalBinding())}},{key:"handle",get:function(){return this._handle}}]);var e=t.prototype;return e.initialize=function(t){mh.set(this._handle,_h.ENABLE,t.enabled?1:0),mh.set(this._handle,_h.USE_IBL,t.useIBL?1:0),mh.set(this._handle,_h.IS_RGBE,t.isRGBE?1:0),this._envmap=t.envmap},e.activate=function(){var t=_.director.root.pipeline;if(this._globalDescriptorSet=t.descriptorSet,this._default=wm.get("default-cube-texture"),this._model||(this._model=_.director.root.createModel(_.renderer.scene.Model),this._model._initLocalDescriptors=function(){}),mh.set(this._handle,_h.MODEL,this._model.handle),this._envmap||(this._envmap=this._default),t.ambient.groundAlbedo[3]=this._envmap.mipmapLevel,MA)MA.recompileShaders({USE_RGBE_CUBEMAP:this.isRGBE});else{var e=new mg;e.initialize({effectName:"skybox",defines:{USE_RGBE_CUBEMAP:this.isRGBE}}),MA=new Lg({parent:e})}IA||(IA=Yb(Zb({width:2,height:2,length:2}))),this._model.initSubModel(0,IA.renderingSubMeshes[0],MA),this._updateGlobalBinding(),this._updatePipeline()},e._updatePipeline=function(){var t=this.useIBL?this.isRGBE?2:1:0,e=_.director.root,i=e.pipeline;i.macros.CC_USE_IBL!==t&&(i.macros.CC_USE_IBL=t,e.onGlobalPipelineStateChanged())},e._updateGlobalBinding=function(){var t=this.envmap.getGFXTexture(),e=ep.getSampler(_.director._device,this.envmap.getSamplerHash());this._globalDescriptorSet.bindSampler(Np,e),this._globalDescriptorSet.bindTexture(Np,t)},e.destroy=function(){this._handle&&(mh.free(this._handle),this._handle=0)},t}();_.Skybox=BA;var PA,NA,LA,FA,DA,UA,kA,zA,GA,HA,VA,WA,jA,XA,YA=[],qA=t("UIStage",(SA=Ne("UIStage"),bA=pi([$E]),AA=si(),SA((OA=xA=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"renderQueues",RA,a(e)),e._renderQueues=[],e._renderArea=new cu,e}s(e,t);var i=e.prototype;return i.initialize=function(e){return t.prototype.initialize.call(this,e),e.renderQueues&&(this.renderQueues=e.renderQueues),!0},i.activate=function(e,i){t.prototype.activate.call(this,e,i);for(var r=0;r<this.renderQueues.length;r++){for(var n=0,s=0;s<this.renderQueues[r].stages.length;s++)n|=Rm(this.renderQueues[r].stages[s]);var a=nS;switch(this.renderQueues[r].sortMode){case YE.BACK_TO_FRONT:a=sS;break;case YE.FRONT_TO_BACK:a=nS}this._renderQueues[r]=new aS({isTransparent:this.renderQueues[r].isTransparent,phases:n,sortFunc:a})}},i.destroy=function(){},i.render=function(t){var e=this._pipeline,i=e.isHDR;e.isHDR=!1;var r=e.device;this._renderQueues[0].clear();for(var n=e.renderObjects,s=0;s<n.length;s++)for(var a=n[s],o=a.model.subModels,h=0;h<o.length;h++)for(var l=o[h].passes,u=0;u<l.length;u++)this._renderQueues[0].insertRenderPass(a,h,u);this._renderQueues[0].sort();var c=t.camera,_=c.viewport,d=t.window.hasOnScreenAttachments&&r.surfaceTransform%2?c.height:c.width,p=t.window.hasOnScreenAttachments&&r.surfaceTransform%2?c.width:c.height;this._renderArea.x=_.x*d,this._renderArea.y=_.y*p,this._renderArea.width=_.width*d,this._renderArea.height=_.height*p,YA[0]=c.clearColor;var f=e.commandBuffers[0],m=t.window.framebuffer,g=m.colorTextures[0]?m.renderPass:e.getRenderPass(c.clearFlag);f.beginRenderPass(g,m,this._renderArea,YA,c.clearDepth,c.clearStencil),f.bindDescriptorSet(Cp.GLOBAL,e.descriptorSet),this._renderQueues[0].recordCommandBuffer(r,g,f),f.endRenderPass(),e.isHDR=i},e}(lT),xA.initInfo={name:"UIStage",priority:tS.UI,tag:0,renderQueues:[{isTransparent:!0,stages:["default"],sortMode:YE.BACK_TO_FRONT}]},RA=u((wA=OA).prototype,"renderQueues",[bA,ke,AA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),CA=wA))||CA)),KA=t("UIFlow",Ne("UIFlow")((LA=NA=function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;return i.initialize=function(e){if(t.prototype.initialize.call(this,e),0===this._stages.length){var i=new qA;i.initialize(qA.initInfo),this._stages.push(i)}return!0},i.destroy=function(){t.prototype.destroy.call(this)},i.render=function(e){this._pipeline.updateUBOs(e),t.prototype.render.call(this,e)},e}(yT),NA.initInfo={name:"UIFlow",priority:eS.UI,tag:jE.UI,stages:[]},PA=LA))||PA),ZA=new Hs,QA=new Hs,JA=new Cs,$A=t("ForwardPipeline",(FA=Ne("ForwardPipeline"),DA=pi([qE]),UA=si(),kA=pi([KE]),zA=si(),FA((jA=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"renderTextures",VA,a(e)),l(e,"materials",WA,a(e)),e.fog=new Gb,e.ambient=new Vb,e.skybox=new BA,e.shadows=new BS,e.renderObjects=[],e.shadowObjects=[],e.shadowFrameBufferMap=new Map,e._isHDR=!1,e._shadingScale=1,e._fpScale=1/1024,e._renderPasses=new Map,e._globalUBO=new Float32Array(Op.COUNT),e._shadowUBO=new Float32Array(Ip.COUNT),e}s(e,t);var i=e.prototype;return i.initialize=function(e){if(t.prototype.initialize.call(this,e),0===this._flows.length){var i=new Ub;i.initialize(Ub.initInfo),this._flows.push(i);var r=new $S;r.initialize($S.initInfo),this._flows.push(r);var n=new KA;n.initialize(KA.initInfo),this._flows.push(n),n.activate(this)}return!0},i.activate=function(){return this._macros={},!(!t.prototype.activate.call(this)||!this._activeRenderer()&&(console.error("ForwardPipeline startup failed!"),1))},i.render=function(t){this._commandBuffers[0].begin();for(var e=0;e<t.length;e++){var i=t[e];Sb(this,i);for(var r=0;r<i.flows.length;r++)i.flows[r].render(i)}this._commandBuffers[0].end(),this._device.queue.submit(this._commandBuffers)},i.getRenderPass=function(t){var e=this._renderPasses.get(t);if(e)return e;var i=this.device,r=new xu,n=new Ou;r.format=i.colorFormat,n.format=i.depthStencilFormat,t&Bl.COLOR||(t&ab?r.loadOp=Cl.DISCARD:(r.loadOp=Cl.LOAD,r.beginLayout=Rl.PRESENT_SRC)),(t&Bl.DEPTH_STENCIL)!==Bl.DEPTH_STENCIL&&(t&Bl.DEPTH||(n.depthLoadOp=Cl.LOAD),t&Bl.STENCIL||(n.stencilLoadOp=Cl.LOAD),n.beginLayout=Rl.DEPTH_STENCIL_ATTACHMENT_OPTIMAL);var s=new Mu([r],n);return e=i.createRenderPass(s),this._renderPasses.set(t,e),e},i.updateUBOs=function(t){this._updateUBO(t);var e=t.camera.scene.mainLight,i=this.device,r=this.shadows;if(e&&r.enabled&&r.type===OS.ShadowMap){var n,s=0,a=0,o=0;if(r.autoAdapt){var h;n=Eb(this,null===(h=e.node)||void 0===h?void 0:h.getWorldRotation(),e.direction,JA);var l=r.sphere.radius;s=l*r.aspect,a=l;var u=Cs.distance(r.sphere.center,JA);o=Math.min(u*BS.COEFFICIENT_OF_EXPANSION,BS.MAX_FAR)}else n=e.node.getWorldMatrix(),s=r.orthoSize*r.aspect,a=r.orthoSize,o=r.far;Hs.invert(ZA,n);var c=i.screenSpaceSignY*i.UVSpaceSignY;Hs.ortho(QA,-s,s,-a,a,r.near,o,i.clipSpaceMinZ,c),Hs.multiply(QA,QA,ZA),Hs.toArray(this._shadowUBO,QA,Ip.MAT_LIGHT_VIEW_PROJ_OFFSET),this._shadowUBO[Ip.SHADOW_INFO_OFFSET]=r.size.x,this._shadowUBO[Ip.SHADOW_INFO_OFFSET+1]=r.size.y,this._shadowUBO[Ip.SHADOW_INFO_OFFSET+2]=r.pcf,this._shadowUBO[Ip.SHADOW_INFO_OFFSET+3]=r.bias}else e&&r.type===OS.Planar&&function(t,e,i){var r=e.direction,n=t.normal,s=t.distance+.001,a=1/Cs.dot(n,r),o=r.x*a,h=r.y*a,l=r.z*a,u=n.x,c=n.y,_=n.z,d=t.matLight;d.m00=1-u*o,d.m01=-u*h,d.m02=-u*l,d.m03=0,d.m04=-c*o,d.m05=1-c*h,d.m06=-c*l,d.m07=0,d.m08=-_*o,d.m09=-_*h,d.m10=1-_*l,d.m11=0,d.m12=o*s,d.m13=h*s,d.m14=l*s,d.m15=1,Hs.toArray(i,d,Ip.MAT_LIGHT_PLANE_PROJ_OFFSET)}(r,e,this._shadowUBO);Qs.toArray(this._shadowUBO,r.shadowColor,Ip.SHADOW_COLOR_OFFSET),this._commandBuffers[0].updateBuffer(this._descriptorSet.getBuffer(Op.BINDING),this._globalUBO),this._commandBuffers[0].updateBuffer(this._descriptorSet.getBuffer(Ip.BINDING),this._shadowUBO)},i._activeRenderer=function(){var t=this.device;this._commandBuffers.push(t.commandBuffer);var e=t.createBuffer(new Kl(rl.UNIFORM|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,Op.SIZE,Op.SIZE));this._descriptorSet.bindBuffer(Op.BINDING,e);var i=t.createBuffer(new Kl(rl.UNIFORM|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,Ip.SIZE,Ip.SIZE));return this._descriptorSet.bindBuffer(Ip.BINDING,i),this._descriptorSet.update(),this.macros.CC_USE_HDR=this._isHDR,this.macros.CC_SUPPORT_FLOAT_TEXTURE=this.device.hasFeature(Fl.TEXTURE_FLOAT),!0},i._updateUBO=function(t){this._descriptorSet.update();var e=_.director.root,i=t.camera,r=i.scene.mainLight,n=this.ambient,s=this.fog,a=this._globalUBO,o=this.device,h=Math.floor(o.width),l=Math.floor(o.height);a[Op.TIME_OFFSET]=e.cumulativeTime,a[Op.TIME_OFFSET+1]=e.frameTime,a[Op.TIME_OFFSET+2]=_.director.getTotalFrames(),a[Op.SCREEN_SIZE_OFFSET]=o.width,a[Op.SCREEN_SIZE_OFFSET+1]=o.height,a[Op.SCREEN_SIZE_OFFSET+2]=1/a[Op.SCREEN_SIZE_OFFSET],a[Op.SCREEN_SIZE_OFFSET+3]=1/a[Op.SCREEN_SIZE_OFFSET+1],a[Op.SCREEN_SCALE_OFFSET]=i.width/h*this.shadingScale,a[Op.SCREEN_SCALE_OFFSET+1]=i.height/l*this.shadingScale,a[Op.SCREEN_SCALE_OFFSET+2]=1/a[Op.SCREEN_SCALE_OFFSET],a[Op.SCREEN_SCALE_OFFSET+3]=1/a[Op.SCREEN_SCALE_OFFSET+1],a[Op.NATIVE_SIZE_OFFSET]=h,a[Op.NATIVE_SIZE_OFFSET+1]=l,a[Op.NATIVE_SIZE_OFFSET+2]=1/a[Op.NATIVE_SIZE_OFFSET],a[Op.NATIVE_SIZE_OFFSET+3]=1/a[Op.NATIVE_SIZE_OFFSET+1],Hs.toArray(a,i.matView,Op.MAT_VIEW_OFFSET),Hs.toArray(a,i.node.worldMatrix,Op.MAT_VIEW_INV_OFFSET),Hs.toArray(a,i.matProj,Op.MAT_PROJ_OFFSET),Hs.toArray(a,i.matProjInv,Op.MAT_PROJ_INV_OFFSET),Hs.toArray(a,i.matViewProj,Op.MAT_VIEW_PROJ_OFFSET),Hs.toArray(a,i.matViewProjInv,Op.MAT_VIEW_PROJ_INV_OFFSET),Cs.toArray(a,i.position,Op.CAMERA_POS_OFFSET);var u=o.screenSpaceSignY;t.window.hasOffScreenAttachments&&(u*=o.UVSpaceSignY),a[Op.CAMERA_POS_OFFSET+3]=u;var c=i.exposure;if(a[Op.EXPOSURE_OFFSET]=c,a[Op.EXPOSURE_OFFSET+1]=1/c,a[Op.EXPOSURE_OFFSET+2]=this._isHDR?1:0,a[Op.EXPOSURE_OFFSET+3]=this._fpScale/c,r){if(Cs.toArray(a,r.direction,Op.MAIN_LIT_DIR_OFFSET),Cs.toArray(a,r.color,Op.MAIN_LIT_COLOR_OFFSET),r.useColorTemperature){var d=r.colorTemperatureRGB;a[Op.MAIN_LIT_COLOR_OFFSET]*=d.x,a[Op.MAIN_LIT_COLOR_OFFSET+1]*=d.y,a[Op.MAIN_LIT_COLOR_OFFSET+2]*=d.z}this._isHDR?a[Op.MAIN_LIT_COLOR_OFFSET+3]=r.illuminance*this._fpScale:a[Op.MAIN_LIT_COLOR_OFFSET+3]=r.illuminance*c}else Cs.toArray(a,Cs.UNIT_Z,Op.MAIN_LIT_DIR_OFFSET),Os.toArray(a,Os.ZERO,Op.MAIN_LIT_COLOR_OFFSET);var p=n.colorArray;this._isHDR?p[3]=n.skyIllum*this._fpScale:p[3]=n.skyIllum*c,a.set(p,Op.AMBIENT_SKY_OFFSET),a.set(n.albedoArray,Op.AMBIENT_GROUND_OFFSET),s.enabled&&(a.set(s.colorArray,Op.GLOBAL_FOG_COLOR_OFFSET),a[Op.GLOBAL_FOG_BASE_OFFSET]=s.fogStart,a[Op.GLOBAL_FOG_BASE_OFFSET+1]=s.fogEnd,a[Op.GLOBAL_FOG_BASE_OFFSET+2]=s.fogDensity,a[Op.GLOBAL_FOG_ADD_OFFSET]=s.fogTop,a[Op.GLOBAL_FOG_ADD_OFFSET+1]=s.fogRange,a[Op.GLOBAL_FOG_ADD_OFFSET+2]=s.fogAtten)},i.destroyUBOs=function(){this._descriptorSet&&(this._descriptorSet.getBuffer(Op.BINDING).destroy(),this._descriptorSet.getBuffer(Ip.BINDING).destroy())},i.destroy=function(){this.destroyUBOs();for(var e=this._renderPasses.values(),i=e.next();!i.done;)i.value.destroy(),i=e.next();return this._commandBuffers.length=0,this.ambient.destroy(),this.skybox.destroy(),this.fog.destroy(),this.shadows.destroy(),t.prototype.destroy.call(this)},r(e,[{key:"isHDR",get:function(){return this._isHDR},set:function(t){this._isHDR!==t&&(this._isHDR=t,this._globalUBO[Op.EXPOSURE_OFFSET+2]=this._isHDR?1:0)}},{key:"shadingScale",get:function(){return this._shadingScale}},{key:"fpScale",get:function(){return this._fpScale}},{key:"shadowUBO",get:function(){return this._shadowUBO}}]),e}(XE),VA=u((HA=jA).prototype,"renderTextures",[DA,ke,UA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),WA=u(HA.prototype,"materials",[kA,ke,zA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),GA=HA))||GA)),tC=new go(fo.ATTRIBUTE,(function(t,e){return e||new hu})),eC=new Hs,iC=new Hi((function(){return new hT}),32),rC=[{name:"CC_RECEIVE_SHADOW",value:!0}];!function(t){t[t.DEFAULT=0]="DEFAULT",t[t.SKINNING=1]="SKINNING",t[t.BAKED_SKINNING=2]="BAKED_SKINNING",t[t.UI_BATCH=3]="UI_BATCH",t[t.PARTICLE_BATCH=4]="PARTICLE_BATCH",t[t.LINE=5]="LINE"}(XA||(XA={}));var nC=Hd([ml.LINEAR,ml.LINEAR,ml.NONE,gl.CLAMP,gl.CLAMP,gl.CLAMP]),sC=Hd([ml.LINEAR,ml.LINEAR,ml.LINEAR,gl.CLAMP,gl.CLAMP,gl.CLAMP]),aC=function(){function t(){this.type=XA.DEFAULT,this.scene=null,this.isDynamicBatching=!1,this.instancedAttributes={buffer:null,views:[],attributes:[]},this._worldBounds=null,this._modelBounds=null,this._subModels=[],this._node=null,this._transform=null,this._device=void 0,this._inited=!1,this._descriptorSetCount=1,this._updateStamp=-1,this._transformUpdated=!0,this._handle=0,this._hWorldBounds=0,this._localData=new Float32Array(zp.COUNT),this._localBuffer=null,this._instMatWorldIdx=-1,this._lightmap=null,this._lightmapUVParam=new Os,this._device=_.director.root.device}r(t,[{key:"subModels",get:function(){return this._subModels}},{key:"inited",get:function(){return this._inited}},{key:"worldBounds",get:function(){return this._worldBounds}},{key:"modelBounds",get:function(){return this._modelBounds}},{key:"localBuffer",get:function(){return this._localBuffer}},{key:"updateStamp",get:function(){return this._updateStamp}},{key:"isInstancingEnabled",get:function(){return this._instMatWorldIdx>=0}},{key:"receiveShadow",get:function(){return!!Vo.get(this._handle,Uo.RECEIVE_SHADOW)},set:function(t){Vo.set(this._handle,Uo.RECEIVE_SHADOW,t?1:0),this.onMacroPatchesStateChanged()}},{key:"castShadow",get:function(){return!!Vo.get(this._handle,Uo.CAST_SHADOW)},set:function(t){Vo.set(this._handle,Uo.CAST_SHADOW,t?1:0)}},{key:"handle",get:function(){return this._handle}},{key:"node",get:function(){return this._node},set:function(t){this._node=t,Vo.set(this._handle,Uo.NODE,t.handle)}},{key:"transform",get:function(){return this._transform},set:function(t){this._transform=t,Vo.set(this._handle,Uo.TRANSFORM,t.handle)}},{key:"visFlags",get:function(){return Vo.get(this._handle,Uo.VIS_FLAGS)},set:function(t){Vo.set(this._handle,Uo.VIS_FLAGS,t)}},{key:"enabled",get:function(){return!!Vo.get(this._handle,Uo.ENABLED)},set:function(t){Vo.set(this._handle,Uo.ENABLED,t?1:0)}}]);var e=t.prototype;return e.initialize=function(){if(!this._inited){this._handle=Vo.alloc();var t=Ro.alloc(),e=Oo.alloc();Vo.set(this._handle,Uo.INSTANCED_ATTR_ARRAY,e),Vo.set(this._handle,Uo.SUB_MODEL_ARRAY,t),Vo.set(this._handle,Uo.VIS_FLAGS,vp.Enum.NONE),Vo.set(this._handle,Uo.ENABLED,1),Vo.set(this._handle,Uo.RECEIVE_SHADOW,1),Vo.set(this._handle,Uo.CAST_SHADOW,0),this._inited=!0}},e.destroy=function(){for(var t=this._subModels,e=0;e<t.length;e++){var i=this._subModels[e];i.destroy(),iC.free(i)}if(this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._worldBounds=null,this._modelBounds=null,this._subModels.length=0,this._inited=!1,this._transformUpdated=!0,this._transform=null,this._node=null,this.isDynamicBatching=!1,this._handle){var r=Vo.get(this._handle,Uo.SUB_MODEL_ARRAY);r&&Ro.free(r);var n=Vo.get(this._handle,Uo.INSTANCED_BUFFER);n&&Po.free(n);var s=Vo.get(this._handle,Uo.INSTANCED_ATTR_ARRAY);s&&To(s,Oo,tC),Vo.free(this._handle),this._handle=0}this._hWorldBounds&&(Xo.free(this._hWorldBounds),this._hWorldBounds=0)},e.attachToScene=function(t){this.scene=t},e.detachFromScene=function(){this.scene=null},e.updateTransform=function(){var t=this.transform;if(t.hasChangedFlags||t._dirtyFlags){t.updateWorldTransform(),this._transformUpdated=!0;var e=this._worldBounds;this._modelBounds&&e&&(this._modelBounds.transform(t._mat,t._pos,t._rot,t._scale,e),Xo.setVec3(this._hWorldBounds,Go.CENTER,e.center),Xo.setVec3(this._hWorldBounds,Go.HALF_EXTENSION,e.halfExtents))}},e.updateUBOs=function(t){for(var e=this._subModels,i=0;i<e.length;i++)e[i].update();if(this._updateStamp=t,this._transformUpdated){this._transformUpdated=!1;var r=this.transform._mat,n=this._instMatWorldIdx;if(n>=0){var s=this.instancedAttributes.views;!function(t,e,i,r){e[0]=t.m00,e[1]=t.m01,e[2]=t.m02,e[3]=t.m12,i[0]=t.m04,i[1]=t.m05,i[2]=t.m06,i[3]=t.m13,r[0]=t.m08,r[1]=t.m09,r[2]=t.m10,r[3]=t.m14}(r,s[n],s[n+1],s[n+2])}else this._localBuffer&&(Hs.toArray(this._localData,r,zp.MAT_WORLD_OFFSET),Hs.inverseTranspose(eC,r),Hs.toArray(this._localData,eC,zp.MAT_WORLD_IT_OFFSET),this._localBuffer.update(this._localData))}},e.createBoundingShape=function(t,e){t&&e&&(this._modelBounds=y_.fromPoints(y_.create(),t,e),this._worldBounds=y_.clone(this._modelBounds),0===this._hWorldBounds&&(this._hWorldBounds=Xo.alloc(),Vo.set(this._handle,Uo.WORLD_BOUNDS,this._hWorldBounds)),Xo.setVec3(this._hWorldBounds,Go.CENTER,this._worldBounds.center),Xo.setVec3(this._hWorldBounds,Go.HALF_EXTENSION,this._worldBounds.halfExtents))},e.initSubModel=function(t,e,i){this.initialize();var r=!1;if(null==this._subModels[t]?(this._subModels[t]=iC.alloc(),r=!0):this._subModels[t].destroy(),this._subModels[t].initialize(e,i.passes,this.getMacroPatches(t)),this._updateAttributesAndBinding(t),r){var n=Vo.get(this._handle,Uo.SUB_MODEL_ARRAY);Ro.assign(n,t,this._subModels[t].handle)}},e.setSubModelMesh=function(t,e){this._subModels[t]&&(this._subModels[t].subMesh=e)},e.setSubModelMaterial=function(t,e){this._subModels[t]&&(this._subModels[t].passes=e.passes,this._updateAttributesAndBinding(t))},e.onGlobalPipelineStateChanged=function(){for(var t=this._subModels,e=0;e<t.length;e++)t[e].onPipelineStateChanged()},e.onMacroPatchesStateChanged=function(){for(var t=this._subModels,e=0;e<t.length;e++)t[e].onMacroPatchesStateChanged(this.getMacroPatches(e))},e.updateLightingmap=function(t,e){Os.toArray(this._localData,e,zp.LIGHTINGMAP_UVPARAM),this._lightmap=t,this._lightmapUVParam=e,null===t&&(t=wm.get("empty-texture"));var i=t.getGFXTexture();if(i)for(var r=ep.getSampler(this._device,t.mipmaps.length>1?sC:nC),n=this._subModels,s=0;s<n.length;s++){var a=n[s].descriptorSet;a.bindTexture(af,i),a.bindSampler(af,r),a.update()}},e.getMacroPatches=function(){return this.receiveShadow?rC:null},e._updateAttributesAndBinding=function(t){var e=this._subModels[t];if(e){this._initLocalDescriptors(t),this._updateLocalDescriptors(t,e.descriptorSet);var i=So.get(zo.get(e.handle,Lo.SHADER_0));this._updateInstancedAttributes(i.attributes,e.passes[0])}},e._getInstancedAttributeIndex=function(t){for(var e=this.instancedAttributes.attributes,i=0;i<e.length;i++)if(e[i].name===t)return i;return-1},e._updateInstancedAttributes=function(t,e){if(e.device.hasFeature(Fl.INSTANCED_ARRAYS)){var i=Vo.get(this._handle,Uo.INSTANCED_BUFFER);i&&Po.free(i);var r=Vo.get(this._handle,Uo.INSTANCED_ATTR_ARRAY);r&&To(r,Oo,tC,!1);for(var n=0,s=0;s<t.length;s++){var a=t[s];a.isInstanced&&(n+=zl[a.format].size)}var o=Po.alloc(n),h=Po.getBuffer(o);Vo.set(this._handle,Uo.INSTANCED_BUFFER,o);var l=this.instancedAttributes;l.buffer=new Uint8Array(h),l.views.length=l.attributes.length=0;for(var u=0,c=0;c<t.length;c++){var _=t[c];if(_.isInstanced){var d=tC.alloc(),p=tC.get(d);p.format=_.format,p.name=_.name,p.isNormalized=_.isNormalized,p.location=_.location,l.attributes.push(p),Oo.push(r,d);var f=zl[_.format];l.views.push(new(jl(f))(h,u,f.count)),u+=f.size}}e.batchingScheme===Am.INSTANCING&&cS.get(e).destroy(),this._instMatWorldIdx=this._getInstancedAttributeIndex("a_matWorld0"),this._transformUpdated=!0}},e._initLocalDescriptors=function(){this._localBuffer||(this._localBuffer=this._device.createBuffer(new Kl(rl.UNIFORM|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,zp.SIZE,zp.SIZE)))},e._updateLocalDescriptors=function(t,e){this._localBuffer&&e.bindBuffer(zp.BINDING,this._localBuffer)},t}(),oC=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._morphRenderingInstance=null,e._usedMaterials=new Set,e}s(e,t);var i=e.prototype;return i.getMacroPatches=function(t){return this._morphRenderingInstance?this._morphRenderingInstance.requiredPatches(t):void 0},i.initSubModel=function(e,i,r){return t.prototype.initSubModel.call(this,e,i,this._launderMaterial(r))},i.setSubModelMaterial=function(e,i){return t.prototype.setSubModelMaterial.call(this,e,this._launderMaterial(i))},i._updateLocalDescriptors=function(e,i){t.prototype._updateLocalDescriptors.call(this,e,i),this._morphRenderingInstance&&this._morphRenderingInstance.adaptPipelineState(e,i)},i._launderMaterial=function(t){return t},i.setMorphRendering=function(t){this._morphRenderingInstance=t},e}(aC),hC=[],lC=new Map,uC=[{name:"CC_USE_SKINNING",value:!0}];function cC(t,e){for(var i=0,r=Hs.IDENTITY;t;){if(t.stamp===e||t.stamp+1===e&&!t.node.hasChangedFlags){r=t.world,t.stamp=e;break}t.stamp=e,hC[i++]=t,t=t.parent}for(;i>0;){var n=(t=hC[--i]).node;Hs.fromRTS(t.local,n.rotation,n.position,n.scale),r=Hs.multiply(t.world,r,t.local)}return r}function _C(t,e){for(var i,r=null,n=0;t!==e;){var s=t.uuid;if(lC.has(s)){r=lC.get(s);break}r={node:t,local:new Hs,world:new Hs,stamp:-1,parent:null},lC.set(s,r),hC[n++]=r,t=t.parent,r=null}for(;n>0;)(i=hC[--n]).parent=r,r=i;return r}function dC(t){for(var e=lC.get(t.uuid)||null;e;)lC.delete(e.node.uuid),e=e.parent}function pC(t,e,i,r){for(var n=0;n<i.length;n++){for(var s=i[n],a=-1,o=0;o<s.length;o++)if(s[o]===r){a=o;break}a>=0&&(e.push(n),t.push(a))}}var fC=new Cs,mC=new Cs,gC=new Cs,vC=new Cs,yC=new Hs,TC=new y_,EC=function(t){function e(){var e;return(e=t.call(this)||this).uploadAnimation=null,e._buffers=[],e._dataArray=[],e._joints=[],e._bufferIndices=null,e.type=XA.SKINNING,e}s(e,t);var i=e.prototype;return i.destroy=function(){if(this.bindSkeleton(),this._buffers.length){for(var e=0;e<this._buffers.length;e++)this._buffers[e].destroy();this._buffers.length=0}t.prototype.destroy.call(this)},i.bindSkeleton=function(t,e,i){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null);for(var r=0;r<this._joints.length;r++)dC(this._joints[r].target);if(this._bufferIndices=null,this._joints.length=0,t&&e&&i){this.transform=e;var n=i.getBoneSpaceBounds(t),s=i.struct.jointMaps;this._ensureEnoughBuffers(s&&s.length||1),this._bufferIndices=i.jointBufferIndices;for(var a=0;a<t.joints.length;a++){var o=n[a],h=e.getChildByPath(t.joints[a]);if(o&&h){var l=_C(h,e),u=t.bindposes[a],c=[],_=[];s?pC(c,_,s,a):(c.push(a),_.push(0)),this._joints.push({indices:c,buffers:_,bound:o,target:h,bindpose:u,transform:l})}}}},i.updateTransform=function(t){var e=this.transform;(e.hasChangedFlags||e._dirtyFlags)&&(e.updateWorldTransform(),this._transformUpdated=!0),Cs.set(fC,1/0,1/0,1/0),Cs.set(mC,-1/0,-1/0,-1/0);for(var i=0;i<this._joints.length;i++){var r=this._joints[i],n=r.bound,s=cC(r.transform,t);y_.transform(TC,n,s),TC.getBoundary(gC,vC),Cs.min(fC,fC,gC),Cs.max(mC,mC,vC)}var a=this._worldBounds;this._modelBounds&&a&&(y_.fromPoints(this._modelBounds,fC,mC),this._modelBounds.transform(e._mat,e._pos,e._rot,e._scale,this._worldBounds),Xo.setVec3(this._hWorldBounds,Go.CENTER,a.center),Xo.setVec3(this._hWorldBounds,Go.HALF_EXTENSION,a.halfExtents))},i.updateUBOs=function(e){t.prototype.updateUBOs.call(this,e);for(var i=0;i<this._joints.length;i++){var r=this._joints[i],n=r.indices,s=r.buffers,a=r.transform,o=r.bindpose;Hs.multiply(yC,a.world,o);for(var h=0;h<s.length;h++)Ay(this._dataArray[s[h]],12*n[h],yC)}for(var l=0;l<this._buffers.length;l++)this._buffers[l].update(this._dataArray[l]);return!0},i.initSubModel=function(e,i,r){var n=i.vertexBuffers,s=i.iaInfo;s.vertexBuffers=i.jointMappedBuffers,t.prototype.initSubModel.call(this,e,i,r),s.vertexBuffers=n},i.getMacroPatches=function(e){var i=t.prototype.getMacroPatches.call(this,e);return i?uC.concat(i):uC},i._updateLocalDescriptors=function(e,i){t.prototype._updateLocalDescriptors.call(this,e,i);var r=this._buffers[this._bufferIndices[e]];r&&i.bindBuffer(jp.BINDING,r)},i._ensureEnoughBuffers=function(t){for(var e=0;e<t;e++)this._buffers[e]||(this._buffers[e]=this._device.createBuffer(new Kl(rl.UNIFORM|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,jp.SIZE,jp.SIZE))),this._dataArray[e]||(this._dataArray[e]=new Float32Array(jp.COUNT))},e}(oC),SC=[{name:"CC_USE_SKINNING",value:!0},{name:"CC_USE_BAKED_ANIMATION",value:!0}],bC=function(t){function e(){var e;(e=t.call(this)||this).uploadedAnim=void 0,e._jointsMedium=void 0,e._skeleton=null,e._mesh=null,e._dataPoolManager=void 0,e._instAnimInfoIdx=-1,e.type=XA.BAKED_SKINNING,e._dataPoolManager=_.director.root.dataPoolManager;var i=new Float32Array(4),r=e._dataPoolManager.jointAnimationInfo.getData();return e._jointsMedium={buffer:null,jointTextureInfo:i,animInfo:r,texture:null,boundsInfo:null},e}s(e,t);var i=e.prototype;return i.destroy=function(){this.uploadedAnim=void 0,this._jointsMedium.boundsInfo=null,this._jointsMedium.buffer&&(this._jointsMedium.buffer.destroy(),this._jointsMedium.buffer=null),this._applyJointTexture(),t.prototype.destroy.call(this)},i.bindSkeleton=function(t,e,i){if(void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null),this._skeleton=t,this._mesh=i,t&&e&&i){this.transform=e;var r=this._dataPoolManager;this._jointsMedium.animInfo=r.jointAnimationInfo.getData(e.uuid),this._jointsMedium.buffer||(this._jointsMedium.buffer=this._device.createBuffer(new Kl(rl.UNIFORM|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,Vp.SIZE,Vp.SIZE)))}},i.updateTransform=function(e){if(t.prototype.updateTransform.call(this,e),this.uploadedAnim){var i=this._jointsMedium,r=i.animInfo,n=i.boundsInfo[r.data[0]],s=this._worldBounds;if(s&&n){var a=this.transform;n.transform(a._mat,a._pos,a._rot,a._scale,s),Xo.setVec3(this._hWorldBounds,Go.CENTER,s.center),Xo.setVec3(this._hWorldBounds,Go.HALF_EXTENSION,s.halfExtents)}}},i.updateUBOs=function(e){t.prototype.updateUBOs.call(this,e);var i=this._jointsMedium.animInfo,r=this._instAnimInfoIdx;return r>=0?this.instancedAttributes.views[r][0]=i.data[0]:i.dirty&&(i.buffer.update(i.data),i.dirty=!1),!0},i.uploadAnimation=function(t){if(this._skeleton&&this._mesh&&this.uploadedAnim!==t){this.uploadedAnim=t;var e=this._dataPoolManager,i=null;t?(i=e.jointTexturePool.getSequencePoseTexture(this._skeleton,t,this._mesh,this.transform),this._jointsMedium.boundsInfo=i&&i.bounds.get(this._mesh.hash),this._modelBounds=null):(i=e.jointTexturePool.getDefaultPoseTexture(this._skeleton,this._mesh,this.transform),this._jointsMedium.boundsInfo=null,this._modelBounds=i&&i.bounds.get(this._mesh.hash)[0]),this._applyJointTexture(i)}},i._applyJointTexture=function(t){void 0===t&&(t=null);var e=this._jointsMedium.texture;if(e&&e!==t&&this._dataPoolManager.jointTexturePool.releaseHandle(e),this._jointsMedium.texture=t,t){var i=this._jointsMedium,r=i.buffer,n=i.jointTextureInfo;n[0]=t.handle.texture.width,n[1]=this._skeleton.joints.length,n[2]=t.pixelOffset+.1,n[3]=1/n[0],this.updateInstancedJointTextureInfo(),r&&r.update(n);for(var s=t.handle.texture,a=0;a<this._subModels.length;++a)this._subModels[a].descriptorSet.bindTexture(Yp,s)}},i.getMacroPatches=function(e){var i=t.prototype.getMacroPatches.call(this,e);return i?i.concat(SC):SC},i._updateLocalDescriptors=function(e,i){t.prototype._updateLocalDescriptors.call(this,e,i);var r=this._jointsMedium,n=r.buffer,s=r.texture,a=r.animInfo;if(i.bindBuffer(Vp.BINDING,n),i.bindBuffer(Wp.BINDING,a.buffer),s){var o=ep.getSampler(this._device,Zy);i.bindTexture(Yp,s.handle.texture),i.bindSampler(Yp,o)}},i._updateInstancedAttributes=function(e,i){t.prototype._updateInstancedAttributes.call(this,e,i),this._instAnimInfoIdx=this._getInstancedAttributeIndex("a_jointAnimInfo"),this.updateInstancedJointTextureInfo()},i.updateInstancedJointTextureInfo=function(){var t=this._jointsMedium,e=t.jointTextureInfo,i=t.animInfo,r=this._instAnimInfoIdx;if(r>=0){var n=this.instancedAttributes.views[r];n[0]=i.data[0],n[1]=e[1],n[2]=e[2]}},e}(oC),AC=Object.freeze({__proto__:null,uploadJointData:Ay,MINIMUM_JOINT_TEXTURE_SIZE:480,selectJointsMediumFormat:Cy,jointTextureSamplerHash:Zy,JointTexturePool:sT,JointAnimationInfo:aT,getWorldMatrix:cC,getTransform:_C,deleteTransform:dC,SkinningModel:EC,BakedSkinningModel:bC,MorphModel:oC}),CC=function(){function t(t){this._root=void 0,this._name="",this._cameras=[],this._models=[],this._directionalLights=[],this._sphereLights=[],this._spotLights=[],this._mainLight=null,this._modelId=0,this._scenePoolHandle=0,this._modelArrayHandle=0,this._sphereLightsHandle=0,this._spotLightsHandle=0,this._root=t,this._createHandles()}t.registerCreateFunc=function(e){e._createSceneFun=function(e){return new t(e)}},r(t,[{key:"root",get:function(){return this._root}},{key:"name",get:function(){return this._name}},{key:"cameras",get:function(){return this._cameras}},{key:"mainLight",get:function(){return this._mainLight}},{key:"sphereLights",get:function(){return this._sphereLights}},{key:"spotLights",get:function(){return this._spotLights}},{key:"models",get:function(){return this._models}},{key:"rayResultCanvas",get:function(){return LC}},{key:"rayResultModels",get:function(){return BC}},{key:"rayResultAll",get:function(){return FC}},{key:"rayResultSingleModel",get:function(){return DC}},{key:"handle",get:function(){return this._scenePoolHandle}}]);var e=t.prototype;return e.initialize=function(t){return this._name=t.name,this._createHandles(),!0},e.update=function(t){var e=this._mainLight;e&&e.update();for(var i=this._sphereLights,r=0;r<i.length;r++)i[r].update();for(var n=this._spotLights,s=0;s<n.length;s++)n[s].update();for(var a=this._models,o=0;o<a.length;o++){var h=a[o];h.enabled&&(h.updateTransform(t),h.updateUBOs(t))}},e.destroy=function(){this.removeCameras(),this.removeSphereLights(),this.removeSpotLights(),this.removeModels(),this._modelArrayHandle&&(xo.free(this._modelArrayHandle),this._modelArrayHandle=0),this._scenePoolHandle&&(Ko.free(this._scenePoolHandle),this._scenePoolHandle=0),this._sphereLightsHandle&&(Mo.free(this._sphereLightsHandle),this._sphereLightsHandle=0),this._spotLightsHandle&&(Mo.free(this._spotLightsHandle),this._spotLightsHandle=0)},e.addCamera=function(t){t.attachToScene(this),this._cameras.push(t)},e.removeCamera=function(t){for(var e=0;e<this._cameras.length;++e)if(this._cameras[e]===t)return this._cameras.splice(e,1),void t.detachFromScene()},e.removeCameras=function(){for(var t,e=h(this._cameras);!(t=e()).done;)t.value.detachFromScene();this._cameras.splice(0)},e.setMainLight=function(t){this._mainLight=t,Ko.set(this._scenePoolHandle,Wo.MAIN_LIGHT,t.handle)},e.unsetMainLight=function(t){if(this._mainLight===t){var e=this._directionalLights;e.length?(this._mainLight=e[e.length-1],this._mainLight.node&&(this._mainLight.node.hasChangedFlags|=Uv.ROTATION)):this._mainLight=null}},e.addDirectionalLight=function(t){t.attachToScene(this),this._directionalLights.push(t)},e.removeDirectionalLight=function(t){for(var e=0;e<this._directionalLights.length;++e)if(this._directionalLights[e]===t)return t.detachFromScene(),void this._directionalLights.splice(e,1)},e.addSphereLight=function(t){t.attachToScene(this),this._sphereLights.push(t),Mo.push(this._sphereLightsHandle,t.handle)},e.removeSphereLight=function(t){for(var e=0;e<this._sphereLights.length;++e)if(this._sphereLights[e]===t)return t.detachFromScene(),this._sphereLights.splice(e,1),void Mo.erase(this._sphereLightsHandle,e)},e.addSpotLight=function(t){t.attachToScene(this),this._spotLights.push(t),Mo.push(this._spotLightsHandle,t.handle)},e.removeSpotLight=function(t){for(var e=0;e<this._spotLights.length;++e)if(this._spotLights[e]===t)return t.detachFromScene(),this._spotLights.splice(e,1),void Mo.erase(this._spotLightsHandle,e)},e.removeSphereLights=function(){for(var t=0;t<this._sphereLights.length;++t)this._sphereLights[t].detachFromScene();this._sphereLights.length=0,Mo.clear(this._sphereLightsHandle)},e.removeSpotLights=function(){for(var t=0;t<this._spotLights.length;++t)this._spotLights[t].detachFromScene();this._spotLights=[],Mo.clear(this._spotLightsHandle)},e.addModel=function(t){t.attachToScene(this),this._models.push(t),xo.push(this._modelArrayHandle,t.handle)},e.removeModel=function(t){for(var e=0;e<this._models.length;++e)if(this._models[e]===t)return t.detachFromScene(),this._models.splice(e,1),void xo.erase(this._modelArrayHandle,e)},e.removeModels=function(){for(var t,e=h(this._models);!(t=e()).done;){var i=t.value;i.detachFromScene(),i.destroy()}this._models.length=0,xo.clear(this._modelArrayHandle)},e.onGlobalPipelineStateChanged=function(){for(var t,e=h(this._models);!(t=e()).done;)t.value.onGlobalPipelineStateChanged()},e.generateModelId=function(){return this._modelId++},e.raycastAll=function(t,e,i){void 0===e&&(e=vp.Enum.DEFAULT|vp.Enum.UI_2D),void 0===i&&(i=1/0);var r=this.raycastAllModels(t,e,i),n=this.raycastAllCanvas(t,e,i),s=r||n;return FC.length=0,s&&(Array.prototype.push.apply(FC,BC),Array.prototype.push.apply(FC,LC)),s},e.raycastAllModels=function(t,e,i){void 0===e&&(e=vp.Enum.DEFAULT),void 0===i&&(i=1/0),MC.reset();for(var r,n=h(this._models);!(r=n()).done;){var s=r.value,a=s.transform;if(a&&s.enabled&&s.node.layer&e&~vp.Enum.IGNORE_RAYCAST&&s.worldBounds){var o=a_.rayAABB(t,s.worldBounds);if(!(o<=0||o>=i)){if(s.type===XA.DEFAULT){Hs.invert(xC,a.getWorldMatrix(xC)),Cs.transformMat4(wC.o,t.o,xC),Cs.normalize(wC.d,Cs.transformMat4Normal(wC.d,t.d,xC)),o=1/0;for(var l=s.subModels,u=0;u<l.length;++u){var c=l[u].subMesh;if(c&&c.geometricInfo){var _=c.geometricInfo,d=_.positions,p=_.indices,f=_.doubleSided;UC(d,p,c.primitiveMode,f,i),o=Math.min(o,OC*Cs.multiply(RC,wC.d,a.worldScale).length())}}}if(o<i){var m=MC.add();m.node=s.node,m.distance=o,BC[MC.length-1]=m}}}}return BC.length=MC.length,BC.length>0},e.raycastSingleModel=function(t,e,i,r){void 0===i&&(i=vp.Enum.DEFAULT),void 0===r&&(r=1/0),MC.reset();var n=e,s=n.transform;if(!(s&&n.enabled&&n.node.layer&i&~vp.Enum.IGNORE_RAYCAST&&n.worldBounds))return!1;var a=a_.rayAABB(t,n.worldBounds);if(a<=0||a>=r)return!1;if(n.type===XA.DEFAULT){Hs.invert(xC,s.getWorldMatrix(xC)),Cs.transformMat4(wC.o,t.o,xC),Cs.normalize(wC.d,Cs.transformMat4Normal(wC.d,t.d,xC)),a=1/0;for(var o=n.subModels,h=0;h<o.length;++h){var l=o[h].subMesh;if(l&&l.geometricInfo){var u=l.geometricInfo,c=u.positions,_=u.indices,d=u.doubleSided;UC(c,_,l.primitiveMode,d,r),a=Math.min(a,OC*Cs.multiply(RC,wC.d,s.worldScale).length())}}}if(a<r){var p=MC.add();p.node=n.node,p.distance=a,DC[MC.length-1]=p}return DC.length=MC.length,DC.length>0},e.raycastAllCanvas=function(t,e,i){void 0===e&&(e=vp.Enum.UI_2D),void 0===i&&(i=1/0),NC.reset();var r=_.director.getScene().getComponentsInChildren(_.Canvas);if(null!=r&&r.length>0)for(var n=0;n<r.length;n++){var s=r[n].node;null!=s&&s.active&&this._raycastUI2DNodeRecursiveChildren(t,s,e,i)}return LC.length=NC.length,LC.length>0},e._raycastUI2DNode=function(t,e,i,r){void 0===i&&(i=vp.Enum.UI_2D),void 0===r&&(r=1/0);var n=e._uiProps.uiTransformComp;if(!(null==n||e.layer&vp.Enum.IGNORE_RAYCAST)&&e.layer&i){n.getComputeAABB(PC);var s=a_.rayAABB(t,PC);if(!(s<=0)&&s<r){var a=NC.add();return a.node=e,a.distance=s,a}}},e._raycastUI2DNodeRecursiveChildren=function(t,e,i,r){void 0===i&&(i=vp.Enum.UI_2D),void 0===r&&(r=1/0);var n=this._raycastUI2DNode(t,e,i,r);null!=n&&(LC[NC.length-1]=n);for(var s,a=h(e.children);!(s=a()).done;){var o=s.value;null!=o&&o.active&&this._raycastUI2DNodeRecursiveChildren(t,o,i,r)}},e._createHandles=function(){this._modelArrayHandle||(this._modelArrayHandle=xo.alloc(),this._scenePoolHandle=Ko.alloc(),Ko.set(this._scenePoolHandle,Wo.MODEL_ARRAY,this._modelArrayHandle),this._spotLightsHandle=Mo.alloc(),Ko.set(this._scenePoolHandle,Wo.SPOT_LIGHT_ARRAY,this._spotLightsHandle),this._sphereLightsHandle=Mo.alloc(),Ko.set(this._scenePoolHandle,Wo.SPHERE_LIGHT_ARRAY,this._sphereLightsHandle))},t}(),wC=uo.create(),RC=new Cs,xC=new Hs,OC=1/0,IC=Jh.create(),MC=new Vi((function(){return{node:null,distance:1/0}}),8),BC=[],PC=new y_,NC=new Vi((function(){return{node:null,distance:1/0}}),8),LC=[],FC=[],DC=[],UC=function(t,e,i,r,n){if(void 0===n&&(n=1/0),OC=n,i===ol.TRIANGLE_LIST)for(var s=e.length,a=0;a<s;a+=3){var o=3*e[a],h=3*e[a+1],l=3*e[a+2];Cs.set(IC.a,t[o],t[o+1],t[o+2]),Cs.set(IC.b,t[h],t[h+1],t[h+2]),Cs.set(IC.c,t[l],t[l+1],t[l+2]);var u=a_.rayTriangle(wC,IC,r);u<=0||u>=OC||(OC=u)}else if(i===ol.TRIANGLE_STRIP)for(var c=e.length-2,_=0,d=0;d<c;d+=1){var p=3*e[d-_],f=3*e[d+_+1],m=3*e[d+2];Cs.set(IC.a,t[p],t[p+1],t[p+2]),Cs.set(IC.b,t[f],t[f+1],t[f+2]),Cs.set(IC.c,t[m],t[m+1],t[m+2]),_=~_;var g=a_.rayTriangle(wC,IC,r);g<=0||g>=OC||(OC=g)}else if(i===ol.TRIANGLE_FAN){var v=e.length-1,y=3*e[0];Cs.set(IC.a,t[y],t[y+1],t[y+2]);for(var T=1;T<v;T+=1){var E=3*e[T],S=3*e[T+1];Cs.set(IC.b,t[E],t[E+1],t[E+2]),Cs.set(IC.c,t[S],t[S+1],t[S+2]);var b=a_.rayTriangle(wC,IC,r);b<=0||b>=OC||(OC=b)}}};$s(CC.prototype,"RenderScene.prototype",[{name:"raycastUI",newName:"raycastAllCanvas"},{name:"raycastUI2D",newName:"raycastAllCanvas"},{name:"raycast",newName:"raycastAllModels"},{name:"raycastModels",newName:"raycastAllModels"},{name:"raycastModel",newName:"raycastSingleModel"}]),ta(CC.prototype,"RenderScene.prototype",[{name:"raycastUI2DNode"},{name:"raycastUINode"}]),ea(CC.prototype,"RenderScene.prototype",[{name:"raycastAll",suggest:"using intersect in geometry"},{name:"raycastAllModels",suggest:"using intersect in geometry"},{name:"raycastSingleModel",suggest:"using intersect in geometry"},{name:"raycastAllCanvas",suggest:"using intersect in geometry"},{name:"rayResultCanvas"},{name:"rayResultModels"},{name:"rayResultAll"},{name:"rayResultSingleModel"}]);var kC={};ta(kC,"CameraVisFlags",[{name:"GENERAL"}]),$s(kC,"CameraVisFlags",[{name:"PROFILER",newName:"PROFILER",target:vp.BitMask,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:vp.BitMask,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:vp.BitMask,targetName:"EDITOR"},{name:"UI",newName:"UI",target:vp.BitMask,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:vp.BitMask,targetName:"UI_2D"}]),_.CameraVisFlags=kC;var zC={};ta(zC,"VisibilityFlags",[{name:"GENERAL"}]),$s(zC,"VisibilityFlags",[{name:"ALWALS",newName:"ALWALS",target:vp.Enum,targetName:"ALWALS"},{name:"PROFILER",newName:"PROFILER",target:vp.Enum,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:vp.Enum,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:vp.Enum,targetName:"EDITOR"},{name:"UI",newName:"UI",target:vp.Enum,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:vp.Enum,targetName:"UI_2D"}]),_.VisibilityFlags=zC,$s(Mm.prototype,"Pass.prototype",[{name:"getBindingTypeFromHandle",newName:"getDescriptorTypeFromHandle"}]),ta(hb.prototype,"Camera.prototype",[{name:"getSplitFrustum"}]);var GC,HC,VC,WC,jC,XC,YC,qC,KC,ZC,QC=new Cs(0,0,-1),JC=new Cs,$C=function(t){function e(){var e;return(e=t.call(this)||this)._dir=new Cs(1,-1,-1),e._shadowRange=1e3,e._shadowIntensity=0,e._shadowFadeDistance=0,e._shadowDistance=0,e._fadeStart=.8,e._splits=new Os(1,0,0,0),e._biasAutoAdjust=1,e}s(e,t),r(e,[{key:"shadowRange",set:function(t){this._shadowRange=t},get:function(){return this._shadowRange}},{key:"shadowIntensitywRange",set:function(t){this._shadowIntensity=t}},{key:"shadowIntensity",get:function(){return this._shadowIntensity}},{key:"shadowFadeDistance",set:function(t){this._shadowFadeDistance=t},get:function(){return this._shadowFadeDistance}},{key:"shadowDistance",set:function(t){this._shadowDistance=t},get:function(){return this._shadowDistance}},{key:"fadeStart",set:function(t){this._fadeStart=t},get:function(){return this._fadeStart}},{key:"splits",set:function(t){this._splits=t},get:function(){return this._splits}},{key:"biasAutoAdjust",set:function(t){this._biasAutoAdjust=t},get:function(){return this._biasAutoAdjust}},{key:"direction",set:function(t){Cs.normalize(this._dir,t),Ch.setVec3(this._handle,Eh.DIRECTION,this._dir)},get:function(){return this._dir}},{key:"illuminance",set:function(t){Ch.set(this._handle,Eh.ILLUMINANCE,t)},get:function(){return Ch.get(this._handle,Eh.ILLUMINANCE)}}]);var i=e.prototype;return i.initialize=function(){t.prototype.initialize.call(this),Ch.set(this._handle,Eh.ILLUMINANCE,Vb.SUN_ILLUM),Ch.setVec3(this._handle,Eh.DIRECTION,this._dir),Ch.set(this._handle,Eh.TYPE,uS.DIRECTIONAL)},i.update=function(){this._node&&this._node.hasChangedFlags&&(this.direction=Cs.transformQuat(JC,QC,this._node.worldRotation))},e}(pS),tw=function(t){function e(){var e;return(e=t.call(this)||this)._needUpdate=!1,e._pos=void 0,e._aabb=void 0,e._hAABB=0,e._aabb=y_.create(),e._pos=new Cs,e}s(e,t),r(e,[{key:"position",get:function(){return this._pos}},{key:"size",set:function(t){Ch.set(this._handle,Eh.SIZE,t)},get:function(){return Ch.get(this._handle,Eh.SIZE)}},{key:"range",set:function(t){Ch.set(this._handle,Eh.RANGE,t),this._needUpdate=!0},get:function(){return Ch.get(this._handle,Eh.RANGE)}},{key:"luminance",set:function(t){Ch.set(this._handle,Eh.ILLUMINANCE,t)},get:function(){return Ch.get(this._handle,Eh.ILLUMINANCE)}},{key:"aabb",get:function(){return this._aabb}}]);var i=e.prototype;return i.initialize=function(){t.prototype.initialize.call(this),this._hAABB=Xo.alloc(),Ch.set(this._handle,Eh.TYPE,uS.SPHERE),Ch.set(this._handle,Eh.SIZE,.15),Ch.set(this._handle,Eh.RANGE,1),Ch.set(this._handle,Eh.AABB,this._hAABB),Ch.set(this._handle,Eh.ILLUMINANCE,1700/dS(.15))},i.update=function(){if(this._node&&(this._node.hasChangedFlags||this._needUpdate)){this._node.getWorldPosition(this._pos);var t=Ch.get(this._handle,Eh.RANGE);y_.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,t,t,t),this._needUpdate=!1,Ch.setVec3(this._handle,Eh.POSITION,this._pos),Xo.setVec3(this._hAABB,Go.CENTER,this._aabb.center),Xo.setVec3(this._hAABB,Go.HALF_EXTENSION,this._aabb.halfExtents)}},i.destroy=function(){return this._hAABB&&(Xo.free(this._hAABB),this._hAABB=0),t.prototype.destroy.call(this)},e}(pS),ew=new Cs(0,0,-1),iw=new Ns,rw=new Hs,nw=new Hs,sw=new Hs,aw=new Hs,ow=function(t){function e(){var e;return(e=t.call(this)||this)._dir=new Cs(1,-1,-1),e._range=5,e._spotAngle=Math.cos(Math.PI/6),e._pos=void 0,e._aabb=void 0,e._frustum=void 0,e._angle=0,e._needUpdate=!1,e._hAABB=0,e._hFrustum=0,e._aabb=y_.create(),e._frustum=x_.create(),e._pos=new Cs,e}s(e,t),r(e,[{key:"position",get:function(){return this._pos}},{key:"size",set:function(t){Ch.set(this._handle,Eh.SIZE,t)},get:function(){return Ch.get(this._handle,Eh.SIZE)}},{key:"range",set:function(t){this._range=t,Ch.set(this._handle,Eh.RANGE,t),this._needUpdate=!0},get:function(){return Ch.get(this._handle,Eh.RANGE)}},{key:"luminance",set:function(t){Ch.set(this._handle,Eh.ILLUMINANCE,t)},get:function(){return Ch.get(this._handle,Eh.ILLUMINANCE)}},{key:"direction",get:function(){return this._dir}},{key:"spotAngle",get:function(){return Ch.get(this._handle,Eh.SPOT_ANGLE)},set:function(t){this._angle=t,Ch.set(this._handle,Eh.SPOT_ANGLE,Math.cos(.5*t)),this._needUpdate=!0}},{key:"aspect",set:function(t){Ch.set(this._handle,Eh.ASPECT,t),this._needUpdate=!0},get:function(){return Ch.get(this._handle,Eh.ASPECT)}},{key:"aabb",get:function(){return this._aabb}},{key:"frustum",get:function(){return this._frustum}}]);var i=e.prototype;return i.initialize=function(){t.prototype.initialize.call(this),this._hAABB=Xo.alloc(),this._hFrustum=uh.alloc(),Ch.set(this._handle,Eh.TYPE,uS.SPOT),Ch.set(this._handle,Eh.SIZE,.15),Ch.set(this._handle,Eh.AABB,this._hAABB),Ch.set(this._handle,Eh.ILLUMINANCE,1700/dS(.15)),Ch.set(this._handle,Eh.RANGE,Math.cos(Math.PI/6)),Ch.set(this._handle,Eh.ASPECT,1),Ch.setVec3(this._handle,Eh.DIRECTION,this._dir)},i.update=function(){this._node&&(this._node.hasChangedFlags||this._needUpdate)&&(this._node.getWorldPosition(this._pos),Cs.transformQuat(this._dir,ew,this._node.getWorldRotation(iw)),Cs.normalize(this._dir,this._dir),Ch.setVec3(this._handle,Eh.DIRECTION,this._dir),y_.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,this._range,this._range,this._range),this._node.getWorldRT(rw),Hs.invert(rw,rw),Hs.perspective(nw,this._angle,1,.001,this._range),Hs.multiply(sw,nw,rw),this._frustum.update(sw,aw),this._needUpdate=!1,Ch.setVec3(this._handle,Eh.POSITION,this._pos),Xo.setVec3(this._hAABB,Go.CENTER,this._aabb.center),Xo.setVec3(this._hAABB,Go.HALF_EXTENSION,this._aabb.halfExtents),O_(this._hFrustum,this._frustum))},i.destroy=function(){return this._hAABB&&(Xo.free(this._hAABB),this._hAABB=0),this._hFrustum&&(uh.free(this._hFrustum),this._hFrustum=0),t.prototype.destroy.call(this)},e}(pS),hw=Object.freeze({__proto__:null,Ambient:Vb,get CameraFOVAxis(){return WS},get CameraProjection(){return jS},get CameraAperture(){return XS},get CameraISO(){return YS},get CameraShutter(){return qS},SKYBOX_FLAG:ab,Camera:hb,CameraVisFlags:kC,VisibilityFlags:zC,DirectionalLight:$C,ColorTemperatureToRGB:_S,get LightType(){return uS},nt2lm:dS,Light:pS,get ModelType(){return XA},Model:aC,ShadowType:OS,PCFType:IS,Shadows:BS,RenderScene:CC,Skybox:BA,SphereLight:tw,SpotLight:ow,SubModel:hT}),lw=function(){this.material=null,this.vertexCount=0,this.indicesCount=0},uw=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).vData=null,e.uvDirty=!0,e.vertDirty=!0,e._data=[],e._indices=[],e._pivotX=0,e._pivotY=0,e._width=0,e._height=0,e}s(e,t),e.add=function(){return dw.add()},e.remove=function(t){var e=dw.data.indexOf(t);-1!==e&&(dw.data[e].clear(),dw.removeAt(e))};var i=e.prototype;return i.updateSizeNPivot=function(t,e,i,r){t===this._width&&e===this._height&&i===this._pivotX&&r===this._pivotY||(this._width=t,this._height=e,this._pivotX=i,this._pivotY=r,this.vertDirty=!0)},i.clear=function(){this._data.length=0,this._indices.length=0,this._pivotX=0,this._pivotY=0,this._width=0,this._height=0,this.uvDirty=!0,this.vertDirty=!0,this.material=null,this.vertexCount=0,this.indicesCount=0},r(e,[{key:"dataLength",get:function(){return this._data.length},set:function(t){var e=this._data;if(e.length!==t){var i=e.length,r=0;for(r=t;r<i;r++)_w.free(e[r]);for(r=i;r<t;r++)e[r]=_w.alloc();e.length=t}}},{key:"data",get:function(){return this._data}}]),e}(lw),cw=function(t){function e(e){var i;return void 0===e&&(e=9),(i=t.call(this)||this).vData=void 0,i.iData=void 0,i.vertexStart=0,i.indicesStart=0,i.byteStart=0,i.byteCount=0,i.lastFilledIndices=0,i.lastFilledVertex=0,i._formatByte=void 0,i._formatByte=e*Float32Array.BYTES_PER_ELEMENT,i.vData=new Float32Array(256*e*Float32Array.BYTES_PER_ELEMENT),i.iData=new Uint16Array(1536),i}s(e,t),e.add=function(){return pw.add()},e.remove=function(t){var e=pw.data.indexOf(t);-1!==e&&(pw.data[e].reset(),pw.removeAt(e))};var i=e.prototype;return i.request=function(t,e){var i=this.byteCount+t*this._formatByte;return this.reserve(t,e),this.vertexCount+=t,this.indicesCount+=e,this.byteCount=i,!0},i.reserve=function(t,e){var i=this.byteCount+t*this._formatByte,r=this.indicesCount+e;if(t+this.vertexCount>65535)return!1;var n=this.vData.byteLength,s=this.iData.length,a=this.vData.length,o=this.iData.length;if(i>n||r>s){for(;n<i||s<r;)n=4*(a*=2),s=o*=2;this._reallocBuffer(a,o)}return!0},i.advance=function(t,e){this.vertexCount+=t,this.indicesCount+=e,this.byteCount+=t*this._formatByte},i.reset=function(){this.vertexCount=0,this.indicesCount=0,this.byteCount=0,this.vertexStart=0,this.indicesStart=0,this.byteStart=0,this.lastFilledIndices=0,this.lastFilledVertex=0},i._reallocBuffer=function(t,e){var i=this.vData;this.vData=new Float32Array(t),this.vData.set(i,0);var r=this.iData;this.iData=new Uint16Array(e),this.iData.set(r,0)},r(e,[{key:"formatByte",set:function(t){this._formatByte=t},get:function(){return this._formatByte}},{key:"floatStride",get:function(){return this._formatByte>>2}},{key:"vDataOffset",get:function(){return this.byteCount>>>2}}]),e}(lw),_w=(function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;i._fillQuadBuffer=function(){for(var t=this.iData.length/6,e=this.iData,i=0,r=0;i<t;i++){var n=4*i;e[r++]=n,e[r++]=n+1,e[r++]=n+2,e[r++]=n+1,e[r++]=n+3,e[r++]=n+2}},i._reallocBuffer=function(e,i){t.prototype._reallocBuffer.call(this,e,i),this._fillQuadBuffer()}}(cw),new Hi((function(){return{x:0,y:0,z:0,u:0,v:0,color:Qs.WHITE.clone()}}),128)),dw=new Vi((function(){return new uw}),32),pw=new Vi((function(){return new cw}),32),fw=function(t){if(void 0===Wf[t]){var e=1<<Vf;Wf[t]=e,Vf+=1}},mw=Object.freeze({__proto__:null,addStage:fw,scene:hw,models:AC,createIA:function(t,e){if(!e.positions)return console.error("The data must have positions field"),null;for(var i=[],r=e.positions.length/3,n=0;n<r;++n)i.push(e.positions[3*n],e.positions[3*n+1],e.positions[3*n+2]),e.normals&&i.push(e.normals[3*n],e.normals[3*n+1],e.normals[3*n+2]),e.uvs&&i.push(e.uvs[2*n],e.uvs[2*n+1]),e.colors&&i.push(e.colors[3*n],e.colors[3*n+1],e.colors[3*n+2]);var s=[];s.push(new hu(tl.ATTR_POSITION,il.RGB32F)),e.normals&&s.push(new hu(tl.ATTR_NORMAL,il.RGB32F)),e.uvs&&s.push(new hu(tl.ATTR_TEX_COORD,il.RG32F)),e.colors&&s.push(new hu(tl.ATTR_COLOR,il.RGB32F));var a=t.createBuffer(new Kl(rl.VERTEX|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,4*i.length,4*i.length/r));a.update(new Float32Array(i));var o=null;return e.indices&&(o=t.createBuffer(new Kl(rl.INDEX|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,2*e.indices.length,2))).update(new Uint16Array(e.indices)),t.createInputAssembler(new lu(s,[a],o))},get RenderQueue(){return Uf},get PassStage(){return kf},get PropertyType(){return Hf},genHandle:Xf,getPropertyTypeFromHandle:Yf,getTypeFromHandle:qf,getSetIndexFromHandle:function(t){return(3145728&t)>>>20},getBindingFromHandle:Kf,getOffsetFromHandle:Zf,customizeType:Qf,type2reader:Jf,type2writer:$f,getDefaultFromType:em,overrideMacros:im,get BatchingSchemes(){return Am},Pass:Mm,getDeviceShaderVersion:Tm,programLib:Em,get SamplerInfoIndex(){return Fd},defaultSamplerHash:kd,genSamplerHash:Hd,samplerLib:ep,nearestPOT:Bm,TextureBufferPool:Jm,MaterialInstance:Lg,PassInstance:Ng,ObjectPool:go,freeHandleArray:To,get PoolType(){return fo},NULL_HANDLE:0,ShaderPool:So,DSPool:bo,IAPool:Ao,PipelineLayoutPool:Co,FramebufferPool:wo,SubModelArrayPool:Ro,ModelArrayPool:xo,AttributeArrayPool:Oo,FlatBufferArrayPool:Io,LightArrayPool:Mo,BlendTargetArrayPool:Bo,RawBufferPool:Po,RawObjectPool:No,get PassView(){return Eo},PassPool:Do,get SubModelView(){return Lo},SubModelPool:zo,get ModelView(){return Uo},ModelPool:Vo,get AABBView(){return Go},AABBPool:Xo,get SceneView(){return Wo},ScenePool:Ko,get CameraView(){return Yo},CameraPool:Jo,get NodeView(){return Zo},NodePool:eh,get RootView(){return th},RootPool:nh,get RenderWindowView(){return ih},RenderWindowPool:oh,get FrustumView(){return sh},FrustumPool:uh,get AmbientView(){return hh},AmbientPool:dh,get SkyboxView(){return _h},SkyboxPool:mh,get FogView(){return ph},FogPool:yh,get ShadowsView(){return vh},ShadowsPool:Sh,get LightView(){return Eh},LightPool:Ch,get SphereView(){return bh},SpherePool:xh,get FlatBufferView(){return Rh},FlatBufferPool:Mh,get SubMeshView(){return Oh},SubMeshPool:Nh,get RasterizerStateView(){return Bh},RasterizerStatePool:Dh,get DepthStencilStateView(){return Lh},DepthStencilStatePool:zh,get BlendTargetView(){return Uh},BlendTargetPool:Hh,get BlendStateView(){return Gh},BlendStatePool:Wh});t("renderer",mw);var gw,vw,yw,Tw,Ew,Sw,bw,Aw,Cw,ww,Rw,xw,Ow,Iw,Mw,Bw,Pw,Nw,Lw,Fw,Dw,Uw,kw,zw,Gw,Hw,Vw,Ww,jw,Xw,Yw,qw={parent:null,owner:null,subModelIdx:0},Kw=t("RenderableComponent",(GC=Ne("cc.RenderableComponent"),HC=pi([mg]),VC=pi(mg),WC=si(),jC=Je(),GC((ZC=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"_materials",qC,a(e)),l(e,"_visFlags",KC,a(e)),e._materialInstances=[],e._models=[],e}s(e,t);var i=e.prototype;return i.getMaterial=function(t){return t<0||t>=this._materials.length?null:this._materials[t]},i.setMaterial=function(t,e){t&&t instanceof Lg&&console.error("Can't set a material instance to a sharedMaterial slot"),this._materials[e]=t;var i=this._materialInstances[e];i?i.parent!==this._materials[e]&&(i.destroy(),this._materialInstances[e]=null,this._onMaterialModified(e,this._materials[e])):this._onMaterialModified(e,this._materials[e])},i.getMaterialInstance=function(t){if(!this._materials[t])return null;if(!this._materialInstances[t]){qw.parent=this._materials[t],qw.owner=this,qw.subModelIdx=t;var e=new Lg(qw);this.setMaterialInstance(t,e)}return this._materialInstances[t]},i.setMaterialInstance=function(t,e){e&&e.parent?e!==this._materialInstances[t]&&(this._materialInstances[t]=e,this._onMaterialModified(t,e)):e!==this._materials[t]&&this.setMaterial(e,t)},i.getRenderMaterial=function(t){return this._materialInstances[t]||this._materials[t]},i._collectModels=function(){return this._models},i._attachToScene=function(){},i._detachFromScene=function(){},i._onMaterialModified=function(){},i._onRebuildPSO=function(){},i._clearMaterials=function(){},i._onVisibilityChange=function(){},r(e,[{key:"visibility",get:function(){return this._visFlags},set:function(t){this._visFlags=t,this._onVisibilityChange(t)}},{key:"sharedMaterials",get:function(){return this._materials},set:function(t){for(var e=0;e<t.length;e++)t[e]!==this._materials[e]&&this.setMaterial(t[e],e);if(t.length<this._materials.length){for(var i=t.length;i<this._materials.length;i++)this.setMaterial(null,i);this._materials.splice(t.length)}}},{key:"materials",get:function(){for(var t=0;t<this._materials.length;t++)this._materialInstances[t]=this.getMaterialInstance(t);return this._materialInstances},set:function(t){var e=t.length-this._materials.length;if(e>0)this._materials.length=t.length,this._materialInstances.length=t.length;else if(e<0)for(var i=this._materials.length-e;i<this._materials.length;++i)this.setMaterialInstance(i,null);for(var r=0;r<this._materialInstances.length;r++)this._materialInstances[r]!=t[r]&&this.setMaterialInstance(r,t[r])}},{key:"sharedMaterial",get:function(){return this.getMaterial(0)}},{key:"material",get:function(){return this.getMaterialInstance(0)},set:function(t){1===this._materials.length&&this._materials[0]===t||this.setMaterialInstance(0,t)}}]),e}(ds),qC=u((YC=ZC).prototype,"_materials",[HC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),KC=u(YC.prototype,"_visFlags",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return vp.Enum.NONE}}),u(YC.prototype,"sharedMaterials",[VC,WC,jC],Object.getOwnPropertyDescriptor(YC.prototype,"sharedMaterials"),YC.prototype),XC=YC))||XC));_.RenderableComponent=Kw;var Zw=Pt({OFF:0,ON:1}),Qw=Pt({OFF:0,ON:1}),Jw=(gw=Ne("cc.ModelLightmapSettings"),vw=ze("_recieveShadow"),gw((Rw=function(){function t(){l(this,"texture",Ew,this),l(this,"uvParam",Sw,this),l(this,"_bakeable",bw,this),l(this,"_castShadow",Aw,this),l(this,"_receiveShadow",Cw,this),l(this,"_lightmapSize",ww,this)}return r(t,[{key:"bakeable",get:function(){return this._bakeable},set:function(t){this._bakeable=t}},{key:"castShadow",get:function(){return this._castShadow},set:function(t){this._castShadow=t}},{key:"receiveShadow",get:function(){return this._receiveShadow},set:function(t){this._receiveShadow=t}},{key:"lightmapSize",get:function(){return this._lightmapSize},set:function(t){this._lightmapSize=t}}]),t}(),Ew=u((Tw=Rw).prototype,"texture",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Sw=u(Tw.prototype,"uvParam",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Os}}),bw=u(Tw.prototype,"_bakeable",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Aw=u(Tw.prototype,"_castShadow",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Cw=u(Tw.prototype,"_receiveShadow",[vw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ww=u(Tw.prototype,"_lightmapSize",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),u(Tw.prototype,"bakeable",[Ke],Object.getOwnPropertyDescriptor(Tw.prototype,"bakeable"),Tw.prototype),u(Tw.prototype,"castShadow",[Ke],Object.getOwnPropertyDescriptor(Tw.prototype,"castShadow"),Tw.prototype),u(Tw.prototype,"receiveShadow",[Ke],Object.getOwnPropertyDescriptor(Tw.prototype,"receiveShadow"),Tw.prototype),u(Tw.prototype,"lightmapSize",[Ke],Object.getOwnPropertyDescriptor(Tw.prototype,"lightmapSize"),Tw.prototype),yw=Tw))||yw),$w=function(e){return t({MeshRenderer:e,ModelComponent:e}),e}((xw=Ne("cc.MeshRenderer"),Ow=qe(),Iw=Fe(100),Mw=We(),Bw=pi(Zw),Pw=$e(),Nw=pi(Qw),Lw=$e(),Fw=pi(Bf),Dw=$e(),Uw=Ze(),xw(kw=Ow(kw=Iw(kw=Mw(kw=Ve((Yw=Xw=function(t){function e(){var e;return l(e=t.call(this)||this,"lightmapSettings",Gw,a(e)),l(e,"_mesh",Hw,a(e)),l(e,"_shadowCastingMode",Vw,a(e)),l(e,"_shadowReceivingMode",Ww,a(e)),e._modelType=void 0,e._model=null,e._morphInstance=null,l(e,"_enableMorph",jw,a(e)),e._modelType=aC,e}s(e,t),r(e,[{key:"shadowCastingMode",get:function(){return this._shadowCastingMode},set:function(t){this._shadowCastingMode=t,this._updateCastShadow()}},{key:"receiveShadow",get:function(){return this._shadowReceivingMode},set:function(t){this._shadowReceivingMode=t,this._updateReceiveShadow()}},{key:"mesh",get:function(){return this._mesh},set:function(t){var e,i=this._mesh;this._mesh=t,null===(e=this._mesh)||void 0===e||e.initialize(),this._watchMorphInMesh(),this._onMeshChanged(i),this._updateModels(),this.enabledInHierarchy&&this._attachToScene()}},{key:"model",get:function(){return this._model}},{key:"enableMorph",get:function(){return this._enableMorph},set:function(t){this._enableMorph=t}}]);var i=e.prototype;return i.onLoad=function(){var t;null===(t=this._mesh)||void 0===t||t.initialize(),this._watchMorphInMesh(),this._updateModels(),this._updateCastShadow(),this._updateReceiveShadow()},i.onRestore=function(){this._updateModels(),this._updateCastShadow(),this._updateReceiveShadow()},i.onEnable=function(){this._model||this._updateModels(),this._attachToScene()},i.onDisable=function(){this._model&&this._detachFromScene()},i.onDestroy=function(){this._model&&(_.director.root.destroyModel(this._model),this._model=null,this._models.length=0),this._morphInstance&&this._morphInstance.destroy()},i.setWeights=function(t,e){this._morphInstance&&this._morphInstance.setWeights(e,t)},i.setInstancedAttribute=function(t,e){if(this.model)for(var i=this.model.instancedAttributes,r=i.attributes,n=i.views,s=0;s<r.length;s++)if(r[s].name===t){n[s].set(e);break}},i._updateLightmap=function(t,e,i,r,n){this.lightmapSettings.texture=t,this.lightmapSettings.uvParam.x=e,this.lightmapSettings.uvParam.y=i,this.lightmapSettings.uvParam.z=r,this.lightmapSettings.uvParam.w=n,this._onUpdateLightingmap()},i._updateModels=function(){if(this.enabledInHierarchy&&this._mesh){var t=this._model;t?(t.destroy(),t.initialize(),t.node=t.transform=this.node):this._createModel(),this._model&&(this._model.createBoundingShape(this._mesh.struct.minPosition,this._mesh.struct.maxPosition),this._updateModelParams(),this._onUpdateLightingmap())}},i._createModel=function(){var t=this._morphInstance&&this._modelType===aC?oC:this._modelType,e=this._model=_.director.root.createModel(t);e.visFlags=this.visibility,e.node=e.transform=this.node,this._models.length=0,this._models.push(this._model),this._morphInstance&&e instanceof oC&&e.setMorphRendering(this._morphInstance)},i._attachToScene=function(){if(this.node.scene&&this._model){var t=this._getRenderScene();null!==this._model.scene&&this._detachFromScene(),t.addModel(this._model)}},i._detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},i._updateModelParams=function(){if(this._mesh&&this._model){this.node.hasChangedFlags|=Uv.POSITION,this._model.transform.hasChangedFlags|=Uv.POSITION,this._model.isDynamicBatching=this._isBatchingEnabled();var t=this._mesh?this._mesh.renderingSubMeshes.length:0,e=this._mesh.renderingSubMeshes;if(e)for(var i=0;i<t;++i){var r=this.getRenderMaterial(i);r&&!r.isValid&&(r=null);var n=e[i];n&&this._model.initSubModel(i,n,r||this._getBuiltinMaterial())}this._model.enabled=!0}},i._onUpdateLightingmap=function(){null!==this.model&&this.model.updateLightingmap(this.lightmapSettings.texture,this.lightmapSettings.uvParam),this.setInstancedAttribute("a_lightingMapUVParam",[this.lightmapSettings.uvParam.x,this.lightmapSettings.uvParam.y,this.lightmapSettings.uvParam.z,this.lightmapSettings.uvParam.w])},i._onMaterialModified=function(t,e){this._model&&this._model.inited&&this._onRebuildPSO(t,e||this._getBuiltinMaterial())},i._onRebuildPSO=function(t,e){this._model&&this._model.inited&&(this._model.isDynamicBatching=this._isBatchingEnabled(),this._model.setSubModelMaterial(t,e),this._onUpdateLightingmap())},i._onMeshChanged=function(){},i._clearMaterials=function(){if(this._model)for(var t=this._model.subModels,e=0;e<t.length;++e)this._onMaterialModified(e,null)},i._getBuiltinMaterial=function(){return wm.get("missing-material")},i._onVisibilityChange=function(t){this._model&&(this._model.visFlags=t)},i._updateCastShadow=function(){this._model&&(this._shadowCastingMode===Zw.OFF?this._model.castShadow=!1:(this._shadowCastingMode,Zw.ON,this._shadowCastingMode,this._model.castShadow=!0))},i._updateReceiveShadow=function(){this._model&&(this._shadowReceivingMode===Qw.OFF?this._model.receiveShadow=!1:this._model.receiveShadow=!0)},i._isBatchingEnabled=function(){for(var t=0;t<this._materials.length;++t){var e=this._materials[t];if(e)for(var i=0;i<e.passes.length;++i)if(e.passes[i].batchingScheme)return!0}return!1},i._watchMorphInMesh=function(){if(this._morphInstance&&(this._morphInstance.destroy(),this._morphInstance=null),this._enableMorph&&this._mesh&&this._mesh.struct.morph&&this._mesh.morphRendering){var t=this._mesh.struct.morph;this._morphInstance=this._mesh.morphRendering.createInstance();for(var e=this._mesh.struct.primitives.length,i=0;i<e;++i){var r=t.subMeshMorphs[i];if(r){var n=r.weights||t.weights,s=n?n.slice():new Array(r.targets.length).fill(0);this._morphInstance.setWeights(i,s)}}this._model&&this._model instanceof oC&&this._model.setMorphRendering(this._morphInstance)}},i._syncMorphWeights=function(t){if(this._morphInstance){var e=this._morphInstance[t];e&&e.renderResources&&e.renderResources.setWeights(e.weights)}},e}(Kw),Xw.ShadowCastingMode=Zw,Xw.ShadowReceivingMode=Qw,Gw=u((zw=Yw).prototype,"lightmapSettings",[ke,Ke,li],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Jw}}),Hw=u(zw.prototype,"_mesh",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Vw=u(zw.prototype,"_shadowCastingMode",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Zw.OFF}}),Ww=u(zw.prototype,"_shadowReceivingMode",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Qw.ON}}),u(zw.prototype,"shadowCastingMode",[Bw,Pw,li],Object.getOwnPropertyDescriptor(zw.prototype,"shadowCastingMode"),zw.prototype),u(zw.prototype,"receiveShadow",[Nw,Lw,li],Object.getOwnPropertyDescriptor(zw.prototype,"receiveShadow"),zw.prototype),u(zw.prototype,"mesh",[Fw,Dw],Object.getOwnPropertyDescriptor(zw.prototype,"mesh"),zw.prototype),u(zw.prototype,"enableMorph",[Uw,li],Object.getOwnPropertyDescriptor(zw.prototype,"enableMorph"),zw.prototype),jw=u(zw.prototype,"_enableMorph",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),kw=zw))||kw)||kw)||kw)||kw)||kw));function tR(t,e){var i=t.sharedMaterials.length;if(i!==e.sharedMaterials.length)return!1;for(var r=0;r<i;r++)if(t.getRenderMaterial(r)!==e.getRenderMaterial(r))return!1;return!0}t("BatchingUtility",function(){function t(){}return t.batchStaticModel=function(t,e){var i=t.getComponentsInChildren($w);if(i.length<2)return console.error("the number of static models to batch is less than 2,it needn't batch."),!1;for(var r=1;r<i.length;r++){if(!i[0].mesh.validateMergingMesh(i[r].mesh))return console.error("the meshes of "+i[0].node.name+" and "+i[r].node.name+" can't be merged"),!1;if(!tR(i[0],i[r]))return console.error("the materials of "+i[0].node.name+" and "+i[r].node.name+" can't be merged"),!1}var n=new Bf,s=new Hs,a=new Hs;t.getWorldMatrix(a),Hs.invert(a,a);for(var o=0;o<i.length;o++){var h=i[o];h.node.getWorldMatrix(s),Hs.multiply(s,a,s),n.merge(i[o].mesh,s),h.enabled=!1}var l=e.addComponent($w);return l.mesh=n,l.sharedMaterials=i[0].sharedMaterials,!0},t.unbatchStaticModel=function(t,e){for(var i=t.getComponentsInChildren("cc.MeshRenderer"),r=0;r<i.length;r++)i[r].enabled=!0;var n=e.getComponent("cc.MeshRenderer");return n&&n.destroy(),!0},t}());var eR=new Cs;function iR(t,e,i,r){r||(r=new Cs),t.convertToUINode(e,i,r);var n=i.position;return r.add(n),r}function rR(t,e,i){return i||(i=new Cs),t.worldToScreen(e,i),i.x=i.x/_.view.getScaleX(),i.y=i.y/_.view.getScaleY(),i}var nR=t("convertUtils",{WorldNode3DToLocalNodeUI:iR,WorldNode3DToWorldNodeUI:rR});_.pipelineUtils=nR,$s(_.pipelineUtils,"cc.pipelineUtils",[{name:"WorldNode3DToLocalNodeUI",newName:"convertToUINode",targetName:"cc.Camera.prototype",customFunction:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var r=e[0],n=e[3]||eR;return r.convertToUINode(e[1],e[2],n),n.add(e[2].position),e[3]||n.clone()}}]);var sR,aR,oR,hR,lR,uR=Object.freeze({__proto__:null,ccclass:Ne,property:Ue,requireComponent:Le,executionOrder:Fe,disallowMultiple:De,executeInEditMode:Ve,menu:We,playOnFocus:je,inspector:Xe,icon:Ye,help:qe,type:pi,integer:ui,float:ci,boolean:_i,string:di});t("_decorator",uR);var cR=t("MissingScript",Ne("cc.MissingScript")(sR=Xe()((lR=function(t){function e(){var e;return l(e=t.call(this)||this,"compiled",oR,a(e)),l(e,"_$erialized",hR,a(e)),e}return s(e,t),e.safeFindClass=function(t){var e=wt(t);if(e)return e;_.deserialize.reportMissingClass(t)},e.prototype.onLoad=function(){I(4600,this.node.name)},e}(ds),oR=u((aR=lR).prototype,"compiled",[Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),hR=u(aR.prototype,"_$erialized",[ke,Ge],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sR=aR))||sR)||sR);function _R(t){var e,i,r,n=t.deserializedList,s=t._idPropList,a=t._idList,o=t._idObjList;for(t._classFinder&&t._classFinder.onDereferenced,e=0;e<a.length;e++)i=s[e],r=a[e],o[e][i]=n[r]}function dR(t,e,i,r,n){if(e instanceof _.ValueType){n||t.push("if(prop){");var s=rt(e);t.push("s._deserializeTypedObject(o"+i+",prop,"+s+");"),n||t.push("}else o"+i+"=null;")}else t.push("if(prop){"),t.push("s._deserializeObjField(o,prop,"+r+");"),t.push("}else o"+i+"=null;")}_._MissingScript=cR;var pR=function(){function t(t,e,i){this.result=void 0,this.customEnv=void 0,this.deserializedList=void 0,this.deserializedData=void 0,this._classFinder=void 0,this._ignoreEditorOnly=void 0,this._idList=void 0,this._idObjList=void 0,this._idPropList=void 0,this.result=t,this.customEnv=i,this.deserializedList=[],this.deserializedData=null,this._classFinder=e,this._idList=[],this._idObjList=[],this._idPropList=[]}var e=t.prototype;return e.deserialize=function(t){if(Array.isArray(t)){var e=t,i=e.length;this.deserializedList.length=i;for(var r=0;r<i;r++)e[r]&&(this.deserializedList[r]=this._deserializeObject(e[r]));this.deserializedData=i>0?this.deserializedList[0]:[],_R(this)}else{var n;this.deserializedList.length=1,n=t?this._deserializeObject(t):null,_R(this),this.deserializedList[0]=n,this.deserializedData=n}return this.deserializedData},e._deserializeObject=function(t,e,i){var r,n=null,s=null,a=t.__type__;if("TypedArray"===a){var o=t.array;n=new window[t.ctor](o.length);for(var h=0;h<o.length;++h)n[h]=o[h];return n}if(a){if(!(s=this._classFinder(a,t,e,i)))return this._classFinder===wt&&_.deserialize.reportMissingClass(a),null;(n=new s)._deserialize?n._deserialize(t.content,this):_.Class._isCCClass(s)?function(t,e,i,r){var n;r.hasOwnProperty("__deserialize__")?n=r.__deserialize__:(n=function(t,e){for(var i=ie(e),r=e.__values__,n=["var prop;"],s=kt.test(xt(e)),a=0;a<r.length;a++){var o=r[a],h=void 0,l=void 0;Ae.IDENTIFIER_RE.test(o)?(l='"'+o+'"',h="."+o):h="["+(l=Ae.escapeForJS(o))+"]";var u=h;if(i[o+"$_$formerlySerializedAs"]){var c=i[o+"$_$formerlySerializedAs"];u=Ae.IDENTIFIER_RE.test(c)?"."+c:"["+Ae.escapeForJS(c)+"]"}n.push("prop=d"+u+";"),n.push('if(typeof prop!=="undefined"){');var d=Ae.getDefault(i[o+"$_$default"]);if(s){var p=void 0,f=i[o+"$_$type"];if(void 0===d&&f)p=f instanceof ne;else{var m=typeof d;p="string"===m||"number"===m||"boolean"===m}p?n.push("o"+h+"=prop;"):dR(n,d,h,l,!0)}else n.push('if(typeof prop!=="object"){o'+h+"=prop;}else{"),dR(n,d,h,l,!1),n.push("}");n.push("}")}return(_.js.isChildClassOf(e,_._BaseNode)||_.js.isChildClassOf(e,_.Component))&&n.push("d._id&&(o._id=d._id);"),"_$erialized"===r[r.length-1]&&(n.push("o._$erialized=JSON.parse(JSON.stringify(d));"),n.push("s._deserializePrimitiveObject(o._$erialized,d);")),Function("s","o","d","k",n.join(""))}(0,r),J(r,"__deserialize__",n,!0)),n(t,e,i,r)}(this,n,t,s):this._deserializeTypedObject(n,t,s)}else if(Array.isArray(t)){n=new Array(t.length);for(var l=0;l<t.length;l++)"object"==typeof(r=t[l])&&r?this._deserializeObjField(n,r,""+l):n[l]=r}else n={},this._deserializePrimitiveObject(n,t);return n},e._deserializeObjField=function(t,e,i){var r=e.__id__;if(void 0===r){var n=e.__uuid__;n?this.result.push(t,i,n):t[i]=this._deserializeObject(e)}else{var s=this.deserializedList[r];s?t[i]=s:(this._idList.push(r),this._idObjList.push(t),this._idPropList.push(i))}},e._deserializePrimitiveObject=function(t,e){for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];"object"!=typeof r?"__type__"!==i&&(t[i]=r):r?this._deserializeObjField(t,r,i):t[i]=null}},e._deserializeTypedObject=function(t,e,i){if(i===_.Vec2)return t.x=e.x||0,void(t.y=e.y||0);if(i===_.Vec3)return t.x=e.x||0,t.y=e.y||0,void(t.z=e.z||0);if(i!==_.Color){if(i===_.Size)return t.width=e.width||0,void(t.height=e.height||0);for(var r=ie(i),n=i.__props__||Object.keys(t),s=0;s<n.length;s++){var a=n[s],o=e[a];void 0!==o&&e.hasOwnProperty(a)||(o=Ae.getDefault(r[a+"$_$default"])),"object"!=typeof o?t[a]=o:o?this._deserializeObjField(t,o,a):t[a]=null}}else{t.r=e.r||0,t.g=e.g||0,t.b=e.b||0;var h=e.a;t.a=void 0===h?255:h}},t}();pR.pool=void 0,pR.pool=new Ot((function(t){t.result=null,t.customEnv=null,t.deserializedList.length=0,t.deserializedData=null,t._classFinder=null,t._idList.length=0,t._idObjList.length=0,t._idPropList.length=0}),1),pR.pool.get=function(t,e,i,r){var n=this._get();return n?(n.result=t,n.customEnv=i,n._classFinder=e,n):new pR(t,e,i,r)};var fR=[Es,Cs,Os,Ns,Qs,Ys,Ks,Hs];function mR(t,e){t.x=e[1],t.y=e[2],t.z=e[3],t.w=e[4]}var gR=[function(t,e){t.x=e[1],t.y=e[2]},function(t,e){t.x=e[1],t.y=e[2],t.z=e[3]},mR,mR,function(t,e){t._val=e[1]},function(t,e){t.width=e[1],t.height=e[2]},function(t,e){t.x=e[1],t.y=e[2],t.width=e[3],t.height=e[4]},function(t,e){Hs.fromArray(t,e,1)}],vR=t("Details",function(){function t(){this.uuidObjList=null,this.uuidPropList=null,this.uuidList=null}var e=t.prototype;return e.init=function(t){this.uuidObjList=t[8],this.uuidPropList=t[9],this.uuidList=t[10]},e.reset=function(){this.uuidList=null,this.uuidObjList=null,this.uuidPropList=null},e.push=function(t,e,i){this.uuidObjList.push(t),this.uuidPropList.push(e),this.uuidList.push(i)},t}());function yR(t,e){for(var i=t[4][e[0]],r=i[0],n=new(0,r[0]),s=r[1],a=r[2],o=i[i.length-1],h=1;h<o;++h)n[s[i[h]]]=e[h];for(;h<e.length;++h){var l=s[i[h]],u=r[i[h]+a];(0,CR[u])(t,n,l,e[h])}return n}function TR(t,e,i){var r=new e;return r._deserialize?r._deserialize(i,t[0]):B(5303,rt(e)),r}function ER(t,e,i,r){r>=0?e[i]=t[5][r]:t[7][3*~r]=e}function SR(t){return function(e,i,r,n){i[r]=n;for(var s=0;s<n.length;++s)t(e,n,s,n[s])}}function bR(t,e,i,r){e[i]=null,t[8][r]=e}function AR(t,e,i,r){e[i]=yR(t,r)}vR.pool=new Ot((function(t){t.reset()}),5),vR.pool.get=function(){return this._get()||new vR};var CR=new Array(13);function wR(t,e){return t||IR.reportMissingClass(e),Object}function RR(t,e,i,r,n,s){var a=t(e);if(!a){if(n)return void(i[r]=function(e,i,r){return function(){var n=t(r)||wR(s,r);return e[i]=n,new n}}(i,r,e));a=wR(s,e)}i[r]=a}function xR(t,e,i){for(var r=i||wt,n=t[3],s=0;s<n.length;++s){var a=n[s];"string"!=typeof a?RR(r,a[0],a,0,e,i):RR(r,a,n,s,e,i)}}function OR(t){var e=t[4];if(e)for(var i=t[3],r=0;r<e.length;++r){var n=e[r];n[0]=i[n[0]]}}function IR(t,e,i){"string"==typeof t&&(t=JSON.parse(t));var r,n=!e;(e=e||vR.pool.get()).init(t),i=i||{};var s=t[0],a=!1;if("object"==typeof s&&(a=s.preprocessed,s=s.version),s<1)throw new Error(F(5304,s));i._version=s,i.result=e,t[0]=i,a||(xR(t,!1,i.classFinder),OR(t)),_.game._isCloning=!0;var o=t[5],h=function(t){var e=t[5],i=t[6],r=0===i?0:i.length,n=e[e.length-1],s=e.length-r;"number"!=typeof n?n=0:(n<0&&(n=~n),--s);for(var a=0;a<s;++a)e[a]=yR(t,e[a]);for(var o=t[3],h=0;h<r;++h,++a){var l=i[h],u=e[a];if(l>=0){var c=o[l];e[a]=TR(t,c,u)}else(0,CR[l=~l])(t,e,a,u)}return n}(t);return _.game._isCloning=!1,t[7]&&function(t,e,i){for(var r=t.length-1,n=0,s=3*t[r];n<s;n+=3){var a=t[n],o=e[t[n+2]],h=t[n+1];h>=0?a[i[h]]=o:a[~h]=o}for(;n<r;n+=3){var l=e[t[n]],u=e[t[n+2]],c=t[n+1];c>=0?l[i[c]]=u:l[~c]=u}}(t[7],o,t[2]),function(t){for(var e=t[5],i=t[2],r=t[1],n=t[8],s=t[9],a=t[10],o=0;o<n.length;++o){var h=n[o];"number"==typeof h&&(n[o]=e[h]);var l=s[o];"number"==typeof l&&(l=l>=0?i[l]:~l,s[o]=l);var u=a[o];"number"==typeof u&&(a[o]=r[u])}}(t),r=o[h],n&&vR.pool.put(e),r}CR[0]=function(t,e,i,r){e[i]=r},CR[1]=ER,CR[2]=SR(ER),CR[3]=SR(bR),CR[4]=AR,CR[5]=function(t,e,i,r){gR[r[0]](e[i],r)},CR[6]=bR,CR[7]=function(t,e,i,r){e[i].set(r)},CR[8]=function(t,e,i,r){var n=new fR[r[0]];gR[r[0]](n,r),e[i]=n},CR[9]=SR(AR),CR[10]=function(t,e,i,r){var n=t[3][r[0]];e[i]=TR(t,n,r[1])},CR[11]=function(t,e,i,r){var n=r[0];e[i]=n;for(var s=1;s<r.length;s+=3){var a=r[s],o=r[s+1],h=r[s+2];(0,CR[o])(t,n,a,h)}},CR[12]=function(t,e,i,r){var n=r[0];e[i]=n;for(var s=0;s<n.length;++s){var a=n[s],o=r[s+1];0!==o&&(0,CR[o])(t,n,s,a)}},IR.Details=vR,IR.reportMissingClass=function(t){I(5302,t)};var MR=function(t){this.preprocessed=!0,this.version=t};function BR(t,e,i){return[1,0,0,[t],0,i?[e,-1]:[e],[0],0,[],[],[]]}_.deserialize=IR;var PR,NR,LR,FR,DR,UR,kR,zR,GR,HR,VR,WR=Xi.Flags.Destroyed,jR=Xi.Flags.PersistentMask,XR=[];function YR(t){var e;if(t instanceof Xi){if(t._instantiate)return _.game._isCloning=!0,e=t._instantiate(),_.game._isCloning=!1,e;if(t instanceof _.Asset)throw new TypeError(F(6903))}return _.game._isCloning=!0,e=qR(t),_.game._isCloning=!1,e}function qR(t,e){var i;KR(t,i=t._iN$t?t._iN$t:t.constructor?new(0,t.constructor):Object.create(null),e);for(var r=0,n=XR.length;r<n;++r)XR[r]._iN$t=null;return XR.length=0,i}function KR(t,e,i){Mt.value(t,"_iN$t",e,!0),XR.push(t);var r=t.constructor;if(_.Class._isCCClass(r))!function(t,e,i,r){for(var n=t.__values__,s=0;s<n.length;s++){var a=n[s],o=e[a];if("object"==typeof o&&o){var h=i[a];h instanceof Dt&&h.constructor===o.constructor?h.set(o):i[a]=o._iN$t||ZR(o,r)}else i[a]=o}}(r,t,e,i);else for(var n in t)if(t.hasOwnProperty(n)&&(95!==n.charCodeAt(0)||95!==n.charCodeAt(1)||"__type__"===n)){var s=t[n];if("object"==typeof s&&s){if(s===e)continue;e[n]=s._iN$t||ZR(s,i)}else e[n]=s}t instanceof Xi&&(e._objFlags&=jR)}function ZR(t,e){if(t instanceof Dt)return t.clone();if(t instanceof _.Asset)return t;var i;if(ArrayBuffer.isView(t)){var r=t.length;i=new t.constructor(r),t._iN$t=i,XR.push(t);for(var n=0;n<r;++n)i[n]=t[n];return i}if(Array.isArray(t)){var s=t.length;i=new Array(s),t._iN$t=i,XR.push(t);for(var a=0;a<s;++a){var o=t[a];i[a]="object"==typeof o&&o?o._iN$t||ZR(o,e):o}return i}if(t._objFlags&WR)return null;var h=t.constructor;if(_.Class._isCCClass(h)){if(e)if(e instanceof _.Component){if(t instanceof _._BaseNode||t instanceof _.Component)return t}else if(e instanceof _._BaseNode)if(t instanceof _._BaseNode){if(!t.isChildOf(e))return t}else if(t instanceof _.Component&&!t.node.isChildOf(e))return t;i=new h}else if(h===Object)i={};else{if(h)return t;i=Object.create(null)}return KR(t,i,e),i}function QR(t,e){return(e<<3)+t}YR._clone=qR,_.instantiate=YR,function(t){t[t.Uint8=0]="Uint8",t[t.Uint16=1]="Uint16",t[t.Uint32=2]="Uint32",t[t.Int8=3]="Int8",t[t.Int16=4]="Int16",t[t.Int32=5]="Int32",t[t.Float32=6]="Float32",t[t.Float64=7]="Float64"}(HR||(HR={})),function(t){t[t.Scalar=0]="Scalar",t[t.Vec2=1]="Vec2",t[t.Vec3=2]="Vec3",t[t.Vec4=3]="Vec4",t[t.Quat=4]="Quat",t[t.Mat4=5]="Mat4"}(VR||(VR={}));var JR=t("CompactValueTypeArray",Ne("cc.CompactValueTypeArray")((zR=kR=function(){function t(){l(this,"_byteOffset",LR,this),l(this,"_unitCount",FR,this),l(this,"_unitElement",DR,this),l(this,"_length",UR,this)}return t.lengthFor=function(t,e,i){return $R(e).requiredUnits*t.length*tx(i).BYTES_PER_ELEMENT},t.compress=function(e,i,r,n,s,a){for(var o=$R(i),h=tx(r),l=o.requiredUnits*e.length,u=new h(n,s,l),c=0;c<e.length;++c)o.compress(u,c,e[c]);var _=new t;return _._unitElement=QR(r,i),_._byteOffset=a,_._unitCount=l,_._length=e.length,_},t.prototype.decompress=function(t){for(var e,i={storageUnit:7&(e=this._unitElement),elementType:e>>3},r=i.storageUnit,n=$R(i.elementType),s=new(tx(r))(t,this._byteOffset,this._unitCount),a=new Array(this._length),o=0;o<this._length;++o)a[o]=n.decompress(s,o);return a},t}(),kR.StorageUnit=HR,kR.ElementType=VR,LR=u((NR=zR).prototype,"_byteOffset",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),FR=u(NR.prototype,"_unitCount",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),DR=u(NR.prototype,"_unitElement",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return QR(HR.Uint8,VR.Scalar)}}),UR=u(NR.prototype,"_length",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),PR=NR))||PR);function $R(t){return rx[t]}function tx(t){switch(t){case HR.Uint8:return Uint8Array;case HR.Uint16:return Uint16Array;case HR.Uint32:return Uint32Array;case HR.Int8:return Int8Array;case HR.Int16:return Int16Array;case HR.Int32:return Int32Array;case HR.Float32:return Float32Array;case HR.Float64:return Float64Array}}var ex,ix,rx=((GR={})[VR.Scalar]={requiredUnits:1,compress:function(t,e,i){t[e]=i},decompress:function(t,e){return t[e]}},GR[VR.Vec2]={requiredUnits:2,compress:function(t,e,i){t[2*e]=i.x,t[2*e+1]=i.y},decompress:function(t,e){return new Cs(t[2*e],t[2*e+1])}},GR[VR.Vec3]={requiredUnits:3,compress:function(t,e,i){t[3*e]=i.x,t[3*e+1]=i.y,t[3*e+2]=i.z},decompress:function(t,e){return new Cs(t[3*e],t[3*e+1],t[3*e+2])}},GR[VR.Vec4]={requiredUnits:4,compress:function(t,e,i){t[4*e]=i.x,t[4*e+1]=i.y,t[4*e+2]=i.z,t[4*e+3]=i.w},decompress:function(t,e){return new Os(t[4*e],t[4*e+1],t[4*e+2],t[4*e+3])}},GR[VR.Quat]={requiredUnits:4,compress:function(t,e,i){t[4*e]=i.x,t[4*e+1]=i.y,t[4*e+2]=i.z,t[4*e+3]=i.w},decompress:function(t,e){return new Ns(t[4*e],t[4*e+1],t[4*e+2],t[4*e+3])}},GR[VR.Mat4]={requiredUnits:16,compress:function(t,e,i){Hs.toArray(t,i,16*e)},decompress:function(t,e){return Hs.fromArray(new Hs,t,16*e)}},GR);_._decorator=uR;var nx=t("BufferAsset",Ne("cc.BufferAsset")((u((ix=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._buffer=null,e}return s(e,t),e.prototype.buffer=function(){return this._buffer},r(e,[{key:"_nativeAsset",get:function(){return this._buffer},set:function(t){t instanceof ArrayBuffer?this._buffer=t:this._buffer=t.buffer}}]),e}(Sr)).prototype,"_nativeAsset",[fi],Object.getOwnPropertyDescriptor(ix.prototype,"_nativeAsset"),ix.prototype),ex=ix))||ex);_.BufferAsset=nx;var sx=Xi.Flags.Destroyed,ax=Xi.Flags.PersistentMask,ox=Ae.IDENTIFIER_RE,hx={"cc.ClickEvent":!1,"cc.PrefabInfo":!1},lx=Ae.escapeForJS,ux=function(){function t(t,e){this.varName=void 0,this.expression=void 0,this.varName=t,this.expression=e}return t.prototype.toString=function(){return"var "+this.varName+"="+this.expression+";"},t}();function cx(t,e){return e instanceof ux?new ux(e.varName,t+e.expression):t+e}function _x(t,e,i){Array.isArray(i)?(i[0]=cx(e,i[0]),t.push(i)):t.push(cx(e,i)+";")}var dx=function(){function t(t){this._exps=void 0,this._targetExp=void 0,this._exps=[],this._targetExp=t}var e=t.prototype;return e.append=function(t,e){this._exps.push([t,e])},e.writeCode=function(t){var e;if(this._exps.length>1)t.push("t="+this._targetExp+";"),e="t";else{if(1!==this._exps.length)return;e=this._targetExp}for(var i=0;i<this._exps.length;i++){var r=this._exps[i];_x(t,e+px(r[0])+"=",r[1])}},t}();function px(t){return ox.test(t)?"."+t:"["+lx(t)+"]"}dx.pool=void 0,dx.pool=new Ot((function(t){t._exps.length=0,t._targetExp=null}),1),dx.pool.get=function(t){var e=this._get()||new dx;return e._targetExp=t,e};var fx,mx,gx,vx,yx,Tx,Ex,Sx=function(){function t(t,e){var i;this.parent=void 0,this.objsToClear_iN$t=void 0,this.codeArray=void 0,this.objs=void 0,this.funcs=void 0,this.funcModuleCache=void 0,this.globalVariables=void 0,this.globalVariableId=void 0,this.localVariableId=void 0,this.result=void 0,this.parent=e,this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.funcModuleCache=it(),dt(this.funcModuleCache,hx),this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.codeArray.push("var o,t;","if(R){","o=R;","}else{","o=R=new "+this.getFuncModule(t.constructor,!0)+"();","}"),t._iN$t={globalVar:"R"},this.objsToClear_iN$t.push(t),this.enumerateObject(this.codeArray,t),this.globalVariables.length>0&&(i="var "+this.globalVariables.join(",")+";");var r=function(t){var e=[];return function t(e,i){for(var r,n=h(i);!(r=n()).done;){var s=r.value;Array.isArray(s)?t(e,s):e.push(s)}}(e,t),e.join("")}(["return (function(R){",i||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",r)(this.objs,this.funcs);for(var n=0,s=this.objsToClear_iN$t.length;n<s;++n)this.objsToClear_iN$t[n]._iN$t=null;this.objsToClear_iN$t.length=0}var e=t.prototype;return e.getFuncModule=function(t,e){var i=rt(t);if(i){var r=this.funcModuleCache[i];if(r)return r;if(void 0===r){var n=-1!==i.indexOf(".");if(n)try{if(n=t===Function("return "+i)())return this.funcModuleCache[i]=i,i}catch(t){}}}var s=this.funcs.indexOf(t);s<0&&(s=this.funcs.length,this.funcs.push(t));var a="F["+s+"]";return e&&(a="("+a+")"),this.funcModuleCache[i]=a,a},e.getObjRef=function(t){var e=this.objs.indexOf(t);return e<0&&(e=this.objs.length,this.objs.push(t)),"O["+e+"]"},e.setValueType=function(t,e,i,r){var n=dx.pool.get(r),s=e.constructor.__props__;s||(s=Object.keys(e));for(var a=0;a<s.length;a++){var o=s[a],h=i[o];if(e[o]!==h){var l=this.enumerateField(i,o,h);n.append(o,l)}}n.writeCode(t),dx.pool.put(n)},e.enumerateCCClass=function(t,e,i){for(var r=i.__values__,n=ie(i),s=0;s<r.length;s++){var a=r[s],o=e[a],h=n[a+"$_$default"];if(!bx(h,o))if("object"==typeof o&&o instanceof _.ValueType&&(h=Ae.getDefault(h))&&h.constructor===o.constructor){var l="o"+px(a);this.setValueType(t,h,o,l)}else this.setObjProp(t,e,a,o)}},e.instantiateArray=function(t){if(0===t.length)return"[]";var e="a"+ ++this.localVariableId,i=[new ux(e,"new Array("+t.length+")")];t._iN$t={globalVar:"",source:i},this.objsToClear_iN$t.push(t);for(var r=0;r<t.length;++r)_x(i,e+"["+r+"]=",this.enumerateField(t,r,t[r]));return i},e.instantiateTypedArray=function(t){var e=t.constructor.name;if(0===t.length)return"new "+e;var i="a"+ ++this.localVariableId,r=[new ux(i,"new "+e+"("+t.length+")")];t._iN$t={globalVar:"",source:r},this.objsToClear_iN$t.push(t);for(var n=0;n<t.length;++n)0!==t[n]&&_x(r,i+"["+n+"]=",t[n]);return r},e.enumerateField=function(t,e,i){if("object"==typeof i&&i){var r=i._iN$t;if(r){var n=r.globalVar;if(!n){n=r.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(n);var s=r.source[0];r.source[0]=cx(n+"=",s)}return n}return ArrayBuffer.isView(i)?this.instantiateTypedArray(i):Array.isArray(i)?this.instantiateArray(i):this.instantiateObj(i)}return"function"==typeof i?this.getFuncModule(i):"string"==typeof i?lx(i):("_objFlags"===e&&t instanceof Xi&&(i&=ax),i)},e.setObjProp=function(t,e,i,r){_x(t,"o"+px(i)+"=",this.enumerateField(e,i,r))},e.enumerateObject=function(t,e){var i=e.constructor;if(_.Class._isCCClass(i))this.enumerateCCClass(t,e,i);else for(var r in e)if(e.hasOwnProperty(r)&&(95!==r.charCodeAt(0)||95!==r.charCodeAt(1)||"__type__"===r)){var n=e[r];"object"==typeof n&&n&&n===e._iN$t||this.setObjProp(t,e,r,n)}},e.instantiateObj=function(t){if(t instanceof _.ValueType)return Ae.getNewValueTypeCode(t);if(t instanceof _.Asset)return this.getObjRef(t);if(t._objFlags&sx)return null;var e,i=t.constructor;if(_.Class._isCCClass(i)){if(this.parent)if(this.parent instanceof _.Component){if(t instanceof _._BaseNode||t instanceof _.Component)return this.getObjRef(t)}else if(this.parent instanceof _._BaseNode)if(t instanceof _._BaseNode){if(!t.isChildOf(this.parent))return this.getObjRef(t)}else if(t instanceof _.Component&&!t.node.isChildOf(this.parent))return this.getObjRef(t);e=new ux("o","new "+this.getFuncModule(i,!0)+"()")}else if(i===Object)e=new ux("o","{}");else{if(i)return this.getObjRef(t);e=new ux("o","Object.create(null)")}var r=[e];return t._iN$t={globalVar:"",source:r},this.objsToClear_iN$t.push(t),this.enumerateObject(r,t),["(function(){",r,"return o;})();"]},t}();function bx(t,e){if("function"==typeof t)try{t=t()}catch(t){return!1}if(t===e)return!0;if(t&&e&&"object"==typeof t&&"object"==typeof e&&t.constructor===e.constructor)if(t instanceof _.ValueType){if(t.equals(e))return!0}else{if(Array.isArray(t))return 0===t.length&&0===e.length;if(t.constructor===Object)return Z(t)&&Z(e)}return!1}var Ax,Cx,wx,Rx,xx,Ox=Pt({AUTO:0,SINGLE_INSTANCE:1,MULTI_INSTANCE:2}),Ix=t("Prefab",Ne("cc.Prefab")((Ex=Tx=function(t){function e(){var e;return l(e=t.call(this)||this,"data",gx,a(e)),l(e,"optimizationPolicy",vx,a(e)),l(e,"asyncLoadAssets",yx,a(e)),e._createFunction=void 0,e._instantiatedTimes=void 0,e._createFunction=null,e._instantiatedTimes=0,e}s(e,t);var i=e.prototype;return i.createNode=function(t){var e=_.instantiate(this);e.name=this.name,t(null,e)},i.compileCreateFunction=function(){var t,e;this._createFunction=(e=(t=this.data)instanceof _._BaseNode&&t,new Sx(t,e).result)},i._doInstantiate=function(t){return this.data._prefab?this.data._prefab._synced=!0:I(3700),this._createFunction||this.compileCreateFunction(),this._createFunction(t)},i._instantiate=function(){var t;return this.optimizationPolicy!==Ox.SINGLE_INSTANCE&&(this.optimizationPolicy===Ox.MULTI_INSTANCE||this._instantiatedTimes+1>=e.OptimizationPolicyThreshold)?(t=this._doInstantiate(),this.data._instantiate(t)):(this.data._prefab._synced=!0,t=this.data._instantiate()),++this._instantiatedTimes,t},e}(Sr),Tx.OptimizationPolicy=Ox,Tx.OptimizationPolicyThreshold=3,gx=u((mx=Ex).prototype,"data",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vx=u(mx.prototype,"optimizationPolicy",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ox.AUTO}}),yx=u(mx.prototype,"asyncLoadAssets",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),fx=mx))||fx);_.Prefab=Ix,nt(_,"cc._Prefab","Prefab");var Mx,Bx,Px,Nx,Lx=t("SceneAsset",Ne("cc.SceneAsset")((xx=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"scene",wx,a(e)),l(e,"asyncLoadAssets",Rx,a(e)),e}return s(e,t),e}(Sr),wx=u((Cx=xx).prototype,"scene",[Ke,ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Rx=u(Cx.prototype,"asyncLoadAssets",[Ke,ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ax=Cx))||Ax);_.SceneAsset=Lx;var Fx,Dx,Ux,kx,zx=t("SpriteAtlas",Ne("cc.SpriteAtlas")((Nx=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"spriteFrames",Px,a(e)),e}s(e,t);var i=e.prototype;return i.getTexture=function(){var t=Object.keys(this.spriteFrames);if(t.length>0){var e=this.spriteFrames[t[0]];return e&&e.texture}return null},i.getSpriteFrame=function(t){var e=this.spriteFrames[t];return e?(e.name||(e.name=t),e):null},i.getSpriteFrames=function(){for(var t=[],e=this.spriteFrames,i=0,r=Object.keys(e);i<r.length;i++){var n=r[i];t.push(e[n])}return t},i._serialize=function(){},i._deserialize=function(t,e){var i=t;this._name=i.name;var r=i.spriteFrames;this.spriteFrames=it();for(var n=0;n<r.length;n+=2)e.result.push(this.spriteFrames,r[n],r[n+1])},e}(Sr),Px=u((Bx=Nx).prototype,"spriteFrames",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return it()}}),Mx=Bx))||Mx);_.SpriteAtlas=zx;var Gx,Hx,Vx,Wx,jx=t("TextAsset",Ne("cc.TextAsset")((kx=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"text",Ux,a(e)),e}return s(e,t),e.prototype.toString=function(){return this.text},e}(Sr),Ux=u((Dx=kx).prototype,"text",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Fx=Dx))||Fx);_.TextAsset=jx;var Xx,Yx=t("JsonAsset",Ne("cc.JsonAsset")((Wx=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"json",Vx,a(e)),e}return s(e,t),e}(Sr),Vx=u((Hx=Wx).prototype,"json",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Gx=Hx))||Gx);_.JsonAsset=Yx;var qx,Kx,Zx,Qx,Jx=t("Font",Ne("cc.Font")(Xx=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e}(Sr))||Xx);_.Font=Jx;var $x,tO,eO,iO,rO,nO,sO,aO,oO,hO=t("TTFFont",Ne("cc.TTFFont")((Qx=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"_fontFamily",Zx,a(e)),e}return s(e,t),r(e,[{key:"_nativeAsset",get:function(){return this._fontFamily},set:function(t){this._fontFamily=t||"Arial"}},{key:"_nativeDep",get:function(){return{uuid:this._uuid,__nativeName__:this._native,ext:dr(this._native),__isNative__:!0}}}]),e}(Jx),Zx=u((Kx=Qx).prototype,"_fontFamily",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u(Kx.prototype,"_nativeAsset",[fi,di],Object.getOwnPropertyDescriptor(Kx.prototype,"_nativeAsset"),Kx.prototype),u(Kx.prototype,"_nativeDep",[fi],Object.getOwnPropertyDescriptor(Kx.prototype,"_nativeDep"),Kx.prototype),qx=Kx))||qx);_.TTFFont=hO;var lO,uO=function(){this.u=0,this.v=0,this.w=0,this.h=0,this.offsetX=0,this.offsetY=0,this.textureID=0,this.valid=!1,this.xAdvance=0},cO=function(){function t(t){this.letterDefinitions={},this.texture=t}var e=t.prototype;return e.addLetterDefinitions=function(t,e){this.letterDefinitions[t]=e},e.cloneLetterDefinition=function(){for(var t={},e=0,i=Object.keys(this.letterDefinitions);e<i.length;e++){var r=i[e],n=new uO;dt(n,this.letterDefinitions[r]),t[r]=n}return t},e.getTexture=function(){return this.texture},e.getLetter=function(t){return this.letterDefinitions[t]},e.getLetterDefinitionForChar=function(t){var e=t.charCodeAt(0);return this.letterDefinitions.hasOwnProperty(e)?this.letterDefinitions[e]:null},e.clear=function(){this.letterDefinitions={}},t}(),_O=t("BitmapFont",($x=Ne("cc.BitmapFont"),tO=pi(um),$x((oO=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"fntDataStr",rO,a(e)),l(e,"spriteFrame",nO,a(e)),l(e,"fontSize",sO,a(e)),l(e,"fntConfig",aO,a(e)),e}return s(e,t),e.prototype.onLoaded=function(){var t=this.spriteFrame;!this.fontDefDictionary&&t&&(this.fontDefDictionary=new cO(t.texture));var e=this.fntConfig;if(e){var i=e.fontDefDictionary;for(var r in i){var n=new uO,s=i[r].rect;n.offsetX=i[r].xOffset,n.offsetY=i[r].yOffset,n.w=s.width,n.h=s.height,n.u=s.x,n.v=s.y,n.textureID=0,n.valid=!0,n.xAdvance=i[r].xAdvance,this.fontDefDictionary.addLetterDefinitions(r,n)}}else E("The fnt config is not exists!")},e}(Jx),rO=u((iO=oO).prototype,"fntDataStr",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),nO=u(iO.prototype,"spriteFrame",[tO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sO=u(iO.prototype,"fontSize",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),aO=u(iO.prototype,"fntConfig",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),eO=iO))||eO));_.BitmapFont=_O;var dO,pO,fO,mO,gO,vO,yO,TO,EO,SO=t("LabelAtlas",Ne("cc.LabelAtlas")(lO=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e}(_O))||lO);_.LabelAtlas=SO;var bO=t("Skeleton",(dO=Ne("cc.Skeleton"),pO=pi([he]),fO=pi([Hs]),dO((EO=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"_joints",vO,a(e)),l(e,"_bindposes",yO,a(e)),l(e,"_hash",TO,a(e)),e._invBindposes=null,e}return s(e,t),e.prototype.destroy=function(){return _.director.root.dataPoolManager.releaseSkeleton(this),t.prototype.destroy.call(this)},r(e,[{key:"joints",get:function(){return this._joints},set:function(t){this._joints=t}},{key:"bindposes",get:function(){return this._bindposes},set:function(t){this._bindposes=t}},{key:"inverseBindposes",get:function(){if(!this._invBindposes){this._invBindposes=[];for(var t=0;t<this._bindposes.length;t++){var e=new Hs;Hs.invert(e,this._bindposes[t]),this._invBindposes.push(e)}}return this._invBindposes}},{key:"hash",get:function(){if(!this._hash){for(var t="",e=0;e<this._bindposes.length;e++){var i=this._bindposes[e];t+=i.m00.toPrecision(2)+" "+i.m01.toPrecision(2)+" "+i.m02.toPrecision(2)+" "+i.m03.toPrecision(2)+" "+i.m04.toPrecision(2)+" "+i.m05.toPrecision(2)+" "+i.m06.toPrecision(2)+" "+i.m07.toPrecision(2)+" "+i.m08.toPrecision(2)+" "+i.m09.toPrecision(2)+" "+i.m10.toPrecision(2)+" "+i.m11.toPrecision(2)+" "+i.m12.toPrecision(2)+" "+i.m13.toPrecision(2)+" "+i.m14.toPrecision(2)+" "+i.m15.toPrecision(2)+"\n"}this._hash=ou(t,666)}return this._hash}}]),e}(Sr),vO=u((gO=EO).prototype,"_joints",[pO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yO=u(gO.prototype,"_bindposes",[fO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),TO=u(gO.prototype,"_hash",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),mO=gO))||mO));_.Skeleton=bO,$s(Bf.prototype,"Mesh.prototype",[{name:"renderingMesh",newName:"renderingSubMeshes"}]),ta(Bf.prototype,"Mesh.prototype",[{name:"hasFlatBuffers"},{name:"destroyFlatBuffers"}]),ta(np.prototype,"TextureBase.prototype",[{name:"hasPremultipliedAlpha"},{name:"setPremultiplyAlpha"},{name:"setFlipY"}]),$s(fg.prototype,"RenderTexture.prototype",[{name:"getGFXWindow",customFunction:function(){return this._window}}]);var AO=new Es,CO=t("Touch",function(){function t(t,e,i){void 0===i&&(i=0),this._point=new Es,this._prevPoint=new Es,this._lastModified=0,this._id=0,this._startPoint=new Es,this._startPointCaptured=!1,this.setTouchInfo(i,t,e)}r(t,[{key:"lastModified",get:function(){return this._lastModified}}]);var e=t.prototype;return e.getLocation=function(t){return t||(t=new Es),t.set(this._point.x,this._point.y),t},e.getLocationX=function(){return this._point.x},e.getLocationY=function(){return this._point.y},e.getUILocation=function(t){return t||(t=new Es),t.set(this._point.x,this._point.y),_.view._convertPointWithScale(t),t},e.getUILocationX=function(){var t=_.view.getViewportRect();return(this._point.x-t.x)/_.view.getScaleX()},e.getUILocationY=function(){var t=_.view.getViewportRect();return(this._point.y-t.y)/_.view.getScaleY()},e.getPreviousLocation=function(t){return t||(t=new Es),t.set(this._prevPoint.x,this._prevPoint.y),t},e.getUIPreviousLocation=function(t){return t||(t=new Es),t.set(this._prevPoint.x,this._prevPoint.y),_.view._convertPointWithScale(t),t},e.getStartLocation=function(t){return t||(t=new Es),t.set(this._startPoint.x,this._startPoint.y),t},e.getUIStartLocation=function(t){return t||(t=new Es),t.set(this._startPoint.x,this._startPoint.y),_.view._convertPointWithScale(t),t},e.getDelta=function(t){return t||(t=new Es),t.set(this._point),t.subtract(this._prevPoint),t},e.getUIDelta=function(t){return t||(t=new Es),AO.set(this._point),AO.subtract(this._prevPoint),t.set(_.view.getScaleX(),_.view.getScaleY()),Es.divide(t,AO,t),t},e.getLocationInView=function(t){return t||(t=new Es),t.set(this._point.x,_.view._designResolutionSize.height-this._point.y),t},e.getPreviousLocationInView=function(t){return t||(t=new Es),t.set(this._prevPoint.x,_.view._designResolutionSize.height-this._prevPoint.y),t},e.getStartLocationInView=function(t){return t||(t=new Es),t.set(this._startPoint.x,_.view._designResolutionSize.height-this._startPoint.y),t},e.getID=function(){return this._id},e.setTouchInfo=function(t,e,i){void 0===t&&(t=0),this._prevPoint=this._point,this._point=new Es(e||0,i||0),this._id=t,this._startPointCaptured||(this._startPoint=new Es(this._point),this._startPointCaptured=!0)},e.setPoint=function(t,e){"object"==typeof t?(this._point.x=t.x,this._point.y=t.y):(this._point.x=t||0,this._point.y=e||0),this._lastModified=_.director.getCurrentTime()},e.setPrevPoint=function(t,e){this._prevPoint="object"==typeof t?new Es(t.x,t.y):new Es(t||0,e||0),this._lastModified=_.director.getCurrentTime()},t}());_.Touch=CO;var wO,RO=Ut.TOUCH_TIMEOUT,xO=new Es,OO=new Es,IO=t("Acceleration",(function(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.x=void 0,this.y=void 0,this.z=void 0,this.timestamp=void 0,this.x=t,this.y=e,this.z=i,this.timestamp=r}));_.internal.Acceleration=IO;var MO=new(function(){function t(){this._mousePressed=!1,this._isRegisterEvent=!1,this._preTouchPoint=new Es,this._prevMousePoint=new Es,this._preTouchPool=[],this._preTouchPoolPointer=0,this._touches=[],this._touchesIntegerDict={},this._indexBitsUsed=0,this._maxTouches=8,this._accelEnabled=!1,this._accelInterval=.2,this._accelMinus=1,this._accelCurTime=0,this._acceleration=null,this._accelDeviceEvent=null,this._glView=null,this._pointLocked=!1}var e=t.prototype;return e.handleTouchesBegin=function(t){for(var e=[],i=this._touchesIntegerDict,r=0;r<t.length;++r){var n=t[r],s=n.getID();if(null!==s&&void 0===i[s]){var a=this._getUnUsedIndex();if(-1===a){x(2300,a);continue}n.getLocation(xO);var o=new CO(xO.x,xO.y,s);this._touches[a]=o,n.getPreviousLocation(xO),o.setPrevPoint(xO),i[s]=a,e.push(o)}}if(e.length>0){var h=new Yg(e,!1,Yg.BEGAN,Ut.ENABLE_MULTI_TOUCH?this._getUsefulTouches():e);av.dispatchEvent(h)}},e.handleTouchesMove=function(t){for(var e=[],i=this._touches,r=0;r<t.length;++r){var n=t[r],s=n.getID();if(null!==s){var a=this._touchesIntegerDict[s];void 0!==a&&i[a]&&(n.getLocation(xO),i[a].setPoint(xO),n.getPreviousLocation(xO),i[a].setPrevPoint(xO),e.push(i[a]))}}if(e.length>0){var o=new Yg(e,!1,Yg.MOVED,Ut.ENABLE_MULTI_TOUCH?this._getUsefulTouches():e);av.dispatchEvent(o)}},e.handleTouchesEnd=function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(e.length>0){var i=new Yg(e,!1,Yg.ENDED,Ut.ENABLE_MULTI_TOUCH?this._getUsefulTouches():e);av.dispatchEvent(i)}this._preTouchPool.length=0},e.handleTouchesCancel=function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(e.length>0){var i=new Yg(e,!1,Yg.CANCELLED,Ut.ENABLE_MULTI_TOUCH?this._getUsefulTouches():e);av.dispatchEvent(i)}this._preTouchPool.length=0},e.getSetOfTouchesEndOrCancel=function(t){for(var e=[],i=this._touches,r=this._touchesIntegerDict,n=0;n<t.length;++n){var s=t[n],a=s.getID();if(null!==a){var o=r[a];void 0!==o&&i[o]&&(s.getLocation(xO),i[o].setPoint(xO),s.getPreviousLocation(xO),i[o].setPrevPoint(xO),e.push(i[o]),this._removeUsedIndexBit(o),delete r[a])}}return e},e.getHTMLElementPosition=function(t){var e=document.documentElement,i=Jr.os===Jr.OS_IOS&&Jr.isBrowser?window.screenLeft:window.pageXOffset;i-=e.clientLeft;var r=Jr.os===Jr.OS_IOS&&Jr.isBrowser?window.screenTop:window.pageYOffset;if(r-=e.clientTop,t.getBoundingClientRect){var n=t.getBoundingClientRect();return{left:n.left+i,top:n.top+r,width:n.width,height:n.height}}return t instanceof HTMLCanvasElement?{left:i,top:r,width:t.width,height:t.height}:{left:i,top:r,width:parseInt(t.style.width||"0",void 0),height:parseInt(t.style.height||"0",void 0)}},e.getPreTouch=function(t){for(var e=null,i=this._preTouchPool,r=t.getID(),n=i.length-1;n>=0;n--)if(i[n].getID()===r){e=i[n];break}return e||(e=t),e},e.setPreTouch=function(t){for(var e=!1,i=this._preTouchPool,r=t.getID(),n=i.length-1;n>=0;n--)if(i[n].getID()===r){i[n]=t,e=!0;break}e||(i.length<=50?i.push(t):(i[this._preTouchPoolPointer]=t,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},e.getTouchByXY=function(t,e,i,r){var n=this._preTouchPoint,s=this._glView.convertToLocationInView(e,i,r);this._pointLocked&&(s.x=n.x+t.movementX,s.y=n.y-t.movementY);var a=new CO(s.x,s.y,0);return a.setPrevPoint(n.x,n.y),n.x=s.x,n.y=s.y,a},e.getMouseEvent=function(t,e,i){var r=this._prevMousePoint,n=new Xg(i,!1,r);return r.x=t.x,r.y=t.y,this._glView._convertMouseToLocation(r,e),n.setLocation(r.x,r.y),n},e.getPointByEvent=function(t,e){return null!=t.pageX?{x:t.pageX,y:t.pageY}:(e.left-=document.body.scrollLeft,e.top-=document.body.scrollTop,{x:t.clientX,y:t.clientY})},e.getTouchesByEvent=function(t,e){for(var i=[],r=this._glView,n=this._preTouchPoint,s=t.changedTouches.length,a=0;a<s;a++){var o=t.changedTouches[a];if(o){var h;h=Jr.BROWSER_TYPE_FIREFOX===Jr.browserType?r.convertToLocationInView(o.pageX,o.pageY,e,xO):r.convertToLocationInView(o.clientX,o.clientY,e,xO);var l=void 0;if(null!=o.identifier?(l=new CO(h.x,h.y,o.identifier),this.getPreTouch(l).getLocation(OO),l.setPrevPoint(OO.x,OO.y),this.setPreTouch(l)):(l=new CO(h.x,h.y)).setPrevPoint(n.x,n.y),n.x=h.x,n.y=h.y,i.push(l),!Ut.ENABLE_MULTI_TOUCH)break}}return i},e.registerSystemEvent=function(t){if(!this._isRegisterEvent&&t){this._glView=_.view;var e=Jr.isMobile,i="mouse"in Jr.capabilities,r="touches"in Jr.capabilities;i&&this._registerMouseEvents(t,e),window.navigator.msPointerEnabled&&this._registerMousePointerEvents(t),r&&this._registerTouchEvents(t),this._registerKeyboardEvent(),this._isRegisterEvent=!0}},e.setAccelerometerEnabled=function(t){if(this._accelEnabled!==t){this._accelEnabled=t;var e=_.director.getScheduler();e.enableForTarget(this),this._accelEnabled?(this._registerAccelerometerEvent(),this._accelCurTime=0,e.scheduleUpdate(this)):(this._unregisterAccelerometerEvent(),this._accelCurTime=0,e.unscheduleUpdate(this))}},e.didAccelerate=function(t){if(this._accelEnabled){var e=this._acceleration,i=0,r=0,n=0;if(this._accelDeviceEvent===window.DeviceMotionEvent){var s=t.accelerationIncludingGravity;s&&(i=this._accelMinus*(s.x||0)*.1,r=this._accelMinus*(s.y||0)*.1,n=.1*(s.z||0))}else{var a=t;i=(a.gamma||0)/90*.981,r=-(a.beta||0)/90*.981,n=(a.alpha||0)/90*.981}if(_.view._isRotated){var o=i;i=-r,r=o}e.x=i,e.y=r,e.z=n,e.timestamp=t.timeStamp||Date.now();var h=e.x;90===window.orientation?(e.x=-e.y,e.y=h):-90===window.orientation?(e.x=e.y,e.y=-h):180===window.orientation&&(e.x=-e.x,e.y=-e.y),_.sys.os===_.sys.OS_ANDROID&&_.sys.browserType!==_.sys.BROWSER_TYPE_MOBILE_QQ&&(e.x=-e.x,e.y=-e.y)}},e.update=function(t){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,av.dispatchEvent(new qg(this._acceleration))),this._accelCurTime+=t},e.setAccelerometerInterval=function(t){this._accelInterval!==t&&(this._accelInterval=t)},e._getUnUsedIndex=function(){for(var t=this._indexBitsUsed,e=_.director.getCurrentTime(),i=0;i<this._maxTouches;i++){if(!(1&t))return this._indexBitsUsed|=1<<i,i;var r=this._touches[i];if(e-r.lastModified>RO){this._removeUsedIndexBit(i);var n=r.getID();return null!==n&&delete this._touchesIntegerDict[n],i}t>>=1}return-1},e._removeUsedIndexBit=function(t){if(!(t<0||t>=this._maxTouches)){var e=1<<t;e=~e,this._indexBitsUsed&=e}},e._registerMouseEvents=function(t,e){this._registerPointerLockEvent(),e||this._registerWindowMouseEvents(t),this._registerElementMouseEvents(t,e)},e._registerPointerLockEvent=function(){var t=this,e=function(){var e=_.game.canvas;document.pointerLockElement===e||document.mozPointerLockElement===e?t._pointLocked=!0:t._pointLocked=!1};"onpointerlockchange"in document?document.addEventListener("pointerlockchange",e,!1):"onmozpointerlockchange"in document&&document.addEventListener("mozpointerlockchange",e,!1)},e._registerWindowMouseEvents=function(t){var e=this;window.addEventListener("mousedown",(function(){e._mousePressed=!0}),!1),window.addEventListener("mouseup",(function(i){if(e._mousePressed){e._mousePressed=!1;var r=e.getHTMLElementPosition(t),n=e.getPointByEvent(i,r);if(!Zs(r.left,r.top,r.width,r.height).contains(new Es(n.x,n.y))){e.handleTouchesEnd([e.getTouchByXY(i,n.x,n.y,r)]);var s=e.getMouseEvent(n,r,Xg.UP);s.setButton(i.button),av.dispatchEvent(s)}}}),!1)},e._registerElementMouseEvents=function(t,e){var i=this,r=function(e,r,n){t.addEventListener(e,(function(e){var s=i.getHTMLElementPosition(t),a=i.getPointByEvent(e,s),o=i.getMouseEvent(a,s,r);o.setButton(e.button),n(e,o,a,s),av.dispatchEvent(o),e.stopPropagation(),e.preventDefault()}))};e||(r("mousedown",Xg.DOWN,(function(e,r,n,s){i._mousePressed=!0,i.handleTouchesBegin([i.getTouchByXY(e,n.x,n.y,s)]),t.focus()})),r("mouseup",Xg.UP,(function(t,e,r,n){i._mousePressed=!1,i.handleTouchesEnd([i.getTouchByXY(t,r.x,r.y,n)])})),r("mousemove",Xg.MOVE,(function(t,e,r,n){i.handleTouchesMove([i.getTouchByXY(t,r.x,r.y,n)]),i._mousePressed||e.setButton(Xg.BUTTON_MISSING),void 0!==t.movementX&&void 0!==t.movementY&&(e.movementX=t.movementX,e.movementY=t.movementY)}))),r("mousewheel",Xg.SCROLL,(function(t,e){e.setScrollData(0,t.wheelDelta)})),r("DOMMouseScroll",Xg.SCROLL,(function(t,e){e.setScrollData(0,-120*t.detail)}))},e._registerMousePointerEvents=function(t){var e=this,i={MSPointerDown:this.handleTouchesBegin,MSPointerMove:this.handleTouchesMove,MSPointerUp:this.handleTouchesEnd,MSPointerCancel:this.handleTouchesCancel},r=function(r){var n=i[r];t.addEventListener(r,(function(i){var r=e.getHTMLElementPosition(t);r.left-=document.documentElement.scrollLeft,r.top-=document.documentElement.scrollTop,n.call(e,[e.getTouchByXY(i,i.clientX,i.clientY,r)]),i.stopPropagation()}),!1)};for(var n in i)r(n)},e._registerTouchEvents=function(t){var e=this,i=function(i){return function(r){if(r.changedTouches){var n=e.getHTMLElementPosition(t),s=document.body;n.left-=s.scrollLeft||0,n.top-=s.scrollTop||0,i(e.getTouchesByEvent(r,n)),r.stopPropagation(),r.preventDefault()}}};t.addEventListener("touchstart",i((function(i){e.handleTouchesBegin(i),t.focus()})),!1),t.addEventListener("touchmove",i((function(t){e.handleTouchesMove(t)})),!1),t.addEventListener("touchend",i((function(t){e.handleTouchesEnd(t)})),!1),t.addEventListener("touchcancel",i((function(t){e.handleTouchesCancel(t)})),!1)},e._registerKeyboardEvent=function(){var t=_.game.canvas;t.addEventListener("keydown",(function(t){av.dispatchEvent(new Kg(t,!0)),t.stopPropagation(),t.preventDefault()}),!1),t.addEventListener("keyup",(function(t){av.dispatchEvent(new Kg(t,!1)),t.stopPropagation(),t.preventDefault()}),!1)},e._registerAccelerometerEvent=function(){var t=this;this._acceleration=new IO,this._accelDeviceEvent=window.DeviceMotionEvent||window.DeviceOrientationEvent,_.sys.browserType===_.sys.BROWSER_TYPE_MOBILE_QQ&&(this._accelDeviceEvent=window.DeviceOrientationEvent);var e=this._accelDeviceEvent===window.DeviceMotionEvent?"devicemotion":"deviceorientation";wO=function(){return t.didAccelerate.apply(t,arguments)},window.addEventListener(e,wO,!1)},e._unregisterAccelerometerEvent=function(){var t=this._accelDeviceEvent===window.DeviceMotionEvent?"devicemotion":"deviceorientation";wO&&window.removeEventListener(t,wO,!1)},e._getUsefulTouches=function(){var t=[],e=this._touchesIntegerDict;for(var i in e){var r=e[parseInt(i)];if(null!=r){var n=this._touches[r];t.push(n)}}return t},t}());_.internal.inputManager=MO;var BO=t("Game",function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).frame=null,e.container=null,e.canvas=null,e.renderType=-1,e.eventTargetOn=t.prototype.on,e.eventTargetOnce=t.prototype.once,e.config={},e.onStart=null,e._persistRootNodes={},e._paused=!0,e._configLoaded=!1,e._isCloning=!1,e._inited=!1,e._rendererInitialized=!1,e._gfxDevice=null,e._intervalId=null,e.collisionMatrix=[],e.groupList=[],e}s(e,t);var i=e.prototype;return i.setFrameRate=function(t){var e=this.config;"number"!=typeof t&&(t=parseInt(t),isNaN(t)&&(t=60)),e.frameRate=t,this._paused=!0,this._setAnimFrame(),this._runMainLoop()},i.getFrameRate=function(){return this.config.frameRate||0},i.step=function(){_.director.mainLoop()},i.pause=function(){this._paused||(this._paused=!0,this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0))},i.resume=function(){this._paused&&(this._paused=!1,this._runMainLoop())},i.isPaused=function(){return this._paused},i.restart=function(){var t=this;return new Promise((function(t){return _.director.once(_.Director.EVENT_AFTER_DRAW,(function(){return t()}))})).then((function(){for(var i in t._persistRootNodes)t.removePersistRootNode(t._persistRootNodes[i]);return _.director.getScene().destroy(),_.Object._deferredDestroy(),_.director.reset(),t.pause(),t._setRenderPipelineNShowSplash().then((function(){t.resume(),t._safeEmit(e.EVENT_RESTART)}))}))},i.end=function(){this._gfxDevice&&(this._gfxDevice.destroy(),this._gfxDevice=null),close()},i.on=function(t,i,r,n){this._inited&&t===e.EVENT_ENGINE_INITED?i.call(r):this.eventTargetOn(t,i,r,n)},i.once=function(t,i,r){this._inited&&t===e.EVENT_ENGINE_INITED?i.call(r):this.eventTargetOnce(t,i,r)},i.init=function(t){var e=this;return this._initConfig(t),this.config.assetOptions&&_.assetManager.init(this.config.assetOptions),this._initEngine().then((function(){return e._initEvents(),_.director.root.dataPoolManager.jointTexturePool.registerCustomTextureLayouts(t.customJointTextureLayouts),e._inited}))},i.run=function(t,e){var i,r=this;return this._initEvents(),"function"!=typeof t&&t?(i=this.init(t),this.onStart=null!=e?e:null):this.onStart=null!=t?t:null,Promise.resolve(i).then((function(){return r._setAnimFrame(),r._runMainLoop(),PO.config.registerSystemEvent&&MO.registerSystemEvent(PO.canvas),r._setRenderPipelineNShowSplash()}))},i.addPersistRootNode=function(t){if(_.Node.isNode(t)&&t.uuid){var e=t.uuid;if(!this._persistRootNodes[e]){var i=_.director._scene;if(_.isValid(i))if(t.parent){if(!(t.parent instanceof _.Scene))return void I(3801);if(t.parent!==i)return void I(3802)}else t.parent=i;this._persistRootNodes[e]=t,t._persistNode=!0,_.assetManager._releaseManager._addPersistNodeRef(t)}}else I(3800)},i.removePersistRootNode=function(t){var e=t.uuid||"";t===this._persistRootNodes[e]&&(delete this._persistRootNodes[e],t._persistNode=!1,_.assetManager._releaseManager._removePersistNodeRef(t))},i.isPersistRootNode=function(t){return t._persistNode},i._initEngine=function(){var t=this;return this._initDevice(),Promise.resolve(_.director._init()).then((function(){T("Cocos Creator v3.0.0"),t.emit(e.EVENT_ENGINE_INITED),t._inited=!0}))},i._setAnimFrame=function(){this._lastTime=performance.now();var t=this.config.frameRate;this._frameTime=1e3/t,this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0);var e=window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;60!==t&&30!==t?(window.rAF=e?this._stTimeWithRAF:this._stTime,window.cAF=this._ctTime):(window.rAF=e||this._stTime,window.cAF=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.ocancelAnimationFrame||this._ctTime)},i._stTimeWithRAF=function(t){var e=performance.now(),i=Math.max(0,e-PO._lastTime),r=Math.max(0,PO._frameTime-i),n=window.setTimeout((function(){window.requestAnimationFrame(t)}),r);return PO._lastTime=e+r,n},i._stTime=function(t){var e=performance.now(),i=Math.max(0,e-PO._lastTime),r=Math.max(0,PO._frameTime-i),n=window.setTimeout(t,r);return PO._lastTime=e+r,n},i._ctTime=function(t){window.clearTimeout(t)},i._runMainLoop=function(){var t=this,e=this.config,i=_.director,r=!0,n=e.frameRate;U(!!e.showFPS),i.startAnimation(),this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0),this._intervalId=window.rAF((function e(s){t._paused||(t._intervalId=window.rAF(e),30===n&&(r=!r)||i.mainLoop(s))})),this._paused=!1},i._initConfig=function(t){"number"!=typeof t.debugMode&&(t.debugMode=P.NONE),t.exposeClassName=!!t.exposeClassName,"number"!=typeof t.frameRate&&(t.frameRate=60);var e=t.renderMode;("number"!=typeof e||e>2||e<0)&&(t.renderMode=0),"boolean"!=typeof t.registerSystemEvent&&(t.registerSystemEvent=!0),t.showFPS=!!t.showFPS,this.collisionMatrix=t.collisionMatrix||[],this.groupList=t.groupList||[],A(t.debugMode),this.config=t,this._configLoaded=!0},i._determineRenderType=function(){var t=this.config,i=parseInt(t.renderMode);this.renderType=e.RENDER_TYPE_CANVAS;var r=!1;if(0===i?_.sys.capabilities.opengl?(this.renderType=e.RENDER_TYPE_WEBGL,r=!0):_.sys.capabilities.canvas&&(this.renderType=e.RENDER_TYPE_CANVAS,r=!0):1===i&&_.sys.capabilities.canvas?(this.renderType=e.RENDER_TYPE_CANVAS,r=!0):2===i&&_.sys.capabilities.opengl&&(this.renderType=e.RENDER_TYPE_WEBGL,r=!0),!r)throw new Error(F(3820,i))},i._initDevice=function(){if(!this._rendererInitialized){if(this.canvas=this.config.adapter.canvas,this.frame=this.config.adapter.frame,this.container=this.config.adapter.container,this._determineRenderType(),this.renderType===e.RENDER_TYPE_WEBGL){var t=[],i=!!window.WebGL2RenderingContext,r=window.navigator.userAgent.toLowerCase();(-1!==r.indexOf("safari")&&-1===r.indexOf("chrome")||Jr.browserType===Jr.BROWSER_TYPE_UC)&&(i=!1),i&&_.WebGL2Device&&t.push(_.WebGL2Device),_.WebGLDevice&&t.push(_.WebGLDevice);for(var n=new eu(this.canvas,Ut.ENABLE_WEBGL_ANTIALIAS,!1,window.devicePixelRatio,Jr.windowPixelResolution.width,Jr.windowPixelResolution.height,xp),s=0;s<t.length&&(this._gfxDevice=new t[s],!this._gfxDevice.initialize(n));s++);}if(!this._gfxDevice)return S("can not support canvas rendering in 3D"),void(this.renderType=e.RENDER_TYPE_CANVAS);this.canvas.oncontextmenu=function(){if(!_._isContextMenuEnable)return!1}}},i._initEvents=function(){var t,i=this,r=window;this._setAnimFrame(),void 0!==document.hidden?t="hidden":void 0!==document.mozHidden?t="mozHidden":void 0!==document.msHidden?t="msHidden":void 0!==document.webkitHidden&&(t="webkitHidden");var n=!1,s=this;function a(){n||(n=!0,s.emit(e.EVENT_HIDE))}function o(t,i,r,a,o){n&&(n=!1,s.emit(e.EVENT_SHOW,t,i,r,a,o))}if(t)for(var h=["visibilitychange","mozvisibilitychange","msvisibilitychange","webkitvisibilitychange","qbrowserVisibilityChange"],l=0;l<h.length;l++)document.addEventListener(h[l],(function(e){var i=document[t];(i=i||e.hidden)?a():o()}));else r.addEventListener("blur",a),r.addEventListener("focus",o);window.navigator.userAgent.indexOf("MicroMessenger")>-1&&(r.onfocus=o),"onpageshow"in window&&"onpagehide"in window&&(r.addEventListener("pagehide",a),r.addEventListener("pageshow",o),document.addEventListener("pagehide",a),document.addEventListener("pageshow",o)),this.on(e.EVENT_HIDE,(function(){i.pause()})),this.on(e.EVENT_SHOW,(function(){i.resume()}))},i._setRenderPipelineNShowSplash=function(){var t=this;return Promise.resolve(this._setupRenderPipeline()).then((function(){return t._safeEmit(e.EVENT_GAME_INITED),Promise.resolve(t._showSplashScreen()).then((function(){t.onStart&&t.onStart()}))}))},i._setupRenderPipeline=function(){var t=this,e=this.config.renderPipeline;if(e)return new Promise((function(t,i){_.assetManager.loadAny(e,(function(e,r){return!e&&r instanceof XE?t(r):i(e)}))})).then((function(e){t._setRenderPipeline(e)})).catch((function(i){E(i),E("Failed load render pipeline: "+e+", engine failed to initialize, will fallback to default pipeline"),t._setRenderPipeline()}));this._setRenderPipeline()},i._showSplashScreen=function(){if(_.internal.SplashScreen){var t=_.internal.SplashScreen.instance;return t.main(_.director.root),new Promise((function(e){t.setOnFinish((function(){return e()})),t.loadFinish=!0}))}},i._setRenderPipeline=function(t){_.director.root.setRenderPipeline(t)||this._setRenderPipeline(),this._rendererInitialized=!0,this._safeEmit(e.EVENT_RENDERER_INITED)},i._safeEmit=function(t){this.emit(t)},r(e,[{key:"inited",get:function(){return this._inited}},{key:"frameTime",get:function(){return this._frameTime}}]),e}(rr));BO.EVENT_HIDE="game_on_hide",BO.EVENT_SHOW="game_on_show",BO.EVENT_LOW_MEMORY="game_on_low_memory",BO.EVENT_GAME_INITED="game_inited",BO.EVENT_ENGINE_INITED="engine_inited",BO.EVENT_RENDERER_INITED="renderer_inited",BO.EVENT_RESTART="game_on_restart",BO.RENDER_TYPE_CANVAS=0,BO.RENDER_TYPE_WEBGL=1,BO.RENDER_TYPE_OPENGL=2,_.Game=BO;var PO=t("game",_.game=new BO),NO={topLeft:_.v2(0,0),topRight:_.v2(0,0),top:_.v2(0,0),bottomLeft:_.v2(0,0),bottomRight:_.v2(0,0),bottom:_.v2(0,0),center:_.v2(0,0),left:_.v2(0,0),right:_.v2(0,0),width:0,height:0,init:function(t){var e=this.width=t.width,i=this.height=t.height,r=t.x,n=t.y,s=n+i,a=r+e;this.topLeft.x=r,this.topLeft.y=s,this.topRight.x=a,this.topRight.y=s,this.top.x=r+e/2,this.top.y=s,this.bottomLeft.x=r,this.bottomLeft.y=n,this.bottomRight.x=a,this.bottomRight.y=n,this.bottom.x=r+e/2,this.bottom.y=n,this.center.x=r+e/2,this.center.y=n+i/2,this.left.x=r,this.left.y=n+i/2,this.right.x=a,this.right.y=n+i/2}};_.visibleRect=NO;var LO=new(function(){function t(){this.html=void 0,this.meta={width:"device-width"},this.adaptationType=_.sys.browserType}var e=t.prototype;return e.init=function(){this.html=document.getElementsByTagName("html")[0]},e.availWidth=function(t){return _.sys.isMobile||!t||t===this.html?window.innerWidth:t.clientWidth},e.availHeight=function(t){return _.sys.isMobile||!t||t===this.html?window.innerHeight:t.clientHeight},t}());switch(_.sys.os===_.sys.OS_IOS&&(LO.adaptationType=_.sys.BROWSER_TYPE_SAFARI),LO.adaptationType){case _.sys.BROWSER_TYPE_SAFARI:LO.meta["minimal-ui"]="true";case _.sys.BROWSER_TYPE_SOUGOU:case _.sys.BROWSER_TYPE_UC:LO.availWidth=function(t){return t.clientWidth},LO.availHeight=function(t){return t.clientHeight}}var FO=t("View",function(t){function e(){var e;(e=t.call(this)||this)._resizeWithBrowserSize=void 0,e._designResolutionSize=void 0,e._originalDesignResolutionSize=void 0,e._frameSize=void 0,e._scaleX=void 0,e._scaleY=void 0,e._viewportRect=void 0,e._visibleRect=void 0,e._autoFullScreen=void 0,e._devicePixelRatio=void 0,e._maxPixelRatio=void 0,e._retinaEnabled=void 0,e._resizeCallback=void 0,e._resizing=void 0,e._orientationChanging=void 0,e._isRotated=void 0,e._orientation=void 0,e._isAdjustViewport=void 0,e._resolutionPolicy=void 0,e._rpExactFit=void 0,e._rpShowAll=void 0,e._rpNoBorder=void 0,e._rpFixedHeight=void 0,e._rpFixedWidth=void 0,a(e);var i=DO,r=UO;return e._frameSize=new Ys(0,0),e._designResolutionSize=new Ys(0,0),e._originalDesignResolutionSize=new Ys(0,0),e._scaleX=1,e._scaleY=1,e._viewportRect=new Ks(0,0,0,0),e._visibleRect=new Ks(0,0,0,0),e._autoFullScreen=!1,e._devicePixelRatio=1,e._maxPixelRatio=2,e._retinaEnabled=!1,e._resizeCallback=null,e._resizing=!1,e._resizeWithBrowserSize=!1,e._orientationChanging=!0,e._isRotated=!1,e._orientation=_.macro.ORIENTATION_AUTO,e._isAdjustViewport=!0,e._rpExactFit=new kO(i.EQUAL_TO_FRAME,r.EXACT_FIT),e._rpShowAll=new kO(i.EQUAL_TO_FRAME,r.SHOW_ALL),e._rpNoBorder=new kO(i.EQUAL_TO_FRAME,r.NO_BORDER),e._rpFixedHeight=new kO(i.EQUAL_TO_FRAME,r.FIXED_HEIGHT),e._rpFixedWidth=new kO(i.EQUAL_TO_FRAME,r.FIXED_WIDTH),e._resolutionPolicy=e._rpShowAll,_.game.once(_.Game.EVENT_ENGINE_INITED,e.init,a(e)),e}s(e,t);var i=e.prototype;return i.init=function(){LO.init(),this._initFrameSize();var t=_.game.canvas.width,e=_.game.canvas.height;this._designResolutionSize.width=t,this._designResolutionSize.height=e,this._originalDesignResolutionSize.width=t,this._originalDesignResolutionSize.height=e,this._viewportRect.width=t,this._viewportRect.height=e,this._visibleRect.width=t,this._visibleRect.height=e,_.winSize.width=this._visibleRect.width,_.winSize.height=this._visibleRect.height,_.visibleRect&&_.visibleRect.init(this._visibleRect)},i.resizeWithBrowserSize=function(t){t?this._resizeWithBrowserSize||(this._resizeWithBrowserSize=!0,window.addEventListener("resize",this._resizeEvent),window.addEventListener("orientationchange",this._orientationChange)):this._resizeWithBrowserSize&&(this._resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent),window.removeEventListener("orientationchange",this._orientationChange))},i.setResizeCallback=function(t){"function"!=typeof t&&null!=t||(this._resizeCallback=t)},i.setOrientation=function(t){(t&=_.macro.ORIENTATION_AUTO)&&this._orientation!==t&&(this._orientation=t)},i.adjustViewportMeta=function(t){this._isAdjustViewport=t},i.enableRetina=function(t){this._retinaEnabled=!!t},i.isRetinaEnabled=function(){return this._retinaEnabled},i.enableAutoFullScreen=function(t){t&&t!==this._autoFullScreen&&_.sys.isMobile&&_.sys.browserType!==_.sys.BROWSER_TYPE_WECHAT?(this._autoFullScreen=!0,_.screen.autoFullScreen(_.game.frame)):this._autoFullScreen=!1},i.isAutoFullScreenEnabled=function(){return this._autoFullScreen},i.setCanvasSize=function(t,e){var i=_.game.canvas,r=_.game.container;this._devicePixelRatio=window.devicePixelRatio,i.width=Jr.windowPixelResolution.width,i.height=Jr.windowPixelResolution.height,i.style.width=t+"px",i.style.height=e+"px",r.style.width=t+"px",r.style.height=e+"px",this._resizeEvent()},i.getCanvasSize=function(){return new Ys(_.game.canvas.width,_.game.canvas.height)},i.getFrameSize=function(){return new Ys(this._frameSize.width,this._frameSize.height)},i.setFrameSize=function(t,e){this._frameSize.width=t,this._frameSize.height=e,_.frame.style.width=t+"px",_.frame.style.height=e+"px",this._resizeEvent()},i.getVisibleSize=function(){return new Ys(this._visibleRect.width,this._visibleRect.height)},i.getVisibleSizeInPixel=function(){return new Ys(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},i.getVisibleOrigin=function(){return new Es(this._visibleRect.x,this._visibleRect.y)},i.getVisibleOriginInPixel=function(){return new Es(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},i.getResolutionPolicy=function(){return this._resolutionPolicy},i.setResolutionPolicy=function(t){var e=this;if(t instanceof kO)e._resolutionPolicy=t;else{var i=kO;t===i.EXACT_FIT&&(e._resolutionPolicy=e._rpExactFit),t===i.SHOW_ALL&&(e._resolutionPolicy=e._rpShowAll),t===i.NO_BORDER&&(e._resolutionPolicy=e._rpNoBorder),t===i.FIXED_HEIGHT&&(e._resolutionPolicy=e._rpFixedHeight),t===i.FIXED_WIDTH&&(e._resolutionPolicy=e._rpFixedWidth)}},i.setDesignResolutionSize=function(t,e,i){if(t>0&&e>0){this.setResolutionPolicy(i);var r=this._resolutionPolicy;if(r&&r.preApply(this),_.sys.isMobile&&this._adjustViewportMeta(),this._orientationChanging=!0,this._resizing||this._initFrameSize(),r){this._originalDesignResolutionSize.width=this._designResolutionSize.width=t,this._originalDesignResolutionSize.height=this._designResolutionSize.height=e;var n=r.apply(this,this._designResolutionSize);if(n.scale&&2===n.scale.length&&(this._scaleX=n.scale[0],this._scaleY=n.scale[1]),n.viewport){var s=this._viewportRect,a=this._visibleRect,o=n.viewport;s.x=o.x,s.y=o.y,s.width=o.width,s.height=o.height,a.x=0,a.y=0,a.width=o.width/this._scaleX,a.height=o.height/this._scaleY}r.postApply(this),_.winSize.width=this._visibleRect.width,_.winSize.height=this._visibleRect.height,NO&&NO.init(this._visibleRect),this.emit("design-resolution-changed")}else x(2201)}else B(2200)},i.getDesignResolutionSize=function(){return new Ys(this._designResolutionSize.width,this._designResolutionSize.height)},i.setRealPixelResolution=function(t,e,i){this._setViewportMeta({width:t},!0),document.documentElement.style.width=t+"px",document.body.style.width=t+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(t,e,i)},i.getViewportRect=function(){return this._viewportRect},i.getScaleX=function(){return this._scaleX},i.getScaleY=function(){return this._scaleY},i.getDevicePixelRatio=function(){return this._devicePixelRatio},i.convertToLocationInView=function(t,e,i,r){var n=r||new Es,s=this._devicePixelRatio*(t-i.left),a=this._devicePixelRatio*(i.top+i.height-e);return this._isRotated?(n.x=_.game.canvas.width-a,n.y=s):(n.x=s,n.y=a),_.GAME_VIEW&&(n.x/=_.gameView.canvas.width/_.game.canvas.width,n.y/=_.gameView.canvas.height/_.game.canvas.height),n},i._convertPointWithScale=function(t){var e=this._viewportRect;t.x=(t.x-e.x)/this._scaleX,t.y=(t.y-e.y)/this._scaleY},i._resizeEvent=function(){var t=_.view,e=t._frameSize.width,i=t._frameSize.height,r=t._isRotated;if(_.sys.isMobile){var n=_.game.container.style,s=n.margin;n.margin="0",n.display="none",t._initFrameSize(),n.margin=s,n.display="block"}else t._initFrameSize();if(t._orientationChanging||t._isRotated!==r||t._frameSize.width!==e||t._frameSize.height!==i){var a=t._originalDesignResolutionSize.width,o=t._originalDesignResolutionSize.height;t._resizing=!0,a>0&&t.setDesignResolutionSize(a,o,t._resolutionPolicy),t._resizing=!1,t.emit("canvas-resize"),t._resizeCallback&&t._resizeCallback.call()}},i._orientationChange=function(){_.view._orientationChanging=!0,_.view._resizeEvent()},i._initFrameSize=function(){var t=this._frameSize,e=LO.availWidth(_.game.frame),i=LO.availHeight(_.game.frame),r=e>=i;!_.sys.isMobile||r&&this._orientation&_.macro.ORIENTATION_LANDSCAPE||!r&&this._orientation&_.macro.ORIENTATION_PORTRAIT?(t.width=e,t.height=i,_.game.container.style["-webkit-transform"]="rotate(0deg)",_.game.container.style.transform="rotate(0deg)",this._isRotated=!1):(t.width=i,t.height=e,_.game.container.style["-webkit-transform"]="rotate(90deg)",_.game.container.style.transform="rotate(90deg)",_.game.container.style["-webkit-transform-origin"]="0px 0px 0px",_.game.container.style.transformOrigin="0px 0px 0px",this._isRotated=!0,_.game.canvas.style["-webkit-transform"]="translateZ(0px)",_.game.canvas.style.transform="translateZ(0px)"),this._orientationChanging&&setTimeout((function(){_.view._orientationChanging=!1}),1e3)},i._adjustSizeKeepCanvasSize=function(){var t=this._originalDesignResolutionSize.width,e=this._originalDesignResolutionSize.height;t>0&&this.setDesignResolutionSize(t,e,this._resolutionPolicy)},i._setViewportMeta=function(t,e){var i=document.getElementById("cocosMetaElement");i&&e&&document.head.removeChild(i);var r,n,s,a=document.getElementsByName("viewport"),o=a?a[0]:null;for(n in r=o?o.content:"",(i=i||document.createElement("meta")).id="cocosMetaElement",i.name="viewport",i.content="",t)-1===r.indexOf(n)?r+=","+n+"="+t[n]:e&&(s=new RegExp(n+"s*=s*[^,]+"),r=r.replace(s,n+"="+t[n]));/^,/.test(r)&&(r=r.substr(1)),i.content=r,o&&(o.content=r),document.head.appendChild(i)},i._adjustViewportMeta=function(){this._isAdjustViewport&&(this._setViewportMeta(LO.meta,!1),this._isAdjustViewport=!1)},i._convertMouseToLocation=function(t,e){t.x=this._devicePixelRatio*(t.x-e.left),t.y=this._devicePixelRatio*(e.top+e.height-t.y),_.GAME_VIEW&&(t.x/=_.gameView.canvas.width/_.game.canvas.width,t.y/=_.gameView.canvas.height/_.game.canvas.height)},i._convertTouchWidthScale=function(t){var e=this._viewportRect,i=this._scaleX,r=this._scaleY;t._point.x=(t._point.x-e.x)/i,t._point.y=(t._point.y-e.y)/r,t._prevPoint.x=(t._prevPoint.x-e.x)/i,t._prevPoint.y=(t._prevPoint.y-e.y)/r},i._convertTouchesWithScale=function(t){for(var e,i,r=this._viewportRect,n=this._scaleX,s=this._scaleY,a=0;a<t.length;a++){var o=t[a];e=o._point,i=o._prevPoint,e.x=(e.x-r.x)/n,e.y=(e.y-r.y)/s,i.x=(i.x-r.x)/n,i.y=(i.y-r.y)/s}},e}(rr));FO.instance=void 0;var DO=function(){function t(){this.name="ContainerStrategy"}var e=t.prototype;return e.preApply=function(){},e.apply=function(){},e.postApply=function(){},e._setupContainer=function(t,e,i){var r=_.game.canvas,n=_.game.container;_.sys.os===_.sys.OS_ANDROID&&(document.body.style.width=(t._isRotated?i:e)+"px",document.body.style.height=(t._isRotated?e:i)+"px"),n.style.width=r.style.width=e+"px",n.style.height=r.style.height=i+"px",t._devicePixelRatio=1,t.isRetinaEnabled()&&(t._devicePixelRatio=Math.min(t._maxPixelRatio,window.devicePixelRatio||1)),r.width=e*t._devicePixelRatio,r.height=i*t._devicePixelRatio},e._fixContainer=function(){document.body.insertBefore(_.game.container,document.body.firstChild);var t=document.body.style;t.width=window.innerWidth+"px",t.height=window.innerHeight+"px",t.overflow="hidden";var e=_.game.container.style;e.position="fixed",e.left=e.top="0px",document.body.scrollTop=0},t}();DO.EQUAL_TO_FRAME=void 0,DO.PROPORTION_TO_FRAME=void 0;var UO=function(){function t(){this.name="ContentStrategy",this._result=void 0,this._result={scale:[1,1],viewport:null}}var e=t.prototype;return e.preApply=function(){},e.apply=function(){return{scale:[1,1]}},e.postApply=function(){},e._buildResult=function(t,e,i,r,n,s){Math.abs(t-i)<2&&(i=t),Math.abs(e-r)<2&&(r=e);var a=new Ks(Math.round((t-i)/2),Math.round((e-r)/2),i,r);return this._result.scale=[n,s],this._result.viewport=a,this._result},t}();UO.EXACT_FIT=void 0,UO.SHOW_ALL=void 0,UO.NO_BORDER=void 0,UO.FIXED_HEIGHT=void 0,UO.FIXED_WIDTH=void 0,function(){var t=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).name="EqualToFrame",e}return s(e,t),e.prototype.apply=function(t){var e=t._frameSize.height,i=_.game.container.style;this._setupContainer(t,t._frameSize.width,t._frameSize.height),t._isRotated?i.margin="0 0 0 "+e+"px":i.margin="0px",i.padding="0px"},e}(DO),e=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).name="ProportionalToFrame",e}return s(e,t),e.prototype.apply=function(t,e){var i,r,n=t._frameSize.width,s=t._frameSize.height,a=_.game.container.style,o=e.width,h=e.height,l=n/o,u=s/h;l<u?(i=n,r=h*l):(i=o*u,r=s);var c=Math.round((n-i)/2),d=Math.round((s-r)/2);i=n-2*c,r=s-2*d,this._setupContainer(t,i,r),t._isRotated?a.margin="0 0 0 "+s+"px":a.margin="0px",a.paddingLeft=c+"px",a.paddingRight=c+"px",a.paddingTop=d+"px",a.paddingBottom=d+"px"},e}(DO),i=("undefined"==typeof window?global:window).__globalAdapter;i&&(i.adaptContainerStrategy&&i.adaptContainerStrategy(DO.prototype),i.adaptView&&i.adaptView(FO.prototype)),DO.EQUAL_TO_FRAME=new t,DO.PROPORTION_TO_FRAME=new e;var r=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).name="ExactFit",e}return s(e,t),e.prototype.apply=function(t,e){var i=_.game.canvas.width,r=_.game.canvas.height,n=i/e.width,s=r/e.height;return this._buildResult(i,r,i,r,n,s)},e}(UO),n=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).name="ShowAll",e}return s(e,t),e.prototype.apply=function(t,e){var i,r,n=_.game.canvas.width,s=_.game.canvas.height,a=e.width,o=e.height,h=n/a,l=s/o,u=0;return h<l?(i=n,r=o*(u=h)):(i=a*(u=l),r=s),this._buildResult(n,s,i,r,u,u)},e}(UO),a=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).name="NoBorder",e}return s(e,t),e.prototype.apply=function(t,e){var i,r,n,s=_.game.canvas.width,a=_.game.canvas.height,o=e.width,h=e.height,l=s/o,u=a/h;return l<u?(r=o*(i=u),n=a):(r=s,n=h*(i=l)),this._buildResult(s,a,r,n,i,i)},e}(UO),o=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).name="FixedHeight",e}return s(e,t),e.prototype.apply=function(t,e){var i=_.game.canvas.width,r=_.game.canvas.height,n=r/e.height,s=i,a=r;return this._buildResult(i,r,s,a,n,n)},e}(UO),h=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).name="FixedWidth",e}return s(e,t),e.prototype.apply=function(t,e){var i=_.game.canvas.width,r=_.game.canvas.height,n=i/e.width,s=i,a=r;return this._buildResult(i,r,s,a,n,n)},e}(UO);UO.EXACT_FIT=new r,UO.SHOW_ALL=new n,UO.NO_BORDER=new a,UO.FIXED_HEIGHT=new o,UO.FIXED_WIDTH=new h}();var kO=t("ResolutionPolicy",function(){function t(t,e){this.name="ResolutionPolicy",this._containerStrategy=void 0,this._contentStrategy=void 0,this._containerStrategy=null,this._contentStrategy=null,this.setContainerStrategy(t),this.setContentStrategy(e)}var e=t.prototype;return e.preApply=function(t){this._containerStrategy.preApply(t),this._contentStrategy.preApply(t)},e.apply=function(t,e){return this._containerStrategy.apply(t,e),this._contentStrategy.apply(t,e)},e.postApply=function(t){this._containerStrategy.postApply(t),this._contentStrategy.postApply(t)},e.setContainerStrategy=function(t){t instanceof DO&&(this._containerStrategy=t)},e.setContentStrategy=function(t){t instanceof UO&&(this._contentStrategy=t)},r(t,[{key:"canvasSize",get:function(){return _.v2(_.game.canvas.width,_.game.canvas.height)}}]),t}());kO.EXACT_FIT=0,kO.NO_BORDER=1,kO.SHOW_ALL=2,kO.FIXED_HEIGHT=3,kO.FIXED_WIDTH=4,kO.UNKNOWN=5,kO.ContainerStrategy=DO,kO.ContentStrategy=UO,_.ResolutionPolicy=kO;var zO=t("view",FO.instance=_.view=new FO);_.winSize=new Ys,ta(FO.prototype,"View.prototype",[{name:"isAntiAliasEnabled",suggest:"The API of Texture2d have been largely modified, no alternative"},{name:"enableAntiAlias",suggest:"The API of Texture2d have been largely modified, no alternative"}]);var GO=null,HO=null,VO=null,WO=null,jO=t("SystemEvent",function(t){function e(){return t.call(this)||this}s(e,t);var i=e.prototype;return i.setAccelerometerEnabled=function(t){t&&window.DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then((function(t){console.log("Device Motion Event request permission: "+t),MO.setAccelerometerEnabled("granted"===t)})):MO.setAccelerometerEnabled(t)},i.setAccelerometerInterval=function(t){MO.setAccelerometerInterval(t)},i.on=function(e,i,r,n){return t.prototype.on.call(this,e,i,r,n),e!==gg.KEY_DOWN&&e!==gg.KEY_UP||GO||(GO=Zg.create({event:Zg.KEYBOARD,onKeyPressed:function(t,e){e.type=gg.KEY_DOWN,XO.emit(e.type,e)},onKeyReleased:function(t,e){e.type=gg.KEY_UP,XO.emit(e.type,e)}}),av.addListener(GO,256)),e===gg.DEVICEMOTION&&(HO||(HO=Zg.create({event:Zg.ACCELERATION,callback:function(t,e){e.type=gg.DEVICEMOTION,_.systemEvent.emit(e.type,e)}}),av.addListener(HO,256))),e!==gg.TOUCH_START&&e!==gg.TOUCH_MOVE&&e!==gg.TOUCH_END&&e!==gg.TOUCH_CANCEL||VO||(VO=Zg.create({event:Zg.TOUCH_ONE_BY_ONE,onTouchBegan:function(t,e){return e.type=gg.TOUCH_START,_.systemEvent.emit(e.type,t,e),!0},onTouchMoved:function(t,e){e.type=gg.TOUCH_MOVE,_.systemEvent.emit(e.type,t,e)},onTouchEnded:function(t,e){e.type=gg.TOUCH_END,_.systemEvent.emit(e.type,t,e)},onTouchCancelled:function(t,e){e.type=gg.TOUCH_CANCEL,_.systemEvent.emit(e.type,t,e)}}),av.addListener(VO,256)),e!==gg.MOUSE_DOWN&&e!==gg.MOUSE_MOVE&&e!==gg.MOUSE_UP&&e!==gg.MOUSE_WHEEL||WO||(WO=Zg.create({event:Zg.MOUSE,onMouseDown:function(t){t.type=gg.MOUSE_DOWN,_.systemEvent.emit(t.type,t)},onMouseMove:function(t){t.type=gg.MOUSE_MOVE,_.systemEvent.emit(t.type,t)},onMouseUp:function(t){t.type=gg.MOUSE_UP,_.systemEvent.emit(t.type,t)},onMouseScroll:function(t){t.type=gg.MOUSE_WHEEL,_.systemEvent.emit(t.type,t)}}),av.addListener(WO,256)),i},i.off=function(e,i,r){if(t.prototype.off.call(this,e,i,r),GO&&(e===gg.KEY_DOWN||e===gg.KEY_UP)){var n=this.hasEventListener(gg.KEY_DOWN),s=this.hasEventListener(gg.KEY_UP);n||s||(av.removeListener(GO),GO=null)}if(HO&&e===gg.DEVICEMOTION&&(av.removeListener(HO),HO=null),VO&&(e===gg.TOUCH_START||e===gg.TOUCH_MOVE||e===gg.TOUCH_END||e===gg.TOUCH_CANCEL)){var a=this.hasEventListener(gg.TOUCH_START),o=this.hasEventListener(gg.TOUCH_MOVE),h=this.hasEventListener(gg.TOUCH_END),l=this.hasEventListener(gg.TOUCH_CANCEL);a||o||h||l||(av.removeListener(VO),VO=null)}if(WO&&(e===gg.MOUSE_DOWN||e===gg.MOUSE_MOVE||e===gg.MOUSE_UP||e===gg.MOUSE_WHEEL)){var u=this.hasEventListener(gg.MOUSE_DOWN),c=this.hasEventListener(gg.MOUSE_MOVE),_=this.hasEventListener(gg.MOUSE_UP),d=this.hasEventListener(gg.MOUSE_WHEEL);u||c||_||d||(av.removeListener(WO),WO=null)}},e}(rr));jO.EventType=gg,_.SystemEvent=jO;var XO=t("systemEvent",new jO);_.systemEvent=XO,$s(gg,"Node.EventType",[{name:"POSITION_PART",newName:"TRANSFORM_CHANGED"},{name:"ROTATION_PART",newName:"TRANSFORM_CHANGED"},{name:"SCALE_PART",newName:"TRANSFORM_CHANGED"}]);var YO=t("screen",{_supportsFullScreen:!1,_onfullscreenchange:null,_onfullscreenerror:null,_preOnFullScreenError:null,_preOnTouch:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){this._fn={};var t,e,i,r,n=this._fnMap;for(t=0,e=n.length;t<e;t++)if((i=n[t])&&void 0!==document[i[1]]){for(t=0,r=i.length;t<r;t++)this._fn[n[0][t]]=i[t];break}this._supportsFullScreen=void 0!==this._fn.requestFullscreen,this._touchEvent="ontouchstart"in window?"touchstart":"mousedown"},get supportsFullScreen(){return this._supportsFullScreen},fullScreen:function(){return!!this._supportsFullScreen&&void 0!==document[this._fn.fullscreenElement]&&null!==document[this._fn.fullscreenElement]},requestFullScreen:function(t,e,i){if(this._supportsFullScreen){if(t=t||document.documentElement,e){var r=this._fn.fullscreenchange;this._onfullscreenchange&&document.removeEventListener(r,this._onfullscreenchange),this._onfullscreenchange=e,document.addEventListener(r,e,!1)}if(i){var n=this._fn.fullscreenerror;this._onfullscreenerror&&document.removeEventListener(n,this._onfullscreenerror),this._onfullscreenerror=i,document.addEventListener(n,i,{once:!0})}var s=t[this._fn.requestFullscreen]();return window.Promise&&s instanceof Promise&&s.catch((function(){})),s}},exitFullScreen:function(){var t;return this.fullScreen()&&(t=document[this._fn.exitFullscreen]()).catch((function(){})),t},autoFullScreen:function(t,e){t=t||document.body,this._ensureFullScreen(t,e),this.requestFullScreen(t,e)},disableAutoFullScreen:function(t){if(this._preOnTouch){var e=_.game.canvas||t,i=this._touchEvent;e.removeEventListener(i,this._preOnTouch),this._preOnTouch=null}},_ensureFullScreen:function(t,e){var i=this,r=_.game.canvas||t,n=this._fn.fullscreenerror,s=this._touchEvent,a=function(){i._preOnFullScreenError=null,i._preOnTouch&&r.removeEventListener(s,i._preOnTouch),i._preOnTouch=function(){i._preOnTouch=null,i.requestFullScreen(t,e)},r.addEventListener(s,i._preOnTouch,{once:!0})};this._preOnFullScreenError&&t.removeEventListener(n,this._preOnFullScreenError),this._preOnFullScreenError=a,t.addEventListener(n,a,{once:!0})}});YO.init(),_.screen=YO;var qO=t("System",function(){function t(){this._id="",this._priority=0,this._executeInEditMode=!1}t.sortByPriority=function(t,e){return t._priority<e._priority?1:t._priority>e.priority?-1:0};var e=t.prototype;return e.init=function(){},e.update=function(){},e.postUpdate=function(){},r(t,[{key:"priority",set:function(t){this._priority=t},get:function(){return this._priority}},{key:"id",set:function(t){this._id=t},get:function(){return this._id}}]),t}()),KO=new j("Scheduler"),ZO=function(t,e,i,r){this.target=void 0,this.priority=void 0,this.paused=void 0,this.markedForDeletion=void 0,this.target=t,this.priority=e,this.paused=i,this.markedForDeletion=r};ZO.get=function(t,e,i,r){var n=ZO._listEntries.pop();return n?(n.target=t,n.priority=e,n.paused=i,n.markedForDeletion=r):n=new ZO(t,e,i,r),n},ZO.put=function(t){ZO._listEntries.length<20&&(t.target=null,ZO._listEntries.push(t))},ZO._listEntries=[];var QO=function(t,e,i,r){this.list=void 0,this.entry=void 0,this.target=void 0,this.callback=void 0,this.list=t,this.entry=e,this.target=i,this.callback=r};QO.get=function(t,e,i,r){var n=QO._hashUpdateEntries.pop();return n?(n.list=t,n.entry=e,n.target=i,n.callback=r):n=new QO(t,e,i,r),n},QO.put=function(t){QO._hashUpdateEntries.length<20&&(t.list=t.entry=t.target=t.callback=null,QO._hashUpdateEntries.push(t))},QO._hashUpdateEntries=[];var JO=function(t,e,i,r,n,s){this.timers=void 0,this.target=void 0,this.timerIndex=void 0,this.currentTimer=void 0,this.currentTimerSalvaged=void 0,this.paused=void 0,this.timers=t,this.target=e,this.timerIndex=i,this.currentTimer=r,this.currentTimerSalvaged=n,this.paused=s};JO.get=function(t,e,i,r,n,s){var a=JO._hashTimerEntries.pop();return a?(a.timers=t,a.target=e,a.timerIndex=i,a.currentTimer=r,a.currentTimerSalvaged=n,a.paused=s):a=new JO(t,e,i,r,n,s),a},JO.put=function(t){JO._hashTimerEntries.length<20&&(t.timers=t.target=t.currentTimer=null,JO._hashTimerEntries.push(t))},JO._hashTimerEntries=[];var $O=function(){function t(){this._lock=void 0,this._scheduler=void 0,this._elapsed=void 0,this._runForever=void 0,this._useDelay=void 0,this._timesExecuted=void 0,this._repeat=void 0,this._delay=void 0,this._interval=void 0,this._target=void 0,this._callback=void 0,this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}var e=t.prototype;return e.initWithCallback=function(t,e,i,r,n,s){return this._lock=!1,this._scheduler=t,this._target=i,this._callback=e,this._elapsed=-1,this._interval=r,this._delay=s,this._useDelay=this._delay>0,this._repeat=n,this._runForever=this._repeat===_.macro.REPEAT_FOREVER,!0},e.getInterval=function(){return this._interval},e.setInterval=function(t){this._interval=t},e.update=function(t){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=t,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},e.getCallback=function(){return this._callback},e.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)},e.cancel=function(){this._scheduler.unschedule(this._callback,this._target)},t}();$O._timers=[],$O.get=function(){return $O._timers.pop()||new $O},$O.put=function(t){$O._timers.length<20&&!t._lock&&(t._scheduler=t._target=t._callback=null,$O._timers.push(t))};var tI=t("Scheduler",function(t){function e(){var e;return(e=t.call(this)||this)._timeScale=void 0,e._updatesNegList=void 0,e._updates0List=void 0,e._updatesPosList=void 0,e._hashForUpdates=void 0,e._hashForTimers=void 0,e._currentTarget=void 0,e._currentTargetSalvaged=void 0,e._updateHashLocked=void 0,e._arrayForTimers=void 0,e._timeScale=1,e._updatesNegList=[],e._updates0List=[],e._updatesPosList=[],e._hashForUpdates=it(!0),e._hashForTimers=it(!0),e._currentTarget=null,e._currentTargetSalvaged=!1,e._updateHashLocked=!1,e._arrayForTimers=[],e}s(e,t),e.enableForTarget=function(t){var e=!1;(t.uuid||t.id)&&(e=!0),e||(t.__instanceId?I(1513):t.id=KO.getNewId())};var i=e.prototype;return i.setTimeScale=function(t){this._timeScale=t},i.getTimeScale=function(){return this._timeScale},i.update=function(t){var e,i,r,n,s;for(this._updateHashLocked=!0,1!==this._timeScale&&(t*=this._timeScale),e=0,r=(i=this._updatesNegList).length;e<r;e++)(n=i[e]).paused||n.markedForDeletion||n.target.update(t);for(e=0,r=(i=this._updates0List).length;e<r;e++)(n=i[e]).paused||n.markedForDeletion||n.target.update(t);for(e=0,r=(i=this._updatesPosList).length;e<r;e++)(n=i[e]).paused||n.markedForDeletion||n.target.update(t);var a=this._arrayForTimers;for(e=0;e<a.length;e++){if(s=a[e],this._currentTarget=s,this._currentTargetSalvaged=!1,!s.paused)for(s.timerIndex=0;s.timerIndex<s.timers.length;++s.timerIndex)s.currentTimer=s.timers[s.timerIndex],s.currentTimerSalvaged=!1,s.currentTimer.update(t),s.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--e)}for(e=0,i=this._updatesNegList;e<i.length;)(n=i[e]).markedForDeletion?this._removeUpdateFromHash(n):e++;for(e=0,i=this._updates0List;e<i.length;)(n=i[e]).markedForDeletion?this._removeUpdateFromHash(n):e++;for(e=0,i=this._updatesPosList;e<i.length;)(n=i[e]).markedForDeletion?this._removeUpdateFromHash(n):e++;this._updateHashLocked=!1,this._currentTarget=null},i.schedule=function(t,e,i,r,n,s){if("function"!=typeof t){var a=t;t=e,e=a}3!==arguments.length&&4!==arguments.length&&5!==arguments.length||(s=!!r,r=_.macro.REPEAT_FOREVER,n=0),L(e,1502);var o=e.uuid||e.id;if(o){var h,l,u=this._hashForTimers[o];if(u?u.paused!==s&&I(1511):(u=JO.get(null,e,0,null,null,s),this._arrayForTimers.push(u),this._hashForTimers[o]=u),null==u.timers)u.timers=[];else for(l=0;l<u.timers.length;++l)if((h=u.timers[l])&&t===h._callback)return x(1507,h.getInterval(),i),void(h._interval=i);(h=$O.get()).initWithCallback(this,t,e,i,r,n),u.timers.push(h),this._currentTarget===u&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)}else B(1510)},i.scheduleUpdate=function(t,e,i){var r=t.uuid||t.id;if(r){var n=this._hashForUpdates[r];if(n&&n.entry){if(n.entry.priority===e)return n.entry.markedForDeletion=!1,void(n.entry.paused=i);if(this._updateHashLocked)return x(1506),n.entry.markedForDeletion=!1,void(n.entry.paused=i);this.unscheduleUpdate(t)}var s,a=ZO.get(t,e,i,!1);0===e?(s=this._updates0List,this._appendIn(s,a)):(s=e<0?this._updatesNegList:this._updatesPosList,this._priorityIn(s,a,e)),this._hashForUpdates[r]=QO.get(s,a,t,null)}else B(1510)},i.unschedule=function(t,e){if(e&&t){var i=e.uuid||e.id;if(i){var r=this._hashForTimers[i];if(r)for(var n=r.timers,s=0,a=n.length;s<a;s++){var o=n[s];if(t===o._callback)return o!==r.currentTimer||r.currentTimerSalvaged||(r.currentTimerSalvaged=!0),n.splice(s,1),$O.put(o),r.timerIndex>=s&&r.timerIndex--,void(0===n.length&&(this._currentTarget===r?this._currentTargetSalvaged=!0:this._removeHashElement(r)))}}else B(1510)}},i.unscheduleUpdate=function(t){if(t){var e=t.uuid||t.id;if(e){var i=this._hashForUpdates[e];i&&(this._updateHashLocked?i.entry.markedForDeletion=!0:this._removeUpdateFromHash(i.entry))}else B(1510)}},i.unscheduleAllForTarget=function(t){if(t){var e=t.uuid||t.id;if(e){var i=this._hashForTimers[e];if(i){var r=i.timers;r.indexOf(i.currentTimer)>-1&&!i.currentTimerSalvaged&&(i.currentTimerSalvaged=!0);for(var n=0,s=r.length;n<s;n++)$O.put(r[n]);r.length=0,this._currentTarget===i?this._currentTargetSalvaged=!0:this._removeHashElement(i)}this.unscheduleUpdate(t)}else B(1510)}},i.unscheduleAll=function(){this.unscheduleAllWithMinPriority(_.Scheduler.PRIORITY_SYSTEM)},i.unscheduleAllWithMinPriority=function(t){var e,i,r,n=this._arrayForTimers;for(e=n.length-1;e>=0;e--)i=n[e],this.unscheduleAllForTarget(i.target);var s=0;if(t<0)for(e=0;e<this._updatesNegList.length;)s=this._updatesNegList.length,(r=this._updatesNegList[e])&&r.priority>=t&&this.unscheduleUpdate(r.target),s===this._updatesNegList.length&&e++;if(t<=0)for(e=0;e<this._updates0List.length;)s=this._updates0List.length,(r=this._updates0List[e])&&this.unscheduleUpdate(r.target),s===this._updates0List.length&&e++;for(e=0;e<this._updatesPosList.length;)s=this._updatesPosList.length,(r=this._updatesPosList[e])&&r.priority>=t&&this.unscheduleUpdate(r.target),s===this._updatesPosList.length&&e++},i.isScheduled=function(t,e){L(t,1508),L(e,1509);var i=e.uuid||e.id;if(i){var r=this._hashForTimers[i];if(!r)return!1;if(null==r.timers)return!1;for(var n=r.timers,s=0;s<n.length;++s)if(t===n[s]._callback)return!0;return!1}B(1510)},i.pauseAllTargets=function(){return this.pauseAllTargetsWithMinPriority(_.Scheduler.PRIORITY_SYSTEM)},i.pauseAllTargetsWithMinPriority=function(t){var e,i,r,n,s=[],a=this._arrayForTimers;for(i=0,r=a.length;i<r;i++)(e=a[i])&&(e.paused=!0,s.push(e.target));if(t<0)for(i=0;i<this._updatesNegList.length;i++)(n=this._updatesNegList[i])&&n.priority>=t&&(n.paused=!0,s.push(n.target));if(t<=0)for(i=0;i<this._updates0List.length;i++)(n=this._updates0List[i])&&(n.paused=!0,s.push(n.target));for(i=0;i<this._updatesPosList.length;i++)(n=this._updatesPosList[i])&&n.priority>=t&&(n.paused=!0,s.push(n.target));return s},i.resumeTargets=function(t){if(t)for(var e=0;e<t.length;e++)this.resumeTarget(t[e])},i.pauseTarget=function(t){L(t,1503);var e=t.uuid||t.id;if(e){var i=this._hashForTimers[e];i&&(i.paused=!0);var r=this._hashForUpdates[e];r&&(r.entry.paused=!0)}else B(1510)},i.resumeTarget=function(t){L(t,1504);var e=t.uuid||t.id;if(e){var i=this._hashForTimers[e];i&&(i.paused=!1);var r=this._hashForUpdates[e];r&&(r.entry.paused=!1)}else B(1510)},i.isTargetPaused=function(t){L(t,1505);var e=t.uuid||t.id;if(!e)return B(1510),!1;var i=this._hashForTimers[e];if(i)return i.paused;var r=this._hashForUpdates[e];return!!r&&r.entry.paused},i._removeHashElement=function(t){var e=t.target.uuid||t.target.id;delete this._hashForTimers[e];for(var i=this._arrayForTimers,r=0,n=i.length;r<n;r++)if(i[r]===t){i.splice(r,1);break}JO.put(t)},i._removeUpdateFromHash=function(t){var e=t.target.uuid||t.target.id,i=this._hashForUpdates[e];if(i){for(var r=i.list,n=i.entry,s=0,a=r.length;s<a;s++)if(r[s]===n){r.splice(s,1);break}delete this._hashForUpdates[e],ZO.put(n),QO.put(i)}},i._priorityIn=function(t,e,i){for(var r=0;r<t.length;r++)if(i<t[r].priority)return void t.splice(r,0,e);t.push(e)},i._appendIn=function(t,e){t.push(e)},e}(qO));tI.PRIORITY_SYSTEM=1<<31,tI.PRIORITY_NON_SYSTEM=tI.PRIORITY_SYSTEM+1,tI.ID="scheduler",_.Scheduler=tI;var eI,iI,rI,nI,sI,aI,oI,hI,lI,uI,cI,_I,dI,pI,fI,mI,gI,vI,yI,TI,EI,SI,bI,AI,CI,wI,RI,xI,OI,II,MI,BI,PI,NI,LI,FI,DI,UI,kI,zI,GI,HI,VI,WI,jI,XI,YI,qI,KI,ZI,QI,JI,$I,tM,eM,iM,rM,nM,sM,aM,oM,hM,lM,uM,cM,_M,dM,pM,fM,mM,gM,vM,yM,TM,EM,SM,bM,AM=function(){function t(t){this.jointTexturePool=void 0,this.jointAnimationInfo=void 0,this.jointTexturePool=new sT(t),this.jointAnimationInfo=new aT(t)}var e=t.prototype;return e.releaseSkeleton=function(t){this.jointTexturePool.releaseSkeleton(t)},e.releaseAnimationClip=function(t){this.jointTexturePool.releaseAnimationClip(t)},e.clear=function(){this.jointTexturePool.clear(),this.jointAnimationInfo.clear()},t}(),CM=new Cs,wM=Pt(jS),RM=Pt(WS),xM=Pt(XS),OM=Pt(qS),IM=Pt(YS),MM=Pt({SKYBOX:ab|Bl.DEPTH_STENCIL,SOLID_COLOR:Bl.ALL,DEPTH_ONLY:Bl.DEPTH_STENCIL,DONT_CLEAR:Bl.NONE}),BM=function(e){return t({Camera:e,CameraComponent:e}),e}((eI=Ne("cc.Camera"),iI=qe(),rI=We(),nI=si(),sI=$e(),aI=pi(vp.BitMask),oI=si(),hI=$e(),lI=pi(MM),uI=si(),cI=$e(),_I=si(),dI=$e(),pI=si(),fI=$e(),mI=si(),gI=$e(),vI=pi(wM),yI=si(),TI=$e(),EI=pi(RM),SI=si(),bI=$e(),AI=si(),CI=$e(),wI=si(),RI=$e(),xI=si(),OI=$e(),II=si(),MI=$e(),BI=pi(xM),PI=si(),NI=$e(),LI=pi(OM),FI=si(),DI=$e(),UI=pi(IM),kI=si(),zI=$e(),GI=si(),HI=$e(),VI=pi(fg),WI=si(),jI=$e(),eI(XI=iI(XI=rI(XI=Ve((dM=_M=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"_projection",qI,a(e)),l(e,"_priority",KI,a(e)),l(e,"_fov",ZI,a(e)),l(e,"_fovAxis",QI,a(e)),l(e,"_orthoHeight",JI,a(e)),l(e,"_near",$I,a(e)),l(e,"_far",tM,a(e)),l(e,"_color",eM,a(e)),l(e,"_depth",iM,a(e)),l(e,"_stencil",rM,a(e)),l(e,"_clearFlags",nM,a(e)),l(e,"_rect",sM,a(e)),l(e,"_aperture",aM,a(e)),l(e,"_shutter",oM,a(e)),l(e,"_iso",hM,a(e)),l(e,"_screenScale",lM,a(e)),l(e,"_visibility",uM,a(e)),l(e,"_targetTexture",cM,a(e)),e._camera=null,e._inEditorMode=!1,e._flows=void 0,e}s(e,t);var i=e.prototype;return i.onLoad=function(){this._createCamera()},i.onEnable=function(){this.node.hasChangedFlags|=Uv.POSITION,this._camera&&this._attachToScene()},i.onDisable=function(){this._camera&&this._detachFromScene()},i.onDestroy=function(){this._camera&&(_.director.root.destroyCamera(this._camera),this._camera=null),this._targetTexture&&this._targetTexture.off("resize")},i.screenPointToRay=function(t,e,i){return i||(i=uo.create()),this._camera&&this._camera.screenPointToRay(i,t,e),i},i.worldToScreen=function(t,e){return e||(e=new Cs),this._camera&&this._camera.worldToScreen(e,t),e},i.screenToWorld=function(t,e){return e||(e=this.node.getWorldPosition()),this._camera&&this._camera.screenToWorld(e,t),e},i.convertToUINode=function(t,e,i){if(i||(i=new Cs),!this._camera)return i;this.worldToScreen(t,CM);var r=e.getComponent("cc.UITransform"),n=zO.getVisibleSize(),s=CM.x-.5*this._camera.width,a=CM.y-.5*this._camera.height;return CM.x=s/_.view.getScaleX()+.5*n.width,CM.y=a/_.view.getScaleY()+.5*n.height,r&&r.convertToNodeSpaceAR(CM,i),i},i._createCamera=function(){this._camera=_.director.root.createCamera(),this._camera.initialize({name:this.node.name,node:this.node,projection:this._projection,window:this._inEditorMode?_.director.root&&_.director.root.mainWindow:_.director.root&&_.director.root.tempWindow,priority:this._priority,flows:this._flows}),this._camera&&(this._camera.viewport=this._rect,this._camera.fovAxis=this._fovAxis,this._camera.fov=Pr(this._fov),this._camera.orthoHeight=this._orthoHeight,this._camera.nearClip=this._near,this._camera.farClip=this._far,this._camera.clearColor=this._color,this._camera.clearDepth=this._depth,this._camera.clearStencil=this._stencil,this._camera.clearFlag=this._clearFlags,this._camera.visibility=this._visibility,this._camera.aperture=this._aperture,this._camera.shutter=this._shutter,this._camera.iso=this._iso),this._updateTargetTexture()},i._attachToScene=function(){this.node.scene&&this._camera&&(this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera),this._getRenderScene().addCamera(this._camera))},i._detachFromScene=function(){this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera)},i._chechTargetTextureEvent=function(t){var e=this;t&&t.off("resize"),this._targetTexture&&this._targetTexture.on("resize",(function(t){e._camera&&e._camera.setFixedSize(t.width,t.height)}),this)},i._updateTargetTexture=function(){if(this._camera&&this._targetTexture){var t=this._targetTexture.window;this._camera.changeTargetWindow(t),this._camera.setFixedSize(t.width,t.height)}},r(e,[{key:"camera",get:function(){return this._camera}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t,this._camera&&(this._camera.priority=t)}},{key:"visibility",get:function(){return this._visibility},set:function(t){this._visibility=t,this._camera&&(this._camera.visibility=t)}},{key:"clearFlags",get:function(){return this._clearFlags},set:function(t){this._clearFlags=t,this._camera&&(this._camera.clearFlag=t)}},{key:"clearColor",get:function(){return this._color},set:function(t){this._color.set(t),this._camera&&(this._camera.clearColor=this._color)}},{key:"clearDepth",get:function(){return this._depth},set:function(t){this._depth=t,this._camera&&(this._camera.clearDepth=t)}},{key:"clearStencil",get:function(){return this._stencil},set:function(t){this._stencil=t,this._camera&&(this._camera.clearStencil=t)}},{key:"projection",get:function(){return this._projection},set:function(t){this._projection=t,this._camera&&(this._camera.projectionType=t)}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(t){t!==this._fovAxis&&(this._fovAxis=t,this._camera&&(this._camera.fovAxis=t,t===WS.VERTICAL?this.fov=this._fov*this._camera.aspect:this.fov=this._fov/this._camera.aspect))}},{key:"fov",get:function(){return this._fov},set:function(t){this._fov=t,this._camera&&(this._camera.fov=Pr(t))}},{key:"orthoHeight",get:function(){return this._orthoHeight},set:function(t){this._orthoHeight=t,this._camera&&(this._camera.orthoHeight=t)}},{key:"near",get:function(){return this._near},set:function(t){this._near=t,this._camera&&(this._camera.nearClip=t)}},{key:"far",get:function(){return this._far},set:function(t){this._far=t,this._camera&&(this._camera.farClip=t)}},{key:"aperture",get:function(){return this._aperture},set:function(t){this._aperture=t,this._camera&&(this._camera.aperture=t)}},{key:"shutter",get:function(){return this._shutter},set:function(t){this._shutter=t,this._camera&&(this._camera.shutter=t)}},{key:"iso",get:function(){return this._iso},set:function(t){this._iso=t,this._camera&&(this._camera.iso=t)}},{key:"rect",get:function(){return this._rect},set:function(t){this._rect=t,this._camera&&(this._camera.viewport=t)}},{key:"targetTexture",get:function(){return this._targetTexture},set:function(t){if(this._targetTexture!==t){var e=this._targetTexture;this._targetTexture=t,this._chechTargetTextureEvent(e),this._updateTargetTexture(),!t&&this._camera&&(this._camera.changeTargetWindow(null),this._camera.isWindowSize=!0)}}},{key:"screenScale",get:function(){return this._screenScale},set:function(t){this._screenScale=t,this._camera&&(this._camera.screenScale=t)}},{key:"inEditorMode",get:function(){return this._inEditorMode},set:function(t){this._inEditorMode=t,this._camera&&this._camera.changeTargetWindow(t?_.director.root&&_.director.root.mainWindow:_.director.root&&_.director.root.tempWindow)}},{key:"flows",set:function(t){this._camera&&(this._camera.flows=t),this._flows=t}}]),e}(ds),_M.ProjectionType=wM,_M.FOVAxis=RM,_M.ClearFlag=MM,_M.Aperture=xM,_M.Shutter=OM,_M.ISO=IM,qI=u((YI=dM).prototype,"_projection",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return wM.PERSPECTIVE}}),KI=u(YI.prototype,"_priority",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ZI=u(YI.prototype,"_fov",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 45}}),QI=u(YI.prototype,"_fovAxis",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return RM.VERTICAL}}),JI=u(YI.prototype,"_orthoHeight",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),$I=u(YI.prototype,"_near",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),tM=u(YI.prototype,"_far",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),eM=u(YI.prototype,"_color",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qs("#333333")}}),iM=u(YI.prototype,"_depth",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),rM=u(YI.prototype,"_stencil",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),nM=u(YI.prototype,"_clearFlags",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return MM.SOLID_COLOR}}),sM=u(YI.prototype,"_rect",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ks(0,0,1,1)}}),aM=u(YI.prototype,"_aperture",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xM.F16_0}}),oM=u(YI.prototype,"_shutter",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return OM.D125}}),hM=u(YI.prototype,"_iso",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return IM.ISO100}}),lM=u(YI.prototype,"_screenScale",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),uM=u(YI.prototype,"_visibility",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _f}}),cM=u(YI.prototype,"_targetTexture",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u(YI.prototype,"priority",[nI,sI],Object.getOwnPropertyDescriptor(YI.prototype,"priority"),YI.prototype),u(YI.prototype,"visibility",[aI,oI,hI],Object.getOwnPropertyDescriptor(YI.prototype,"visibility"),YI.prototype),u(YI.prototype,"clearFlags",[lI,uI,cI],Object.getOwnPropertyDescriptor(YI.prototype,"clearFlags"),YI.prototype),u(YI.prototype,"clearColor",[_I,dI],Object.getOwnPropertyDescriptor(YI.prototype,"clearColor"),YI.prototype),u(YI.prototype,"clearDepth",[pI,fI],Object.getOwnPropertyDescriptor(YI.prototype,"clearDepth"),YI.prototype),u(YI.prototype,"clearStencil",[mI,gI],Object.getOwnPropertyDescriptor(YI.prototype,"clearStencil"),YI.prototype),u(YI.prototype,"projection",[vI,yI,TI],Object.getOwnPropertyDescriptor(YI.prototype,"projection"),YI.prototype),u(YI.prototype,"fovAxis",[EI,SI,bI],Object.getOwnPropertyDescriptor(YI.prototype,"fovAxis"),YI.prototype),u(YI.prototype,"fov",[AI,CI],Object.getOwnPropertyDescriptor(YI.prototype,"fov"),YI.prototype),u(YI.prototype,"orthoHeight",[wI,RI],Object.getOwnPropertyDescriptor(YI.prototype,"orthoHeight"),YI.prototype),u(YI.prototype,"near",[xI,OI],Object.getOwnPropertyDescriptor(YI.prototype,"near"),YI.prototype),u(YI.prototype,"far",[II,MI],Object.getOwnPropertyDescriptor(YI.prototype,"far"),YI.prototype),u(YI.prototype,"aperture",[BI,PI,NI],Object.getOwnPropertyDescriptor(YI.prototype,"aperture"),YI.prototype),u(YI.prototype,"shutter",[LI,FI,DI],Object.getOwnPropertyDescriptor(YI.prototype,"shutter"),YI.prototype),u(YI.prototype,"iso",[UI,kI,zI],Object.getOwnPropertyDescriptor(YI.prototype,"iso"),YI.prototype),u(YI.prototype,"rect",[GI,HI],Object.getOwnPropertyDescriptor(YI.prototype,"rect"),YI.prototype),u(YI.prototype,"targetTexture",[VI,WI,jI],Object.getOwnPropertyDescriptor(YI.prototype,"targetTexture"),YI.prototype),XI=YI))||XI)||XI)||XI)||XI));_.Camera=BM;var PM,NM,LM,FM,DM,UM,kM,zM,GM,HM,VM,WM,jM,XM,YM,qM,KM,ZM,QM,JM,$M,tB,eB,iB,rB,nB,sB,aB,oB,hB,lB,uB,cB,_B,dB,pB,fB,mB,gB,vB,yB,TB,EB,SB,bB,AB,CB,wB,RB,xB,OB,IB,MB,BB,PB,NB,LB,FB,DB,UB,kB,zB,GB,HB,VB,WB,jB,XB,YB,qB,KB,ZB,QB,JB,$B,tP,eP,iP,rP,nP,sP,aP,oP,hP,lP,uP,cP,_P,dP,pP,fP,mP,gP,vP,yP,TP,EP,SP,bP,AP,CP,wP,RP,xP,OP,IP,MP,BP=t("EventHandler",(pM=Ne("cc.ClickEvent"),fM=pi(_.Node),pM((bM=function(){function t(){l(this,"target",vM,this),l(this,"component",yM,this),l(this,"_componentId",TM,this),l(this,"handler",EM,this),l(this,"customEventData",SM,this)}t.emitEvents=function(e){for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];for(var s=0,a=e.length;s<a;s++){var o=e[s];o instanceof t&&o.emit(r)}};var e=t.prototype;return e.emit=function(t){var e=this.target;if(_.isValid(e)){this._genCompIdIfNeeded();var i=_.js._getClassById(this._componentId),r=e.getComponent(i);if(_.isValid(r)){var n=r[this.handler];"function"==typeof n&&(null!=this.customEventData&&""!==this.customEventData&&(t=t.slice()).push(this.customEventData),n.apply(r,t))}}},e._compName2Id=function(t){var e=_.js.getClassByName(t);return _.js._getClassId(e)},e._compId2Name=function(t){var e=_.js._getClassById(t);return _.js.getClassName(e)},e._genCompIdIfNeeded=function(){this._componentId||(this._componentName=this.component,this.component="")},r(t,[{key:"_componentName",get:function(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)},set:function(t){this._componentId=this._compName2Id(t)}}]),t}(),vM=u((gM=bM).prototype,"target",[fM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yM=u(gM.prototype,"component",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),TM=u(gM.prototype,"_componentId",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),EM=u(gM.prototype,"handler",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),SM=u(gM.prototype,"customEventData",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),mM=gM))||mM));_.Component.EventHandler=BP;var PP=new Cs(0,1,0),NP=new Cs,LP=new Ns,FP=(PM=Ne("cc.AmbientInfo"),NM=pi(ae),PM((zM=function(){function t(){l(this,"_skyColor",DM,this),l(this,"_skyIllum",UM,this),l(this,"_groundAlbedo",kM,this),this._resource=null}return t.prototype.activate=function(t){this._resource=t,this._resource.initialize(this)},r(t,[{key:"skyColor",set:function(t){this._skyColor.set(t),this._resource&&(this._resource.skyColor=this._skyColor)},get:function(){return this._skyColor}},{key:"skyIllum",set:function(t){this._skyIllum=t,this._resource&&(this._resource.skyIllum=this.skyIllum)},get:function(){return this._skyIllum}},{key:"groundAlbedo",set:function(t){this._groundAlbedo.set(t),this._resource&&(this._resource.groundAlbedo=this._groundAlbedo)},get:function(){return this._groundAlbedo}}]),t}(),DM=u((FM=zM).prototype,"_skyColor",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qs(51,128,204,1)}}),UM=u(FM.prototype,"_skyIllum",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Vb.SKY_ILLUM}}),kM=u(FM.prototype,"_groundAlbedo",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qs(51,51,51,255)}}),u(FM.prototype,"skyColor",[Ke],Object.getOwnPropertyDescriptor(FM.prototype,"skyColor"),FM.prototype),u(FM.prototype,"skyIllum",[Ke,NM],Object.getOwnPropertyDescriptor(FM.prototype,"skyIllum"),FM.prototype),u(FM.prototype,"groundAlbedo",[Ke],Object.getOwnPropertyDescriptor(FM.prototype,"groundAlbedo"),FM.prototype),LM=FM))||LM);_.AmbientInfo=FP;var DP=(GM=Ne("cc.SkyboxInfo"),HM=pi(cm),VM=pi(cm),GM((ZM=function(){function t(){l(this,"_envmap",XM,this),l(this,"_isRGBE",YM,this),l(this,"_enabled",qM,this),l(this,"_useIBL",KM,this),this._resource=null}return t.prototype.activate=function(t){this._resource=t,this._resource.initialize(this),this._resource.activate()},r(t,[{key:"enabled",set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=this._enabled))},get:function(){return this._enabled}},{key:"useIBL",set:function(t){this._useIBL=t,this._resource&&(this._resource.useIBL=this._useIBL)},get:function(){return this._useIBL}},{key:"envmap",set:function(t){this._envmap=t,this._resource&&(this._resource.envmap=this._envmap)},get:function(){return this._envmap}},{key:"isRGBE",set:function(t){this._isRGBE=t,this._resource&&(this._resource.isRGBE=this._isRGBE)},get:function(){return this._isRGBE}}]),t}(),XM=u((jM=ZM).prototype,"_envmap",[HM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),YM=u(jM.prototype,"_isRGBE",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),qM=u(jM.prototype,"_enabled",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),KM=u(jM.prototype,"_useIBL",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),u(jM.prototype,"enabled",[Ke],Object.getOwnPropertyDescriptor(jM.prototype,"enabled"),jM.prototype),u(jM.prototype,"useIBL",[Ke],Object.getOwnPropertyDescriptor(jM.prototype,"useIBL"),jM.prototype),u(jM.prototype,"envmap",[Ke,VM],Object.getOwnPropertyDescriptor(jM.prototype,"envmap"),jM.prototype),u(jM.prototype,"isRGBE",[Ke],Object.getOwnPropertyDescriptor(jM.prototype,"isRGBE"),jM.prototype),WM=jM))||WM);_.SkyboxInfo=DP;var UP=(QM=Ne("cc.FogInfo"),JM=pi(kb),$M=Ze(),tB=pi(ae),eB=ti(),iB=ri(),rB=si(),nB=Ze(),sB=pi(ae),aB=ri(),oB=si(),hB=Ze(),lB=pi(ae),uB=ri(),cB=si(),_B=Ze(),dB=pi(ae),pB=ei(),fB=ri(),mB=si(),gB=Ze(),vB=pi(ae),yB=ri(),TB=si(),EB=Ze(),SB=pi(ae),bB=ri(),AB=si(),QM((DB=FB=function(){function t(){l(this,"_type",RB,this),l(this,"_fogColor",xB,this),l(this,"_enabled",OB,this),l(this,"_fogDensity",IB,this),l(this,"_fogStart",MB,this),l(this,"_fogEnd",BB,this),l(this,"_fogAtten",PB,this),l(this,"_fogTop",NB,this),l(this,"_fogRange",LB,this),this._resource=null}return t.prototype.activate=function(t){this._resource=t,this._resource.initialize(this),this._resource.activate()},r(t,[{key:"enabled",set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=t,t&&(this._resource.type=this._type)))},get:function(){return this._enabled}},{key:"fogColor",set:function(t){this._fogColor.set(t),this._resource&&(this._resource.fogColor=this._fogColor)},get:function(){return this._fogColor}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this._resource&&(this._resource.type=t)}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(t){this._fogDensity=t,this._resource&&(this._resource.fogDensity=t)}},{key:"fogStart",get:function(){return this._fogStart},set:function(t){this._fogStart=t,this._resource&&(this._resource.fogStart=t)}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(t){this._fogEnd=t,this._resource&&(this._resource.fogEnd=t)}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(t){this._fogAtten=t,this._resource&&(this._resource.fogAtten=t)}},{key:"fogTop",get:function(){return this._fogTop},set:function(t){this._fogTop=t,this._resource&&(this._resource.fogTop=t)}},{key:"fogRange",get:function(){return this._fogRange},set:function(t){this._fogRange=t,this._resource&&(this._resource.fogRange=t)}}]),t}(),FB.FogType=kb,RB=u((wB=DB).prototype,"_type",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return kb.LINEAR}}),xB=u(wB.prototype,"_fogColor",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qs("#C8C8C8")}}),OB=u(wB.prototype,"_enabled",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),IB=u(wB.prototype,"_fogDensity",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),MB=u(wB.prototype,"_fogStart",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),BB=u(wB.prototype,"_fogEnd",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),PB=u(wB.prototype,"_fogAtten",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),NB=u(wB.prototype,"_fogTop",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),LB=u(wB.prototype,"_fogRange",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),u(wB.prototype,"enabled",[Ke],Object.getOwnPropertyDescriptor(wB.prototype,"enabled"),wB.prototype),u(wB.prototype,"fogColor",[Ke],Object.getOwnPropertyDescriptor(wB.prototype,"fogColor"),wB.prototype),u(wB.prototype,"type",[Ke,JM],Object.getOwnPropertyDescriptor(wB.prototype,"type"),wB.prototype),u(wB.prototype,"fogDensity",[$M,tB,eB,iB,ni,rB],Object.getOwnPropertyDescriptor(wB.prototype,"fogDensity"),wB.prototype),u(wB.prototype,"fogStart",[nB,sB,aB,oB],Object.getOwnPropertyDescriptor(wB.prototype,"fogStart"),wB.prototype),u(wB.prototype,"fogEnd",[hB,lB,uB,cB],Object.getOwnPropertyDescriptor(wB.prototype,"fogEnd"),wB.prototype),u(wB.prototype,"fogAtten",[_B,dB,pB,fB,mB],Object.getOwnPropertyDescriptor(wB.prototype,"fogAtten"),wB.prototype),u(wB.prototype,"fogTop",[gB,vB,yB,TB],Object.getOwnPropertyDescriptor(wB.prototype,"fogTop"),wB.prototype),u(wB.prototype,"fogRange",[EB,SB,bB,AB],Object.getOwnPropertyDescriptor(wB.prototype,"fogRange"),wB.prototype),CB=wB))||CB),kP=(UB=Ne("cc.ShadowsInfo"),kB=pi(OS),zB=Ze(),GB=pi(ae),HB=Ze(),VB=pi(IS),WB=Ze(),jB=pi(oe),XB=Ze(),YB=pi(ae),qB=Ze(),KB=pi(ae),ZB=Ze(),QB=pi(ae),JB=Ze(),$B=pi(se),tP=Ze(),eP=Ze(),iP=pi(ae),rP=Ze(),nP=pi(ae),sP=Ze(),UB((SP=function(){function t(){l(this,"_type",hP,this),l(this,"_enabled",lP,this),l(this,"_normal",uP,this),l(this,"_distance",cP,this),l(this,"_shadowColor",_P,this),l(this,"_autoAdapt",dP,this),l(this,"_pcf",pP,this),l(this,"_bias",fP,this),l(this,"_near",mP,this),l(this,"_far",gP,this),l(this,"_aspect",vP,this),l(this,"_orthoSize",yP,this),l(this,"_maxReceived",TP,this),l(this,"_size",EP,this),this._resource=null}var e=t.prototype;return e.setPlaneFromNode=function(t){t.getWorldRotation(LP),this.normal=Cs.transformQuat(NP,PP,LP),t.getWorldPosition(NP),this.distance=Cs.dot(this._normal,NP)},e.activate=function(t){this._resource=t,this._resource.initialize(this),this._resource.activate()},r(t,[{key:"enabled",set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=t,t&&(this._resource.type=this._type)))},get:function(){return this._enabled}},{key:"type",set:function(t){this._type=t,this._resource&&(this._resource.type=t)},get:function(){return this._type}},{key:"shadowColor",set:function(t){this._shadowColor.set(t),this._resource&&(this._resource.shadowColor=t)},get:function(){return this._shadowColor}},{key:"normal",set:function(t){Cs.copy(this._normal,t),this._resource&&(this._resource.normal=t)},get:function(){return this._normal}},{key:"distance",set:function(t){this._distance=t,this._resource&&(this._resource.distance=t)},get:function(){return this._distance}},{key:"pcf",set:function(t){this._pcf=t,this._resource&&(this._resource.pcf=t)},get:function(){return this._pcf}},{key:"autoAdapt",set:function(t){this._autoAdapt=t,this._resource&&(this._resource.autoAdapt=t)},get:function(){return this._autoAdapt}},{key:"near",set:function(t){this._near=t,this._resource&&(this._resource.near=t)},get:function(){return this._near}},{key:"far",set:function(t){this._far=t,this._resource&&(this._resource.far=t)},get:function(){return this._far}},{key:"orthoSize",set:function(t){this._orthoSize=t,this._resource&&(this._resource.orthoSize=t)},get:function(){return this._orthoSize}},{key:"maxReceived",set:function(t){this._maxReceived=t,this._resource&&(this._resource.maxReceived=t)},get:function(){return this._maxReceived}},{key:"shadowMapSize",set:function(t){this._size.set(t),this._resource&&(this._resource.size=t,this._resource.shadowMapDirty=!0)},get:function(){return this._size}},{key:"aspect",set:function(t){this._aspect=t,this._resource&&(this._resource.aspect=t)},get:function(){return this._aspect}},{key:"bias",set:function(t){this._bias=t,this._resource&&(this._resource.bias=t)},get:function(){return this._bias}}]),t}(),hP=u((oP=SP).prototype,"_type",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return OS.Planar}}),lP=u(oP.prototype,"_enabled",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),uP=u(oP.prototype,"_normal",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cs(0,1,0)}}),cP=u(oP.prototype,"_distance",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_P=u(oP.prototype,"_shadowColor",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qs(0,0,0,76)}}),dP=u(oP.prototype,"_autoAdapt",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),pP=u(oP.prototype,"_pcf",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return IS.HARD}}),fP=u(oP.prototype,"_bias",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e-5}}),mP=u(oP.prototype,"_near",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),gP=u(oP.prototype,"_far",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),vP=u(oP.prototype,"_aspect",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),yP=u(oP.prototype,"_orthoSize",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),TP=u(oP.prototype,"_maxReceived",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),EP=u(oP.prototype,"_size",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Es(512,512)}}),u(oP.prototype,"enabled",[Ke],Object.getOwnPropertyDescriptor(oP.prototype,"enabled"),oP.prototype),u(oP.prototype,"type",[Ke,kB],Object.getOwnPropertyDescriptor(oP.prototype,"type"),oP.prototype),u(oP.prototype,"shadowColor",[Ke],Object.getOwnPropertyDescriptor(oP.prototype,"shadowColor"),oP.prototype),u(oP.prototype,"normal",[zB],Object.getOwnPropertyDescriptor(oP.prototype,"normal"),oP.prototype),u(oP.prototype,"distance",[GB,HB],Object.getOwnPropertyDescriptor(oP.prototype,"distance"),oP.prototype),u(oP.prototype,"pcf",[VB,WB],Object.getOwnPropertyDescriptor(oP.prototype,"pcf"),oP.prototype),u(oP.prototype,"autoAdapt",[jB,XB],Object.getOwnPropertyDescriptor(oP.prototype,"autoAdapt"),oP.prototype),u(oP.prototype,"near",[YB,qB],Object.getOwnPropertyDescriptor(oP.prototype,"near"),oP.prototype),u(oP.prototype,"far",[KB,ZB],Object.getOwnPropertyDescriptor(oP.prototype,"far"),oP.prototype),u(oP.prototype,"orthoSize",[QB,JB],Object.getOwnPropertyDescriptor(oP.prototype,"orthoSize"),oP.prototype),u(oP.prototype,"maxReceived",[$B,tP],Object.getOwnPropertyDescriptor(oP.prototype,"maxReceived"),oP.prototype),u(oP.prototype,"shadowMapSize",[eP],Object.getOwnPropertyDescriptor(oP.prototype,"shadowMapSize"),oP.prototype),u(oP.prototype,"aspect",[iP,rP],Object.getOwnPropertyDescriptor(oP.prototype,"aspect"),oP.prototype),u(oP.prototype,"bias",[nP,sP],Object.getOwnPropertyDescriptor(oP.prototype,"bias"),oP.prototype),aP=oP))||aP);_.ShadowsInfo=kP;var zP,GP,HP,VP,WP=(bP=Ne("cc.SceneGlobals"),AP=pi(DP),bP((MP=function(){function t(){l(this,"ambient",RP,this),l(this,"shadows",xP,this),l(this,"_skybox",OP,this),l(this,"fog",IP,this)}return t.prototype.activate=function(){var t=_.director.root.pipeline;this.ambient.activate(t.ambient),this.skybox.activate(t.skybox),this.shadows.activate(t.shadows),this.fog.activate(t.fog)},r(t,[{key:"skybox",get:function(){return this._skybox},set:function(t){this._skybox=t}}]),t}(),RP=u((wP=MP).prototype,"ambient",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new FP}}),xP=u(wP.prototype,"shadows",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kP}}),OP=u(wP.prototype,"_skybox",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new DP}}),IP=u(wP.prototype,"fog",[Ke,ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new UP}}),u(wP.prototype,"skybox",[Ke,AP],Object.getOwnPropertyDescriptor(wP.prototype,"skybox"),wP.prototype),CP=wP))||CP);_.SceneGlobals=WP;var jP,XP=t("Scene",Ne("cc.Scene")((u((GP=function(t){function e(e){var i;return l(i=t.call(this,e)||this,"autoReleaseAssets",HP,a(i)),l(i,"_globals",VP,a(i)),i._renderScene=null,i.dependAssets=null,i._inited=void 0,i._prefabSyncedInLiveReload=!1,i._pos=Cs.ZERO,i._rot=Ns.IDENTITY,i._scale=Cs.ONE,i._mat=Hs.IDENTITY,i._dirtyFlags=0,i._activeInHierarchy=!1,_.director&&_.director.root&&(i._renderScene=_.director.root.createScene({})),i._inited=!_.game||!_.game._isCloning,i}s(e,t),r(e,[{key:"renderScene",get:function(){return this._renderScene}},{key:"globals",get:function(){return this._globals}}]);var i=e.prototype;return i.destroy=function(){var t=Xi.prototype.destroy.call(this);if(t)for(var e=this._children,i=0;i<e.length;++i)e[i].active=!1;return _.director.root.destroyScene(this._renderScene),this._active=!1,this._activeInHierarchy=!1,t},i.addComponent=function(){throw new Error(F(3822))},i._onHierarchyChanged=function(){},i._onBatchCreated=function(){t.prototype._onBatchCreated.call(this);for(var e=this._children.length,i=0;i<e;++i)this._children[i]._onBatchCreated()},i._onBatchRestored=function(){this._onBatchCreated()},i.getPosition=function(t){return Cs.copy(t||new Cs,Cs.ZERO)},i.getRotation=function(t){return Ns.copy(t||new Ns,Ns.IDENTITY)},i.getScale=function(t){return Cs.copy(t||new Cs,Cs.ONE)},i.getWorldPosition=function(t){return Cs.copy(t||new Cs,Cs.ZERO)},i.getWorldRotation=function(t){return Ns.copy(t||new Ns,Ns.IDENTITY)},i.getWorldScale=function(t){return Cs.copy(t||new Cs,Cs.ONE)},i.getWorldMatrix=function(t){return Hs.copy(t||new Hs,Hs.IDENTITY)},i.getWorldRS=function(t){return Hs.copy(t||new Hs,Hs.IDENTITY)},i.getWorldRT=function(t){return Hs.copy(t||new Hs,Hs.IDENTITY)},i.updateWorldTransform=function(){},i._instantiate=function(){},i._load=function(){this._inited||(this._onBatchCreated(),this._inited=!0),this.walk(Zv._setScene)},i._activate=function(t){t=!1!==t,_.director._nodeActivator.activateNode(this,t),this._globals.activate()},r(e,[{key:"position",get:function(){return Cs.ZERO}},{key:"worldPosition",get:function(){return Cs.ZERO}},{key:"rotation",get:function(){return Ns.IDENTITY}},{key:"worldRotation",get:function(){return Ns.IDENTITY}},{key:"scale",get:function(){return Cs.ONE}},{key:"worldScale",get:function(){return Cs.ONE}},{key:"eulerAngles",get:function(){return Cs.ZERO}},{key:"worldMatrix",get:function(){return Hs.IDENTITY}}]),e}(Zv)).prototype,"globals",[Ke],Object.getOwnPropertyDescriptor(GP.prototype,"globals"),GP.prototype),HP=u(GP.prototype,"autoReleaseAssets",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),VP=u(GP.prototype,"_globals",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new WP}}),zP=GP))||zP);_.Scene=XP,Xi.Flags.HideInHierarchy;var YP=t("PrivateNode",Ne("cc.PrivateNode")(jP=function(t){function e(e){return t.call(this,e)||this}return s(e,t),e}(py))||jP);_.PrivateNode=YP;var qP=It.fastRemoveAt,KP=Xi.Flags.IsStartCalled,ZP=Xi.Flags.IsOnEnableCalled;function QP(t,e){for(var i=e.constructor._executionOrder,r=e._id,n=0,s=t.length-1,a=s>>>1;n<=s;a=n+s>>>1){var o=t[a],h=o.constructor._executionOrder;if(h>i)s=a-1;else if(h<i)n=a+1;else{var l=o._id;if(l>r)s=a-1;else{if(!(l<r))return a;n=a+1}}}return~n}function JP(t,e){for(var i=t.array,r=t.i+1;r<i.length;){var n=i[r];n._enabled&&n.node._activeInHierarchy?++r:(t.removeAt(r),e&&(n._objFlags&=~e))}}Xi.Flags.IsEditorOnEnableCalled;var $P=function(t){this._zero=void 0,this._neg=void 0,this._pos=void 0,this._invoke=void 0;var e=z;this._zero=new e([]),this._neg=new e([]),this._pos=new e([]),this._invoke=t};function tN(t,e){return t.constructor._executionOrder-e.constructor._executionOrder}$P.stableRemoveInactive=JP;var eN=function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;return i.add=function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).array.push(t)},i.remove=function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).fastRemove(t)},i.cancelInactive=function(t){JP(this._zero,t),JP(this._neg,t),JP(this._pos,t)},i.invoke=function(){var t=this._neg;t.array.length>0&&(t.array.sort(tN),this._invoke(t),t.array.length=0),this._invoke(this._zero),this._zero.array.length=0;var e=this._pos;e.array.length>0&&(e.array.sort(tN),this._invoke(e),e.array.length=0)},e}($P),iN=function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;return i.add=function(t){var e=t.constructor._executionOrder;if(0===e)this._zero.array.push(t);else{var i=e<0?this._neg.array:this._pos.array,r=QP(i,t);r<0&&i.splice(~r,0,t)}},i.remove=function(t){var e=t.constructor._executionOrder;if(0===e)this._zero.fastRemove(t);else{var i=e<0?this._neg:this._pos,r=QP(i.array,t);r>=0&&i.removeAt(r)}},i.invoke=function(t){this._neg.array.length>0&&this._invoke(this._neg,t),this._invoke(this._zero,t),this._pos.array.length>0&&this._invoke(this._pos,t)},e}($P);function rN(t,e,i){var r="var a=it.array;for(it.i=0;it.i<a.length;++it.i){var c=a[it.i];"+t+"}",n=e?Function("it","dt",r):Function("it",r);return function(t,e,i){return function(r,n){try{e(r,n)}catch(e){_._throw(e);var s=r.array;for(i&&(s[r.i]._objFlags|=i),++r.i;r.i<s.length;++r.i)try{t(s[r.i],n)}catch(t){_._throw(t),i&&(s[r.i]._objFlags|=i)}}}}(Function("c","dt",t),n,i)}var nN=rN("c.start();c._objFlags|="+KP,!1,KP),sN=rN("c.update(dt)",!0),aN=rN("c.lateUpdate(dt)",!0),oN=function(t){var e=_.director._compScheduler,i=t.array;for(t.i=0;t.i<i.length;++t.i){var r=i[t.i];r._enabled&&(r.onEnable(),!r.node._activeInHierarchy||e._onEnabled(r))}},hN=function(){function t(){this._deferredComps=[],this.unscheduleAll()}var e=t.prototype;return e.unscheduleAll=function(){this.startInvoker=new eN(nN),this.updateInvoker=new iN(sN),this.lateUpdateInvoker=new iN(aN),this._updating=!1},e._onEnabled=function(t){_.director.getScheduler().resumeTarget(t),t._objFlags|=ZP,this._updating?this._deferredComps.push(t):this._scheduleImmediate(t)},e._onDisabled=function(t){_.director.getScheduler().pauseTarget(t),t._objFlags&=~ZP;var e=this._deferredComps.indexOf(t);e>=0?qP(this._deferredComps,e):(!t.start||t._objFlags&KP||this.startInvoker.remove(t),t.update&&this.updateInvoker.remove(t),t.lateUpdate&&this.lateUpdateInvoker.remove(t))},e.enableComp=function(t,e){if(!(t._objFlags&ZP)){if(t.onEnable){if(e)return void e.add(t);if(t.onEnable(),!t.node._activeInHierarchy)return}this._onEnabled(t)}},e.disableComp=function(t){t._objFlags&ZP&&(t.onDisable&&t.onDisable(),this._onDisabled(t))},e.startPhase=function(){this._updating=!0,this.startInvoker.invoke(),this._startForNewComps()},e.updatePhase=function(t){this.updateInvoker.invoke(t)},e.lateUpdatePhase=function(t){this.lateUpdateInvoker.invoke(t),this._updating=!1,this._startForNewComps()},e._startForNewComps=function(){this._deferredComps.length>0&&(this._deferredSchedule(),this.startInvoker.invoke())},e._scheduleImmediate=function(t){"function"!=typeof t.start||t._objFlags&KP||this.startInvoker.add(t),"function"==typeof t.update&&this.updateInvoker.add(t),"function"==typeof t.lateUpdate&&this.lateUpdateInvoker.add(t)},e._deferredSchedule=function(){for(var t=this._deferredComps,e=0,i=t.length;e<i;e++)this._scheduleImmediate(t[e]);t.length=0},t}(),lN=Xi.Flags.IsPreloadStarted,uN=Xi.Flags.IsOnLoadStarted,cN=Xi.Flags.IsOnLoadCalled,_N=Xi.Flags.Deactivating,dN=function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;return i.add=function(t){this._zero.array.push(t)},i.remove=function(t){this._zero.fastRemove(t)},i.cancelInactive=function(t){$P.stableRemoveInactive(this._zero,t)},i.invoke=function(){this._invoke(this._zero),this._zero.array.length=0},e}($P),pN=rN("c.__preload();"),fN=rN("c.onLoad();c._objFlags|="+cN,!1,cN),mN=new Ot(4);function gN(t,e,i){e?t._removeComponent(e):It.removeAt(t._components,i)}mN.get=function(){var t=this._get()||{preload:new dN(pN),onLoad:new eN(fN),onEnable:new eN(oN)};t.preload._zero.i=-1;var e=t.onLoad;return e._zero.i=-1,e._neg.i=-1,e._pos.i=-1,(e=t.onEnable)._zero.i=-1,e._neg.i=-1,e._pos.i=-1,t};var vN,yN,TN,EN,SN,bN,AN,CN,wN,RN,xN,ON,IN,MN,BN,PN,NN,LN,FN,DN,UN,kN,zN,GN,HN,VN,WN,jN,XN,YN,qN,KN,ZN,QN,JN,$N,tL,eL,iL,rL=t("NodeActivator",function(){function t(){this.resetComp=void 0,this.reset()}var e=t.prototype;return e.reset=function(){this._activatingStack=[]},e.activateNode=function(t,e){if(e){var i=mN.get();this._activatingStack.push(i),this._activateNodeRecursively(t,i.preload,i.onLoad,i.onEnable),i.preload.invoke(),i.onLoad.invoke(),i.onEnable.invoke(),this._activatingStack.pop(),mN.put(i)}else{this._deactivateNodeRecursively(t);for(var r,n=h(this._activatingStack);!(r=n()).done;){var s=r.value;s.preload.cancelInactive(lN),s.onLoad.cancelInactive(uN),s.onEnable.cancelInactive()}}t.emit("active-in-hierarchy-changed",t)},e.activateComp=function(t,e,i,r){if(qi(t,!0)&&(t._objFlags&lN||(t._objFlags|=lN,t.__preload&&(e?e.add(t):t.__preload())),t._objFlags&uN||(t._objFlags|=uN,t.onLoad?i?i.add(t):(t.onLoad(),t._objFlags|=cN):t._objFlags|=cN),t._enabled)){if(!t.node._activeInHierarchy)return;_.director._compScheduler.enableComp(t,r)}},e.destroyComp=function(t){_.director._compScheduler.disableComp(t),t.onDestroy&&t._objFlags&cN&&t.onDestroy()},e._activateNodeRecursively=function(t,e,i,r){if(t._objFlags&_N)B(3816,t.name);else{t._activeInHierarchy=!0;for(var n=t._components.length,s=0;s<n;++s){var a=t._components[s];a instanceof _.Component?this.activateComp(a,e,i,r):(gN(t,a,s),--s,--n)}t._childArrivalOrder=t._children.length;for(var o=0,h=t._children.length;o<h;++o){var l=t._children[o];l._active&&this._activateNodeRecursively(l,e,i,r)}t._onPostActivated(!0)}},e._deactivateNodeRecursively=function(t){t._objFlags|=_N,t._activeInHierarchy=!1;for(var e=t._components.length,i=0;i<e;++i){var r=t._components[i];if(r._enabled&&(_.director._compScheduler.disableComp(r),t._activeInHierarchy))return void(t._objFlags&=~_N)}for(var n=0,s=t._children.length;n<s;++n){var a=t._children[n];if(a._activeInHierarchy&&(this._deactivateNodeRecursively(a),t._activeInHierarchy))return void(t._objFlags&=~_N)}t._onPostActivated(!1),t._objFlags&=~_N},t}());$s(Zv.prototype,"BaseNode",[{name:"childrenCount",newName:"children.length",customGetter:function(){return this.children.length}}]),$s(py.prototype,"Node",[{name:"width",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.width},customSetter:function(t){this._uiProps.uiTransformComp.width=t}},{name:"height",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.height},customSetter:function(t){this._uiProps.uiTransformComp.height=t}},{name:"anchorX",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.anchorX},customSetter:function(t){this._uiProps.uiTransformComp.anchorX=t}},{name:"anchorY",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.anchorY},customSetter:function(t){this._uiProps.uiTransformComp.anchorY=t}},{name:"getAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(t){return t||(t=new Es),t.set(this._uiProps.uiTransformComp.anchorPoint),t}},{name:"setAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(t,e){this._uiProps.uiTransformComp.setAnchorPoint(t,e)}},{name:"getContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(t){return t||(t=new Ys),t.set(this._uiProps.uiTransformComp.contentSize),t}},{name:"setContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(t,e){this._uiProps.uiTransformComp.setContentSize(t,e)}}]),ta(py.prototype,"Node.prototype",[{name:"addLayer"},{name:"removeLayer"}]),ta(vp,"Layers",[{name:"All"},{name:"RaycastMask"},{name:"check"}]),$s(vp,"Layers",[{name:"Default",newName:"DEFAULT",target:vp.Enum,targetName:"Layers.Enum"},{name:"Always",newName:"ALWAYS",target:vp.Enum,targetName:"Layers.Enum"},{name:"IgnoreRaycast",newName:"IGNORE_RAYCAST",target:vp.Enum,targetName:"Layers.Enum"},{name:"Gizmos",newName:"GIZMOS",target:vp.Enum,targetName:"Layers.Enum"},{name:"Editor",newName:"EDITOR",target:vp.Enum,targetName:"Layers.Enum"},{name:"UI",newName:"UI_3D",target:vp.Enum,targetName:"Layers.Enum"},{name:"UI2D",newName:"UI_2D",target:vp.Enum,targetName:"Layers.Enum"},{name:"SceneGizmo",newName:"SCENE_GIZMO",target:vp.Enum,targetName:"Layers.Enum"},{name:"makeInclusiveMask",newName:"makeMaskInclude",target:vp,targetName:"Layers"},{name:"makeExclusiveMask",newName:"makeMaskExclude",target:vp,targetName:"Layers"}]),ta(vp.Enum,"Layers.Enum",[{name:"ALWAYS"}]),ta(vp.BitMask,"Layers.BitMask",[{name:"ALWAYS"}]);var nL,sL,aL=new Cs;function oL(t){return t instanceof XP?NO:t._uiProps.uiTransformComp?t._uiProps.uiTransformComp.contentSize:Ys.ZERO}function hL(t,e,i,r){for(var n=t.parent?t.parent.getScale():aL,s=n.x,a=n.y,o=0,h=0,l=t.parent;;){if(!l)return i.x=i.y=0,void(r.x=r.y=1);var u=l.getPosition();if(o+=u.x,h+=u.y,(l=l.parent)===e)break;var c=(n=l?l.getScale():aL).x,_=n.y;o*=c,h*=_,s*=c,a*=_}r.x=0!==s?1/s:1,r.y=0!==a?1/a:1,i.x=-o,i.y=-h}!function(t){t[t.ONCE=0]="ONCE",t[t.ALWAYS=1]="ALWAYS",t[t.ON_WINDOW_RESIZE=2]="ON_WINDOW_RESIZE"}(nL||(nL={})),Ft(nL),function(t){t[t.TOP=1]="TOP",t[t.MID=2]="MID",t[t.BOT=4]="BOT",t[t.LEFT=8]="LEFT",t[t.CENTER=16]="CENTER",t[t.RIGHT=32]="RIGHT",t[t.HORIZONTAL=56]="HORIZONTAL",t[t.VERTICAL=7]="VERTICAL"}(sL||(sL={}));var lL,uL,cL,_L,dL,pL,fL,mL,gL,vL,yL,TL,EL,SL,bL,AL,CL,wL,RL,xL,OL,IL,ML=sL.TOP|sL.BOT,BL=sL.LEFT|sL.RIGHT,PL=function(e){return t({Widget:e,WidgetComponent:e}),e}((vN=Ne("cc.Widget"),yN=qe(),TN=Fe(110),EN=We(),SN=Le(Vg),bN=pi(py),AN=$e(),CN=$e(),wN=$e(),RN=$e(),xN=$e(),ON=$e(),IN=$e(),MN=Ze(),BN=Ze(),PN=pi(nL),NN=$e(),vN(LN=yN(LN=TN(LN=EN(LN=SN(LN=Ve((iL=eL=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._lastPos=new Cs,e._lastSize=new Ys,e._dirty=!0,l(e,"_alignFlags",DN,a(e)),l(e,"_target",UN,a(e)),l(e,"_left",kN,a(e)),l(e,"_right",zN,a(e)),l(e,"_top",GN,a(e)),l(e,"_bottom",HN,a(e)),l(e,"_horizontalCenter",VN,a(e)),l(e,"_verticalCenter",WN,a(e)),l(e,"_isAbsLeft",jN,a(e)),l(e,"_isAbsRight",XN,a(e)),l(e,"_isAbsTop",YN,a(e)),l(e,"_isAbsBottom",qN,a(e)),l(e,"_isAbsHorizontalCenter",KN,a(e)),l(e,"_isAbsVerticalCenter",ZN,a(e)),l(e,"_originalWidth",QN,a(e)),l(e,"_originalHeight",JN,a(e)),l(e,"_alignMode",$N,a(e)),l(e,"_lockFlags",tL,a(e)),e}s(e,t);var i=e.prototype;return i.updateAlignment=function(){_._widgetManager.updateAlignment(this.node)},i._validateTargetInDEV=function(){},i.setDirty=function(){this._recursiveDirty()},i.onEnable=function(){this.node.getPosition(this._lastPos),this._lastSize.set(this.node._uiProps.uiTransformComp.contentSize),_._widgetManager.add(this),this._registerEvent(),this._registerTargetEvents()},i.onDisable=function(){_._widgetManager.remove(this),this._unregisterEvent(),this._unregisterTargetEvents()},i.onDestroy=function(){this._removeParentEvent()},i._adjustWidgetToAllowMovingInEditor=function(){},i._adjustWidgetToAllowResizingInEditor=function(){},i._adjustWidgetToAnchorChanged=function(){this.setDirty()},i._adjustTargetToParentChanged=function(t){t&&this._unregisterOldParentEvents(t),this.node.getParent()&&this._registerTargetEvents()},i._registerEvent=function(){this.node.on(gg.ANCHOR_CHANGED,this._adjustWidgetToAnchorChanged,this),this.node.on(gg.PARENT_CHANGED,this._adjustTargetToParentChanged,this)},i._unregisterEvent=function(){this.node.off(gg.ANCHOR_CHANGED,this._adjustWidgetToAnchorChanged,this)},i._removeParentEvent=function(){this.node.off(gg.PARENT_CHANGED,this._adjustTargetToParentChanged,this)},i._autoChangedValue=function(t,e){if((this._alignFlags&t)>0){var i=this.node.parent&&this.node.parent._uiProps,r=i&&i.uiTransformComp,n=r?r.contentSize:NO;this.isAlignLeft&&t===sL.LEFT?this._left=e?this._left*n.width:this._left/n.width:this.isAlignRight&&t===sL.RIGHT?this._right=e?this._right*n.width:this._right/n.width:this.isAlignHorizontalCenter&&t===sL.CENTER?this._horizontalCenter=e?this._horizontalCenter*n.width:this._horizontalCenter/n.width:this.isAlignTop&&t===sL.TOP?this._top=e?this._top*n.height:this._top/n.height:this.isAlignBottom&&t===sL.BOT?this._bottom=e?this._bottom*n.height:this._bottom/n.height:this.isAbsoluteVerticalCenter&&t===sL.MID&&(this._verticalCenter=this._verticalCenter/n.height),this._recursiveDirty()}},i._registerTargetEvents=function(){var t=this._target||this.node.parent;t&&t.getComponent(Vg)&&(t.on(gg.TRANSFORM_CHANGED,this._targetChangedOperation,this),t.on(gg.SIZE_CHANGED,this._targetChangedOperation,this))},i._unregisterTargetEvents=function(){var t=this._target||this.node.parent;t&&(t.off(gg.TRANSFORM_CHANGED,this._targetChangedOperation,this),t.off(gg.SIZE_CHANGED,this._targetChangedOperation,this))},i._unregisterOldParentEvents=function(t){var e=this._target||t;e&&(e.off(gg.TRANSFORM_CHANGED,this._targetChangedOperation,this),e.off(gg.SIZE_CHANGED,this._targetChangedOperation,this))},i._targetChangedOperation=function(){this.alignMode===nL.ALWAYS&&this._recursiveDirty()},i._setAlign=function(t,e){if(e!==(this._alignFlags&t)>0){var i=(t&BL)>0,r=this.node._uiProps.uiTransformComp;e?(this._alignFlags|=t,i?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=r.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=r.height))):(i?this.isStretchWidth&&(r.width=this._originalWidth):this.isStretchHeight&&(r.height=this._originalHeight),this._alignFlags&=~t)}},i._recursiveDirty=function(){this._dirty||(this._dirty=!0)},r(e,[{key:"target",get:function(){return this._target},set:function(t){this._target!==t&&(this._unregisterTargetEvents(),this._target=t,this._registerTargetEvents(),this._validateTargetInDEV(),this._recursiveDirty())}},{key:"isAlignTop",get:function(){return(this._alignFlags&sL.TOP)>0},set:function(t){this._setAlign(sL.TOP,t),this._recursiveDirty()}},{key:"isAlignBottom",get:function(){return(this._alignFlags&sL.BOT)>0},set:function(t){this._setAlign(sL.BOT,t),this._recursiveDirty()}},{key:"isAlignLeft",get:function(){return(this._alignFlags&sL.LEFT)>0},set:function(t){this._setAlign(sL.LEFT,t),this._recursiveDirty()}},{key:"isAlignRight",get:function(){return(this._alignFlags&sL.RIGHT)>0},set:function(t){this._setAlign(sL.RIGHT,t),this._recursiveDirty()}},{key:"isAlignVerticalCenter",get:function(){return(this._alignFlags&sL.MID)>0},set:function(t){t?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=sL.MID):this._alignFlags&=~sL.MID,this._recursiveDirty()}},{key:"isAlignHorizontalCenter",get:function(){return(this._alignFlags&sL.CENTER)>0},set:function(t){t?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=sL.CENTER):this._alignFlags&=~sL.CENTER,this._recursiveDirty()}},{key:"isStretchWidth",get:function(){return(this._alignFlags&BL)===BL}},{key:"isStretchHeight",get:function(){return(this._alignFlags&ML)===ML}},{key:"top",get:function(){return this._top},set:function(t){this._top=t,this._recursiveDirty()}},{key:"editorTop",get:function(){return this._isAbsTop?this._top:100*this._top},set:function(t){this._top=this._isAbsTop?t:t/100,this._recursiveDirty()}},{key:"bottom",get:function(){return this._bottom},set:function(t){this._bottom=t,this._recursiveDirty()}},{key:"editorBottom",get:function(){return this._isAbsBottom?this._bottom:100*this._bottom},set:function(t){this._bottom=this._isAbsBottom?t:t/100,this._recursiveDirty()}},{key:"left",get:function(){return this._left},set:function(t){this._left=t,this._recursiveDirty()}},{key:"editorLeft",get:function(){return this._isAbsLeft?this._left:100*this._left},set:function(t){this._left=this._isAbsLeft?t:t/100,this._recursiveDirty()}},{key:"right",get:function(){return this._right},set:function(t){this._right=t,this._recursiveDirty()}},{key:"editorRight",get:function(){return this._isAbsRight?this._right:100*this._right},set:function(t){this._right=this._isAbsRight?t:t/100,this._recursiveDirty()}},{key:"horizontalCenter",get:function(){return this._horizontalCenter},set:function(t){this._horizontalCenter=t,this._recursiveDirty()}},{key:"editorHorizontalCenter",get:function(){return this._isAbsHorizontalCenter?this._horizontalCenter:100*this._horizontalCenter},set:function(t){this._horizontalCenter=this._isAbsHorizontalCenter?t:t/100,this._recursiveDirty()}},{key:"verticalCenter",get:function(){return this._verticalCenter},set:function(t){this._verticalCenter=t,this._recursiveDirty()}},{key:"editorVerticalCenter",get:function(){return this._isAbsVerticalCenter?this._verticalCenter:100*this._verticalCenter},set:function(t){this._verticalCenter=this._isAbsVerticalCenter?t:t/100,this._recursiveDirty()}},{key:"isAbsoluteTop",get:function(){return this._isAbsTop},set:function(t){this._isAbsTop!==t&&(this._isAbsTop=t,this._autoChangedValue(sL.TOP,this._isAbsTop))}},{key:"isAbsoluteBottom",get:function(){return this._isAbsBottom},set:function(t){this._isAbsBottom!==t&&(this._isAbsBottom=t,this._autoChangedValue(sL.BOT,this._isAbsBottom))}},{key:"isAbsoluteLeft",get:function(){return this._isAbsLeft},set:function(t){this._isAbsLeft!==t&&(this._isAbsLeft=t,this._autoChangedValue(sL.LEFT,this._isAbsLeft))}},{key:"isAbsoluteRight",get:function(){return this._isAbsRight},set:function(t){this._isAbsRight!==t&&(this._isAbsRight=t,this._autoChangedValue(sL.RIGHT,this._isAbsRight))}},{key:"isAbsoluteHorizontalCenter",get:function(){return this._isAbsHorizontalCenter},set:function(t){this._isAbsHorizontalCenter!==t&&(this._isAbsHorizontalCenter=t,this._autoChangedValue(sL.CENTER,this._isAbsHorizontalCenter))}},{key:"isAbsoluteVerticalCenter",get:function(){return this._isAbsVerticalCenter},set:function(t){this._isAbsVerticalCenter!==t&&(this._isAbsVerticalCenter=t,this._autoChangedValue(sL.MID,this._isAbsVerticalCenter))}},{key:"alignMode",get:function(){return this._alignMode},set:function(t){this._alignMode=t,this._recursiveDirty()}},{key:"alignFlags",get:function(){return this._alignFlags},set:function(t){this._alignFlags!==t&&(this._alignFlags=t,this._recursiveDirty())}}]),e}(ds),eL.AlignMode=nL,u((FN=iL).prototype,"target",[bN,AN],Object.getOwnPropertyDescriptor(FN.prototype,"target"),FN.prototype),u(FN.prototype,"isAlignTop",[CN],Object.getOwnPropertyDescriptor(FN.prototype,"isAlignTop"),FN.prototype),u(FN.prototype,"isAlignBottom",[wN],Object.getOwnPropertyDescriptor(FN.prototype,"isAlignBottom"),FN.prototype),u(FN.prototype,"isAlignLeft",[RN],Object.getOwnPropertyDescriptor(FN.prototype,"isAlignLeft"),FN.prototype),u(FN.prototype,"isAlignRight",[xN],Object.getOwnPropertyDescriptor(FN.prototype,"isAlignRight"),FN.prototype),u(FN.prototype,"isAlignVerticalCenter",[ON],Object.getOwnPropertyDescriptor(FN.prototype,"isAlignVerticalCenter"),FN.prototype),u(FN.prototype,"isAlignHorizontalCenter",[IN],Object.getOwnPropertyDescriptor(FN.prototype,"isAlignHorizontalCenter"),FN.prototype),u(FN.prototype,"isStretchWidth",[MN],Object.getOwnPropertyDescriptor(FN.prototype,"isStretchWidth"),FN.prototype),u(FN.prototype,"isStretchHeight",[BN],Object.getOwnPropertyDescriptor(FN.prototype,"isStretchHeight"),FN.prototype),u(FN.prototype,"editorTop",[Ke],Object.getOwnPropertyDescriptor(FN.prototype,"editorTop"),FN.prototype),u(FN.prototype,"editorBottom",[Ke],Object.getOwnPropertyDescriptor(FN.prototype,"editorBottom"),FN.prototype),u(FN.prototype,"editorLeft",[Ke],Object.getOwnPropertyDescriptor(FN.prototype,"editorLeft"),FN.prototype),u(FN.prototype,"editorRight",[Ke],Object.getOwnPropertyDescriptor(FN.prototype,"editorRight"),FN.prototype),u(FN.prototype,"editorHorizontalCenter",[Ke],Object.getOwnPropertyDescriptor(FN.prototype,"editorHorizontalCenter"),FN.prototype),u(FN.prototype,"editorVerticalCenter",[Ke],Object.getOwnPropertyDescriptor(FN.prototype,"editorVerticalCenter"),FN.prototype),u(FN.prototype,"isAbsoluteTop",[Ke],Object.getOwnPropertyDescriptor(FN.prototype,"isAbsoluteTop"),FN.prototype),u(FN.prototype,"isAbsoluteBottom",[Ke],Object.getOwnPropertyDescriptor(FN.prototype,"isAbsoluteBottom"),FN.prototype),u(FN.prototype,"isAbsoluteLeft",[Ke],Object.getOwnPropertyDescriptor(FN.prototype,"isAbsoluteLeft"),FN.prototype),u(FN.prototype,"isAbsoluteRight",[Ke],Object.getOwnPropertyDescriptor(FN.prototype,"isAbsoluteRight"),FN.prototype),u(FN.prototype,"isAbsoluteHorizontalCenter",[Ke],Object.getOwnPropertyDescriptor(FN.prototype,"isAbsoluteHorizontalCenter"),FN.prototype),u(FN.prototype,"isAbsoluteVerticalCenter",[Ke],Object.getOwnPropertyDescriptor(FN.prototype,"isAbsoluteVerticalCenter"),FN.prototype),u(FN.prototype,"alignMode",[PN,NN],Object.getOwnPropertyDescriptor(FN.prototype,"alignMode"),FN.prototype),u(FN.prototype,"alignFlags",[Ke],Object.getOwnPropertyDescriptor(FN.prototype,"alignFlags"),FN.prototype),DN=u(FN.prototype,"_alignFlags",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),UN=u(FN.prototype,"_target",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kN=u(FN.prototype,"_left",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),zN=u(FN.prototype,"_right",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),GN=u(FN.prototype,"_top",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),HN=u(FN.prototype,"_bottom",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),VN=u(FN.prototype,"_horizontalCenter",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),WN=u(FN.prototype,"_verticalCenter",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),jN=u(FN.prototype,"_isAbsLeft",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),XN=u(FN.prototype,"_isAbsRight",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),YN=u(FN.prototype,"_isAbsTop",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),qN=u(FN.prototype,"_isAbsBottom",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),KN=u(FN.prototype,"_isAbsHorizontalCenter",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ZN=u(FN.prototype,"_isAbsVerticalCenter",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),QN=u(FN.prototype,"_originalWidth",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),JN=u(FN.prototype,"_originalHeight",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$N=u(FN.prototype,"_alignMode",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nL.ON_WINDOW_RESIZE}}),tL=u(FN.prototype,"_lockFlags",[ke,Ge],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),LN=FN))||LN)||LN)||LN)||LN)||LN)||LN));_.internal.computeInverseTransForTarget=hL,_.internal.getReadonlyNodeSize=oL;var NL,LL=new Cs,FL=Pt({SOLID_COLOR:Bl.ALL,DEPTH_ONLY:Bl.DEPTH_STENCIL,DONT_CLEAR:Bl.NONE}),DL=Pt({OVERLAY:0,INTERSPERSE:1}),UL=function(e){return t({Canvas:e,CanvasComponent:e}),e}((lL=Ne("cc.Canvas"),uL=qe(),cL=Fe(100),_L=Le(Vg),dL=We(),pL=pi(FL),fL=$e(),mL=$e(),gL=pi(DL),vL=$e(),yL=$e(),TL=pi(fg),EL=$e(),SL=pi(FL),bL=pi(DL),lL(AL=uL(AL=cL(AL=_L(AL=dL(AL=Ve(AL=De((u((CL=function(t){function e(){var e;return l(e=t.call(this)||this,"_priority",wL,a(e)),l(e,"_targetTexture",RL,a(e)),l(e,"_clearFlag",xL,a(e)),l(e,"_color",OL,a(e)),l(e,"_renderMode",IL,a(e)),e._thisOnCameraResized=void 0,e._fitDesignResolution=void 0,e._camera=null,e._pos=new Cs,e._thisOnCameraResized=e._onResizeCamera.bind(a(e)),e}s(e,t),r(e,[{key:"clearFlag",get:function(){return this._clearFlag},set:function(t){this._clearFlag=t,this._camera&&(this._camera.clearFlag=this._clearFlag)}},{key:"color",get:function(){return this._color},set:function(t){Qs.copy(this._color,t),this._camera&&(this._camera.clearColor=t)}},{key:"renderMode",get:function(){return this._renderMode},set:function(t){this._renderMode=t,this._camera&&(this._camera.priority=this._getViewPriority())}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t,this._camera&&(this._camera.priority=this._getViewPriority()),_.director.root&&_.director.root.ui&&_.director.root.ui.sortScreens()}},{key:"targetTexture",get:function(){return this._targetTexture},set:function(t){if(this._targetTexture!==t){var e=this._targetTexture;this._targetTexture=t,this._checkTargetTextureEvent(e),this._updateTargetTexture()}}},{key:"visibility",get:function(){return this._camera?this._camera.view.visibility:-1}},{key:"camera",get:function(){return this._camera}}]);var i=e.prototype;return i.__preload=function(){var t=this.getComponent(PL);t&&t.updateAlignment();var e=new py("UICamera_"+this.node.name);e.setPosition(0,0,1e3),this._camera=_.director.root.createCamera(),this._camera.initialize({name:"ui_"+this.node.name,node:e,projection:BM.ProjectionType.ORTHO,priority:this._getViewPriority(),flows:["UIFlow"]}),this._camera.fov=45,this._camera.clearFlag=this.clearFlag,this._camera.farClip=2e3,this._camera.viewport=new Ks(0,0,1,1),this.color=this._color,this._checkTargetTextureEvent(null),this._updateTargetTexture(),this.node.on(gg.TRANSFORM_CHANGED,this._thisOnCameraResized),_.director.root.ui.addScreen(this)},i.onEnable=function(){this._camera&&_.director.root.ui.renderScene.addCamera(this._camera)},i.onDisable=function(){this._camera&&_.director.root.ui.renderScene.removeCamera(this._camera)},i.onDestroy=function(){_.director.root.ui.removeScreen(this),this._camera&&_.director.root.destroyCamera(this._camera),this._targetTexture&&this._targetTexture.off("resize"),this.node.off(gg.TRANSFORM_CHANGED,this._thisOnCameraResized)},i._onResizeCamera=function(){var t=this._camera;if(t){if(this._targetTexture){var e=this._targetTexture.window;t.setFixedSize(e.width,e.height),t.orthoHeight=NO.height/2}else{var i=PO.canvas;t.resize(i.width,i.height),t.orthoHeight=PO.canvas.height/zO.getScaleY()/2}this.node.getWorldPosition(LL),t.node.setPosition(LL.x,LL.y,1e3),t.update()}},i._checkTargetTextureEvent=function(t){var e=this;t&&t.off("resize"),this._targetTexture&&this._targetTexture.on("resize",(function(t){e._camera&&e._camera.setFixedSize(t.width,t.height)}),this)},i._updateTargetTexture=function(){if(this._camera){var t=this._camera;if(this._targetTexture){var e=this._targetTexture.window;t.changeTargetWindow(e),t.orthoHeight=NO.height/2,t.isWindowSize=!1}else t.changeTargetWindow(),t.orthoHeight=PO.canvas.height/zO.getScaleY()/2,t.isWindowSize=!0}},i._getViewPriority=function(){return this._renderMode===DL.OVERLAY?this._priority|1<<30:this._priority},e}(ds)).prototype,"clearFlag",[pL,fL],Object.getOwnPropertyDescriptor(CL.prototype,"clearFlag"),CL.prototype),u(CL.prototype,"color",[mL],Object.getOwnPropertyDescriptor(CL.prototype,"color"),CL.prototype),u(CL.prototype,"renderMode",[gL,vL],Object.getOwnPropertyDescriptor(CL.prototype,"renderMode"),CL.prototype),u(CL.prototype,"priority",[yL],Object.getOwnPropertyDescriptor(CL.prototype,"priority"),CL.prototype),u(CL.prototype,"targetTexture",[TL,EL],Object.getOwnPropertyDescriptor(CL.prototype,"targetTexture"),CL.prototype),wL=u(CL.prototype,"_priority",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),RL=u(CL.prototype,"_targetTexture",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xL=u(CL.prototype,"_clearFlag",[SL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return FL.DEPTH_ONLY}}),OL=u(CL.prototype,"_color",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qs(0,0,0,255)}}),IL=u(CL.prototype,"_renderMode",[bL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return DL.OVERLAY}}),AL=CL))||AL)||AL)||AL)||AL)||AL)||AL)||AL));_.Canvas=UL;var kL,zL=t("UIComponent",Ne("cc.UIComponent")(NL=Le(Vg)(NL=Fe(110)(NL=De(NL=Ve(NL=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._lastParent=null,e}s(e,t);var i=e.prototype;return i.__preload=function(){this.node._uiProps.uiComp=this},i.onEnable=function(){},i.onDisable=function(){},i.onDestroy=function(){this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null)},i.updateAssembler=function(){},i.postUpdateAssembler=function(){},e}(ds))||NL)||NL)||NL)||NL)||NL);!function(t){t[t.DISABLED=0]="DISABLED",t[t.CLEAR=1]="CLEAR",t[t.ENTER_LEVEL=2]="ENTER_LEVEL",t[t.ENABLED=3]="ENABLED",t[t.EXIT_LEVEL=4]="EXIT_LEVEL"}(kL||(kL={}));var GL,HL,VL,WL,jL,XL,YL,qL,KL,ZL,QL,JL,$L,tF,eF,iF,rF,nF,sF,aF,oF,hF,lF,uF,cF,_F,dF,pF=t("StencilManager",function(){function t(){this.stage=kL.DISABLED,this.stageOld=kL.DISABLED,this._maskStack=[],this._stencilPattern={stencilTest:!0,func:cl.ALWAYS,stencilMask:65535,writeMask:65535,failOp:_l.KEEP,zFailOp:_l.KEEP,passOp:_l.KEEP,ref:1}}var e=t.prototype;return e.pushMask=function(t){this._maskStack.push(t)},e.clear=function(){this.stage=kL.CLEAR},e.enterLevel=function(){this.stage=kL.ENTER_LEVEL},e.enableMask=function(){this.stage=kL.ENABLED},e.exitMask=function(){0!==this._maskStack.length&&(this._maskStack.pop(),0===this._maskStack.length?this.stage=kL.DISABLED:this.stage=kL.ENABLED)},e.handleMaterial=function(t,e){if(this.stage!==this.stageOld){var i=this._stencilPattern;if(this.stage===kL.DISABLED)i.stencilTest=!1,i.func=cl.ALWAYS,i.failOp=_l.KEEP,i.stencilMask=i.writeMask=65535,i.ref=1;else if(i.stencilTest=!0,this.stage===kL.ENABLED)i.func=cl.EQUAL,i.failOp=_l.KEEP,i.stencilMask=i.ref=this.getStencilRef(),i.writeMask=this.getWriteMask();else if(this.stage===kL.CLEAR){var r=this._maskStack[this._maskStack.length-1];i.func=cl.NEVER,i.failOp=r.inverted?_l.REPLACE:_l.ZERO,i.writeMask=i.stencilMask=i.ref=this.getWriteMask()}else if(this.stage===kL.ENTER_LEVEL){var n=this._maskStack[this._maskStack.length-1];i.func=cl.NEVER,i.failOp=n.inverted?_l.ZERO:_l.REPLACE,i.writeMask=i.stencilMask=i.ref=this.getWriteMask()}this.stageOld=this.stage}return this._changed(t.passes[0],e)},e.applyStencil=function(t,e){t.overridePipelineStates({depthStencilState:{stencilTestFront:e.stencilTest,stencilFuncFront:e.func,stencilReadMaskFront:e.stencilMask,stencilWriteMaskFront:e.writeMask,stencilFailOpFront:e.failOp,stencilZFailOpFront:e.zFailOp,stencilPassOpFront:e.passOp,stencilRefFront:e.ref,stencilTestBack:e.stencilTest,stencilFuncBack:e.func,stencilReadMaskBack:e.stencilMask,stencilWriteMaskBack:e.writeMask,stencilFailOpBack:e.failOp,stencilZFailOpBack:e.zFailOp,stencilPassOpBack:e.passOp,stencilRefBack:e.ref}})},e.getWriteMask=function(){return 1<<this._maskStack.length-1},e.getExitWriteMask=function(){return 1<<this._maskStack.length},e.getStencilRef=function(){for(var t=0,e=0;e<this._maskStack.length;++e)t+=1<<e;return t},e.reset=function(){this._maskStack.length=0,this.stage=kL.DISABLED},e._changed=function(t,e){if(e)return e.stencilStage!==this.stage&&(e.stencilStage=this.stage,!0);var i=t.depthStencilState,r=this._stencilPattern;return r.stencilTest!==i.stencilTestFront||r.func!==i.stencilFuncFront||r.failOp!==i.stencilFailOpFront||r.stencilMask!==i.stencilReadMaskFront||r.writeMask!==i.stencilWriteMaskFront||r.ref!==i.stencilRefFront},r(t,[{key:"pattern",get:function(){return this._stencilPattern}}]),t}());pF.sharedManager=null,pF.sharedManager=new pF,Ft(pl),function(t){t[t.ADD_COLOR=0]="ADD_COLOR",t[t.ADD_COLOR_AND_TEXTURE=1]="ADD_COLOR_AND_TEXTURE",t[t.GRAYSCALE=2]="GRAYSCALE",t[t.USE_ALPHA_SEPARATED=3]="USE_ALPHA_SEPARATED",t[t.USE_ALPHA_SEPARATED_AND_GRAY=4]="USE_ALPHA_SEPARATED_AND_GRAY"}(dF||(dF=t("InstanceMaterialType",{})));var fF=function(e){return t({UIRenderable:e,RenderComponent:e}),e}((GL=Ne("cc.UIRenderable"),HL=Le(Vg),VL=Ze(),WL=pi(mg),jL=pi(mg),XL=si(),YL=Je(),qL=Ze(),KL=pi(pl),ZL=si(),QL=$e(),JL=Ze(),$L=pi(pl),tF=si(),eF=$e(),iF=si(),rF=$e(),GL(nF=HL(nF=De(nF=Ve((_F=cF=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"_materials",aF,a(e)),l(e,"_customMaterial",oF,a(e)),e.stencilStage=kL.DISABLED,l(e,"_srcBlendFactor",hF,a(e)),l(e,"_dstBlendFactor",lF,a(e)),l(e,"_color",uF,a(e)),e._assembler=null,e._postAssembler=null,e._renderData=null,e._renderDataFlag=!0,e._renderFlag=!0,e._delegateSrc=null,e._instanceMaterialType=dF.ADD_COLOR_AND_TEXTURE,e._blendTemplate={blendState:{targets:[{blendSrc:pl.SRC_ALPHA,blendDst:pl.ONE_MINUS_SRC_ALPHA}]}},e._lastParent=null,e._materialUniformHash=0,e}s(e,t);var i=e.prototype;return i.updateMaterial=function(){if(this._customMaterial)this.setMaterial(this._customMaterial,0);else{var t=this._updateBuiltinMaterial();this.setMaterial(t,0),this._updateBlendFunc()}},i.updateMaterialUniformHash=function(t,e){for(var i,r,n=t.passes,s="",a=!1,o=0;o<n.length;o++)if(i=n[o],e||i.rootBufferDirty){a=!0;for(var h=i.blocks,l=0;l<i.blocks.length;l++){r=h[l];for(var u=0;u<r.length;u++)s+=r[u]+","}}return a&&(this._materialUniformHash=ou(s,666)),this._materialUniformHash},i.__preload=function(){this.node._uiProps.uiComp=this,this._flushAssembler&&this._flushAssembler()},i.onEnable=function(){this.node.on(gg.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.on(gg.SIZE_CHANGED,this._nodeStateChange,this),this.updateMaterial(),this._renderFlag=this._canRender(),this.updateMaterialUniformHash(this.getMaterial(0),!0)},i.onRestore=function(){this.updateMaterial(),this._renderFlag=this._canRender(),this.updateMaterialUniformHash(this.getMaterial(0),!0)},i.onDisable=function(){this.node.off(gg.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.off(gg.SIZE_CHANGED,this._nodeStateChange,this),this._renderFlag=!1},i.onDestroy=function(){if(this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this.destroyRenderData(),this._materialInstances)for(var t=0;t<this._materialInstances.length;t++)this._materialInstances[t].destroy();this._renderData=null},i.markForUpdateRenderData=function(t){if(void 0===t&&(t=!0),this._renderFlag=this._canRender(),t&&this._renderFlag){var e=this._renderData;e&&(e.vertDirty=!0),this._renderDataFlag=t}else t||(this._renderDataFlag=t)},i.requestRenderData=function(){var t=uw.add();return this._renderData=t,t},i.destroyRenderData=function(){this._renderData&&(uw.remove(this._renderData),this._renderData=null)},i.updateAssembler=function(t){this._renderFlag&&(this._checkAndUpdateRenderData(),this._render(t))},i.postUpdateAssembler=function(t){this._renderFlag&&this._postRender(t)},i._render=function(){},i._postRender=function(){},i._checkAndUpdateRenderData=function(){this._renderDataFlag&&(this._assembler.updateRenderData(this),this._renderDataFlag=!1)},i._canRender=function(){return this.isValid&&null!==this.getMaterial(0)&&this.enabled&&(this._delegateSrc?this._delegateSrc.activeInHierarchy:this.enabledInHierarchy)&&this._color.a>0},i._postCanRender=function(){},i._updateColor=function(){this._assembler&&this._assembler.updateColor&&this._assembler.updateColor(this)},i._updateBlendFunc=function(){var t=this.getMaterial(0),e=this._blendTemplate.blendState.targets[0];if(t)return e.blendDst===this._dstBlendFactor&&e.blendSrc===this._srcBlendFactor||(t=this.material,e.blendDst=this._dstBlendFactor,e.blendSrc=this._srcBlendFactor,t.overridePipelineStates(this._blendTemplate,0)),t},i._nodeStateChange=function(){this._renderData&&this.markForUpdateRenderData();for(var t=0;t<this.node.children.length;++t){var i=this.node.children[t].getComponent(e);i&&i.markForUpdateRenderData()}},i._updateBuiltinMaterial=function(){var t;switch(this._instanceMaterialType){case dF.ADD_COLOR:t=wm.get("ui-base-material");break;case dF.GRAYSCALE:t=wm.get("ui-sprite-gray-material");break;case dF.USE_ALPHA_SEPARATED:t=wm.get("ui-sprite-alpha-sep-material");break;case dF.USE_ALPHA_SEPARATED_AND_GRAY:t=wm.get("ui-sprite-gray-alpha-sep-material");break;default:t=wm.get("ui-sprite-material")}return t},r(e,[{key:"sharedMaterials",get:function(){return this._materials},set:function(t){for(var e=0;e<t.length;e++)t[e]!==this._materials[e]&&this.setMaterial(t[e],e);if(t.length<this._materials.length){for(var i=t.length;i<this._materials.length;i++)this.setMaterial(null,i);this._materials.splice(t.length)}}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(t){this._customMaterial=t,this.updateMaterial()}},{key:"srcBlendFactor",get:function(){return this._customMaterial&&I(12001),this._srcBlendFactor},set:function(t){this._customMaterial?I(12001):this._srcBlendFactor!==t&&(this._srcBlendFactor=t,this._updateBlendFunc())}},{key:"dstBlendFactor",get:function(){return this._customMaterial&&I(12001),this._dstBlendFactor},set:function(t){this._customMaterial?I(12001):this._dstBlendFactor!==t&&(this._dstBlendFactor=t,this._updateBlendFunc())}},{key:"color",get:function(){return this._color},set:function(t){this._color.equals(t)||(this._color.set(t),this._updateColor(),this.markForUpdateRenderData())}},{key:"renderData",get:function(){return this._renderData}},{key:"delegateSrc",set:function(t){this._delegateSrc=t}},{key:"materialUniformHash",get:function(){return this._materialUniformHash}}]),e}(Kw),cF.BlendState=pl,cF.Assembler=null,cF.PostAssembler=null,aF=u((sF=_F).prototype,"_materials",[fi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),u(sF.prototype,"sharedMaterials",[fi,VL],Object.getOwnPropertyDescriptor(sF.prototype,"sharedMaterials"),sF.prototype),oF=u(sF.prototype,"_customMaterial",[WL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u(sF.prototype,"customMaterial",[jL,XL,YL],Object.getOwnPropertyDescriptor(sF.prototype,"customMaterial"),sF.prototype),u(sF.prototype,"srcBlendFactor",[qL,KL,ZL,QL],Object.getOwnPropertyDescriptor(sF.prototype,"srcBlendFactor"),sF.prototype),u(sF.prototype,"dstBlendFactor",[JL,$L,tF,eF],Object.getOwnPropertyDescriptor(sF.prototype,"dstBlendFactor"),sF.prototype),u(sF.prototype,"color",[iF,rF],Object.getOwnPropertyDescriptor(sF.prototype,"color"),sF.prototype),hF=u(sF.prototype,"_srcBlendFactor",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return pl.SRC_ALPHA}}),lF=u(sF.prototype,"_dstBlendFactor",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return pl.ONE_MINUS_SRC_ALPHA}}),uF=u(sF.prototype,"_color",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Qs.WHITE.clone()}}),nF=sF))||nF)||nF)||nF)||nF));ta(zL.prototype,"UIComponent",[{name:"_visibility"},{name:"setVisibility"}]),_.UITransformComponent=Vg,Mt.setClassAlias(Vg,"cc.UITransformComponent"),Mt.setClassAlias(fF,"cc.RenderComponent"),_.CanvasComponent=UL,Mt.setClassAlias(UL,"cc.CanvasComponent");var mF=[new hu(tl.ATTR_POSITION,il.RGB32F)],gF=[new hu(tl.ATTR_POSITION,il.RGB32F),new hu(tl.ATTR_COLOR,il.RGBA32F)],vF=[new hu(tl.ATTR_POSITION,il.RGB32F),new hu(tl.ATTR_TEX_COORD,il.RG32F),new hu(tl.ATTR_COLOR,il.RGBA32F)],yF=[new hu(tl.ATTR_POSITION,il.RGB32F),new hu(tl.ATTR_TEX_COORD,il.RG32F),new hu(tl.ATTR_COLOR,il.RGBA32F),new hu(tl.ATTR_COLOR2,il.RGBA32F)];function TF(t){for(var e=0,i=0;i<t.length;i++){var r=t[i];e+=zl[r.format].count}return e}function EF(t){for(var e=0,i=0;i<t.length;i++){var r=t[i];e+=zl[r.format].size}return e}var SF=Object.freeze({__proto__:null,vfmt:mF,vfmtPosColor:gF,vfmtPosUvColor:vF,vfmtPosUvTwoColor:yF,getAttributeFormatBytes:TF,getAttributeStride:EF});t("UIVertexFormat",SF);var bF=t("MeshBuffer",function(){function t(t){this.vData=null,this.iData=null,this.byteStart=0,this.byteOffset=0,this.indicesStart=0,this.indicesOffset=0,this.vertexStart=0,this.vertexOffset=0,this.lastByteOffset=1,this._attributes=null,this._vertexBuffers=[],this._indexBuffer=null,this._iaInfo=null,this._batcher=void 0,this._dirty=!1,this._vertexFormatBytes=0,this._initVDataCount=0,this._initIDataCount=1536,this._outOfCallback=null,this._hInputAssemblers=[],this._nextFreeIAHandle=0,this._batcher=t}r(t,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}}]);var e=t.prototype;return e.initialize=function(t,e){this._outOfCallback=e;var i=TF(t);this._vertexFormatBytes=i*Float32Array.BYTES_PER_ELEMENT,this._initVDataCount=256*this._vertexFormatBytes;var r=Float32Array.BYTES_PER_ELEMENT*i;this.vertexBuffers.length||this.vertexBuffers.push(this._batcher.device.createBuffer(new Kl(rl.VERTEX|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,r,r)));var n=Uint16Array.BYTES_PER_ELEMENT;this.indexBuffer||(this._indexBuffer=this._batcher.device.createBuffer(new Kl(rl.INDEX|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,n,n))),this._attributes=t,this._iaInfo=new lu(this.attributes,this.vertexBuffers,this.indexBuffer),this._reallocBuffer()},e.request=function(t,e){void 0===t&&(t=4),void 0===e&&(e=6),this.lastByteOffset=this.byteOffset;var i=this.byteOffset+t*this._vertexFormatBytes,r=this.indicesOffset+e;if(t+this.vertexOffset>65535)return this._batcher.autoMergeBatches(),this._outOfCallback&&this._outOfCallback.call(this._batcher,t,e),!1;var n=this.vData.byteLength,s=this.iData.length;if(i>n||r>s){for(;n<i||s<r;)this._initVDataCount*=2,this._initIDataCount*=2,n=4*this._initVDataCount,s=this._initIDataCount;this._reallocBuffer()}return this.vertexOffset+=t,this.indicesOffset+=e,this.byteOffset=i,this._dirty=!0,!0},e.reset=function(){this.byteStart=0,this.byteOffset=0,this.indicesStart=0,this.indicesOffset=0,this.vertexStart=0,this.vertexOffset=0,this.lastByteOffset=0,this._nextFreeIAHandle=0,this._dirty=!1},e.destroy=function(){this._attributes=null,this.vertexBuffers[0].destroy(),this.vertexBuffers.length=0,this.indexBuffer.destroy(),this._indexBuffer=null;for(var t=0;t<this._hInputAssemblers.length;t++)Ao.free(this._hInputAssemblers[t]);this._hInputAssemblers.length=0},e.recordBatch=function(){var t=this.indicesOffset-this.indicesStart;if(!t)return 0;this._hInputAssemblers.length<=this._nextFreeIAHandle&&this._hInputAssemblers.push(Ao.alloc(this._batcher.device,this._iaInfo));var e=this._hInputAssemblers[this._nextFreeIAHandle++],i=Ao.get(e);return i.firstIndex=this.indicesStart,i.indexCount=t,e},e.uploadBuffers=function(){if(0!==this.byteOffset&&this._dirty){var t=new Float32Array(this.vData.buffer,0,this.byteOffset>>2),e=new Uint16Array(this.iData.buffer,0,this.indicesOffset);this.byteOffset>this.vertexBuffers[0].size&&this.vertexBuffers[0].resize(this.byteOffset),this.vertexBuffers[0].update(t),2*this.indicesOffset>this.indexBuffer.size&&this.indexBuffer.resize(2*this.indicesOffset),this.indexBuffer.update(e)}},e._reallocBuffer=function(){this._reallocVData(!0),this._reallocIData(!0)},e._reallocVData=function(t){var e;if(this.vData&&(e=new Uint8Array(this.vData.buffer)),this.vData=new Float32Array(this._initVDataCount),e&&t)for(var i=new Uint8Array(this.vData.buffer),r=0,n=e.length;r<n;r++)i[r]=e[r]},e._reallocIData=function(t){var e=this.iData;if(this.iData=new Uint16Array(this._initIDataCount),e&&t)for(var i=this.iData,r=0,n=e.length;r<n;r++)i[r]=e[r]},r(t,[{key:"vertexFormatBytes",get:function(){return this._vertexFormatBytes}}]),t}());bF.OPACITY_OFFSET=8,new Hs;var AF=function(t){function e(){var e;return(e=t.call(this)||this).type=XA.UI_BATCH,e}s(e,t);var i=e.prototype;return i.initialize=function(){t.prototype.initialize.call(this);var e=new CF;e.initialize(),this._subModels[0]=e;var i=Vo.get(this._handle,Uo.SUB_MODEL_ARRAY);Ro.assign(i,0,e.handle)},i.updateTransform=function(){if(this.transform){var t=this.transform;(t.hasChangedFlags||t._dirtyFlags)&&(t.updateWorldTransform(),this._transformUpdated=!0)}},i.updateUBOs=function(t){for(var e=this._subModels,i=0;i<e.length;i++)e[i].update();if(this._updateStamp=t,this._transformUpdated){if(this.transform){var r=this.transform._mat;Hs.toArray(this._localData,r,zp.MAT_WORLD_OFFSET),this._localBuffer.update(this._localData)}this._transformUpdated=!1}},i.directInitialize=function(t){this._subModels[0].directInitialize(t.material.passes,t.hInputAssembler,t.hDescriptorSet),t.useLocalData&&(this.node=this.transform=t.useLocalData,this._updateAttributesAndBinding(0))},e}(aC),CF=function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;return i.initialize=function(){this._handle=zo.alloc(),zo.set(this._handle,Lo.PRIORITY,mp.DEFAULT)},i.directInitialize=function(t,e,i){this._passes=t,this._flushPassInfo(),zo.set(this._handle,Lo.INPUT_ASSEMBLER,e),zo.set(this._handle,Lo.DESCRIPTOR_SET,i),this._inputAssembler=Ao.get(e),this._descriptorSet=bo.get(i)},i.destroy=function(){zo.free(this._handle),this._descriptorSet=null,this._inputAssembler=null,this._priority=mp.DEFAULT,this._handle=0,this._patches=null,this._subMesh=null,this._passes=null},e}(hT),wF=function(){function t(){this.bufferBatch=null,this.camera=null,this.model=null,this.material=null,this.texture=null,this.sampler=null,this.hInputAssembler=0,this.hDescriptorSet=0,this.useLocalData=null,this.isStatic=!1,this.textureHash=0,this.samplerHash=0}var e=t.prototype;return e.destroy=function(){this.hDescriptorSet&&(this.hDescriptorSet=0)},e.clear=function(){this.bufferBatch=null,this.hInputAssembler=0,this.camera=null,this.material=null,this.texture=null,this.sampler=null,this.model=null,this.isStatic=!1,this.useLocalData=null},t}(),RF=function(){function t(){this._material=null,this._pass=null,this._hDescriptorSet=0,this._refCount=0}var e=t.prototype;return e.initialize=function(t){return!!t.material&&(this._material=new mg,this._material.copy(t.material),this._pass=this._material.passes[0],this._pass.update(),this._hDescriptorSet=Do.get(this._pass.handle,Eo.DESCRIPTOR_SET),!0)},e.increase=function(){return this._refCount++,this._refCount},e.decrease=function(){return this._refCount--,0===this._refCount&&this.destroy(),this._refCount},e.destroy=function(){this._material&&(this._material.destroy(),this._material=null),this._refCount=0},r(t,[{key:"material",get:function(){return this._material}},{key:"pass",get:function(){return this._pass}},{key:"hDescriptorSet",get:function(){return this._hDescriptorSet}}]),t}(),xF=Jr.os===Jr.OS_IOS&&Jr.isBrowser&&/(iPhone OS 1[4-9])|(Version\/1[4-9][\.\d]*)|(iOS 1[4-9])/.test(window.navigator.userAgent),OF=new qu(null),IF=function(){var t=e.prototype;function e(t){var e=this;this.device=void 0,this._screens=[],this._bufferBatchPool=new Vi((function(){return new bF(e)}),128),this._drawBatchPool=void 0,this._scene=void 0,this._meshBuffers=new Map,this._meshBufferUseCount=new Map,this._uiMaterials=new Map,this._canvasMaterials=new Map,this._batches=void 0,this._doUploadBuffersCall=new Map,this._uiModelPool=null,this._modelInUse=void 0,this._emptyMaterial=new mg,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currCanvas=null,this._currMeshBuffer=null,this._currStaticRoot=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currMaterialHash=0,this._currMaterialUniformHash=0,this._parentOpacity=1,this._descriptorSetCacheMap=new Map,this._root=t,this.device=t.device,this._scene=this._root.createScene({name:"GUIScene"}),this._uiModelPool=new Hi((function(){var t=_.director.root.createModel(AF);return t.enabled=!0,t.visFlags|=vp.Enum.UI_3D,t}),2),this._modelInUse=new Wi(10),this._batches=new Wi(64),this._drawBatchPool=new Hi((function(){return new wF}),128)}return t.acquireBufferBatch=function(t){void 0===t&&(t=vF);var e=t===vF?36:EF(t);return this._currMeshBuffer&&this._currMeshBuffer.vertexFormatBytes===e||this._requireBufferBatch(t),this._currMeshBuffer},r(e,[{key:"renderScene",get:function(){return this._scene}},{key:"currBufferBatch",get:function(){return this._currMeshBuffer||(this._currMeshBuffer=this.acquireBufferBatch()),this._currMeshBuffer},set:function(t){t&&(this._currMeshBuffer=t)}},{key:"currStaticRoot",set:function(t){this._currStaticRoot=t}}]),t.initialize=function(){return!0},t.destroy=function(){for(var t=this,e=0;e<this._batches.length;e++)this._batches.array[e]&&this._batches.array[e].destroy(this);this._batches.destroy();for(var i,r=h(this._meshBuffers.keys());!(i=r()).done;){var n=i.value,s=this._meshBuffers.get(n);s&&s.forEach((function(t){return t.destroy()}))}this._drawBatchPool&&this._drawBatchPool.destroy((function(e){e.destroy(t)})),this._uiModelPool&&this._uiModelPool.destroy((function(t){t.destroy()})),this._descriptorSetCacheMap&&this._destroyDescriptorSet(),this._meshBuffers.clear(),_.director.root.destroyScene(this._scene)},t.getRenderSceneGetter=function(){return Object.getOwnPropertyDescriptor(Object.getPrototypeOf(this),"renderScene").get.bind(this)},t._getUIMaterial=function(t){if(this._uiMaterials.has(t.hash))return this._uiMaterials.get(t.hash);var e=new RF;return e.initialize({material:t}),this._uiMaterials.set(t.hash,e),e},t._removeUIMaterial=function(t){this._uiMaterials.has(t)&&0===this._uiMaterials.get(t).decrease()&&this._uiMaterials.delete(t)},t.addScreen=function(t){for(var e=this._screens,i=0;i<e.length;i++){var r=e[i];if(r.camera){var n=r.camera.view.visibility,s=this._canvasMaterials.get(n);if(s){for(var a=s.keys(),o=a.next();!o.done;)this._removeUIMaterial(o.value),o=a.next();s.clear()}}}this._screens.push(t),this._screens.sort(this._screenSort);for(var h=0;h<e.length;h++){var l=e[h];l.camera&&(l.camera.view.visibility=vp.BitMask.UI_2D|h+1,this._canvasMaterials.has(l.camera.view.visibility)||this._canvasMaterials.set(l.camera.view.visibility,new Map))}},t.getScreen=function(t){for(var e=this._screens,i=0;i<e.length;++i){var r=e[i];if(r.camera&&r.camera.view.visibility===t)return r}return null},t.removeScreen=function(t){var e=this,i=this._screens.indexOf(t);if(-1!==i){if(this._screens.splice(i,1),t.camera){for(var r=this._canvasMaterials.get(t.camera.view.visibility),n=r.keys(),s=n.next();!s.done;)this._removeUIMaterial(s.value),s=n.next();r.clear()}for(var a,o=i;o<this._screens.length;o++)(a=this._screens[o].camera)&&function(){var t=e._canvasMaterials.get(a.view.visibility);a.view.visibility=vp.BitMask.UI_2D|o+1;var i=e._canvasMaterials.get(a.view.visibility);t.forEach((function(t,e){i.set(e,t)})),t.clear()}()}},t.sortScreens=function(){this._screens.sort(this._screenSort)},t.addUploadBuffersFunc=function(t,e){this._doUploadBuffersCall.set(t,e)},t.removeUploadBuffersFunc=function(t){this._doUploadBuffersCall.delete(t)},t.update=function(){for(var t=this._screens,e=0;e<t.length;++e){var i=t[e];i.enabledInHierarchy&&(this._currCanvas=i,this._recursiveScreenNode(i.node))}for(var r=0,n=0;n<this._modelInUse.length;n++)this._scene.removeModel(this._modelInUse.get(n)),this._uiModelPool.free(this._modelInUse.get(n));if(this._modelInUse.clear(),this._batches.length)for(var s=0;s<this._batches.length;++s){var a=this._batches.array[s];if(a.model){var o=a.camera||this._scene.cameras[0];if(o){var h=o.view.visibility;a.model.visFlags=h,a.model.node.layer=h}for(var l=a.model.subModels,u=0;u<l.length;u++)l[u].priority=r++}else{var c=this._descriptorSetCacheMap.get(a.textureHash);if(c&&c.has(a.samplerHash))a.hDescriptorSet=c.get(a.samplerHash);else{this._initDescriptorSet(a);var _=bo.get(a.hDescriptorSet),d=Sp.SAMPLER_SPRITE;_.bindTexture(d,a.texture),_.bindSampler(d,a.sampler),_.update(),c?this._descriptorSetCacheMap.get(a.textureHash).set(a.samplerHash,a.hDescriptorSet):this._descriptorSetCacheMap.set(a.textureHash,new Map([[a.samplerHash,a.hDescriptorSet]]))}var p=this._uiModelPool.alloc();if(p.directInitialize(a),this._scene.addModel(p),p.subModels[0].priority=r++,a.camera){var f=a.camera.view.visibility;p.visFlags=f,null==this._canvasMaterials.get(f).get(a.material.hash)&&this._canvasMaterials.get(f).set(a.material.hash,1)}this._modelInUse.push(p)}}},t.uploadBuffers=function(){if(this._batches.length>0){for(var t,e=this._doUploadBuffersCall,i=h(e.keys());!(t=i()).done;){var r=t.value;e.get(r).call(r,this)}for(var n,s=this._meshBuffers,a=h(s.keys());!(n=a()).done;){var o=n.value,l=s.get(o);l&&l.forEach((function(t){t.uploadBuffers(),t.reset()}))}}for(var u=0;u<this._batches.length;++u){var c=this._batches.array[u];c.isStatic||(c.clear(),this._drawBatchPool.free(c))}this._parentOpacity=1,this._batches.clear(),this._currMaterial=this._emptyMaterial,this._currCanvas=null,this._currTexture=null,this._currSampler=null,this._currComponent=null,this._currTransform=null,this._meshBufferUseCount.clear(),this._currMaterialHash=0,this._currMaterialUniformHash=0,pF.sharedManager.reset()},t.commitComp=function(t,e,i,r){var n,s,a=t,o=0,h=0;e?(n=e.getGFXTexture(),s=e.getGFXSampler(),o=e.getHash(),h=e.getSamplerHash()):(n=null,s=null);var l=a.getRenderMaterial(0),u=l.hash,c=a.updateMaterialUniformHash(l);this._currMaterialHash===u&&this._currMaterialUniformHash===c&&this._currTextureHash===o&&this._currSamplerHash===h&&this._currTransform===r||(this.autoMergeBatches(this._currComponent),this._currComponent=a,this._currTransform=r,this._currMaterial=l,this._currTexture=n,this._currSampler=s,this._currTextureHash=o,this._currSamplerHash=h,this._currMaterialHash=a.getRenderMaterial(0).hash,this._currMaterialUniformHash=a.materialUniformHash),i&&(i.fillBuffers(a,this),this._applyOpacity(a))},t.commitModel=function(t,e,i){if(this._currMaterial!==this._emptyMaterial&&this.autoMergeBatches(this._currComponent),i){var r;if(r=t instanceof fF?pF.sharedManager.handleMaterial(i,t):pF.sharedManager.handleMaterial(i)){var n=pF.sharedManager.pattern;pF.sharedManager.applyStencil(i,n)}if(r&&e)for(var s=0;s<e.subModels.length;s++)e.setSubModelMaterial(s,i)}var a=this._currCanvas,o=this._drawBatchPool.alloc();o.camera=a&&a.camera,o.model=e,o.bufferBatch=null,o.material=i,o.texture=null,o.sampler=null,o.useLocalData=null,this._currMaterial=this._emptyMaterial,this._currComponent=null,this._currTransform=null,this._currTexture=null,this._currSampler=null,this._currTextureHash=0,this._currSamplerHash=0,this._currMaterialHash=0,this._currMaterialUniformHash=0,this._batches.push(o)},t.commitStaticBatch=function(t){this._batches.concat(t.drawBatchList),this.finishMergeBatches()},t.autoMergeBatches=function(t){var e=this.currBufferBatch,i=this._currCanvas,r=null==e?void 0:e.recordBatch(),n=this._currMaterial;if(r&&n){if(t){if(pF.sharedManager.handleMaterial(n,t)){this._currMaterial=n=t.material;var s=pF.sharedManager.pattern;pF.sharedManager.applyStencil(n,s)}t.updateMaterialUniformHash(n)}var a=this._currStaticRoot?this._currStaticRoot._requireDrawBatch():this._drawBatchPool.alloc();a.camera=i&&i.camera,a.bufferBatch=e,a.material=n,a.texture=this._currTexture,a.sampler=this._currSampler,a.hInputAssembler=r,a.useLocalData=this._currTransform,a.textureHash=this._currTextureHash,a.samplerHash=this._currSamplerHash,this._batches.push(a),e.vertexStart=e.vertexOffset,e.indicesStart=e.indicesOffset,e.byteStart=e.byteOffset,xF&&(this._currMeshBuffer=null)}},t.forceMergeBatches=function(t,e,i){this._currMaterial=t,e?(this._currTexture=e.getGFXTexture(),this._currSampler=e.getGFXSampler(),this._currTextureHash=e.getHash(),this._currSamplerHash=e.getSamplerHash()):(this._currTexture=this._currSampler=null,this._currTextureHash=this._currSamplerHash=0),this.autoMergeBatches(i)},t.finishMergeBatches=function(){this.autoMergeBatches(),this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currMaterialHash=0,this._currMaterialUniformHash=0},t.flushMaterial=function(t){this._currMaterial=t},t._destroyUIMaterials=function(){for(var t=this._uiMaterials.values(),e=t.next();!e.done;)e.value.destroy(),e=t.next();this._uiMaterials.clear()},t.walk=function(t,e){void 0===e&&(e=0);var i=t.children.length,r=this._parentOpacity;if(this._parentOpacity*=t._uiProps.opacity,this._preProcess(t),i>0&&!t._static)for(var n=t.children,s=0;s<n.length;++s){var a=n[s];this.walk(a,e)}this._postProcess(t),this._parentOpacity=r,e+=1},t._preProcess=function(t){if(t._uiProps.uiTransformComp){t._uiProps.uiTransformComp._canvas=this._currCanvas;var e=t._uiProps.uiComp;e&&e.enabledInHierarchy&&e.updateAssembler(this)}},t._postProcess=function(t){var e=t._uiProps.uiComp;e&&e.enabledInHierarchy&&e.postUpdateAssembler(this)},t._recursiveScreenNode=function(t){this.walk(t),this.autoMergeBatches(this._currComponent)},t._createMeshBuffer=function(t){var e=this._bufferBatchPool.add();e.initialize(t,this._requireBufferBatch.bind(this,t));var i=EF(t),r=this._meshBuffers.get(i);return r||(r=[],this._meshBuffers.set(i,r)),r.push(e),e},t._requireBufferBatch=function(t){var e=EF(t),i=this._meshBuffers.get(e);i||(i=[],this._meshBuffers.set(e,i));var r=this._meshBufferUseCount.get(e)||0;r>=i.length?this._currMeshBuffer=this._createMeshBuffer(t):this._currMeshBuffer=i[r],this._meshBufferUseCount.set(e,r+1),2===arguments.length&&this._currMeshBuffer.request(arguments[0],arguments[1])},t._screenSort=function(t,e){var i=t.priority-e.priority;return 0===i?t.node.getSiblingIndex()-e.node.getSiblingIndex():i},t._applyOpacity=function(t){for(var e=t.color.a/255,i=this._parentOpacity*=e,r=this.currBufferBatch,n=r.byteOffset>>2,s=r.vData,a=r.lastByteOffset>>2,o=r.vertexFormatBytes/4,h=a;h<n;h+=o)s[h+bF.OPACITY_OFFSET]*=i;r.lastByteOffset=r.byteOffset},t._initDescriptorSet=function(t){var e=_.director.root,i=$m.get("sprite").shaders[0].name;OF.layout=Em.getDescriptorSetLayout(e.device,i,!0),t.hDescriptorSet=bo.alloc(e.device,OF)},t._releaseDescriptorSetCache=function(t){this._descriptorSetCacheMap.has(t)&&(this._descriptorSetCacheMap.get(t).forEach((function(t){bo.free(t)})),this._descriptorSetCacheMap.delete(t))},t._destroyDescriptorSet=function(){this._descriptorSetCacheMap.forEach((function(t){t.forEach((function(t){bo.free(t)}))})),this._descriptorSetCacheMap.clear()},e}(),MF=function(){function t(){this._title="",this._width=1,this._height=1,this._nativeWidth=1,this._nativeHeight=1,this._renderPass=null,this._colorTextures=[],this._depthStencilTexture=null,this._swapchainBufferIndices=0,this._shouldSyncSizeWithSwapchain=!1,this._poolHandle=0}t.registerCreateFunc=function(e){e._createWindowFun=function(e){return new t(e)}},r(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"framebuffer",get:function(){return wo.get(oh.get(this._poolHandle,ih.FRAMEBUFFER))}},{key:"shouldSyncSizeWithSwapchain",get:function(){return this._shouldSyncSizeWithSwapchain}},{key:"hasOnScreenAttachments",get:function(){return 1===oh.get(this._poolHandle,ih.HAS_ON_SCREEN_ATTACHMENTS)}},{key:"hasOffScreenAttachments",get:function(){return 1===oh.get(this._poolHandle,ih.HAS_OFF_SCREEN_ATTACHMENTS)}},{key:"handle",get:function(){return this._poolHandle}}]);var e=t.prototype;return e.initialize=function(t,e){this._poolHandle=oh.alloc(),void 0!==e.title&&(this._title=e.title),void 0!==e.swapchainBufferIndices&&(this._swapchainBufferIndices=e.swapchainBufferIndices),void 0!==e.shouldSyncSizeWithSwapchain&&(this._shouldSyncSizeWithSwapchain=e.shouldSyncSizeWithSwapchain),this._width=e.width,this._height=e.height,this._nativeWidth=this._width,this._nativeHeight=this._height;for(var i=e.renderPassInfo,r=i.colorAttachments,n=i.depthStencilAttachment,s=0;s<r.length;s++)r[s].format===il.UNKNOWN&&(r[s].format=t.colorFormat);n&&n.format===il.UNKNOWN&&(n.format=t.depthStencilFormat),this._renderPass=t.createRenderPass(e.renderPassInfo);for(var a=0;a<r.length;a++){var o=null;this._swapchainBufferIndices&1<<a?oh.set(this._poolHandle,ih.HAS_ON_SCREEN_ATTACHMENTS,1):(o=t.createTexture(new Gu(vl.TEX2D,yl.COLOR_ATTACHMENT|yl.SAMPLED,r[a].format,this._width,this._height)),oh.set(this._poolHandle,ih.HAS_OFF_SCREEN_ATTACHMENTS,1)),this._colorTextures.push(o)}n&&(this._swapchainBufferIndices>=0?(this._depthStencilTexture=t.createTexture(new Gu(vl.TEX2D,yl.DEPTH_STENCIL_ATTACHMENT|yl.SAMPLED,n.format,this._width,this._height)),oh.set(this._poolHandle,ih.HAS_OFF_SCREEN_ATTACHMENTS,1)):oh.set(this._poolHandle,ih.HAS_ON_SCREEN_ATTACHMENTS,1));var h=wo.alloc(t,new ru(this._renderPass,this._colorTextures,this._depthStencilTexture));return oh.set(this._poolHandle,ih.FRAMEBUFFER,h),!0},e.destroy=function(){this._depthStencilTexture&&(this._depthStencilTexture.destroy(),this._depthStencilTexture=null);for(var t=0;t<this._colorTextures.length;t++){var e=this._colorTextures[t];e&&e.destroy()}this._colorTextures.length=0,this._poolHandle&&(wo.get(oh.get(this._poolHandle,ih.FRAMEBUFFER)).destroy(),this._poolHandle=0)},e.resize=function(t,e){if(this._width=t,this._height=e,t>this._nativeWidth||e>this._nativeHeight){this._nativeWidth=t,this._nativeHeight=e;var i=!1;this._depthStencilTexture&&(this._depthStencilTexture.resize(t,e),i=!0);for(var r=0;r<this._colorTextures.length;r++){var n=this._colorTextures[r];n&&(n.resize(t,e),i=!0)}var s=wo.get(oh.get(this._poolHandle,ih.FRAMEBUFFER));i&&s&&(s.destroy(),s.initialize(new ru(this._renderPass,this._colorTextures,this._depthStencilTexture)))}},t}(),BF=function(){function t(t){var e=this;this._createSceneFun=null,this._createWindowFun=null,this._device=void 0,this._windows=[],this._mainWindow=null,this._curWindow=null,this._tempWindow=null,this._pipeline=null,this._ui=null,this._dataPoolMgr=void 0,this._scenes=[],this._cameras=[],this._views=[],this._modelPools=new Map,this._cameraPool=null,this._lightPools=new Map,this._fpsTime=0,this._frameCount=0,this._fps=0,this._fixedFPS=0,this._fixedFPSFrameTime=0,this._poolHandle=0,this._device=t,this._dataPoolMgr=new AM(t),CC.registerCreateFunc(this),MF.registerCreateFunc(this),this._cameraPool=new Hi((function(){return new hb(e._device)}),4)}r(t,[{key:"device",get:function(){return this._device}},{key:"mainWindow",get:function(){return this._mainWindow}},{key:"curWindow",set:function(t){this._curWindow=t},get:function(){return this._curWindow}},{key:"tempWindow",set:function(t){this._tempWindow=t},get:function(){return this._tempWindow}},{key:"windows",get:function(){return this._windows}},{key:"pipeline",get:function(){return this._pipeline}},{key:"ui",get:function(){return this._ui}},{key:"scenes",get:function(){return this._scenes}},{key:"cumulativeTime",get:function(){return nh.get(this._poolHandle,th.CUMULATIVE_TIME)}},{key:"frameTime",get:function(){return nh.get(this._poolHandle,th.FRAME_TIME)}},{key:"frameCount",get:function(){return this._frameCount}},{key:"fps",get:function(){return this._fps}},{key:"fixedFPS",set:function(t){t>0?(this._fixedFPS=t,this._fixedFPSFrameTime=1e3/t):this._fixedFPSFrameTime=0},get:function(){return this._fixedFPS}},{key:"dataPoolManager",get:function(){return this._dataPoolMgr}},{key:"handle",get:function(){return this._poolHandle}}]);var e=t.prototype;return e.initialize=function(){var t=this;this._poolHandle=nh.alloc();var e=new xu,i=new Ou;i.depthStoreOp=wl.DISCARD,i.stencilStoreOp=wl.DISCARD;var r=new Mu([e],i);return this._mainWindow=this.createWindow({title:"rootMainWindow",width:this._device.width,height:this._device.height,renderPassInfo:r,swapchainBufferIndices:-1}),this._curWindow=this._mainWindow,Promise.resolve(wm.initBuiltinRes(this._device)).then((function(){_.view.on("design-resolution-changed",(function(){var e=_.game.canvas.width,i=_.game.canvas.height;t.resize(e,i)}),t)}))},e.destroy=function(){this.clearCameras(),this.destroyScenes(),this._pipeline&&(this._pipeline.destroy(),this._pipeline=null),this._ui&&(this._ui.destroy(),this._ui=null),this._curWindow=null,this._mainWindow=null,this.dataPoolManager.clear(),this._poolHandle&&(nh.free(this._poolHandle),this._poolHandle=0)},e.resize=function(t,e){this._device.resize(t,e),this._mainWindow.resize(t,e);for(var i,r=h(this._windows);!(i=r()).done;){var n=i.value;n.shouldSyncSizeWithSwapchain&&n.resize(t,e)}for(var s,a=h(this._cameras);!(s=a()).done;){var o=s.value;o.isWindowSize&&o.resize(t,e)}},e.setRenderPipeline=function(t){if(t||(t=this.createDefaultPipeline()),this._pipeline=t,!this._pipeline.activate())return!1;var e=_.director.getScene();return e&&e.globals.activate(),this.onGlobalPipelineStateChanged(),!(!this._ui&&(this._ui=new IF(this),!this._ui.initialize())&&(this.destroy(),1))},e.createDefaultPipeline=function(){var t=new $A;return t.initialize({flows:[]}),t},e.onGlobalPipelineStateChanged=function(){for(var t=0;t<this._cameras.length;t++)this._cameras[t].view.onGlobalPipelineStateChanged();for(var e=0;e<this._scenes.length;e++)this._scenes[e].onGlobalPipelineStateChanged()},e.activeWindow=function(t){this._curWindow=t},e.resetCumulativeTime=function(){nh.set(this._poolHandle,th.CUMULATIVE_TIME,0)},e.frameMove=function(t){if(nh.set(this._poolHandle,th.FRAME_TIME,t),++this._frameCount,nh.set(this._poolHandle,th.CUMULATIVE_TIME,nh.get(this._poolHandle,th.CUMULATIVE_TIME)+t),this._fpsTime+=t,this._fpsTime>1&&(this._fps=this._frameCount,this._frameCount=0,this._fpsTime=0),this._ui&&this._ui.update(),this._pipeline){this._device.acquire(),this._views.length=0;var e=this._cameras,i=_.director.getTotalFrames();this._ui&&this._ui.uploadBuffers();for(var r=0;r<e.length;r++){var n=this._cameras[r],s=n.view;s.isEnable&&s.window&&(n.update(),n.scene.update(i),this._views.push(s))}this._pipeline.render(this._views),this._device.present()}},e.createWindow=function(t){var e=this._createWindowFun(this);return e.initialize(this.device,t),this._windows.push(e),e},e.destroyWindow=function(t){for(var e=0;e<this._windows.length;++e)if(this._windows[e]===t)return t.destroy(),void this._windows.splice(e,1)},e.destroyWindows=function(){for(var t,e=h(this._windows);!(t=e()).done;)t.value.destroy();this._windows=[]},e.createScene=function(t){var e=this._createSceneFun(this);return e.initialize(t),this._scenes.push(e),e},e.destroyScene=function(t){for(var e=0;e<this._scenes.length;++e)if(this._scenes[e]===t)return t.destroy(),void this._scenes.splice(e,1)},e.destroyScenes=function(){for(var t,e=h(this._scenes);!(t=e()).done;)t.value.destroy();this._scenes=[]},e.createView=function(t){var e=new iS;return e.initialize(t),e},e.attachCamera=function(t){for(var e=0;e<this._cameras.length;e++)if(this._cameras[e]===t)return;this._cameras.push(t),this.sortViews()},e.detachCamera=function(t){for(var e=0;e<this._cameras.length;++e)if(this._cameras[e]===t)return void this._cameras.splice(e,1)},e.clearCameras=function(){this._cameras.length=0},e.createModel=function(t){var e=this._modelPools.get(t);e||(this._modelPools.set(t,new Hi((function(){return new t}),10)),e=this._modelPools.get(t));var i=e.alloc();return i.initialize(),i},e.destroyModel=function(t){var e=this._modelPools.get(t.constructor);e?(e.free(t),t.destroy(),t.scene&&t.scene.removeModel(t)):console.warn("'"+t.constructor.name+"'is not in the model pool and cannot be destroyed by destroyModel.")},e.createCamera=function(){return this._cameraPool.alloc()},e.destroyCamera=function(t){this._cameraPool.free(t),t.destroy(),t.scene&&t.scene.removeCamera(t),t.isWindowSize=!0},e.createLight=function(t){var e=this._lightPools.get(t);e||(this._lightPools.set(t,new Hi((function(){return new t}),4)),e=this._lightPools.get(t));var i=e.alloc();return i.initialize(),i},e.destroyLight=function(t){var e=this._lightPools.get(t.constructor);if(t.destroy(),e&&(e.free(t),t.scene))switch(t.type){case uS.SPHERE:t.scene.removeSphereLight(t);break;case uS.SPOT:t.scene.removeSpotLight(t)}},e.sortViews=function(){this._cameras.sort((function(t,e){return t.view.priority-e.view.priority}))},t}();_.Root=BF;var PF=t("Director",function(t){function e(){var e;return(e=t.call(this)||this)._compScheduler=void 0,e._nodeActivator=void 0,e._invalid=void 0,e._paused=void 0,e._purgeDirectorInNextLoop=void 0,e._root=void 0,e._loadingScene=void 0,e._scene=void 0,e._totalFrames=void 0,e._lastUpdate=void 0,e._deltaTime=void 0,e._startTime=void 0,e._scheduler=void 0,e._systems=void 0,e._invalid=!1,e._paused=!1,e._purgeDirectorInNextLoop=!1,e._root=null,e._loadingScene="",e._scene=null,e._totalFrames=0,e._lastUpdate=0,e._deltaTime=0,e._startTime=0,e._scheduler=new tI,e._compScheduler=new hN,e._nodeActivator=new rL,e._systems=[],_.game.once(BO.EVENT_RENDERER_INITED,e._initOnRendererInitialized,a(e)),e}s(e,t);var i=e.prototype;return i.calculateDeltaTime=function(t){t||(t=performance.now()),this._deltaTime=t>this._lastUpdate?(t-this._lastUpdate)/1e3:0,this._lastUpdate=t},i.convertToGL=function(t){var e=_.game.container,i=_.view,r=e.getBoundingClientRect(),n=r.left+window.pageXOffset-e.clientLeft,s=r.top+window.pageYOffset-e.clientTop,a=i._devicePixelRatio*(t.x-n),o=i._devicePixelRatio*(s+r.height-t.y);return i._isRotated?As(i._viewportRect.width-o,a):As(a,o)},i.convertToUI=function(t){var e=_.game.container,i=_.view,r=e.getBoundingClientRect(),n=r.left+window.pageXOffset-e.clientLeft,s=r.top+window.pageYOffset-e.clientTop,a=As(0,0);return i._isRotated?(a.x=n+t.y/i._devicePixelRatio,a.y=s+r.height-(i._viewportRect.width-t.x)/i._devicePixelRatio):(a.x=n+t.x*i._devicePixelRatio,a.y=s+r.height-t.y*i._devicePixelRatio),a},i.end=function(){this._purgeDirectorInNextLoop=!0},i.getWinSize=function(){return qs(_.winSize)},i.getWinSizeInPixels=function(){return qs(_.winSize)},i.pause=function(){this._paused||(this._paused=!0)},i.purgeCachedData=function(){_.assetManager.releaseAll()},i.purgeDirector=function(){this._scheduler.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),av&&av.setEnabled(!1),_.isValid(this._scene)&&this._scene.destroy(),this._scene=null,this.stopAnimation(),_.assetManager.releaseAll()},i.reset=function(){this.purgeDirector(),this.emit(e.EVENT_RESET),av&&av.setEnabled(!0),this.startAnimation()},i.runSceneImmediate=function(t,e,i){t instanceof Lx&&(t=t.scene),L(t instanceof XP,1216),t._load();for(var r=Object.keys(_.game._persistRootNodes).map((function(t){return _.game._persistRootNodes[t]})),n=0;n<r.length;n++){var s=r[n];s.emit(_.Node.SCENE_CHANGED_FOR_PERSISTS,t.renderScene);var a=t.getChildByUuid(s.uuid);if(a){var o=a.getSiblingIndex();a._destroyImmediate(),t.insertChild(s,o)}else s.parent=t}var h=this._scene;_.isValid(h)&&h.destroy(),_.assetManager._releaseManager._autoRelease(h,t,r),this._scene=null,Xi._deferredDestroy(),e&&e(),this.emit(_.Director.EVENT_BEFORE_SCENE_LAUNCH,t),this._scene=t,t._activate(),this._root&&this._root.resetCumulativeTime(),this.startAnimation(),i&&i(null,t),this.emit(_.Director.EVENT_AFTER_SCENE_LAUNCH,t)},i.runScene=function(t,e,i){var r=this;t instanceof Lx&&(t=t.scene),L(t,1205),L(t instanceof XP,1216),t._load(),this.once(_.Director.EVENT_AFTER_DRAW,(function(){r.runSceneImmediate(t,e,i)}))},i.loadScene=function(t,e,i){var r=this;if(this._loadingScene)return I(1208,t,this._loadingScene),!1;var n=_.assetManager.bundles.find((function(e){return e.getSceneInfo(t)}));return n?(this.emit(_.Director.EVENT_BEFORE_SCENE_LOADING,t),this._loadingScene=t,console.time("LoadScene "+t),n.loadScene(t,(function(n,s){console.timeEnd("LoadScene "+t),r._loadingScene="",n?(S(n),e&&e(n)):r.runSceneImmediate(s,i,e)})),!0):(B(1209,t),!1)},i.preloadScene=function(t,e,i){var r=_.assetManager.bundles.find((function(e){return e.getSceneInfo(t)}));if(r)r.preloadScene(t,null,e,i);else{var n='Can not preload the scene "'+t+'" because it is not in the build settings.';i&&i(new Error(n)),S("preloadScene: "+n)}},i.resume=function(){this._paused&&(this._lastUpdate=performance.now(),this._lastUpdate||x(1200),this._paused=!1,this._deltaTime=0)},i.setDepthTest=function(t){_.Camera.main&&(_.Camera.main.depth=!!t)},i.setClearColor=function(t){_.Camera.main&&(_.Camera.main.backgroundColor=t)},i.getRunningScene=function(){return this._scene},i.getScene=function(){return this._scene},i.getAnimationInterval=function(){return 1e3/_.game.getFrameRate()},i.setAnimationInterval=function(t){_.game.setFrameRate(Math.round(1e3/t))},i.getDeltaTime=function(){return this._deltaTime},i.getTotalTime=function(){return performance.now()-this._startTime},i.getCurrentTime=function(){return this._lastUpdate},i.getTotalFrames=function(){return this._totalFrames},i.isPaused=function(){return this._paused},i.getScheduler=function(){return this._scheduler},i.setScheduler=function(t){this._scheduler!==t&&(this.unregisterSystem(this._scheduler),this._scheduler=t,this.registerSystem(tI.ID,t,200))},i.registerSystem=function(t,e,i){e.id=t,e.priority=i,e.init(),this._systems.push(e),this._systems.sort(qO.sortByPriority)},i.unregisterSystem=function(t){It.fastRemove(this._systems,t),this._systems.sort(qO.sortByPriority)},i.getSystem=function(t){return this._systems.find((function(e){return e.id===t}))},i.getAnimationManager=function(){return this.getSystem(_.AnimationManager.ID)},i.startAnimation=function(){this._invalid=!1,this._lastUpdate=performance.now()},i.stopAnimation=function(){this._invalid=!0},i.mainLoop=function(t){if(this._purgeDirectorInNextLoop)this._purgeDirectorInNextLoop=!1,this.purgeDirector();else if(!this._invalid){this.calculateDeltaTime(t);var i=this._deltaTime;if(!this._paused){this.emit(e.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(i);for(var r=0;r<this._systems.length;++r)this._systems[r].update(i);this._compScheduler.lateUpdatePhase(i),this.emit(e.EVENT_AFTER_UPDATE),Xi._deferredDestroy();for(var n=0;n<this._systems.length;++n)this._systems[n].postUpdate(i)}this.emit(e.EVENT_BEFORE_DRAW),this._root.frameMove(this._deltaTime),this.emit(e.EVENT_AFTER_DRAW),av.frameUpdateListeners(),py.bookOfChange.clear(),this._totalFrames++}},i._initOnRendererInitialized=function(){this._totalFrames=0,this._lastUpdate=performance.now(),this._startTime=this._lastUpdate,this._paused=!1,this._purgeDirectorInNextLoop=!1,av&&av.setEnabled(!0),this.registerSystem(tI.ID,this._scheduler,200),this.emit(e.EVENT_INIT)},i._init=function(){return this._root=new BF(_.game._gfxDevice),this._root.initialize({}).catch((function(t){return B(1217),Promise.reject(t)}))},r(e,[{key:"root",get:function(){return this._root}}]),e}(rr));PF.EVENT_INIT="director_init",PF.EVENT_RESET="director_reset",PF.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",PF.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",PF.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",PF.EVENT_BEFORE_UPDATE="director_before_update",PF.EVENT_AFTER_UPDATE="director_after_update",PF.EVENT_BEFORE_DRAW="director_before_draw",PF.EVENT_AFTER_DRAW="director_after_draw",PF.EVENT_BEFORE_PHYSICS="director_before_physics",PF.EVENT_AFTER_PHYSICS="director_after_physics",PF.instance=void 0,_.Director=PF;var NF=t("director",PF.instance=_.director=new PF),LF=function(){function t(){this.name="",this.base="",this.importBase="",this.nativeBase="",this.deps=null,this.assetInfos=new mi,this.scenes=new mi,this.paths=new mi}var e=t.prototype;return e.init=function(t){!function(t){var e=t.uuids,i=t.paths,r=t.types,n=t.deps,s=t.paths=Object.create(null);if(!1===t.debug){for(var a=0,o=e.length;a<o;a++)e[a]=Pi(e[a]);for(var h in i){var l=i[h],u=l[1];l[1]=r[u]}}else{for(var c=Object.create(null),_=0,d=e.length;_<d;_++){var p=e[_];e[_]=c[p]=Pi(p)}e=c}for(var f in i){var m=i[f];s[e[f]]=m}var g=t.scenes;for(var v in g){var y=g[v];g[v]=e[y]}var T=t.packs;for(var E in T)for(var S=T[E],b=0;b<S.length;++b)S[b]=e[S[b]];var A=t.versions;if(A)for(var C in A)for(var w=A[C],R=0;R<w.length;R+=2){var x=w[R];w[R]=e[x]||x}var O=t.redirect;if(O)for(var I=0;I<O.length;I+=2)O[I]=e[O[I]],O[I+1]=n[O[I+1]]}(t),this.importBase=t.importBase||"",this.nativeBase=t.nativeBase||"",this.base=t.base||"",this.name=t.name||"",this.deps=t.deps||[],this._initUuid(t.uuids),this._initPath(t.paths),this._initScene(t.scenes),this._initPackage(t.packs),this._initVersion(t.versions),this._initRedirect(t.redirect)},e.getInfoWithPath=function(t,e){if(!t)return null;t=Ui(t);var i=this.paths.get(t);if(i){if(!e)return i[0];for(var r=0,n=i.length;r<n;r++){var s=i[r];if(Mt.isChildClassOf(s.ctor,e))return s}}return null},e.getDirWithPath=function(t,e,i){"/"===(t=Ui(t))[t.length-1]&&(t=t.slice(0,-1));var r=i||[];return this.paths.forEach((function(i,n){if(n.startsWith(t)&&function(t,e){return!(t.length>e.length)||47===t.charCodeAt(e.length)}(n,t)||!t)for(var s=0,a=i.length;s<a;s++){var o=i[s];e&&!Mt.isChildClassOf(o.ctor,e)||r.push(o)}})),r},e.getAssetInfo=function(t){return this.assetInfos.get(t)||null},e.getSceneInfo=function(t){return t.endsWith(".scene")||(t+=".scene"),"/"===t[0]||t.startsWith("db://")||(t="/"+t),this.scenes.find((function(e,i){return i.endsWith(t)}))},e.destroy=function(){this.paths.destroy(),this.scenes.destroy(),this.assetInfos.destroy()},e._initUuid=function(t){if(t){this.assetInfos.clear();for(var e=0,i=t.length;e<i;e++){var r=t[e];this.assetInfos.add(r,{uuid:r})}}},e._initPath=function(t){if(t){var e=this.paths;for(var i in e.clear(),t){var r=t[i],n=r[0],s=r[1],a=3===r.length,o=this.assetInfos.get(i);o.path=n,o.ctor=Mt._getClassById(s),e.has(n)?a?e.get(n).push(o):e.get(n).splice(0,0,o):e.add(n,[o])}}},e._initScene=function(t){if(t){var e=this.scenes;e.clear();var i=this.assetInfos;for(var r in t){var n=t[r],s=i.get(n);s.url=r,e.add(r,s)}}},e._initPackage=function(t){if(t){var e=this.assetInfos;for(var i in t){var r=t[i],n={uuid:i,packedUuids:r,ext:".json"};e.add(i,n);for(var s=0,a=r.length;s<a;s++){var o=r[s],h=e.get(o),l=h.packs;l?1===a?l.splice(0,0,n):l.push(n):h.packs=[n]}}}},e._initVersion=function(t){if(t){var e=this.assetInfos,i=t.import;if(i)for(var r=0,n=i.length;r<n;r+=2){var s=i[r];e.get(s).ver=i[r+1]}if(i=t.native)for(var a=0,o=i.length;a<o;a+=2){var h=i[a];e.get(h).nativeVer=i[a+1]}}},e._initRedirect=function(t){if(t)for(var e=this.assetInfos,i=0,r=t.length;i<r;i+=2){var n=t[i];e.get(n).redirect=t[i+1]}},t}();function FF(t,e){var i;i=cR.safeFindClass;var r,n=vR.pool.get();try{r=IR(t,n,{classFinder:i,customEnv:e})}catch(t){throw console.error(t),vR.pool.put(n),t}r._uuid=e.__uuid__||"";for(var s=n.uuidList,a=n.uuidObjList,o=n.uuidPropList,h=[],l=0;l<s.length;l++){var u=s[l];h[l]={uuid:Pi(u),owner:a[l],prop:o[l]}}return r.__depends__=h,r._native&&(r.__nativeDepend__=!0),vR.pool.put(n),r}var DF=new(function(){function t(){this._depends=new mi}var e=t.prototype;return e.init=function(){this._depends.clear()},e.getNativeDep=function(t){var e=this._depends.get(t);return e&&e.nativeDep?Object.assign({},e.nativeDep):null},e.getDeps=function(t){return this._depends.has(t)?this._depends.get(t).deps:[]},e.getDepsRecursively=function(t){var e=Object.create(null),i=[];return this._descend(t,e,i),i},e.remove=function(t){this._depends.remove(t)},e.parse=function(t,e){var i,r,n=null;if(Array.isArray(e)||e.__type__){if(this._depends.has(t))return this._depends.get(t);if(!Array.isArray(e)||"number"==typeof(r=(i=e[5])[i.length-1])&&r<0)try{var s=FF(e,{__uuid__:t});(n=this._parseDepsFromAsset(s)).nativeDep&&(n.nativeDep.uuid=t),Ei.add(t+"@import",s)}catch(e){Ti.remove(t+"@import"),n={deps:[]}}else n={deps:this._parseDepsFromJson(e)}}else{if(this._depends.has(t)&&(n=this._depends.get(t)).parsedFromExistAsset)return n;n=this._parseDepsFromAsset(e)}return this._depends.add(t,n),n},e._parseDepsFromAsset=function(t){for(var e={deps:[],parsedFromExistAsset:!0,preventPreloadNativeObject:t.constructor.preventPreloadNativeObject,preventDeferredLoadDependents:t.constructor.preventDeferredLoadDependents},i=t.__depends__,r=0,n=i.length;r<n;r++)e.deps.push(i[r].uuid);return t.__nativeDepend__&&(e.nativeDep=t._nativeDep),e},e._parseDepsFromJson=function(t){var e=null;return(e=function(t){var e=t[1];return t[10].map((function(t){return e[t]}))}(t)).forEach((function(t,i){return e[i]=Pi(t)})),e},e._descend=function(t,e,i){for(var r=this.getDeps(t),n=0;n<r.length;n++){var s=r[n];e[s]||(e[s]=!0,i.push(s),this._descend(s,e,i))}},t}());function UF(t,e){t._uuid&&e.push(t._uuid)}function kF(t,e){for(var i=Object.getOwnPropertyNames(t),r=0;r<i.length;r++){var n=i[r];if("node"!==n&&"__eventTargets"!==n){var s=t[n];if("object"==typeof s&&s)if(Array.isArray(s))for(var a=0;a<s.length;a++){var o=s[a];o instanceof Sr&&UF(o,e)}else if(s.constructor&&s.constructor!==Object)s instanceof Sr&&UF(s,e);else for(var h=Object.getOwnPropertyNames(s),l=0;l<h.length;l++){var u=s[h[l]];u instanceof Sr&&UF(u,e)}}}}function zF(t,e,i,r){i.push(t._uuid);for(var n=DF.getDeps(t._uuid),s=0,a=n.length;s<a;s++){var o=yi.get(n[s]);if(o){var h=o._uuid;h in e?e[h]+=r:e[h]=o.refCount+r,i.includes(h)||zF(o,e,i,r)}}}var GF=[],HF=new(function(){function t(){this._persistNodeDeps=new mi,this._toDelete=new mi,this._eventListener=!1}var e=t.prototype;return e.init=function(){this._persistNodeDeps.clear(),this._toDelete.clear()},e._addPersistNodeRef=function(t){var e=[];!function t(e,i){for(var r=0;r<e._components.length;r++)kF(e._components[r],i);for(var n=0;n<e._children.length;n++)t(e._children[n],i)}(t,e);for(var i=0,r=e.length;i<r;i++){var n=yi.get(e[i]);n&&n.addRef()}this._persistNodeDeps.add(t.uuid,e)},e._removePersistNodeRef=function(t){if(this._persistNodeDeps.has(t.uuid)){for(var e=this._persistNodeDeps.get(t.uuid),i=0,r=e.length;i<r;i++){var n=yi.get(e[i]);n&&n.decRef()}this._persistNodeDeps.remove(t.uuid)}},e._autoRelease=function(t,e,i){for(var r=0,n=i.length;r<n;r++){for(var s,a,o=i[r],l=DF._depends.get(e._id),u=this._persistNodeDeps.get(o.uuid),c=h(u);!(a=c()).done;){var _=a.value,d=yi.get(_);d&&d.addRef()}l&&(l.persistDeps||(l.persistDeps=[]),(s=l.persistDeps).push.apply(s,u))}if(t){for(var p=DF.getDeps(t._id),f=0,m=p.length;f<m;f++){var g=yi.get(p[f]);g&&g.decRef(t.autoReleaseAssets)}var v=DF._depends.get(t._id);if(v&&v.persistDeps)for(var y=v.persistDeps,T=0,E=y.length;T<E;T++){var S=yi.get(y[T]);S&&S.decRef(t.autoReleaseAssets)}DF.remove(t._id)}},e.tryRelease=function(t,e){if(void 0===e&&(e=!1),t instanceof Sr){if(e)return this._free(t,e);this._toDelete.add(t._uuid,t),this._eventListener||(this._eventListener=!0,_.director.once(_.Director.EVENT_AFTER_DRAW,this._freeAssets,this))}},e.removeFromDeleteQueue=function(t){this._toDelete.remove(t._uuid)},e._freeAssets=function(){var t=this;this._eventListener=!1,this._toDelete.forEach((function(e){t._free(e)})),this._toDelete.clear()},e._free=function(t,e){void 0===e&&(e=!1);var i=t._uuid;if(this._toDelete.remove(i),qi(t,!0)&&!(!e&&t.refCount>0&&function(t){var e=Object.create(null);if(e[t._uuid]=t.refCount,zF(t,e,GF,-1),GF.length=0,0!==e[t._uuid])return e[t._uuid];for(var i in e)0!==e[i]&&zF(yi.get(i),e,GF,1);return GF.length=0,e[t._uuid]}(t)>0)){yi.remove(i);for(var r=DF.getDeps(i),n=0,s=r.length;n<s;n++){var a=yi.get(r[n]);a&&(a.decRef(!1),this._free(a,!1))}t.destroy(),DF.remove(i)}},t}()),VF=null;function WF(t,e){for(var i=0,r=t.input.length;i<r;i++){var n=t.input[i];e&&!n.isNative&&n.content instanceof Sr&&n.content.decRef(!1),n.recycle()}t.input=null}function jF(t,e){return e?/\?/.test(t)?t+"&_t="+Date.now():t+"?_t="+Date.now():t}function XF(t,e,i,r,n,s,a){try{var o=DF.parse(t,e),h=!0;if(e instanceof Sr&&!e.__nativeDepend__&&(h=!1),n){for(var l=0,u=o.deps.length;l<u;l++){var c=o.deps[l];c in i||(i[c]=!0,r.push({uuid:c,bundle:a&&a.name}))}h&&o.nativeDep&&(a&&(o.nativeDep.bundle=a.name),r.push(Object.assign({},o.nativeDep)))}else{s=!!e.asyncLoadAssets||s&&!o.preventDeferredLoadDependents;for(var _=0,d=o.deps.length;_<d;_++){var p=o.deps[_];p in i||(i[p]=!0,r.push({uuid:p,__asyncLoadAssets__:s,bundle:a&&a.name}))}h&&!s&&!o.preventPreloadNativeObject&&o.nativeDep&&(a&&(o.nativeDep.bundle=a.name),r.push(Object.assign({},o.nativeDep)))}}catch(t){S(t.message,t.stack)}}function YF(t,e,i){e&&(i=void 0!==i?i:_.assetManager.cacheAsset,!Di(e)&&i&&yi.add(t,e))}function qF(t,e,i){var r=!1,n=e.__depends__;if(n){for(var s=0,a=n.length;s<a;s++){var o=n[s],h=i[o.uuid+"@import"];h?o.owner[o.prop]=h.addRef():(S("The asset "+o.uuid+" is missing!"),r=!0)}e.__depends__=null}return e.__nativeDepend__&&(i[t+"@native"]?e._nativeAsset=i[t+"@native"]:r=!0,e.__nativeDepend__=!1),r}function KF(t,e,i){var r=0,n=[];0===t.length&&i&&i(n);for(var s=function(s,a){e(t[s],(function(t){t&&n.push(t),++r===a&&i&&i(n)}))},a=0,o=t.length;a<o;a++)s(a,o)}function ZF(t,e,i){var r=t,n=e,s=i;if(void 0===i){var a="function"==typeof t;e?(s=e,a||(n=null)):void 0===e&&a&&(s=t,r=null,n=null),void 0!==e&&a&&(n=t,r=null)}return{options:r||Object.create(null),onProgress:n,onComplete:s}}function QF(t,e,i){var r=t,n=e,s=i;if(void 0===i){var a=Mt.isChildClassOf(t,Sr);e?(s=e,a&&(n=null)):void 0!==e||a||(s=t,n=null,r=null),void 0===e||a||(n=t,r=null)}return{type:r,onProgress:n||VF,onComplete:s}}function JF(t){return function(e,i){if(t){var r=[];Array.isArray(i)?i.forEach((function(t){return t instanceof Sr&&r.push(t.addRef())})):i instanceof Sr&&r.push(i.addRef()),qt((function(){r.forEach((function(t){return t.decRef(!1)})),t(e,i)}))}}}var $F=function(){function t(){this._config=new LF}var e=t.prototype;return e.getInfoWithPath=function(t,e){return this._config.getInfoWithPath(t,e)},e.getDirWithPath=function(t,e,i){return this._config.getDirWithPath(t,e,i)},e.getAssetInfo=function(t){return this._config.getAssetInfo(t)},e.getSceneInfo=function(t){return this._config.getSceneInfo(t)},e.init=function(t){this._config.init(t),Si.add(t.name,this)},e.load=function(t,e,i,r){var n=QF(e,i,r),s=n.type,a=n.onProgress,o=n.onComplete,h={__requestType__:vi.PATH,type:s,bundle:this.name,__outputAsArray__:Array.isArray(t)};_.assetManager.loadAny(t,h,a,o)},e.preload=function(t,e,i,r){var n=QF(e,i,r),s=n.type,a=n.onProgress,o=n.onComplete;_.assetManager.preloadAny(t,{__requestType__:vi.PATH,type:s,bundle:this.name},a,o)},e.loadDir=function(t,e,i,r){var n=QF(e,i,r),s=n.type,a=n.onProgress,o=n.onComplete;_.assetManager.loadAny(t,{__requestType__:vi.DIR,type:s,bundle:this.name,__outputAsArray__:!0},a,o)},e.preloadDir=function(t,e,i,r){var n=QF(e,i,r),s=n.type,a=n.onProgress,o=n.onComplete;_.assetManager.preloadAny(t,{__requestType__:vi.DIR,type:s,bundle:this.name},a,o)},e.loadScene=function(t,e,i,r){var n=ZF(e,i,r),s=n.options,a=n.onProgress,o=n.onComplete;s.preset=s.preset||"scene",s.bundle=this.name,_.assetManager.loadAny({scene:t},s,a,(function(t,e){if(t)S(t.message,t.stack),o&&o(t);else if(e instanceof Lx&&e.scene){var i=e.scene;i._id=e._uuid,i.name=e.name,o&&o(null,e)}else o&&o(new Error("The asset "+e._uuid+" is not a scene"))}))},e.preloadScene=function(t,e,i,r){var n=ZF(e,i,r),s=n.options,a=n.onProgress,o=n.onComplete;s.bundle=this.name,_.assetManager.preloadAny({scene:t},s,a,(function(e){e&&B(1210,t,e.message),o&&o(e)}))},e.get=function(t,e){var i=this.getInfoWithPath(t,e);return i&&yi.get(i.uuid)||null},e.release=function(t,e){var i=this.get(t,e);i&&HF.tryRelease(i,!0)},e.releaseUnusedAssets=function(){var t=this;yi.forEach((function(e){var i=t.getAssetInfo(e._uuid);i&&!i.redirect&&HF.tryRelease(e)}))},e.releaseAll=function(){var t=this;yi.forEach((function(e){var i=t.getAssetInfo(e._uuid);i&&!i.redirect&&HF.tryRelease(e,!0)}))},e._destroy=function(){this._config.destroy()},r(t,[{key:"config",get:function(){return this._config}},{key:"name",get:function(){return this._config.name}},{key:"deps",get:function(){return this._config.deps}},{key:"base",get:function(){return this._config.base}}]),t}(),tD=t("resources",new $F);_.resources=tD;var eD=Jr.__videoSupport,iD=eD&&eD.format;function rD(t,e,i){if(!iD||0===iD.length)return i(new Error(F(7703)));var r=document.createElement("video"),n=document.createElement("source");r.appendChild(n);var s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType="blob",s.onload=function(){200===this.status||0===this.status?(n.src=URL.createObjectURL(this.response),i(null,r)):i(new Error(s.status+"(no response)"))},s.onerror=function(){var e="load video failure - "+t;T(e),i(new Error(e))},s.send()}function nD(t,e,i){var r=new Image;function n(){r.removeEventListener("load",n),r.removeEventListener("error",s),i&&i(null,r)}function s(){r.removeEventListener("load",n),r.removeEventListener("error",s),i&&i(new Error(F(4930,t)))}return"file:"!==window.location.protocol&&(r.crossOrigin="anonymous"),r.addEventListener("load",n),r.addEventListener("error",s),r.src=t,r}var sD={};function aD(t,e,i){if(sD[t])return i&&i(null),null;var r=document.createElement("script");function n(){r.parentNode.removeChild(r),r.removeEventListener("load",n,!1),r.removeEventListener("error",s,!1),sD[t]=!0,i&&i(null)}function s(){r.parentNode.removeChild(r),r.removeEventListener("load",n,!1),r.removeEventListener("error",s,!1),i&&i(new Error(F(4928,t)))}return"file:"!==window.location.protocol&&(r.crossOrigin="anonymous"),r.async=e.scriptAsyncLoading||!1,r.src=t,r.addEventListener("load",n,!1),r.addEventListener("error",s,!1),document.body.appendChild(r),r}var oD,hD=null,lD=-1,uD=Object.create(null),cD=[];function _D(){for(var t=!0,e=Date.now(),i=cD.length-1;i>=0;i--){var r=cD[i],n=r.fontFamilyName;if(e-r.startTime>3e3)I(4933,n),r.onComplete(null,n),cD.splice(i,1);else{var s=r.refWidth,a="40px "+n;hD.font=a,s!==rd(hD,"BES bswy:->@123",a)?(cD.splice(i,1),r.onComplete(null,n)):t=!1}}t&&(clearInterval(lD),lD=-1)}function dD(t,e,i){var r=function(t){var e=t.lastIndexOf(".ttf");if(-1===e)return t;var i,r=t.lastIndexOf("/");return-1!==(i=-1===r?t.substring(0,e)+"_LABEL":t.substring(r+1,e)+"_LABEL").indexOf(" ")&&(i='"'+i+'"'),i}(t);if(uD[r])return i(null,r);if(!hD){var n=document.createElement("canvas");n.width=100,n.height=100,hD=n.getContext("2d")}var s=rd(hD,"BES bswy:->@123","40px "+r),a=document.createElement("style");a.type="text/css";var o="";isNaN(Number(r))?o+="@font-face { font-family:"+r+"; src:":o+='@font-face { font-family:"'+r+'"; src:',o+='url("'+t+'");',a.textContent=o+"}",document.body.appendChild(a);var h=document.createElement("div"),l=h.style;if(l.fontFamily=r,h.innerHTML=".",l.position="absolute",l.left="-100px",l.top="-100px",document.body.appendChild(h),function(){if(void 0===oD)if("FontFace"in window){var t=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),e=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);oD=t?parseInt(t[1],10)>42:!e}else oD=!1;return oD}())!function(t,e,i){var r=new Promise((function(i,r){!function n(){Date.now()-t>=3e3?r():document.fonts.load("40px "+e).then((function(t){t.length>=1?i():setTimeout(n,100)}),(function(){r()}))}()})),n=null,s=new Promise((function(t,e){n=setTimeout(e,3e3)}));Promise.race([s,r]).then((function(){n&&(clearTimeout(n),n=null),i(null,e)}),(function(){I(4933,e),i(null,e)}))}(Date.now(),r,i);else{var u={fontFamilyName:r,refWidth:s,onComplete:i,startTime:Date.now()};cD.push(u),-1===lD&&(lD=setInterval(_D,100))}uD[r]=a}var pD,fD,mD,gD,vD=/^\w+:\/\/.*/,yD=function(t,e,i){(Jr.capabilities.imageBitmap&&_.assetManager.allowImageBitmap?TD:nD)(t,e,i)},TD=function(t,e,i){e.xhrResponseType="blob",Hn(t,e,e.onFileProgress,i)},ED=function(t,e,i){e.xhrResponseType="json",Hn(t,e,e.onFileProgress,i)},SD=function(t,e,i){e.xhrResponseType="arraybuffer",Hn(t,e,e.onFileProgress,i)},bD=function(t,e,i){e.xhrResponseType="text",Hn(t,e,e.onFileProgress,i)},AD=function(t,e,i){var r=fr(t),n=t;vD.test(n)||(n=-1!==CD.remoteBundles.indexOf(r)?CD.remoteServerAddress+"remote/"+r:"assets/"+r);var s=e.version||CD.bundleVers[r],a=0,o=null,h=null;ED(n+"/config."+(s?s+".":"")+"json",e,(function(t,e){t&&(h=t),(o=e)&&(o.base=n+"/"),2==++a&&i(h,o)})),aD(n+"/index."+(s?s+".":"")+"js",e,(function(t){t?(h=t,2==++a&&i(t)):CD.importBundleEntry(r).then((function(){2==++a&&i(h,o)})).catch((function(t){h=t,2==++a&&i(h)}))}))},CD=new(function(){function t(){this.maxConcurrency=16,this.maxRequestsPerFrame=16,this.maxRetryCount=3,this.appendTimeStamp=!1,this.limited=!0,this.retryInterval=2e3,this.bundleVers=null,this.remoteBundles=[],this.downloadDomImage=nD,this.downloadDomAudio=qn,this.downloadFile=Hn,this.downloadScript=aD,this._downloaders={".png":yD,".jpg":yD,".bmp":yD,".jpeg":yD,".gif":yD,".ico":yD,".tiff":yD,".webp":yD,".image":yD,".pvr":SD,".pkm":SD,".astc":SD,".mp3":Zn,".ogg":Zn,".wav":Zn,".m4a":Zn,".txt":bD,".xml":bD,".vsh":bD,".fsh":bD,".atlas":bD,".tmx":bD,".tsx":bD,".json":ED,".ExportJson":ED,".plist":bD,".fnt":bD,".font":dD,".eot":dD,".ttf":dD,".woff":dD,".svg":dD,".ttc":dD,".mp4":rD,".avi":rD,".mov":rD,".mpg":rD,".mpeg":rD,".rm":rD,".rmvb":rD,".binary":SD,".bin":SD,".dbbin":SD,".skel":SD,".js":aD,bundle:AD,default:bD},this._downloading=new mi,this._queue=[],this._queueDirty=!1,this._totalNum=0,this._totalNumThisPeriod=0,this._lastDate=-1,this._checkNextPeriod=!1,this._remoteServerAddress=""}var i=t.prototype;return i.init=function(t,e,i){void 0===t&&(t=""),void 0===e&&(e={}),void 0===i&&(i=[]),this._downloading.clear(),this._queue.length=0,this._remoteServerAddress=t,this.bundleVers=e,this.remoteBundles=i},i.register=function(t,e){"object"==typeof t?dt(this._downloaders,t):this._downloaders[t]=e},i.importBundleEntry=function(t){return e.import("virtual:///prerequisite-imports/"+t)},i.download=function(t,e,i,r,n){var s=this,a=Ti.get(t);if(a)return n(null,a);var o=this._downloading.get(t);if(o){o.push(n);var h=this._queue.find((function(e){return e.id===t}));if(!h)return;var l=r.priority||0;h.priority<l&&(h.priority=l,this._queueDirty=!0)}else{var u=void 0!==r.maxRetryCount?r.maxRetryCount:this.maxRetryCount,c=void 0!==r.maxConcurrency?r.maxConcurrency:this.maxConcurrency,_=void 0!==r.maxRequestsPerFrame?r.maxRequestsPerFrame:this.maxRequestsPerFrame,d=this._downloaders[i]||this._downloaders.default;!function t(e,i,r,n,s){void 0===s&&(s=0),e(s,(function(a,o){s++,!a||s>i?n&&n(a,o):setTimeout((function(){t(e,i,r,n,s)}),r)}))}((function(i,a){if(0===i&&s._downloading.add(t,[n]),!s.limited)return d(jF(e,s.appendTimeStamp),r,a);s._updateTime();var o=function(t,e){s._totalNum--,s._handleQueueInNextFrame(c,_),a(t,e)};s._totalNum<c&&s._totalNumThisPeriod<_?(d(jF(e,s.appendTimeStamp),r,o),s._totalNum++,s._totalNumThisPeriod++):(s._queue.push({id:t,priority:r.priority||0,url:e,options:r,done:o,handler:d}),s._queueDirty=!0,s._totalNum<c&&s._handleQueueInNextFrame(c,_))}),u,this.retryInterval,(function(e,i){e||Ti.add(t,i);for(var r=s._downloading.remove(t),n=0,a=r.length;n<a;n++)r[n](e,i)}))}},i.loadSubpackage=function(t,e){_.assetManager.loadBundle(t,null,e)},i._updateTime=function(){var t=Date.now();t-this._lastDate>1e3*_.director.getDeltaTime()&&(this._totalNumThisPeriod=0,this._lastDate=t)},i._handleQueue=function(t,e){for(this._checkNextPeriod=!1,this._updateTime();this._queue.length>0&&this._totalNum<t&&this._totalNumThisPeriod<e;){this._queueDirty&&(this._queue.sort((function(t,e){return t.priority-e.priority})),this._queueDirty=!1);var i=this._queue.pop();if(!i)break;this._totalNum++,this._totalNumThisPeriod++,i.handler(jF(i.url,this.appendTimeStamp),i.options,i.done)}this._handleQueueInNextFrame(t,e)},i._handleQueueInNextFrame=function(t,e){!this._checkNextPeriod&&this._queue.length>0&&(qt(this._handleQueue.bind(this),t,e),this._checkNextPeriod=!0)},r(t,[{key:"remoteServerAddress",get:function(){return this._remoteServerAddress}}]),t}()),wD=Ne("cc.VideoClip")((gD=function(t){function e(){var e;return l(e=t.call(this)||this,"_duration",mD,a(e)),e._video=null,e.loaded=!1,e}return s(e,t),r(e,[{key:"_nativeAsset",set:function(t){this._video=t,t?(this._duration=t.duration,this.loaded=!0):(this._duration=0,this.loaded=!1)},get:function(){return this._video}}]),e}(Sr),mD=u((fD=gD).prototype,"_duration",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),pD=fD))||pD;function RD(t,e,i,r){var n=null,s=null;try{(n=new Dd)._nativeUrl=t,n._nativeAsset=e}catch(t){s=t}r(s,n)}function xD(t,e,i,r){var n=new Gn;n._nativeUrl=t,n._nativeAsset=e,n._duration=e.duration,r(null,n)}function OD(t,e,i,r){var n=new Yx;n.json=e,r(null,n)}function ID(t,e,i,r){var n=new jx;n.text=e,r(null,n)}function MD(t,e,i,r){var n=new hO;n._nativeUrl=t,n._nativeAsset=e,r(null,n)}function BD(t,e,i,r){var n=new nx;n._nativeUrl=t,n._nativeAsset=e,r(null,n)}function PD(t,e,i,r){var n=new Sr;n._nativeUrl=t,n._nativeAsset=e,r(null,n)}function ND(t,e,i,r){var n=Si.get(e.name);n||(n=e.name===wi.RESOURCES?tD:new $F,e.base=e.base||t+"/",n.init(e)),r(null,n)}function LD(t,e,i,r){var n=new wD;n._nativeUrl=t,n._nativeAsset=e,r(null,n)}var FD=new(function(){function t(){this._creating=new mi,this._producers={".png":RD,".jpg":RD,".bmp":RD,".jpeg":RD,".gif":RD,".ico":RD,".tiff":RD,".webp":RD,".image":RD,".pvr":RD,".pkm":RD,".mp3":xD,".ogg":xD,".wav":xD,".m4a":xD,".mp4":LD,".avi":LD,".mov":LD,".mpg":LD,".mpeg":LD,".rm":LD,".rmvb":LD,".txt":ID,".xml":ID,".vsh":ID,".fsh":ID,".atlas":ID,".tmx":ID,".tsx":ID,".fnt":ID,".json":OD,".ExportJson":OD,".font":MD,".eot":MD,".ttf":MD,".woff":MD,".svg":MD,".ttc":MD,".binary":BD,".bin":BD,".dbbin":BD,".skel":BD,bundle:ND,default:PD}}var e=t.prototype;return e.register=function(t,e){"object"==typeof t?Mt.mixin(this._producers,t):this._producers[t]=e},e.create=function(t,e,i,r,n){var s=this,a=this._producers[i]||this._producers.default,o=yi.get(t);if(r.reloadAsset||!o){var h=this._creating.get(t);h?h.push(n):(this._creating.add(t,[n]),a(t,e,r,(function(e,i){!e&&i instanceof Sr&&(i._uuid=t,YF(t,i,r.cacheAsset));for(var n=s._creating.remove(t),a=0,o=n.length;a<o;a++)n[a](e,i)})))}else n(null,o)},t}()),DD=new(function(){function t(){this._loading=new mi,this._unpackers={".json":this.unpackJson}}var e=t.prototype;return e.unpackJson=function(t,e,i,r){var n=Mt.createMap(!0),s=null;if(Array.isArray(e)){(e=function(t,e){if(t[0]<1)throw new Error(F(5304,t[0]));xR(t,!0,e),OR(t);for(var i=new MR(t[0]),r=t[1],n=t[2],s=t[3],a=t[4],o=t[5],h=0;h<o.length;++h)o[h].unshift(i,r,n,s,a);return o}(e,cR.safeFindClass)).length!==t.length&&B(4915);for(var a=0;a<t.length;a++)n[t[a]+"@import"]=e[a]}else{var o=Mt._getClassId(pp);if(e.type===o&&e.data){var h=e.data;h.length!==t.length&&B(4915);for(var l=0;l<t.length;l++)n[t[l]+"@import"]=BR(o,{base:h[l][0],mipmaps:h[l][1]},!0)}else s=new Error("unmatched type pack!"),n=null}r(s,n)},e.init=function(){this._loading.clear()},e.register=function(t,e){"object"==typeof t?Mt.mixin(this._unpackers,t):this._unpackers[t]=e},e.unpack=function(t,e,i,r,n){e?(0,this._unpackers[i])(t,e,r,n):n(new Error("package data is wrong!"))},e.load=function(t,e,i){var r=this;if(t.isNative||!t.info||!t.info.packs)return CD.download(t.id,t.url,t.ext,t.options,i);if(Ti.has(t.id))return i(null,Ti.get(t.id));var n=t.info.packs,s=n.find((function(t){return r._loading.has(t.uuid)}));if(s)this._loading.get(s.uuid).push({onComplete:i,id:t.id});else{s=n[0],this._loading.add(s.uuid,[{onComplete:i,id:t.id}]);var a=ki(s.uuid,{ext:s.ext,bundle:t.config.name});CD.download(s.uuid,a,s.ext,t.options,(function(e,i){Ti.remove(s.uuid),e&&S(e.message,e.stack),r.unpack(s.packedUuids,i,s.ext,t.options,(function(t,i){if(!t)for(var n in i)Ti.add(n,i[n]);for(var a=r._loading.remove(s.uuid),o=0,h=a.length;o<h;o++){var l=a[o];if(e||t)l.onComplete(e||t);else{var u=i[l.id];u?l.onComplete(null,u):l.onComplete(new Error("can not retrieve data from package"))}}}))}))}},t}());function UD(t,e){var i=!1;t.progress||(t.progress={finish:0,total:t.input.length,canInvoke:!0},i=!0);var r=t.options,n=t.progress,s=[],a=n.total;r.__exclude__=r.__exclude__||Object.create(null),t.output=[],KF(t.input,(function(r,o){if(!r.isNative&&yi.has(r.uuid)){var h=yi.get(r.uuid);return h.addRef(),zD(r,t,h,null,h.__asyncLoadAssets__,s,a),o()}DD.load(r,t.options,(function(h,l){h?t.isFinish||(!_.assetManager.force||i?(S(h.message,h.stack),n.canInvoke=!1,e(h)):zD(r,t,null,null,!1,s,a)):t.isFinish||zD(r,t,null,l,!r.isNative,s,a),o()}))}),(function(){if(t.isFinish)return WF(t,!0),t.dispatch("error");if(s.length>0){var a=xi.create({input:s,progress:n,options:r,onProgress:t.onProgress,onError:xi.prototype.recycle,onComplete:function(r){var n;r||((n=t.output).push.apply(n,a.output),a.recycle()),i&&kD(t),e(r)}});Ai.async(a)}else i&&kD(t),e()}))}function kD(t){for(var e=t.output,i=0,r=e.length;i<r;i++)e[i].content&&e[i].content.decRef(!1)}function zD(t,e,i,r,n,s,a){var o=e.options.__exclude__,h=e.progress;t.content=i,t.file=r,e.output.push(t),n&&(o[t.uuid]=!0,XF(t.uuid,r||i,o,s,!0,!1,t.config),h.total=a+s.length),h.canInvoke&&e.dispatch("progress",++h.finish,h.total,t)}var GD=new(function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;return i.parse=function(t){var e=this._parseXML(t).documentElement;if("plist"!==e.tagName)return I(5100),{};for(var i=null,r=0,n=e.childNodes.length;r<n&&1!==(i=e.childNodes[r]).nodeType;r++);return this._parseNode(i)},i._parseNode=function(t){var e=null,i=t.tagName;if("dict"===i)e=this._parseDict(t);else if("array"===i)e=this._parseArray(t);else if("string"===i)if(1===t.childNodes.length)e=t.firstChild.nodeValue;else{e="";for(var r=0;r<t.childNodes.length;r++)e+=t.childNodes[r].nodeValue}else"false"===i?e=!1:"true"===i?e=!0:"real"===i?e=parseFloat(t.firstChild.nodeValue):"integer"===i&&(e=parseInt(t.firstChild.nodeValue,10));return e},i._parseArray=function(t){for(var e=[],i=0,r=t.childNodes.length;i<r;i++){var n=t.childNodes[i];1===n.nodeType&&e.push(this._parseNode(n))}return e},i._parseDict=function(t){for(var e={},i="",r=0,n=t.childNodes.length;r<n;r++){var s=t.childNodes[r];1===s.nodeType&&("key"===s.tagName?i=s.firstChild.nodeValue:e[i]=this._parseNode(s))}return e},e}(function(){function t(){this._parser=null,window.DOMParser&&(this._parser=new DOMParser)}var e=t.prototype;return e.parse=function(t){return this._parseXML(t)},e._parseXML=function(t){var e;return this._parser&&(e=this._parser.parseFromString(t,"text/xml")),e},t}()));function HD(t,e){return t[e]<<8|t[e+1]}var VD=new(function(){function t(){this._parsing=new mi,this._parsers={".png":this.parseImage,".jpg":this.parseImage,".bmp":this.parseImage,".jpeg":this.parseImage,".gif":this.parseImage,".ico":this.parseImage,".tiff":this.parseImage,".webp":this.parseImage,".image":this.parseImage,".pvr":this.parsePVRTex,".pkm":this.parsePKMTex,".astc":this.parseASTCTex,".mp3":this.parseAudio,".ogg":this.parseAudio,".wav":this.parseAudio,".m4a":this.parseAudio,".plist":this.parsePlist,import:this.parseImport}}var e=t.prototype;return e.parseImage=function(t,e,i){t instanceof HTMLImageElement?i(null,t):createImageBitmap(t,{premultiplyAlpha:"none"}).then((function(t){i(null,t)}),(function(t){i(t,null)}))},e.parseAudio=function(t,e,i){t instanceof ArrayBuffer?Jr.__audioSupport.context.decodeAudioData(t,(function(t){i(null,t)}),(function(t){i(new Error("Error with decoding audio data"+t.err),null)})):i(null,t)},e.parsePVRTex=function(t,e,i){var r=null,n=null;try{var s=t instanceof ArrayBuffer?t:t.buffer,a=new Int32Array(s,0,13);if(55727696===a[0]){var o=a[7],h=a[6],l=a[12]+52;n={_data:new Uint8Array(s,l),_compressed:!0,width:o,height:h,format:0}}else{if(559044176!==a[11])throw new Error("Invalid magic number in PVR header");var u=a[0],c=a[1],_=a[2];n={_data:new Uint8Array(s,u),_compressed:!0,width:_,height:c,format:0}}}catch(t){r=t}i(r,n)},e.parsePKMTex=function(t,e,i){var r=null,n=null;try{var s=t instanceof ArrayBuffer?t:t.buffer,a=new Uint8Array(s),o=HD(a,6);if(0!==o&&1!==o&&3!==o)throw new Error("Invalid magic number in ETC header");var h=HD(a,12),l=HD(a,14);HD(a,8),HD(a,10),n={_data:new Uint8Array(s,16),_compressed:!0,width:h,height:l,format:0}}catch(t){r=t}i(r,n)},e.parseASTCTex=function(t,e,i){var r=null,n=null;try{var s=t instanceof ArrayBuffer?t:t.buffer,a=new Uint8Array(s);if(1554098963!==a[0]+(a[1]<<8)+(a[2]<<16)+(a[3]<<24))throw new Error("Invalid magic number in ASTC header");var o=a[4],h=a[5],l=a[6];if((o<3||o>6||h<3||h>6||l<3||l>6)&&(o<4||7===o||9===o||11===o||o>12||h<4||7===h||9===h||11===h||h>12||1!==l))throw new Error("Invalid block number in ASTC header");var u=function(t,e){return 4===t?Rd.RGBA_ASTC_4x4:5===t?4===e?Rd.RGBA_ASTC_5x4:Rd.RGBA_ASTC_5x5:6===t?5===e?Rd.RGBA_ASTC_6x5:Rd.RGBA_ASTC_6x6:8===t?5===e?Rd.RGBA_ASTC_8x5:6===e?Rd.RGBA_ASTC_8x6:Rd.RGBA_ASTC_8x8:10===t?5===e?Rd.RGBA_ASTC_10x5:6===e?Rd.RGBA_ASTC_10x6:8===e?Rd.RGBA_ASTC_10x8:Rd.RGBA_ASTC_10x10:10===e?Rd.RGBA_ASTC_12x10:Rd.RGBA_ASTC_12x12}(o,h),c=a[7]+(a[8]<<8)+(a[9]<<16),_=a[10]+(a[11]<<8)+(a[12]<<16);a[13],a[14],a[15],n={_data:new Uint8Array(s,16),_compressed:!0,width:c,height:_,format:u}}catch(t){r=t}i(r,n)},e.parsePlist=function(t,e,i){var r=null,n=GD.parse(t);n||(r=new Error("parse failed")),i(r,n)},e.parseImport=function(t,e,i){if(t){var r=null,n=null;try{r=FF(t,e)}catch(t){n=t}i(n,r)}else i(new Error("Json is empty"))},e.init=function(){this._parsing.clear()},e.register=function(t,e){"object"==typeof t?dt(this._parsers,t):this._parsers[t]=e},e.parse=function(t,e,i,r,n){var s=this,a=Ei.get(t);if(a)n(null,a);else{var o=this._parsing.get(t);if(o)o.push(n);else{var h=this._parsers[i];h?(this._parsing.add(t,[n]),h(e,r,(function(e,i){e?Ti.remove(t):Di(i)||Ei.add(t,i);for(var r=s._parsing.remove(t),n=0,a=r.length;n<a;n++)r[n](e,i)}))):n(null,e)}}},t}());function WD(t,e){var i=!1;t.progress||(t.progress={finish:0,total:t.input.length,canInvoke:!0},i=!0);var r=t.options,n=t.progress;r.__exclude__=r.__exclude__||Object.create(null),t.output=[],KF(t.input,(function(s,a){var o=xi.create({input:s,onProgress:t.onProgress,options:r,progress:n,onComplete:function(r,h){r&&!t.isFinish&&(!_.assetManager.force||i?(S(r.message,r.stack),n.canInvoke=!1,e(r)):n.canInvoke&&t.dispatch("progress",++n.finish,n.total,s)),t.output.push(h),o.recycle(),a(null)}});jD.async(o)}),(function(){if(r.__exclude__=null,t.isFinish)return WF(t,!0),t.dispatch("error");!function(t){var e=t.source;if(t.options.__outputAsArray__||1!==e.length)for(var i=t.output=[],r=0,n=e.length;r<n;r++)i.push(e[r].content);else t.output=e[0].content}(t),WF(t,!0),e()}))}var jD=new gi("loadOneAsset",[function(t,e){var i=t.output=t.input,r=i.options,n=i.isNative,s=i.uuid,a=i.file,o=r.reloadAsset;if(a||!o&&!n&&yi.has(s))return e();DD.load(i,t.options,(function(t,r){i.file=r,e(t)}))},function(t,e){var i=t.output=t.input,r=t.progress,n=t.options.__exclude__,s=i.id,a=i.file,o=i.options;if(i.isNative)VD.parse(s,a,i.ext,o,(function(n,a){if(n)return e(n);i.content=a,r.canInvoke&&t.dispatch("progress",++r.finish,r.total,i),Ti.remove(s),Ei.remove(s),e()}));else{var h=i.uuid;if(h in n){var l=n[h],u=l.finish,c=l.content,_=l.err,d=l.callbacks;r.canInvoke&&t.dispatch("progress",++r.finish,r.total,i),u||function t(e,i,r,n){if(void 0===n&&(n={}),!r[i]||n[i])return!1;n[i]=!0;var s=!1,a=DF.getDeps(i);if(a)for(var o=0,h=a.length;o<h;o++){var l=a[o];if(l===e||t(e,l,r,n)){s=!0;break}}return s}(h,h,n)?(c&&c.addRef(),i.content=c,e(_)):d.push({done:e,item:i})}else if(!o.reloadAsset&&yi.has(h)){var p=yi.get(h);o.__asyncLoadAssets__||!p.__asyncLoadAssets__?(i.content=p.addRef(),r.canInvoke&&t.dispatch("progress",++r.finish,r.total,i),e()):XD(t,p,e,!1)}else o.__uuid__=h,VD.parse(s,a,"import",o,(function(i,r){if(i)return e(i);XD(t,r,e,!0)}))}}]);function XD(t,e,i,r){var n=t.input,s=t.progress,a=n,o=a.uuid,l=a.id,u=a.options,c=a.config,_=u.__asyncLoadAssets__,d=u.cacheAsset,p=[];e.addRef&&e.addRef(),XF(o,e,Object.create(null),p,!1,_,c),s.canInvoke&&t.dispatch("progress",++s.finish,s.total+=p.length,n);var f=t.options.__exclude__[o]={content:e,finish:!1,callbacks:[{done:i,item:n}]},m=xi.create({input:p,options:t.options,onProgress:t.onProgress,onError:xi.prototype.recycle,progress:s,onComplete:function(t){if(e.decRef&&e.decRef(!1),e.__asyncLoadAssets__=_,f.finish=!0,f.err=t,!t){for(var i,n=Array.isArray(m.output)?m.output:[m.output],s=Object.create(null),a=h(n);!(i=a()).done;){var u=i.value;u&&(s[u instanceof Sr?u._uuid+"@import":o+"@native"]=u)}if(r){qF(o,e,s);try{e.onLoaded&&e.onLoaded()}catch(t){S(t.message,t.stack)}Ti.remove(l),Ei.remove(l),YF(o,e,d)}else if(e.__nativeDepend__){qF(o,e,s);try{e.onLoaded&&e.onLoaded()}catch(t){S(t.message,t.stack)}}m.recycle()}for(var c=f.callbacks,p=0,g=c.length;p<g;p++){var v=c[p];e.addRef&&e.addRef(),v.item.content=e,v.done(t)}c.length=0}});bi.async(m)}function YD(t,e){var i=t.options,r=Object.create(null),n=Object.create(null);for(var s in i)switch(s){case vi.PATH:case vi.UUID:case vi.DIR:case vi.SCENE:case vi.URL:break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":r[s]=i[s];break;case"__exclude__":case"__outputAsArray__":n[s]=i[s];break;default:r[s]=i[s],n[s]=i[s]}t.options=n;var a=xi.create({input:t.input,options:r}),o=null;try{t.output=t.source=Ci.sync(a)}catch(t){o=t;for(var h=0,l=a.output.length;h<l;h++)a.output[h].recycle()}a.recycle(),e(o)}var qD=function(){function t(){this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),this._id=""}return t.create=function(){return 0!==t._deadPool.length?t._deadPool.pop():new t},t.prototype.recycle=function(){t._deadPool.length!==t.MAX_DEAD_NUM&&(this._id="",this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),t._deadPool.push(this))},r(t,[{key:"id",get:function(){return this._id||(this._id=this.uuid+"@"+(this.isNative?"native":"import")),this._id}}]),t}();qD.MAX_DEAD_NUM=500,qD._deadPool=[];var KD=[];function ZD(t){var e=t.input,i=t.options;e=Array.isArray(e)?e:[e],t.output=[];for(var r=0;r<e.length;r++){var n=e[r],s=qD.create(),a=null,o=null;if("string"==typeof n&&((n=Object.create(null))[i.__requestType__||vi.UUID]=e[r]),"object"==typeof n)for(var l in _t(n,i),n.preset&&_t(n,Ri[n.preset]),n)if(function(){switch(l){case vi.UUID:var t=s.uuid=Pi(n.uuid);if(!n.bundle){var i=Si.find((function(e){return!!e.getAssetInfo(t)}));n.bundle=i&&i.name}if(Si.has(n.bundle)){if(a=Si.get(n.bundle).config,(o=a.getAssetInfo(t))&&o.redirect){if(!Si.has(o.redirect))throw new Error("Please load bundle "+o.redirect+" first");a=Si.get(o.redirect).config,o=a.getAssetInfo(t)}s.config=a,s.info=o}s.ext=n.ext||".json";break;case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case vi.DIR:if(Si.has(n.bundle)){Si.get(n.bundle).config.getDirWithPath(n.dir,n.type,KD);for(var r,u=h(KD);!(r=u()).done;){var c=r.value;e.push({uuid:c.uuid,__isNative__:!1,ext:".json",bundle:n.bundle})}KD.length=0}s.recycle(),s=null;break;case vi.PATH:if(Si.has(n.bundle)){if(a=Si.get(n.bundle).config,(o=a.getInfoWithPath(n.path,n.type))&&o.redirect){if(!Si.has(o.redirect))throw new Error("you need to load bundle "+o.redirect+" first");a=Si.get(o.redirect).config,o=a.getAssetInfo(o.uuid)}if(!o)throw s.recycle(),new Error("Bundle "+n.bundle+" doesn't contain "+n.path);s.config=a,s.uuid=o.uuid,s.info=o}s.ext=n.ext||".json";break;case vi.SCENE:if(!n.bundle){var _=Si.find((function(e){return!!e.getAssetInfo(t)}));n.bundle=_&&_.name}if(Si.has(n.bundle)){if(a=Si.get(n.bundle).config,(o=a.getSceneInfo(n.scene))&&o.redirect){if(!Si.has(o.redirect))throw new Error("you need to load bundle "+o.redirect+" first");a=Si.get(o.redirect).config,o=a.getAssetInfo(o.uuid)}if(!o)throw s.recycle(),new Error("Bundle "+a.name+" doesn't contain scene "+n.scene);s.config=a,s.uuid=o.uuid,s.info=o}break;case"__isNative__":s.isNative=n.__isNative__;break;case vi.URL:s.url=n.url,s.uuid=n.uuid||n.url,s.ext=n.ext||dr(n.url),s.isNative=void 0===n.__isNative__||n.__isNative__;break;default:s.options[l]=n[l]}}(),!s)break;if(s&&(t.output.push(s),!s.uuid&&!s.url))throw new Error("Can not parse this input:"+JSON.stringify(n))}return null}function QD(t){for(var e=t.output=t.input,i=0;i<e.length;i++){var r=e[i];if(!r.url){var n,s,a=r.config;s=r.isNative?a&&a.nativeBase?a.base+a.nativeBase:_.assetManager.generalNativeBase:a&&a.importBase?a.base+a.importBase:_.assetManager.generalImportBase;var o=r.uuid,h="";r.info&&(h=r.isNative?r.info.nativeVer?"."+r.info.nativeVer:"":r.info.ver?"."+r.info.ver:""),n=".ttf"===r.ext?s+"/"+o.slice(0,2)+"/"+o+h+"/"+r.options.__nativeName__:s+"/"+o.slice(0,2)+"/"+o+h+r.ext,r.url=n}}return null}var JD=t("AssetManager",function(){function t(){this.pipeline=bi.append(YD).append(WD),this.fetchPipeline=Ai.append(YD).append(UD),this.transformPipeline=Ci.append(ZD).append(QD),this.bundles=Si,this.assets=yi,this.generalImportBase="",this.generalNativeBase="",this.dependUtil=DF,this.force=!1,this.allowImageBitmap=!Jr.isMobile,this.utils=zi,this.downloader=CD,this.parser=VD,this.packManager=DD,this.cacheAsset=!0,this.cacheManager=null,this.presets=Ri,this.factory=FD,this.preprocessPipe=YD,this.fetchPipe=UD,this.loadPipe=WD,this.references=null,this._releaseManager=HF,this._files=Ti,this._parsed=Ei,this._parsePipeline=null}var e=t.prototype;return e.init=function(t){void 0===t&&(t={}),this._files.clear(),this._parsed.clear(),this._releaseManager.init(),this.assets.clear(),this.bundles.clear(),this.packManager.init(),this.downloader.init(t.server,t.bundleVers,t.remoteBundles),this.parser.init(),this.dependUtil.init();var e=t.importBase||"";e&&e.endsWith("/")&&(e=e.substr(0,e.length-1));var i=t.nativeBase||"";i&&i.endsWith("/")&&(i=i.substr(0,i.length-1)),this.generalImportBase=e,this.generalNativeBase=i},e.getBundle=function(t){return Si.get(t)||null},e.removeBundle=function(t){t._destroy(),Si.remove(t.name)},e.loadAny=function(t,e,i,r){var n=ZF(e,i,r),s=n.options,a=n.onProgress,o=n.onComplete;s.preset=s.preset||"default",t=Array.isArray(t)?t.slice():t;var h=new xi({input:t,onProgress:a,onComplete:JF(o),options:s});bi.async(h)},e.preloadAny=function(t,e,i,r){var n=ZF(e,i,r),s=n.options,a=n.onProgress,o=n.onComplete;s.preset=s.preset||"preload",t=Array.isArray(t)?t.slice():t;var h=new xi({input:t,onProgress:a,onComplete:JF(o),options:s});Ai.async(h)},e.postLoadNative=function(t,e,i){var r=ZF(e,void 0,i),n=r.options,s=r.onComplete;if(!t._native||!t.__nativeDepend__)return JF(s)(null);var a=DF.getNativeDep(t._uuid);if(a){if(!Si.has(a.bundle)){var o=Si.find((function(e){return!!e.getAssetInfo(t._uuid)}));o&&(a.bundle=o.name)}this.loadAny(a,n,(function(e,i){e?S(e.message,e.stack):t.isValid&&t.__nativeDepend__&&(t._nativeAsset=i,t.__nativeDepend__=!1),s&&s(e)}))}},e.loadRemote=function(t,e,i){var r=ZF(e,void 0,i),n=r.options,s=r.onComplete;if(!n.reloadAsset&&this.assets.has(t))return JF(s)(null,this.assets.get(t));n.__isNative__=!0,n.preset=n.preset||"remote",this.loadAny({url:t},n,null,(function(e,i){e?(S(e.message,e.stack),s&&s(e,null)):FD.create(t,i,n.ext||dr(t),n,(function(t,e){s&&s(t,e)}))}))},e.loadBundle=function(t,e,i){var r=ZF(e,void 0,i),n=r.options,s=r.onComplete,a=fr(t);if(this.bundles.has(a))return JF(s)(null,this.getBundle(a));n.preset=n.preset||"bundle",n.ext="bundle",n.__isNative__=!0,this.loadAny({url:t},n,null,(function(e,i){e?(S(e.message,e.stack),s&&s(e,null)):FD.create(t,i,"bundle",n,(function(t,e){s&&s(t,e)}))}))},e.releaseAsset=function(t){HF.tryRelease(t,!0)},e.releaseUnusedAssets=function(){yi.forEach((function(t){HF.tryRelease(t)}))},e.releaseAll=function(){yi.forEach((function(t){HF.tryRelease(t,!0)}))},e.loadWithJson=function(){throw new Error("Only valid in Editor")},r(t,[{key:"main",get:function(){return Si.get(wi.MAIN)||null}},{key:"resources",get:function(){return Si.get(wi.RESOURCES)||null}}]),t}());JD.Pipeline=gi,JD.Task=xi,JD.Cache=mi,JD.RequestItem=qD,JD.Bundle=$F,JD.BuiltinBundleName=wi;var $D=t("assetManager",_.assetManager=new JD);_.AssetManager=JD;var tU=[".png",".jpg",".bmp",".jpeg",".gif",".ico",".tiff",".webp",".image",".pvr",".pkm",".astc"],eU=[".mp3",".ogg",".wav",".m4a"];function iU(){return!0}var rU={transformURL:function(t){var e=Li(t);if(!e)return t;var i=Si.find((function(t){return!!t.getAssetInfo(e)}));if(!i)return t;var r,n=i.getAssetInfo(e);if(!(r=t.startsWith(i.base+i.config.nativeBase)?n.nativeVer||"":n.ver||"")||-1!==t.indexOf(r))return t;var s=!1;if(".ttf"===dr(t)&&(s=!0),s){var a=mr(t),o=fr(t);t=a+"."+r+"/"+o}else t=t.replace(/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/,(function(t){return t+"."+r}));return t}},nU=t("CCLoader",function(){function t(){this._autoReleaseSetting=Object.create(null),this._parseLoadResArgs=QF}var e=t.prototype;return e.load=function(t,e,i){void 0===i&&void 0!==e&&(i=e,e=null);for(var r=Array.isArray(t)?t:[t],n=0;n<r.length;n++){var s=r[n];"string"==typeof s?r[n]={url:s,__isNative__:!0}:(s.type&&(s.ext="."+s.type,s.type=void 0),s.url&&(s.__isNative__=!0))}var a=[],o=[];$D.loadAny(r,null,(function(t,i,r){r.content&&(tU.includes(r.ext)?a.push(r.content):eU.includes(r.ext)&&o.push(r.content)),e&&e(t,i,r)}),(function(t,e){var n=null;if(!t){e=Array.isArray(e)?e:[e];for(var s=function(t){var i=e[t];if(!(i instanceof Sr)){var n=i,s=r[t].url;a.includes(n)?FD.create(s,i,".png",{},(function(i,r){n=e[t]=r})):o.includes(n)&&FD.create(s,i,".mp3",{},(function(i,r){n=e[t]=r})),yi.add(s,n)}},h=0;h<e.length;h++)s(h);if(e.length>1){var l=Object.create(null);e.forEach((function(t){l[t._uuid]=t})),n={isCompleted:iU,_map:l}}else n=e[0]}i&&i(t,n)}))},e.getXMLHttpRequest=function(){return new XMLHttpRequest},e.getItem=function(t){return $D.assets.has(t)?{content:$D.assets.get(t)}:null},e.loadRes=function(t,e,i,r){var n=this._parseLoadResArgs(e,i,r),s=n.type,a=n.onProgress,o=n.onComplete,h=dr(t);h&&!tD.getInfoWithPath(t,s)&&(t=t.slice(0,-h.length)),tD.load(t,s,a,o)},e.loadResArray=function(t,e,i,r){var n=this._parseLoadResArgs(e,i,r),s=n.type,a=n.onProgress,o=n.onComplete;t.forEach((function(e,i){var r=dr(e);r&&!tD.getInfoWithPath(e,s)&&(t[i]=e.slice(0,-r.length))})),tD.load(t,s,a,o)},e.loadResDir=function(t,e,i,r){var n=this._parseLoadResArgs(e,i,r),s=n.type,a=n.onProgress,o=n.onComplete;tD.loadDir(t,s,a,(function(e,i){var r=[];e||(r=tD.getDirWithPath(t,s).map((function(t){return t.path}))),o&&o(e,i,r)}))},e.getRes=function(t,e){return yi.has(t)?yi.get(t):tD.get(t,e)},e.getResCount=function(){return yi.count},e.getDependsRecursively=function(t){if(!t)return[];var e="string"==typeof t?t:t._uuid;return DF.getDepsRecursively(e).concat([e])},e.addDownloadHandlers=function(t){var e=Object.create(null),i=function(i){var r=t[i];e["."+i]=function(t,e,i){r({url:t},i)}};for(var r in t)i(r);CD.register(e)},e.addLoadHandlers=function(t){var e=Object.create(null),i=function(i){var r=t[i];e["."+i]=function(t,e,i){r({content:t},i)}};for(var r in t)i(r);VD.register(e)},e.release=function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++){var i=t[e];"string"==typeof i&&(i=yi.get(i)),$D.releaseAsset(i)}else t&&("string"==typeof t&&(t=yi.get(t)),$D.releaseAsset(t))},e.releaseAsset=function(t){$D.releaseAsset(t)},e.releaseRes=function(t,e){tD.release(t,e)},e.releaseAll=function(){$D.releaseAll(),yi.clear()},e.removeItem=function(t){return!!yi.remove(t)},e.setAutoRelease=function(t,e){"object"==typeof t&&(t=t._uuid),this._autoReleaseSetting[t]=!!e},e.setAutoReleaseRecursively=function(t,e){"object"==typeof t&&(t=t._uuid),e=!!e,this._autoReleaseSetting[t]=e;for(var i=DF.getDepsRecursively(t),r=0;r<i.length;r++)this._autoReleaseSetting[i[r]]=e},e.isAutoRelease=function(t){return"object"==typeof t&&(t=t._uuid),!!this._autoReleaseSetting[t]},r(t,[{key:"onProgress",set:function(t){VF=t}},{key:"_cache",get:function(){return yi._map}},{key:"md5Pipe",get:function(){return rU}},{key:"downloader",get:function(){return CD}},{key:"loader",get:function(){return $D.parser}}]),t}()),sU=t("loader",new nU),aU=t("AssetLibrary",{init:function(t){t.importBase=t.libraryPath,t.nativeBase=t.rawAssetsBase,$D.init(t),t.rawAssets&&tD.init({base:"",deps:[],scenes:{},redirect:[],debug:!0,packs:{},types:[],versions:{import:[],native:[]},name:wi.RESOURCES,importBase:t.importBase,nativeBase:t.nativeBase,paths:t.rawAssets.assets,uuids:Object.keys(t.rawAssets.assets)})},loadAsset:function(t,e){$D.loadAny(t,e)}}),oU=t("url",{});$s(oU,"url",[{name:"normalize",target:$D.utils,targetName:"assetManager.utils",newName:"normalize"},{name:"raw",targetName:"Asset.prototype",newName:"nativeUrl",customFunction:function(t){return t.startsWith("resources/")?ki({path:gr(t.substr(10)),bundle:wi.RESOURCES,__isNative__:!0,ext:dr(t)}):""}}]),ta(aU,"AssetLibrary",[{name:"getLibUrlNoExt",suggest:"AssetLibrary.getLibUrlNoExt was removed, if you want to transform url, please use cc.assetManager.utils.getUrlWithUuid instead"},{name:"queryAssetInfo",suggest:"AssetLibrary.queryAssetInfo was removed"}]),ta(sU,"loader",[{name:"releaseResDir",suggest:"loader.releaseResDir was removed, please use assetManager.releaseAsset instead"},{name:"flowInDeps",suggest:"loader.flowInDeps was removed"},{name:"assetLoader",suggest:"cc.loader.assetLoader was removed, assetLoader and md5Pipe were merged into cc.assetManager.transformPipeline"}]),$s(_,"cc",[{name:"loader",newName:"assetManager",logTimes:1,customGetter:function(){return sU}},{name:"AssetLibrary",newName:"assetManager",logTimes:1,customGetter:function(){return aU}},{name:"Pipeline",target:JD,targetName:"AssetManager",newName:"Pipeline",logTimes:1},{name:"url",targetName:"assetManager",newName:"utils",logTimes:1,customGetter:function(){return oU}}]),ta(_,"cc",[{name:"LoadingItems",suggest:F(1400,"cc.LoadingItems","cc.AssetManager.Task")}]),$s(Ut,"macro",[{name:"DOWNLOAD_MAX_CONCURRENT",target:CD,targetName:"assetManager.downloader",newName:"maxConcurrency"}]),$s(NF,"director",[{name:"_getSceneUuid",targetName:"assetManager.main",newName:"getSceneInfo",customFunction:function(t){var e;return $D.main?null===(e=$D.main.getSceneInfo(t))||void 0===e?void 0:e.uuid:""}}]),$s(PO,"game",[{name:"_sceneInfos",targetName:"assetManager.main",newName:"getSceneInfo",customGetter:function(){var t=[];return $D.main&&$D.main.config.scenes.forEach((function(e){t.push(e)})),t}}]);var hU,lU,uU,cU,_U,dU,pU,fU,mU,gU,vU,yU,TU,EU,SU=HF._autoRelease;HF._autoRelease=function(t,e,i){SU.call(HF,t,e,i);for(var r=sU._autoReleaseSetting,n=Object.keys(r),s=0;s<n.length;s++){var a=n[s];if(!0===r[a]){var o=yi.get(a);o&&HF.tryRelease(o)}}};var bU,AU,CU,wU,RU,xU,OU,IU,MU,BU,PU,NU,LU,FU,DU,UU,kU,zU,GU,HU,VU,WU,jU,XU,YU,qU,KU,ZU,QU,JU,$U,tk,ek,ik,rk,nk,sk,ak,ok,hk,lk,uk,ck,_k,dk,pk,fk,mk,gk,vk,yk,Tk,Ek,Sk,bk,Ak,Ck,wk,Rk,xk,Ok,Ik,Mk,Bk,Pk,Nk,Lk,Fk,Dk,Uk,kk,zk,Gk,Hk,Vk,Wk,jk,Xk,Yk,qk,Kk,Zk,Qk,Jk,$k,tz,ez,iz,rz,nz,sz,az,oz,hz,lz,uz,cz,_z,dz,pz,fz,mz,gz,vz,yz,Tz=function(e){return t({SkinnedMeshRenderer:e,SkinningModelComponent:e}),e}((hU=Ne("cc.SkinnedMeshRenderer"),lU=qe(),uU=Fe(100),cU=We(),_U=pi(bO),dU=pi(py),pU=pi(bO),fU=pi(py),mU=$e(),hU(gU=lU(gU=uU(gU=Ve(gU=cU((EU=function(t){function e(){var e;return l(e=t.call(this)||this,"_skeleton",yU,a(e)),l(e,"_skinningRoot",TU,a(e)),e._clip=null,e._modelType=bC,e}s(e,t),r(e,[{key:"skeleton",get:function(){return this._skeleton},set:function(t){t!==this._skeleton&&(this._skeleton=t,this._update())}},{key:"skinningRoot",get:function(){return this._skinningRoot},set:function(t){t!==this._skinningRoot&&(this._skinningRoot=t,this._updateModelType(),this._update())}},{key:"model",get:function(){return this._model}}]);var i=e.prototype;return i.__preload=function(){this._updateModelType()},i.uploadAnimation=function(t){this._clip=t,this.model&&this.model.uploadAnimation&&this.model.uploadAnimation(t)},i.setUseBakedAnimation=function(t){void 0===t&&(t=!0);var e=t?bC:EC;this._modelType!==e&&(this._modelType=e,this._model&&(_.director.root.destroyModel(this._model),this._model=null,this._models.length=0,this._updateModels(),this._updateCastShadow(),this.enabledInHierarchy&&this._attachToScene()))},i.setMaterial=function(e,i){t.prototype.setMaterial.call(this,e,i),this._modelType===EC&&this.getMaterialInstance(i)},i._updateModelParams=function(){this._update(),t.prototype._updateModelParams.call(this)},i._updateModelType=function(){if(this._skinningRoot){var t=this._skinningRoot.getComponent("cc.SkeletalAnimation");t&&this.setUseBakedAnimation(t.useBakedAnimation)}},i._update=function(){this.model&&(this.model.bindSkeleton(this._skeleton,this._skinningRoot,this._mesh),this.model.uploadAnimation&&this.model.uploadAnimation(this._clip))},e}($w),yU=u((vU=EU).prototype,"_skeleton",[_U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),TU=u(vU.prototype,"_skinningRoot",[dU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u(vU.prototype,"skeleton",[pU],Object.getOwnPropertyDescriptor(vU.prototype,"skeleton"),vU.prototype),u(vU.prototype,"skinningRoot",[fU,mU],Object.getOwnPropertyDescriptor(vU.prototype,"skinningRoot"),vU.prototype),gU=vU))||gU)||gU)||gU)||gU)||gU)),Ez=new hu(tl.ATTR_BATCH_ID,il.R32F),Sz=new hu(tl.ATTR_BATCH_UV,il.RG32F),bz=zl[Ez.format].size+zl[Sz.format].size,Az=function(e){return t({SkinnedMeshUnit:e,SkinningModelUnit:e}),e}((bU=Ne("cc.SkinnedMeshUnit"),AU=pi(Bf),CU=pi(bO),wU=pi(mg),RU=pi(Tz),bU((FU=function(){function t(){l(this,"mesh",IU,this),l(this,"skeleton",MU,this),l(this,"material",BU,this),l(this,"_localTransform",PU,this),l(this,"_offset",NU,this),l(this,"_size",LU,this)}return r(t,[{key:"offset",set:function(t){Es.copy(this._offset,t)},get:function(){return this._offset}},{key:"size",set:function(t){Es.copy(this._size,t)},get:function(){return this._size}},{key:"copyFrom",set:function(t){t&&(this.mesh=t.mesh,this.skeleton=t.skeleton,this.material=t.getMaterial(0),t.skinningRoot&&by(t.node,t.skinningRoot,this._localTransform))},get:function(){return null}}]),t}(),IU=u((OU=FU).prototype,"mesh",[AU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),MU=u(OU.prototype,"skeleton",[CU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),BU=u(OU.prototype,"material",[wU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),PU=u(OU.prototype,"_localTransform",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Hs}}),NU=u(OU.prototype,"_offset",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Es(0,0)}}),LU=u(OU.prototype,"_size",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Es(1,1)}}),u(OU.prototype,"offset",[Ke],Object.getOwnPropertyDescriptor(OU.prototype,"offset"),OU.prototype),u(OU.prototype,"size",[Ke],Object.getOwnPropertyDescriptor(OU.prototype,"size"),OU.prototype),u(OU.prototype,"copyFrom",[RU],Object.getOwnPropertyDescriptor(OU.prototype,"copyFrom"),OU.prototype),xU=OU))||xU)),Cz=new Hs,wz=(new Hs,new Cs),Rz=function(e){return t({SkinnedMeshBatchRenderer:e,BatchedSkinningModelComponent:e}),e}((DU=Ne("cc.SkinnedMeshBatchRenderer"),UU=qe(),kU=Fe(100),zU=We(),GU=$e(),HU=pi([he]),VU=$e(),WU=pi([Az]),jU=$e(),XU=Ze(),YU=Ze(),DU(qU=UU(qU=kU(qU=Ve(qU=zU(($U=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"atlasSize",ZU,a(e)),l(e,"batchableTextureNames",QU,a(e)),l(e,"units",JU,a(e)),e._textures={},e._batchMaterial=null,e}s(e,t);var i=e.prototype;return i.onLoad=function(){t.prototype.onLoad.call(this),this.cook()},i.onDestroy=function(){for(var e in this._textures)this._textures[e].destroy();this._textures={},this._mesh&&(this._mesh.destroy(),this._mesh=null),t.prototype.onDestroy.call(this)},i._onMaterialModified=function(e){this.cookMaterials(),t.prototype._onMaterialModified.call(this,e,this.getMaterialInstance(e))},i.cook=function(){this.cookMaterials(),this.cookSkeletons(),this.cookMeshes()},i.cookMaterials=function(){var t=this;this._batchMaterial||(this._batchMaterial=this.getMaterial(0));var e=this.getMaterialInstance(0);if(e&&this._batchMaterial&&this._batchMaterial.effectAsset){e.copy(this._batchMaterial),this.resizeAtlases();for(var i=e.effectAsset.techniques[e.technique],r=function(r){var n=i.passes[r];if(!n.properties)return"continue";var s=function(i){if(n.properties[i].type>=el.SAMPLER1D){var s=null;t.batchableTextureNames.find((function(t){return t===i}))?((s=t._textures[i])||(s=t.createTexture(i)),t.cookTextures(s,i,r)):t.units.some((function(t){return s=t.material&&t.material.getProperty(i,r)})),s&&e.setProperty(i,s,r)}else{for(var a=[],o=0;o<t.units.length;o++){var h=t.units[o];h.material&&a.push(h.material.getProperty(i.slice(0,-3),r))}e.setProperty(i,a,r)}};for(var a in n.properties)s(a)},n=0;n<i.passes.length;n++)r(n)}else console.warn("incomplete batch material!")},i.cookSkeletons=function(){if(this._skinningRoot){for(var t=[],e=[],i=0;i<this.units.length;i++){var r=this.units[i];if(r&&r.skeleton){var n=r.skeleton;Hs.invert(Cz,r._localTransform);for(var s=function(i){var r=n.joints[i];if(t.findIndex((function(t){return t===r}))>=0)return"continue";t.push(r),e.push(Hs.multiply(new Hs,n.bindposes[i]||Hs.IDENTITY,Cz))},a=0;a<n.joints.length;a++)s(a)}}var o=Array.from(Array(t.length).keys()).sort((function(e,i){return t[e]>t[i]?1:t[e]<t[i]?-1:0})),h=new bO;h.joints=t.map((function(t,e,i){return i[o[e]]})),h.bindposes=e.map((function(t,e,i){return i[o[e]]})),this._skeleton&&this._skeleton.destroy(),this.skeleton=h}else console.warn("no skinning root specified!")},i.cookMeshes=function(){for(var t=this,e=!1,i=0;i<this.units.length;i++)if(this.units[i].mesh){e=!0;break}if(e&&this._skinningRoot){this._mesh?this._mesh.destroyRenderingMesh():this._mesh=new Bf;for(var r=0,n=il.UNKNOWN,s=0,a=il.UNKNOWN,o=0,h=il.UNKNOWN,l=0,u=il.UNKNOWN,c=0,_=il.UNKNOWN,d=new Array(this.units.length),p=this.units.length,f=0;f<p;f++){var m=this.units[f];m&&m.skeleton&&(d[f]=m.skeleton.joints.map((function(e){return t._skeleton.joints.findIndex((function(t){return e===t}))})))}for(var g=function(e){var i=t.units[e];if(!i||!i.mesh||!i.mesh.data)return"continue";var p=t._createUnitMesh(e,i.mesh),f=new DataView(p.data.buffer);Hs.inverseTranspose(Cz,i._localTransform);for(var m=i.offset,g=i.size,v=function(t){var v=p.struct.vertexBundles[t];r=v.view.offset,n=il.UNKNOWN;for(var y=0;y<v.attributes.length;y++){var T=v.attributes[y];if(T.name===tl.ATTR_POSITION){n=T.format;break}r+=zl[T.format].size}if(n){for(var E=Cd(f,n,r,v.view.length,v.view.stride),S=0;S<E.length;S+=3)Cs.fromArray(wz,E,S),Cs.transformMat4(wz,wz,i._localTransform),Cs.toArray(E,wz,S);Ad(f,E,n,r,v.view.stride)}s=v.view.offset,a=il.UNKNOWN;for(var b=0;b<v.attributes.length;b++){var A=v.attributes[b];if(A.name===tl.ATTR_NORMAL){a=A.format;break}s+=zl[A.format].size}if(a){for(var C=Cd(f,a,s,v.view.length,v.view.stride),w=0;w<C.length;w+=3)Cs.fromArray(wz,C,w),Cs.transformMat4Normal(wz,wz,Cz),Cs.toArray(C,wz,w);Ad(f,C,a,s,v.view.stride)}o=v.view.offset,h=il.UNKNOWN;for(var R=0;R<v.attributes.length;R++){var x=v.attributes[R];if(x.name===tl.ATTR_TANGENT){h=x.format;break}o+=zl[x.format].size}if(h){for(var O=Cd(f,h,o,v.view.length,v.view.stride),I=0;I<O.length;I+=3)Cs.fromArray(wz,O,I),Cs.transformMat4Normal(wz,wz,Cz),Cs.toArray(O,wz,I);Ad(f,O,h,o,v.view.stride)}l=v.view.offset,u=il.UNKNOWN;for(var M=0;M<v.attributes.length;M++){var B=v.attributes[M];if(B.name===tl.ATTR_BATCH_UV){u=B.format;break}l+=zl[B.format].size}u&&wd(f,(function(t,e){var i,r=0===e?"x":"y";return(t=(i=t)-Math.floor(i))*g[r]+m[r]}),u,l,v.view.length,v.view.stride,f);var P=d[e];if(!P)return"continue";c=v.view.offset,_=il.UNKNOWN;for(var N=0;N<v.attributes.length;N++){var L=v.attributes[N];if(L.name===tl.ATTR_JOINTS){_=L.format;break}c+=zl[L.format].size}_&&wd(f,(function(t){return P[t]}),_,c,v.view.length,v.view.stride,f)},y=0;y<p.struct.vertexBundles.length;y++)v(y);t._mesh.merge(p)},v=0;v<p;v++)g(v);this._onMeshChanged(this._mesh),this._updateModels()}},i.cookTextures=function(t,e,i){for(var r=[],n=[],s=[],a=[],o=0;o<this.units.length;o++){var h=this.units[o];if(h.material){var l=h.material.getProperty(e,i);if(l&&l.image&&l.image.data){var u=new vu;u.texOffset.x=h.offset.x*this.atlasSize,u.texOffset.y=h.offset.y*this.atlasSize,u.texExtent.width=h.size.x*this.atlasSize,u.texExtent.height=h.size.y*this.atlasSize;var c=l.image.data;ArrayBuffer.isView(c)?(s.push(c),a.push(u)):(r.push(c),n.push(u))}}}var d=t.getGFXTexture(),p=_.director.root.device;s.length>0&&p.copyBuffersToTexture(s,d,a),r.length>0&&p.copyTexImagesToTexture(r,d,n)},i.createTexture=function(t){var e=new pp;return e.setFilters(Od.LINEAR,Od.LINEAR),e.setMipFilter(Od.NEAREST),e.reset({width:this.atlasSize,height:this.atlasSize,format:Rd.RGBA8888}),e.loaded=!0,this._textures[t]=e,e},i.resizeAtlases=function(){for(var t in this._textures)this._textures[t].reset({width:this.atlasSize,height:this.atlasSize,format:Rd.RGBA8888})},i._createUnitMesh=function(t,e){for(var i=JSON.parse(JSON.stringify(e.struct)),r={},n=0;n<e.struct.primitives.length;n++){for(var s=e.struct.primitives[n],a=0,o=il.UNKNOWN,h=0;h<s.vertexBundelIndices.length;h++){var l=e.struct.vertexBundles[s.vertexBundelIndices[h]];a=l.view.offset,o=il.UNKNOWN;for(var u=0;u<l.attributes.length;u++){var c=l.attributes[u];if(c.name===tl.ATTR_TEX_COORD){o=c.format;break}a+=zl[c.format].size}if(o)break}if(void 0===r[h]){r[h]=[o,a];var d=i.vertexBundles[h];d.attributes.push(Ez),d.attributes.push(Sz),d.view.offset=0,d.view.length+=d.view.count*bz,d.view.stride+=bz}}for(var p=0,f=0;f<i.vertexBundles.length;f++)p+=i.vertexBundles[f].view.length;for(var m=0;m<i.primitives.length;m++){var g=i.primitives[m];g.indexView&&(g.indexView.offset=p,p+=g.indexView.length)}var v=new Uint8Array(p),y=e.data,T=new DataView(v.buffer),E=new DataView(y.buffer),S=_.sys.isLittleEndian;for(var b in r)for(var A=i.vertexBundles[b],C=e.struct.vertexBundles[b],w=r[b],R=Cd(E,w[0],w[1],C.view.length,C.view.stride),x=C.view,O=A.view,I=x.stride,M=O.stride,B=x.offset,P=O.offset,N=0;N<O.count;N++){var L=y.subarray(B,B+I);v.set(L,P),T.setFloat32(P+I,t),T.setFloat32(P+I+4,R[2*N],S),T.setFloat32(P+I+8,R[2*N+1],S),P+=M,B+=I}for(var F=0;F<i.primitives.length;F++){var D=e.struct.primitives[F],U=i.primitives[F];if(D.indexView&&U.indexView)for(var k=D.indexView.stride,z=U.indexView.stride,G=D.indexView.offset,H=U.indexView.offset,V=0;V<U.indexView.count;V++){var W=y.subarray(G,G+k);v.set(W,H),H+=z,G+=k}}var j=new Bf;return j.reset({struct:i,data:v}),j},r(e,[{key:"mesh",get:function(){return t.prototype.mesh},set:function(t){this.mesh=t}},{key:"skeleton",get:function(){return t.prototype.skeleton},set:function(t){this.skeleton=t}}]),e}(Tz),ZU=u((KU=$U).prototype,"atlasSize",[ke,GU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1024}}),QU=u(KU.prototype,"batchableTextureNames",[HU,ke,VU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),JU=u(KU.prototype,"units",[WU,ke,jU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),u(KU.prototype,"mesh",[fi,XU],Object.getOwnPropertyDescriptor(KU.prototype,"mesh"),KU.prototype),u(KU.prototype,"skeleton",[fi,YU],Object.getOwnPropertyDescriptor(KU.prototype,"skeleton"),KU.prototype),qU=KU))||qU)||qU)||qU)||qU)||qU)),xz=Pt({LUMINOUS_POWER:0,LUMINANCE:1}),Oz=new Cs,Iz=Ne("cc.StaticLightSettings")((sk=function(){function t(){l(this,"_editorOnly",ik,this),l(this,"_bakeable",rk,this),l(this,"_castShadow",nk,this)}return r(t,[{key:"editorOnly",get:function(){return this._editorOnly},set:function(t){this._editorOnly=t}},{key:"bakeable",get:function(){return this._bakeable},set:function(t){this._bakeable=t}},{key:"castShadow",get:function(){return this._castShadow},set:function(t){this._castShadow=t}}]),t}(),ik=u((ek=sk).prototype,"_editorOnly",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),rk=u(ek.prototype,"_bakeable",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),nk=u(ek.prototype,"_castShadow",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),u(ek.prototype,"editorOnly",[Ke],Object.getOwnPropertyDescriptor(ek.prototype,"editorOnly"),ek.prototype),u(ek.prototype,"bakeable",[Ke],Object.getOwnPropertyDescriptor(ek.prototype,"bakeable"),ek.prototype),u(ek.prototype,"castShadow",[Ke],Object.getOwnPropertyDescriptor(ek.prototype,"castShadow"),ek.prototype),tk=ek))||tk,Mz=function(e){return t({Light:e,LightComponent:e}),e}((ak=Ne("cc.Light"),ok=$e(),hk=$e(),lk=ti(),uk=$e(),ck=pi(Iz),ak((yk=vk=function(t){function e(){var e;return l(e=t.call(this)||this,"_color",pk,a(e)),l(e,"_useColorTemperature",fk,a(e)),l(e,"_colorTemperature",mk,a(e)),l(e,"_staticSettings",gk,a(e)),e._type=uS.UNKNOWN,e._lightType=void 0,e._light=null,e._lightType=pS,e}s(e,t),r(e,[{key:"color",get:function(){return this._color},set:function(t){this._color=t,this._light&&(Oz.x=t.r/255,Oz.y=t.g/255,Oz.z=t.b/255,this._light.color=Oz)}},{key:"useColorTemperature",get:function(){return this._useColorTemperature},set:function(t){this._useColorTemperature=t,this._light&&(this._light.useColorTemperature=t)}},{key:"colorTemperature",get:function(){return this._colorTemperature},set:function(t){this._colorTemperature=t,this._light&&(this._light.colorTemperature=t)}},{key:"staticSettings",get:function(){return this._staticSettings},set:function(t){this._staticSettings=t}},{key:"type",get:function(){return this._type}}]);var i=e.prototype;return i.onLoad=function(){this._createLight()},i.onEnable=function(){this._attachToScene()},i.onDisable=function(){this._detachFromScene()},i.onDestroy=function(){this._destroyLight()},i._createLight=function(){this._light||(this._light=_.director.root.createLight(this._lightType)),this.color=this._color,this.useColorTemperature=this._useColorTemperature,this.colorTemperature=this._colorTemperature,this._light.node=this.node},i._destroyLight=function(){this._light&&(_.director.root.destroyLight(this),this._light=null)},i._attachToScene=function(){if(this._detachFromScene(),this._light&&!this._light.scene&&this.node.scene){var t=this._getRenderScene();switch(this._type){case uS.DIRECTIONAL:t.addDirectionalLight(this._light),t.setMainLight(this._light);break;case uS.SPHERE:t.addSphereLight(this._light);break;case uS.SPOT:t.addSpotLight(this._light)}}},i._detachFromScene=function(){if(this._light&&this._light.scene){var t=this._light.scene;switch(this._type){case uS.DIRECTIONAL:t.removeDirectionalLight(this._light),t.unsetMainLight(this._light);break;case uS.SPHERE:t.removeSphereLight(this._light);break;case uS.SPOT:t.removeSpotLight(this._light)}}},e}(ds),vk.Type=uS,vk.PhotometricTerm=xz,pk=u((dk=yk).prototype,"_color",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Qs.WHITE.clone()}}),fk=u(dk.prototype,"_useColorTemperature",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),mk=u(dk.prototype,"_colorTemperature",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 6550}}),gk=u(dk.prototype,"_staticSettings",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Iz}}),u(dk.prototype,"color",[ok],Object.getOwnPropertyDescriptor(dk.prototype,"color"),dk.prototype),u(dk.prototype,"useColorTemperature",[hk],Object.getOwnPropertyDescriptor(dk.prototype,"useColorTemperature"),dk.prototype),u(dk.prototype,"colorTemperature",[ni,lk,uk],Object.getOwnPropertyDescriptor(dk.prototype,"colorTemperature"),dk.prototype),u(dk.prototype,"staticSettings",[ck],Object.getOwnPropertyDescriptor(dk.prototype,"staticSettings"),dk.prototype),_k=dk))||_k)),Bz=function(e){return t({DirectionalLight:e,DirectionalLightComponent:e}),e}((Tk=Ne("cc.DirectionalLight"),Ek=qe(),Sk=We(),bk=ai(),Ak=$e(),Tk(Ck=Ek(Ck=Sk(Ck=Ve((xk=function(t){function e(){var e;return l(e=t.call(this)||this,"_illuminance",Rk,a(e)),e._type=uS.DIRECTIONAL,e._light=null,e._lightType=$C,e}return s(e,t),r(e,[{key:"illuminance",get:function(){return this._illuminance},set:function(t){this._illuminance=t,this._light&&(this._light.illuminance=this._illuminance)}}]),e.prototype._createLight=function(){t.prototype._createLight.call(this),this._light&&(this.illuminance=this._illuminance)},e}(Mz),Rk=u((wk=xk).prototype,"_illuminance",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 65e3}}),u(wk.prototype,"illuminance",[bk,Ak],Object.getOwnPropertyDescriptor(wk.prototype,"illuminance"),wk.prototype),Ck=wk))||Ck)||Ck)||Ck)||Ck)),Pz=function(e){return t({SphereLight:e,SphereLightComponent:e}),e}((Ok=Ne("cc.SphereLight"),Ik=qe(),Mk=We(),Bk=ai(),Pk=$e(),Nk=ai(),Lk=$e(),Fk=pi(xz),Dk=$e(),Uk=$e(),kk=$e(),Ok(zk=Ik(zk=Mk(zk=Ve((Xk=function(t){function e(){var e;return l(e=t.call(this)||this,"_size",Hk,a(e)),l(e,"_luminance",Vk,a(e)),l(e,"_term",Wk,a(e)),l(e,"_range",jk,a(e)),e._type=uS.SPHERE,e._light=null,e._lightType=tw,e}return s(e,t),r(e,[{key:"luminousPower",get:function(){return this._luminance*dS(this._size)},set:function(t){this._luminance=t/dS(this._size),this._light&&(this._light.luminance=this._luminance)}},{key:"luminance",get:function(){return this._luminance},set:function(t){this._luminance=t,this._light&&(this._light.luminance=t)}},{key:"term",get:function(){return this._term},set:function(t){this._term=t}},{key:"size",get:function(){return this._size},set:function(t){this._size=t,this._light&&(this._light.size=t)}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._light&&(this._light.range=t)}}]),e.prototype._createLight=function(){t.prototype._createLight.call(this),this._light&&(this.luminance=this._luminance,this.size=this._size,this.range=this._range)},e}(Mz),Hk=u((Gk=Xk).prototype,"_size",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.15}}),Vk=u(Gk.prototype,"_luminance",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1700/dS(.15)}}),Wk=u(Gk.prototype,"_term",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xz.LUMINOUS_POWER}}),jk=u(Gk.prototype,"_range",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),u(Gk.prototype,"luminousPower",[Bk,Pk],Object.getOwnPropertyDescriptor(Gk.prototype,"luminousPower"),Gk.prototype),u(Gk.prototype,"luminance",[Nk,Lk],Object.getOwnPropertyDescriptor(Gk.prototype,"luminance"),Gk.prototype),u(Gk.prototype,"term",[Fk,Dk],Object.getOwnPropertyDescriptor(Gk.prototype,"term"),Gk.prototype),u(Gk.prototype,"size",[Uk],Object.getOwnPropertyDescriptor(Gk.prototype,"size"),Gk.prototype),u(Gk.prototype,"range",[kk],Object.getOwnPropertyDescriptor(Gk.prototype,"range"),Gk.prototype),zk=Gk))||zk)||zk)||zk)||zk)),Nz=function(e){return t({SpotLight:e,SpotLightComponent:e}),e}((Yk=Ne("cc.SpotLight"),qk=qe(),Kk=We(),Zk=ai(),Qk=$e(),Jk=ai(),$k=$e(),tz=pi(xz),ez=$e(),iz=$e(),rz=$e(),nz=ti(),sz=$e(),Yk(az=qk(az=Kk(az=Ve((dz=function(t){function e(){var e;return l(e=t.call(this)||this,"_size",hz,a(e)),l(e,"_luminance",lz,a(e)),l(e,"_term",uz,a(e)),l(e,"_range",cz,a(e)),l(e,"_spotAngle",_z,a(e)),e._type=uS.SPOT,e._light=null,e._lightType=ow,e}return s(e,t),r(e,[{key:"luminousPower",get:function(){return this._luminance*dS(this._size)},set:function(t){this._luminance=t/dS(this._size),this._light&&(this._light.luminance=this._luminance)}},{key:"luminance",get:function(){return this._luminance},set:function(t){this._luminance=t,this._light&&(this._light.luminance=t)}},{key:"term",get:function(){return this._term},set:function(t){this._term=t}},{key:"size",get:function(){return this._size},set:function(t){this._size=t,this._light&&(this._light.size=t)}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._light&&(this._light.range=t)}},{key:"spotAngle",get:function(){return this._spotAngle},set:function(t){this._spotAngle=t,this._light&&(this._light.spotAngle=Pr(t))}}]),e.prototype._createLight=function(){t.prototype._createLight.call(this),this._light&&(this.luminance=this._luminance,this.size=this._size,this.range=this._range,this.spotAngle=this._spotAngle)},e}(Mz),hz=u((oz=dz).prototype,"_size",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.15}}),lz=u(oz.prototype,"_luminance",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1700/dS(.15)}}),uz=u(oz.prototype,"_term",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xz.LUMINOUS_POWER}}),cz=u(oz.prototype,"_range",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),_z=u(oz.prototype,"_spotAngle",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),u(oz.prototype,"luminousPower",[Zk,Qk],Object.getOwnPropertyDescriptor(oz.prototype,"luminousPower"),oz.prototype),u(oz.prototype,"luminance",[Jk,$k],Object.getOwnPropertyDescriptor(oz.prototype,"luminance"),oz.prototype),u(oz.prototype,"term",[tz,ez],Object.getOwnPropertyDescriptor(oz.prototype,"term"),oz.prototype),u(oz.prototype,"size",[iz],Object.getOwnPropertyDescriptor(oz.prototype,"size"),oz.prototype),u(oz.prototype,"range",[rz],Object.getOwnPropertyDescriptor(oz.prototype,"range"),oz.prototype),u(oz.prototype,"spotAngle",[ni,nz,sz],Object.getOwnPropertyDescriptor(oz.prototype,"spotAngle"),oz.prototype),az=oz))||az)||az)||az)||az));ta($w.prototype,"MeshRenderer.prototype",[{name:"enableDynamicBatching"},{name:"recieveShadows"}]),$s(BM,"Camera",[{name:"CameraClearFlag",newName:"ClearFlag"}]),$s(BM.prototype,"Camera.prototype",[{name:"color",newName:"clearColor"},{name:"depth",newName:"clearDepth"},{name:"stencil",newName:"clearStencil"}]),_.CameraComponent=BM,Mt.setClassAlias(BM,"cc.CameraComponent"),_.LightComponent=Mz,Mt.setClassAlias(Mz,"cc.LightComponent"),_.DirectionalLightComponent=Bz,Mt.setClassAlias(Bz,"cc.DirectionalLightComponent"),_.SphereLightComponent=Pz,Mt.setClassAlias(Pz,"cc.SphereLightComponent"),_.SpotLightComponent=Nz,Mt.setClassAlias(Nz,"cc.SpotLightComponent"),_.ModelComponent=$w,Mt.setClassAlias($w,"cc.ModelComponent"),_.SkinningModelComponent=Tz,Mt.setClassAlias(Tz,"cc.SkinningModelComponent"),_.SkinningModelUnit=Az,Mt.setClassAlias(Az,"cc.SkinningModelUnit"),_.BatchedSkinningModelComponent=Rz,Mt.setClassAlias(Rz,"cc.BatchedSkinningModelComponent"),_.utils=qb;var Lz,Fz,Dz,Uz,kz,zz,Gz,Hz,Vz,Wz,jz,Xz=Ne("cc.animation.UniformProxyFactory")((yz=function(){function t(t,e){l(this,"passIndex",mz,this),l(this,"uniformName",gz,this),l(this,"channelIndex",vz,this),this.passIndex=e||0,this.uniformName=t||""}return t.prototype.forTarget=function(t){var e=t.passes[this.passIndex],i=e.getHandle(this.uniformName);if(!i)throw new Error('Material "'+t.name+'" has no uniform "'+this.uniformName+'"');var r=Mm.getPropertyTypeFromHandle(i);if(r===Hf.UBO){var n=void 0===this.channelIndex?i:e.getHandle(this.uniformName,this.channelIndex,el.FLOAT);if(!n)throw new Error('Uniform "'+this.uniformName+" (in material "+t.name+") has no channel "+this.channelIndex+'"');return function(t,e){for(var i,r=h(t.shaderInfo.blocks);!(i=r()).done;)for(var n,s=h(i.value.members);!(n=s()).done;){var a=n.value;if(a.name===e)return a.count>1}return!1}(e,this.uniformName)?{set:function(t){e.setUniformArray(n,t)}}:{set:function(t){e.setUniform(n,t)}}}if(r===Hf.SAMPLER){var s=Mm.getBindingFromHandle(i),a=e.properties[this.uniformName],o=a&&a.value?a.value+"-texture":em(a.type),l=wm.get(o);return l||(E("Illegal texture default value: "+o+"."),l=wm.get("default-texture")),{set:function(t){t||(t=l);var i=t.getGFXTexture();i&&i.width&&i.height&&(e.bindTexture(s,i),t instanceof np&&e.bindSampler(s,ep.getSampler(_.game._gfxDevice,t.getSamplerHash())))}}}throw new Error("Animations are not available for uniforms with property type "+r+".")},t}(),mz=u((fz=yz).prototype,"passIndex",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),gz=u(fz.prototype,"uniformName",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),vz=u(fz.prototype,"channelIndex",[ci],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),pz=fz))||pz,Yz=Ne("cc.animation.MorphWeightsValueProxy")((Uz=function(){function t(){l(this,"subMeshIndex",Dz,this)}return t.prototype.forTarget=function(t){var e=this;return{set:function(i){t.setWeights(i,e.subMeshIndex)}}},t}(),Dz=u((Fz=Uz).prototype,"subMeshIndex",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Lz=Fz))||Lz,qz=Ne("cc.animation.MorphWeightsAllValueProxy")(kz=function(){function t(){}return t.prototype.forTarget=function(t){return{set:function(e){for(var i,r,n=null!==(i=null===(r=t.mesh)||void 0===r?void 0:r.struct.primitives.length)&&void 0!==i?i:0,s=0;s<n;++s)t.setWeights(e,s)}}},t}())||kz;function Kz(t,e,i,r){var n,s,a,o,h,c,_=new e,d=new e,p=new e,f=Ne(t)((c=function(){function t(t,i,r){l(this,"dataPoint",a,this),l(this,"inTangent",o,this),l(this,"outTangent",h,this),this.dataPoint=t||new e,this.inTangent=i||new e,this.outTangent=r||new e}var n=t.prototype;return n.lerp=function(t,e,n){var s=this.dataPoint,a=t.dataPoint;d=i(d,this.inTangent,n),p=i(p,t.outTangent,n);var o=e*e*e,h=e*e,l=o-2*h+e,u=-2*o+3*h,c=o-h;return _=i(_,s,2*o-3*h+1),_=r(_,_,d,l),_=r(_,_,a,u),_=r(_,_,p,c)},n.getNoLerp=function(){return this.dataPoint},t}(),a=u((s=c).prototype,"dataPoint",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new e}}),o=u(s.prototype,"inTangent",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new e}}),h=u(s.prototype,"outTangent",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new e}}),n=s))||n;if(e===Ns){var m=f.prototype.lerp;f.prototype.lerp=function(t,e,i){var r=m.call(this,t,e,i);return Ns.normalize(r,r),r}}return f}var Zz=t("CubicSplineVec2Value",Kz("cc.CubicSplineVec2Value",Es,Es.multiplyScalar,Es.scaleAndAdd));_.CubicSplineVec2Value=Zz;var Qz=t("CubicSplineVec3Value",Kz("cc.CubicSplineVec3Value",Cs,Cs.multiplyScalar,Cs.scaleAndAdd));_.CubicSplineVec3Value=Qz;var Jz=t("CubicSplineVec4Value",Kz("cc.CubicSplineVec4Value",Os,Os.multiplyScalar,Os.scaleAndAdd));_.CubicSplineVec4Value=Jz;var $z=t("CubicSplineQuatValue",Kz("cc.CubicSplineQuatValue",Ns,Ns.multiplyScalar,Ns.scaleAndAdd));_.CubicSplineQuatValue=$z;var tG=t("CubicSplineNumberValue",Ne("cc.CubicSplineNumberValue")((jz=function(){function t(t,e,i){l(this,"dataPoint",Hz,this),l(this,"inTangent",Vz,this),l(this,"outTangent",Wz,this),this.dataPoint=t,this.inTangent=e,this.outTangent=i}var e=t.prototype;return e.lerp=function(t,e,i){var r=this.dataPoint,n=t.dataPoint,s=e*e*e,a=e*e;return r*(2*s-3*a+1)+this.outTangent*i*(s-2*a+e)+n*(-2*s+3*a)+t.inTangent*i*(s-a)},e.getNoLerp=function(){return this.dataPoint},t}(),Hz=u((Gz=jz).prototype,"dataPoint",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Vz=u(Gz.prototype,"inTangent",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Wz=u(Gz.prototype,"outTangent",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),zz=Gz))||zz);function eG(t){return t*t}function iG(t){return t*(2-t)}function rG(t){return t*t*t}function nG(t){return--t*t*t+1}function sG(t){return t*t*t*t}function aG(t){return 1- --t*t*t*t}function oG(t){return t*t*t*t*t}function hG(t){return--t*t*t*t*t+1}function lG(t){return 1-Math.cos(t*Math.PI/2)}function uG(t){return Math.sin(t*Math.PI/2)}function cG(t){return 0===t?0:Math.pow(1024,t-1)}function _G(t){return 1===t?1:1-Math.pow(2,-10*t)}function dG(t){return 1-Math.sqrt(1-t*t)}function pG(t){return Math.sqrt(1- --t*t)}function fG(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),-i*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4))}function mG(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin(2*(t-e)*Math.PI/.4)+1)}function gG(t){var e=1.70158;return t*t*((e+1)*t-e)}function vG(t){var e=1.70158;return--t*t*((e+1)*t+e)+1}function yG(t){return 1-TG(1-t)}function TG(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}_.CubicSplineNumberValue=tG,t("animation",Object.freeze({__proto__:null,UniformProxyFactory:Xz,MorphWeightsValueProxy:Yz,MorphWeightsAllValueProxy:qz,isPropertyPath:fy,isCustomPath:my,HierarchyPath:gy,ComponentPath:vy,evaluatePath:yy,CubicSplineVec2Value:Zz,CubicSplineVec3Value:Qz,CubicSplineVec4Value:Jz,CubicSplineQuatValue:$z,CubicSplineNumberValue:tG}));var EG=MG(eG,iG),SG=MG(rG,nG),bG=MG(sG,aG),AG=MG(oG,hG),CG=MG(lG,uG),wG=MG(cG,_G),RG=MG(dG,pG),xG=MG(fG,mG),OG=MG(gG,vG),IG=MG(yG,TG);function MG(t,e){return function(i){return i<.5?e(2*i)/2:t(2*i-1)/2+.5}}var BG=Object.freeze({__proto__:null,constant:function(){return 0},linear:function(t){return t},quadIn:eG,quadOut:iG,quadInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},cubicIn:rG,cubicOut:nG,cubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},quartIn:sG,quartOut:aG,quartInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},quintIn:oG,quintOut:hG,quintInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},sineIn:lG,sineOut:uG,sineInOut:function(t){return.5*(1-Math.cos(Math.PI*t))},expoIn:cG,expoOut:_G,expoInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},circIn:dG,circOut:pG,circInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},elasticIn:fG,elasticOut:mG,elasticInOut:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?i*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4)*-.5:i*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4)*.5+1)},backIn:gG,backOut:vG,backInOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)},bounceIn:yG,bounceOut:TG,bounceInOut:function(t){return t<.5?.5*yG(2*t):.5*TG(2*t-1)+.5},smooth:function(t){return t<=0?0:t>=1?1:t*t*(3-2*t)},fade:function(t){return t<=0?0:t>=1?1:t*t*t*(t*(6*t-15)+10)},quadOutIn:EG,cubicOutIn:SG,quartOutIn:bG,quintOutIn:AG,sineOutIn:CG,expoOutIn:wG,circOutIn:RG,elasticOutIn:xG,backOutIn:OG,bounceOutIn:IG});function PG(t,e){for(var i=0,r=t.length-1,n=r>>>1;i<=r;n=i+r>>>1){var s=t[n];if(s>e+1e-6)r=n-1;else{if(!(s<e-1e-6))return n;i=n+1}}return~i}function NG(t,e,i,r,n){var s=1-n;return s*(s*(t+(3*e-t)*n)+3*i*n*n)+r*n*n*n}t("easing",BG),_.bezier=NG;var LG=Math.cos,FG=Math.acos,DG=Math.max,UG=2*Math.PI,kG=Math.sqrt;function zG(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}function GG(t,e){var i=function(t,e){var i,r,n,s,a=e-0,o=e-t[0],h=3*a,l=3*o,u=3*(e-t[2]),c=1/(-a+l-u+(e-1)),_=(h-6*o+u)*c,d=_*(1/3),p=(-h+l)*c,f=1/3*(3*p-_*_),m=f*(1/3),g=(2*_*_*_-9*_*p+a*c*27)/27,v=g/2,y=v*v+m*m*m;if(y<0){var T=1/3*-f,E=kG(T*T*T),S=-g/(2*E),b=FG(S<-1?-1:S>1?1:S),A=2*zG(E);return r=A*LG(b*(1/3))-d,n=A*LG((b+UG)*(1/3))-d,s=A*LG((b+2*UG)*(1/3))-d,0<=r&&r<=1?0<=n&&n<=1?0<=s&&s<=1?DG(r,n,s):DG(r,n):0<=s&&s<=1?DG(r,s):r:0<=n&&n<=1?0<=s&&s<=1?DG(n,s):n:s}if(0===y)return n=-(i=v<0?zG(-v):-zG(v))-d,0<=(r=2*i-d)&&r<=1?0<=n&&n<=1?DG(r,n):r:n;var C=kG(y);return(i=zG(-v+C))-zG(v+C)-d}(t,e),r=t[1];return((1-i)*(r+(t[3]-r)*i)*3+i*i)*i}_.bezierByTime=GG;var HG=t("RatioSampler",function(){function t(t){var e,i;this.ratios=void 0,this._findRatio=void 0,this.ratios=t;for(var r=!0,n=1,s=t.length;n<s;n++)if(e=t[n]-t[n-1],1===n)i=e;else if(Math.abs(e-i)>1e-6){r=!1;break}this._findRatio=r?XG:PG}return t.prototype.sample=function(t){return this._findRatio(this.ratios,t)},t}());_.RatioSampler=HG;var VG=t("AnimCurve",function(){function t(e,i){this.types=void 0,this.type=null,this._values=[],this._lerp=void 0,this._duration=void 0,this._array=void 0,this._duration=i,this._values=e.values;var r=function(e){return"string"==typeof e?e:Array.isArray(e)?e[0]===e[1]&&e[2]===e[3]?t.Linear:t.Bezier(e):t.Linear};if(void 0!==e.easingMethod)this.type=r(e.easingMethod);else if(Array.isArray(e.easingMethods))this.types=e.easingMethods.map(r);else if(void 0!==e.easingMethods){this.types=new Array(this._values.length).fill(null);for(var n=0,s=Object.keys(e.easingMethods);n<s.length;n++){var a=s[n];this.types[a]=r(e.easingMethods[a])}}else this.type=null;var o=e.values[0];(void 0===e.interpolate||e.interpolate)&&(this._lerp=oH(o)),void 0!==e._arrayLength&&(this._array=new Array(e._arrayLength))}t.Bezier=function(t){return t};var e=t.prototype;return e.hasLerp=function(){return!!this._lerp},e.valueAt=function(t){if(void 0===this._array){var e=this._values[t];return e&&e.getNoLerp?e.getNoLerp():e}for(var i=0;i<this._array.length;++i)this._array[i]=this._values[this._array.length*t+i];return this._array},e.valueBetween=function(t,e,i,r,n){if(this._lerp){var s=this.types?this.types[e]:this.type,a=n-i,o=(t-i)/a;if(s&&(o=jG(o,s)),void 0===this._array){var h=this._values[e],l=this._values[r];return this._lerp(h,l,o,a*this._duration)}for(var u=0;u<this._array.length;++u){var c=this._values[this._array.length*e+u],_=this._values[this._array.length*r+u];this._array[u]=this._lerp(c,_,o,a*this._duration)}return this._array}if(void 0===this._array)return this.valueAt(e);for(var d=0;d<this._array.length;++d)this._array[d]=this._values[this._array.length*e+d];return this._array},e.empty=function(){return 0===this._values.length},e.constant=function(){return 1===this._values.length},t}());function WG(t,e,i){var r=e.sample(i);if(r<0)if((r=~r)<=0)r=0;else{if(!(r>=e.ratios.length))return t.valueBetween(i,r-1,e.ratios[r-1],r,e.ratios[r]);r=e.ratios.length-1}return t.valueAt(r)}function jG(t,e){if("string"==typeof e){var i=BG[e];i?t=i(t):B(3906,e)}else Array.isArray(e)&&(t=GG(e,t));return t}function XG(t,e){var i=t.length-1;if(0===i)return 0;var r=t[0];if(e<r)return 0;var n=t[i];if(e>n)return i;var s=(e=(e-r)/(n-r))/(1/i),a=0|s;return s-a<1e-6?a:a+1-s<1e-6?a+1:~(a+1)}VG.Linear=null,_.AnimCurve=VG,t("EventInfo",function(){function t(){this.events=[]}return t.prototype.add=function(t,e){this.events.push({func:t||"",params:e||[]})},t}()),_.sampleAnimationCurve=WG;var YG,qG,KG,ZG,QG,JG,$G,tH,eH,iH,rH,nH,sH,aH,oH=function(){function t(t,e,i,r){return t.lerp(e,i,r)}return function(e){if(null!==e){if("number"==typeof e)return Br;if("object"==typeof e&&e.constructor){if(e instanceof Ns)return i=new Ns,function(t,e,r){return Ns.slerp(i,t,e,r)};if(e instanceof Dt)return function(t){var e=new t;return function(i,r,n){return t.lerp(e,i,r,n),e}}(e.constructor);if(e.constructor===Number)return Br;if("function"==typeof e.lerp)return t}var i}}}(),hH=t("AnimationClip",Ne("cc.AnimationClip")((aH=sH=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"sample",KG,a(e)),l(e,"speed",ZG,a(e)),l(e,"wrapMode",QG,a(e)),l(e,"events",JG,a(e)),l(e,"_duration",$G,a(e)),l(e,"_keys",tH,a(e)),l(e,"_stepness",eH,a(e)),l(e,"_curves",iH,a(e)),l(e,"_commonTargets",rH,a(e)),l(e,"_hash",nH,a(e)),e.frameRate=0,e._ratioSamplers=[],e._runtimeCurves=void 0,e._runtimeEvents=void 0,e._data=null,e}s(e,t),e.createWithSpriteFrames=function(t,i){if(!Array.isArray(t))return B(3905),null;var r=new e;r.sample=i||r.sample,r.duration=t.length/r.sample;for(var n=1/r.sample,s=new Array(t.length),a=new Array(s.length),o=0;o<t.length;o++)s[o]=o*n,a[o]=t[o];return r.keys=[s],r.curves=[{modifiers:[new vy("cc.Sprite"),"spriteFrame"],data:{keys:0,values:a}}],r};var i=e.prototype;return i.onLoaded=function(){this.frameRate=this.sample,this._decodeCVTAs()},i.getPropertyCurves=function(){return this._runtimeCurves||this._createPropertyCurves(),this._runtimeCurves},i.updateEventDatas=function(){delete this._runtimeEvents},i.getEventGroupIndexAtRatio=function(t){return this._runtimeEvents||this._createRuntimeEvents(),function(t,e){for(var i=0,r=t.length-1,n=r>>>1;i<=r;n=i+r>>>1){var s=t[n];if(s>e+1e-6)r=n-1;else{if(!(s<e-1e-6))return n;i=n+1}}return~i}(this._runtimeEvents.ratios,t)},i.hasEvents=function(){return 0!==this.events.length},i.destroy=function(){return _.director.root.dataPoolManager.releaseAnimationClip(this),Ty.destroy(this),t.prototype.destroy.call(this)},i._createPropertyCurves=function(){var t=this;this._ratioSamplers=this._keys.map((function(e){return new HG(e.map((function(e){return e/t._duration})))})),this._runtimeCurves=this._curves.map((function(e){return{curve:new VG(e.data,t._duration),modifiers:e.modifiers,valueAdapter:e.valueAdapter,sampler:t._ratioSamplers[e.data.keys],commonTarget:e.commonTarget}})),this._applyStepness()},i._createRuntimeEvents=function(){for(var t,e=this,i=[],r=[],n=function(){var n=t.value,s=n.frame/e._duration,a=i.findIndex((function(t){return t===s}));a<0&&(a=i.length,i.push(s),r.push({events:[]})),r[a].events.push({functionName:n.func,parameters:n.params})},s=h(this.events.sort((function(t,e){return t.frame-e.frame})));!(t=s()).done;)n();this._runtimeEvents={ratios:i,eventGroups:r}},i._applyStepness=function(){this._runtimeCurves},i._decodeCVTAs=function(){var t=ArrayBuffer.isView(this._nativeAsset)?this._nativeAsset.buffer:this._nativeAsset;if(t){for(var e=this._keys,i=0;i<e.length;++i){var r=e[i];r instanceof JR&&(e[i]=r.decompress(t))}for(var n=0;n<this._curves.length;++n){var s=this._curves[n];s.data.values instanceof JR&&(s.data.values=s.data.values.decompress(t))}}},r(e,[{key:"duration",get:function(){return this._duration},set:function(t){this._duration=t}},{key:"keys",get:function(){return this._keys},set:function(t){this._keys=t}},{key:"eventGroups",get:function(){return this._runtimeEvents||this._createRuntimeEvents(),this._runtimeEvents.eventGroups}},{key:"stepness",get:function(){return this._stepness},set:function(t){this._stepness=t,this._applyStepness()}},{key:"hash",get:function(){if(this._hash)return this._hash;var t=this._nativeAsset,e=new Uint8Array(ArrayBuffer.isView(t)?t.buffer:t);return this._hash=ou(e,666)}},{key:"curves",get:function(){return this._curves},set:function(t){this._curves=t,delete this._runtimeCurves}},{key:"data",get:function(){return this._data}},{key:"commonTargets",get:function(){return this._commonTargets},set:function(t){this._commonTargets=t}}]),e}(Sr),sH.preventDeferredLoadDependents=!0,sH.WrapMode=R_,KG=u((qG=aH).prototype,"sample",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),ZG=u(qG.prototype,"speed",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),QG=u(qG.prototype,"wrapMode",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return R_.Normal}}),JG=u(qG.prototype,"events",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$G=u(qG.prototype,"_duration",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),tH=u(qG.prototype,"_keys",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),eH=u(qG.prototype,"_stepness",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),iH=u(qG.prototype,"_curves",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),rH=u(qG.prototype,"_commonTargets",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),nH=u(qG.prototype,"_hash",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),YG=qG))||YG);function lH(t,e,i){var r,n=e[e.length-1];if(0!==e.length&&fy(n)&&!i){var s=yy.apply(void 0,[t].concat(e.slice(0,e.length-1)));if(null===s)return null;r={isProxy:!1,object:s,property:n}}else{if(!i)return S("Empty animation curve."),null;var a=yy.apply(void 0,[t].concat(e));if(null===a)return null;r={isProxy:!0,proxy:i.forTarget(a)}}return{setValue:function(t){r.isProxy?r.proxy.set(t):r.object[r.property]=t},getValue:function(){return r.isProxy?r.proxy.get?r.proxy.get():(S("Target doesn't provide a get method."),null):r.object[r.property]}}}function uH(t,e,i){var r=lH(t,e,i);if(null===r)return null;var n=r.getValue(),s=_H(n);if(!s)return S("Value is not copyable!"),null;var a=s.createBuffer(),o=s.copy;return Object.assign(r,{peek:function(){return a},pull:function(){var t=r.getValue();o(a,t)},push:function(){r.setValue(a)}})}_.AnimationClip=hH;var cH,_H=((cH=new Map).set(Es,{createBuffer:function(){return new Es},copy:Es.copy}),cH.set(Cs,{createBuffer:function(){return new Cs},copy:Cs.copy}),cH.set(Os,{createBuffer:function(){return new Os},copy:Os.copy}),cH.set(Qs,{createBuffer:function(){return new Qs},copy:Qs.copy}),function(t){return cH.get(null==t?void 0:t.constructor)}),dH=function(){function t(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}var e=t.prototype;return e.play=function(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError(F(3912)):(this._isPlaying=!0,this.onPlay())},e.stop=function(){this._isPlaying&&(this._isPlaying=!1,this.onStop(),this._isPaused=!1)},e.pause=function(){this._isPlaying&&!this._isPaused&&(this._isPaused=!0,this.onPause())},e.resume=function(){this._isPlaying&&this._isPaused&&(this._isPaused=!1,this.onResume())},e.step=function(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()},e.update=function(){},e.onPlay=function(){},e.onPause=function(){},e.onResume=function(){},e.onStop=function(){},e.onError=function(){},r(t,[{key:"isPlaying",get:function(){return this._isPlaying}},{key:"isPaused",get:function(){return this._isPaused}},{key:"isMotionless",get:function(){return!this.isPlaying||this.isPaused}}]),t}(),pH=function(){function t(){this._nodeBlendStates=new Map,this._states=new Set}var e=t.prototype;return e.ref=function(t,e){var i=this._nodeBlendStates.get(t);i||(i={dirty:!1,properties:{}},this._nodeBlendStates.set(t,i));var r=i.properties[e];return r||(r=i.properties[e]=new gH(i,fH(e)?new Cs:new Ns)),++r.refCount,r},e.deRef=function(t,e){var i=this._nodeBlendStates.get(t);if(i){var r=i.properties[e];r&&(--r.refCount,r.refCount>0||(delete i.properties[e],function(t){return!(t.properties.position||t.properties.rotation||t.properties.eulerAngles||t.properties.scale)}(i)&&this._nodeBlendStates.delete(t)))}},e.apply=function(){this._nodeBlendStates.forEach((function(t,e){if(t.dirty){t.dirty=!1;var i,r,n,s=t.properties,a=s.position,o=s.scale,h=s.rotation,l=s.eulerAngles,u=!1;a&&0!==a.weight&&(a.weight=0,i=a.value,u=!0),o&&0!==o.weight&&(o.weight=0,r=o.value,u=!0),h&&0!==h.weight&&(h.weight=0,n=h.value,u=!0),l&&0!==l.weight&&(l.weight=0,n=l.value,u=!0),u&&e.setRTS(n,i,r)}})),this._states.forEach((function(t){t.onBlendFinished()}))},e.bindState=function(t){this._states.add(t)},e.unbindState=function(t){this._states.delete(t)},t}();function fH(t){return!function(t){return"rotation"===t}(t)}var mH,gH=function(){function t(t,e){this.weight=0,this.value=void 0,this.refCount=0,this._node=void 0,this._node=t,this.value=e}return t.prototype.markAsDirty=function(){this._node.dirty=!0},t}();function vH(t,e,i){return 0===i.weight&&Cs.zero(i.value),0===e?i.value:1===e?Cs.copy(i.value,t):Cs.scaleAndAdd(i.value,i.value,t,e)}function yH(t,e,i){if(0===i.weight&&Ns.identity(i.value),0===e)return i.value;if(1===e)return Ns.copy(i.value,t);var r=e/(i.weight+e);return Ns.slerp(i.value,i.value,t,r)}!function(t){t.PLAY="play",t.STOP="stop",t.PAUSE="pause",t.RESUME="resume",t.LASTFRAME="lastframe",t.FINISHED="finished"}(mH||(mH={})),Ft(mH);var TH=function(){function t(t,e,i){this.commonTargetIndex=void 0,this._curve=void 0,this._boundTarget=void 0,this._rootTargetProperty=void 0,this._curveDetail=void 0,this._curve=t.curve,this._curveDetail=t,this._boundTarget=i}var e=t.prototype;return e.applySample=function(t,e,i,r,n){var s;this._curve.empty()||(s=this._curve.hasLerp()&&i?this._curve.valueBetween(t,r.from,r.fromRatio,r.to,r.toRatio):this._curve.valueAt(e),this._setValue(s,n))},e._setValue=function(t){this._boundTarget.setValue(t)},r(t,[{key:"propertyName",get:function(){return this._rootTargetProperty||""}},{key:"curveDetail",get:function(){return this._curveDetail}}]),t}(),EH=t("AnimationState",function(t){function e(e,i){var r;return void 0===i&&(i=""),(r=t.call(this)||this).duration=1,r.speed=1,r.time=0,r.weight=0,r.frameRate=0,r._wrapMode=R_.Normal,r._repeatCount=1,r._currentFramePlayed=!1,r._delay=0,r._delayTime=0,r._wrappedInfo=new I_,r._lastWrapInfo=null,r._lastWrapInfoEvent=null,r._process=r.process,r._target=null,r._targetNode=null,r._clip=void 0,r._name=void 0,r._lastIterations=void 0,r._samplerSharedGroups=[],r._commonTargetStatuses=[],r._curveLoaded=!1,r._ignoreIndex=-1,r._blendStateBuffer=null,r._blendStateWriters=[],r._allowLastFrame=!1,r._blendStateWriterHost={weight:0,enabled:!1},r._clip=e,r._name=i||e&&e.name,r}s(e,t),r(e,[{key:"clip",get:function(){return this._clip}},{key:"name",get:function(){return this._name}},{key:"length",get:function(){return this.duration}},{key:"wrapMode",get:function(){return this._wrapMode},set:function(t){this._wrapMode=t,this.time=0,t&w_.Loop?this.repeatCount=1/0:this.repeatCount=1}},{key:"repeatCount",get:function(){return this._repeatCount},set:function(t){this._repeatCount=t;var e=this._wrapMode&w_.ShouldWrap,i=(this.wrapMode&w_.Reverse)===w_.Reverse;this._process=t!==1/0||e||i?this.process:this.simpleProcess}},{key:"delay",get:function(){return this._delay},set:function(t){this._delayTime=this._delay=t}}]);var i=e.prototype;return i.initialize=function(t,e){var i,r,n=this;if(!this._curveLoaded){this._curveLoaded=!0,this._destroyBlendStateWriters(),this._samplerSharedGroups.length=0,this._blendStateBuffer=null!==(i=null===(r=_.director.getAnimationManager())||void 0===r?void 0:r.blendState)&&void 0!==i?i:null,this._blendStateBuffer&&this._blendStateBuffer.bindState(this),this._targetNode=t;var s=this._clip;this.duration=s.duration,this.speed=s.speed,this.wrapMode=s.wrapMode,this.frameRate=s.sample,(this.wrapMode&w_.Loop)===w_.Loop?this.repeatCount=1/0:this.repeatCount=1;var a=function(t,e,i,r,s){if(!function(t){var e;if(1===t.length&&"string"==typeof t[0])e=t[0];else if(t.length>1){for(var i=0;i<t.length-1;++i)if(!(t[i]instanceof gy))return!1;e=t[t.length-1]}switch(e){case"position":case"scale":case"rotation":case"eulerAngles":return!0;default:return!1}}(i)||!n._blendStateBuffer)return t(e,i,r);var a=yy.apply(void 0,[e].concat(i.slice(0,i.length-1)));if(null!==a&&a instanceof py){var o=i[i.length-1],h=function(t,e,i,r,n){var s=fH(i)?vH:yH,a=t.ref(e,i),o=!1,h=-1;return{destroy:function(){a&&(t.deRef(e,i),a=null)},forTarget:function(){return{get:function(){return e[i]},set:function(t){if(a&&r.enabled){var e=r.weight;if(n)if(1!==e||e!==h)o=!1;else if(o)return;s(t,e,a),a.weight+=e,a.markAsDirty(),o=!0,h=e}}}}}}(n._blendStateBuffer,a,o,n._blendStateWriterHost,s);return n._blendStateWriters.push(h),t(e,[],h)}return null};this._commonTargetStatuses=s.commonTargets.map((function(e){var i=a(uH,t,e.modifiers,e.valueAdapter,!1);return null===i?null:{target:i,changed:!1}})),e||(e=s.getPropertyCurves());for(var o=function(i){var r=e[i],s=n._samplerSharedGroups.find((function(t){return t.sampler===r.sampler}));s||(s={sampler:r.sampler,curves:[],samplerResultCache:{from:0,fromRatio:0,to:0,toRatio:0}},n._samplerSharedGroups.push(s));var o=void 0;if(void 0===r.commonTarget)o=t;else{var h=n._commonTargetStatuses[r.commonTarget];if(!h)return"continue";o=h.target.peek()}var l=a(lH,o,r.modifiers,r.valueAdapter,r.curve.constant());if(null===l);else{var u=new TH(r,o,l);u.commonTargetIndex=r.commonTarget,s.curves.push(u)}},h=0;h<e.length;++h)o(h)}},i.destroy=function(){this._destroyBlendStateWriters()},i.onBlendFinished=function(){this._blendStateWriterHost.enabled=!1},i.emit=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];_.director.getAnimationManager().pushDelayEvent(this._emit,this,e)},i.on=function(t,e,i){return this._target&&this._target.isValid?this._target.on(t,e,i):null},i.once=function(t,e,i){return this._target&&this._target.isValid?this._target.once(t,e,i):null},i.off=function(t,e,i){this._target&&this._target.isValid&&this._target.off(t,e,i)},i.allowLastFrameEvent=function(t){this._allowLastFrame=t},i._setEventTarget=function(t){this._target=t},i.setTime=function(t){this._currentFramePlayed=!1,this.time=t||0,this._lastWrapInfoEvent=null,this._ignoreIndex=-1;var e=this.getWrappedInfo(t,this._wrappedInfo),i=e.direction,r=this._clip.getEventGroupIndexAtRatio(e.ratio);r<0&&(r=~r-1,i<0&&(r+=1),this._ignoreIndex=r)},i.update=function(t){this._delayTime>0&&(this._delayTime-=t,this._delayTime>0)||(this._currentFramePlayed?this.time+=t*this.speed:this._currentFramePlayed=!0,this._process())},i._needReverse=function(t){var e=this.wrapMode,i=!1;return(e&w_.PingPong)===w_.PingPong&&(t-(0|t)==0&&t>0&&(t-=1),1&t&&(i=!i)),(e&w_.Reverse)===w_.Reverse&&(i=!i),i},i.getWrappedInfo=function(t,e){e=e||new I_;var i=!1,r=this.duration,n=this.repeatCount,s=t>0?t/r:-t/r;if(s>=n){s=n,i=!0;var a=n-(0|n);0===a&&(a=1),t=a*r*(t>0?1:-1)}if(t>r){var o=t%r;t=0===o?r:o}else t<0&&0!=(t%=r)&&(t+=r);var h=!1,l=this._wrapMode&w_.ShouldWrap;l&&(h=this._needReverse(s));var u=h?-1:1;return this.speed<0&&(u*=-1),l&&h&&(t=r-t),e.ratio=t/r,e.time=t,e.direction=u,e.stopped=i,e.iterations=s,e},i.sample=function(){var t=this.getWrappedInfo(this.time,this._wrappedInfo);return this._sampleCurves(t.ratio),this._sampleEvents(t),t},i.process=function(){var t,e=this.sample();this._allowLastFrame&&(t=this._lastWrapInfo?this._lastWrapInfo:this._lastWrapInfo=new I_(e),this.repeatCount>1&&(0|e.iterations)>(0|t.iterations)&&this.emit(mH.LASTFRAME,this),t.set(e)),e.stopped&&(this.stop(),this.emit(mH.FINISHED,this))},i.simpleProcess=function(){var t=this.duration,e=this.time%t;e<0&&(e+=t);var i=e/t;this._sampleCurves(i),this._clip.hasEvents()&&this._sampleEvents(this.getWrappedInfo(this.time,this._wrappedInfo)),this._allowLastFrame&&(void 0===this._lastIterations&&(this._lastIterations=i),(this.time>0&&this._lastIterations>i||this.time<0&&this._lastIterations<i)&&this.emit(mH.LASTFRAME,this),this._lastIterations=i)},i.cache=function(){},i.onPlay=function(){this.setTime(0),this._delayTime=this._delay,this._onReplayOrResume(),this.emit(mH.PLAY,this)},i.onStop=function(){this.isPaused||this._onPauseOrStop(),this.emit(mH.STOP,this)},i.onResume=function(){this._onReplayOrResume(),this.emit(mH.RESUME,this)},i.onPause=function(){this._onPauseOrStop(),this.emit(mH.PAUSE,this)},i._sampleCurves=function(t){this._blendStateWriterHost.weight=this.weight,this._blendStateWriterHost.enabled=!0;for(var e=0;e<this._commonTargetStatuses.length;++e){var i=this._commonTargetStatuses[e];i&&(i.target.pull(),i.changed=!1)}for(var r=0,n=this._samplerSharedGroups.length;r<n;++r){var s=this._samplerSharedGroups[r],a=s.sampler,o=s.samplerResultCache,h=0,l=!1;a?(h=a.sample(t))<0&&((h=~h)<=0?h=0:h>=a.ratios.length?h=a.ratios.length-1:(l=!0,o.from=h-1,o.fromRatio=a.ratios[o.from],o.to=h,o.toRatio=a.ratios[o.to],h=o.from)):h=0;for(var u=0,c=s.curves.length;u<c;++u){var _=s.curves[u];if(_.applySample(t,h,l,o,this.weight),void 0!==_.commonTargetIndex){var d=this._commonTargetStatuses[_.commonTargetIndex];d&&(d.changed=!0)}}}for(var p=0;p<this._commonTargetStatuses.length;++p){var f=this._commonTargetStatuses[p];f&&f.changed&&f.target.push()}},i._sampleEvents=function(t){var e=this._clip.eventGroups.length,i=t.direction,r=this._clip.getEventGroupIndexAtRatio(t.ratio);if(r<0&&(r=~r-1,i<0&&(r+=1)),this._ignoreIndex!==r&&(this._ignoreIndex=-1),t.frameIndex=r,!this._lastWrapInfoEvent)return this._fireEvent(r),void(this._lastWrapInfoEvent=new I_(t));var n=this.wrapMode,s=SH(t.iterations),a=this._lastWrapInfoEvent,o=SH(a.iterations),h=a.frameIndex,l=a.direction,u=-1!==o&&s!==o;if(h===r&&u&&1===e)this._fireEvent(0);else if(h!==r||u){i=l;do{if(h!==r){if(-1===i&&0===h&&r>0?((n&w_.PingPong)===w_.PingPong?i*=-1:h=e,o++):1===i&&h===e-1&&r<e-1&&((n&w_.PingPong)===w_.PingPong?i*=-1:h=-1,o++),h===r)break;if(o>s)break}h+=i,_.director.getAnimationManager().pushDelayEvent(this._fireEvent,this,[h])}while(h!==r&&h>-1&&h<e)}this._lastWrapInfoEvent.set(t)},i._emit=function(t,e){this._target&&this._target.isValid&&this._target.emit(t,t,e)},i._fireEvent=function(t){if(this._targetNode&&this._targetNode.isValid){var e=this._clip.eventGroups;if(!(t<0||t>=e.length||this._ignoreIndex===t))for(var i,r=e[t],n=this._targetNode.components,s=h(r.events);!(i=s()).done;)for(var a,o=i.value,l=o.functionName,u=h(n);!(a=u()).done;){var c=a.value,_=c[l];"function"==typeof _&&_.apply(c,o.parameters)}}},i._onReplayOrResume=function(){_.director.getAnimationManager().addAnimation(this)},i._onPauseOrStop=function(){_.director.getAnimationManager().removeAnimation(this)},i._destroyBlendStateWriters=function(){for(var t=0;t<this._blendStateWriters.length;++t)this._blendStateWriters[t].destroy();this._blendStateWriters.length=0,this._blendStateBuffer&&(this._blendStateBuffer.unbindState(this),this._blendStateBuffer=null),this._blendStateWriterHost.enabled=!1},r(e,[{key:"curveLoaded",get:function(){return this._curveLoaded}}]),e}(dH));function SH(t){return t-(0|t)==0&&(t-=1),0|t}_.AnimationState=EH;var bH,AH,CH,wH,RH,xH,OH,IH,MH,BH,PH,NH,LH,FH,DH,UH,kH,zH=function(t){function e(){var e;return(e=t.call(this)||this)._managedStates=[],e._fadings=[],e}s(e,t);var i=e.prototype;return i.update=function(t){if(!this.isMotionless){for(var e=0;e<this._managedStates.length;++e){var i=this._managedStates[e].state;i&&(i.weight=0)}for(var r=1,n=this._fadings.length,s=0;s<this._fadings.length;++s){var a=this._fadings[s];a.easeTime+=t;var o=0===a.easeDuration?1:Mr(a.easeTime/a.easeDuration),h=o*r;if(r*=1-o,a.target.state&&(a.target.state.weight+=h),a.easeTime>=a.easeDuration){n=s+1,a.easeTime=a.easeDuration;break}}if(n!==this._fadings.length){for(var l=n;l<this._fadings.length;++l){var u=this._fadings[l];--u.target.reference,u.target.reference<=0&&(u.target.state&&u.target.state.stop(),H(this._managedStates,u.target))}this._fadings.splice(n)}for(var c=0;c<this._managedStates.length;++c){var _=this._managedStates[c].state;_&&_.isMotionless&&_.sample()}}},i.crossFade=function(t,e){var i;0===this._managedStates.length&&(e=0),0===e&&this.clear();var r=this._managedStates.find((function(e){return e.state===t}));r?(null===(i=r.state)||void 0===i?void 0:i.isMotionless)&&r.state.play():(r={state:t,reference:0},t&&t.play(),this._managedStates.push(r)),++r.reference,this._fadings.unshift({easeDuration:e,easeTime:0,target:r})},i.clear=function(){for(var t=0;t<this._managedStates.length;++t){var e=this._managedStates[t].state;e&&e.stop()}this._managedStates.length=0,this._fadings.length=0},i.onPlay=function(){t.prototype.onPlay.call(this),_.director.getAnimationManager().addCrossFade(this)},i.onPause=function(){t.prototype.onPause.call(this),_.director.getAnimationManager().removeCrossFade(this);for(var e=0;e<this._managedStates.length;++e){var i=this._managedStates[e].state;i&&i.pause()}},i.onResume=function(){t.prototype.onResume.call(this),_.director.getAnimationManager().addCrossFade(this);for(var e=0;e<this._managedStates.length;++e){var i=this._managedStates[e].state;i&&i.resume()}},i.onStop=function(){t.prototype.onStop.call(this),_.director.getAnimationManager().removeCrossFade(this),this.clear()},e}(dH),GH=function(e){return t({AnimationComponent:e,Animation:e}),e}((bH=Ne("cc.Animation"),AH=qe(),CH=Fe(99),wH=We(),RH=pi([hH]),xH=$e(),OH=pi(hH),IH=$e(),MH=$e(),BH=pi([hH]),bH(PH=AH(PH=CH(PH=Ve(PH=wH((kH=UH=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"playOnLoad",LH,a(e)),e._crossFade=new zH,e._nameToState=it(!0),l(e,"_clips",FH,a(e)),l(e,"_defaultClip",DH,a(e)),e._hasBeenPlayed=!1,e}s(e,t);var i=e.prototype;return i.onLoad=function(){for(var t in this.clips=this._clips,this._nameToState)this._nameToState[t].initialize(this.node)},i.start=function(){this.playOnLoad&&!this._hasBeenPlayed&&this._defaultClip&&this.crossFade(this._defaultClip.name,0)},i.onEnable=function(){this._crossFade.resume()},i.onDisable=function(){this._crossFade.pause()},i.onDestroy=function(){for(var t in this._crossFade.stop(),this._nameToState)this._nameToState[t].destroy();this._nameToState=it(!0)},i.play=function(t){if(this._hasBeenPlayed=!0,!t){if(!this._defaultClip)return;t=this._defaultClip.name}this.crossFade(t,0)},i.crossFade=function(t,e){void 0===e&&(e=.3),this._hasBeenPlayed=!0;var i=this._nameToState[t];i&&(this._crossFade.play(),this._crossFade.crossFade(i,e))},i.pause=function(){this._crossFade.pause()},i.resume=function(){this._crossFade.resume()},i.stop=function(){this._crossFade.stop()},i.getAnimationState=function(t){return this.getState(t)},i.getState=function(t){var e=this._nameToState[t];return e&&!e.curveLoaded&&e.initialize(this.node),e||null},i.createState=function(t,e){return e=e||t.name,this.removeState(e),this._doCreateState(t,e)},i.removeState=function(t){var e=this._nameToState[t];e&&(e.allowLastFrameEvent(!1),e.stop(),delete this._nameToState[t])},i.addClip=function(t,e){return V(this._clips,t)||this._clips.push(t),this.createState(t,e)},i.removeClip=function(t,e){var i;for(var r in this._nameToState){var n=this._nameToState[r];if(n.clip===t){i=n;break}}if(t===this._defaultClip){if(!e)return void I(3902);this._defaultClip=null}if(i&&i.isPlaying){if(!e)return void I(3903);i.stop()}this._clips=this._clips.filter((function(e){return e!==t})),i&&delete this._nameToState[i.name]},i.on=function(e,i,r,n){var s=t.prototype.on.call(this,e,i,r,n);return e===mH.LASTFRAME&&this._syncAllowLastFrameEvent(),s},i.once=function(e,i,r){var n=t.prototype.once.call(this,e,i,r);return e===mH.LASTFRAME&&this._syncAllowLastFrameEvent(),n},i.off=function(e,i,r){t.prototype.off.call(this,e,i,r),e===mH.LASTFRAME&&this._syncDisallowLastFrameEvent()},i._createState=function(t,e){return new EH(t,e)},i._doCreateState=function(t,e){var i=this._createState(t,e);return i._setEventTarget(this),i.allowLastFrameEvent(this.hasEventListener(mH.LASTFRAME)),this.node&&i.initialize(this.node),this._nameToState[i.name]=i,i},i._getStateByNameOrDefaultClip=function(t){if(!t){if(!this._defaultClip)return null;t=this._defaultClip.name}return this._nameToState[t]||null},i._removeStateOfAutomaticClip=function(t){for(var e in this._nameToState){var i=this._nameToState[e];HH(t,i.clip)&&(i.stop(),delete this._nameToState[e])}},i._syncAllowLastFrameEvent=function(){if(this.hasEventListener(mH.LASTFRAME))for(var t in this._nameToState)this._nameToState[t].allowLastFrameEvent(!0)},i._syncDisallowLastFrameEvent=function(){if(!this.hasEventListener(mH.LASTFRAME))for(var t in this._nameToState)this._nameToState[t].allowLastFrameEvent(!1)},r(e,[{key:"clips",get:function(){return this._clips},set:function(t){var e=this;this._crossFade&&this._crossFade.clear();for(var i,r=h(this._clips);!(i=r()).done;){var n=i.value;n&&this._removeStateOfAutomaticClip(n)}for(var s,a=h(t);!(s=a()).done;){var o=s.value;o&&this.createState(o)}var l=t.find((function(t){return HH(t,e._defaultClip)}));this._defaultClip=l||null,this._clips=t}},{key:"defaultClip",get:function(){return this._defaultClip},set:function(t){this._defaultClip=t,t&&(this._clips.findIndex((function(e){return HH(e,t)}))>=0||(this._clips.push(t),this.createState(t)))}}]),e}(ir(ds)),UH.EventType=mH,u((NH=kH).prototype,"clips",[RH,xH],Object.getOwnPropertyDescriptor(NH.prototype,"clips"),NH.prototype),u(NH.prototype,"defaultClip",[OH,IH],Object.getOwnPropertyDescriptor(NH.prototype,"defaultClip"),NH.prototype),LH=u(NH.prototype,"playOnLoad",[ke,MH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),FH=u(NH.prototype,"_clips",[BH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),DH=u(NH.prototype,"_defaultClip",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),PH=NH))||PH)||PH)||PH)||PH)||PH));function HH(t,e){return t===e||!(!t||!e||t.name!==e.name&&t._uuid!==e._uuid)}var VH,WH,jH,XH,YH,qH,KH,ZH,QH,JH,$H,tV,eV,iV,rV,nV,sV,aV,oV,hV,lV=new Hs,uV=new Hs,cV=[],_V=t("SkeletalAnimationState",function(t){function e(e,i){var r;return void 0===i&&(i=""),(r=t.call(this,e,i)||this)._frames=1,r._bakedDuration=0,r._animInfo=null,r._sockets=[],r._animInfoMgr=void 0,r._comps=[],r._parent=null,r._curvesInited=!1,r._animInfoMgr=_.director.root.dataPoolManager.jointAnimationInfo,r}s(e,t);var i=e.prototype;return i.initialize=function(e){if(!this._curveLoaded){this._comps.length=0;for(var i=e.getComponentsInChildren(Tz),r=0;r<i.length;++r){var n=i[r];n.skinningRoot===e&&this._comps.push(n)}this._parent=e.getComponent("cc.SkeletalAnimation");var s=this._parent.useBakedAnimation;t.prototype.initialize.call(this,e,s?cV:void 0),this._curvesInited=!s;var a=Ty.getOrExtract(this.clip).info;this._frames=a.frames-1,this._animInfo=this._animInfoMgr.getData(e.uuid),this._bakedDuration=this._frames/a.sample}},i.onPlay=function(){if(t.prototype.onPlay.call(this),this._parent.useBakedAnimation){this._sampleCurves=this._sampleCurvesBaked,this.duration=this._bakedDuration,this._animInfoMgr.switchClip(this._animInfo,this._clip);for(var e=0;e<this._comps.length;++e)this._comps[e].uploadAnimation(this.clip)}else this._sampleCurves=t.prototype._sampleCurves,this.duration=this._clip.duration,this._curvesInited||(this._curveLoaded=!1,t.prototype.initialize.call(this,this._targetNode),this._curvesInited=!0)},i.rebuildSocketCurves=function(t){if(this._sockets.length=0,this._targetNode)for(var e=this._targetNode,i=0;i<t.length;++i){var r=t[i],n=e.getChildByPath(r.path);if(r.target){for(var s=Ty.getOrExtract(this.clip),a=r.path,o=s.data[a],h=n,l=void 0;!o;){var u=a.lastIndexOf("/");if(a=a.substring(0,u),o=s.data[a],h&&(l||(l=Hs.identity(uV)),Hs.fromRTS(lV,h.rotation,h.position,h.scale),Hs.multiply(l,lV,l),h=h.parent),u<0)break}for(var c=o&&o.worldMatrix.values,_=s.info.frames,d=[],p=0;p<_;p++){var f;f=c&&l?Hs.multiply(lV,c[p],l):c?c[p]:l||Hs.IDENTITY;var m={pos:new Cs,rot:new Ns,scale:new Cs};Hs.toRTS(f,m.rot,m.pos,m.scale),d.push(m)}this._sockets.push({target:r.target,frames:d})}}},i._sampleCurvesBaked=function(t){var e=this._animInfo,i=t*this._frames+.5|0;if(i!==e.data[0]){e.data[0]=i,e.dirty=!0;for(var r=0;r<this._sockets.length;++r){var n=this._sockets[r],s=n.target,a=n.frames[i],o=a.pos,h=a.rot,l=a.scale;s.setRTS(h,o,l)}}},e}(EH)),dV=t("Socket",(VH=Ne("cc.SkeletalAnimation.Socket"),WH=pi(py),VH((YH=u((XH=function(t,e){void 0===t&&(t=""),void 0===e&&(e=null),l(this,"path",YH,this),l(this,"target",qH,this),this.path=t,this.target=e}).prototype,"path",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),qH=u(XH.prototype,"target",[WH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jH=XH))||jH));Mt.setClassAlias(dV,"cc.SkeletalAnimationComponent.Socket");var pV=new Hs,fV=new Hs;function mV(t,e,i){void 0===e&&(e=""),void 0===i&&(i=[]);for(var r=0;r<t.children.length;r++){var n=t.children[r];if(n){var s=e?e+"/"+n.name:n.name;i.push(s),mV(n,s,i)}}return i}var gV,vV,yV,TV=function(e){return t({SkeletalAnimationComponent:e,SkeletalAnimation:e}),e}((KH=Ne("cc.SkeletalAnimation"),ZH=qe(),QH=Fe(99),JH=We(),$H=pi([dV]),tV=$e(),eV=$e(),iV=pi([dV]),KH(rV=ZH(rV=QH(rV=Ve(rV=JH((hV=oV=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"_useBakedAnimation",sV,a(e)),l(e,"_sockets",aV,a(e)),e}s(e,t);var i=e.prototype;return i.onDestroy=function(){t.prototype.onDestroy.call(this),_.director.root.dataPoolManager.jointAnimationInfo.destroy(this.node.uuid),_.director.getAnimationManager().removeSockets(this.node,this._sockets)},i.start=function(){this.sockets=this._sockets,this.useBakedAnimation=this._useBakedAnimation,t.prototype.start.call(this)},i.querySockets=function(){var t=this._defaultClip&&Object.keys(Ty.getOrExtract(this._defaultClip).data).sort().reduce((function(t,e){return e.startsWith(t[t.length-1])||t.push(e),t}),[])||[];if(!t.length)return["please specify a valid default animation clip first"];for(var e=[],i=0;i<t.length;i++){var r=t[i],n=this.node.getChildByPath(r);n&&(e.push(r),mV(n,r,e))}return e},i.rebuildSocketAnimations=function(){for(var t,e=h(this._sockets);!(t=e()).done;){var i=t.value,r=this.node.getChildByPath(i.path),n=i.target;r&&n&&(n.name=i.path.substring(i.path.lastIndexOf("/")+1)+" Socket",n.parent=this.node,by(r,this.node,pV),Hs.fromRTS(fV,n.rotation,n.position,n.scale),Hs.equals(fV,pV)||(n.matrix=pV))}for(var s=0,a=Object.keys(this._nameToState);s<a.length;s++){var o=a[s];this._nameToState[o].rebuildSocketCurves(this._sockets)}},i.createSocket=function(t){var e=this._sockets.find((function(e){return e.path===t}));if(e)return e.target;if(!this.node.getChildByPath(t))return console.warn("illegal socket path"),null;var i=new py;return i.parent=this.node,this._sockets.push(new dV(t,i)),this.rebuildSocketAnimations(),i},i._createState=function(t,e){return new _V(t,e)},i._doCreateState=function(e,i){var r=t.prototype._doCreateState.call(this,e,i);return r.rebuildSocketCurves(this._sockets),r},r(e,[{key:"sockets",get:function(){return this._sockets},set:function(t){if(!this._useBakedAnimation){var e=_.director.getAnimationManager();e.removeSockets(this.node,this._sockets),e.addSockets(this.node,t)}this._sockets=t,this.rebuildSocketAnimations()}},{key:"useBakedAnimation",get:function(){return this._useBakedAnimation},set:function(t){this._useBakedAnimation=t;for(var e=this.node.getComponentsInChildren(Tz),i=0;i<e.length;++i){var r=e[i];r.skinningRoot===this.node&&r.setUseBakedAnimation(this._useBakedAnimation)}this._useBakedAnimation?_.director.getAnimationManager().removeSockets(this.node,this._sockets):_.director.getAnimationManager().addSockets(this.node,this._sockets)}}]),e}(GH),oV.Socket=dV,u((nV=hV).prototype,"sockets",[$H,tV],Object.getOwnPropertyDescriptor(nV.prototype,"sockets"),nV.prototype),u(nV.prototype,"useBakedAnimation",[eV],Object.getOwnPropertyDescriptor(nV.prototype,"useBakedAnimation"),nV.prototype),sV=u(nV.prototype,"_useBakedAnimation",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),aV=u(nV.prototype,"_sockets",[iV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),rV=nV))||rV)||rV)||rV)||rV)||rV));$s(GH.prototype,"Animation",[{name:"getAnimationState",newName:"getState"},{name:"addClip",newName:"createState"},{name:"removeClip",newName:"removeState",customFunction:function(){var t=arguments.length<=0?void 0:arguments[0];return GH.prototype.removeState.call(this,t.name)}}]),_.AnimationComponent=GH,Mt.setClassAlias(GH,"cc.AnimationComponent"),_.SkeletalAnimationComponent=TV,Mt.setClassAlias(TV,"cc.SkeletalAnimationComponent");var EV,SV,bV,AV,CV=t("AnimationManager",Ne((yV=vV=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._anims=new z([]),e._delayEvents=[],e._blendStateBuffer=new pH,e._crossFades=[],e._sockets=[],e}s(e,t);var i=e.prototype;return i.addCrossFade=function(t){this._crossFades.push(t)},i.removeCrossFade=function(t){H(this._crossFades,t)},i.update=function(t){for(var e=this._delayEvents,i=this._crossFades,r=this._sockets,n=0,s=i.length;n<s;n++)i[n].update(t);var a=this._anims,o=a.array;for(a.i=0;a.i<o.length;++a.i){var h=o[a.i];h.isMotionless||h.update(t)}this._blendStateBuffer.apply();for(var l=_.director.getTotalFrames(),u=0,c=r.length;u<c;u++){var d=r[u],p=d.target,f=d.transform;p.matrix=cC(f,l)}for(var m=0,g=e.length;m<g;m++){var v=e[m];v.fn.apply(v.thisArg,v.args)}e.length=0},i.destruct=function(){},i.addAnimation=function(t){-1===this._anims.array.indexOf(t)&&this._anims.push(t)},i.removeAnimation=function(t){var e=this._anims.array.indexOf(t);e>=0?this._anims.fastRemoveAt(e):B(3907)},i.pushDelayEvent=function(t,e,i){this._delayEvents.push({fn:t,thisArg:e,args:i})},i.addSockets=function(t,e){for(var i=this,r=function(r){var n=e[r];if(i._sockets.find((function(t){return t.target===n.target})))return"continue";var s=t.getChildByPath(n.path),a=n.target&&s&&_C(s,t);a&&i._sockets.push({target:n.target,transform:a})},n=0;n<e.length;++n)r(n)},i.removeSockets=function(t,e){for(var i=0;i<e.length;++i)for(var r=e[i],n=0;n<this._sockets.length;++n){var s=this._sockets[n];if(s.target===r.target){dC(s.transform.node),this._sockets[n]=this._sockets[this._sockets.length-1],this._sockets.length--;break}}},r(e,[{key:"blendState",get:function(){return this._blendStateBuffer}}]),e}(qO),vV.ID="animation",gV=yV))||gV);NF.on(PF.EVENT_INIT,(function(){var t=new CV;NF.registerSystem(CV.ID,t,tI.PRIORITY_SYSTEM)})),_.AnimationManager=CV,_.easing=BG;var wV=t("HierachyModifier",Ne("cc.HierachyModifier")(EV=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e}(gy))||EV);_.HierachyModifier=wV;var RV=t("ComponentModifier",Ne("cc.ComponentModifier")(SV=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e}(vy))||SV);_.ComponentModifier=RV;var xV=t("CurveValueAdapter",Ne("cc.CurveValueAdapter")(bV=function(){function t(){}return t.prototype.forTarget=function(){return{set:function(){}}},t}())||bV);_.CurveValueAdapter=xV;var OV=t("UniformCurveValueAdapter",Ne("cc.UniformCurveValueAdapter")(AV=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e}(Xz))||AV);function IV(t){return"string"==typeof t}function MV(t){return"number"==typeof t}function BV(t,e){return t instanceof e}_.UniformCurveValueAdapter=OV,_.isPropertyModifier=IV,_.isElementModifier=MV,_.isCustomTargetModifier=BV;var PV,NV=function(){function t(t,e,i){this._id=void 0,this._opts=void 0,this._accumStart=void 0,this._total=0,this._value=0,this._averageValue=0,this._accumValue=0,this._accumSamples=0,this._id=t,this._opts=e,this._accumStart=i}r(t,[{key:"value",get:function(){return this._value},set:function(t){this._value=t}}]);var e=t.prototype;return e.sample=function(t){this._average(this._value,t)},e.human=function(){var t=this._opts,e=t.average,i=t.isInteger,r=e?this._averageValue:this._value;return i?Math.round(r):Math.round(100*r)/100},e.alarm=function(){return this._opts.below&&this._value<this._opts.below||this._opts.over&&this._value>this._opts.over},e._average=function(t,e){if(void 0===e&&(e=0),this._opts.average){this._accumValue+=t,++this._accumSamples;var i=e;i-this._accumStart>=this._opts.average&&(this._averageValue=this._accumValue/this._accumSamples,this._accumValue=0,this._accumStart=i,this._accumSamples=0)}},t}(),LV=Ne("cc.PerfCounter")(PV=function(t){function e(e,i,r){var n;return(n=t.call(this,e,i,r)||this)._time=void 0,n._time=r,n}s(e,t);var i=e.prototype;return i.start=function(t){void 0===t&&(t=0),this._time=t},i.end=function(t){void 0===t&&(t=0),this._value=t-this._time,this._average(this._value)},i.tick=function(){this.end(),this.start()},i.frame=function(t){var e=t,i=e-this._time;this._total++,i>(this._opts.average||1e3)&&(this._value=1e3*this._total/i,this._total=0,this._time=e,this._average(this._value))},e}(NV))||PV,FV={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,".":10},DV={fps:{desc:"Framerate (FPS)",below:30,average:500,isInteger:!0},draws:{desc:"Draw call",isInteger:!0},frame:{desc:"Frame time (ms)",min:0,max:50,average:500},instances:{desc:"Instance Count",isInteger:!0},tricount:{desc:"Triangle",isInteger:!0},logic:{desc:"Game Logic (ms)",min:0,max:50,average:500,color:"#080"},physics:{desc:"Physics (ms)",min:0,max:50,average:500},render:{desc:"Renderer (ms)",min:0,max:50,average:500,color:"#f90"},textureMemory:{desc:"GFX Texture Mem(M)"},bufferMemory:{desc:"GFX Buffer Mem(M)"}},UV=t("Profiler",function(){function t(){this._stats=null,this.id="__Profiler__",this._showFPS=!1,this._rootNode=null,this._device=null,this._canvas=null,this._ctx=null,this._texture=null,this._region=new vu,this._canvasArr=[],this._regionArr=[this._region],this.digitsData=null,this.offsetData=null,this.pass=null,this._canvasDone=!1,this._statsDone=!1,this._inited=!1,this._lineHeight=256/(Object.keys(DV).length+1),this._wordHeight=0,this._eachNumWidth=0,this._totalLines=0,this.lastTime=0,this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),this._canvasArr.push(this._canvas)}var e=t.prototype;return e.isShowingStats=function(){return this._showFPS},e.hideStats=function(){this._showFPS&&(this._rootNode&&(this._rootNode.active=!1),_.game.off(_.Game.EVENT_RESTART,this.generateNode,this),_.director.off(_.Director.EVENT_BEFORE_UPDATE,this.beforeUpdate,this),_.director.off(_.Director.EVENT_AFTER_UPDATE,this.afterUpdate,this),_.director.off(_.Director.EVENT_BEFORE_PHYSICS,this.beforePhysics,this),_.director.off(_.Director.EVENT_AFTER_PHYSICS,this.afterPhysics,this),_.director.off(_.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),_.director.off(_.Director.EVENT_AFTER_DRAW,this.afterDraw,this),this._showFPS=!1)},e.showStats=function(){this._showFPS||(this._device||(this._device=_.director.root.device),this.generateCanvas(),this.generateStats(),_.game.once(_.Game.EVENT_ENGINE_INITED,this.generateNode,this),_.game.on(_.Game.EVENT_RESTART,this.generateNode,this),this._rootNode&&(this._rootNode.active=!0),_.director.on(_.Director.EVENT_BEFORE_UPDATE,this.beforeUpdate,this),_.director.on(_.Director.EVENT_AFTER_UPDATE,this.afterUpdate,this),_.director.on(_.Director.EVENT_BEFORE_PHYSICS,this.beforePhysics,this),_.director.on(_.Director.EVENT_AFTER_PHYSICS,this.afterPhysics,this),_.director.on(_.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),_.director.on(_.Director.EVENT_AFTER_DRAW,this.afterDraw,this),this._showFPS=!0,this._canvasDone=!0,this._statsDone=!0)},e.generateCanvas=function(){if(!this._canvasDone){this._ctx&&this._canvas&&(this._canvas.width=256,this._canvas.height=256,this._canvas.style.width=""+this._canvas.width,this._canvas.style.height=""+this._canvas.height,this._ctx.font="23px Arial",this._ctx.textBaseline="top",this._ctx.fillStyle="#fff",this._texture=this._device.createTexture(new Gu(vl.TEX2D,yl.SAMPLED|yl.TRANSFER_DST,il.RGBA8,256,256)),this._region.texExtent.width=256,this._region.texExtent.height=256)}},e.generateStats=function(){if(!this._statsDone&&this._ctx&&this._canvas){this._stats=null;var t=performance.now();this._ctx.textAlign="left";var e=0;for(var i in DV){var r=DV[i];this._ctx.fillText(r.desc,0,e*this._lineHeight),r.counter=new LV(i,r,t),e++}this._totalLines=e,this._wordHeight=this._totalLines*this._lineHeight/this._canvas.height;for(var n=0;n<"0123456789. ".length;++n){var s=this._ctx.measureText("0123456789. "[n]).width;this._eachNumWidth=Math.max(this._eachNumWidth,s)}for(var a=0;a<"0123456789. ".length;++a)this._ctx.fillText("0123456789. "[a],a*this._eachNumWidth,this._totalLines*this._lineHeight);this._eachNumWidth/=this._canvas.width,this._stats=DV,this._canvasArr[0]=this._canvas,this._device.copyTexImagesToTexture(this._canvasArr,this._texture,this._regionArr)}},e.generateNode=function(){if(!this._rootNode||!this._rootNode.isValid){this._rootNode=new py("PROFILER_NODE"),_.game.addPersistRootNode(this._rootNode);var t=new py("Profiler_Camera");t.setPosition(0,0,1.5),t.parent=this._rootNode;var e=t.addComponent("cc.Camera");e.projection=BM.ProjectionType.ORTHO,e.orthoHeight=1,e.near=1,e.far=2,e.visibility=vp.BitMask.PROFILER,e.clearFlags=Bl.NONE,e.priority=4294967295,e.flows=["UIFlow"];var i=new py("Profiler_Root");i.parent=this._rootNode;for(var r=.4/this._totalLines,n=.4/this._wordHeight,s=r/23,a=this._eachNumWidth*this._canvas.width*s,o=[0,.4,0,n,.4,0,n,0,0,0,0,0],h=[0,2,1,0,3,2],l=[0,0,-1,0,1,0,-1,0,1,this._wordHeight,-1,0,0,this._wordHeight,-1,0],u=0,c=0;c<this._totalLines;c++)for(var d=0;d<8;d++){o.push(n+d*a,.4-c*r,0),o.push(n+(d+1)*a,.4-c*r,0),o.push(n+(d+1)*a,.4-(c+1)*r,0),o.push(n+d*a,.4-(c+1)*r,0),u=4*(8*c+d+1),h.push(0+u,2+u,1+u,0+u,3+u,2+u);var p=8*c+d,f=Math.floor(p/4),m=p-4*f;l.push(0,this._wordHeight,f,m),l.push(this._eachNumWidth,this._wordHeight,f,m),l.push(this._eachNumWidth,1,f,m),l.push(0,1,f,m)}var g=i.addComponent($w);g.mesh=Yb({positions:o,indices:h,colors:l});var v=new mg;v.initialize({effectName:"profiler"});var y=this.pass=v.passes[0],T=y.getBinding("mainTexture"),E=y.getBinding("digits"),S=y.getBinding("offset");y.bindTexture(T,this._texture),this.digitsData=y.blocks[E],this.offsetData=y.blocks[S],this.offsetData[3]=-1,g.material=v,g.node.layer=vp.Enum.PROFILER,this._inited=!0}},e.beforeUpdate=function(){if(this._stats){var t=performance.now();this._stats.frame.counter.end(t),this._stats.frame.counter.start(t),this._stats.logic.counter.start(t)}},e.afterUpdate=function(){if(this._stats){var t=performance.now();_.director.isPaused()?this._stats.frame.counter.start(t):this._stats.logic.counter.end(t)}},e.beforePhysics=function(){if(this._stats){var t=performance.now();this._stats.physics.counter.start(t)}},e.afterPhysics=function(){if(this._stats){var t=performance.now();this._stats.physics.counter.end(t)}},e.beforeDraw=function(){if(this._stats){var t=this._device,e=t.screenSpaceSignY,i=t.surfaceTransform;if(i!==this.offsetData[3]){var r=Gs[i],n=-.9*e;this.offsetData[0]=-.9*r[0]+n*r[2],this.offsetData[1]=-.9*r[1]+n*r[3],this.offsetData[2]=this._eachNumWidth,this.offsetData[3]=i}this.pass._rootBufferDirty=!0;var s=performance.now();this._stats.render.counter.start(s)}},e.afterDraw=function(){if(this._stats&&this._inited){var t=performance.now();if(this._stats.fps.counter.frame(t),this._stats.render.counter.end(t),!(t-this.lastTime<500)){this.lastTime=t;var e=this._device;this._stats.draws.counter.value=e.numDrawCalls,this._stats.instances.counter.value=e.numInstances,this._stats.bufferMemory.counter.value=e.memoryStatus.bufferSize/1048576,this._stats.textureMemory.counter.value=e.memoryStatus.textureSize/1048576,this._stats.tricount.counter.value=e.numTris;var i=0,r=this.digitsData;for(var n in this._stats){var s=this._stats[n];s.counter.sample(t);for(var a=s.counter.human().toString(),o=7;o>=0;o--){var h=8*i+o,l=a[a.length-(8-o)],u=FV[l];void 0===u&&(u=11),r[h]=u}i++}}}},t}()),kV=t("profiler",new UV);_.profiler=kV;var zV=function(){var t=e.prototype;function e(){this.handle=0,this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this._splashFinish=!1,this._loadFinish=!1,this._directCall=!1}return t.main=function(t){if(null!=t){if(window._CCSettings&&window._CCSettings.splashScreen){var e=this.setting=window._CCSettings.splashScreen;e.totalTime=null!=this.setting.totalTime?this.setting.totalTime:3e3,e.base64src=this.setting.base64src||"",e.effect=this.setting.effect||"FADE-INOUT",e.clearColor=this.setting.clearColor||new du(.88,.88,.88,1),e.displayRatio=null!=this.setting.displayRatio?this.setting.displayRatio:.4,e.displayWatermark=null==this.setting.displayWatermark||this.setting.displayWatermark}else this.setting={totalTime:3e3,base64src:"",effect:"FADE-INOUT",clearColor:new du(.88,.88,.88,1),displayRatio:.4,displayWatermark:!0};if(""===this.setting.base64src||this.setting.totalTime<=0)this.callBack&&this.callBack(),this.callBack=null,this.setting=null,this._directCall=!0;else{_.view.enableRetina(!0);var i=window._CCSettings.designResolution;i?_.view.setDesignResolutionSize(i.width,i.height,i.policy):_.view.setDesignResolutionSize(960,640,4),this.root=t,this.device=t.device,_.game.once(_.Game.EVENT_GAME_INITED,(function(){_.director._lateUpdate=performance.now()}),_.director),this.callBack=null,this.cancelAnimate=!1,this.startTime=-1;var r=this.setting.clearColor;this.clearColors=[new du(r.x,r.y,r.z,r.w)];var n=this.device,s=n.width,a=n.height,o=n.surfaceTransform;this.screenWidth=o%2?a:s,this.screenHeight=o%2?s:a,this.image=new Image,this.image.onload=this.init.bind(this),this.image.src=this.setting.base64src}}else console.error("RENDER ROOT IS NULL.")},t.setOnFinish=function(t){if(this._directCall&&t)return e._ins=void 0,void t();this.callBack=t},t._tryToStart=function(){this._splashFinish&&this._loadFinish&&this.callBack&&(this.callBack(),this.hide(),_.game.resume())},t.init=function(){var t=this;this.initCMD(),this.initIA(),this.initPSO(),this.setting.displayWatermark&&this.initText(),_.game.pause(),this.handle=requestAnimationFrame((function e(i){if(!t.cancelAnimate){t.startTime<0&&(t.startTime=i);var r=i-t.startTime,n=nG(Mr(r/t.setting.totalTime));"NONE"===t.setting.effect&&(n=1),t.material.setProperty("u_precent",n),t.material.passes[0].update(),t.setting.displayWatermark&&t.textMaterial&&(t.textMaterial.setProperty("u_precent",n),t.textMaterial.passes[0].update()),t.frame(i),r>t.setting.totalTime&&(t.splashFinish=!0),requestAnimationFrame(e)}}))},t.hide=function(){cancelAnimationFrame(this.handle),this.cancelAnimate=!0,setTimeout(this.destroy.bind(this))},t.frame=function(){if(!this.cancelAnimate){var t=this.device;t.acquire();var e=this.cmdBuff,i=this.framebuffer,r=this.renderArea;e.begin(),e.beginRenderPass(i.renderPass,i,r,this.clearColors,1,0);var n=this.material.passes[0],s=rS.getOrCreatePipelineState(t,n,this.shader,i.renderPass,this.assmebler);if(e.bindPipelineState(s),e.bindDescriptorSet(Cp.MATERIAL,n.descriptorSet),e.bindInputAssembler(this.assmebler),e.draw(this.assmebler),this.setting.displayWatermark&&this.textShader&&this.textAssmebler){var a=this.textMaterial.passes[0],o=rS.getOrCreatePipelineState(t,a,this.textShader,i.renderPass,this.textAssmebler);e.bindPipelineState(o),e.bindDescriptorSet(Cp.MATERIAL,a.descriptorSet),e.bindInputAssembler(this.textAssmebler),e.draw(this.textAssmebler)}e.endRenderPass(),e.end(),t.queue.submit([e]),t.present()}},t.initText=function(){this.textImg=document.createElement("canvas"),this.textImg.width=330,this.textImg.height=30,this.textImg.style.width=""+this.textImg.width,this.textImg.style.height=""+this.textImg.height;var t=this.textImg.getContext("2d");t.font="18px Arial",t.textBaseline="top",t.textAlign="left",t.fillStyle="`#424242`";var e="Powered by Cocos Creator",i=t.measureText(e);t.fillText(e,(330-i.width)/2,6),this.textRegion=new vu,this.textRegion.texExtent.width=this.textImg.width,this.textRegion.texExtent.height=this.textImg.height,this.textRegion.texExtent.depth=1,this.textTexture=this.device.createTexture(new Gu(vl.TEX2D,yl.SAMPLED|yl.TRANSFER_DST,il.RGBA8,this.textImg.width,this.textImg.height)),this.device.copyTexImagesToTexture([this.textImg],this.textTexture,[this.textRegion]),this.textMaterial=new mg,this.textMaterial.initialize({effectName:"splash-screen"});var r=this.textMaterial.passes[0],n=r.getBinding("mainTexture");r.bindTexture(n,this.textTexture),this.textShader=So.get(r.getShaderVariant()),bo.get(Do.get(r.handle,Eo.DESCRIPTOR_SET)).update();var s=4*Float32Array.BYTES_PER_ELEMENT,a=4*s;this.textVB=this.device.createBuffer(new Kl(rl.VERTEX|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,a,s));var o=new Float32Array(16),h=-this.textImg.width/2,l=this.textImg.height;l=this.screenWidth<this.screenHeight?(h=-this.screenWidth/2*.5)/(this.textImg.width/this.textImg.height):(h=-this.screenHeight/2*.5)/(this.textImg.width/this.textImg.height);var u=0;o[u++]=h,o[u++]=l,o[u++]=0,o[u++]=1,o[u++]=-h,o[u++]=l,o[u++]=1,o[u++]=1,o[u++]=h,o[u++]=-l,o[u++]=0,o[u++]=0,o[u++]=-h,o[u++]=-l,o[u++]=1,o[u++]=0;for(var c=0;c<o.length;c+=4)o[c]+=this.screenWidth/2,o[c+1]+=.1*this.screenHeight;for(var _=this.device.screenSpaceSignY,d=Gs[this.device.surfaceTransform],p=0;p<o.length;p+=4){var f=o[p]/this.screenWidth*2-1,m=(o[p+1]/this.screenHeight*2-1)*_;o[p]=d[0]*f+d[2]*m,o[p+1]=d[1]*f+d[3]*m}this.textVB.update(o);var g=Uint16Array.BYTES_PER_ELEMENT,v=6*g;this.textIB=this.device.createBuffer(new Kl(rl.INDEX|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,v,g));var y=new Uint16Array(6);y[0]=0,y[1]=1,y[2]=2,y[3]=1,y[4]=3,y[5]=2,this.textIB.update(y);var T=[new hu("a_position",il.RG32F),new hu("a_texCoord",il.RG32F)],E=new lu(T,[this.textVB],this.textIB);this.textAssmebler=this.device.createInputAssembler(E)},t.initCMD=function(){var t=this.device;this.renderArea=new cu(0,0,t.width,t.height),this.framebuffer=this.root.mainWindow.framebuffer,this.cmdBuff=t.commandBuffer},t.initIA=function(){var t=this.device,e=4*Float32Array.BYTES_PER_ELEMENT,i=4*e;this.vertexBuffers=t.createBuffer(new Kl(rl.VERTEX|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,i,e));var r=new Float32Array(16),n=-this.image.width/2,s=this.image.height;s=this.screenWidth<this.screenHeight?(n=-this.screenWidth/2*this.setting.displayRatio)/(this.image.width/this.image.height):(n=-this.screenHeight/2*this.setting.displayRatio)/(this.image.width/this.image.height);var a=0;r[a++]=n,r[a++]=s,r[a++]=0,r[a++]=1,r[a++]=-n,r[a++]=s,r[a++]=1,r[a++]=1,r[a++]=n,r[a++]=-s,r[a++]=0,r[a++]=0,r[a++]=-n,r[a++]=-s,r[a++]=1,r[a++]=0;for(var o=0;o<r.length;o+=4)r[o]+=this.screenWidth/2,r[o+1]+=this.screenHeight/2;for(var h=this.device.screenSpaceSignY,l=Gs[this.device.surfaceTransform],u=0;u<r.length;u+=4){var c=r[u]/this.screenWidth*2-1,_=(r[u+1]/this.screenHeight*2-1)*h;r[u]=l[0]*c+l[2]*_,r[u+1]=l[1]*c+l[3]*_}this.vertexBuffers.update(r);var d=Uint16Array.BYTES_PER_ELEMENT,p=6*d;this.indicesBuffers=t.createBuffer(new Kl(rl.INDEX|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,p,d));var f=new Uint16Array(6);f[0]=0,f[1]=1,f[2]=2,f[3]=1,f[4]=3,f[5]=2,this.indicesBuffers.update(f);var m=[new hu("a_position",il.RG32F),new hu("a_texCoord",il.RG32F)],g=new lu(m,[this.vertexBuffers],this.indicesBuffers);this.assmebler=t.createInputAssembler(g)},t.initPSO=function(){var t=this.device;this.material=new mg,this.material.initialize({effectName:"splash-screen"});var e=new Pu;e.addressU=gl.CLAMP,e.addressV=gl.CLAMP,this.sampler=t.createSampler(e),this.texture=t.createTexture(new Gu(vl.TEX2D,yl.SAMPLED|yl.TRANSFER_DST,il.RGBA8,this.image.width,this.image.height));var i=this.material.passes[0],r=i.getBinding("mainTexture");i.bindTexture(r,this.texture),this.shader=So.get(i.getShaderVariant());var n=bo.get(Do.get(i.handle,Eo.DESCRIPTOR_SET));n.bindSampler(r,this.sampler),n.update(),this.region=new vu,this.region.texExtent.width=this.image.width,this.region.texExtent.height=this.image.height,this.region.texExtent.depth=1,t.copyTexImagesToTexture([this.image],this.texture,[this.region])},t.destroy=function(){this.callBack=null,this.clearColors=null,this.device=null,this.image=null,this.framebuffer=null,this.renderArea=null,this.region=null,this.cmdBuff=null,this.shader=null,this.material.destroy(),this.material=null,this.texture.destroy(),this.texture=null,this.assmebler.destroy(),this.assmebler=null,this.vertexBuffers.destroy(),this.vertexBuffers=null,this.indicesBuffers.destroy(),this.indicesBuffers=null,this.sampler.destroy(),this.sampler=null,this.setting.displayWatermark&&this.textImg&&(this.textImg=null,this.textRegion=null,this.textShader=null,this.textMaterial.destroy(),this.textMaterial=null,this.textTexture.destroy(),this.textTexture=null,this.textAssmebler.destroy(),this.textAssmebler=null,this.textVB.destroy(),this.textVB=null,this.textIB.destroy(),this.textIB=null),this.setting=null,e._ins=void 0},r(e,[{key:"splashFinish",set:function(t){this._splashFinish=t,this._tryToStart()}},{key:"loadFinish",set:function(t){this._loadFinish=t,this._tryToStart()}}],[{key:"instance",get:function(){return e._ins||(e._ins=new e),e._ins}}]),e}();zV._ins=void 0,_.internal.SplashScreen=zV;var GV={};$s(GV,"vmath",[{name:"vec2",newName:"Vec2",target:Ca,targetName:"math"},{name:"vec3",newName:"Vec3",target:Ca,targetName:"math"},{name:"vec4",newName:"Vec4",target:Ca,targetName:"math"},{name:"quat",newName:"Quat",target:Ca,targetName:"math"},{name:"mat3",newName:"Mat3",target:Ca,targetName:"math"},{name:"mat4",newName:"Mat4",target:Ca,targetName:"math"},{name:"color4",newName:"Color",target:Ca,targetName:"math"},{name:"rect",newName:"Rect",target:Ca,targetName:"math"},{name:"approx",newName:"approx",target:Ca,targetName:"math"},{name:"EPSILON",newName:"EPSILON",target:Ca,targetName:"math"},{name:"equals",newName:"equals",target:Ca,targetName:"math"},{name:"clamp",newName:"clamp",target:Ca,targetName:"math"},{name:"clamp01",newName:"clamp01",target:Ca,targetName:"math"},{name:"lerp",newName:"lerp",target:Ca,targetName:"math"},{name:"toRadian",newName:"toRadian",target:Ca,targetName:"math"},{name:"toDegree",newName:"toDegree",target:Ca,targetName:"math"},{name:"random",newName:"random",target:Ca,targetName:"math"},{name:"randomRange",newName:"randomRange",target:Ca,targetName:"math"},{name:"randomRangeInt",newName:"randomRangeInt",target:Ca,targetName:"math"},{name:"pseudoRandom",newName:"pseudoRandom",target:Ca,targetName:"math"},{name:"pseudoRandomRangeInt",newName:"pseudoRandomRangeInt",target:Ca,targetName:"math"},{name:"nextPow2",newName:"nextPow2",target:Ca,targetName:"math"},{name:"repeat",newName:"repeat",target:Ca,targetName:"math"},{name:"pingPong",newName:"pingPong",target:Ca,targetName:"math"},{name:"inverseLerp",newName:"inverseLerp",target:Ca,targetName:"math"}]),_.vmath=GV,$s(tI.prototype,"Scheduler.prototype",[{name:"enableForTarget",newName:"enableForTarget",target:tI,targetName:"Scheduler"}]),$s(Yg.prototype,"EventTouch.prototype",[{name:"getUILocationInView",newName:"getLocationInView",target:Yg,targetName:"EventTouch"}]),$s(hT.prototype,"SubModel.prototype",[{name:"subMeshData",newName:"subMesh"}]),ta(hT.prototype,"SubModel.prototype",[{name:"getSubModel",suggest:"Use `subModels[i]` instead"},{name:"subModelNum",suggest:"Use `subModels.length` instead"}]),_.math=Ca,_.geometry=j_;var HV,VV,WV,jV,XV,YV,qV,KV,ZV,QV=t("NodePool",function(){function t(t){this.poolHandlerComp=void 0,this._pool=void 0,this.poolHandlerComp=t,this._pool=[]}var e=t.prototype;return e.size=function(){return this._pool.length},e.clear=function(){for(var t=this._pool.length,e=0;e<t;++e)this._pool[e].destroy();this._pool.length=0},e.put=function(t){if(t&&-1===this._pool.indexOf(t)){t.removeFromParent();var e=this.poolHandlerComp?t.getComponent(this.poolHandlerComp):null;e&&e.unuse&&e.unuse(),this._pool.push(t)}},e.get=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var r=this._pool.length-1;if(r<0)return null;var n=this._pool[r];this._pool.length=r;var s=this.poolHandlerComp?n.getComponent(this.poolHandlerComp):null;return s&&s.reuse&&s.reuse(arguments),n},t}());_.NodePool=QV,function(t){t[t.BOX=0]="BOX",t[t.SPHERE=1]="SPHERE",t[t.CYLINDER=2]="CYLINDER",t[t.CONE=3]="CONE",t[t.CAPSULE=4]="CAPSULE",t[t.TORUS=5]="TORUS",t[t.PLANE=6]="PLANE",t[t.QUAD=7]="QUAD"}(ZV||(ZV={})),Ft(ZV);var JV=t("Primitive",(HV=Ne("cc.Primitive"),VV=pi(ZV),HV((KV=qV=function(t){function e(e){var i;return void 0===e&&(e=ZV.BOX),l(i=t.call(this)||this,"type",XV,a(i)),l(i,"info",YV,a(i)),i.type=e,i}return s(e,t),e.prototype.onLoaded=function(){Yb(EA[ZV[this.type].toLowerCase()](this.info),this)},e}(Bf),qV.PrimitiveType=ZV,XV=u((jV=KV).prototype,"type",[VV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ZV.BOX}}),YV=u(jV.prototype,"info",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),WV=jV))||WV));_.Primitive=JV,_.renderer=mw,_.primitives=EA;var $V,tW=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuDescriptorSet=null,e}s(e,t);var i=e.prototype;return i.initialize=function(t){this._layout=t.layout;var e=t.layout.gpuDescriptorSetLayout,i=e.bindings,r=e.descriptorIndices,n=e.descriptorCount;this._buffers=Array(n).fill(null),this._textures=Array(n).fill(null),this._samplers=Array(n).fill(null);var s=[];this._gpuDescriptorSet={gpuDescriptors:s,descriptorIndices:r};for(var a=0;a<i.length;++a)for(var o=i[a],h=0;h<o.count;h++)s.push({type:o.descriptorType,gpuBuffer:null,gpuTexture:null,gpuSampler:null});return!0},i.destroy=function(){this._layout=null,this._gpuDescriptorSet=null},i.update=function(){if(this._isDirty&&this._gpuDescriptorSet){for(var t=this._gpuDescriptorSet.gpuDescriptors,e=0;e<t.length;++e)if(t[e].type&Xu){var i=this._buffers[e];i&&(t[e].gpuBuffer=i.gpuBuffer||i.gpuBufferView)}else t[e].type&Yu&&(this._textures[e]&&(t[e].gpuTexture=this._textures[e].gpuTexture),this._samplers[e]&&(t[e].gpuSampler=this._samplers[e].gpuSampler));this._isDirty=!1}},r(e,[{key:"gpuDescriptorSet",get:function(){return this._gpuDescriptorSet}}]),e}(Ku);function eW(t,e){switch(t){case il.R8:return e.UNSIGNED_BYTE;case il.R8SN:return e.BYTE;case il.R8UI:return e.UNSIGNED_BYTE;case il.R8I:return e.BYTE;case il.R16F:return $V.HALF_FLOAT_OES;case il.R16UI:return e.UNSIGNED_SHORT;case il.R16I:return e.SHORT;case il.R32F:return e.FLOAT;case il.R32UI:return e.UNSIGNED_INT;case il.R32I:return e.INT;case il.RG8:return e.UNSIGNED_BYTE;case il.RG8SN:return e.BYTE;case il.RG8UI:return e.UNSIGNED_BYTE;case il.RG8I:return e.BYTE;case il.RG16F:return $V.HALF_FLOAT_OES;case il.RG16UI:return e.UNSIGNED_SHORT;case il.RG16I:return e.SHORT;case il.RG32F:return e.FLOAT;case il.RG32UI:return e.UNSIGNED_INT;case il.RG32I:return e.INT;case il.RGB8:case il.SRGB8:return e.UNSIGNED_BYTE;case il.RGB8SN:return e.BYTE;case il.RGB8UI:return e.UNSIGNED_BYTE;case il.RGB8I:return e.BYTE;case il.RGB16F:return $V.HALF_FLOAT_OES;case il.RGB16UI:return e.UNSIGNED_SHORT;case il.RGB16I:return e.SHORT;case il.RGB32F:return e.FLOAT;case il.RGB32UI:return e.UNSIGNED_INT;case il.RGB32I:return e.INT;case il.BGRA8:case il.RGBA8:case il.SRGB8_A8:return e.UNSIGNED_BYTE;case il.RGBA8SN:return e.BYTE;case il.RGBA8UI:return e.UNSIGNED_BYTE;case il.RGBA8I:return e.BYTE;case il.RGBA16F:return $V.HALF_FLOAT_OES;case il.RGBA16UI:return e.UNSIGNED_SHORT;case il.RGBA16I:return e.SHORT;case il.RGBA32F:return e.FLOAT;case il.RGBA32UI:return e.UNSIGNED_INT;case il.RGBA32I:return e.INT;case il.R5G6B5:return e.UNSIGNED_SHORT_5_6_5;case il.R11G11B10F:return e.FLOAT;case il.RGB5A1:return e.UNSIGNED_SHORT_5_5_5_1;case il.RGBA4:return e.UNSIGNED_SHORT_4_4_4_4;case il.RGB10A2:return e.UNSIGNED_BYTE;case il.RGB10A2UI:return e.UNSIGNED_INT;case il.RGB9E5:return e.UNSIGNED_BYTE;case il.D16:return e.UNSIGNED_SHORT;case il.D16S8:return $V.UNSIGNED_INT_24_8_WEBGL;case il.D24:return e.UNSIGNED_INT;case il.D24S8:return $V.UNSIGNED_INT_24_8_WEBGL;case il.D32F:return e.UNSIGNED_INT;case il.D32F_S8:return $V.UNSIGNED_INT_24_8_WEBGL;case il.BC1:case il.BC1_SRGB:case il.BC2:case il.BC2_SRGB:case il.BC3:case il.BC3_SRGB:case il.BC4:return e.UNSIGNED_BYTE;case il.BC4_SNORM:return e.BYTE;case il.BC5:return e.UNSIGNED_BYTE;case il.BC5_SNORM:return e.BYTE;case il.BC6H_SF16:case il.BC6H_UF16:return e.FLOAT;case il.BC7:case il.BC7_SRGB:case il.ETC_RGB8:case il.ETC2_RGB8:case il.ETC2_SRGB8:case il.ETC2_RGB8_A1:case il.ETC2_SRGB8_A1:case il.EAC_R11:return e.UNSIGNED_BYTE;case il.EAC_R11SN:return e.BYTE;case il.EAC_RG11:return e.UNSIGNED_BYTE;case il.EAC_RG11SN:return e.BYTE;case il.PVRTC_RGB2:case il.PVRTC_RGBA2:case il.PVRTC_RGB4:case il.PVRTC_RGBA4:case il.PVRTC2_2BPP:case il.PVRTC2_4BPP:return e.UNSIGNED_BYTE;case il.ASTC_RGBA_4x4:case il.ASTC_RGBA_5x4:case il.ASTC_RGBA_5x5:case il.ASTC_RGBA_6x5:case il.ASTC_RGBA_6x6:case il.ASTC_RGBA_8x5:case il.ASTC_RGBA_8x6:case il.ASTC_RGBA_8x8:case il.ASTC_RGBA_10x5:case il.ASTC_RGBA_10x6:case il.ASTC_RGBA_10x8:case il.ASTC_RGBA_10x10:case il.ASTC_RGBA_12x10:case il.ASTC_RGBA_12x12:case il.ASTC_SRGBA_4x4:case il.ASTC_SRGBA_5x4:case il.ASTC_SRGBA_5x5:case il.ASTC_SRGBA_6x5:case il.ASTC_SRGBA_6x6:case il.ASTC_SRGBA_8x5:case il.ASTC_SRGBA_8x6:case il.ASTC_SRGBA_8x8:case il.ASTC_SRGBA_10x5:case il.ASTC_SRGBA_10x6:case il.ASTC_SRGBA_10x8:case il.ASTC_SRGBA_10x10:case il.ASTC_SRGBA_12x10:case il.ASTC_SRGBA_12x12:default:return e.UNSIGNED_BYTE}}function iW(t,e){switch(t){case il.A8:return e.ALPHA;case il.L8:return e.LUMINANCE;case il.LA8:return e.LUMINANCE_ALPHA;case il.RGB8:case il.RGB16F:case il.RGB32F:return e.RGB;case il.BGRA8:case il.RGBA8:case il.RGBA16F:case il.RGBA32F:return e.RGBA;case il.R5G6B5:return e.RGB565;case il.RGB5A1:return e.RGB5_A1;case il.RGBA4:return e.RGBA4;case il.D16:return e.DEPTH_COMPONENT;case il.D16S8:return e.DEPTH_STENCIL;case il.D24:return e.DEPTH_COMPONENT;case il.D24S8:return e.DEPTH_STENCIL;case il.D32F:return e.DEPTH_COMPONENT;case il.D32F_S8:return e.DEPTH_STENCIL;case il.BC1:return $V.COMPRESSED_RGB_S3TC_DXT1_EXT;case il.BC1_ALPHA:return $V.COMPRESSED_RGBA_S3TC_DXT1_EXT;case il.BC1_SRGB:return $V.COMPRESSED_SRGB_S3TC_DXT1_EXT;case il.BC1_SRGB_ALPHA:return $V.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case il.BC2:return $V.COMPRESSED_RGBA_S3TC_DXT3_EXT;case il.BC2_SRGB:return $V.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case il.BC3:return $V.COMPRESSED_RGBA_S3TC_DXT5_EXT;case il.BC3_SRGB:return $V.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case il.ETC_RGB8:return $V.COMPRESSED_RGB_ETC1_WEBGL;case il.ETC2_RGB8:return $V.COMPRESSED_RGB8_ETC2;case il.ETC2_SRGB8:return $V.COMPRESSED_SRGB8_ETC2;case il.ETC2_RGB8_A1:return $V.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case il.ETC2_SRGB8_A1:return $V.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;case il.ETC2_RGBA8:return $V.COMPRESSED_RGBA8_ETC2_EAC;case il.ETC2_SRGB8_A8:return $V.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;case il.EAC_R11:return $V.COMPRESSED_R11_EAC;case il.EAC_R11SN:return $V.COMPRESSED_SIGNED_R11_EAC;case il.EAC_RG11:return $V.COMPRESSED_RG11_EAC;case il.EAC_RG11SN:return $V.COMPRESSED_SIGNED_RG11_EAC;case il.PVRTC_RGB2:return $V.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case il.PVRTC_RGBA2:return $V.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;case il.PVRTC_RGB4:return $V.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case il.PVRTC_RGBA4:return $V.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case il.ASTC_RGBA_4x4:return $V.COMPRESSED_RGBA_ASTC_4x4_KHR;case il.ASTC_RGBA_5x4:return $V.COMPRESSED_RGBA_ASTC_5x4_KHR;case il.ASTC_RGBA_5x5:return $V.COMPRESSED_RGBA_ASTC_5x5_KHR;case il.ASTC_RGBA_6x5:return $V.COMPRESSED_RGBA_ASTC_6x5_KHR;case il.ASTC_RGBA_6x6:return $V.COMPRESSED_RGBA_ASTC_6x6_KHR;case il.ASTC_RGBA_8x5:return $V.COMPRESSED_RGBA_ASTC_8x5_KHR;case il.ASTC_RGBA_8x6:return $V.COMPRESSED_RGBA_ASTC_8x6_KHR;case il.ASTC_RGBA_8x8:return $V.COMPRESSED_RGBA_ASTC_8x8_KHR;case il.ASTC_RGBA_10x5:return $V.COMPRESSED_RGBA_ASTC_10x5_KHR;case il.ASTC_RGBA_10x6:return $V.COMPRESSED_RGBA_ASTC_10x6_KHR;case il.ASTC_RGBA_10x8:return $V.COMPRESSED_RGBA_ASTC_10x8_KHR;case il.ASTC_RGBA_10x10:return $V.COMPRESSED_RGBA_ASTC_10x10_KHR;case il.ASTC_RGBA_12x10:return $V.COMPRESSED_RGBA_ASTC_12x10_KHR;case il.ASTC_RGBA_12x12:return $V.COMPRESSED_RGBA_ASTC_12x12_KHR;case il.ASTC_SRGBA_4x4:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;case il.ASTC_SRGBA_5x4:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;case il.ASTC_SRGBA_5x5:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;case il.ASTC_SRGBA_6x5:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;case il.ASTC_SRGBA_6x6:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;case il.ASTC_SRGBA_8x5:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;case il.ASTC_SRGBA_8x6:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;case il.ASTC_SRGBA_8x8:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;case il.ASTC_SRGBA_10x5:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;case il.ASTC_SRGBA_10x6:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;case il.ASTC_SRGBA_10x8:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;case il.ASTC_SRGBA_10x10:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;case il.ASTC_SRGBA_12x10:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;case il.ASTC_SRGBA_12x12:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;default:return console.error("Unsupported Format, convert to WebGL internal format failed."),e.RGBA}}function rW(t,e){switch(t){case il.A8:return e.ALPHA;case il.L8:return e.LUMINANCE;case il.LA8:return e.LUMINANCE_ALPHA;case il.RGB8:case il.RGB16F:case il.RGB32F:return e.RGB;case il.BGRA8:case il.RGBA8:case il.RGBA16F:case il.RGBA32F:return e.RGBA;case il.R5G6B5:return e.RGB;case il.RGB5A1:case il.RGBA4:return e.RGBA;case il.D16:return e.DEPTH_COMPONENT;case il.D16S8:return e.DEPTH_STENCIL;case il.D24:return e.DEPTH_COMPONENT;case il.D24S8:return e.DEPTH_STENCIL;case il.D32F:return e.DEPTH_COMPONENT;case il.D32F_S8:return e.DEPTH_STENCIL;case il.BC1:return $V.COMPRESSED_RGB_S3TC_DXT1_EXT;case il.BC1_ALPHA:return $V.COMPRESSED_RGBA_S3TC_DXT1_EXT;case il.BC1_SRGB:return $V.COMPRESSED_SRGB_S3TC_DXT1_EXT;case il.BC1_SRGB_ALPHA:return $V.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case il.BC2:return $V.COMPRESSED_RGBA_S3TC_DXT3_EXT;case il.BC2_SRGB:return $V.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case il.BC3:return $V.COMPRESSED_RGBA_S3TC_DXT5_EXT;case il.BC3_SRGB:return $V.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case il.ETC_RGB8:return $V.COMPRESSED_RGB_ETC1_WEBGL;case il.ETC2_RGB8:return $V.COMPRESSED_RGB8_ETC2;case il.ETC2_SRGB8:return $V.COMPRESSED_SRGB8_ETC2;case il.ETC2_RGB8_A1:return $V.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case il.ETC2_SRGB8_A1:return $V.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;case il.ETC2_RGBA8:return $V.COMPRESSED_RGBA8_ETC2_EAC;case il.ETC2_SRGB8_A8:return $V.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;case il.EAC_R11:return $V.COMPRESSED_R11_EAC;case il.EAC_R11SN:return $V.COMPRESSED_SIGNED_R11_EAC;case il.EAC_RG11:return $V.COMPRESSED_RG11_EAC;case il.EAC_RG11SN:return $V.COMPRESSED_SIGNED_RG11_EAC;case il.PVRTC_RGB2:return $V.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case il.PVRTC_RGBA2:return $V.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;case il.PVRTC_RGB4:return $V.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case il.PVRTC_RGBA4:return $V.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case il.ASTC_RGBA_4x4:return $V.COMPRESSED_RGBA_ASTC_4x4_KHR;case il.ASTC_RGBA_5x4:return $V.COMPRESSED_RGBA_ASTC_5x4_KHR;case il.ASTC_RGBA_5x5:return $V.COMPRESSED_RGBA_ASTC_5x5_KHR;case il.ASTC_RGBA_6x5:return $V.COMPRESSED_RGBA_ASTC_6x5_KHR;case il.ASTC_RGBA_6x6:return $V.COMPRESSED_RGBA_ASTC_6x6_KHR;case il.ASTC_RGBA_8x5:return $V.COMPRESSED_RGBA_ASTC_8x5_KHR;case il.ASTC_RGBA_8x6:return $V.COMPRESSED_RGBA_ASTC_8x6_KHR;case il.ASTC_RGBA_8x8:return $V.COMPRESSED_RGBA_ASTC_8x8_KHR;case il.ASTC_RGBA_10x5:return $V.COMPRESSED_RGBA_ASTC_10x5_KHR;case il.ASTC_RGBA_10x6:return $V.COMPRESSED_RGBA_ASTC_10x6_KHR;case il.ASTC_RGBA_10x8:return $V.COMPRESSED_RGBA_ASTC_10x8_KHR;case il.ASTC_RGBA_10x10:return $V.COMPRESSED_RGBA_ASTC_10x10_KHR;case il.ASTC_RGBA_12x10:return $V.COMPRESSED_RGBA_ASTC_12x10_KHR;case il.ASTC_RGBA_12x12:return $V.COMPRESSED_RGBA_ASTC_12x12_KHR;case il.ASTC_SRGBA_4x4:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;case il.ASTC_SRGBA_5x4:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;case il.ASTC_SRGBA_5x5:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;case il.ASTC_SRGBA_6x5:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;case il.ASTC_SRGBA_6x6:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;case il.ASTC_SRGBA_8x5:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;case il.ASTC_SRGBA_8x6:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;case il.ASTC_SRGBA_8x8:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;case il.ASTC_SRGBA_10x5:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;case il.ASTC_SRGBA_10x6:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;case il.ASTC_SRGBA_10x8:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;case il.ASTC_SRGBA_10x10:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;case il.ASTC_SRGBA_12x10:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;case il.ASTC_SRGBA_12x12:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;default:return console.error("Unsupported Format, convert to WebGL format failed."),e.RGBA}}function nW(t,e){switch(t){case el.BOOL:return e.BOOL;case el.BOOL2:return e.BOOL_VEC2;case el.BOOL3:return e.BOOL_VEC3;case el.BOOL4:return e.BOOL_VEC4;case el.INT:return e.INT;case el.INT2:return e.INT_VEC2;case el.INT3:return e.INT_VEC3;case el.INT4:return e.INT_VEC4;case el.UINT:return e.UNSIGNED_INT;case el.FLOAT:return e.FLOAT;case el.FLOAT2:return e.FLOAT_VEC2;case el.FLOAT3:return e.FLOAT_VEC3;case el.FLOAT4:return e.FLOAT_VEC4;case el.MAT2:return e.FLOAT_MAT2;case el.MAT3:return e.FLOAT_MAT3;case el.MAT4:return e.FLOAT_MAT4;case el.SAMPLER2D:return e.SAMPLER_2D;case el.SAMPLER_CUBE:return e.SAMPLER_CUBE;default:return console.error("Unsupported GLType, convert to GL type failed."),el.UNKNOWN}}function sW(t){switch(t){case el.BOOL:case el.BOOL2:case el.BOOL3:case el.BOOL4:case el.INT:case el.INT2:case el.INT3:case el.INT4:case el.UINT:return Int32Array;case el.FLOAT:case el.FLOAT2:case el.FLOAT3:case el.FLOAT4:case el.MAT2:case el.MAT3:case el.MAT4:return Float32Array;default:return console.error("Unsupported GLType, convert to TypedArrayConstructor failed."),Float32Array}}function aW(t,e){switch(t){case e.BOOL:return el.BOOL;case e.BOOL_VEC2:return el.BOOL2;case e.BOOL_VEC3:return el.BOOL3;case e.BOOL_VEC4:return el.BOOL4;case e.INT:return el.INT;case e.INT_VEC2:return el.INT2;case e.INT_VEC3:return el.INT3;case e.INT_VEC4:return el.INT4;case e.UNSIGNED_INT:return el.UINT;case e.FLOAT:return el.FLOAT;case e.FLOAT_VEC2:return el.FLOAT2;case e.FLOAT_VEC3:return el.FLOAT3;case e.FLOAT_VEC4:return el.FLOAT4;case e.FLOAT_MAT2:return el.MAT2;case e.FLOAT_MAT3:return el.MAT3;case e.FLOAT_MAT4:return el.MAT4;case e.SAMPLER_2D:return el.SAMPLER2D;case e.SAMPLER_CUBE:return el.SAMPLER_CUBE;default:return console.error("Unsupported GLType, convert to Type failed."),el.UNKNOWN}}function oW(t,e){switch(t){case e.BOOL:return 4;case e.BOOL_VEC2:return 8;case e.BOOL_VEC3:return 12;case e.BOOL_VEC4:return 16;case e.INT:return 4;case e.INT_VEC2:return 8;case e.INT_VEC3:return 12;case e.INT_VEC4:return 16;case e.UNSIGNED_INT:case e.FLOAT:return 4;case e.FLOAT_VEC2:return 8;case e.FLOAT_VEC3:return 12;case e.FLOAT_VEC4:case e.FLOAT_MAT2:return 16;case e.FLOAT_MAT3:return 36;case e.FLOAT_MAT4:return 64;case e.SAMPLER_2D:case e.SAMPLER_CUBE:return 4;default:return console.error("Unsupported GLType, get type failed."),0}}function hW(t,e){switch(t){case e.FLOAT_MAT2:return 2;case e.FLOAT_MAT3:return 3;case e.FLOAT_MAT4:return 4;default:return 1}}!function(t){t[t.RGBA16F_EXT=34842]="RGBA16F_EXT",t[t.RGB16F_EXT=34843]="RGB16F_EXT",t[t.RGBA32F_EXT=34836]="RGBA32F_EXT",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",t[t.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",t[t.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",t[t.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR"}($V||($V={}));var lW,uW=[512,513,514,515,516,517,518,519],cW=[0,7680,7681,7682,7683,5386,34055,34056],_W=[32774,32778,32779,32775,32776],dW=[0,1,770,772,771,773,768,774,769,775,776,32769,32770,32771,32772];!function(t){t[t.BEGIN_RENDER_PASS=0]="BEGIN_RENDER_PASS",t[t.END_RENDER_PASS=1]="END_RENDER_PASS",t[t.BIND_STATES=2]="BIND_STATES",t[t.DRAW=3]="DRAW",t[t.UPDATE_BUFFER=4]="UPDATE_BUFFER",t[t.COPY_BUFFER_TO_TEXTURE=5]="COPY_BUFFER_TO_TEXTURE",t[t.COUNT=6]="COUNT"}(lW||(lW={}));var pW=function(t){this.cmdType=void 0,this.refCount=0,this.cmdType=t},fW=function(t){function e(){var e;return(e=t.call(this,lW.BEGIN_RENDER_PASS)||this).gpuRenderPass=null,e.gpuFramebuffer=null,e.renderArea=new cu,e.clearFlag=Bl.NONE,e.clearColors=[],e.clearDepth=1,e.clearStencil=0,e}return s(e,t),e.prototype.clear=function(){this.gpuFramebuffer=null,this.clearColors.length=0},e}(pW),mW=function(t){function e(){var e;return(e=t.call(this,lW.BIND_STATES)||this).gpuPipelineState=null,e.gpuInputAssembler=null,e.gpuDescriptorSets=[],e.dynamicOffsets=[],e.viewport=null,e.scissor=null,e.lineWidth=null,e.depthBias=null,e.blendConstants=[],e.depthBounds=null,e.stencilWriteMask=null,e.stencilCompareMask=null,e}return s(e,t),e.prototype.clear=function(){this.gpuPipelineState=null,this.gpuDescriptorSets.length=0,this.gpuInputAssembler=null,this.dynamicOffsets.length=0,this.viewport=null,this.scissor=null,this.lineWidth=null,this.depthBias=null,this.blendConstants.length=0,this.depthBounds=null,this.stencilWriteMask=null,this.stencilCompareMask=null},e}(pW),gW=function(t){function e(){var e;return(e=t.call(this,lW.DRAW)||this).drawInfo=new Xl,e}return s(e,t),e.prototype.clear=function(){},e}(pW),vW=function(t){function e(){var e;return(e=t.call(this,lW.UPDATE_BUFFER)||this).gpuBuffer=null,e.buffer=null,e.offset=0,e.size=0,e}return s(e,t),e.prototype.clear=function(){this.gpuBuffer=null,this.buffer=null},e}(pW),yW=function(t){function e(){var e;return(e=t.call(this,lW.COPY_BUFFER_TO_TEXTURE)||this).gpuTexture=null,e.buffers=[],e.regions=[],e}return s(e,t),e.prototype.clear=function(){this.gpuTexture=null,this.buffers.length=0,this.regions.length=0},e}(pW),TW=function(){function t(){this.cmds=new Wi(1),this.beginRenderPassCmds=new Wi(1),this.bindStatesCmds=new Wi(1),this.drawCmds=new Wi(1),this.updateBufferCmds=new Wi(1),this.copyBufferToTextureCmds=new Wi(1)}return t.prototype.clearCmds=function(t){this.beginRenderPassCmds.length&&(t.beginRenderPassCmdPool.freeCmds(this.beginRenderPassCmds),this.beginRenderPassCmds.clear()),this.bindStatesCmds.length&&(t.bindStatesCmdPool.freeCmds(this.bindStatesCmds),this.bindStatesCmds.clear()),this.drawCmds.length&&(t.drawCmdPool.freeCmds(this.drawCmds),this.drawCmds.clear()),this.updateBufferCmds.length&&(t.updateBufferCmdPool.freeCmds(this.updateBufferCmds),this.updateBufferCmds.clear()),this.copyBufferToTextureCmds.length&&(t.copyBufferToTextureCmdPool.freeCmds(this.copyBufferToTextureCmds),this.copyBufferToTextureCmds.clear()),this.cmds.clear()},t}();function EW(t,e,i,r,n){if(e.usage&rl.UNIFORM)ArrayBuffer.isView(i)?e.vf32.set(i,r/Float32Array.BYTES_PER_ELEMENT):e.vf32.set(new Float32Array(i),r/Float32Array.BYTES_PER_ELEMENT);else if(e.usage&rl.INDIRECT)e.indirects.length=r,Array.prototype.push.apply(e.indirects,i.drawInfos);else{var s=i,a=t.gl,o=t.stateCache;switch(e.glTarget){case a.ARRAY_BUFFER:t.useVAO&&o.glVAO&&(t.OES_vertex_array_object.bindVertexArrayOES(null),o.glVAO=SW.gpuInputAssembler=null),t.stateCache.glArrayBuffer!==e.glBuffer&&(a.bindBuffer(a.ARRAY_BUFFER,e.glBuffer),t.stateCache.glArrayBuffer=e.glBuffer);break;case a.ELEMENT_ARRAY_BUFFER:t.useVAO&&o.glVAO&&(t.OES_vertex_array_object.bindVertexArrayOES(null),o.glVAO=SW.gpuInputAssembler=null),t.stateCache.glElementArrayBuffer!==e.glBuffer&&(a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e.glBuffer),t.stateCache.glElementArrayBuffer=e.glBuffer);break;default:return void console.error("Unsupported BufferType, update buffer failed.")}n===s.byteLength?a.bufferSubData(e.glTarget,r,s):a.bufferSubData(e.glTarget,r,s.slice(0,n))}}var SW={gpuPipelineState:null,gpuInputAssembler:null,reverseCW:!1,glPrimitive:0};function bW(t,e,i,r,n,s,a){var o=t.gl,h=t.stateCache,l=0;if(i&&e){if(h.glFramebuffer!==i.glFramebuffer){o.bindFramebuffer(o.FRAMEBUFFER,i.glFramebuffer),h.glFramebuffer=i.glFramebuffer;var u=!!i.glFramebuffer;if(u!==SW.reverseCW){SW.reverseCW=u;var c=!t.stateCache.rs.isFrontFaceCCW;o.frontFace(c?o.CCW:o.CW),t.stateCache.rs.isFrontFaceCCW=c}}h.viewport.left===r.x&&h.viewport.top===r.y&&h.viewport.width===r.width&&h.viewport.height===r.height||(o.viewport(r.x,r.y,r.width,r.height),h.viewport.left=r.x,h.viewport.top=r.y,h.viewport.width=r.width,h.viewport.height=r.height),h.scissorRect.x===r.x&&h.scissorRect.y===r.y&&h.scissorRect.width===r.width&&h.scissorRect.height===r.height||(o.scissor(r.x,r.y,r.width,r.height),h.scissorRect.x=r.x,h.scissorRect.y=r.y,h.scissorRect.width=r.width,h.scissorRect.height=r.height);var _=n.length;t.WEBGL_draw_buffers||(_=1);for(var d=0;d<_;++d){var p=e.colorAttachments[d];if(p.format!==il.UNKNOWN)switch(p.loadOp){case Cl.LOAD:break;case Cl.CLEAR:h.bs.targets[0].blendColorMask!==fl.ALL&&o.colorMask(!0,!0,!0,!0);var f=n[0];o.clearColor(f.x,f.y,f.z,f.w),l|=o.COLOR_BUFFER_BIT;break;case Cl.DISCARD:}}if(e.depthStencilAttachment&&e.depthStencilAttachment.format!==il.UNKNOWN){switch(e.depthStencilAttachment.depthLoadOp){case Cl.LOAD:break;case Cl.CLEAR:h.dss.depthWrite||o.depthMask(!0),o.clearDepth(s),l|=o.DEPTH_BUFFER_BIT;break;case Cl.DISCARD:}if(zl[e.depthStencilAttachment.format].hasStencil)switch(e.depthStencilAttachment.stencilLoadOp){case Cl.LOAD:break;case Cl.CLEAR:h.dss.stencilWriteMaskFront||o.stencilMaskSeparate(o.FRONT,65535),h.dss.stencilWriteMaskBack||o.stencilMaskSeparate(o.BACK,65535),o.clearStencil(a),l|=o.STENCIL_BUFFER_BIT;break;case Cl.DISCARD:}}if(l&&o.clear(l),l&o.COLOR_BUFFER_BIT){var m=h.bs.targets[0].blendColorMask;if(m!==fl.ALL){var g=(m&fl.R)!==fl.NONE,v=(m&fl.G)!==fl.NONE,y=(m&fl.B)!==fl.NONE,T=(m&fl.A)!==fl.NONE;o.colorMask(g,v,y,T)}}l&o.DEPTH_BUFFER_BIT&&!h.dss.depthWrite&&o.depthMask(!1),l&o.STENCIL_BUFFER_BIT&&(h.dss.stencilWriteMaskFront||o.stencilMaskSeparate(o.FRONT,0),h.dss.stencilWriteMaskBack||o.stencilMaskSeparate(o.BACK,0))}}function AW(t,e,i,r,n,s,a,o,h,l,u,c,_){var d,p,f,m=t.gl,g=t.stateCache,v=e&&e.gpuShader,y=!1;if(e&&SW.gpuPipelineState!==e){if(SW.gpuPipelineState=e,SW.glPrimitive=e.glPrimitive,e.gpuShader){var T=e.gpuShader.glProgram;g.glProgram!==T&&(m.useProgram(T),g.glProgram=T,y=!0)}var E=e.rs;if(E){if(g.rs.cullMode!==E.cullMode){switch(E.cullMode){case ul.NONE:m.disable(m.CULL_FACE);break;case ul.FRONT:m.enable(m.CULL_FACE),m.cullFace(m.FRONT);break;case ul.BACK:m.enable(m.CULL_FACE),m.cullFace(m.BACK)}g.rs.cullMode=E.cullMode}var b=SW.reverseCW?!E.isFrontFaceCCW:E.isFrontFaceCCW;g.rs.isFrontFaceCCW!==b&&(m.frontFace(b?m.CCW:m.CW),g.rs.isFrontFaceCCW=b),g.rs.depthBias===E.depthBias&&g.rs.depthBiasSlop===E.depthBiasSlop||(m.polygonOffset(E.depthBias,E.depthBiasSlop),g.rs.depthBias=E.depthBias,g.rs.depthBiasSlop=E.depthBiasSlop),g.rs.lineWidth!==E.lineWidth&&(m.lineWidth(E.lineWidth),g.rs.lineWidth=E.lineWidth)}var A=e.dss;A&&(g.dss.depthTest!==A.depthTest&&(A.depthTest?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST),g.dss.depthTest=A.depthTest),g.dss.depthWrite!==A.depthWrite&&(m.depthMask(A.depthWrite),g.dss.depthWrite=A.depthWrite),g.dss.depthFunc!==A.depthFunc&&(m.depthFunc(uW[A.depthFunc]),g.dss.depthFunc=A.depthFunc),g.dss.stencilTestFront===A.stencilTestFront&&g.dss.stencilTestBack===A.stencilTestBack||(A.stencilTestFront||A.stencilTestBack?m.enable(m.STENCIL_TEST):m.disable(m.STENCIL_TEST),g.dss.stencilTestFront=A.stencilTestFront,g.dss.stencilTestBack=A.stencilTestBack),g.dss.stencilFuncFront===A.stencilFuncFront&&g.dss.stencilRefFront===A.stencilRefFront&&g.dss.stencilReadMaskFront===A.stencilReadMaskFront||(m.stencilFuncSeparate(m.FRONT,uW[A.stencilFuncFront],A.stencilRefFront,A.stencilReadMaskFront),g.dss.stencilFuncFront=A.stencilFuncFront,g.dss.stencilRefFront=A.stencilRefFront,g.dss.stencilReadMaskFront=A.stencilReadMaskFront),g.dss.stencilFailOpFront===A.stencilFailOpFront&&g.dss.stencilZFailOpFront===A.stencilZFailOpFront&&g.dss.stencilPassOpFront===A.stencilPassOpFront||(m.stencilOpSeparate(m.FRONT,cW[A.stencilFailOpFront],cW[A.stencilZFailOpFront],cW[A.stencilPassOpFront]),g.dss.stencilFailOpFront=A.stencilFailOpFront,g.dss.stencilZFailOpFront=A.stencilZFailOpFront,g.dss.stencilPassOpFront=A.stencilPassOpFront),g.dss.stencilWriteMaskFront!==A.stencilWriteMaskFront&&(m.stencilMaskSeparate(m.FRONT,A.stencilWriteMaskFront),g.dss.stencilWriteMaskFront=A.stencilWriteMaskFront),g.dss.stencilFuncBack===A.stencilFuncBack&&g.dss.stencilRefBack===A.stencilRefBack&&g.dss.stencilReadMaskBack===A.stencilReadMaskBack||(m.stencilFuncSeparate(m.BACK,uW[A.stencilFuncBack],A.stencilRefBack,A.stencilReadMaskBack),g.dss.stencilFuncBack=A.stencilFuncBack,g.dss.stencilRefBack=A.stencilRefBack,g.dss.stencilReadMaskBack=A.stencilReadMaskBack),g.dss.stencilFailOpBack===A.stencilFailOpBack&&g.dss.stencilZFailOpBack===A.stencilZFailOpBack&&g.dss.stencilPassOpBack===A.stencilPassOpBack||(m.stencilOpSeparate(m.BACK,cW[A.stencilFailOpBack],cW[A.stencilZFailOpBack],cW[A.stencilPassOpBack]),g.dss.stencilFailOpBack=A.stencilFailOpBack,g.dss.stencilZFailOpBack=A.stencilZFailOpBack,g.dss.stencilPassOpBack=A.stencilPassOpBack),g.dss.stencilWriteMaskBack!==A.stencilWriteMaskBack&&(m.stencilMaskSeparate(m.BACK,A.stencilWriteMaskBack),g.dss.stencilWriteMaskBack=A.stencilWriteMaskBack));var C=e.bs;if(C){g.bs.isA2C!==C.isA2C&&(C.isA2C?m.enable(m.SAMPLE_ALPHA_TO_COVERAGE):m.disable(m.SAMPLE_ALPHA_TO_COVERAGE),g.bs.isA2C=C.isA2C),g.bs.blendColor.x===C.blendColor.x&&g.bs.blendColor.y===C.blendColor.y&&g.bs.blendColor.z===C.blendColor.z&&g.bs.blendColor.w===C.blendColor.w||(m.blendColor(C.blendColor.x,C.blendColor.y,C.blendColor.z,C.blendColor.w),g.bs.blendColor.x=C.blendColor.x,g.bs.blendColor.y=C.blendColor.y,g.bs.blendColor.z=C.blendColor.z,g.bs.blendColor.w=C.blendColor.w);var w=C.targets[0],R=g.bs.targets[0];R.blend!==w.blend&&(w.blend?m.enable(m.BLEND):m.disable(m.BLEND),R.blend=w.blend),R.blendEq===w.blendEq&&R.blendAlphaEq===w.blendAlphaEq||(m.blendEquationSeparate(_W[w.blendEq],_W[w.blendAlphaEq]),R.blendEq=w.blendEq,R.blendAlphaEq=w.blendAlphaEq),R.blendSrc===w.blendSrc&&R.blendDst===w.blendDst&&R.blendSrcAlpha===w.blendSrcAlpha&&R.blendDstAlpha===w.blendDstAlpha||(m.blendFuncSeparate(dW[w.blendSrc],dW[w.blendDst],dW[w.blendSrcAlpha],dW[w.blendDstAlpha]),R.blendSrc=w.blendSrc,R.blendDst=w.blendDst,R.blendSrcAlpha=w.blendSrcAlpha,R.blendDstAlpha=w.blendDstAlpha),R.blendColorMask!==w.blendColorMask&&(m.colorMask((w.blendColorMask&fl.R)!==fl.NONE,(w.blendColorMask&fl.G)!==fl.NONE,(w.blendColorMask&fl.B)!==fl.NONE,(w.blendColorMask&fl.A)!==fl.NONE),R.blendColorMask=w.blendColorMask)}}if(e&&e.gpuPipelineLayout&&v){for(var x=v.glBlocks.length,O=e.gpuPipelineLayout.dynamicOffsetIndices,I=0;I<x;I++){var M=v.glBlocks[I],B=r[M.set],P=B&&B.descriptorIndices[M.binding],N=P>=0&&B.gpuDescriptors[P],L=null,F=0;if(N&&N.gpuBuffer){var D=N.gpuBuffer,U=O[M.set],k=U&&U[M.binding];k>=0&&(F=n[k]),"vf32"in D?L=D.vf32:(F+=D.offset,L=D.gpuBuffer.vf32),F>>=2}if(L)for(var z=M.glActiveUniforms.length,G=0;G<z;G++){var H=M.glActiveUniforms[G];switch(H.glType){case m.BOOL:case m.INT:for(var V=0;V<H.array.length;++V){var W=H.begin+F+V;if(L[W]!==H.array[V]){for(var j=V,X=W;j<H.array.length;++j,++X)H.array[j]=L[X];m.uniform1iv(H.glLoc,H.array);break}}break;case m.BOOL_VEC2:case m.INT_VEC2:for(var Y=0;Y<H.array.length;++Y){var q=H.begin+F+Y;if(L[q]!==H.array[Y]){for(var K=Y,Z=q;K<H.array.length;++K,++Z)H.array[K]=L[Z];m.uniform2iv(H.glLoc,H.array);break}}break;case m.BOOL_VEC3:case m.INT_VEC3:for(var Q=0;Q<H.array.length;++Q){var J=H.begin+F+Q;if(L[J]!==H.array[Q]){for(var $=Q,tt=J;$<H.array.length;++$,++tt)H.array[$]=L[tt];m.uniform3iv(H.glLoc,H.array);break}}break;case m.BOOL_VEC4:case m.INT_VEC4:for(var et=0;et<H.array.length;++et){var it=H.begin+F+et;if(L[it]!==H.array[et]){for(var rt=et,nt=it;rt<H.array.length;++rt,++nt)H.array[rt]=L[nt];m.uniform4iv(H.glLoc,H.array);break}}break;case m.FLOAT:for(var st=0;st<H.array.length;++st){var at=H.begin+F+st;if(L[at]!==H.array[st]){for(var ot=st,ht=at;ot<H.array.length;++ot,++ht)H.array[ot]=L[ht];m.uniform1fv(H.glLoc,H.array);break}}break;case m.FLOAT_VEC2:for(var lt=0;lt<H.array.length;++lt){var ut=H.begin+F+lt;if(L[ut]!==H.array[lt]){for(var ct=lt,_t=ut;ct<H.array.length;++ct,++_t)H.array[ct]=L[_t];m.uniform2fv(H.glLoc,H.array);break}}break;case m.FLOAT_VEC3:for(var dt=0;dt<H.array.length;++dt){var pt=H.begin+F+dt;if(L[pt]!==H.array[dt]){for(var ft=dt,mt=pt;ft<H.array.length;++ft,++mt)H.array[ft]=L[mt];m.uniform3fv(H.glLoc,H.array);break}}break;case m.FLOAT_VEC4:for(var gt=0;gt<H.array.length;++gt){var vt=H.begin+F+gt;if(L[vt]!==H.array[gt]){for(var yt=gt,Tt=vt;yt<H.array.length;++yt,++Tt)H.array[yt]=L[Tt];m.uniform4fv(H.glLoc,H.array);break}}break;case m.FLOAT_MAT2:for(var Et=0;Et<H.array.length;++Et){var St=H.begin+F+Et;if(L[St]!==H.array[Et]){for(var bt=Et,At=St;bt<H.array.length;++bt,++At)H.array[bt]=L[At];m.uniformMatrix2fv(H.glLoc,!1,H.array);break}}break;case m.FLOAT_MAT3:for(var Ct=0;Ct<H.array.length;++Ct){var wt=H.begin+F+Ct;if(L[wt]!==H.array[Ct]){for(var Rt=Ct,xt=wt;Rt<H.array.length;++Rt,++xt)H.array[Rt]=L[xt];m.uniformMatrix3fv(H.glLoc,!1,H.array);break}}break;case m.FLOAT_MAT4:for(var Ot=0;Ot<H.array.length;++Ot){var It=H.begin+F+Ot;if(L[It]!==H.array[Ot]){for(var Mt=Ot,Bt=It;Mt<H.array.length;++Mt,++Bt)H.array[Mt]=L[Bt];m.uniformMatrix4fv(H.glLoc,!1,H.array);break}}}}else S("Buffer binding '"+M.name+"' at set "+M.set+" binding "+M.binding+" is not bounded")}for(var Pt=v.glSamplers.length,Nt=0;Nt<Pt;Nt++)for(var Lt=v.glSamplers[Nt],Ft=r[Lt.set],Dt=Ft&&Ft.descriptorIndices[Lt.binding],Ut=Dt>=0&&Ft.gpuDescriptors[Dt],kt=Lt.units.length,zt=0;zt<kt;zt++){var Gt=Lt.units[zt];if(Ut&&Ut.gpuSampler){if(Ut.gpuTexture&&Ut.gpuTexture.size>0){var Ht=Ut.gpuTexture,Vt=g.glTexUnits[Gt];Vt.glTexture!==Ht.glTexture&&(g.texUnit!==Gt&&(m.activeTexture(m.TEXTURE0+Gt),g.texUnit=Gt),Ht.glTexture?m.bindTexture(Ht.glTarget,Ht.glTexture):m.bindTexture(Ht.glTarget,t.nullTex2D.gpuTexture.glTexture),Vt.glTexture=Ht.glTexture);var Wt=Ut.gpuSampler;Ht.isPowerOf2?(d=Wt.glWrapS,p=Wt.glWrapT):(d=m.CLAMP_TO_EDGE,p=m.CLAMP_TO_EDGE),f=Ht.isPowerOf2?Ht.mipLevel<=1&&(Wt.glMinFilter===m.LINEAR_MIPMAP_NEAREST||Wt.glMinFilter===m.LINEAR_MIPMAP_LINEAR)?m.LINEAR:Wt.glMinFilter:Wt.glMinFilter===m.LINEAR||Wt.glMinFilter===m.LINEAR_MIPMAP_NEAREST||Wt.glMinFilter===m.LINEAR_MIPMAP_LINEAR?m.LINEAR:m.NEAREST,Ht.glWrapS!==d&&(g.texUnit!==Gt&&(m.activeTexture(m.TEXTURE0+Gt),g.texUnit=Gt),m.texParameteri(Ht.glTarget,m.TEXTURE_WRAP_S,d),Ht.glWrapS=d),Ht.glWrapT!==p&&(g.texUnit!==Gt&&(m.activeTexture(m.TEXTURE0+Gt),g.texUnit=Gt),m.texParameteri(Ht.glTarget,m.TEXTURE_WRAP_T,p),Ht.glWrapT=p),Ht.glMinFilter!==f&&(g.texUnit!==Gt&&(m.activeTexture(m.TEXTURE0+Gt),g.texUnit=Gt),m.texParameteri(Ht.glTarget,m.TEXTURE_MIN_FILTER,f),Ht.glMinFilter=f),Ht.glMagFilter!==Wt.glMagFilter&&(g.texUnit!==Gt&&(m.activeTexture(m.TEXTURE0+Gt),g.texUnit=Gt),m.texParameteri(Ht.glTarget,m.TEXTURE_MAG_FILTER,Wt.glMagFilter),Ht.glMagFilter=Wt.glMagFilter)}Ut=Ft.gpuDescriptors[++Dt]}else S("Sampler binding '"+Lt.name+"' at set "+Lt.set+" binding "+Lt.binding+" index "+zt+" is not bounded")}}if(i&&v&&(y||SW.gpuInputAssembler!==i)){SW.gpuInputAssembler=i;var jt=t.ANGLE_instanced_arrays;if(t.useVAO){var Xt=t.OES_vertex_array_object,Yt=i.glVAOs.get(v.glProgram);if(!Yt){var qt;Yt=Xt.createVertexArrayOES(),i.glVAOs.set(v.glProgram,Yt),Xt.bindVertexArrayOES(Yt),m.bindBuffer(m.ARRAY_BUFFER,null),m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,null),g.glArrayBuffer=null,g.glElementArrayBuffer=null;for(var Kt=v.glInputs.length,Zt=0;Zt<Kt;Zt++){var Qt=v.glInputs[Zt];qt=null;for(var Jt=i.glAttribs.length,$t=0;$t<Jt;$t++){var te=i.glAttribs[$t];if(te.name===Qt.name){qt=te;break}}if(qt){g.glArrayBuffer!==qt.glBuffer&&(m.bindBuffer(m.ARRAY_BUFFER,qt.glBuffer),g.glArrayBuffer=qt.glBuffer);for(var ee=0;ee<qt.componentCount;++ee){var ie=Qt.glLoc+ee,re=qt.offset+qt.size*ee;m.enableVertexAttribArray(ie),g.glCurrentAttribLocs[ie]=!0,m.vertexAttribPointer(ie,qt.count,qt.glType,qt.isNormalized,qt.stride,re),jt&&jt.vertexAttribDivisorANGLE(ie,qt.isInstanced?1:0)}}}var ne=i.gpuIndexBuffer;ne&&m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,ne.glBuffer),Xt.bindVertexArrayOES(null),m.bindBuffer(m.ARRAY_BUFFER,null),m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,null),g.glArrayBuffer=null,g.glElementArrayBuffer=null}g.glVAO!==Yt&&(Xt.bindVertexArrayOES(Yt),g.glVAO=Yt)}else{for(var se=0;se<t.maxVertexAttributes;++se)g.glCurrentAttribLocs[se]=!1;for(var ae=v.glInputs.length,oe=0;oe<ae;oe++){for(var he=v.glInputs[oe],le=null,ue=i.glAttribs.length,ce=0;ce<ue;ce++){var _e=i.glAttribs[ce];if(_e.name===he.name){le=_e;break}}if(le){g.glArrayBuffer!==le.glBuffer&&(m.bindBuffer(m.ARRAY_BUFFER,le.glBuffer),g.glArrayBuffer=le.glBuffer);for(var de=0;de<le.componentCount;++de){var pe=he.glLoc+de,fe=le.offset+le.size*de;!g.glEnabledAttribLocs[pe]&&pe>=0&&(m.enableVertexAttribArray(pe),g.glEnabledAttribLocs[pe]=!0),g.glCurrentAttribLocs[pe]=!0,m.vertexAttribPointer(pe,le.count,le.glType,le.isNormalized,le.stride,fe),jt&&jt.vertexAttribDivisorANGLE(pe,le.isInstanced?1:0)}}}var me=i.gpuIndexBuffer;me&&g.glElementArrayBuffer!==me.glBuffer&&(m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,me.glBuffer),g.glElementArrayBuffer=me.glBuffer);for(var ge=0;ge<t.maxVertexAttributes;++ge)g.glEnabledAttribLocs[ge]!==g.glCurrentAttribLocs[ge]&&(m.disableVertexAttribArray(ge),g.glEnabledAttribLocs[ge]=!1)}}if(e&&e.dynamicStates.length)for(var ve=e.dynamicStates.length,ye=0;ye<ve;ye++)switch(e.dynamicStates[ye]){case Ol.VIEWPORT:s&&(g.viewport.left===s.left&&g.viewport.top===s.top&&g.viewport.width===s.width&&g.viewport.height===s.height||(m.viewport(s.left,s.top,s.width,s.height),g.viewport.left=s.left,g.viewport.top=s.top,g.viewport.width=s.width,g.viewport.height=s.height));break;case Ol.SCISSOR:a&&(g.scissorRect.x===a.x&&g.scissorRect.y===a.y&&g.scissorRect.width===a.width&&g.scissorRect.height===a.height||(m.scissor(a.x,a.y,a.width,a.height),g.scissorRect.x=a.x,g.scissorRect.y=a.y,g.scissorRect.width=a.width,g.scissorRect.height=a.height));break;case Ol.LINE_WIDTH:o&&g.rs.lineWidth!==o&&(m.lineWidth(o),g.rs.lineWidth=o);break;case Ol.DEPTH_BIAS:h&&(g.rs.depthBias===h.constantFactor&&g.rs.depthBiasSlop===h.slopeFactor||(m.polygonOffset(h.constantFactor,h.slopeFactor),g.rs.depthBias=h.constantFactor,g.rs.depthBiasSlop=h.slopeFactor));break;case Ol.BLEND_CONSTANTS:g.bs.blendColor.x===l[0]&&g.bs.blendColor.y===l[1]&&g.bs.blendColor.z===l[2]&&g.bs.blendColor.w===l[3]||(m.blendColor(l[0],l[1],l[2],l[3]),g.bs.blendColor.x=l[0],g.bs.blendColor.y=l[1],g.bs.blendColor.z=l[2],g.bs.blendColor.w=l[3]);break;case Ol.STENCIL_WRITE_MASK:if(c)switch(c.face){case Il.FRONT:g.dss.stencilWriteMaskFront!==c.writeMask&&(m.stencilMaskSeparate(m.FRONT,c.writeMask),g.dss.stencilWriteMaskFront=c.writeMask);break;case Il.BACK:g.dss.stencilWriteMaskBack!==c.writeMask&&(m.stencilMaskSeparate(m.BACK,c.writeMask),g.dss.stencilWriteMaskBack=c.writeMask);break;case Il.ALL:g.dss.stencilWriteMaskFront===c.writeMask&&g.dss.stencilWriteMaskBack===c.writeMask||(m.stencilMask(c.writeMask),g.dss.stencilWriteMaskFront=c.writeMask,g.dss.stencilWriteMaskBack=c.writeMask)}break;case Ol.STENCIL_COMPARE_MASK:if(_)switch(_.face){case Il.FRONT:g.dss.stencilRefFront===_.reference&&g.dss.stencilReadMaskFront===_.compareMask||(m.stencilFuncSeparate(m.FRONT,uW[g.dss.stencilFuncFront],_.reference,_.compareMask),g.dss.stencilRefFront=_.reference,g.dss.stencilReadMaskFront=_.compareMask);break;case Il.BACK:g.dss.stencilRefBack===_.reference&&g.dss.stencilReadMaskBack===_.compareMask||(m.stencilFuncSeparate(m.BACK,uW[g.dss.stencilFuncBack],_.reference,_.compareMask),g.dss.stencilRefBack=_.reference,g.dss.stencilReadMaskBack=_.compareMask);break;case Il.ALL:g.dss.stencilRefFront===_.reference&&g.dss.stencilReadMaskFront===_.compareMask&&g.dss.stencilRefBack===_.reference&&g.dss.stencilReadMaskBack===_.compareMask||(m.stencilFunc(uW[g.dss.stencilFuncBack],_.reference,_.compareMask),g.dss.stencilRefFront=_.reference,g.dss.stencilReadMaskFront=_.compareMask,g.dss.stencilRefBack=_.reference,g.dss.stencilReadMaskBack=_.compareMask)}}}function CW(t,e){var i=t.gl,r=t.ANGLE_instanced_arrays,n=SW.gpuInputAssembler,s=SW.glPrimitive;if(n)if(n.gpuIndirectBuffer)for(var a=n.gpuIndirectBuffer.indirects.length,o=0;o<a;o++){var h=n.gpuIndirectBuffer.indirects[o],l=n.gpuIndexBuffer;if(h.instanceCount&&r)if(l){if(h.indexCount>0){var u=h.firstIndex*l.stride;r.drawElementsInstancedANGLE(s,h.indexCount,n.glIndexType,u,h.instanceCount)}}else h.vertexCount>0&&r.drawArraysInstancedANGLE(s,h.firstVertex,h.vertexCount,h.instanceCount);else if(l){if(h.indexCount>0){var c=h.firstIndex*l.stride;i.drawElements(s,h.indexCount,n.glIndexType,c)}}else h.vertexCount>0&&i.drawArrays(s,h.firstVertex,h.vertexCount)}else{var _=n.gpuIndexBuffer;if(e.instanceCount&&r)if(_){if(e.indexCount>0){var d=e.firstIndex*_.stride;r.drawElementsInstancedANGLE(s,e.indexCount,n.glIndexType,d,e.instanceCount)}}else e.vertexCount>0&&r.drawArraysInstancedANGLE(s,e.firstVertex,e.vertexCount,e.instanceCount);else if(_){if(e.indexCount>0){var p=e.firstIndex*_.stride;i.drawElements(s,e.indexCount,n.glIndexType,p)}}else e.vertexCount>0&&i.drawArrays(s,e.firstVertex,e.vertexCount)}}var wW=new Array(lW.COUNT);function RW(t,e){wW.fill(0);for(var i=0;i<e.cmds.length;++i){var r=e.cmds.array[i],n=wW[r]++;switch(r){case lW.BEGIN_RENDER_PASS:var s=e.beginRenderPassCmds.array[n];bW(t,s.gpuRenderPass,s.gpuFramebuffer,s.renderArea,s.clearColors,s.clearDepth,s.clearStencil);break;case lW.BIND_STATES:var a=e.bindStatesCmds.array[n];AW(t,a.gpuPipelineState,a.gpuInputAssembler,a.gpuDescriptorSets,a.dynamicOffsets,a.viewport,a.scissor,a.lineWidth,a.depthBias,a.blendConstants,a.depthBounds,a.stencilWriteMask,a.stencilCompareMask);break;case lW.DRAW:CW(t,e.drawCmds.array[n].drawInfo);break;case lW.UPDATE_BUFFER:var o=e.updateBufferCmds.array[n];EW(t,o.gpuBuffer,o.buffer,o.offset,o.size);break;case lW.COPY_BUFFER_TO_TEXTURE:var h=e.copyBufferToTextureCmds.array[n];xW(t,h.buffers,h.gpuTexture,h.regions)}}}function xW(t,e,i,r){var n=t.gl,s=t.stateCache.glTexUnits[t.stateCache.texUnit];s.glTexture!==i.glTexture&&(n.bindTexture(i.glTarget,i.glTexture),s.glTexture=i.glTexture);var a=0,o=1,h=1,l=0,u=zl[i.format].isCompressed;switch(i.glTarget){case n.TEXTURE_2D:for(var c=0;c<r.length;c++){var _=r[c];o=_.texExtent.width,h=_.texExtent.height;var d=e[a++];u?i.glInternalFmt===$V.COMPRESSED_RGB_ETC1_WEBGL||t.noCompressedTexSubImage2D?n.compressedTexImage2D(n.TEXTURE_2D,_.texSubres.mipLevel,i.glInternalFmt,o,h,0,d):n.compressedTexSubImage2D(n.TEXTURE_2D,_.texSubres.mipLevel,_.texOffset.x,_.texOffset.y,o,h,i.glFormat,d):n.texSubImage2D(n.TEXTURE_2D,_.texSubres.mipLevel,_.texOffset.x,_.texOffset.y,o,h,i.glFormat,i.glType,d)}break;case n.TEXTURE_CUBE_MAP:for(var p=0;p<r.length;p++){var f=r[p],m=f.texSubres.baseArrayLayer+f.texSubres.layerCount;for(l=f.texSubres.baseArrayLayer;l<m;++l){o=f.texExtent.width,h=f.texExtent.height;var g=e[a++];u?i.glInternalFmt===$V.COMPRESSED_RGB_ETC1_WEBGL||t.noCompressedTexSubImage2D?n.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+l,f.texSubres.mipLevel,i.glInternalFmt,o,h,0,g):n.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+l,f.texSubres.mipLevel,f.texOffset.x,f.texOffset.y,o,h,i.glFormat,g):n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+l,f.texSubres.mipLevel,f.texOffset.x,f.texOffset.y,o,h,i.glFormat,i.glType,g)}}break;default:console.error("Unsupported GL texture type, copy buffer to texture failed.")}i.flags&El.GEN_MIPMAP&&n.generateMipmap(i.glTarget)}var OW=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuBuffer=null,e._gpuBufferView=null,e._uniformBuffer=null,e}s(e,t);var i=e.prototype;return i.initialize=function(t){if("buffer"in t){this._isBufferView=!0;var e=t.buffer;this._usage=e.usage,this._memUsage=e.memUsage,this._size=this._stride=t.range,this._count=1,this._flags=e.flags,this._gpuBufferView={gpuBuffer:e.gpuBuffer,offset:t.offset,range:t.range}}else this._usage=t.usage,this._memUsage=t.memUsage,this._size=t.size,this._stride=Math.max(t.stride||this._size,1),this._count=this._size/this._stride,this._flags=t.flags,this._usage&rl.INDIRECT&&(this._indirectBuffer=new ql),this._flags&sl.BAKUP_BUFFER&&(this._bakcupBuffer=new Uint8Array(this._size),this._device.memoryStatus.bufferSize+=this._size),this._usage&rl.UNIFORM&&this._size>0&&(this._uniformBuffer=new Uint8Array(this._size)),this._gpuBuffer={usage:this._usage,memUsage:this._memUsage,size:this._size,stride:this._stride,buffer:this._bakcupBuffer,vf32:null,indirects:[],glTarget:0,glBuffer:null},t.usage&rl.INDIRECT&&(this._gpuBuffer.indirects=this._indirectBuffer.drawInfos),this._usage&rl.UNIFORM&&(this._gpuBuffer.buffer=this._uniformBuffer),function(t,e){var i=t.gl,r=t.stateCache,n=e.memUsage&nl.HOST?i.DYNAMIC_DRAW:i.STATIC_DRAW;if(e.usage&rl.VERTEX){e.glTarget=i.ARRAY_BUFFER;var s=i.createBuffer();s&&(e.glBuffer=s,e.size>0&&(t.useVAO&&r.glVAO&&(t.OES_vertex_array_object.bindVertexArrayOES(null),r.glVAO=SW.gpuInputAssembler=null),t.stateCache.glArrayBuffer!==e.glBuffer&&(i.bindBuffer(i.ARRAY_BUFFER,e.glBuffer),t.stateCache.glArrayBuffer=e.glBuffer),i.bufferData(i.ARRAY_BUFFER,e.size,n),i.bindBuffer(i.ARRAY_BUFFER,null),t.stateCache.glArrayBuffer=null))}else if(e.usage&rl.INDEX){e.glTarget=i.ELEMENT_ARRAY_BUFFER;var a=i.createBuffer();a&&(e.glBuffer=a,e.size>0&&(t.useVAO&&r.glVAO&&(t.OES_vertex_array_object.bindVertexArrayOES(null),r.glVAO=SW.gpuInputAssembler=null),t.stateCache.glElementArrayBuffer!==e.glBuffer&&(i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.glBuffer),t.stateCache.glElementArrayBuffer=e.glBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e.size,n),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),t.stateCache.glElementArrayBuffer=null))}else e.usage&rl.UNIFORM?(e.glTarget=i.NONE,e.buffer&&(e.vf32=new Float32Array(e.buffer.buffer))):(e.usage&rl.INDIRECT||e.usage&rl.TRANSFER_DST||e.usage&rl.TRANSFER_SRC||console.error("Unsupported BufferType, create buffer failed."),e.glTarget=i.NONE)}(this._device,this._gpuBuffer),this._device.memoryStatus.bufferSize+=this._size;return!0},i.destroy=function(){var t,e;this._gpuBuffer&&(t=this._device,(e=this._gpuBuffer).glBuffer&&(t.gl.deleteBuffer(e.glBuffer),e.glBuffer=null),this._device.memoryStatus.bufferSize-=this._size,this._gpuBuffer=null),this._gpuBufferView&&(this._gpuBufferView=null),this._bakcupBuffer=null},i.resize=function(t){if(this._isBufferView)console.warn("cannot resize buffer views!");else{var e=this._size;if(e!==t){if(this._size=t,this._count=this._size/this._stride,this._bakcupBuffer){var i=this._bakcupBuffer;this._bakcupBuffer=new Uint8Array(this._size),this._bakcupBuffer.set(i),this._device.memoryStatus.bufferSize-=e,this._device.memoryStatus.bufferSize+=t}this._uniformBuffer&&(this._uniformBuffer=new Uint8Array(t)),this._gpuBuffer&&(this._uniformBuffer?this._gpuBuffer.buffer=this._uniformBuffer:this._bakcupBuffer&&(this._gpuBuffer.buffer=this._bakcupBuffer),this._gpuBuffer.size=t,t>0&&(function(t,e){var i=t.gl,r=t.stateCache,n=e.memUsage&nl.HOST?i.DYNAMIC_DRAW:i.STATIC_DRAW;e.usage&rl.VERTEX?(t.useVAO&&r.glVAO&&(t.OES_vertex_array_object.bindVertexArrayOES(null),r.glVAO=SW.gpuInputAssembler=null),t.stateCache.glArrayBuffer!==e.glBuffer&&i.bindBuffer(i.ARRAY_BUFFER,e.glBuffer),e.buffer?i.bufferData(i.ARRAY_BUFFER,e.buffer,n):i.bufferData(i.ARRAY_BUFFER,e.size,n),i.bindBuffer(i.ARRAY_BUFFER,null),t.stateCache.glArrayBuffer=null):e.usage&rl.INDEX?(t.useVAO&&r.glVAO&&(t.OES_vertex_array_object.bindVertexArrayOES(null),r.glVAO=SW.gpuInputAssembler=null),t.stateCache.glElementArrayBuffer!==e.glBuffer&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.glBuffer),e.buffer?i.bufferData(i.ELEMENT_ARRAY_BUFFER,e.buffer,n):i.bufferData(i.ELEMENT_ARRAY_BUFFER,e.size,n),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),t.stateCache.glElementArrayBuffer=null):e.usage&rl.UNIFORM?e.buffer&&(e.vf32=new Float32Array(e.buffer.buffer)):(e.usage&rl.INDIRECT||e.usage&rl.TRANSFER_DST||e.usage&rl.TRANSFER_SRC||console.error("Unsupported BufferType, create buffer failed."),e.glTarget=i.NONE)}(this._device,this._gpuBuffer),this._device.memoryStatus.bufferSize-=e,this._device.memoryStatus.bufferSize+=t))}}},i.update=function(t,e,i){if(this._isBufferView)console.warn("cannot update through buffer views!");else{var r;if(r=void 0!==i?i:this._usage&rl.INDIRECT?0:t.byteLength,this._bakcupBuffer&&t!==this._bakcupBuffer.buffer){var n=new Uint8Array(t,0,i);this._bakcupBuffer.set(n,e)}EW(this._device,this._gpuBuffer,t,e||0,r)}},r(e,[{key:"gpuBuffer",get:function(){return this._gpuBuffer}},{key:"gpuBufferView",get:function(){return this._gpuBufferView}}]),e}(Ql),IW=function(){function t(t,e){this._frees=void 0,this._freeIdx=0,this._freeCmds=void 0,this._frees=new Array(e),this._freeCmds=new Wi(e);for(var i=0;i<e;++i)this._frees[i]=new t;this._freeIdx=e-1}var e=t.prototype;return e.alloc=function(t){if(this._freeIdx<0){var e=2*this._frees.length,i=this._frees;this._frees=new Array(e);for(var r=e-i.length,n=0;n<r;++n)this._frees[n]=new t;for(var s=r,a=0;s<e;++s,++a)this._frees[s]=i[a];this._freeIdx+=r}var o=this._frees[this._freeIdx];return this._frees[this._freeIdx--]=null,++o.refCount,o},e.free=function(t){0==--t.refCount&&this._freeCmds.push(t)},e.freeCmds=function(t){for(var e=0;e<t.length;++e)0==--t.array[e].refCount&&this._freeCmds.push(t.array[e])},e.release=function(){for(var t=0;t<this._freeCmds.length;++t){var e=this._freeCmds.array[t];e.clear(),this._frees[++this._freeIdx]=e}this._freeCmds.clear()},t}(),MW=function(){function t(){this.beginRenderPassCmdPool=void 0,this.bindStatesCmdPool=void 0,this.drawCmdPool=void 0,this.updateBufferCmdPool=void 0,this.copyBufferToTextureCmdPool=void 0,this.beginRenderPassCmdPool=new IW(fW,1),this.bindStatesCmdPool=new IW(mW,1),this.drawCmdPool=new IW(gW,1),this.updateBufferCmdPool=new IW(vW,1),this.copyBufferToTextureCmdPool=new IW(yW,1)}var e=t.prototype;return e.clearCmds=function(t){t.beginRenderPassCmds.length&&(this.beginRenderPassCmdPool.freeCmds(t.beginRenderPassCmds),t.beginRenderPassCmds.clear()),t.bindStatesCmds.length&&(this.bindStatesCmdPool.freeCmds(t.bindStatesCmds),t.bindStatesCmds.clear()),t.drawCmds.length&&(this.drawCmdPool.freeCmds(t.drawCmds),t.drawCmds.clear()),t.updateBufferCmds.length&&(this.updateBufferCmdPool.freeCmds(t.updateBufferCmds),t.updateBufferCmds.clear()),t.copyBufferToTextureCmds.length&&(this.copyBufferToTextureCmdPool.freeCmds(t.copyBufferToTextureCmds),t.copyBufferToTextureCmds.clear()),t.cmds.clear()},e.releaseCmds=function(){this.beginRenderPassCmdPool.release(),this.bindStatesCmdPool.release(),this.drawCmdPool.release(),this.updateBufferCmdPool.release(),this.copyBufferToTextureCmdPool.release()},t}(),BW=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).cmdPackage=new TW,e._webGLAllocator=null,e._isInRenderPass=!1,e._curGPUPipelineState=null,e._curGPUInputAssembler=null,e._curGPUDescriptorSets=[],e._curDynamicOffsets=[],e._curViewport=null,e._curScissor=null,e._curLineWidth=null,e._curDepthBias=null,e._curBlendConstants=[],e._curDepthBounds=null,e._curStencilWriteMask=null,e._curStencilCompareMask=null,e._isStateInvalied=!1,e}s(e,t);var i=e.prototype;return i.initialize=function(t){this._type=t.type,this._queue=t.queue,this._webGLAllocator=this._device.cmdAllocator;for(var e=this._device.bindingMappingInfo.bufferOffsets.length,i=0;i<e;i++)this._curGPUDescriptorSets.push(null),this._curDynamicOffsets.push([]);return!0},i.destroy=function(){this._webGLAllocator&&(this._webGLAllocator.clearCmds(this.cmdPackage),this._webGLAllocator=null)},i.begin=function(){this._webGLAllocator.clearCmds(this.cmdPackage),this._curGPUPipelineState=null,this._curGPUInputAssembler=null,this._curGPUDescriptorSets.length=0;for(var t=0;t<this._curDynamicOffsets.length;t++)this._curDynamicOffsets[t].length=0;this._curViewport=null,this._curScissor=null,this._curLineWidth=null,this._curDepthBias=null,this._curBlendConstants.length=0,this._curDepthBounds=null,this._curStencilWriteMask=null,this._curStencilCompareMask=null,this._numDrawCalls=0,this._numInstances=0,this._numTris=0},i.end=function(){this._isStateInvalied&&this.bindStates(),this._isInRenderPass=!1},i.beginRenderPass=function(t,e,i,r,n,s){var a=this._webGLAllocator.beginRenderPassCmdPool.alloc(fW);a.gpuRenderPass=t.gpuRenderPass,a.gpuFramebuffer=e.gpuFramebuffer,a.renderArea=i,a.clearColors.length=r.length;for(var o=0;o<r.length;++o)a.clearColors[o]=r[o];a.clearDepth=n,a.clearStencil=s,this.cmdPackage.beginRenderPassCmds.push(a),this.cmdPackage.cmds.push(lW.BEGIN_RENDER_PASS),this._isInRenderPass=!0},i.endRenderPass=function(){this._isInRenderPass=!1},i.bindPipelineState=function(t){var e=t.gpuPipelineState;e!==this._curGPUPipelineState&&(this._curGPUPipelineState=e,this._isStateInvalied=!0)},i.bindDescriptorSet=function(t,e,i){var r=e.gpuDescriptorSet;if(r!==this._curGPUDescriptorSets[t]&&(this._curGPUDescriptorSets[t]=r,this._isStateInvalied=!0),i){for(var n=this._curDynamicOffsets[t],s=0;s<i.length;s++)n[s]=i[s];n.length=i.length,this._isStateInvalied=!0}},i.bindInputAssembler=function(t){var e=t.gpuInputAssembler;this._curGPUInputAssembler=e,this._isStateInvalied=!0},i.setViewport=function(t){this._curViewport?this._curViewport.left===t.left&&this._curViewport.top===t.top&&this._curViewport.width===t.width&&this._curViewport.height===t.height&&this._curViewport.minDepth===t.minDepth&&this._curViewport.maxDepth===t.maxDepth||(this._curViewport.left=t.left,this._curViewport.top=t.top,this._curViewport.width=t.width,this._curViewport.height=t.height,this._curViewport.minDepth=t.minDepth,this._curViewport.maxDepth=t.maxDepth,this._isStateInvalied=!0):this._curViewport=new _u(t.left,t.top,t.width,t.height,t.minDepth,t.maxDepth)},i.setScissor=function(t){this._curScissor?this._curScissor.x===t.x&&this._curScissor.y===t.y&&this._curScissor.width===t.width&&this._curScissor.height===t.height||(this._curScissor.x=t.x,this._curScissor.y=t.y,this._curScissor.width=t.width,this._curScissor.height=t.height,this._isStateInvalied=!0):this._curScissor=new cu(t.x,t.y,t.width,t.height)},i.setLineWidth=function(t){this._curLineWidth!==t&&(this._curLineWidth=t,this._isStateInvalied=!0)},i.setDepthBias=function(t,e,i){this._curDepthBias?this._curDepthBias.constantFactor===t&&this._curDepthBias.clamp===e&&this._curDepthBias.slopeFactor===i||(this._curDepthBias.constantFactor=t,this._curDepthBias.clamp=e,this._curDepthBias.slopeFactor=i,this._isStateInvalied=!0):(this._curDepthBias={constantFactor:t,clamp:e,slopeFactor:i},this._isStateInvalied=!0)},i.setBlendConstants=function(t){4!==t.length||this._curBlendConstants[0]===t[0]&&this._curBlendConstants[1]===t[1]&&this._curBlendConstants[2]===t[2]&&this._curBlendConstants[3]===t[3]||(this._curBlendConstants.length=0,Array.prototype.push.apply(this._curBlendConstants,t),this._isStateInvalied=!0)},i.setDepthBound=function(t,e){this._curDepthBounds&&this._curDepthBounds.minBounds===t&&this._curDepthBounds.maxBounds===e||(this._curDepthBounds={minBounds:t,maxBounds:e},this._isStateInvalied=!0)},i.setStencilWriteMask=function(t,e){this._curStencilWriteMask?this._curStencilWriteMask.face===t&&this._curStencilWriteMask.writeMask===e||(this._curStencilWriteMask.face=t,this._curStencilWriteMask.writeMask=e,this._isStateInvalied=!0):(this._curStencilWriteMask={face:t,writeMask:e},this._isStateInvalied=!0)},i.setStencilCompareMask=function(t,e,i){this._curStencilCompareMask?this._curStencilCompareMask.face===t&&this._curStencilCompareMask.reference===e&&this._curStencilCompareMask.compareMask===i||(this._curStencilCompareMask.face=t,this._curStencilCompareMask.reference=e,this._curStencilCompareMask.compareMask=i,this._isStateInvalied=!0):(this._curStencilCompareMask={face:t,reference:e,compareMask:i},this._isStateInvalied=!0)},i.draw=function(t){if(this._type===Al.PRIMARY&&this._isInRenderPass||this._type===Al.SECONDARY){this._isStateInvalied&&this.bindStates();var e=this._webGLAllocator.drawCmdPool.alloc(gW);e.drawInfo.vertexCount=t.vertexCount,e.drawInfo.firstVertex=t.firstVertex,e.drawInfo.indexCount=t.indexCount,e.drawInfo.firstIndex=t.firstIndex,e.drawInfo.vertexOffset=t.vertexOffset,e.drawInfo.instanceCount=t.instanceCount,e.drawInfo.firstInstance=t.firstInstance,this.cmdPackage.drawCmds.push(e),this.cmdPackage.cmds.push(lW.DRAW),++this._numDrawCalls,this._numInstances+=t.instanceCount;var i=t.indexCount||t.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=i/3*Math.max(t.instanceCount,1);break;case 5:case 6:this._numTris+=(i-2)*Math.max(t.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},i.updateBuffer=function(t,e,i,r){if(this._type===Al.PRIMARY&&!this._isInRenderPass||this._type===Al.SECONDARY){var n=t.gpuBuffer;if(n){var s,a=this._webGLAllocator.updateBufferCmdPool.alloc(vW),o=0;t.usage&rl.INDIRECT||(o=void 0!==r?r:e.byteLength),s=e,a.gpuBuffer=n,a.buffer=s,a.offset=void 0!==i?i:0,a.size=o,this.cmdPackage.updateBufferCmds.push(a),this.cmdPackage.cmds.push(lW.UPDATE_BUFFER)}}else console.error("Command 'updateBuffer' must be recorded outside a render pass.")},i.copyBuffersToTexture=function(t,e,i){if(this._type===Al.PRIMARY&&!this._isInRenderPass||this._type===Al.SECONDARY){var r=e.gpuTexture;if(r){var n=this._webGLAllocator.copyBufferToTextureCmdPool.alloc(yW);n&&(n.gpuTexture=r,n.regions=i,n.buffers=t,this.cmdPackage.copyBufferToTextureCmds.push(n),this.cmdPackage.cmds.push(lW.COPY_BUFFER_TO_TEXTURE))}}else console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.")},i.execute=function(t,e){for(var i=0;i<e;++i){for(var r=t[i],n=0;n<r.cmdPackage.beginRenderPassCmds.length;++n){var s=r.cmdPackage.beginRenderPassCmds.array[n];++s.refCount,this.cmdPackage.beginRenderPassCmds.push(s)}for(var a=0;a<r.cmdPackage.bindStatesCmds.length;++a){var o=r.cmdPackage.bindStatesCmds.array[a];++o.refCount,this.cmdPackage.bindStatesCmds.push(o)}for(var h=0;h<r.cmdPackage.drawCmds.length;++h){var l=r.cmdPackage.drawCmds.array[h];++l.refCount,this.cmdPackage.drawCmds.push(l)}for(var u=0;u<r.cmdPackage.updateBufferCmds.length;++u){var c=r.cmdPackage.updateBufferCmds.array[u];++c.refCount,this.cmdPackage.updateBufferCmds.push(c)}for(var _=0;_<r.cmdPackage.copyBufferToTextureCmds.length;++_){var d=r.cmdPackage.copyBufferToTextureCmds.array[_];++d.refCount,this.cmdPackage.copyBufferToTextureCmds.push(d)}this.cmdPackage.cmds.concat(r.cmdPackage.cmds.array),this._numDrawCalls+=r._numDrawCalls,this._numInstances+=r._numInstances,this._numTris+=r._numTris}},i.bindStates=function(){var t=this._webGLAllocator.bindStatesCmdPool.alloc(mW);if(t){t.gpuPipelineState=this._curGPUPipelineState,Array.prototype.push.apply(t.gpuDescriptorSets,this._curGPUDescriptorSets);for(var e=0;e<this._curDynamicOffsets.length;e++)Array.prototype.push.apply(t.dynamicOffsets,this._curDynamicOffsets[e]);t.gpuInputAssembler=this._curGPUInputAssembler,t.viewport=this._curViewport,t.scissor=this._curScissor,t.lineWidth=this._curLineWidth,t.depthBias=this._curDepthBias,Array.prototype.push.apply(t.blendConstants,this._curBlendConstants),t.depthBounds=this._curDepthBounds,t.stencilWriteMask=this._curStencilWriteMask,t.stencilCompareMask=this._curStencilCompareMask,this.cmdPackage.bindStatesCmds.push(t),this.cmdPackage.cmds.push(lW.BIND_STATES),this._isStateInvalied=!1}},r(e,[{key:"webGLDevice",get:function(){return this._device}}]),e}($l),PW=function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;return i.initialize=function(){return!0},i.destroy=function(){},i.wait=function(){},i.reset=function(){},e}(rc),NW=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuFramebuffer=null,e}s(e,t);var i=e.prototype;return i.initialize=function(t){this._renderPass=t.renderPass,this._colorTextures=t.colorTextures||[],this._depthStencilTexture=t.depthStencilTexture||null,0!==t.depStencilMipmapLevel&&console.warn("The mipmap level of th texture image to be attached of depth stencil attachment should be 0. Convert to 0.");for(var e=0;e<t.colorMipmapLevels.length;++e)0!==t.colorMipmapLevels[e]&&console.warn("The mipmap level of th texture image to be attached of color attachment "+e+" should be 0. Convert to 0.");for(var i=[],r=0;r<t.colorTextures.length;++r){var n=t.colorTextures[r];n&&i.push(n.gpuTexture)}var s=null;return t.depthStencilTexture&&(s=t.depthStencilTexture.gpuTexture),this._gpuFramebuffer={gpuRenderPass:t.renderPass.gpuRenderPass,gpuColorTextures:i,gpuDepthStencilTexture:s,glFramebuffer:null},function(t,e){if(e.gpuColorTextures.length||e.gpuDepthStencilTexture){var i=t.gl,r=[],n=i.createFramebuffer();if(n){e.glFramebuffer=n,t.stateCache.glFramebuffer!==e.glFramebuffer&&i.bindFramebuffer(i.FRAMEBUFFER,e.glFramebuffer);for(var s=0;s<e.gpuColorTextures.length;++s){var a=e.gpuColorTextures[s];a&&(a.glTexture?i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+s,a.glTarget,a.glTexture,0):i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+s,i.RENDERBUFFER,a.glRenderbuffer),r.push(i.COLOR_ATTACHMENT0+s))}var o=e.gpuDepthStencilTexture;if(o){var h=zl[o.format].hasStencil?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;o.glTexture?i.framebufferTexture2D(i.FRAMEBUFFER,h,o.glTarget,o.glTexture,0):i.framebufferRenderbuffer(i.FRAMEBUFFER,h,i.RENDERBUFFER,o.glRenderbuffer)}t.WEBGL_draw_buffers&&t.WEBGL_draw_buffers.drawBuffersWEBGL(r);var l=i.checkFramebufferStatus(i.FRAMEBUFFER);if(l!==i.FRAMEBUFFER_COMPLETE)switch(l){case i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case i.FRAMEBUFFER_UNSUPPORTED:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_UNSUPPORTED")}t.stateCache.glFramebuffer!==e.glFramebuffer&&i.bindFramebuffer(i.FRAMEBUFFER,t.stateCache.glFramebuffer)}}}(this._device,this._gpuFramebuffer),!0},i.destroy=function(){var t,e;this._gpuFramebuffer&&(t=this._device,(e=this._gpuFramebuffer).glFramebuffer&&(t.gl.deleteFramebuffer(e.glFramebuffer),e.glFramebuffer=null),this._gpuFramebuffer=null)},r(e,[{key:"gpuFramebuffer",get:function(){return this._gpuFramebuffer}}]),e}(nu),LW=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuInputAssembler=null,e}s(e,t);var i=e.prototype;return i.initialize=function(t){if(0===t.vertexBuffers.length)return console.error("InputAssemblerInfo.vertexBuffers is null."),!1;if(this._attributes=t.attributes,this._attributesHash=this.computeAttributesHash(),this._vertexBuffers=t.vertexBuffers,t.indexBuffer)this._indexBuffer=t.indexBuffer,this._indexCount=this._indexBuffer.size/this._indexBuffer.stride,this._firstIndex=0;else{var e=this._vertexBuffers[0];this._vertexCount=e.size/e.stride,this._firstVertex=0,this._vertexOffset=0}this._instanceCount=0,this._firstInstance=0,this._indirectBuffer=t.indirectBuffer||null;for(var i=new Array(t.vertexBuffers.length),r=0;r<t.vertexBuffers.length;++r){var n=t.vertexBuffers[r];n.gpuBuffer&&(i[r]=n.gpuBuffer)}var s=null,a=0;if(t.indexBuffer&&(s=t.indexBuffer.gpuBuffer))switch(s.stride){case 1:a=5121;break;case 2:a=5123;break;case 4:a=5125;break;default:console.error("Error index buffer stride.")}var o=null;return t.indirectBuffer&&(o=t.indirectBuffer.gpuBuffer),this._gpuInputAssembler={attributes:t.attributes,gpuVertexBuffers:i,gpuIndexBuffer:s,gpuIndirectBuffer:o,glAttribs:[],glIndexType:a,glVAOs:new Map},function(t,e){var i=t.gl;e.glAttribs=new Array(e.attributes.length);for(var r=[0,0,0,0,0,0,0,0],n=0;n<e.attributes.length;++n){var s=e.attributes[n],a=void 0!==s.stream?s.stream:0,o=e.gpuVertexBuffers[a],h=eW(s.format,i),l=zl[s.format].size;e.glAttribs[n]={name:s.name,glBuffer:o.glBuffer,glType:h,size:l,count:zl[s.format].count,stride:o.stride,componentCount:hW(h,i),isNormalized:void 0!==s.isNormalized&&s.isNormalized,isInstanced:void 0!==s.isInstanced&&s.isInstanced,offset:r[a]},r[a]+=l}}(this._device,this._gpuInputAssembler),!0},i.destroy=function(){var t=this._device;this._gpuInputAssembler&&t.useVAO&&function(t,e){for(var i=e.glVAOs.values(),r=i.next();!r.done;)t.OES_vertex_array_object.deleteVertexArrayOES(r.value),r=i.next();e.glVAOs.clear()}(t,this._gpuInputAssembler),this._gpuInputAssembler=null},r(e,[{key:"gpuInputAssembler",get:function(){return this._gpuInputAssembler}}]),e}(uu),FW=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuDescriptorSetLayout=null,e}s(e,t);var i=e.prototype;return i.initialize=function(t){Array.prototype.push.apply(this._bindings,t.bindings);for(var e=0,i=-1,r=[],n=0;n<this._bindings.length;n++){var s=this._bindings[n];r.push(e),e+=s.count,s.binding>i&&(i=s.binding)}this._bindingIndices=Array(i+1).fill(-1);for(var a=this._descriptorIndices=Array(i+1).fill(-1),o=0;o<this._bindings.length;o++){var h=this._bindings[o];this._bindingIndices[h.binding]=o,a[h.binding]=r[o]}for(var l=[],u=0;u<this._bindings.length;u++){var c=this._bindings[u];if(c.descriptorType&Ju)for(var _=0;_<c.count;_++)l.push(c.binding)}return this._gpuDescriptorSetLayout={bindings:this._bindings,dynamicBindings:l,descriptorIndices:a,descriptorCount:e},!0},i.destroy=function(){this._bindings.length=0},r(e,[{key:"gpuDescriptorSetLayout",get:function(){return this._gpuDescriptorSetLayout}}]),e}($u),DW=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuPipelineLayout=null,e}s(e,t);var i=e.prototype;return i.initialize=function(t){Array.prototype.push.apply(this._setLayouts,t.setLayouts);for(var e=[],i=[],r=0,n=0;n<this._setLayouts.length;n++){for(var s=this._setLayouts[n],a=s.gpuDescriptorSetLayout.dynamicBindings,o=Array(s.bindingIndices.length).fill(-1),h=0;h<a.length;h++){var l=a[h];o[l]<0&&(o[l]=r+h)}i.push(s.gpuDescriptorSetLayout),e.push(o),r+=a.length}return this._gpuPipelineLayout={gpuSetLayouts:i,dynamicOffsetIndices:e,dynamicOffsetCount:r},!0},i.destroy=function(){this._setLayouts.length=0},r(e,[{key:"gpuPipelineLayout",get:function(){return this._gpuPipelineLayout}}]),e}(ec),UW=[0,1,3,2,0,0,0,4,5,6,0,0,0,0],kW=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuPipelineState=null,e}s(e,t);var i=e.prototype;return i.initialize=function(t){this._primitive=t.primitive,this._shader=t.shader,this._pipelineLayout=t.pipelineLayout,this._rs=t.rasterizerState,this._dss=t.depthStencilState,this._bs=t.blendState,this._is=t.inputState,this._renderPass=t.renderPass,this._dynamicStates=t.dynamicStates;for(var e=[],i=0;i<31;i++)this._dynamicStates&1<<i&&e.push(1<<i);return this._gpuPipelineState={glPrimitive:UW[t.primitive],gpuShader:t.shader.gpuShader,gpuPipelineLayout:t.pipelineLayout.gpuPipelineLayout,rs:t.rasterizerState,dss:t.depthStencilState,bs:t.blendState,gpuRenderPass:t.renderPass.gpuRenderPass,dynamicStates:e},!0},i.destroy=function(){this._gpuPipelineState=null},r(e,[{key:"gpuPipelineState",get:function(){return this._gpuPipelineState}}]),e}(Cu),zW=[],GW=function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;return i.beginRenderPass=function(t,e,i,r,n,s){bW(this._device,t.gpuRenderPass,e.gpuFramebuffer,i,r,n,s),this._isInRenderPass=!0},i.draw=function(t){if(this._isInRenderPass){this._isStateInvalied&&this.bindStates(),CW(this._device,t),++this._numDrawCalls,this._numInstances+=t.instanceCount;var e=t.indexCount||t.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=e/3*Math.max(t.instanceCount,1);break;case 5:case 6:this._numTris+=(e-2)*Math.max(t.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},i.updateBuffer=function(t,e,i,r){if(this._isInRenderPass)console.error("Command 'updateBuffer' must be recorded outside a render pass.");else{var n,s=t.gpuBuffer;s&&(void 0===i&&(i=0),n=void 0!==r?r:t.usage&rl.INDIRECT?0:e.byteLength,EW(this._device,s,e,i,n))}},i.copyBuffersToTexture=function(t,e,i){if(this._isInRenderPass)console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.");else{var r=e.gpuTexture;r&&xW(this._device,t,r,i)}},i.execute=function(t,e){for(var i=0;i<e;++i){var r=t[i];RW(this._device,r.cmdPackage),this._numDrawCalls+=r._numDrawCalls,this._numInstances+=r._numInstances,this._numTris+=r._numTris}},i.bindStates=function(){zW.length=0;for(var t=0;t<this._curDynamicOffsets.length;t++)Array.prototype.push.apply(zW,this._curDynamicOffsets[t]);AW(this._device,this._curGPUPipelineState,this._curGPUInputAssembler,this._curGPUDescriptorSets,zW,this._curViewport,this._curScissor,this._curLineWidth,this._curDepthBias,this._curBlendConstants,this._curDepthBounds,this._curStencilWriteMask,this._curStencilCompareMask),this._isStateInvalied=!1},e}(BW),HW=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).numDrawCalls=0,e.numInstances=0,e.numTris=0,e}s(e,t);var i=e.prototype;return i.initialize=function(t){return this._type=t.type,!0},i.destroy=function(){},i.submit=function(t){if(!this._isAsync)for(var e=t.length,i=0;i<e;i++){var r=t[i];this.numDrawCalls+=r.numDrawCalls,this.numInstances+=r.numInstances,this.numTris+=r.numTris}},i.clear=function(){this.numDrawCalls=0,this.numInstances=0,this.numTris=0},e}(Ru),VW=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuRenderPass=null,e}s(e,t);var i=e.prototype;return i.initialize=function(t){return this._colorInfos=t.colorAttachments,this._depthStencilInfo=t.depthStencilAttachment,t.subPasses&&(this._subPasses=t.subPasses),this._gpuRenderPass={colorAttachments:this._colorInfos,depthStencilAttachment:this._depthStencilInfo},this._hash=this.computeHash(),!0},i.destroy=function(){this._gpuRenderPass=null},r(e,[{key:"gpuRenderPass",get:function(){return this._gpuRenderPass}}]),e}(Bu),WW=[10497,33648,33071,33071],jW=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuSampler=null,e}s(e,t);var i=e.prototype;return i.initialize=function(t){this._minFilter=t.minFilter,this._magFilter=t.magFilter,this._mipFilter=t.mipFilter,this._addressU=t.addressU,this._addressV=t.addressV,this._addressW=t.addressW,this._maxAnisotropy=t.maxAnisotropy,this._cmpFunc=t.cmpFunc,this._borderColor=t.borderColor,this._minLOD=t.minLOD,this._maxLOD=t.maxLOD,this._mipLODBias=t.mipLODBias;var e,i,r=this._minFilter,n=this._magFilter,s=this._mipFilter;e=r===ml.LINEAR||r===ml.ANISOTROPIC?s===ml.LINEAR||s===ml.ANISOTROPIC?9987:s===ml.POINT?9985:9729:s===ml.LINEAR||s===ml.ANISOTROPIC?9986:s===ml.POINT?9984:9728,i=n===ml.LINEAR||n===ml.ANISOTROPIC?9729:9728;var a=WW[this._addressU],o=WW[this._addressV],h=WW[this._addressW];return this._gpuSampler={glMinFilter:e,glMagFilter:i,glWrapS:a,glWrapT:o,glWrapR:h},!0},i.destroy=function(){this._gpuSampler=null},r(e,[{key:"gpuSampler",get:function(){return this._gpuSampler}}]),e}(Nu),XW=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuShader=null,e}s(e,t);var i=e.prototype;return i.initialize=function(t){this._name=t.name,this._stages=t.stages,this._attributes=t.attributes,this._blocks=t.blocks,this._samplers=t.samplers,this._gpuShader={name:t.name,blocks:t.blocks,samplers:t.samplers,gpuStages:new Array(t.stages.length),glProgram:null,glInputs:[],glUniforms:[],glBlocks:[],glSamplers:[]};for(var e=0;e<t.stages.length;++e){var i=t.stages[e];this._gpuShader.gpuStages[e]={type:i.stage,source:i.source,glShader:null}}return function(t,e){for(var i=t.gl,r=function(t){var r=e.gpuStages[t],n=0,s="",a=1;switch(r.type){case Sl.VERTEX:s="VertexShader",n=i.VERTEX_SHADER;break;case Sl.FRAGMENT:s="FragmentShader",n=i.FRAGMENT_SHADER;break;default:return console.error("Unsupported ShaderType."),{v:void 0}}var o=i.createShader(n);if(o&&(r.glShader=o,i.shaderSource(r.glShader,r.source),i.compileShader(r.glShader),!i.getShaderParameter(r.glShader,i.COMPILE_STATUS))){console.error(s+" in '"+e.name+"' compilation failed."),console.error("Shader source dump:",r.source.replace(/^|\n/g,(function(){return"\n"+a+++" "}))),console.error(i.getShaderInfoLog(r.glShader));for(var h=0;h<e.gpuStages.length;h++){var l=e.gpuStages[t];l.glShader&&(i.deleteShader(l.glShader),l.glShader=null)}return{v:void 0}}},n=0;n<e.gpuStages.length;n++){var s=r(n);if("object"==typeof s)return s.v}var a=i.createProgram();if(a){e.glProgram=a;for(var o=0;o<e.gpuStages.length;o++){var h=e.gpuStages[o];i.attachShader(e.glProgram,h.glShader)}if(i.linkProgram(e.glProgram),t.destroyShadersImmediately)for(var l=0;l<e.gpuStages.length;l++){var u=e.gpuStages[l];u.glShader&&(i.detachShader(e.glProgram,u.glShader),i.deleteShader(u.glShader),u.glShader=null)}if(!i.getProgramParameter(e.glProgram,i.LINK_STATUS))return console.error("Failed to link shader '"+e.name+"'."),void console.error(i.getProgramInfoLog(e.glProgram));console.info("Shader '"+e.name+"' compilation succeeded.");var c=i.getProgramParameter(e.glProgram,i.ACTIVE_ATTRIBUTES);e.glInputs=new Array(c);for(var _=0;_<c;++_){var d=i.getActiveAttrib(e.glProgram,_);if(d){var p,f=d.name.indexOf("[");p=-1!==f?d.name.substr(0,f):d.name;var m=i.getAttribLocation(e.glProgram,p),g=aW(d.type,i),v=oW(d.type,i);e.glInputs[_]={binding:m,name:p,type:g,stride:v,count:d.size,size:v*d.size,glType:d.type,glLoc:m}}}if(e.blocks.length>0){e.glBlocks=new Array(e.blocks.length);for(var y=0;y<e.blocks.length;++y){var T=e.blocks[y],E={set:T.set,binding:T.binding,name:T.name,size:0,glUniforms:new Array(T.members.length),glActiveUniforms:[]};e.glBlocks[y]=E;for(var S=0;S<T.members.length;++S){var b=T.members[S],A=nW(b.type,i),C=sW(b.type),w=oW(A,i),R=w*b.count,x=E.size/4,O=new C(R/4);E.glUniforms[S]={binding:-1,name:b.name,type:b.type,stride:w,count:b.count,size:R,offset:E.size,glType:A,glLoc:-1,array:O,begin:x},E.size+=R}}}if(e.samplers.length>0){e.glSamplers=new Array(e.samplers.length);for(var I=0;I<e.samplers.length;++I){var M=e.samplers[I];e.glSamplers[I]={set:M.set,binding:M.binding,name:M.name,type:M.type,count:M.count,units:[],glUnits:null,glType:nW(M.type,i),glLoc:null}}}for(var B=i.getProgramParameter(e.glProgram,i.ACTIVE_UNIFORMS),P=0;P<B;++P){var N=i.getActiveUniform(e.glProgram,P);if(N&&N.type!==i.SAMPLER_2D&&N.type!==i.SAMPLER_CUBE){var L=i.getUniformLocation(e.glProgram,N.name);if(null!==L&&("number"==typeof L||-1!==L.id)){var F,D=N.name.indexOf("[");F=-1!==D?N.name.substr(0,D):N.name;for(var U=0;U<e.glBlocks.length;U++)for(var k=e.glBlocks[U],z=0;z<k.glUniforms.length;z++){var G=k.glUniforms[z];if(G.name===F){G.glLoc=L,k.glActiveUniforms.push(G);break}}}}}for(var H=[],V=[],W=t.bindingMappingInfo,j=t.stateCache.texUnitCacheMap,X=0,Y=0;Y<e.blocks.length;++Y)e.blocks[Y].set===W.flexibleSet&&X++;for(var q=0,K=0;K<e.samplers.length;++K){var Z=e.samplers[K],Q=i.getUniformLocation(e.glProgram,Z.name);if(null===Q||"number"!=typeof Q&&-1===Q.id||(H.push(e.glSamplers[K]),V.push(Q)),void 0===j[Z.name]){var J=Z.binding+W.samplerOffsets[Z.set]+q;Z.set===W.flexibleSet&&(J-=X),j[Z.name]=J%t.maxTextureUnits,q+=Z.count-1}}if(H.length){for(var $=[],tt=0;tt<H.length;++tt){var et=H[tt],it=j[et.name];if(void 0!==it){et.glLoc=V[tt];for(var rt=0;rt<et.count;++rt){for(;$[it];)it=(it+1)%t.maxTextureUnits;et.units.push(it),$[it]=!0}}}for(var nt=0,st=0;st<H.length;++st){var at=H[st];if(!at.glLoc){at.glLoc=V[st];for(var ot=0;ot<at.count;++ot){for(;$[nt];)nt=(nt+1)%t.maxTextureUnits;void 0===j[at.name]&&(j[at.name]=nt),at.units.push(nt),$[nt]=!0}}}t.stateCache.glProgram!==e.glProgram&&i.useProgram(e.glProgram);for(var ht=0;ht<H.length;ht++){var lt=H[ht];lt.glUnits=new Int32Array(lt.units),i.uniform1iv(lt.glLoc,lt.glUnits)}t.stateCache.glProgram!==e.glProgram&&i.useProgram(t.stateCache.glProgram)}for(var ut=0;ut<e.glBlocks.length;)e.glBlocks[ut].glActiveUniforms.length?ut++:(e.glBlocks[ut]=e.glBlocks[e.glBlocks.length-1],e.glBlocks.length--);e.glSamplers=H}}(this._device,this._gpuShader),!0},i.destroy=function(){this._gpuShader&&(function(t,e){if(e.glProgram){var i=t.gl;if(!t.destroyShadersImmediately)for(var r=0;r<e.gpuStages.length;r++){var n=e.gpuStages[r];n.glShader&&(i.detachShader(e.glProgram,n.glShader),i.deleteShader(n.glShader),n.glShader=null)}i.deleteProgram(e.glProgram),e.glProgram=null}}(this._device,this._gpuShader),this._gpuShader=null)},r(e,[{key:"gpuShader",get:function(){return this._gpuShader}}]),e}(zu),YW=function(){function t(){this.glArrayBuffer=null,this.glElementArrayBuffer=null,this.glVAO=null,this.texUnit=0,this.glTexUnits=[],this.glRenderbuffer=null,this.glFramebuffer=null,this.viewport=new _u,this.scissorRect=new cu(0,0,0,0),this.rs=new yu,this.dss=new Tu,this.bs=new Su,this.glProgram=null,this.glEnabledAttribLocs=[],this.glCurrentAttribLocs=[],this.texUnitCacheMap={}}return t.prototype.initialize=function(t,e){for(var i=0;i<t;++i)this.glTexUnits.push({glTexture:null});this.glEnabledAttribLocs.length=e,this.glEnabledAttribLocs.fill(!1),this.glCurrentAttribLocs.length=e,this.glCurrentAttribLocs.fill(!1)},t}(),qW=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuTexture=null,e}s(e,t);var i=e.prototype;return i.initialize=function(t){return"texture"in t?(console.log("WebGL does not support texture view."),!1):(this._type=t.type,this._usage=t.usage,this._format=t.format,this._width=t.width,this._height=t.height,this._depth=t.depth,this._layerCount=t.layerCount,this._levelCount=t.levelCount,this._samples=t.samples,this._flags=t.flags,this._isPowerOf2=Vu(this._width)&&Vu(this._height),this._size=Hl(this._format,this.width,this.height,this.depth,this._levelCount)*this._layerCount,this._flags&El.BAKUP_BUFFER&&(this._buffer=new ArrayBuffer(this._size)),this._gpuTexture={type:this._type,format:this._format,usage:this._usage,width:this._width,height:this._height,depth:this._depth,size:this._size,arrayLayer:this._layerCount,mipLevel:this._levelCount,samples:this._samples,flags:this._flags,isPowerOf2:this._isPowerOf2,glTarget:0,glInternalFmt:0,glFormat:0,glType:0,glUsage:0,glTexture:null,glRenderbuffer:null,glWrapS:0,glWrapT:0,glMinFilter:0,glMagFilter:0},function(t,e){var i=t.gl;e.glInternalFmt=iW(e.format,i),e.glFormat=rW(e.format,i),e.glType=eW(e.format,i);var r=e.width,n=e.height;switch(e.type){case vl.TEX2D:e.glTarget=i.TEXTURE_2D;var s=Math.max(r,n);if(s>t.maxTextureSize&&B(9100,s,t.maxTextureSize),!t.WEBGL_depth_texture&&zl[e.format].hasDepth){var a=i.createRenderbuffer();a&&e.size>0&&(e.glRenderbuffer=a,t.stateCache.glRenderbuffer!==e.glRenderbuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glRenderbuffer),t.stateCache.glRenderbuffer=e.glRenderbuffer),e.glInternalFmt===i.DEPTH_COMPONENT&&(e.glInternalFmt=i.DEPTH_COMPONENT16),i.renderbufferStorage(i.RENDERBUFFER,e.glInternalFmt,r,n))}else if(e.samples===Tl.X1){var o=i.createTexture();if(o&&e.size>0){e.glTexture=o;var h=t.stateCache.glTexUnits[t.stateCache.texUnit];if(h.glTexture!==e.glTexture&&(i.bindTexture(i.TEXTURE_2D,e.glTexture),h.glTexture=e.glTexture),zl[e.format].isCompressed)if(e.glInternalFmt!==$V.COMPRESSED_RGB_ETC1_WEBGL)for(var l=0;l<e.mipLevel;++l){var u=Gl(e.format,r,n,1),c=new Uint8Array(u);i.compressedTexImage2D(i.TEXTURE_2D,l,e.glInternalFmt,r,n,0,c),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}else{var _=Gl(e.format,2,2,1),d=new Uint8Array(_);i.compressedTexImage2D(i.TEXTURE_2D,0,e.glInternalFmt,2,2,0,d)}else for(var p=0;p<e.mipLevel;++p)i.texImage2D(i.TEXTURE_2D,p,e.glInternalFmt,r,n,0,e.glFormat,e.glType,null),r=Math.max(1,r>>1),n=Math.max(1,n>>1);e.isPowerOf2?(e.glWrapS=i.REPEAT,e.glWrapT=i.REPEAT):(e.glWrapS=i.CLAMP_TO_EDGE,e.glWrapT=i.CLAMP_TO_EDGE),e.glMinFilter=i.LINEAR,e.glMagFilter=i.LINEAR,i.texParameteri(e.glTarget,i.TEXTURE_WRAP_S,e.glWrapS),i.texParameteri(e.glTarget,i.TEXTURE_WRAP_T,e.glWrapT),i.texParameteri(e.glTarget,i.TEXTURE_MIN_FILTER,e.glMinFilter),i.texParameteri(e.glTarget,i.TEXTURE_MAG_FILTER,e.glMagFilter)}else i.deleteTexture(o)}break;case vl.CUBE:e.glTarget=i.TEXTURE_CUBE_MAP;var f=Math.max(r,n);f>t.maxCubeMapTextureSize&&B(9100,f,t.maxTextureSize);var m=i.createTexture();if(m&&e.size>0){e.glTexture=m;var g=t.stateCache.glTexUnits[t.stateCache.texUnit];if(g.glTexture!==e.glTexture&&(i.bindTexture(i.TEXTURE_CUBE_MAP,e.glTexture),g.glTexture=e.glTexture),zl[e.format].isCompressed)if(e.glInternalFmt!==$V.COMPRESSED_RGB_ETC1_WEBGL)for(var v=0;v<6;++v){r=e.width,n=e.height;for(var y=0;y<e.mipLevel;++y){var T=Gl(e.format,r,n,1),E=new Uint8Array(T);i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+v,y,e.glInternalFmt,r,n,0,E),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}}else for(var S=0;S<6;++S){var b=Gl(e.format,2,2,1),A=new Uint8Array(b);i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+S,0,e.glInternalFmt,2,2,0,A)}else for(var C=0;C<6;++C){r=e.width,n=e.height;for(var w=0;w<e.mipLevel;++w)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+C,w,e.glInternalFmt,r,n,0,e.glFormat,e.glType,null),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}e.isPowerOf2?(e.glWrapS=i.REPEAT,e.glWrapT=i.REPEAT):(e.glWrapS=i.CLAMP_TO_EDGE,e.glWrapT=i.CLAMP_TO_EDGE),e.glMinFilter=i.LINEAR,e.glMagFilter=i.LINEAR,i.texParameteri(e.glTarget,i.TEXTURE_WRAP_S,e.glWrapS),i.texParameteri(e.glTarget,i.TEXTURE_WRAP_T,e.glWrapT),i.texParameteri(e.glTarget,i.TEXTURE_MIN_FILTER,e.glMinFilter),i.texParameteri(e.glTarget,i.TEXTURE_MAG_FILTER,e.glMagFilter)}break;default:console.error("Unsupported TextureType, create texture failed."),e.type=vl.TEX2D,e.glTarget=i.TEXTURE_2D}}(this._device,this._gpuTexture),this._device.memoryStatus.textureSize+=this._size,!0)},i.destroy=function(){var t,e;this._gpuTexture&&(t=this._device,(e=this._gpuTexture).glTexture&&(t.gl.deleteTexture(e.glTexture),e.glTexture=null),e.glRenderbuffer&&(t.gl.deleteRenderbuffer(e.glRenderbuffer),e.glRenderbuffer=null),this._device.memoryStatus.textureSize-=this._size,this._gpuTexture=null),this._buffer=null},i.resize=function(t,e){var i=this._size;this._width=t,this._height=e,this._size=Hl(this._format,this.width,this.height,this.depth,this._levelCount)*this._layerCount,this._gpuTexture&&(this._gpuTexture.width=t,this._gpuTexture.height=e,this._gpuTexture.size=this._size,function(t,e){var i=t.gl;e.glInternalFmt=iW(e.format,i),e.glFormat=rW(e.format,i),e.glType=eW(e.format,i);var r=e.width,n=e.height;switch(e.type){case vl.TEX2D:e.glTarget=i.TEXTURE_2D;var s=Math.max(r,n);if(s>t.maxTextureSize&&B(9100,s,t.maxTextureSize),e.glRenderbuffer)t.stateCache.glRenderbuffer!==e.glRenderbuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glRenderbuffer),t.stateCache.glRenderbuffer=e.glRenderbuffer),i.renderbufferStorage(i.RENDERBUFFER,e.glInternalFmt,r,n);else if(e.glTexture){var a=t.stateCache.glTexUnits[t.stateCache.texUnit];if(a.glTexture!==e.glTexture&&(i.bindTexture(i.TEXTURE_2D,e.glTexture),a.glTexture=e.glTexture),zl[e.format].isCompressed){if(e.glInternalFmt!==$V.COMPRESSED_RGB_ETC1_WEBGL)for(var o=0;o<e.mipLevel;++o){var h=Gl(e.format,r,n,1),l=new Uint8Array(h);i.compressedTexImage2D(i.TEXTURE_2D,o,e.glInternalFmt,r,n,0,l),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}}else for(var u=0;u<e.mipLevel;++u)i.texImage2D(i.TEXTURE_2D,u,e.glInternalFmt,r,n,0,e.glFormat,e.glType,null),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}break;case vl.CUBE:e.glTarget=i.TEXTURE_CUBE_MAP;var c=Math.max(r,n);c>t.maxCubeMapTextureSize&&B(9100,c,t.maxTextureSize);var _=t.stateCache.glTexUnits[t.stateCache.texUnit];if(_.glTexture!==e.glTexture&&(i.bindTexture(i.TEXTURE_CUBE_MAP,e.glTexture),_.glTexture=e.glTexture),zl[e.format].isCompressed){if(e.glInternalFmt!==$V.COMPRESSED_RGB_ETC1_WEBGL)for(var d=0;d<6;++d){r=e.width,n=e.height;for(var p=0;p<e.mipLevel;++p){var f=Gl(e.format,r,n,1),m=new Uint8Array(f);i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+d,p,e.glInternalFmt,r,n,0,m),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}}}else for(var g=0;g<6;++g){r=e.width,n=e.height;for(var v=0;v<e.mipLevel;++v)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+g,v,e.glInternalFmt,r,n,0,e.glFormat,e.glType,null),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}break;default:console.error("Unsupported TextureType, create texture failed."),e.type=vl.TEX2D,e.glTarget=i.TEXTURE_2D}}(this._device,this._gpuTexture),this._device.memoryStatus.textureSize-=i,this._device.memoryStatus.textureSize+=this._size)},r(e,[{key:"gpuTexture",get:function(){return this._gpuTexture}}]),e}(Wu),KW=t("WebGLDevice",function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).stateCache=new YW,e.cmdAllocator=new MW,e.nullTex2D=null,e.nullTexCube=null,e._webGLRC=null,e._isAntialias=!0,e._isPremultipliedAlpha=!0,e._useVAO=!1,e._destroyShadersImmediately=!0,e._noCompressedTexSubImage2D=!1,e._bindingMappingInfo=new tu,e._webGLContextLostHandler=null,e._extensions=null,e._EXT_texture_filter_anisotropic=null,e._EXT_blend_minmax=null,e._EXT_frag_depth=null,e._EXT_shader_texture_lod=null,e._EXT_sRGB=null,e._OES_vertex_array_object=null,e._EXT_color_buffer_half_float=null,e._WEBGL_color_buffer_float=null,e._WEBGL_compressed_texture_etc1=null,e._WEBGL_compressed_texture_etc=null,e._WEBGL_compressed_texture_pvrtc=null,e._WEBGL_compressed_texture_astc=null,e._WEBGL_compressed_texture_s3tc=null,e._WEBGL_compressed_texture_s3tc_srgb=null,e._WEBGL_debug_shaders=null,e._WEBGL_draw_buffers=null,e._WEBGL_lose_context=null,e._WEBGL_depth_texture=null,e._WEBGL_debug_renderer_info=null,e._OES_texture_half_float=null,e._OES_texture_half_float_linear=null,e._OES_texture_float=null,e._OES_texture_float_linear=null,e._OES_standard_derivatives=null,e._OES_element_index_uint=null,e._ANGLE_instanced_arrays=null,e}s(e,t);var i=e.prototype;return i.initialize=function(t){this._canvas=t.canvasElm,this._isAntialias=t.isAntialias,this._isPremultipliedAlpha=t.isPremultipliedAlpha,this._bindingMappingInfo=t.bindingMappingInfo,this._bindingMappingInfo.bufferOffsets.length||this._bindingMappingInfo.bufferOffsets.push(0),this._bindingMappingInfo.samplerOffsets.length||this._bindingMappingInfo.samplerOffsets.push(0);try{var e={alpha:Ut.ENABLE_TRANSPARENT_CANVAS,antialias:this._isAntialias,depth:!0,stencil:!0,premultipliedAlpha:this._isPremultipliedAlpha,preserveDrawingBuffer:!1,powerPreference:"default",failIfMajorPerformanceCaveat:!1};this._webGLRC=this._canvas.getContext("webgl",e)}catch(t){return console.error(t),!1}if(!this._webGLRC)return console.error("This device does not support WebGL."),!1;this._webGLContextLostHandler=this._onWebGLContextLost.bind(this),this._canvas.addEventListener("webglcontextlost",this._onWebGLContextLost),this._canvas2D=document.createElement("canvas"),console.info("WebGL device initialized."),this._gfxAPI=Nl.WEBGL,this._deviceName="WebGL";var i=this._webGLRC;this._WEBGL_debug_renderer_info=this.getExtension("WEBGL_debug_renderer_info"),this._WEBGL_debug_renderer_info?(this._renderer=i.getParameter(this._WEBGL_debug_renderer_info.UNMASKED_RENDERER_WEBGL),this._vendor=i.getParameter(this._WEBGL_debug_renderer_info.UNMASKED_VENDOR_WEBGL)):(this._renderer=i.getParameter(i.RENDERER),this._vendor=i.getParameter(i.VENDOR)),this._version=i.getParameter(i.VERSION),this._maxVertexAttributes=i.getParameter(i.MAX_VERTEX_ATTRIBS),this._maxVertexUniformVectors=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),this._maxFragmentUniformVectors=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),this._maxTextureUnits=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),this._maxVertexTextureUnits=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this._maxCubeMapTextureSize=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),this._depthBits=i.getParameter(i.DEPTH_BITS),this._stencilBits=i.getParameter(i.STENCIL_BITS),this.stateCache.initialize(this._maxTextureUnits,this._maxVertexAttributes),this._devicePixelRatio=t.devicePixelRatio||1,this._width=this._canvas.width,this._height=this._canvas.height,this._nativeWidth=Math.max(t.nativeWidth||this._width,0),this._nativeHeight=Math.max(t.nativeHeight||this._height,0),this._colorFmt=il.RGBA8,24===this._depthBits?8===this._stencilBits?this._depthStencilFmt=il.D24S8:this._depthStencilFmt=il.D24:8===this._stencilBits?this._depthStencilFmt=il.D16S8:this._depthStencilFmt=il.D16,this._extensions=i.getSupportedExtensions();var r="";if(this._extensions){for(var n,s=h(this._extensions);!(n=s()).done;)r+=n.value+" ";console.debug("EXTENSIONS: "+r)}this._EXT_texture_filter_anisotropic=this.getExtension("EXT_texture_filter_anisotropic"),this._EXT_blend_minmax=this.getExtension("EXT_blend_minmax"),this._EXT_frag_depth=this.getExtension("EXT_frag_depth"),this._EXT_shader_texture_lod=this.getExtension("EXT_shader_texture_lod"),this._EXT_sRGB=this.getExtension("EXT_sRGB"),this._OES_vertex_array_object=this.getExtension("OES_vertex_array_object"),this._EXT_color_buffer_half_float=this.getExtension("EXT_color_buffer_half_float"),this._WEBGL_color_buffer_float=this.getExtension("WEBGL_color_buffer_float"),this._WEBGL_compressed_texture_etc1=this.getExtension("WEBGL_compressed_texture_etc1"),this._WEBGL_compressed_texture_etc=this.getExtension("WEBGL_compressed_texture_etc"),this._WEBGL_compressed_texture_pvrtc=this.getExtension("WEBGL_compressed_texture_pvrtc"),this._WEBGL_compressed_texture_s3tc=this.getExtension("WEBGL_compressed_texture_s3tc"),this._WEBGL_compressed_texture_s3tc_srgb=this.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this._WEBGL_debug_shaders=this.getExtension("WEBGL_debug_shaders"),this._WEBGL_draw_buffers=this.getExtension("WEBGL_draw_buffers"),this._WEBGL_lose_context=this.getExtension("WEBGL_lose_context"),this._WEBGL_depth_texture=this.getExtension("WEBGL_depth_texture"),this._OES_texture_half_float=this.getExtension("OES_texture_half_float"),this._OES_texture_half_float_linear=this.getExtension("OES_texture_half_float_linear"),this._OES_texture_float=this.getExtension("OES_texture_float"),this._OES_texture_float_linear=this.getExtension("OES_texture_float_linear"),this._OES_standard_derivatives=this.getExtension("OES_standard_derivatives"),this._OES_element_index_uint=this.getExtension("OES_element_index_uint"),this._ANGLE_instanced_arrays=this.getExtension("ANGLE_instanced_arrays"),Jr.os===Jr.OS_IOS&&14===Jr.osMainVersion&&Jr.isBrowser||(this._WEBGL_compressed_texture_astc=this.getExtension("WEBGL_compressed_texture_astc")),Jr.browserType===Jr.BROWSER_TYPE_UC&&(this._ANGLE_instanced_arrays=null),Jr.os===Jr.OS_IOS&&Jr.osMainVersion<=10&&(this._destroyShadersImmediately=!1),this._features.fill(!1),this._EXT_blend_minmax&&(this._features[Fl.BLEND_MINMAX]=!0),this._WEBGL_color_buffer_float&&(this._features[Fl.COLOR_FLOAT]=!0),this._EXT_color_buffer_half_float&&(this._features[Fl.COLOR_HALF_FLOAT]=!0),this._OES_texture_float&&(this._features[Fl.TEXTURE_FLOAT]=!0),this._OES_texture_half_float&&(this._features[Fl.TEXTURE_HALF_FLOAT]=!0),this._OES_texture_float_linear&&(this._features[Fl.TEXTURE_FLOAT_LINEAR]=!0),this._OES_texture_half_float_linear&&(this._features[Fl.TEXTURE_HALF_FLOAT_LINEAR]=!0),this._features[Fl.FORMAT_RGB8]=!0,this._WEBGL_depth_texture&&(this._features[Fl.FORMAT_D16]=!0,this._features[Fl.FORMAT_D24]=!0,this._features[Fl.FORMAT_D24S8]=!0),this._OES_element_index_uint&&(this._features[Fl.ELEMENT_INDEX_UINT]=!0),this._ANGLE_instanced_arrays&&(this._features[Fl.INSTANCED_ARRAYS]=!0),this._WEBGL_draw_buffers&&(this._features[Fl.MULTIPLE_RENDER_TARGETS]=!0);var a="";this._WEBGL_compressed_texture_etc1&&(this._features[Fl.FORMAT_ETC1]=!0,a+="etc1 "),this._WEBGL_compressed_texture_etc&&(this._features[Fl.FORMAT_ETC2]=!0,a+="etc2 "),this._WEBGL_compressed_texture_s3tc&&(this._features[Fl.FORMAT_DXT]=!0,a+="dxt "),this._WEBGL_compressed_texture_pvrtc&&(this._features[Fl.FORMAT_PVRTC]=!0,a+="pvrtc "),this._WEBGL_compressed_texture_astc&&(this._features[Fl.FORMAT_ASTC]=!0,a+="astc "),this._OES_vertex_array_object&&(this._useVAO=!0),console.info("RENDERER: "+this._renderer),console.info("VENDOR: "+this._vendor),console.info("VERSION: "+this._version),console.info("DPR: "+this._devicePixelRatio),console.info("SCREEN_SIZE: "+this._width+" x "+this._height),console.info("NATIVE_SIZE: "+this._nativeWidth+" x "+this._nativeHeight),console.info("MAX_VERTEX_UNIFORM_VECTORS: "+this._maxVertexUniformVectors),console.info("DEPTH_BITS: "+this._depthBits),console.info("STENCIL_BITS: "+this._stencilBits),this._EXT_texture_filter_anisotropic&&console.info("MAX_TEXTURE_MAX_ANISOTROPY_EXT: "+this._EXT_texture_filter_anisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT),console.info("USE_VAO: "+this._useVAO),console.info("COMPRESSED_FORMAT: "+a),this.initStates(i),this._queue=this.createQueue(new wu(Ml.GRAPHICS)),this._cmdBuff=this.createCommandBuffer(new Jl(this._queue)),this.nullTex2D=this.createTexture(new Gu(vl.TEX2D,yl.SAMPLED,il.RGBA8,2,2,El.GEN_MIPMAP)),this.nullTexCube=this.createTexture(new Gu(vl.TEX2D,yl.SAMPLED,il.RGBA8,2,2,El.CUBEMAP|El.GEN_MIPMAP,6));var o=new vu;o.texExtent.width=2,o.texExtent.height=2;var l=new Uint8Array(this.nullTex2D.size);return l.fill(0),this.copyBuffersToTexture([l],this.nullTex2D,[o]),o.texSubres.layerCount=6,this.copyBuffersToTexture([l,l,l,l,l,l],this.nullTexCube,[o]),!0},i.destroy=function(){this._canvas&&this._webGLContextLostHandler&&(this._canvas.removeEventListener("webglcontextlost",this._webGLContextLostHandler),this._webGLContextLostHandler=null),this.nullTex2D&&(this.nullTex2D.destroy(),this.nullTex2D=null),this.nullTexCube&&(this.nullTexCube.destroy(),this.nullTexCube=null),this._queue&&(this._queue.destroy(),this._queue=null),this._cmdBuff&&(this._cmdBuff.destroy(),this._cmdBuff=null),this._extensions=null,this._webGLRC=null},i.resize=function(t,e){this._width===t&&this._height===e||(console.info("Resizing device: "+t+"x"+e),this._canvas.width=t,this._canvas.height=e,this._width=t,this._height=e)},i.acquire=function(){this.cmdAllocator.releaseCmds()},i.present=function(){var t=this._queue;this._numDrawCalls=t.numDrawCalls,this._numInstances=t.numInstances,this._numTris=t.numTris,t.clear()},i.createCommandBuffer=function(t){var e=new(t.type===Al.PRIMARY?GW:BW)(this);return e.initialize(t),e},i.createBuffer=function(t){var e=new OW(this);return e.initialize(t)?e:null},i.createTexture=function(t){var e=new qW(this);return e.initialize(t)?e:null},i.createSampler=function(t){var e=new jW(this);return e.initialize(t)?e:null},i.createDescriptorSet=function(t){var e=new tW(this);return e.initialize(t)?e:null},i.createShader=function(t){var e=new XW(this);return e.initialize(t)?e:null},i.createInputAssembler=function(t){var e=new LW(this);return e.initialize(t)?e:null},i.createRenderPass=function(t){var e=new VW(this);return e.initialize(t)?e:null},i.createFramebuffer=function(t){var e=new NW(this);return e.initialize(t)?e:null},i.createDescriptorSetLayout=function(t){var e=new FW(this);return e.initialize(t)?e:null},i.createPipelineLayout=function(t){var e=new DW(this);return e.initialize(t)?e:null},i.createPipelineState=function(t){var e=new kW(this);return e.initialize(t)?e:null},i.createFence=function(t){var e=new PW(this);return e.initialize(t)?e:null},i.createQueue=function(t){var e=new HW(this);return e.initialize(t)?e:null},i.copyBuffersToTexture=function(t,e,i){xW(this,t,e.gpuTexture,i)},i.copyTexImagesToTexture=function(t,e,i){!function(t,e,i,r){var n=t.gl,s=t.stateCache.glTexUnits[t.stateCache.texUnit];s.glTexture!==i.glTexture&&(n.bindTexture(i.glTarget,i.glTexture),s.glTexture=i.glTexture);var a=0,o=0;switch(i.glTarget){case n.TEXTURE_2D:for(var h=0;h<r.length;h++){var l=r[h];n.texSubImage2D(n.TEXTURE_2D,l.texSubres.mipLevel,l.texOffset.x,l.texOffset.y,i.glFormat,i.glType,e[a++])}break;case n.TEXTURE_CUBE_MAP:for(var u=0;u<r.length;u++){var c=r[u],_=c.texSubres.baseArrayLayer+c.texSubres.layerCount;for(o=c.texSubres.baseArrayLayer;o<_;++o)n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+o,c.texSubres.mipLevel,c.texOffset.x,c.texOffset.y,i.glFormat,i.glType,e[a++])}break;default:console.error("Unsupported GL texture type, copy buffer to texture failed.")}i.flags&El.GEN_MIPMAP&&i.isPowerOf2&&n.generateMipmap(i.glTarget)}(this,t,e.gpuTexture,i)},i.copyFramebufferToBuffer=function(t,e,i){var r=this._webGLRC,n=t.gpuFramebuffer,s=n.gpuColorTextures[0].format,a=rW(s,r),o=eW(s,r),l=jl(zl[s]),u=this.stateCache.glFramebuffer;this.stateCache.glFramebuffer!==n.glFramebuffer&&(r.bindFramebuffer(r.FRAMEBUFFER,n.glFramebuffer),this.stateCache.glFramebuffer=n.glFramebuffer);for(var c,_=new l(e),d=h(i);!(c=d()).done;){var p=c.value,f=p.texExtent.width,m=p.texExtent.height;r.readPixels(p.texOffset.x,p.texOffset.y,f,m,a,o,_)}this.stateCache.glFramebuffer!==u&&(r.bindFramebuffer(r.FRAMEBUFFER,u),this.stateCache.glFramebuffer=u)},i.blitFramebuffer=function(){},i.getExtension=function(t){for(var e=["","WEBKIT_","MOZ_"],i=0;i<e.length;++i){var r=this.gl.getExtension(e[i]+t);if(r)return r}return null},i.initStates=function(t){t.activeTexture(t.TEXTURE0),t.pixelStorei(t.PACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.bindFramebuffer(t.FRAMEBUFFER,null),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),t.frontFace(t.CCW),t.disable(t.POLYGON_OFFSET_FILL),t.polygonOffset(0,0),t.enable(t.DEPTH_TEST),t.depthMask(!0),t.depthFunc(t.LESS),t.depthRange(0,1),t.stencilFuncSeparate(t.FRONT,t.ALWAYS,1,65535),t.stencilOpSeparate(t.FRONT,t.KEEP,t.KEEP,t.KEEP),t.stencilMaskSeparate(t.FRONT,65535),t.stencilFuncSeparate(t.BACK,t.ALWAYS,1,65535),t.stencilOpSeparate(t.BACK,t.KEEP,t.KEEP,t.KEEP),t.stencilMaskSeparate(t.BACK,65535),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.disable(t.BLEND),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.colorMask(!0,!0,!0,!0),t.blendColor(0,0,0,0)},i._onWebGLContextLost=function(t){I(11e3),E(t)},r(e,[{key:"gl",get:function(){return this._webGLRC}},{key:"webGLQueue",get:function(){return this._queue}},{key:"isAntialias",get:function(){return this._isAntialias}},{key:"isPremultipliedAlpha",get:function(){return this._isPremultipliedAlpha}},{key:"useVAO",get:function(){return this._useVAO}},{key:"destroyShadersImmediately",get:function(){return this._destroyShadersImmediately}},{key:"noCompressedTexSubImage2D",get:function(){return this._noCompressedTexSubImage2D}},{key:"bindingMappingInfo",get:function(){return this._bindingMappingInfo}},{key:"EXT_texture_filter_anisotropic",get:function(){return this._EXT_texture_filter_anisotropic}},{key:"EXT_blend_minmax",get:function(){return this._EXT_blend_minmax}},{key:"EXT_frag_depth",get:function(){return this._EXT_frag_depth}},{key:"EXT_shader_texture_lod",get:function(){return this._EXT_shader_texture_lod}},{key:"EXT_sRGB",get:function(){return this._EXT_sRGB}},{key:"OES_vertex_array_object",get:function(){return this._OES_vertex_array_object}},{key:"WEBGL_color_buffer_float",get:function(){return this._WEBGL_color_buffer_float}},{key:"WEBGL_compressed_texture_etc1",get:function(){return this._WEBGL_compressed_texture_etc1}},{key:"WEBGL_compressed_texture_pvrtc",get:function(){return this._WEBGL_compressed_texture_pvrtc}},{key:"WEBGL_compressed_texture_astc",get:function(){return this._WEBGL_compressed_texture_astc}},{key:"WEBGL_compressed_texture_s3tc",get:function(){return this._WEBGL_compressed_texture_s3tc}},{key:"WEBGL_compressed_texture_s3tc_srgb",get:function(){return this._WEBGL_compressed_texture_s3tc_srgb}},{key:"WEBGL_debug_shaders",get:function(){return this._WEBGL_debug_shaders}},{key:"WEBGL_draw_buffers",get:function(){return this._WEBGL_draw_buffers}},{key:"WEBGL_lose_context",get:function(){return this._WEBGL_lose_context}},{key:"WEBGL_depth_texture",get:function(){return this._WEBGL_depth_texture}},{key:"WEBGL_debug_renderer_info",get:function(){return this._WEBGL_debug_renderer_info}},{key:"OES_texture_half_float",get:function(){return this._OES_texture_half_float}},{key:"OES_texture_half_float_linear",get:function(){return this._OES_texture_half_float_linear}},{key:"OES_texture_float",get:function(){return this._OES_texture_float}},{key:"OES_standard_derivatives",get:function(){return this._OES_standard_derivatives}},{key:"OES_element_index_uint",get:function(){return this._OES_element_index_uint}},{key:"ANGLE_instanced_arrays",get:function(){return this._ANGLE_instanced_arrays}}]),e}(iu));_.WebGLDevice=KW;var ZW=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuDescriptorSet=null,e}s(e,t);var i=e.prototype;return i.initialize=function(t){this._layout=t.layout;var e=t.layout.gpuDescriptorSetLayout,i=e.bindings,r=e.descriptorIndices,n=e.descriptorCount;this._buffers=Array(n).fill(null),this._textures=Array(n).fill(null),this._samplers=Array(n).fill(null);var s=[];this._gpuDescriptorSet={gpuDescriptors:s,descriptorIndices:r};for(var a=0;a<i.length;++a)for(var o=i[a],h=0;h<o.count;h++)s.push({type:o.descriptorType,gpuBuffer:null,gpuTexture:null,gpuSampler:null});return!0},i.destroy=function(){this._layout=null,this._gpuDescriptorSet=null},i.update=function(){if(this._isDirty&&this._gpuDescriptorSet){for(var t=this._gpuDescriptorSet.gpuDescriptors,e=0;e<t.length;++e)t[e].type&Xu?this._buffers[e]&&(t[e].gpuBuffer=this._buffers[e].gpuBuffer):t[e].type&Yu&&(this._textures[e]&&(t[e].gpuTexture=this._textures[e].gpuTexture),this._samplers[e]&&(t[e].gpuSampler=this._samplers[e].gpuSampler));this._isDirty=!1}},r(e,[{key:"gpuDescriptorSet",get:function(){return this._gpuDescriptorSet}}]),e}(Ku),QW=[10497,33648,33071,33071],JW=[1,2,4,8,16,32,64],$W=new Float32Array(4);function tj(t,e){switch(t){case il.R8:return e.UNSIGNED_BYTE;case il.R8SN:return e.BYTE;case il.R8UI:return e.UNSIGNED_BYTE;case il.R8I:return e.BYTE;case il.R16F:return e.HALF_FLOAT;case il.R16UI:return e.UNSIGNED_SHORT;case il.R16I:return e.SHORT;case il.R32F:return e.FLOAT;case il.R32UI:return e.UNSIGNED_INT;case il.R32I:return e.INT;case il.RG8:return e.UNSIGNED_BYTE;case il.RG8SN:return e.BYTE;case il.RG8UI:return e.UNSIGNED_BYTE;case il.RG8I:return e.BYTE;case il.RG16F:return e.HALF_FLOAT;case il.RG16UI:return e.UNSIGNED_SHORT;case il.RG16I:return e.SHORT;case il.RG32F:return e.FLOAT;case il.RG32UI:return e.UNSIGNED_INT;case il.RG32I:return e.INT;case il.RGB8:case il.SRGB8:return e.UNSIGNED_BYTE;case il.RGB8SN:return e.BYTE;case il.RGB8UI:return e.UNSIGNED_BYTE;case il.RGB8I:return e.BYTE;case il.RGB16F:return e.HALF_FLOAT;case il.RGB16UI:return e.UNSIGNED_SHORT;case il.RGB16I:return e.SHORT;case il.RGB32F:return e.FLOAT;case il.RGB32UI:return e.UNSIGNED_INT;case il.RGB32I:return e.INT;case il.BGRA8:case il.RGBA8:case il.SRGB8_A8:return e.UNSIGNED_BYTE;case il.RGBA8SN:return e.BYTE;case il.RGBA8UI:return e.UNSIGNED_BYTE;case il.RGBA8I:return e.BYTE;case il.RGBA16F:return e.HALF_FLOAT;case il.RGBA16UI:return e.UNSIGNED_SHORT;case il.RGBA16I:return e.SHORT;case il.RGBA32F:return e.FLOAT;case il.RGBA32UI:return e.UNSIGNED_INT;case il.RGBA32I:return e.INT;case il.R5G6B5:return e.UNSIGNED_SHORT_5_6_5;case il.R11G11B10F:return e.UNSIGNED_INT_10F_11F_11F_REV;case il.RGB5A1:return e.UNSIGNED_SHORT_5_5_5_1;case il.RGBA4:return e.UNSIGNED_SHORT_4_4_4_4;case il.RGB10A2:case il.RGB10A2UI:return e.UNSIGNED_INT_2_10_10_10_REV;case il.RGB9E5:return e.FLOAT;case il.D16:return e.UNSIGNED_SHORT;case il.D16S8:return e.UNSIGNED_INT_24_8;case il.D24:return e.UNSIGNED_INT;case il.D24S8:return e.UNSIGNED_INT_24_8;case il.D32F:return e.FLOAT;case il.D32F_S8:return e.FLOAT_32_UNSIGNED_INT_24_8_REV;case il.BC1:case il.BC1_SRGB:case il.BC2:case il.BC2_SRGB:case il.BC3:case il.BC3_SRGB:case il.BC4:return e.UNSIGNED_BYTE;case il.BC4_SNORM:return e.BYTE;case il.BC5:return e.UNSIGNED_BYTE;case il.BC5_SNORM:return e.BYTE;case il.BC6H_SF16:case il.BC6H_UF16:return e.FLOAT;case il.BC7:case il.BC7_SRGB:case il.ETC_RGB8:case il.ETC2_RGB8:case il.ETC2_SRGB8:case il.ETC2_RGB8_A1:case il.ETC2_SRGB8_A1:case il.EAC_R11:return e.UNSIGNED_BYTE;case il.EAC_R11SN:return e.BYTE;case il.EAC_RG11:return e.UNSIGNED_BYTE;case il.EAC_RG11SN:return e.BYTE;case il.PVRTC_RGB2:case il.PVRTC_RGBA2:case il.PVRTC_RGB4:case il.PVRTC_RGBA4:case il.PVRTC2_2BPP:case il.PVRTC2_4BPP:return e.UNSIGNED_BYTE;case il.ASTC_RGBA_4x4:case il.ASTC_RGBA_5x4:case il.ASTC_RGBA_5x5:case il.ASTC_RGBA_6x5:case il.ASTC_RGBA_6x6:case il.ASTC_RGBA_8x5:case il.ASTC_RGBA_8x6:case il.ASTC_RGBA_8x8:case il.ASTC_RGBA_10x5:case il.ASTC_RGBA_10x6:case il.ASTC_RGBA_10x8:case il.ASTC_RGBA_10x10:case il.ASTC_RGBA_12x10:case il.ASTC_RGBA_12x12:case il.ASTC_SRGBA_4x4:case il.ASTC_SRGBA_5x4:case il.ASTC_SRGBA_5x5:case il.ASTC_SRGBA_6x5:case il.ASTC_SRGBA_6x6:case il.ASTC_SRGBA_8x5:case il.ASTC_SRGBA_8x6:case il.ASTC_SRGBA_8x8:case il.ASTC_SRGBA_10x5:case il.ASTC_SRGBA_10x6:case il.ASTC_SRGBA_10x8:case il.ASTC_SRGBA_10x10:case il.ASTC_SRGBA_12x10:case il.ASTC_SRGBA_12x12:default:return e.UNSIGNED_BYTE}}function ej(t,e){switch(t){case il.A8:return e.ALPHA;case il.L8:return e.LUMINANCE;case il.LA8:return e.LUMINANCE_ALPHA;case il.R8:return e.R8;case il.R8SN:return e.R8_SNORM;case il.R8UI:return e.R8UI;case il.R8I:return e.R8I;case il.RG8:return e.RG8;case il.RG8SN:return e.RG8_SNORM;case il.RG8UI:return e.RG8UI;case il.RG8I:return e.RG8I;case il.RGB8:return e.RGB8;case il.RGB8SN:return e.RGB8_SNORM;case il.RGB8UI:return e.RGB8UI;case il.RGB8I:return e.RGB8I;case il.BGRA8:case il.RGBA8:return e.RGBA8;case il.RGBA8SN:return e.RGBA8_SNORM;case il.RGBA8UI:return e.RGBA8UI;case il.RGBA8I:return e.RGBA8I;case il.R16I:return e.R16I;case il.R16UI:return e.R16UI;case il.R16F:return e.R16F;case il.RG16I:return e.RG16I;case il.RG16UI:return e.RG16UI;case il.RG16F:return e.RG16F;case il.RGB16I:return e.RGB16I;case il.RGB16UI:return e.RGB16UI;case il.RGB16F:return e.RGB16F;case il.RGBA16I:return e.RGBA16I;case il.RGBA16UI:return e.RGBA16UI;case il.RGBA16F:return e.RGBA16F;case il.R32I:return e.R32I;case il.R32UI:return e.R32UI;case il.R32F:return e.R32F;case il.RG32I:return e.RG32I;case il.RG32UI:return e.RG32UI;case il.RG32F:return e.RG32F;case il.RGB32I:return e.RGB32I;case il.RGB32UI:return e.RGB32UI;case il.RGB32F:return e.RGB32F;case il.RGBA32I:return e.RGBA32I;case il.RGBA32UI:return e.RGBA32UI;case il.RGBA32F:return e.RGBA32F;case il.R5G6B5:return e.RGB565;case il.RGB5A1:return e.RGB5_A1;case il.RGBA4:return e.RGBA4;case il.RGB10A2:return e.RGB10_A2;case il.RGB10A2UI:return e.RGB10_A2UI;case il.R11G11B10F:return e.R11F_G11F_B10F;case il.D16:return e.DEPTH_COMPONENT16;case il.D16S8:return e.DEPTH24_STENCIL8;case il.D24:return e.DEPTH_COMPONENT24;case il.D24S8:return e.DEPTH24_STENCIL8;case il.D32F:return e.DEPTH_COMPONENT32F;case il.D32F_S8:return e.DEPTH32F_STENCIL8;case il.BC1:return $V.COMPRESSED_RGB_S3TC_DXT1_EXT;case il.BC1_ALPHA:return $V.COMPRESSED_RGBA_S3TC_DXT1_EXT;case il.BC1_SRGB:return $V.COMPRESSED_SRGB_S3TC_DXT1_EXT;case il.BC1_SRGB_ALPHA:return $V.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case il.BC2:return $V.COMPRESSED_RGBA_S3TC_DXT3_EXT;case il.BC2_SRGB:return $V.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case il.BC3:return $V.COMPRESSED_RGBA_S3TC_DXT5_EXT;case il.BC3_SRGB:return $V.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case il.ETC_RGB8:return $V.COMPRESSED_RGB_ETC1_WEBGL;case il.ETC2_RGB8:return $V.COMPRESSED_RGB8_ETC2;case il.ETC2_SRGB8:return $V.COMPRESSED_SRGB8_ETC2;case il.ETC2_RGB8_A1:return $V.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case il.ETC2_SRGB8_A1:return $V.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;case il.ETC2_RGBA8:return $V.COMPRESSED_RGBA8_ETC2_EAC;case il.ETC2_SRGB8_A8:return $V.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;case il.EAC_R11:return $V.COMPRESSED_R11_EAC;case il.EAC_R11SN:return $V.COMPRESSED_SIGNED_R11_EAC;case il.EAC_RG11:return $V.COMPRESSED_RG11_EAC;case il.EAC_RG11SN:return $V.COMPRESSED_SIGNED_RG11_EAC;case il.PVRTC_RGB2:return $V.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case il.PVRTC_RGBA2:return $V.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;case il.PVRTC_RGB4:return $V.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case il.PVRTC_RGBA4:return $V.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case il.ASTC_RGBA_4x4:return $V.COMPRESSED_RGBA_ASTC_4x4_KHR;case il.ASTC_RGBA_5x4:return $V.COMPRESSED_RGBA_ASTC_5x4_KHR;case il.ASTC_RGBA_5x5:return $V.COMPRESSED_RGBA_ASTC_5x5_KHR;case il.ASTC_RGBA_6x5:return $V.COMPRESSED_RGBA_ASTC_6x5_KHR;case il.ASTC_RGBA_6x6:return $V.COMPRESSED_RGBA_ASTC_6x6_KHR;case il.ASTC_RGBA_8x5:return $V.COMPRESSED_RGBA_ASTC_8x5_KHR;case il.ASTC_RGBA_8x6:return $V.COMPRESSED_RGBA_ASTC_8x6_KHR;case il.ASTC_RGBA_8x8:return $V.COMPRESSED_RGBA_ASTC_8x8_KHR;case il.ASTC_RGBA_10x5:return $V.COMPRESSED_RGBA_ASTC_10x5_KHR;case il.ASTC_RGBA_10x6:return $V.COMPRESSED_RGBA_ASTC_10x6_KHR;case il.ASTC_RGBA_10x8:return $V.COMPRESSED_RGBA_ASTC_10x8_KHR;case il.ASTC_RGBA_10x10:return $V.COMPRESSED_RGBA_ASTC_10x10_KHR;case il.ASTC_RGBA_12x10:return $V.COMPRESSED_RGBA_ASTC_12x10_KHR;case il.ASTC_RGBA_12x12:return $V.COMPRESSED_RGBA_ASTC_12x12_KHR;case il.ASTC_SRGBA_4x4:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;case il.ASTC_SRGBA_5x4:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;case il.ASTC_SRGBA_5x5:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;case il.ASTC_SRGBA_6x5:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;case il.ASTC_SRGBA_6x6:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;case il.ASTC_SRGBA_8x5:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;case il.ASTC_SRGBA_8x6:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;case il.ASTC_SRGBA_8x8:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;case il.ASTC_SRGBA_10x5:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;case il.ASTC_SRGBA_10x6:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;case il.ASTC_SRGBA_10x8:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;case il.ASTC_SRGBA_10x10:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;case il.ASTC_SRGBA_12x10:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;case il.ASTC_SRGBA_12x12:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;default:return console.error("Unsupported Format, convert to WebGL internal format failed."),e.RGBA}}function ij(t,e){switch(t){case il.A8:return e.ALPHA;case il.L8:return e.LUMINANCE;case il.LA8:return e.LUMINANCE_ALPHA;case il.R8:case il.R8SN:return e.RED;case il.R8UI:case il.R8I:return e.RED;case il.RG8:case il.RG8SN:case il.RG8UI:case il.RG8I:return e.RG;case il.RGB8:case il.RGB8SN:case il.RGB8UI:case il.RGB8I:return e.RGB;case il.BGRA8:case il.RGBA8:case il.RGBA8SN:case il.RGBA8UI:case il.RGBA8I:return e.RGBA;case il.R16UI:case il.R16I:case il.R16F:return e.RED;case il.RG16UI:case il.RG16I:case il.RG16F:return e.RG;case il.RGB16UI:case il.RGB16I:case il.RGB16F:return e.RGB;case il.RGBA16UI:case il.RGBA16I:case il.RGBA16F:return e.RGBA;case il.R32UI:case il.R32I:case il.R32F:return e.RED;case il.RG32UI:case il.RG32I:case il.RG32F:return e.RG;case il.RGB32UI:case il.RGB32I:case il.RGB32F:return e.RGB;case il.RGBA32UI:case il.RGBA32I:case il.RGBA32F:case il.RGB10A2:return e.RGBA;case il.R11G11B10F:case il.R5G6B5:return e.RGB;case il.RGB5A1:case il.RGBA4:return e.RGBA;case il.D16:return e.DEPTH_COMPONENT;case il.D16S8:return e.DEPTH_STENCIL;case il.D24:return e.DEPTH_COMPONENT;case il.D24S8:return e.DEPTH_STENCIL;case il.D32F:return e.DEPTH_COMPONENT;case il.D32F_S8:return e.DEPTH_STENCIL;case il.BC1:return $V.COMPRESSED_RGB_S3TC_DXT1_EXT;case il.BC1_ALPHA:return $V.COMPRESSED_RGBA_S3TC_DXT1_EXT;case il.BC1_SRGB:return $V.COMPRESSED_SRGB_S3TC_DXT1_EXT;case il.BC1_SRGB_ALPHA:return $V.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case il.BC2:return $V.COMPRESSED_RGBA_S3TC_DXT3_EXT;case il.BC2_SRGB:return $V.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case il.BC3:return $V.COMPRESSED_RGBA_S3TC_DXT5_EXT;case il.BC3_SRGB:return $V.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case il.ETC_RGB8:return $V.COMPRESSED_RGB_ETC1_WEBGL;case il.ETC2_RGB8:return $V.COMPRESSED_RGB8_ETC2;case il.ETC2_SRGB8:return $V.COMPRESSED_SRGB8_ETC2;case il.ETC2_RGB8_A1:return $V.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case il.ETC2_SRGB8_A1:return $V.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;case il.ETC2_RGBA8:return $V.COMPRESSED_RGBA8_ETC2_EAC;case il.ETC2_SRGB8_A8:return $V.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;case il.EAC_R11:return $V.COMPRESSED_R11_EAC;case il.EAC_R11SN:return $V.COMPRESSED_SIGNED_R11_EAC;case il.EAC_RG11:return $V.COMPRESSED_RG11_EAC;case il.EAC_RG11SN:return $V.COMPRESSED_SIGNED_RG11_EAC;case il.PVRTC_RGB2:return $V.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case il.PVRTC_RGBA2:return $V.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;case il.PVRTC_RGB4:return $V.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case il.PVRTC_RGBA4:return $V.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case il.ASTC_RGBA_4x4:return $V.COMPRESSED_RGBA_ASTC_4x4_KHR;case il.ASTC_RGBA_5x4:return $V.COMPRESSED_RGBA_ASTC_5x4_KHR;case il.ASTC_RGBA_5x5:return $V.COMPRESSED_RGBA_ASTC_5x5_KHR;case il.ASTC_RGBA_6x5:return $V.COMPRESSED_RGBA_ASTC_6x5_KHR;case il.ASTC_RGBA_6x6:return $V.COMPRESSED_RGBA_ASTC_6x6_KHR;case il.ASTC_RGBA_8x5:return $V.COMPRESSED_RGBA_ASTC_8x5_KHR;case il.ASTC_RGBA_8x6:return $V.COMPRESSED_RGBA_ASTC_8x6_KHR;case il.ASTC_RGBA_8x8:return $V.COMPRESSED_RGBA_ASTC_8x8_KHR;case il.ASTC_RGBA_10x5:return $V.COMPRESSED_RGBA_ASTC_10x5_KHR;case il.ASTC_RGBA_10x6:return $V.COMPRESSED_RGBA_ASTC_10x6_KHR;case il.ASTC_RGBA_10x8:return $V.COMPRESSED_RGBA_ASTC_10x8_KHR;case il.ASTC_RGBA_10x10:return $V.COMPRESSED_RGBA_ASTC_10x10_KHR;case il.ASTC_RGBA_12x10:return $V.COMPRESSED_RGBA_ASTC_12x10_KHR;case il.ASTC_RGBA_12x12:return $V.COMPRESSED_RGBA_ASTC_12x12_KHR;case il.ASTC_SRGBA_4x4:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;case il.ASTC_SRGBA_5x4:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;case il.ASTC_SRGBA_5x5:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;case il.ASTC_SRGBA_6x5:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;case il.ASTC_SRGBA_6x6:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;case il.ASTC_SRGBA_8x5:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;case il.ASTC_SRGBA_8x6:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;case il.ASTC_SRGBA_8x8:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;case il.ASTC_SRGBA_10x5:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;case il.ASTC_SRGBA_10x6:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;case il.ASTC_SRGBA_10x8:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;case il.ASTC_SRGBA_10x10:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;case il.ASTC_SRGBA_12x10:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;case il.ASTC_SRGBA_12x12:return $V.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;default:return console.error("Unsupported Format, convert to WebGL format failed."),e.RGBA}}function rj(t,e){switch(t){case el.BOOL:return e.BOOL;case el.BOOL2:return e.BOOL_VEC2;case el.BOOL3:return e.BOOL_VEC3;case el.BOOL4:return e.BOOL_VEC4;case el.INT:return e.INT;case el.INT2:return e.INT_VEC2;case el.INT3:return e.INT_VEC3;case el.INT4:return e.INT_VEC4;case el.UINT:return e.UNSIGNED_INT;case el.FLOAT:return e.FLOAT;case el.FLOAT2:return e.FLOAT_VEC2;case el.FLOAT3:return e.FLOAT_VEC3;case el.FLOAT4:return e.FLOAT_VEC4;case el.MAT2:return e.FLOAT_MAT2;case el.MAT2X3:return e.FLOAT_MAT2x3;case el.MAT2X4:return e.FLOAT_MAT2x4;case el.MAT3X2:return e.FLOAT_MAT3x2;case el.MAT3:return e.FLOAT_MAT3;case el.MAT3X4:return e.FLOAT_MAT3x4;case el.MAT4X2:return e.FLOAT_MAT4x2;case el.MAT4X3:return e.FLOAT_MAT4x3;case el.MAT4:return e.FLOAT_MAT4;case el.SAMPLER2D:return e.SAMPLER_2D;case el.SAMPLER2D_ARRAY:return e.SAMPLER_2D_ARRAY;case el.SAMPLER3D:return e.SAMPLER_3D;case el.SAMPLER_CUBE:return e.SAMPLER_CUBE;default:return console.error("Unsupported GLType, convert to GL type failed."),el.UNKNOWN}}function nj(t,e){switch(t){case e.BOOL:return el.BOOL;case e.BOOL_VEC2:return el.BOOL2;case e.BOOL_VEC3:return el.BOOL3;case e.BOOL_VEC4:return el.BOOL4;case e.INT:return el.INT;case e.INT_VEC2:return el.INT2;case e.INT_VEC3:return el.INT3;case e.INT_VEC4:return el.INT4;case e.UNSIGNED_INT:return el.UINT;case e.UNSIGNED_INT_VEC2:return el.UINT2;case e.UNSIGNED_INT_VEC3:return el.UINT3;case e.UNSIGNED_INT_VEC4:return el.UINT4;case e.FLOAT:return el.FLOAT;case e.FLOAT_VEC2:return el.FLOAT2;case e.FLOAT_VEC3:return el.FLOAT3;case e.FLOAT_VEC4:return el.FLOAT4;case e.FLOAT_MAT2:return el.MAT2;case e.FLOAT_MAT2x3:return el.MAT2X3;case e.FLOAT_MAT2x4:return el.MAT2X4;case e.FLOAT_MAT3x2:return el.MAT3X2;case e.FLOAT_MAT3:return el.MAT3;case e.FLOAT_MAT3x4:return el.MAT3X4;case e.FLOAT_MAT4x2:return el.MAT4X2;case e.FLOAT_MAT4x3:return el.MAT4X3;case e.FLOAT_MAT4:return el.MAT4;case e.SAMPLER_2D:return el.SAMPLER2D;case e.SAMPLER_2D_ARRAY:return el.SAMPLER2D_ARRAY;case e.SAMPLER_3D:return el.SAMPLER3D;case e.SAMPLER_CUBE:return el.SAMPLER_CUBE;default:return console.error("Unsupported GLType, convert to Type failed."),el.UNKNOWN}}function sj(t,e){switch(t){case e.BOOL:return 4;case e.BOOL_VEC2:return 8;case e.BOOL_VEC3:return 12;case e.BOOL_VEC4:return 16;case e.INT:return 4;case e.INT_VEC2:return 8;case e.INT_VEC3:return 12;case e.INT_VEC4:return 16;case e.UNSIGNED_INT:return 4;case e.UNSIGNED_INT_VEC2:return 8;case e.UNSIGNED_INT_VEC3:return 12;case e.UNSIGNED_INT_VEC4:return 16;case e.FLOAT:return 4;case e.FLOAT_VEC2:return 8;case e.FLOAT_VEC3:return 12;case e.FLOAT_VEC4:case e.FLOAT_MAT2:return 16;case e.FLOAT_MAT2x3:return 24;case e.FLOAT_MAT2x4:return 32;case e.FLOAT_MAT3x2:return 24;case e.FLOAT_MAT3:return 36;case e.FLOAT_MAT3x4:return 48;case e.FLOAT_MAT4x2:return 32;case e.FLOAT_MAT4x3:return 48;case e.FLOAT_MAT4:return 64;case e.SAMPLER_2D:case e.SAMPLER_2D_ARRAY:case e.SAMPLER_2D_ARRAY_SHADOW:case e.SAMPLER_3D:case e.SAMPLER_CUBE:case e.INT_SAMPLER_2D:case e.INT_SAMPLER_2D_ARRAY:case e.INT_SAMPLER_3D:case e.INT_SAMPLER_CUBE:case e.UNSIGNED_INT_SAMPLER_2D:case e.UNSIGNED_INT_SAMPLER_2D_ARRAY:case e.UNSIGNED_INT_SAMPLER_3D:case e.UNSIGNED_INT_SAMPLER_CUBE:return 4;default:return console.error("Unsupported GLType, get type failed."),0}}function aj(t,e){switch(t){case e.FLOAT_MAT2:case e.FLOAT_MAT2x3:case e.FLOAT_MAT2x4:return 2;case e.FLOAT_MAT3x2:case e.FLOAT_MAT3:case e.FLOAT_MAT3x4:return 3;case e.FLOAT_MAT4x2:case e.FLOAT_MAT4x3:case e.FLOAT_MAT4:return 4;default:return 1}}var oj,hj=[512,513,514,515,516,517,518,519],lj=[0,7680,7681,7682,7683,5386,34055,34056],uj=[32774,32778,32779,32775,32776],cj=[0,1,770,772,771,773,768,774,769,775,776,32769,32770,32771,32772];!function(t){t[t.BEGIN_RENDER_PASS=0]="BEGIN_RENDER_PASS",t[t.END_RENDER_PASS=1]="END_RENDER_PASS",t[t.BIND_STATES=2]="BIND_STATES",t[t.DRAW=3]="DRAW",t[t.UPDATE_BUFFER=4]="UPDATE_BUFFER",t[t.COPY_BUFFER_TO_TEXTURE=5]="COPY_BUFFER_TO_TEXTURE",t[t.COUNT=6]="COUNT"}(oj||(oj={}));var _j=function(t){this.cmdType=void 0,this.refCount=0,this.cmdType=t},dj=function(t){function e(){var e;return(e=t.call(this,oj.BEGIN_RENDER_PASS)||this).gpuRenderPass=null,e.gpuFramebuffer=null,e.renderArea=new cu,e.clearColors=[],e.clearDepth=1,e.clearStencil=0,e}return s(e,t),e.prototype.clear=function(){this.gpuFramebuffer=null,this.clearColors.length=0},e}(_j),pj=function(t){function e(){var e;return(e=t.call(this,oj.BIND_STATES)||this).gpuPipelineState=null,e.gpuInputAssembler=null,e.gpuDescriptorSets=[],e.dynamicOffsets=[],e.viewport=null,e.scissor=null,e.lineWidth=null,e.depthBias=null,e.blendConstants=[],e.depthBounds=null,e.stencilWriteMask=null,e.stencilCompareMask=null,e}return s(e,t),e.prototype.clear=function(){this.gpuPipelineState=null,this.gpuInputAssembler=null,this.gpuDescriptorSets.length=0,this.dynamicOffsets.length=0,this.viewport=null,this.scissor=null,this.lineWidth=null,this.depthBias=null,this.blendConstants.length=0,this.depthBounds=null,this.stencilWriteMask=null,this.stencilCompareMask=null},e}(_j),fj=function(t){function e(){var e;return(e=t.call(this,oj.DRAW)||this).drawInfo=new Xl,e}return s(e,t),e.prototype.clear=function(){},e}(_j),mj=function(t){function e(){var e;return(e=t.call(this,oj.UPDATE_BUFFER)||this).gpuBuffer=null,e.buffer=null,e.offset=0,e.size=0,e}return s(e,t),e.prototype.clear=function(){this.gpuBuffer=null,this.buffer=null},e}(_j),gj=function(t){function e(){var e;return(e=t.call(this,oj.COPY_BUFFER_TO_TEXTURE)||this).gpuTexture=null,e.buffers=[],e.regions=[],e}return s(e,t),e.prototype.clear=function(){this.gpuTexture=null,this.buffers.length=0,this.regions.length=0},e}(_j),vj=function(){function t(){this.cmds=new Wi(1),this.beginRenderPassCmds=new Wi(1),this.bindStatesCmds=new Wi(1),this.drawCmds=new Wi(1),this.updateBufferCmds=new Wi(1),this.copyBufferToTextureCmds=new Wi(1)}return t.prototype.clearCmds=function(t){this.beginRenderPassCmds.length&&(t.beginRenderPassCmdPool.freeCmds(this.beginRenderPassCmds),this.beginRenderPassCmds.clear()),this.bindStatesCmds.length&&(t.bindStatesCmdPool.freeCmds(this.bindStatesCmds),this.bindStatesCmds.clear()),this.drawCmds.length&&(t.drawCmdPool.freeCmds(this.drawCmds),this.drawCmds.clear()),this.updateBufferCmds.length&&(t.updateBufferCmdPool.freeCmds(this.updateBufferCmds),this.updateBufferCmds.clear()),this.copyBufferToTextureCmds.length&&(t.copyBufferToTextureCmdPool.freeCmds(this.copyBufferToTextureCmds),this.copyBufferToTextureCmds.clear()),this.cmds.clear()},t}();function yj(t,e,i,r,n){if(e.usage&rl.INDIRECT)e.indirects.length=r,Array.prototype.push.apply(e.indirects,i.drawInfos);else{var s=i,a=t.gl,o=t.stateCache;switch(e.glTarget){case a.ARRAY_BUFFER:o.glVAO&&(a.bindVertexArray(null),o.glVAO=Tj.gpuInputAssembler=null),o.glArrayBuffer!==e.glBuffer&&(a.bindBuffer(a.ARRAY_BUFFER,e.glBuffer),o.glArrayBuffer=e.glBuffer),n===s.byteLength?a.bufferSubData(e.glTarget,r,s):a.bufferSubData(e.glTarget,r,s.slice(0,n));break;case a.ELEMENT_ARRAY_BUFFER:o.glVAO&&(a.bindVertexArray(null),o.glVAO=Tj.gpuInputAssembler=null),o.glElementArrayBuffer!==e.glBuffer&&(a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e.glBuffer),o.glElementArrayBuffer=e.glBuffer),n===s.byteLength?a.bufferSubData(e.glTarget,r,s):a.bufferSubData(e.glTarget,r,s.slice(0,n));break;case a.UNIFORM_BUFFER:o.glUniformBuffer!==e.glBuffer&&(a.bindBuffer(a.UNIFORM_BUFFER,e.glBuffer),o.glUniformBuffer=e.glBuffer),n===s.byteLength?a.bufferSubData(e.glTarget,r,s):a.bufferSubData(e.glTarget,r,new Float32Array(s,0,n/4));break;default:console.error("Unsupported BufferType, update buffer failed.")}}}var Tj={gpuPipelineState:null,gpuInputAssembler:null,reverseCW:!1,glPrimitive:0,invalidateAttachments:[]};function Ej(t,e,i,r,n,s,a){var o=t.gl,h=t.stateCache,l=0;if(i&&e){if(h.glFramebuffer!==i.glFramebuffer){o.bindFramebuffer(o.FRAMEBUFFER,i.glFramebuffer),h.glFramebuffer=i.glFramebuffer;var u=!!i.glFramebuffer;if(u!==Tj.reverseCW){Tj.reverseCW=u;var c=!t.stateCache.rs.isFrontFaceCCW;o.frontFace(c?o.CCW:o.CW),t.stateCache.rs.isFrontFaceCCW=c}}h.viewport.left===r.x&&h.viewport.top===r.y&&h.viewport.width===r.width&&h.viewport.height===r.height||(o.viewport(r.x,r.y,r.width,r.height),h.viewport.left=r.x,h.viewport.top=r.y,h.viewport.width=r.width,h.viewport.height=r.height),h.scissorRect.x===r.x&&h.scissorRect.y===r.y&&h.scissorRect.width===r.width&&h.scissorRect.height===r.height||(o.scissor(r.x,r.y,r.width,r.height),h.scissorRect.x=r.x,h.scissorRect.y=r.y,h.scissorRect.width=r.width,h.scissorRect.height=r.height),Tj.invalidateAttachments.length=0;for(var _=0;_<n.length;++_){var d=e.colorAttachments[_];if(d.format!==il.UNKNOWN)switch(d.loadOp){case Cl.LOAD:break;case Cl.CLEAR:if(h.bs.targets[0].blendColorMask!==fl.ALL&&o.colorMask(!0,!0,!0,!0),i.isOffscreen)$W[0]=n[_].x,$W[1]=n[_].y,$W[2]=n[_].z,$W[3]=n[_].w,o.clearBufferfv(o.COLOR,_,$W);else{var p=n[0];o.clearColor(p.x,p.y,p.z,p.w),l|=o.COLOR_BUFFER_BIT}break;case Cl.DISCARD:Tj.invalidateAttachments.push(o.COLOR_ATTACHMENT0+_)}}if(e.depthStencilAttachment&&e.depthStencilAttachment.format!==il.UNKNOWN){switch(e.depthStencilAttachment.depthLoadOp){case Cl.LOAD:break;case Cl.CLEAR:h.dss.depthWrite||o.depthMask(!0),o.clearDepth(s),l|=o.DEPTH_BUFFER_BIT;break;case Cl.DISCARD:Tj.invalidateAttachments.push(o.DEPTH_ATTACHMENT)}if(zl[e.depthStencilAttachment.format].hasStencil)switch(e.depthStencilAttachment.stencilLoadOp){case Cl.LOAD:break;case Cl.CLEAR:h.dss.stencilWriteMaskFront||o.stencilMaskSeparate(o.FRONT,65535),h.dss.stencilWriteMaskBack||o.stencilMaskSeparate(o.BACK,65535),o.clearStencil(a),l|=o.STENCIL_BUFFER_BIT;break;case Cl.DISCARD:Tj.invalidateAttachments.push(o.STENCIL_ATTACHMENT)}}if(i.glFramebuffer&&Tj.invalidateAttachments.length&&o.invalidateFramebuffer(o.FRAMEBUFFER,Tj.invalidateAttachments),l&&o.clear(l),l&o.COLOR_BUFFER_BIT){var f=h.bs.targets[0].blendColorMask;if(f!==fl.ALL){var m=(f&fl.R)!==fl.NONE,g=(f&fl.G)!==fl.NONE,v=(f&fl.B)!==fl.NONE,y=(f&fl.A)!==fl.NONE;o.colorMask(m,g,v,y)}}l&o.DEPTH_BUFFER_BIT&&!h.dss.depthWrite&&o.depthMask(!1),l&o.STENCIL_BUFFER_BIT&&(h.dss.stencilWriteMaskFront||o.stencilMaskSeparate(o.FRONT,0),h.dss.stencilWriteMaskBack||o.stencilMaskSeparate(o.BACK,0))}}function Sj(t,e,i,r,n,s,a,o,h,l,u,c,_){var d=t.gl,p=t.stateCache,f=e&&e.gpuShader,m=!1;if(e&&Tj.gpuPipelineState!==e){if(Tj.gpuPipelineState=e,Tj.glPrimitive=e.glPrimitive,f){var g=f.glProgram;p.glProgram!==g&&(d.useProgram(g),p.glProgram=g,m=!0)}var v=e.rs;if(v){if(p.rs.cullMode!==v.cullMode){switch(v.cullMode){case ul.NONE:d.disable(d.CULL_FACE);break;case ul.FRONT:d.enable(d.CULL_FACE),d.cullFace(d.FRONT);break;case ul.BACK:d.enable(d.CULL_FACE),d.cullFace(d.BACK)}t.stateCache.rs.cullMode=v.cullMode}var y=v.isFrontFaceCCW!==Tj.reverseCW;t.stateCache.rs.isFrontFaceCCW!==y&&(d.frontFace(y?d.CCW:d.CW),t.stateCache.rs.isFrontFaceCCW=y),t.stateCache.rs.depthBias===v.depthBias&&t.stateCache.rs.depthBiasSlop===v.depthBiasSlop||(d.polygonOffset(v.depthBias,v.depthBiasSlop),t.stateCache.rs.depthBias=v.depthBias,t.stateCache.rs.depthBiasSlop=v.depthBiasSlop),t.stateCache.rs.lineWidth!==v.lineWidth&&(d.lineWidth(v.lineWidth),t.stateCache.rs.lineWidth=v.lineWidth)}var T=e.dss;T&&(p.dss.depthTest!==T.depthTest&&(T.depthTest?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),p.dss.depthTest=T.depthTest),p.dss.depthWrite!==T.depthWrite&&(d.depthMask(T.depthWrite),p.dss.depthWrite=T.depthWrite),p.dss.depthFunc!==T.depthFunc&&(d.depthFunc(hj[T.depthFunc]),p.dss.depthFunc=T.depthFunc),p.dss.stencilTestFront===T.stencilTestFront&&p.dss.stencilTestBack===T.stencilTestBack||(T.stencilTestFront||T.stencilTestBack?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),p.dss.stencilTestFront=T.stencilTestFront,p.dss.stencilTestBack=T.stencilTestBack),p.dss.stencilFuncFront===T.stencilFuncFront&&p.dss.stencilRefFront===T.stencilRefFront&&p.dss.stencilReadMaskFront===T.stencilReadMaskFront||(d.stencilFuncSeparate(d.FRONT,hj[T.stencilFuncFront],T.stencilRefFront,T.stencilReadMaskFront),p.dss.stencilFuncFront=T.stencilFuncFront,p.dss.stencilRefFront=T.stencilRefFront,p.dss.stencilReadMaskFront=T.stencilReadMaskFront),p.dss.stencilFailOpFront===T.stencilFailOpFront&&p.dss.stencilZFailOpFront===T.stencilZFailOpFront&&p.dss.stencilPassOpFront===T.stencilPassOpFront||(d.stencilOpSeparate(d.FRONT,lj[T.stencilFailOpFront],lj[T.stencilZFailOpFront],lj[T.stencilPassOpFront]),p.dss.stencilFailOpFront=T.stencilFailOpFront,p.dss.stencilZFailOpFront=T.stencilZFailOpFront,p.dss.stencilPassOpFront=T.stencilPassOpFront),p.dss.stencilWriteMaskFront!==T.stencilWriteMaskFront&&(d.stencilMaskSeparate(d.FRONT,T.stencilWriteMaskFront),p.dss.stencilWriteMaskFront=T.stencilWriteMaskFront),p.dss.stencilFuncBack===T.stencilFuncBack&&p.dss.stencilRefBack===T.stencilRefBack&&p.dss.stencilReadMaskBack===T.stencilReadMaskBack||(d.stencilFuncSeparate(d.BACK,hj[T.stencilFuncBack],T.stencilRefBack,T.stencilReadMaskBack),p.dss.stencilFuncBack=T.stencilFuncBack,p.dss.stencilRefBack=T.stencilRefBack,p.dss.stencilReadMaskBack=T.stencilReadMaskBack),p.dss.stencilFailOpBack===T.stencilFailOpBack&&p.dss.stencilZFailOpBack===T.stencilZFailOpBack&&p.dss.stencilPassOpBack===T.stencilPassOpBack||(d.stencilOpSeparate(d.BACK,lj[T.stencilFailOpBack],lj[T.stencilZFailOpBack],lj[T.stencilPassOpBack]),p.dss.stencilFailOpBack=T.stencilFailOpBack,p.dss.stencilZFailOpBack=T.stencilZFailOpBack,p.dss.stencilPassOpBack=T.stencilPassOpBack),p.dss.stencilWriteMaskBack!==T.stencilWriteMaskBack&&(d.stencilMaskSeparate(d.BACK,T.stencilWriteMaskBack),p.dss.stencilWriteMaskBack=T.stencilWriteMaskBack));var E=e.bs;if(E){p.bs.isA2C!==E.isA2C&&(E.isA2C?d.enable(d.SAMPLE_ALPHA_TO_COVERAGE):d.disable(d.SAMPLE_ALPHA_TO_COVERAGE),p.bs.isA2C=E.isA2C),p.bs.blendColor.x===E.blendColor.x&&p.bs.blendColor.y===E.blendColor.y&&p.bs.blendColor.z===E.blendColor.z&&p.bs.blendColor.w===E.blendColor.w||(d.blendColor(E.blendColor.x,E.blendColor.y,E.blendColor.z,E.blendColor.w),p.bs.blendColor.x=E.blendColor.x,p.bs.blendColor.y=E.blendColor.y,p.bs.blendColor.z=E.blendColor.z,p.bs.blendColor.w=E.blendColor.w);var b=E.targets[0],A=p.bs.targets[0];A.blend!==b.blend&&(b.blend?d.enable(d.BLEND):d.disable(d.BLEND),A.blend=b.blend),A.blendEq===b.blendEq&&A.blendAlphaEq===b.blendAlphaEq||(d.blendEquationSeparate(uj[b.blendEq],uj[b.blendAlphaEq]),A.blendEq=b.blendEq,A.blendAlphaEq=b.blendAlphaEq),A.blendSrc===b.blendSrc&&A.blendDst===b.blendDst&&A.blendSrcAlpha===b.blendSrcAlpha&&A.blendDstAlpha===b.blendDstAlpha||(d.blendFuncSeparate(cj[b.blendSrc],cj[b.blendDst],cj[b.blendSrcAlpha],cj[b.blendDstAlpha]),A.blendSrc=b.blendSrc,A.blendDst=b.blendDst,A.blendSrcAlpha=b.blendSrcAlpha,A.blendDstAlpha=b.blendDstAlpha),A.blendColorMask!==b.blendColorMask&&(d.colorMask((b.blendColorMask&fl.R)!==fl.NONE,(b.blendColorMask&fl.G)!==fl.NONE,(b.blendColorMask&fl.B)!==fl.NONE,(b.blendColorMask&fl.A)!==fl.NONE),A.blendColorMask=b.blendColorMask)}}if(e&&e.gpuPipelineLayout&&f){for(var C=f.glBlocks.length,w=e.gpuPipelineLayout.dynamicOffsetIndices,R=0;R<C;R++){var x=f.glBlocks[R],O=r[x.set],I=O&&O.descriptorIndices[x.binding],M=I>=0&&O.gpuDescriptors[I];if(M&&M.gpuBuffer){var B=w[x.set],P=B&&B[x.binding],N=M.gpuBuffer.glOffset;P>=0&&(N+=n[P]),p.glBindUBOs[x.glBinding]===M.gpuBuffer.glBuffer&&p.glBindUBOOffsets[x.glBinding]===N||(N?d.bindBufferRange(d.UNIFORM_BUFFER,x.glBinding,M.gpuBuffer.glBuffer,N,M.gpuBuffer.size):d.bindBufferBase(d.UNIFORM_BUFFER,x.glBinding,M.gpuBuffer.glBuffer),p.glUniformBuffer=p.glBindUBOs[x.glBinding]=M.gpuBuffer.glBuffer,p.glBindUBOOffsets[x.glBinding]=N)}else S("Buffer binding '"+x.name+"' at set "+x.set+" binding "+x.binding+" is not bounded")}for(var L=f.glSamplers.length,F=0;F<L;F++)for(var D=f.glSamplers[F],U=r[D.set],k=U&&U.descriptorIndices[D.binding],z=k>=0&&U.gpuDescriptors[k],G=0;G<D.units.length;G++){var H=D.units[G],V=p.glTexUnits[H];if(z&&z.gpuTexture&&z.gpuSampler){if(z.gpuTexture&&z.gpuTexture.size>0){var W=z.gpuTexture;V.glTexture!==W.glTexture&&(p.texUnit!==H&&(d.activeTexture(d.TEXTURE0+H),p.texUnit=H),W.glTexture?d.bindTexture(W.glTarget,W.glTexture):d.bindTexture(W.glTarget,t.nullTex2D.gpuTexture.glTexture),V.glTexture=W.glTexture);var j=z.gpuSampler;p.glSamplerUnits[H]!==j.glSampler&&(d.bindSampler(H,j.glSampler),p.glSamplerUnits[H]=j.glSampler)}z=U.gpuDescriptors[++k]}else S("Sampler binding '"+D.name+"' at set "+D.set+" binding "+D.binding+" index "+G+" is not bounded")}}if(i&&f&&(m||Tj.gpuInputAssembler!==i))if(Tj.gpuInputAssembler=i,t.useVAO){var X=i.glVAOs.get(f.glProgram);if(!X){var Y;X=d.createVertexArray(),i.glVAOs.set(f.glProgram,X),d.bindVertexArray(X),d.bindBuffer(d.ARRAY_BUFFER,null),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,null),p.glArrayBuffer=null,p.glElementArrayBuffer=null;for(var q=0;q<f.glInputs.length;q++){var K=f.glInputs[q];Y=null;for(var Z=0;Z<i.glAttribs.length;Z++){var Q=i.glAttribs[Z];if(Q.name===K.name){Y=Q;break}}if(Y){p.glArrayBuffer!==Y.glBuffer&&(d.bindBuffer(d.ARRAY_BUFFER,Y.glBuffer),p.glArrayBuffer=Y.glBuffer);for(var J=0;J<Y.componentCount;++J){var $=K.glLoc+J,tt=Y.offset+Y.size*J;d.enableVertexAttribArray($),p.glCurrentAttribLocs[$]=!0,d.vertexAttribPointer($,Y.count,Y.glType,Y.isNormalized,Y.stride,tt),d.vertexAttribDivisor($,Y.isInstanced?1:0)}}}var et=i.gpuIndexBuffer;et&&d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,et.glBuffer),d.bindVertexArray(null),d.bindBuffer(d.ARRAY_BUFFER,null),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,null),p.glArrayBuffer=null,p.glElementArrayBuffer=null}p.glVAO!==X&&(d.bindVertexArray(X),p.glVAO=X)}else{for(var it=0;it<t.maxVertexAttributes;++it)p.glCurrentAttribLocs[it]=!1;for(var rt=0;rt<f.glInputs.length;rt++){for(var nt=f.glInputs[rt],st=null,at=0;at<i.glAttribs.length;at++){var ot=i.glAttribs[at];if(ot.name===nt.name){st=ot;break}}if(st){p.glArrayBuffer!==st.glBuffer&&(d.bindBuffer(d.ARRAY_BUFFER,st.glBuffer),p.glArrayBuffer=st.glBuffer);for(var ht=0;ht<st.componentCount;++ht){var lt=nt.glLoc+ht,ut=st.offset+st.size*ht;!p.glEnabledAttribLocs[lt]&&lt>=0&&(d.enableVertexAttribArray(lt),p.glEnabledAttribLocs[lt]=!0),p.glCurrentAttribLocs[lt]=!0,d.vertexAttribPointer(lt,st.count,st.glType,st.isNormalized,st.stride,ut),d.vertexAttribDivisor(lt,st.isInstanced?1:0)}}}var ct=i.gpuIndexBuffer;ct&&p.glElementArrayBuffer!==ct.glBuffer&&(d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,ct.glBuffer),p.glElementArrayBuffer=ct.glBuffer);for(var _t=0;_t<t.maxVertexAttributes;++_t)p.glEnabledAttribLocs[_t]!==p.glCurrentAttribLocs[_t]&&(d.disableVertexAttribArray(_t),p.glEnabledAttribLocs[_t]=!1)}if(e&&e.dynamicStates.length)for(var dt=e.dynamicStates.length,pt=0;pt<dt;pt++)switch(e.dynamicStates[pt]){case Ol.VIEWPORT:s&&(p.viewport.left===s.left&&p.viewport.top===s.top&&p.viewport.width===s.width&&p.viewport.height===s.height||(d.viewport(s.left,s.top,s.width,s.height),p.viewport.left=s.left,p.viewport.top=s.top,p.viewport.width=s.width,p.viewport.height=s.height));break;case Ol.SCISSOR:a&&(p.scissorRect.x===a.x&&p.scissorRect.y===a.y&&p.scissorRect.width===a.width&&p.scissorRect.height===a.height||(d.scissor(a.x,a.y,a.width,a.height),p.scissorRect.x=a.x,p.scissorRect.y=a.y,p.scissorRect.width=a.width,p.scissorRect.height=a.height));break;case Ol.LINE_WIDTH:o&&p.rs.lineWidth!==o&&(d.lineWidth(o),p.rs.lineWidth=o);break;case Ol.DEPTH_BIAS:h&&(p.rs.depthBias===h.constantFactor&&p.rs.depthBiasSlop===h.slopeFactor||(d.polygonOffset(h.constantFactor,h.slopeFactor),p.rs.depthBias=h.constantFactor,p.rs.depthBiasSlop=h.slopeFactor));break;case Ol.BLEND_CONSTANTS:p.bs.blendColor.x===l[0]&&p.bs.blendColor.y===l[1]&&p.bs.blendColor.z===l[2]&&p.bs.blendColor.w===l[3]||(d.blendColor(l[0],l[1],l[2],l[3]),p.bs.blendColor.x=l[0],p.bs.blendColor.y=l[1],p.bs.blendColor.z=l[2],p.bs.blendColor.w=l[3]);break;case Ol.STENCIL_WRITE_MASK:if(c)switch(c.face){case Il.FRONT:p.dss.stencilWriteMaskFront!==c.writeMask&&(d.stencilMaskSeparate(d.FRONT,c.writeMask),p.dss.stencilWriteMaskFront=c.writeMask);break;case Il.BACK:p.dss.stencilWriteMaskBack!==c.writeMask&&(d.stencilMaskSeparate(d.BACK,c.writeMask),p.dss.stencilWriteMaskBack=c.writeMask);break;case Il.ALL:p.dss.stencilWriteMaskFront===c.writeMask&&p.dss.stencilWriteMaskBack===c.writeMask||(d.stencilMask(c.writeMask),p.dss.stencilWriteMaskFront=c.writeMask,p.dss.stencilWriteMaskBack=c.writeMask)}break;case Ol.STENCIL_COMPARE_MASK:if(_)switch(_.face){case Il.FRONT:p.dss.stencilRefFront===_.reference&&p.dss.stencilReadMaskFront===_.compareMask||(d.stencilFuncSeparate(d.FRONT,hj[p.dss.stencilFuncFront],_.reference,_.compareMask),p.dss.stencilRefFront=_.reference,p.dss.stencilReadMaskFront=_.compareMask);break;case Il.BACK:p.dss.stencilRefBack===_.reference&&p.dss.stencilReadMaskBack===_.compareMask||(d.stencilFuncSeparate(d.BACK,hj[p.dss.stencilFuncBack],_.reference,_.compareMask),p.dss.stencilRefBack=_.reference,p.dss.stencilReadMaskBack=_.compareMask);break;case Il.ALL:p.dss.stencilRefFront===_.reference&&p.dss.stencilReadMaskFront===_.compareMask&&p.dss.stencilRefBack===_.reference&&p.dss.stencilReadMaskBack===_.compareMask||(d.stencilFunc(hj[p.dss.stencilFuncBack],_.reference,_.compareMask),p.dss.stencilRefFront=_.reference,p.dss.stencilReadMaskFront=_.compareMask,p.dss.stencilRefBack=_.reference,p.dss.stencilReadMaskBack=_.compareMask)}}}function bj(t,e){var i=t.gl,r=Tj.gpuInputAssembler,n=Tj.glPrimitive;if(r)if(r.gpuIndirectBuffer)for(var s=r.gpuIndirectBuffer.indirects,a=0;a<s.length;a++){var o=s[a],h=r.gpuIndexBuffer;if(o.instanceCount)if(h){if(o.indexCount>0){var l=o.firstIndex*h.stride;i.drawElementsInstanced(n,o.indexCount,r.glIndexType,l,o.instanceCount)}}else o.vertexCount>0&&i.drawArraysInstanced(n,o.firstVertex,o.vertexCount,o.instanceCount);else if(h){if(o.indexCount>0){var u=o.firstIndex*h.stride;i.drawElements(n,o.indexCount,r.glIndexType,u)}}else o.vertexCount>0&&i.drawArrays(n,o.firstVertex,o.vertexCount)}else if(e.instanceCount)if(r.gpuIndexBuffer){if(e.indexCount>0){var c=e.firstIndex*r.gpuIndexBuffer.stride;i.drawElementsInstanced(n,e.indexCount,r.glIndexType,c,e.instanceCount)}}else e.vertexCount>0&&i.drawArraysInstanced(n,e.firstVertex,e.vertexCount,e.instanceCount);else if(r.gpuIndexBuffer){if(e.indexCount>0){var _=e.firstIndex*r.gpuIndexBuffer.stride;i.drawElements(n,e.indexCount,r.glIndexType,_)}}else e.vertexCount>0&&i.drawArrays(n,e.firstVertex,e.vertexCount)}var Aj=new Array(oj.COUNT);function Cj(t,e){Aj.fill(0);for(var i=0;i<e.cmds.length;++i){var r=e.cmds.array[i],n=Aj[r]++;switch(r){case oj.BEGIN_RENDER_PASS:var s=e.beginRenderPassCmds.array[n];Ej(t,s.gpuRenderPass,s.gpuFramebuffer,s.renderArea,s.clearColors,s.clearDepth,s.clearStencil);break;case oj.BIND_STATES:var a=e.bindStatesCmds.array[n];Sj(t,a.gpuPipelineState,a.gpuInputAssembler,a.gpuDescriptorSets,a.dynamicOffsets,a.viewport,a.scissor,a.lineWidth,a.depthBias,a.blendConstants,a.depthBounds,a.stencilWriteMask,a.stencilCompareMask);break;case oj.DRAW:bj(t,e.drawCmds.array[n].drawInfo);break;case oj.UPDATE_BUFFER:var o=e.updateBufferCmds.array[n];yj(t,o.gpuBuffer,o.buffer,o.offset,o.size);break;case oj.COPY_BUFFER_TO_TEXTURE:var h=e.copyBufferToTextureCmds.array[n];wj(t,h.buffers,h.gpuTexture,h.regions)}}}function wj(t,e,i,r){var n=t.gl,s=t.stateCache.glTexUnits[t.stateCache.texUnit];s.glTexture!==i.glTexture&&(n.bindTexture(i.glTarget,i.glTexture),s.glTexture=i.glTexture);var a=0,o=1,h=1,l=0,u=zl[i.format].isCompressed;switch(i.glTarget){case n.TEXTURE_2D:for(var c=0;c<r.length;c++){var _=r[c];o=_.texExtent.width,h=_.texExtent.height;var d=e[a++];u?i.glInternalFmt!==$V.COMPRESSED_RGB_ETC1_WEBGL?n.compressedTexSubImage2D(n.TEXTURE_2D,_.texSubres.mipLevel,_.texOffset.x,_.texOffset.y,o,h,i.glFormat,d):n.compressedTexImage2D(n.TEXTURE_2D,_.texSubres.mipLevel,i.glInternalFmt,o,h,0,d):n.texSubImage2D(n.TEXTURE_2D,_.texSubres.mipLevel,_.texOffset.x,_.texOffset.y,o,h,i.glFormat,i.glType,d)}break;case n.TEXTURE_CUBE_MAP:for(var p=0;p<r.length;p++){var f=r[p],m=f.texSubres.baseArrayLayer+f.texSubres.layerCount;for(l=f.texSubres.baseArrayLayer;l<m;++l){o=f.texExtent.width,h=f.texExtent.height;var g=e[a++];u?i.glInternalFmt!==$V.COMPRESSED_RGB_ETC1_WEBGL?n.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+l,f.texSubres.mipLevel,f.texOffset.x,f.texOffset.y,o,h,i.glFormat,g):n.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+l,f.texSubres.mipLevel,i.glInternalFmt,o,h,0,g):n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+l,f.texSubres.mipLevel,f.texOffset.x,f.texOffset.y,o,h,i.glFormat,i.glType,g)}}break;default:console.error("Unsupported GL texture type, copy buffer to texture failed.")}i.flags&El.GEN_MIPMAP&&n.generateMipmap(i.glTarget)}var Rj=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuBuffer=null,e}s(e,t);var i=e.prototype;return i.initialize=function(t){if("buffer"in t){this._isBufferView=!0;var e=t.buffer;this._usage=e.usage,this._memUsage=e.memUsage,this._size=this._stride=t.range,this._count=1,this._flags=e.flags,this._gpuBuffer={usage:this._usage,memUsage:this._memUsage,size:this._size,stride:this._stride,buffer:this._bakcupBuffer,indirects:e.gpuBuffer.indirects,glTarget:e.gpuBuffer.glTarget,glBuffer:e.gpuBuffer.glBuffer,glOffset:t.offset}}else this._usage=t.usage,this._memUsage=t.memUsage,this._size=t.size,this._stride=Math.max(t.stride||this._size,1),this._count=this._size/this._stride,this._flags=t.flags,this._usage&rl.INDIRECT&&(this._indirectBuffer=new ql),this._flags&sl.BAKUP_BUFFER&&(this._bakcupBuffer=new Uint8Array(this._size),this._device.memoryStatus.bufferSize+=this._size),this._gpuBuffer={usage:this._usage,memUsage:this._memUsage,size:this._size,stride:this._stride,buffer:this._bakcupBuffer,indirects:[],glTarget:0,glBuffer:null,glOffset:0},t.usage&rl.INDIRECT&&(this._gpuBuffer.indirects=this._indirectBuffer.drawInfos),function(t,e){var i=t.gl,r=t.stateCache,n=e.memUsage&nl.HOST?i.DYNAMIC_DRAW:i.STATIC_DRAW;if(e.usage&rl.VERTEX){e.glTarget=i.ARRAY_BUFFER;var s=i.createBuffer();s&&(e.glBuffer=s,e.size>0&&(t.useVAO&&r.glVAO&&(i.bindVertexArray(null),r.glVAO=Tj.gpuInputAssembler=null),t.stateCache.glArrayBuffer!==e.glBuffer&&(i.bindBuffer(i.ARRAY_BUFFER,e.glBuffer),t.stateCache.glArrayBuffer=e.glBuffer),i.bufferData(i.ARRAY_BUFFER,e.size,n),i.bindBuffer(i.ARRAY_BUFFER,null),t.stateCache.glArrayBuffer=null))}else if(e.usage&rl.INDEX){e.glTarget=i.ELEMENT_ARRAY_BUFFER;var a=i.createBuffer();a&&(e.glBuffer=a,e.size>0&&(t.useVAO&&r.glVAO&&(i.bindVertexArray(null),r.glVAO=Tj.gpuInputAssembler=null),t.stateCache.glElementArrayBuffer!==e.glBuffer&&(i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.glBuffer),t.stateCache.glElementArrayBuffer=e.glBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e.size,n),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),t.stateCache.glElementArrayBuffer=null))}else if(e.usage&rl.UNIFORM){e.glTarget=i.UNIFORM_BUFFER;var o=i.createBuffer();o&&e.size>0&&(e.glBuffer=o,t.stateCache.glUniformBuffer!==e.glBuffer&&(i.bindBuffer(i.UNIFORM_BUFFER,e.glBuffer),t.stateCache.glUniformBuffer=e.glBuffer),i.bufferData(i.UNIFORM_BUFFER,e.size,n),i.bindBuffer(i.UNIFORM_BUFFER,null),t.stateCache.glUniformBuffer=null)}else e.usage&rl.INDIRECT||e.usage&rl.TRANSFER_DST||e.usage&rl.TRANSFER_SRC||console.error("Unsupported BufferType, create buffer failed."),e.glTarget=i.NONE}(this._device,this._gpuBuffer),this._device.memoryStatus.bufferSize+=this._size;return!0},i.destroy=function(){this._gpuBuffer&&(this._isBufferView||(function(t,e){var i=t.gl;if(e.glBuffer){switch(e.glTarget){case i.ARRAY_BUFFER:t.useVAO&&t.stateCache.glVAO&&(i.bindVertexArray(null),t.stateCache.glVAO=Tj.gpuInputAssembler=null),i.bindBuffer(i.ARRAY_BUFFER,null),t.stateCache.glArrayBuffer=null;break;case i.ELEMENT_ARRAY_BUFFER:t.useVAO&&t.stateCache.glVAO&&(i.bindVertexArray(null),t.stateCache.glVAO=Tj.gpuInputAssembler=null),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),t.stateCache.glElementArrayBuffer=null;break;case i.UNIFORM_BUFFER:i.bindBuffer(i.UNIFORM_BUFFER,null),t.stateCache.glUniformBuffer=null}i.deleteBuffer(e.glBuffer),e.glBuffer=null}}(this._device,this._gpuBuffer),this._device.memoryStatus.bufferSize-=this._size),this._gpuBuffer=null),this._bakcupBuffer=null},i.resize=function(t){if(this._isBufferView)console.warn("cannot resize buffer views!");else{var e=this._size;if(e!==t){if(this._size=t,this._count=this._size/this._stride,this._bakcupBuffer){var i=this._bakcupBuffer;this._bakcupBuffer=new Uint8Array(this._size),this._bakcupBuffer.set(i),this._device.memoryStatus.bufferSize-=e,this._device.memoryStatus.bufferSize+=t}this._gpuBuffer&&(this._bakcupBuffer&&(this._gpuBuffer.buffer=this._bakcupBuffer),this._gpuBuffer.size=t,t>0&&(function(t,e){var i=t.gl,r=t.stateCache,n=e.memUsage&nl.HOST?i.DYNAMIC_DRAW:i.STATIC_DRAW;e.usage&rl.VERTEX?(t.useVAO&&r.glVAO&&(i.bindVertexArray(null),r.glVAO=Tj.gpuInputAssembler=null),r.glArrayBuffer!==e.glBuffer&&i.bindBuffer(i.ARRAY_BUFFER,e.glBuffer),e.buffer?i.bufferData(i.ARRAY_BUFFER,e.buffer,n):i.bufferData(i.ARRAY_BUFFER,e.size,n),i.bindBuffer(i.ARRAY_BUFFER,null),r.glArrayBuffer=null):e.usage&rl.INDEX?(t.useVAO&&r.glVAO&&(i.bindVertexArray(null),r.glVAO=Tj.gpuInputAssembler=null),t.stateCache.glElementArrayBuffer!==e.glBuffer&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.glBuffer),e.buffer?i.bufferData(i.ELEMENT_ARRAY_BUFFER,e.buffer,n):i.bufferData(i.ELEMENT_ARRAY_BUFFER,e.size,n),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),t.stateCache.glElementArrayBuffer=null):e.usage&rl.UNIFORM?(t.stateCache.glUniformBuffer!==e.glBuffer&&i.bindBuffer(i.UNIFORM_BUFFER,e.glBuffer),i.bufferData(i.UNIFORM_BUFFER,e.size,n),i.bindBuffer(i.UNIFORM_BUFFER,null),t.stateCache.glUniformBuffer=null):(e.usage&rl.INDIRECT||e.usage&rl.TRANSFER_DST||e.usage&rl.TRANSFER_SRC||console.error("Unsupported BufferType, create buffer failed."),e.glTarget=i.NONE)}(this._device,this._gpuBuffer),this._device.memoryStatus.bufferSize-=e,this._device.memoryStatus.bufferSize+=t))}}},i.update=function(t,e,i){if(this._isBufferView)console.warn("cannot update through buffer views!");else{var r;if(r=void 0!==i?i:this._usage&rl.INDIRECT?0:t.byteLength,this._bakcupBuffer&&t!==this._bakcupBuffer.buffer){var n=new Uint8Array(t,0,i);this._bakcupBuffer.set(n,e)}yj(this._device,this._gpuBuffer,t,e||0,r)}},r(e,[{key:"gpuBuffer",get:function(){return this._gpuBuffer}}]),e}(Ql),xj=function(){function t(t,e){this._frees=void 0,this._freeIdx=0,this._freeCmds=void 0,this._frees=new Array(e),this._freeCmds=new Wi(e);for(var i=0;i<e;++i)this._frees[i]=new t;this._freeIdx=e-1}var e=t.prototype;return e.alloc=function(t){if(this._freeIdx<0){var e=2*this._frees.length,i=this._frees;this._frees=new Array(e);for(var r=e-i.length,n=0;n<r;++n)this._frees[n]=new t;for(var s=r,a=0;s<e;++s,++a)this._frees[s]=i[a];this._freeIdx+=r}var o=this._frees[this._freeIdx];return this._frees[this._freeIdx--]=null,++o.refCount,o},e.free=function(t){0==--t.refCount&&this._freeCmds.push(t)},e.freeCmds=function(t){for(var e=0;e<t.length;++e)0==--t.array[e].refCount&&this._freeCmds.push(t.array[e])},e.release=function(){for(var t=0;t<this._freeCmds.length;++t){var e=this._freeCmds.array[t];e.clear(),this._frees[++this._freeIdx]=e}this._freeCmds.clear()},t}(),Oj=function(){function t(){this.beginRenderPassCmdPool=void 0,this.bindStatesCmdPool=void 0,this.drawCmdPool=void 0,this.updateBufferCmdPool=void 0,this.copyBufferToTextureCmdPool=void 0,this.beginRenderPassCmdPool=new xj(dj,1),this.bindStatesCmdPool=new xj(pj,1),this.drawCmdPool=new xj(fj,1),this.updateBufferCmdPool=new xj(mj,1),this.copyBufferToTextureCmdPool=new xj(gj,1)}var e=t.prototype;return e.clearCmds=function(t){t.beginRenderPassCmds.length&&(this.beginRenderPassCmdPool.freeCmds(t.beginRenderPassCmds),t.beginRenderPassCmds.clear()),t.bindStatesCmds.length&&(this.bindStatesCmdPool.freeCmds(t.bindStatesCmds),t.bindStatesCmds.clear()),t.drawCmds.length&&(this.drawCmdPool.freeCmds(t.drawCmds),t.drawCmds.clear()),t.updateBufferCmds.length&&(this.updateBufferCmdPool.freeCmds(t.updateBufferCmds),t.updateBufferCmds.clear()),t.copyBufferToTextureCmds.length&&(this.copyBufferToTextureCmdPool.freeCmds(t.copyBufferToTextureCmds),t.copyBufferToTextureCmds.clear()),t.cmds.clear()},e.releaseCmds=function(){this.beginRenderPassCmdPool.release(),this.bindStatesCmdPool.release(),this.drawCmdPool.release(),this.updateBufferCmdPool.release(),this.copyBufferToTextureCmdPool.release()},t}(),Ij=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).cmdPackage=new vj,e._webGLAllocator=null,e._isInRenderPass=!1,e._curGPUPipelineState=null,e._curGPUDescriptorSets=[],e._curGPUInputAssembler=null,e._curDynamicOffsets=[],e._curViewport=null,e._curScissor=null,e._curLineWidth=null,e._curDepthBias=null,e._curBlendConstants=[],e._curDepthBounds=null,e._curStencilWriteMask=null,e._curStencilCompareMask=null,e._isStateInvalied=!1,e}s(e,t);var i=e.prototype;return i.initialize=function(t){this._type=t.type,this._queue=t.queue,this._webGLAllocator=this._device.cmdAllocator;for(var e=this._device.bindingMappingInfo.bufferOffsets.length,i=0;i<e;i++)this._curGPUDescriptorSets.push(null),this._curDynamicOffsets.push([]);return!0},i.destroy=function(){this._webGLAllocator&&(this._webGLAllocator.clearCmds(this.cmdPackage),this._webGLAllocator=null)},i.begin=function(){this._webGLAllocator.clearCmds(this.cmdPackage),this._curGPUPipelineState=null,this._curGPUInputAssembler=null,this._curGPUDescriptorSets.length=0;for(var t=0;t<this._curDynamicOffsets.length;t++)this._curDynamicOffsets[t].length=0;this._curViewport=null,this._curScissor=null,this._curLineWidth=null,this._curDepthBias=null,this._curBlendConstants.length=0,this._curDepthBounds=null,this._curStencilWriteMask=null,this._curStencilCompareMask=null,this._numDrawCalls=0,this._numInstances=0,this._numTris=0},i.end=function(){this._isStateInvalied&&this.bindStates(),this._isInRenderPass=!1},i.beginRenderPass=function(t,e,i,r,n,s){var a=this._webGLAllocator.beginRenderPassCmdPool.alloc(dj);a.gpuRenderPass=t.gpuRenderPass,a.gpuFramebuffer=e.gpuFramebuffer,a.renderArea=i;for(var o=0;o<r.length;++o)a.clearColors[o]=r[o];a.clearDepth=n,a.clearStencil=s,this.cmdPackage.beginRenderPassCmds.push(a),this.cmdPackage.cmds.push(oj.BEGIN_RENDER_PASS),this._isInRenderPass=!0},i.endRenderPass=function(){this._isInRenderPass=!1},i.bindPipelineState=function(t){var e=t.gpuPipelineState;e!==this._curGPUPipelineState&&(this._curGPUPipelineState=e,this._isStateInvalied=!0)},i.bindDescriptorSet=function(t,e,i){var r=e.gpuDescriptorSet;if(r!==this._curGPUDescriptorSets[t]&&(this._curGPUDescriptorSets[t]=r,this._isStateInvalied=!0),i){for(var n=this._curDynamicOffsets[t],s=0;s<i.length;s++)n[s]=i[s];n.length=i.length,this._isStateInvalied=!0}},i.bindInputAssembler=function(t){var e=t.gpuInputAssembler;this._curGPUInputAssembler=e,this._isStateInvalied=!0},i.setViewport=function(t){this._curViewport?this._curViewport.left===t.left&&this._curViewport.top===t.top&&this._curViewport.width===t.width&&this._curViewport.height===t.height&&this._curViewport.minDepth===t.minDepth&&this._curViewport.maxDepth===t.maxDepth||(this._curViewport.left=t.left,this._curViewport.top=t.top,this._curViewport.width=t.width,this._curViewport.height=t.height,this._curViewport.minDepth=t.minDepth,this._curViewport.maxDepth=t.maxDepth,this._isStateInvalied=!0):this._curViewport=new _u(t.left,t.top,t.width,t.height,t.minDepth,t.maxDepth)},i.setScissor=function(t){this._curScissor?this._curScissor.x===t.x&&this._curScissor.y===t.y&&this._curScissor.width===t.width&&this._curScissor.height===t.height||(this._curScissor.x=t.x,this._curScissor.y=t.y,this._curScissor.width=t.width,this._curScissor.height=t.height,this._isStateInvalied=!0):this._curScissor=new cu(t.x,t.y,t.width,t.height)},i.setLineWidth=function(t){this._curLineWidth!==t&&(this._curLineWidth=t,this._isStateInvalied=!0)},i.setDepthBias=function(t,e,i){this._curDepthBias?this._curDepthBias.constantFactor===t&&this._curDepthBias.clamp===e&&this._curDepthBias.slopeFactor===i||(this._curDepthBias.constantFactor=t,this._curDepthBias.clamp=e,this._curDepthBias.slopeFactor=i,this._isStateInvalied=!0):(this._curDepthBias={constantFactor:t,clamp:e,slopeFactor:i},this._isStateInvalied=!0)},i.setBlendConstants=function(t){4!==t.length||this._curBlendConstants[0]===t[0]&&this._curBlendConstants[1]===t[1]&&this._curBlendConstants[2]===t[2]&&this._curBlendConstants[3]===t[3]||(this._curBlendConstants.length=0,Array.prototype.push.apply(this._curBlendConstants,t),this._isStateInvalied=!0)},i.setDepthBound=function(t,e){this._curDepthBounds&&this._curDepthBounds.minBounds===t&&this._curDepthBounds.maxBounds===e||(this._curDepthBounds={minBounds:t,maxBounds:e},this._isStateInvalied=!0)},i.setStencilWriteMask=function(t,e){this._curStencilWriteMask?this._curStencilWriteMask.face===t&&this._curStencilWriteMask.writeMask===e||(this._curStencilWriteMask.face=t,this._curStencilWriteMask.writeMask=e,this._isStateInvalied=!0):(this._curStencilWriteMask={face:t,writeMask:e},this._isStateInvalied=!0)},i.setStencilCompareMask=function(t,e,i){this._curStencilCompareMask?this._curStencilCompareMask.face===t&&this._curStencilCompareMask.reference===e&&this._curStencilCompareMask.compareMask===i||(this._curStencilCompareMask.face=t,this._curStencilCompareMask.reference=e,this._curStencilCompareMask.compareMask=i,this._isStateInvalied=!0):(this._curStencilCompareMask={face:t,reference:e,compareMask:i},this._isStateInvalied=!0)},i.draw=function(t){if(this._type===Al.PRIMARY&&this._isInRenderPass||this._type===Al.SECONDARY){this._isStateInvalied&&this.bindStates();var e=this._webGLAllocator.drawCmdPool.alloc(fj);e.drawInfo.vertexCount=t.vertexCount,e.drawInfo.firstVertex=t.firstVertex,e.drawInfo.indexCount=t.indexCount,e.drawInfo.firstIndex=t.firstIndex,e.drawInfo.vertexOffset=t.vertexOffset,e.drawInfo.instanceCount=t.instanceCount,e.drawInfo.firstInstance=t.firstInstance,this.cmdPackage.drawCmds.push(e),this.cmdPackage.cmds.push(oj.DRAW),++this._numDrawCalls,this._numInstances+=t.instanceCount;var i=t.indexCount||t.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=i/3*Math.max(t.instanceCount,1);break;case 5:case 6:this._numTris+=(i-2)*Math.max(t.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},i.updateBuffer=function(t,e,i,r){if(this._type===Al.PRIMARY&&!this._isInRenderPass||this._type===Al.SECONDARY){var n=t.gpuBuffer;if(n){var s,a=this._webGLAllocator.updateBufferCmdPool.alloc(mj),o=0;t.usage&rl.INDIRECT||(o=void 0!==r?r:e.byteLength),s=e,a.gpuBuffer=n,a.buffer=s,a.offset=void 0!==i?i:0,a.size=o,this.cmdPackage.updateBufferCmds.push(a),this.cmdPackage.cmds.push(oj.UPDATE_BUFFER)}}else console.error("Command 'updateBuffer' must be recorded outside a render pass.")},i.copyBuffersToTexture=function(t,e,i){if(this._type===Al.PRIMARY&&!this._isInRenderPass||this._type===Al.SECONDARY){var r=e.gpuTexture;if(r){var n=this._webGLAllocator.copyBufferToTextureCmdPool.alloc(gj);n.gpuTexture=r,n.regions=i,n.buffers=t,this.cmdPackage.copyBufferToTextureCmds.push(n),this.cmdPackage.cmds.push(oj.COPY_BUFFER_TO_TEXTURE)}}else console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.")},i.execute=function(t,e){for(var i=0;i<e;++i){for(var r=t[i],n=0;n<r.cmdPackage.beginRenderPassCmds.length;++n){var s=r.cmdPackage.beginRenderPassCmds.array[n];++s.refCount,this.cmdPackage.beginRenderPassCmds.push(s)}for(var a=0;a<r.cmdPackage.bindStatesCmds.length;++a){var o=r.cmdPackage.bindStatesCmds.array[a];++o.refCount,this.cmdPackage.bindStatesCmds.push(o)}for(var h=0;h<r.cmdPackage.drawCmds.length;++h){var l=r.cmdPackage.drawCmds.array[h];++l.refCount,this.cmdPackage.drawCmds.push(l)}for(var u=0;u<r.cmdPackage.updateBufferCmds.length;++u){var c=r.cmdPackage.updateBufferCmds.array[u];++c.refCount,this.cmdPackage.updateBufferCmds.push(c)}for(var _=0;_<r.cmdPackage.copyBufferToTextureCmds.length;++_){var d=r.cmdPackage.copyBufferToTextureCmds.array[_];++d.refCount,this.cmdPackage.copyBufferToTextureCmds.push(d)}this.cmdPackage.cmds.concat(r.cmdPackage.cmds.array),this._numDrawCalls+=r._numDrawCalls,this._numInstances+=r._numInstances,this._numTris+=r._numTris}},i.bindStates=function(){var t=this._webGLAllocator.bindStatesCmdPool.alloc(pj);t.gpuPipelineState=this._curGPUPipelineState,Array.prototype.push.apply(t.gpuDescriptorSets,this._curGPUDescriptorSets);for(var e=0;e<this._curDynamicOffsets.length;e++)Array.prototype.push.apply(t.dynamicOffsets,this._curDynamicOffsets[e]);t.gpuInputAssembler=this._curGPUInputAssembler,t.viewport=this._curViewport,t.scissor=this._curScissor,t.lineWidth=this._curLineWidth,t.depthBias=this._curDepthBias,Array.prototype.push.apply(t.blendConstants,this._curBlendConstants),t.depthBounds=this._curDepthBounds,t.stencilWriteMask=this._curStencilWriteMask,t.stencilCompareMask=this._curStencilCompareMask,this.cmdPackage.bindStatesCmds.push(t),this.cmdPackage.cmds.push(oj.BIND_STATES),this._isStateInvalied=!1},r(e,[{key:"webGLDevice",get:function(){return this._device}}]),e}($l),Mj=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._sync=null,e}s(e,t);var i=e.prototype;return i.initialize=function(){return!0},i.destroy=function(){},i.wait=function(){if(this._sync){var t=this._device.gl;t.clientWaitSync(this._sync,0,t.TIMEOUT_IGNORED)}},i.reset=function(){this._sync&&(this._device.gl.deleteSync(this._sync),this._sync=null)},i.insert=function(){var t=this._device.gl;this._sync&&t.deleteSync(this._sync),this._sync=t.fenceSync(t.SYNC_GPU_COMMANDS_COMPLETE,0)},e}(rc),Bj=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuFramebuffer=null,e}s(e,t);var i=e.prototype;return i.initialize=function(t){this._renderPass=t.renderPass,this._colorTextures=t.colorTextures||[],this._depthStencilTexture=t.depthStencilTexture||null,0!==t.depStencilMipmapLevel&&console.warn("The mipmap level of th texture image to be attached of depth stencil attachment should be 0. Convert to 0.");for(var e=0;e<t.colorMipmapLevels.length;++e)0!==t.colorMipmapLevels[e]&&console.warn("The mipmap level of th texture image to be attached of color attachment "+e+" should be 0. Convert to 0.");for(var i=[],r=0;r<t.colorTextures.length;r++){var n=t.colorTextures[r];n&&i.push(n.gpuTexture)}var s=null;return t.depthStencilTexture&&(s=t.depthStencilTexture.gpuTexture),this._gpuFramebuffer={gpuRenderPass:t.renderPass.gpuRenderPass,gpuColorTextures:i,gpuDepthStencilTexture:s,glFramebuffer:null},function(t,e){if(e.gpuColorTextures.length||e.gpuDepthStencilTexture){var i=t.gl,r=[],n=i.createFramebuffer();if(n){e.glFramebuffer=n,t.stateCache.glFramebuffer!==e.glFramebuffer&&i.bindFramebuffer(i.FRAMEBUFFER,e.glFramebuffer);for(var s=0;s<e.gpuColorTextures.length;++s){var a=e.gpuColorTextures[s];a&&(a.glTexture?i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+s,a.glTarget,a.glTexture,0):i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+s,i.RENDERBUFFER,a.glRenderbuffer),r.push(i.COLOR_ATTACHMENT0+s))}var o=e.gpuDepthStencilTexture;if(o){var h=zl[o.format].hasStencil?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;o.glTexture?i.framebufferTexture2D(i.FRAMEBUFFER,h,o.glTarget,o.glTexture,0):i.framebufferRenderbuffer(i.FRAMEBUFFER,h,i.RENDERBUFFER,o.glRenderbuffer)}i.drawBuffers(r);var l=i.checkFramebufferStatus(i.FRAMEBUFFER);if(l!==i.FRAMEBUFFER_COMPLETE)switch(l){case i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case i.FRAMEBUFFER_UNSUPPORTED:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_UNSUPPORTED")}t.stateCache.glFramebuffer!==e.glFramebuffer&&i.bindFramebuffer(i.FRAMEBUFFER,t.stateCache.glFramebuffer)}}}(this._device,this._gpuFramebuffer),!0},i.destroy=function(){var t,e;this._gpuFramebuffer&&(t=this._device,(e=this._gpuFramebuffer).glFramebuffer&&(t.gl.deleteFramebuffer(e.glFramebuffer),e.glFramebuffer=null),this._gpuFramebuffer=null)},r(e,[{key:"gpuFramebuffer",get:function(){return this._gpuFramebuffer}}]),e}(nu),Pj=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuInputAssembler=null,e}s(e,t);var i=e.prototype;return i.initialize=function(t){if(0===t.vertexBuffers.length)return console.error("InputAssemblerInfo.vertexBuffers is null."),!1;if(this._attributes=t.attributes,this._attributesHash=this.computeAttributesHash(),this._vertexBuffers=t.vertexBuffers,t.indexBuffer)this._indexBuffer=t.indexBuffer,this._indexCount=this._indexBuffer.size/this._indexBuffer.stride,this._firstIndex=0;else{var e=this._vertexBuffers[0];this._vertexCount=e.size/e.stride,this._firstVertex=0,this._vertexOffset=0}this._instanceCount=0,this._firstInstance=0,this._indirectBuffer=t.indirectBuffer||null;for(var i=new Array(t.vertexBuffers.length),r=0;r<t.vertexBuffers.length;++r){var n=t.vertexBuffers[r];n.gpuBuffer&&(i[r]=n.gpuBuffer)}var s=null,a=0;if(t.indexBuffer&&(s=t.indexBuffer.gpuBuffer))switch(s.stride){case 1:a=5121;break;case 2:a=5123;break;case 4:a=5125;break;default:console.error("Illegal index buffer stride.")}var o=null;return t.indirectBuffer&&(o=t.indirectBuffer.gpuBuffer),this._gpuInputAssembler={attributes:t.attributes,gpuVertexBuffers:i,gpuIndexBuffer:s,gpuIndirectBuffer:o,glAttribs:[],glIndexType:a,glVAOs:new Map},function(t,e){var i=t.gl;e.glAttribs=new Array(e.attributes.length);for(var r=[0,0,0,0,0,0,0,0],n=0;n<e.attributes.length;++n){var s=e.attributes[n],a=void 0!==s.stream?s.stream:0,o=e.gpuVertexBuffers[a],h=tj(s.format,i),l=zl[s.format].size;e.glAttribs[n]={name:s.name,glBuffer:o.glBuffer,glType:h,size:l,count:zl[s.format].count,stride:o.stride,componentCount:aj(h,i),isNormalized:void 0!==s.isNormalized&&s.isNormalized,isInstanced:void 0!==s.isInstanced&&s.isInstanced,offset:r[a]},r[a]+=l}}(this._device,this._gpuInputAssembler),!0},i.destroy=function(){var t=this._device;this._gpuInputAssembler&&t.useVAO&&function(t,e){for(var i=e.glVAOs.values(),r=i.next();!r.done;)t.gl.deleteVertexArray(r.value),r=i.next();e.glVAOs.clear()}(t,this._gpuInputAssembler),this._gpuInputAssembler=null},r(e,[{key:"gpuInputAssembler",get:function(){return this._gpuInputAssembler}}]),e}(uu),Nj=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuDescriptorSetLayout=null,e}s(e,t);var i=e.prototype;return i.initialize=function(t){Array.prototype.push.apply(this._bindings,t.bindings);for(var e=0,i=-1,r=[],n=0;n<this._bindings.length;n++){var s=this._bindings[n];r.push(e),e+=s.count,s.binding>i&&(i=s.binding)}this._bindingIndices=Array(i+1).fill(-1);for(var a=this._descriptorIndices=Array(i+1).fill(-1),o=0;o<this._bindings.length;o++){var h=this._bindings[o];this._bindingIndices[h.binding]=o,a[h.binding]=r[o]}for(var l=[],u=0;u<this._bindings.length;u++){var c=this._bindings[u];if(c.descriptorType&Ju)for(var _=0;_<c.count;_++)l.push(c.binding)}return this._gpuDescriptorSetLayout={bindings:this._bindings,dynamicBindings:l,descriptorIndices:a,descriptorCount:e},!0},i.destroy=function(){this._bindings.length=0},r(e,[{key:"gpuDescriptorSetLayout",get:function(){return this._gpuDescriptorSetLayout}}]),e}($u),Lj=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuPipelineLayout=null,e}s(e,t);var i=e.prototype;return i.initialize=function(t){Array.prototype.push.apply(this._setLayouts,t.setLayouts);for(var e=[],i=[],r=0,n=0;n<this._setLayouts.length;n++){for(var s=this._setLayouts[n],a=s.gpuDescriptorSetLayout.dynamicBindings,o=Array(s.bindingIndices.length).fill(-1),h=0;h<a.length;h++){var l=a[h];o[l]<0&&(o[l]=r+h)}i.push(s.gpuDescriptorSetLayout),e.push(o),r+=a.length}return this._gpuPipelineLayout={gpuSetLayouts:i,dynamicOffsetIndices:e,dynamicOffsetCount:r},!0},i.destroy=function(){this._setLayouts.length=0},r(e,[{key:"gpuPipelineLayout",get:function(){return this._gpuPipelineLayout}}]),e}(ec),Fj=[0,1,3,2,0,0,0,4,5,6,0,0,0,0],Dj=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuPipelineState=null,e}s(e,t);var i=e.prototype;return i.initialize=function(t){this._primitive=t.primitive,this._shader=t.shader,this._pipelineLayout=t.pipelineLayout,this._rs=t.rasterizerState,this._dss=t.depthStencilState,this._bs=t.blendState,this._is=t.inputState,this._renderPass=t.renderPass,this._dynamicStates=t.dynamicStates;for(var e=[],i=0;i<31;i++)this._dynamicStates&1<<i&&e.push(1<<i);return this._gpuPipelineState={glPrimitive:Fj[t.primitive],gpuShader:t.shader.gpuShader,gpuPipelineLayout:t.pipelineLayout.gpuPipelineLayout,rs:t.rasterizerState,dss:t.depthStencilState,bs:t.blendState,gpuRenderPass:t.renderPass.gpuRenderPass,dynamicStates:e},!0},i.destroy=function(){this._gpuPipelineState=null},r(e,[{key:"gpuPipelineState",get:function(){return this._gpuPipelineState}}]),e}(Cu),Uj=[],kj=function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;return i.beginRenderPass=function(t,e,i,r,n,s){Ej(this._device,t.gpuRenderPass,e.gpuFramebuffer,i,r,n,s),this._isInRenderPass=!0},i.draw=function(t){if(this._isInRenderPass){this._isStateInvalied&&this.bindStates(),bj(this._device,t),++this._numDrawCalls,this._numInstances+=t.instanceCount;var e=t.indexCount||t.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=e/3*Math.max(t.instanceCount,1);break;case 5:case 6:this._numTris+=(e-2)*Math.max(t.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},i.updateBuffer=function(t,e,i,r){if(this._isInRenderPass)console.error("Command 'updateBuffer' must be recorded outside a render pass.");else{var n,s=t.gpuBuffer;s&&(void 0===i&&(i=0),n=void 0!==r?r:t.usage&rl.INDIRECT?0:e.byteLength,yj(this._device,s,e,i,n))}},i.copyBuffersToTexture=function(t,e,i){if(this._isInRenderPass)console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.");else{var r=e.gpuTexture;r&&wj(this._device,t,r,i)}},i.execute=function(t,e){for(var i=0;i<e;++i){var r=t[i];Cj(this._device,r.cmdPackage),this._numDrawCalls+=r._numDrawCalls,this._numInstances+=r._numInstances,this._numTris+=r._numTris}},i.bindStates=function(){Uj.length=0;for(var t=0;t<this._curDynamicOffsets.length;t++)Array.prototype.push.apply(Uj,this._curDynamicOffsets[t]);Sj(this._device,this._curGPUPipelineState,this._curGPUInputAssembler,this._curGPUDescriptorSets,Uj,this._curViewport,this._curScissor,this._curLineWidth,this._curDepthBias,this._curBlendConstants,this._curDepthBounds,this._curStencilWriteMask,this._curStencilCompareMask),this._isStateInvalied=!1},e}(Ij),zj=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).numDrawCalls=0,e.numInstances=0,e.numTris=0,e}s(e,t);var i=e.prototype;return i.initialize=function(t){return this._type=t.type,!0},i.destroy=function(){},i.submit=function(t,e){if(!this._isAsync)for(var i=0;i<t.length;i++){var r=t[i];this.numDrawCalls+=r.numDrawCalls,this.numInstances+=r.numInstances,this.numTris+=r.numTris}e&&e.insert()},i.clear=function(){this.numDrawCalls=0,this.numInstances=0,this.numTris=0},e}(Ru),Gj=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuRenderPass=null,e}s(e,t);var i=e.prototype;return i.initialize=function(t){return this._colorInfos=t.colorAttachments,this._depthStencilInfo=t.depthStencilAttachment,t.subPasses&&(this._subPasses=t.subPasses),this._gpuRenderPass={colorAttachments:this._colorInfos,depthStencilAttachment:this._depthStencilInfo},this._hash=this.computeHash(),!0},i.destroy=function(){this._gpuRenderPass=null},r(e,[{key:"gpuRenderPass",get:function(){return this._gpuRenderPass}}]),e}(Bu),Hj=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuSampler=null,e}s(e,t);var i=e.prototype;return i.initialize=function(t){var e,i,r,n;return this._minFilter=t.minFilter,this._magFilter=t.magFilter,this._mipFilter=t.mipFilter,this._addressU=t.addressU,this._addressV=t.addressV,this._addressW=t.addressW,this._maxAnisotropy=t.maxAnisotropy,this._cmpFunc=t.cmpFunc,this._borderColor=t.borderColor,this._minLOD=t.minLOD,this._maxLOD=t.maxLOD,this._mipLODBias=t.mipLODBias,this._gpuSampler={glSampler:null,minFilter:this._minFilter,magFilter:this._magFilter,mipFilter:this._mipFilter,addressU:this._addressU,addressV:this._addressV,addressW:this._addressW,minLOD:this._minLOD,maxLOD:this._maxLOD,glMinFilter:0,glMagFilter:0,glWrapS:0,glWrapT:0,glWrapR:0},e=this._device,i=this._gpuSampler,(n=(r=e.gl).createSampler())&&(i.minFilter===ml.LINEAR||i.minFilter===ml.ANISOTROPIC?i.mipFilter===ml.LINEAR||i.mipFilter===ml.ANISOTROPIC?i.glMinFilter=r.LINEAR_MIPMAP_LINEAR:i.mipFilter===ml.POINT?i.glMinFilter=r.LINEAR_MIPMAP_NEAREST:i.glMinFilter=r.LINEAR:i.mipFilter===ml.LINEAR||i.mipFilter===ml.ANISOTROPIC?i.glMinFilter=r.NEAREST_MIPMAP_LINEAR:i.mipFilter===ml.POINT?i.glMinFilter=r.NEAREST_MIPMAP_NEAREST:i.glMinFilter=r.NEAREST,i.magFilter===ml.LINEAR||i.magFilter===ml.ANISOTROPIC?i.glMagFilter=r.LINEAR:i.glMagFilter=r.NEAREST,i.glWrapS=QW[i.addressU],i.glWrapT=QW[i.addressV],i.glWrapR=QW[i.addressW],i.glSampler=n,r.samplerParameteri(n,r.TEXTURE_MIN_FILTER,i.glMinFilter),r.samplerParameteri(n,r.TEXTURE_MAG_FILTER,i.glMagFilter),r.samplerParameteri(n,r.TEXTURE_WRAP_S,i.glWrapS),r.samplerParameteri(n,r.TEXTURE_WRAP_T,i.glWrapT),r.samplerParameteri(n,r.TEXTURE_WRAP_R,i.glWrapR),r.samplerParameterf(n,r.TEXTURE_MIN_LOD,i.minLOD),r.samplerParameterf(n,r.TEXTURE_MAX_LOD,i.maxLOD)),!0},i.destroy=function(){var t,e;this._gpuSampler&&(t=this._device,(e=this._gpuSampler).glSampler&&(t.gl.deleteSampler(e.glSampler),e.glSampler=null),this._gpuSampler=null)},r(e,[{key:"gpuSampler",get:function(){return this._gpuSampler}}]),e}(Nu),Vj=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuShader=null,e}s(e,t);var i=e.prototype;return i.initialize=function(t){this._name=t.name,this._stages=t.stages,this._attributes=t.attributes,this._blocks=t.blocks,this._samplers=t.samplers,this._gpuShader={name:t.name,blocks:t.blocks,samplers:t.samplers,gpuStages:new Array(t.stages.length),glProgram:null,glInputs:[],glUniforms:[],glBlocks:[],glSamplers:[]};for(var e=0;e<t.stages.length;++e){var i=t.stages[e];this._gpuShader.gpuStages[e]={type:i.stage,source:i.source,glShader:null}}return function(t,e){for(var i=t.gl,r=function(t){var r=e.gpuStages[t],n=0,s="",a=1;switch(r.type){case Sl.VERTEX:s="VertexShader",n=i.VERTEX_SHADER;break;case Sl.FRAGMENT:s="FragmentShader",n=i.FRAGMENT_SHADER;break;default:return console.error("Unsupported ShaderType."),{v:void 0}}var o=i.createShader(n);if(o&&(r.glShader=o,i.shaderSource(r.glShader,"#version 300 es\n"+r.source),i.compileShader(r.glShader),!i.getShaderParameter(r.glShader,i.COMPILE_STATUS))){console.error(s+" in '"+e.name+"' compilation failed."),console.error("Shader source dump:",r.source.replace(/^|\n/g,(function(){return"\n"+a+++" "}))),console.error(i.getShaderInfoLog(r.glShader));for(var h=0;h<e.gpuStages.length;h++){var l=e.gpuStages[t];l.glShader&&(i.deleteShader(l.glShader),l.glShader=null)}return{v:void 0}}},n=0;n<e.gpuStages.length;n++){var s=r(n);if("object"==typeof s)return s.v}var a=i.createProgram();if(a){e.glProgram=a;for(var o=0;o<e.gpuStages.length;o++){var h=e.gpuStages[o];i.attachShader(e.glProgram,h.glShader)}i.linkProgram(e.glProgram);for(var l=0;l<e.gpuStages.length;l++){var u=e.gpuStages[l];u.glShader&&(i.detachShader(e.glProgram,u.glShader),i.deleteShader(u.glShader),u.glShader=null)}if(!i.getProgramParameter(e.glProgram,i.LINK_STATUS))return console.error("Failed to link shader '"+e.name+"'."),void console.error(i.getProgramInfoLog(e.glProgram));console.info("Shader '"+e.name+"' compilation succeeded.");var c=i.getProgramParameter(e.glProgram,i.ACTIVE_ATTRIBUTES);e.glInputs=new Array(c);for(var _=0;_<c;++_){var d=i.getActiveAttrib(e.glProgram,_);if(d){var p,f=d.name.indexOf("[");p=-1!==f?d.name.substr(0,f):d.name;var m=i.getAttribLocation(e.glProgram,p),g=nj(d.type,i),v=sj(d.type,i);e.glInputs[_]={name:p,type:g,stride:v,count:d.size,size:v*d.size,glType:d.type,glLoc:m}}}var y,T,E,b,A=i.getProgramParameter(e.glProgram,i.ACTIVE_UNIFORM_BLOCKS);if(A){e.glBlocks=new Array(A);for(var C=0;C<A;++C){var w=(y=i.getActiveUniformBlockName(e.glProgram,C)).indexOf("[");-1!==w&&(y=y.substr(0,w)),b=null;for(var R=0;R<e.blocks.length;R++)if(e.blocks[R].name===y){b=e.blocks[R];break}if(b){T=C,E=i.getActiveUniformBlockParameter(e.glProgram,T,i.UNIFORM_BLOCK_DATA_SIZE);var x=b.binding+(t.bindingMappingInfo.bufferOffsets[b.set]||0);i.uniformBlockBinding(e.glProgram,T,x),e.glBlocks[C]={set:b.set,binding:b.binding,idx:T,name:y,size:E,glBinding:x}}else S("Block '"+y+"' does not bound")}}if(e.samplers.length>0){e.glSamplers=new Array(e.samplers.length);for(var O=0;O<e.samplers.length;++O){var I=e.samplers[O];e.glSamplers[O]={set:I.set,binding:I.binding,name:I.name,type:I.type,count:I.count,units:[],glUnits:null,glType:rj(I.type,i),glLoc:null}}}for(var M=[],B=[],P=t.bindingMappingInfo,N=t.stateCache.texUnitCacheMap,L=0,F=0;F<e.blocks.length;++F)e.blocks[F].set===P.flexibleSet&&L++;for(var D=0,U=0;U<e.samplers.length;++U){var k=e.samplers[U],z=i.getUniformLocation(e.glProgram,k.name);if(null===z||"number"!=typeof z&&-1===z.id||(M.push(e.glSamplers[U]),B.push(z)),void 0===N[k.name]){var G=k.binding+P.samplerOffsets[k.set]+D;k.set===P.flexibleSet&&(G-=L),N[k.name]=G%t.maxTextureUnits,D+=k.count-1}}if(M.length){for(var H=[],V=0;V<M.length;++V){var W=M[V],j=N[W.name];if(void 0!==j){W.glLoc=B[V];for(var X=0;X<W.count;++X){for(;H[j];)j=(j+1)%t.maxTextureUnits;W.units.push(j),H[j]=!0}}}for(var Y=0,q=0;q<M.length;++q){var K=M[q];if(!K.glLoc){for(K.glLoc=B[q];H[Y];)Y++;for(var Z=0;Z<K.count;++Z){for(;H[Y];)Y=(Y+1)%t.maxTextureUnits;void 0===N[K.name]&&(N[K.name]=Y),K.units.push(Y),H[Y]=!0}}}t.stateCache.glProgram!==e.glProgram&&i.useProgram(e.glProgram);for(var Q=0;Q<M.length;Q++){var J=M[Q];J.glUnits=new Int32Array(J.units),i.uniform1iv(J.glLoc,J.glUnits)}t.stateCache.glProgram!==e.glProgram&&i.useProgram(t.stateCache.glProgram)}e.glSamplers=M}}(this._device,this._gpuShader),!0},i.destroy=function(){var t,e;this._gpuShader&&(t=this._device,(e=this._gpuShader).glProgram&&(t.gl.deleteProgram(e.glProgram),e.glProgram=null),this._gpuShader=null)},r(e,[{key:"gpuShader",get:function(){return this._gpuShader}}]),e}(zu),Wj=function(){function t(){this.glArrayBuffer=null,this.glElementArrayBuffer=null,this.glUniformBuffer=null,this.glBindUBOs=[],this.glBindUBOOffsets=[],this.glVAO=null,this.texUnit=0,this.glTexUnits=[],this.glSamplerUnits=[],this.glRenderbuffer=null,this.glFramebuffer=null,this.glReadFramebuffer=null,this.viewport=new _u,this.scissorRect=new cu(0,0,0,0),this.rs=new yu,this.dss=new Tu,this.bs=new Su,this.glProgram=null,this.glEnabledAttribLocs=[],this.glCurrentAttribLocs=[],this.texUnitCacheMap={}}return t.prototype.initialize=function(t,e,i){for(var r=0;r<t;++r)this.glTexUnits.push({glTexture:null});this.glSamplerUnits.length=t,this.glSamplerUnits.fill(null),this.glBindUBOs.length=e,this.glBindUBOs.fill(null),this.glBindUBOOffsets.length=e,this.glBindUBOOffsets.fill(0),this.glEnabledAttribLocs.length=i,this.glEnabledAttribLocs.fill(!1),this.glCurrentAttribLocs.length=i,this.glCurrentAttribLocs.fill(!1)},t}(),jj=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuTexture=null,e}s(e,t);var i=e.prototype;return i.initialize=function(t){return"texture"in t?(console.log("WebGL2 does not support texture view."),!1):(this._type=t.type,this._usage=t.usage,this._format=t.format,this._width=t.width,this._height=t.height,this._depth=t.depth,this._layerCount=t.layerCount,this._levelCount=t.levelCount,this._samples=t.samples,this._flags=t.flags,this._isPowerOf2=Vu(this._width)&&Vu(this._height),this._size=Hl(this._format,this.width,this.height,this.depth,this._levelCount)*this._layerCount,this._flags&El.BAKUP_BUFFER&&(this._buffer=new ArrayBuffer(this._size)),this._gpuTexture={type:this._type,format:this._format,usage:this._usage,width:this._width,height:this._height,depth:this._depth,size:this._size,arrayLayer:this._layerCount,mipLevel:this._levelCount,samples:this._samples,flags:this._flags,isPowerOf2:this._isPowerOf2,glTarget:0,glInternalFmt:0,glFormat:0,glType:0,glUsage:0,glTexture:null,glRenderbuffer:null,glWrapS:0,glWrapT:0,glMinFilter:0,glMagFilter:0},function(t,e){var i=t.gl;e.glInternalFmt=ej(e.format,i),e.glFormat=ij(e.format,i),e.glType=tj(e.format,i);var r=e.width,n=e.height;switch(e.type){case vl.TEX2D:e.glTarget=i.TEXTURE_2D;var s=Math.max(r,n);if(s>t.maxTextureSize&&B(9100,s,t.maxTextureSize),e.samples===Tl.X1){var a=i.createTexture();if(a&&e.size>0){e.glTexture=a;var o=t.stateCache.glTexUnits[t.stateCache.texUnit];if(o.glTexture!==e.glTexture&&(i.bindTexture(i.TEXTURE_2D,e.glTexture),o.glTexture=e.glTexture),zl[e.format].isCompressed)if(e.glInternalFmt!==$V.COMPRESSED_RGB_ETC1_WEBGL)for(var h=0;h<e.mipLevel;++h){var l=Gl(e.format,r,n,1),u=new Uint8Array(l);i.compressedTexImage2D(i.TEXTURE_2D,h,e.glInternalFmt,r,n,0,u),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}else{var c=Gl(e.format,2,2,1),_=new Uint8Array(c);i.compressedTexImage2D(i.TEXTURE_2D,0,e.glInternalFmt,2,2,0,_)}else for(var d=0;d<e.mipLevel;++d)i.texImage2D(i.TEXTURE_2D,d,e.glInternalFmt,r,n,0,e.glFormat,e.glType,null),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}else i.deleteTexture(a)}else{var p=i.createRenderbuffer();p&&e.size>0&&(e.glRenderbuffer=p,t.stateCache.glRenderbuffer!==e.glRenderbuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glRenderbuffer),t.stateCache.glRenderbuffer=e.glRenderbuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,JW[e.samples],e.glInternalFmt,e.width,e.height))}break;case vl.CUBE:e.glTarget=i.TEXTURE_CUBE_MAP;var f=Math.max(r,n);f>t.maxCubeMapTextureSize&&B(9100,f,t.maxTextureSize);var m=i.createTexture();if(m&&e.size>0){e.glTexture=m;var g=t.stateCache.glTexUnits[t.stateCache.texUnit];if(g.glTexture!==e.glTexture&&(i.bindTexture(i.TEXTURE_CUBE_MAP,e.glTexture),g.glTexture=e.glTexture),zl[e.format].isCompressed)if(e.glInternalFmt!==$V.COMPRESSED_RGB_ETC1_WEBGL)for(var v=0;v<6;++v){r=e.width,n=e.height;for(var y=0;y<e.mipLevel;++y){var T=Gl(e.format,r,n,1),E=new Uint8Array(T);i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+v,y,e.glInternalFmt,r,n,0,E),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}}else for(var S=0;S<6;++S){var b=Gl(e.format,2,2,1),A=new Uint8Array(b);i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+S,0,e.glInternalFmt,2,2,0,A)}else for(var C=0;C<6;++C){r=e.width,n=e.height;for(var w=0;w<e.mipLevel;++w)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+C,w,e.glInternalFmt,r,n,0,e.glFormat,e.glType,null),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}}break;default:console.error("Unsupported TextureType, create texture failed."),e.type=vl.TEX2D,e.glTarget=i.TEXTURE_2D}}(this._device,this._gpuTexture),this._device.memoryStatus.textureSize+=this._size,!0)},i.destroy=function(){var t,e;this._gpuTexture&&(t=this._device,(e=this._gpuTexture).glTexture&&(t.gl.deleteTexture(e.glTexture),e.glTexture=null),e.glRenderbuffer&&(t.gl.deleteRenderbuffer(e.glRenderbuffer),e.glRenderbuffer=null),this._device.memoryStatus.textureSize-=this._size,this._gpuTexture=null),this._buffer=null},i.resize=function(t,e){var i=this._size;this._width=t,this._height=e,this._size=Hl(this._format,this.width,this.height,this.depth,this._levelCount)*this._layerCount,this._gpuTexture&&(this._gpuTexture.width=t,this._gpuTexture.height=e,this._gpuTexture.size=this._size,function(t,e){var i=t.gl;e.glInternalFmt=ej(e.format,i),e.glFormat=ij(e.format,i),e.glType=tj(e.format,i);var r=e.width,n=e.height;switch(e.type){case vl.TEX2D:e.glTarget=i.TEXTURE_2D;var s=Math.max(r,n);if(s>t.maxTextureSize&&B(9100,s,t.maxTextureSize),e.samples===Tl.X1){var a=t.stateCache.glTexUnits[t.stateCache.texUnit];if(a.glTexture!==e.glTexture&&(i.bindTexture(i.TEXTURE_2D,e.glTexture),a.glTexture=e.glTexture),zl[e.format].isCompressed){if(e.glInternalFmt!==$V.COMPRESSED_RGB_ETC1_WEBGL)for(var o=0;o<e.mipLevel;++o){var h=Gl(e.format,r,n,1),l=new Uint8Array(h);i.compressedTexImage2D(i.TEXTURE_2D,o,e.glInternalFmt,r,n,0,l),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}}else for(var u=0;u<e.mipLevel;++u)i.texImage2D(i.TEXTURE_2D,u,e.glInternalFmt,r,n,0,e.glFormat,e.glType,null),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}else{var c=i.createRenderbuffer();c&&e.size>0&&(e.glRenderbuffer=c,t.stateCache.glRenderbuffer!==e.glRenderbuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glRenderbuffer),t.stateCache.glRenderbuffer=e.glRenderbuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,JW[e.samples],e.glInternalFmt,e.width,e.height))}break;case vl.CUBE:e.type=vl.CUBE,e.glTarget=i.TEXTURE_CUBE_MAP;var _=Math.max(r,n);_>t.maxCubeMapTextureSize&&B(9100,_,t.maxTextureSize);var d=t.stateCache.glTexUnits[t.stateCache.texUnit];if(d.glTexture!==e.glTexture&&(i.bindTexture(i.TEXTURE_CUBE_MAP,e.glTexture),d.glTexture=e.glTexture),zl[e.format].isCompressed){if(e.glInternalFmt!==$V.COMPRESSED_RGB_ETC1_WEBGL)for(var p=0;p<6;++p){r=e.width,n=e.height;for(var f=0;f<e.mipLevel;++f){var m=Gl(e.format,r,n,1),g=new Uint8Array(m);i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+p,f,e.glInternalFmt,r,n,0,g),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}}}else for(var v=0;v<6;++v){r=e.width,n=e.height;for(var y=0;y<e.mipLevel;++y)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+v,y,e.glInternalFmt,r,n,0,e.glFormat,e.glType,null),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}break;default:console.error("Unsupported TextureType, create texture failed."),e.type=vl.TEX2D,e.glTarget=i.TEXTURE_2D}}(this._device,this._gpuTexture),this._device.memoryStatus.textureSize-=i,this._device.memoryStatus.textureSize+=this._size)},r(e,[{key:"gpuTexture",get:function(){return this._gpuTexture}}]),e}(Wu),Xj=t("WebGL2Device",function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).stateCache=new Wj,e.cmdAllocator=new Oj,e.nullTex2D=null,e.nullTexCube=null,e._webGL2RC=null,e._isAntialias=!0,e._isPremultipliedAlpha=!0,e._useVAO=!0,e._bindingMappingInfo=new tu,e._webGLContextLostHandler=null,e._extensions=null,e._EXT_texture_filter_anisotropic=null,e._OES_texture_float_linear=null,e._OES_texture_half_float_linear=null,e._EXT_color_buffer_float=null,e._EXT_disjoint_timer_query_webgl2=null,e._WEBGL_compressed_texture_etc1=null,e._WEBGL_compressed_texture_etc=null,e._WEBGL_compressed_texture_pvrtc=null,e._WEBGL_compressed_texture_astc=null,e._WEBGL_compressed_texture_s3tc=null,e._WEBGL_compressed_texture_s3tc_srgb=null,e._WEBGL_debug_renderer_info=null,e._WEBGL_texture_storage_multisample=null,e._WEBGL_debug_shaders=null,e._WEBGL_lose_context=null,e}s(e,t);var i=e.prototype;return i.initialize=function(t){this._canvas=t.canvasElm,this._isAntialias=t.isAntialias,this._isPremultipliedAlpha=t.isPremultipliedAlpha,this._bindingMappingInfo=t.bindingMappingInfo,this._bindingMappingInfo.bufferOffsets.length||this._bindingMappingInfo.bufferOffsets.push(0),this._bindingMappingInfo.samplerOffsets.length||this._bindingMappingInfo.samplerOffsets.push(0);try{var e={alpha:Ut.ENABLE_TRANSPARENT_CANVAS,antialias:this._isAntialias,depth:!0,stencil:!0,premultipliedAlpha:this._isPremultipliedAlpha,preserveDrawingBuffer:!1,powerPreference:"default",failIfMajorPerformanceCaveat:!1};this._webGL2RC=this._canvas.getContext("webgl2",e)}catch(t){return console.warn(t),!1}if(!this._webGL2RC)return console.warn("This device does not support WebGL2."),!1;this._webGLContextLostHandler=this._onWebGLContextLost.bind(this),this._canvas.addEventListener("webglcontextlost",this._onWebGLContextLost),this._canvas2D=document.createElement("canvas"),console.info("WebGL2 device initialized."),this._gfxAPI=Nl.WEBGL2,this._deviceName="WebGL2";var i=this._webGL2RC;this._WEBGL_debug_renderer_info=this.getExtension("WEBGL_debug_renderer_info"),this._WEBGL_debug_renderer_info?(this._renderer=i.getParameter(this._WEBGL_debug_renderer_info.UNMASKED_RENDERER_WEBGL),this._vendor=i.getParameter(this._WEBGL_debug_renderer_info.UNMASKED_VENDOR_WEBGL)):(this._renderer=i.getParameter(i.RENDERER),this._vendor=i.getParameter(i.VENDOR)),this._version=i.getParameter(i.VERSION),this._maxVertexAttributes=i.getParameter(i.MAX_VERTEX_ATTRIBS),this._maxVertexUniformVectors=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),this._maxFragmentUniformVectors=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),this._maxTextureUnits=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),this._maxVertexTextureUnits=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._maxUniformBufferBindings=i.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS),this._maxUniformBlockSize=i.getParameter(i.MAX_UNIFORM_BLOCK_SIZE),this._maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this._maxCubeMapTextureSize=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),this._uboOffsetAlignment=i.getParameter(i.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this._depthBits=i.getParameter(i.DEPTH_BITS),this._stencilBits=i.getParameter(i.STENCIL_BITS),this.stateCache.initialize(this._maxTextureUnits,this._maxUniformBufferBindings,this._maxVertexAttributes),this._devicePixelRatio=t.devicePixelRatio||1,this._width=this._canvas.width,this._height=this._canvas.height,this._nativeWidth=Math.max(t.nativeWidth||this._width,0),this._nativeHeight=Math.max(t.nativeHeight||this._height,0),this._colorFmt=il.RGBA8,32===this._depthBits?8===this._stencilBits?this._depthStencilFmt=il.D32F_S8:this._depthStencilFmt=il.D32F:24===this._depthBits?8===this._stencilBits?this._depthStencilFmt=il.D24S8:this._depthStencilFmt=il.D24:8===this._stencilBits?this._depthStencilFmt=il.D16S8:this._depthStencilFmt=il.D16,this._extensions=i.getSupportedExtensions();var r="";if(this._extensions){for(var n,s=h(this._extensions);!(n=s()).done;)r+=n.value+" ";console.debug("EXTENSIONS: "+r)}this._EXT_texture_filter_anisotropic=this.getExtension("EXT_texture_filter_anisotropic"),this._EXT_color_buffer_float=this.getExtension("EXT_color_buffer_float"),this._EXT_disjoint_timer_query_webgl2=this.getExtension("EXT_disjoint_timer_query_webgl2"),this._OES_texture_float_linear=this.getExtension("OES_texture_float_linear"),this._OES_texture_half_float_linear=this.getExtension("OES_texture_half_float_linear"),this._WEBGL_compressed_texture_etc1=this.getExtension("WEBGL_compressed_texture_etc1"),this._WEBGL_compressed_texture_etc=this.getExtension("WEBGL_compressed_texture_etc"),this._WEBGL_compressed_texture_pvrtc=this.getExtension("WEBGL_compressed_texture_pvrtc"),this._WEBGL_compressed_texture_astc=this.getExtension("WEBGL_compressed_texture_astc"),this._WEBGL_compressed_texture_s3tc=this.getExtension("WEBGL_compressed_texture_s3tc"),this._WEBGL_compressed_texture_s3tc_srgb=this.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this._WEBGL_texture_storage_multisample=this.getExtension("WEBGL_texture_storage_multisample"),this._WEBGL_debug_shaders=this.getExtension("WEBGL_debug_shaders"),this._WEBGL_lose_context=this.getExtension("WEBGL_lose_context"),this._features.fill(!1),this._features[Fl.TEXTURE_FLOAT]=!0,this._features[Fl.TEXTURE_HALF_FLOAT]=!0,this._features[Fl.FORMAT_R11G11B10F]=!0,this._features[Fl.FORMAT_RGB8]=!0,this._features[Fl.FORMAT_D16]=!0,this._features[Fl.FORMAT_D24]=!0,this._features[Fl.FORMAT_D32F]=!0,this._features[Fl.FORMAT_D24S8]=!0,this._features[Fl.FORMAT_D32FS8]=!0,this._features[Fl.MSAA]=!0,this._features[Fl.ELEMENT_INDEX_UINT]=!0,this._features[Fl.INSTANCED_ARRAYS]=!0,this._features[Fl.MULTIPLE_RENDER_TARGETS]=!0,this._features[Fl.BLEND_MINMAX]=!0,this._EXT_color_buffer_float&&(this._features[Fl.COLOR_FLOAT]=!0,this._features[Fl.COLOR_HALF_FLOAT]=!0),this._OES_texture_float_linear&&(this._features[Fl.TEXTURE_FLOAT_LINEAR]=!0),this._OES_texture_half_float_linear&&(this._features[Fl.TEXTURE_HALF_FLOAT_LINEAR]=!0);var a="";this._WEBGL_compressed_texture_etc1&&(this._features[Fl.FORMAT_ETC1]=!0,a+="etc1 "),this._WEBGL_compressed_texture_etc&&(this._features[Fl.FORMAT_ETC2]=!0,a+="etc2 "),this._WEBGL_compressed_texture_s3tc&&(this._features[Fl.FORMAT_DXT]=!0,a+="dxt "),this._WEBGL_compressed_texture_pvrtc&&(this._features[Fl.FORMAT_PVRTC]=!0,a+="pvrtc "),this._WEBGL_compressed_texture_astc&&(this._features[Fl.FORMAT_ASTC]=!0,a+="astc "),console.info("RENDERER: "+this._renderer),console.info("VENDOR: "+this._vendor),console.info("VERSION: "+this._version),console.info("DPR: "+this._devicePixelRatio),console.info("SCREEN_SIZE: "+this._width+" x "+this._height),console.info("NATIVE_SIZE: "+this._nativeWidth+" x "+this._nativeHeight),console.info("MAX_VERTEX_ATTRIBS: "+this._maxVertexAttributes),console.info("MAX_VERTEX_UNIFORM_VECTORS: "+this._maxVertexUniformVectors),console.info("MAX_FRAGMENT_UNIFORM_VECTORS: "+this._maxFragmentUniformVectors),console.info("MAX_TEXTURE_IMAGE_UNITS: "+this._maxTextureUnits),console.info("MAX_VERTEX_TEXTURE_IMAGE_UNITS: "+this._maxVertexTextureUnits),console.info("MAX_UNIFORM_BUFFER_BINDINGS: "+this._maxUniformBufferBindings),console.info("MAX_UNIFORM_BLOCK_SIZE: "+this._maxUniformBlockSize),console.info("DEPTH_BITS: "+this._depthBits),console.info("STENCIL_BITS: "+this._stencilBits),console.info("UNIFORM_BUFFER_OFFSET_ALIGNMENT: "+this._uboOffsetAlignment),this._EXT_texture_filter_anisotropic&&console.info("MAX_TEXTURE_MAX_ANISOTROPY_EXT: "+this._EXT_texture_filter_anisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT),console.info("USE_VAO: "+this._useVAO),console.info("COMPRESSED_FORMAT: "+a),this.initStates(i),this._queue=this.createQueue(new wu(Ml.GRAPHICS)),this._cmdBuff=this.createCommandBuffer(new Jl(this._queue)),this.nullTex2D=this.createTexture(new Gu(vl.TEX2D,yl.SAMPLED,il.RGBA8,2,2,El.GEN_MIPMAP)),this.nullTexCube=new jj(this),this.nullTexCube.initialize(new Gu(vl.TEX2D,yl.SAMPLED,il.RGBA8,2,2,El.CUBEMAP|El.GEN_MIPMAP,6));var o=new vu;o.texExtent.width=2,o.texExtent.height=2;var l=new Uint8Array(this.nullTex2D.size);return l.fill(0),this.copyBuffersToTexture([l],this.nullTex2D,[o]),o.texSubres.layerCount=6,this.copyBuffersToTexture([l,l,l,l,l,l],this.nullTexCube,[o]),!0},i.destroy=function(){this._canvas&&this._webGLContextLostHandler&&(this._canvas.removeEventListener("webglcontextlost",this._webGLContextLostHandler),this._webGLContextLostHandler=null),this.nullTex2D&&(this.nullTex2D.destroy(),this.nullTex2D=null),this.nullTexCube&&(this.nullTexCube.destroy(),this.nullTexCube=null),this._queue&&(this._queue.destroy(),this._queue=null),this._cmdBuff&&(this._cmdBuff.destroy(),this._cmdBuff=null),this._extensions=null,this._webGL2RC=null},i.resize=function(t,e){this._width===t&&this._height===e||(console.info("Resizing device: "+t+"x"+e),this._canvas.width=t,this._canvas.height=e,this._width=t,this._height=e)},i.acquire=function(){this.cmdAllocator.releaseCmds()},i.present=function(){var t=this._queue;this._numDrawCalls=t.numDrawCalls,this._numInstances=t.numInstances,this._numTris=t.numTris,t.clear()},i.createCommandBuffer=function(t){var e=new(t.type===Al.PRIMARY?kj:Ij)(this);return e.initialize(t)?e:null},i.createBuffer=function(t){var e=new Rj(this);return e.initialize(t)?e:null},i.createTexture=function(t){var e=new jj(this);return e.initialize(t)?e:null},i.createSampler=function(t){var e=new Hj(this);return e.initialize(t)?e:null},i.createDescriptorSet=function(t){var e=new ZW(this);return e.initialize(t)?e:null},i.createShader=function(t){var e=new Vj(this);return e.initialize(t)?e:null},i.createInputAssembler=function(t){var e=new Pj(this);return e.initialize(t)?e:null},i.createRenderPass=function(t){var e=new Gj(this);return e.initialize(t)?e:null},i.createFramebuffer=function(t){var e=new Bj(this);return e.initialize(t)?e:null},i.createDescriptorSetLayout=function(t){var e=new Nj(this);return e.initialize(t)?e:null},i.createPipelineLayout=function(t){var e=new Lj(this);return e.initialize(t)?e:null},i.createPipelineState=function(t){var e=new Dj(this);return e.initialize(t)?e:null},i.createFence=function(t){var e=new Mj(this);return e.initialize(t)?e:null},i.createQueue=function(t){var e=new zj(this);return e.initialize(t)?e:null},i.copyBuffersToTexture=function(t,e,i){wj(this,t,e.gpuTexture,i)},i.copyTexImagesToTexture=function(t,e,i){!function(t,e,i,r){var n=t.gl,s=t.stateCache.glTexUnits[t.stateCache.texUnit];s.glTexture!==i.glTexture&&(n.bindTexture(i.glTarget,i.glTexture),s.glTexture=i.glTexture);var a=0,o=0;switch(i.glTarget){case n.TEXTURE_2D:for(var h=0;h<r.length;h++){var l=r[h];n.texSubImage2D(n.TEXTURE_2D,l.texSubres.mipLevel,l.texOffset.x,l.texOffset.y,i.glFormat,i.glType,e[a++])}break;case n.TEXTURE_CUBE_MAP:for(var u=0;u<r.length;u++){var c=r[u],_=c.texSubres.baseArrayLayer+c.texSubres.layerCount;for(o=c.texSubres.baseArrayLayer;o<_;++o)n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+o,c.texSubres.mipLevel,c.texOffset.x,c.texOffset.y,i.glFormat,i.glType,e[a++])}break;default:console.error("Unsupported GL texture type, copy buffer to texture failed.")}i.flags&El.GEN_MIPMAP&&n.generateMipmap(i.glTarget)}(this,t,e.gpuTexture,i)},i.copyFramebufferToBuffer=function(t,e,i){var r=this._webGL2RC,n=t.gpuFramebuffer,s=n.gpuColorTextures[0].format,a=ij(s,r),o=tj(s,r),l=jl(zl[s]),u=this.stateCache.glFramebuffer;this.stateCache.glFramebuffer!==n.glFramebuffer&&(r.bindFramebuffer(r.FRAMEBUFFER,n.glFramebuffer),this.stateCache.glFramebuffer=n.glFramebuffer);for(var c,_=new l(e),d=h(i);!(c=d()).done;){var p=c.value,f=p.texExtent.width,m=p.texExtent.height;r.readPixels(p.texOffset.x,p.texOffset.y,f,m,a,o,_)}this.stateCache.glFramebuffer!==u&&(r.bindFramebuffer(r.FRAMEBUFFER,u),this.stateCache.glFramebuffer=u)},i.blitFramebuffer=function(t,e,i,r,n){!function(t,e,i,r,n,s){var a=t.gl;t.stateCache.glReadFramebuffer!==e.glFramebuffer&&(a.bindFramebuffer(a.READ_FRAMEBUFFER,e.glFramebuffer),t.stateCache.glReadFramebuffer=e.glFramebuffer);var o=i.glFramebuffer!==t.stateCache.glFramebuffer;o&&a.bindFramebuffer(a.DRAW_FRAMEBUFFER,i.glFramebuffer);var h=0;e.gpuColorTextures.length>0&&(h|=a.COLOR_BUFFER_BIT),e.gpuDepthStencilTexture&&(h|=a.DEPTH_BUFFER_BIT,zl[e.gpuDepthStencilTexture.format].hasStencil&&(h|=a.STENCIL_BUFFER_BIT));var l=s===ml.LINEAR||s===ml.ANISOTROPIC?a.LINEAR:a.NEAREST;a.blitFramebuffer(r.x,r.y,r.x+r.width,r.y+r.height,n.x,n.y,n.x+n.width,n.y+n.height,h,l),o&&a.bindFramebuffer(a.FRAMEBUFFER,t.stateCache.glFramebuffer)}(this,t.gpuFramebuffer,e.gpuFramebuffer,i,r,n)},i.getExtension=function(t){for(var e=["","WEBKIT_","MOZ_"],i=0;i<e.length;++i){var r=this.gl.getExtension(e[i]+t);if(r)return r}return null},i.initStates=function(t){t.activeTexture(t.TEXTURE0),t.pixelStorei(t.PACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.bindFramebuffer(t.FRAMEBUFFER,null),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.enable(t.DEPTH_TEST),t.depthMask(!0),t.depthFunc(t.LESS),t.stencilFuncSeparate(t.FRONT,t.ALWAYS,1,65535),t.stencilOpSeparate(t.FRONT,t.KEEP,t.KEEP,t.KEEP),t.stencilMaskSeparate(t.FRONT,65535),t.stencilFuncSeparate(t.BACK,t.ALWAYS,1,65535),t.stencilOpSeparate(t.BACK,t.KEEP,t.KEEP,t.KEEP),t.stencilMaskSeparate(t.BACK,65535),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.disable(t.BLEND),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.colorMask(!0,!0,!0,!0),t.blendColor(0,0,0,0)},i._onWebGLContextLost=function(t){I(11e3),E(t)},r(e,[{key:"gl",get:function(){return this._webGL2RC}},{key:"isAntialias",get:function(){return this._isAntialias}},{key:"isPremultipliedAlpha",get:function(){return this._isPremultipliedAlpha}},{key:"useVAO",get:function(){return this._useVAO}},{key:"bindingMappingInfo",get:function(){return this._bindingMappingInfo}},{key:"EXT_texture_filter_anisotropic",get:function(){return this._EXT_texture_filter_anisotropic}},{key:"OES_texture_float_linear",get:function(){return this._OES_texture_float_linear}},{key:"EXT_color_buffer_float",get:function(){return this._EXT_color_buffer_float}},{key:"EXT_disjoint_timer_query_webgl2",get:function(){return this._EXT_disjoint_timer_query_webgl2}},{key:"WEBGL_compressed_texture_etc1",get:function(){return this._WEBGL_compressed_texture_etc1}},{key:"WEBGL_compressed_texture_etc",get:function(){return this._WEBGL_compressed_texture_etc}},{key:"WEBGL_compressed_texture_pvrtc",get:function(){return this._WEBGL_compressed_texture_pvrtc}},{key:"WEBGL_compressed_texture_s3tc",get:function(){return this._WEBGL_compressed_texture_s3tc}},{key:"WEBGL_compressed_texture_s3tc_srgb",get:function(){return this._WEBGL_compressed_texture_s3tc_srgb}},{key:"WEBGL_texture_storage_multisample",get:function(){return this._WEBGL_texture_storage_multisample}},{key:"WEBGL_debug_shaders",get:function(){return this._WEBGL_debug_shaders}},{key:"WEBGL_lose_context",get:function(){return this._WEBGL_lose_context}}]),e}(iu));function Yj(t,e,i,r){var n=(r.x-i.x)*(t.y-i.y)-(r.y-i.y)*(t.x-i.x),s=(e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x),a=(r.y-i.y)*(e.x-t.x)-(r.x-i.x)*(e.y-t.y);if(0!==a){var o=n/a,h=s/a;if(0<=o&&o<=1&&0<=h&&h<=1)return!0}return!1}_.WebGL2Device=Xj;var qj=new Es,Kj=new Es,Zj=new Es,Qj=new Es;function Jj(t,e,i){for(var r=i.length,n=0;n<r;++n)if(Yj(t,e,i[n],i[(n+1)%r]))return!0;return!1}function $j(t,e){for(var i=!1,r=t.x,n=t.y,s=e.length,a=0,o=s-1;a<s;o=a++){var h=e[a].x,l=e[a].y,u=e[o].x,c=e[o].y;l>n!=c>n&&r<(u-h)*(n-l)/(c-l)+h&&(i=!i)}return i}function tX(t,e,i,r){var n,s=i.x-e.x,a=i.y-e.y,o=s*s+a*a,h=((t.x-e.x)*s+(t.y-e.y)*a)/o;return n=r?o?h<0?e:h>1?i:qj.set(e.x+h*s,e.y+h*a):e:qj.set(e.x+h*s,e.y+h*a),s=t.x-n.x,a=t.y-n.y,Math.sqrt(s*s+a*a)}var eX=t("Intersection2D",(function(){}));eX.lineLine=Yj,eX.lineRect=function(t,e,i){var r=qj.set(i.x,i.y),n=Kj.set(i.x,i.yMax),s=Zj.set(i.xMax,i.yMax),a=Qj.set(i.xMax,i.y);return!!(Yj(t,e,r,n)||Yj(t,e,n,s)||Yj(t,e,s,a)||Yj(t,e,a,r))},eX.linePolygon=Jj,eX.rectRect=function(t,e){var i=t.x,r=t.y,n=t.x+t.width,s=t.y+t.height,a=e.x,o=e.y,h=e.x+e.width,l=e.y+e.height;return i<=h&&n>=a&&r<=l&&s>=o},eX.rectPolygon=function(t,e){var i=qj.set(t.x,t.y),r=Kj.set(t.x,t.yMax),n=Zj.set(t.xMax,t.yMax),s=Qj.set(t.xMax,t.y);if(Jj(i,r,e))return!0;if(Jj(r,n,e))return!0;if(Jj(n,s,e))return!0;if(Jj(s,i,e))return!0;for(var a=0,o=e.length;a<o;++a)if(t.contains(e[a]))return!0;return!!($j(i,e)||$j(r,e)||$j(n,e)||$j(s,e))},eX.rectCircle=function(t,e,i){var r=e.x,n=e.y,s=t.x,a=t.y,o=t.width,h=t.height,l=r,u=n;r<s?l=s:r>s+o&&(l=s+o),n<a?u=a:n>a+h&&(u=a+h);var c=r-l,_=n-u;return Math.sqrt(c*c+_*_)<=i},eX.polygonPolygon=function(t,e){var i,r;for(i=0,r=t.length;i<r;++i)if(Jj(t[i],t[(i+1)%r],e))return!0;for(i=0,r=e.length;i<r;++i)if($j(e[i],t))return!0;for(i=0,r=t.length;i<r;++i)if($j(t[i],e))return!0;return!1},eX.circleCircle=function(t,e,i,r){return Es.distance(t,i)<e+r},eX.polygonCircle=function(t,e,i){var r=e;if($j(r,t))return!0;for(var n=0,s=t.length;n<s;n++)if(tX(r,0===n?t[t.length-1]:t[n-1],t[n],!0)<i)return!0;return!1},eX.pointInPolygon=$j,eX.pointLineDistance=tX;var iX,rX,nX,sX,aX=Pt({GRAVITY:0,RADIUS:1}),oX=Pt({FREE:0,RELATIVE:1,GROUPED:2}),hX=new Es(0,0),lX=new Es,uX=new Es,cX=new Es,_X=new Es,dX=TF(vF),pX=function(){this.pos=new Es(0,0),this.startPos=new Es(0,0),this.color=new Qs(0,0,0,255),this.deltaColor={r:0,g:0,b:0,a:255},this.size=0,this.deltaSize=0,this.rotation=0,this.deltaRotation=0,this.timeToLive=0,this.drawPos=new Es(0,0),this.aspectRatio=1,this.dir=new Es(0,0),this.radialAccel=0,this.tangentialAccel=0,this.angle=0,this.degreesPerSecond=0,this.radius=0,this.deltaRadius=0},fX=new(function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e.prototype.get=function(){return this._get()||new pX},e}(Ot))((function(t){t.pos.set(hX),t.startPos.set(hX),t.color._val=4278190080,t.deltaColor.r=t.deltaColor.g=t.deltaColor.b=0,t.deltaColor.a=255,t.size=0,t.deltaSize=0,t.rotation=0,t.deltaRotation=0,t.timeToLive=0,t.drawPos.set(hX),t.aspectRatio=1,t.dir.set(hX),t.radialAccel=0,t.tangentialAccel=0,t.angle=0,t.degreesPerSecond=0,t.radius=0,t.deltaRadius=0}),1024),mX=function(){function t(t){this.particles=[],this.active=!1,this.uvFilled=0,this.finished=!1,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this._worldRotation=0,this.sys=t,this.particles=[],this.active=!1,this.readyToPlay=!0,this.finished=!1,this.elapsed=0,this.emitCounter=0,this.uvFilled=0,this._worldRotation=0}var e=t.prototype;return e.stop=function(){this.active=!1,this.readyToPlay=!1,this.elapsed=this.sys.duration,this.emitCounter=0},e.reset=function(){this.active=!0,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this.finished=!1;for(var t=this.particles,e=0;e<t.length;++e)fX.put(t[e]);t.length=0},e.emitParticle=function(t){var e=this.sys,i=fX.get();this.particles.push(i),i.timeToLive=e.life+e.lifeVar*(Math.random()-.5)*2;var r=i.timeToLive=Math.max(0,i.timeToLive);i.pos.x=e.sourcePos.x+e.posVar.x*(Math.random()-.5)*2,i.pos.y=e.sourcePos.y+e.posVar.y*(Math.random()-.5)*2;var n,s,a,o,h=e.startColor,l=e.startColorVar,u=e.endColor,c=e.endColorVar;i.color.r=n=Zt(h.r+l.r*(Math.random()-.5)*2,0,255),i.color.g=s=Zt(h.g+l.g*(Math.random()-.5)*2,0,255),i.color.b=a=Zt(h.b+l.b*(Math.random()-.5)*2,0,255),i.color.a=o=Zt(h.a+l.a*(Math.random()-.5)*2,0,255),i.deltaColor.r=(Zt(u.r+c.r*(Math.random()-.5)*2,0,255)-n)/r,i.deltaColor.g=(Zt(u.g+c.g*(Math.random()-.5)*2,0,255)-s)/r,i.deltaColor.b=(Zt(u.b+c.b*(Math.random()-.5)*2,0,255)-a)/r,i.deltaColor.a=(Zt(u.a+c.a*(Math.random()-.5)*2,0,255)-o)/r;var _=e.startSize+e.startSizeVar*(Math.random()-.5)*2;if(_=Math.max(0,_),i.size=_,-1===e.endSize)i.deltaSize=0;else{var d=e.endSize+e.endSizeVar*(Math.random()-.5)*2;d=Math.max(0,d),i.deltaSize=(d-_)/r}var p=e.startSpin+e.startSpinVar*(Math.random()-.5)*2,f=e.endSpin+e.endSpinVar*(Math.random()-.5)*2;i.rotation=p,i.deltaRotation=(f-p)/r,i.startPos.x=t.x,i.startPos.y=t.y,i.aspectRatio=e.aspectRatio||1;var m=Qt(e.angle+this._worldRotation+e.angleVar*(Math.random()-.5)*2);if(e.emitterMode===aX.GRAVITY){var g=e.speed+e.speedVar*(Math.random()-.5)*2;i.dir.x=Math.cos(m),i.dir.y=Math.sin(m),i.dir.multiplyScalar(g),i.radialAccel=e.radialAccel+e.radialAccelVar*(Math.random()-.5)*2,i.tangentialAccel=e.tangentialAccel+e.tangentialAccelVar*(Math.random()-.5)*2,e.rotationIsDir&&(i.rotation=-Jt(Math.atan2(i.dir.y,i.dir.x)))}else{var v=e.startRadius+e.startRadiusVar*(Math.random()-.5)*2,y=e.endRadius+e.endRadiusVar*(Math.random()-.5)*2;i.radius=v,i.deltaRadius=-1===e.endRadius?0:(y-v)/r,i.angle=m,i.degreesPerSecond=Qt(e.rotatePerS+e.rotatePerSVar*(Math.random()-.5)*2)}},e.updateUVs=function(t){var e=this.renderData;if(e&&this.sys._renderSpriteFrame){for(var i=e.vData,r=this.sys._renderSpriteFrame.uv,n=t?0:this.uvFilled,s=this.particles.length,a=n;a<s;a++){var o=a*dX*4;i[o+3]=r[0],i[o+4]=r[1],i[o+12]=r[2],i[o+13]=r[3],i[o+21]=r[4],i[o+22]=r[5],i[o+30]=r[6],i[o+31]=r[7]}this.uvFilled=s}},e.updateParticleBuffer=function(t,e,i,r){var n=i.vData,s=e.x,a=e.y,o=t.size,h=o,l=t.aspectRatio;l>1?h=o/l:o=h*l;var u=o/2,c=h/2;if(t.rotation){var _=-u,d=-c,p=u,f=c,m=-Qt(t.rotation),g=Math.cos(m),v=Math.sin(m);n[r]=_*g-d*v+s,n[r+1]=_*v+d*g+a,n[r+2]=0,n[r+9]=p*g-d*v+s,n[r+10]=p*v+d*g+a,n[r+11]=0,n[r+18]=_*g-f*v+s,n[r+19]=_*v+f*g+a,n[r+20]=0,n[r+27]=p*g-f*v+s,n[r+28]=p*v+f*g+a,n[r+29]=0}else n[r]=s-u,n[r+1]=a-c,n[r+2]=0,n[r+9]=s+u,n[r+10]=a-c,n[r+11]=0,n[r+18]=s-u,n[r+19]=a+c,n[r+20]=0,n[r+27]=s+u,n[r+28]=a+c,n[r+29]=0;Qs.toArray(n,t.color,r+5),Qs.toArray(n,t.color,r+14),Qs.toArray(n,t.color,r+23),Qs.toArray(n,t.color,r+32)},e.step=function(t){var e=this.sys.assembler,i=this.sys,r=i.node,n=this.particles;if(t=t>e.maxParticleDeltaTime?e.maxParticleDeltaTime:t,r.updateWorldTransform(),i.positionType===oX.FREE){this._worldRotation=function(t){for(var e=0,i=t;i;)e+=i.eulerAngles.z,i=i.parent;return e}(r);var s=r.worldMatrix;lX.x=s.m12,lX.y=s.m13}else i.positionType===oX.RELATIVE?(this._worldRotation=r.eulerAngles.z,lX.x=r.position.x,lX.y=r.position.y):this._worldRotation=0;if(this.active&&i.emissionRate){var a=1/i.emissionRate;for(n.length<i.totalParticles&&(this.emitCounter+=t);n.length<i.totalParticles&&this.emitCounter>a;)this.emitParticle(lX),this.emitCounter-=a;this.elapsed+=t,-1!==i.duration&&i.duration<this.elapsed&&i.stopSystem()}var o=this.renderData,h=n.length;o.reset(),this.requestData(4*h,6*h),h>this.uvFilled&&this.updateUVs();for(var l=0;l<n.length;){uX.x=uX.y=cX.x=cX.y=_X.x=_X.y=0;var u=n[l];if(u.timeToLive-=t,u.timeToLive>0){if(i.emitterMode===aX.GRAVITY){var c=_X,_=uX,d=cX;(u.pos.x||u.pos.y)&&(_.set(u.pos),_.normalize()),d.set(_),_.multiplyScalar(u.radialAccel);var p=d.x;d.x=-d.y,d.y=p,d.multiplyScalar(u.tangentialAccel),c.set(_),c.add(d),c.add(i.gravity),c.multiplyScalar(t),u.dir.add(c),c.set(u.dir),c.multiplyScalar(t),u.pos.add(c)}else u.angle+=u.degreesPerSecond*t,u.radius+=u.deltaRadius*t,u.pos.x=-Math.cos(u.angle)*u.radius,u.pos.y=-Math.sin(u.angle)*u.radius;u.color.r+=u.deltaColor.r*t,u.color.g+=u.deltaColor.g*t,u.color.b+=u.deltaColor.b*t,u.color.a+=u.deltaColor.a*t,u.size+=u.deltaSize*t,u.size<0&&(u.size=0),u.rotation+=u.deltaRotation*t;var f=uX;f.set(u.pos),i.positionType!==oX.GROUPED&&f.add(u.startPos);var m=dX*l*4;this.updateParticleBuffer(u,f,o,m),++l}else{var g=n[l];l!==n.length-1&&(n[l]=n[n.length-1]),fX.put(g),n.length--}}n.length>0||this.active||this.readyToPlay||(this.finished=!0,i._finishedSimulation())},e.requestData=function(t,e){var i=this.renderData.indicesCount;this.renderData.request(t,e);for(var r=this.renderData.indicesCount/6,n=this.renderData.iData,s=i;s<r;s++){var a=4*s;n[i++]=a,n[i++]=a+1,n[i++]=a+2,n[i++]=a+1,n[i++]=a+3,n[i++]=a+2}},t}(),gX=t("ParticleAsset",Ne("cc.ParticleAsset")((sX=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"spriteFrame",nX,a(e)),e}return s(e,t),e}(Sr),nX=u((rX=sX).prototype,"spriteFrame",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),iX=rX))||iX);_.ParticleAsset=gX;
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */
var vX={};(function(){function t(t){throw t}var e=void 0,i=!0,r=this;function n(t,i){var n,s=t.split("."),a=r;!(s[0]in a)&&a.execScript&&a.execScript("var "+s[0]);for(;s.length&&(n=s.shift());)s.length||i===e?a=a[n]?a[n]:a[n]={}:a[n]=i}var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;function a(t){if("string"==typeof t){var e,i,r=t.split("");for(e=0,i=r.length;e<i;e++)r[e]=(255&r[e].charCodeAt(0))>>>0;t=r}for(var n,s=1,a=0,o=t.length,h=0;0<o;){o-=n=1024<o?1024:o;do{a+=s+=t[h++]}while(--n);s%=65521,a%=65521}return(a<<16|s)>>>0}function o(e,i){this.index="number"==typeof i?i:0,this.i=0,this.buffer=e instanceof(s?Uint8Array:Array)?e:new(s?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&t(Error("invalid index")),this.buffer.length<=this.index&&this.f()}o.prototype.f=function(){var t,e=this.buffer,i=e.length,r=new(s?Uint8Array:Array)(i<<1);if(s)r.set(e);else for(t=0;t<i;++t)r[t]=e[t];return this.buffer=r},o.prototype.d=function(t,e,i){var r,n=this.buffer,s=this.index,a=this.i,o=n[s];if(i&&1<e&&(t=8<e?(d[255&t]<<24|d[t>>>8&255]<<16|d[t>>>16&255]<<8|d[t>>>24&255])>>32-e:d[t]>>8-e),8>e+a)o=o<<e|t,a+=e;else for(r=0;r<e;++r)o=o<<1|t>>e-r-1&1,8==++a&&(a=0,n[s++]=d[o],o=0,s===n.length&&(n=this.f()));n[s]=o,this.buffer=n,this.i=a,this.index=s},o.prototype.finish=function(){var t,e=this.buffer,i=this.index;return 0<this.i&&(e[i]<<=8-this.i,e[i]=d[e[i]],i++),s?t=e.subarray(0,i):(e.length=i,t=e),t};var h,l=new(s?Uint8Array:Array)(256);for(h=0;256>h;++h){for(var u=_=h,c=7,_=_>>>1;_;_>>>=1)u<<=1,u|=1&_,--c;l[h]=(u<<c&255)>>>0}var d=l;function p(t){this.buffer=new(s?Uint16Array:Array)(2*t),this.length=0}function f(t){var e,i,r,n,a,o,h,l,u,c=t.length,_=0,d=Number.POSITIVE_INFINITY;for(l=0;l<c;++l)t[l]>_&&(_=t[l]),t[l]<d&&(d=t[l]);for(e=1<<_,i=new(s?Uint32Array:Array)(e),r=1,n=0,a=2;r<=_;){for(l=0;l<c;++l)if(t[l]===r){for(o=0,h=n,u=0;u<r;++u)o=o<<1|1&h,h>>=1;for(u=o;u<e;u+=a)i[u]=r<<16|l;++n}++r,n<<=1,a<<=1}return[i,_,d]}function m(t,e){this.h=v,this.w=0,this.input=t,this.b=0,e&&(e.lazy&&(this.w=e.lazy),"number"==typeof e.compressionType&&(this.h=e.compressionType),e.outputBuffer&&(this.a=s&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.b=e.outputIndex)),this.a||(this.a=new(s?Uint8Array:Array)(32768))}p.prototype.getParent=function(t){return 2*((t-2)/4|0)},p.prototype.push=function(t,e){var i,r,n,s=this.buffer;for(i=this.length,s[this.length++]=e,s[this.length++]=t;0<i&&(r=this.getParent(i),s[i]>s[r]);)n=s[i],s[i]=s[r],s[r]=n,n=s[i+1],s[i+1]=s[r+1],s[r+1]=n,i=r;return this.length},p.prototype.pop=function(){var t,e,i,r,n,s=this.buffer;for(e=s[0],t=s[1],this.length-=2,s[0]=s[this.length],s[1]=s[this.length+1],n=0;!((r=2*n+2)>=this.length)&&(r+2<this.length&&s[r+2]>s[r]&&(r+=2),s[r]>s[n]);)i=s[n],s[n]=s[r],s[r]=i,i=s[n+1],s[n+1]=s[r+1],s[r+1]=i,n=r;return{index:t,value:e,length:this.length}};var g,v=2,y={NONE:0,r:1,j:v,N:3},T=[];for(g=0;288>g;g++)switch(!0){case 143>=g:T.push([g+48,8]);break;case 255>=g:T.push([g-144+400,9]);break;case 279>=g:T.push([g-256+0,7]);break;case 287>=g:T.push([g-280+192,8]);break;default:t("invalid literal: "+g)}function E(t,e){this.length=t,this.G=e}function S(){var e=b;switch(!0){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:t("invalid length: "+e)}}m.prototype.n=function(){var r,n,a,h,l=this.input;switch(this.h){case 0:for(a=0,h=l.length;a<h;){var u,c,_,d=n=s?l.subarray(a,a+65535):l.slice(a,a+65535),p=(a+=n.length)===h,f=e,m=e,g=this.a,y=this.b;if(s){for(g=new Uint8Array(this.a.buffer);g.length<=y+d.length+5;)g=new Uint8Array(g.length<<1);g.set(this.a)}if(u=p?1:0,g[y++]=0|u,_=65536+~(c=d.length)&65535,g[y++]=255&c,g[y++]=c>>>8&255,g[y++]=255&_,g[y++]=_>>>8&255,s)g.set(d,y),y+=d.length,g=g.subarray(0,y);else{for(f=0,m=d.length;f<m;++f)g[y++]=d[f];g.length=y}this.b=y,this.a=g}break;case 1:var E=new o(new Uint8Array(this.a.buffer),this.b);E.d(1,1,i),E.d(1,2,i);var S,b,A,C=R(this,l);for(S=0,b=C.length;S<b;S++)if(A=C[S],o.prototype.d.apply(E,T[A]),256<A)E.d(C[++S],C[++S],i),E.d(C[++S],5),E.d(C[++S],C[++S],i);else if(256===A)break;this.a=E.finish(),this.b=this.a.length;break;case v:var w,I,M,B,P,N,L,F,D,U,k,z,G,H,V,W=new o(new Uint8Array(this.a),this.b),j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],X=Array(19);for(w=v,W.d(1,1,i),W.d(w,2,i),I=R(this,l),L=O(N=x(this.L,15)),D=O(F=x(this.K,7)),M=286;257<M&&0===N[M-1];M--);for(B=30;1<B&&0===F[B-1];B--);var Y,q,K,Z,Q,J,$=M,tt=B,et=new(s?Uint32Array:Array)($+tt),it=new(s?Uint32Array:Array)(316),rt=new(s?Uint8Array:Array)(19);for(Y=q=0;Y<$;Y++)et[q++]=N[Y];for(Y=0;Y<tt;Y++)et[q++]=F[Y];if(!s)for(Y=0,Z=rt.length;Y<Z;++Y)rt[Y]=0;for(Y=Q=0,Z=et.length;Y<Z;Y+=q){for(q=1;Y+q<Z&&et[Y+q]===et[Y];++q);if(K=q,0===et[Y])if(3>K)for(;0<K--;)it[Q++]=0,rt[0]++;else for(;0<K;)(J=138>K?K:138)>K-3&&J<K&&(J=K-3),10>=J?(it[Q++]=17,it[Q++]=J-3,rt[17]++):(it[Q++]=18,it[Q++]=J-11,rt[18]++),K-=J;else if(it[Q++]=et[Y],rt[et[Y]]++,3>--K)for(;0<K--;)it[Q++]=et[Y],rt[et[Y]]++;else for(;0<K;)(J=6>K?K:6)>K-3&&J<K&&(J=K-3),it[Q++]=16,it[Q++]=J-3,rt[16]++,K-=J}for(r=s?it.subarray(0,Q):it.slice(0,Q),U=x(rt,7),H=0;19>H;H++)X[H]=U[j[H]];for(P=19;4<P&&0===X[P-1];P--);for(k=O(U),W.d(M-257,5,i),W.d(B-1,5,i),W.d(P-4,4,i),H=0;H<P;H++)W.d(X[H],3,i);for(H=0,V=r.length;H<V;H++)if(z=r[H],W.d(k[z],U[z],i),16<=z){switch(H++,z){case 16:G=2;break;case 17:G=3;break;case 18:G=7;break;default:t("invalid code: "+z)}W.d(r[H],G,i)}var nt,st,at,ot,ht,lt,ut,ct,_t=[L,N],dt=[D,F];for(ht=_t[0],lt=_t[1],ut=dt[0],ct=dt[1],nt=0,st=I.length;nt<st;++nt)if(at=I[nt],W.d(ht[at],lt[at],i),256<at)W.d(I[++nt],I[++nt],i),ot=I[++nt],W.d(ut[ot],ct[ot],i),W.d(I[++nt],I[++nt],i);else if(256===at)break;this.a=W.finish(),this.b=this.a.length;break;default:t("invalid compression type")}return this.a};var b,A,C=[];for(b=3;258>=b;b++)A=S(),C[b]=A[2]<<24|A[1]<<16|A[0];var w=s?new Uint32Array(C):C;function R(i,r){function n(e,i){var r,n,s,a,o=e.G,h=[],l=0;switch(r=w[e.length],h[l++]=65535&r,h[l++]=r>>16&255,h[l++]=r>>24,!0){case 1===o:n=[0,o-1,0];break;case 2===o:n=[1,o-2,0];break;case 3===o:n=[2,o-3,0];break;case 4===o:n=[3,o-4,0];break;case 6>=o:n=[4,o-5,1];break;case 8>=o:n=[5,o-7,1];break;case 12>=o:n=[6,o-9,2];break;case 16>=o:n=[7,o-13,2];break;case 24>=o:n=[8,o-17,3];break;case 32>=o:n=[9,o-25,3];break;case 48>=o:n=[10,o-33,4];break;case 64>=o:n=[11,o-49,4];break;case 96>=o:n=[12,o-65,5];break;case 128>=o:n=[13,o-97,5];break;case 192>=o:n=[14,o-129,6];break;case 256>=o:n=[15,o-193,6];break;case 384>=o:n=[16,o-257,7];break;case 512>=o:n=[17,o-385,7];break;case 768>=o:n=[18,o-513,8];break;case 1024>=o:n=[19,o-769,8];break;case 1536>=o:n=[20,o-1025,9];break;case 2048>=o:n=[21,o-1537,9];break;case 3072>=o:n=[22,o-2049,10];break;case 4096>=o:n=[23,o-3073,10];break;case 6144>=o:n=[24,o-4097,11];break;case 8192>=o:n=[25,o-6145,11];break;case 12288>=o:n=[26,o-8193,12];break;case 16384>=o:n=[27,o-12289,12];break;case 24576>=o:n=[28,o-16385,13];break;case 32768>=o:n=[29,o-24577,13];break;default:t("invalid distance")}for(r=n,h[l++]=r[0],h[l++]=r[1],h[l++]=r[2],s=0,a=h.length;s<a;++s)m[g++]=h[s];y[h[0]]++,T[h[3]]++,v=e.length+i-1,d=null}var a,o,h,l,u,c,_,d,p,f={},m=s?new Uint16Array(2*r.length):[],g=0,v=0,y=new(s?Uint32Array:Array)(286),T=new(s?Uint32Array:Array)(30),S=i.w;if(!s){for(h=0;285>=h;)y[h++]=0;for(h=0;29>=h;)T[h++]=0}for(y[256]=1,a=0,o=r.length;a<o;++a){for(h=u=0,l=3;h<l&&a+h!==o;++h)u=u<<8|r[a+h];if(f[u]===e&&(f[u]=[]),c=f[u],!(0<v--)){for(;0<c.length&&32768<a-c[0];)c.shift();if(a+3>=o){for(d&&n(d,-1),h=0,l=o-a;h<l;++h)p=r[a+h],m[g++]=p,++y[p];break}if(0<c.length){var b=e,A=e,C=0,R=e,x=e,O=e,I=r.length,M=(x=0,c.length);t:for(;x<M;x++){if(b=c[M-x-1],R=3,3<C){for(O=C;3<O;O--)if(r[b+O-1]!==r[a+O-1])continue t;R=C}for(;258>R&&a+R<I&&r[b+R]===r[a+R];)++R;if(R>C&&(A=b,C=R),258===R)break}_=new E(C,a-A),d?d.length<_.length?(p=r[a-1],m[g++]=p,++y[p],n(_,0)):n(d,-1):_.length<S?d=_:n(_,0)}else d?n(d,-1):(p=r[a],m[g++]=p,++y[p])}c.push(a)}return m[g++]=256,y[256]++,i.L=y,i.K=T,s?m.subarray(0,g):m}function x(t,e){function i(t){var e=b[t][A[t]];e===v?(i(t+1),i(t+1)):--E[e],++A[t]}var r,n,a,o,h,l=t.length,u=new p(572),c=new(s?Uint8Array:Array)(l);if(!s)for(o=0;o<l;o++)c[o]=0;for(o=0;o<l;++o)0<t[o]&&u.push(o,t[o]);if(r=Array(u.length/2),n=new(s?Uint32Array:Array)(u.length/2),1===r.length)return c[u.pop().index]=1,c;for(o=0,h=u.length/2;o<h;++o)r[o]=u.pop(),n[o]=r[o].value;var _,d,f,m,g,v=n.length,y=new(s?Uint16Array:Array)(e),T=new(s?Uint8Array:Array)(e),E=new(s?Uint8Array:Array)(v),S=Array(e),b=Array(e),A=Array(e),C=(1<<e)-v,w=1<<e-1;for(y[e-1]=v,d=0;d<e;++d)C<w?T[d]=0:(T[d]=1,C-=w),C<<=1,y[e-2-d]=(y[e-1-d]/2|0)+v;for(y[0]=T[0],S[0]=Array(y[0]),b[0]=Array(y[0]),d=1;d<e;++d)y[d]>2*y[d-1]+T[d]&&(y[d]=2*y[d-1]+T[d]),S[d]=Array(y[d]),b[d]=Array(y[d]);for(_=0;_<v;++_)E[_]=e;for(f=0;f<y[e-1];++f)S[e-1][f]=n[f],b[e-1][f]=f;for(_=0;_<e;++_)A[_]=0;for(1===T[e-1]&&(--E[0],++A[e-1]),d=e-2;0<=d;--d){for(m=_=0,g=A[d+1],f=0;f<y[d];f++)(m=S[d+1][g]+S[d+1][g+1])>n[_]?(S[d][f]=m,b[d][f]=v,g+=2):(S[d][f]=n[_],b[d][f]=_,++_);A[d]=0,1===T[d]&&i(d)}for(a=E,o=0,h=r.length;o<h;++o)c[r[o].index]=a[o];return c}function O(e){var i,r,n,a,o=new(s?Uint16Array:Array)(e.length),h=[],l=[],u=0;for(i=0,r=e.length;i<r;i++)h[e[i]]=1+(0|h[e[i]]);for(i=1,r=16;i<=r;i++)l[i]=u,(u+=0|h[i])>1<<i&&t("overcommitted"),u<<=1;for(65536>u&&t("undercommitted"),i=0,r=e.length;i<r;i++)for(u=l[e[i]],l[e[i]]+=1,n=o[i]=0,a=e[i];n<a;n++)o[i]=o[i]<<1|1&u,u>>>=1;return o}function I(t,e){this.input=t,this.a=new(s?Uint8Array:Array)(32768),this.h=M.j;var i,r={};for(i in!e&&(e={})||"number"!=typeof e.compressionType||(this.h=e.compressionType),e)r[i]=e[i];r.outputBuffer=this.a,this.z=new m(this.input,r)}var M=y;function B(e,i){switch(this.k=[],this.l=32768,this.e=this.g=this.c=this.q=0,this.input=s?new Uint8Array(e):e,this.s=!1,this.m=N,this.B=!1,!i&&(i={})||(i.index&&(this.c=i.index),i.bufferSize&&(this.l=i.bufferSize),i.bufferType&&(this.m=i.bufferType),i.resize&&(this.B=i.resize)),this.m){case P:this.b=32768,this.a=new(s?Uint8Array:Array)(32768+this.l+258);break;case N:this.b=0,this.a=new(s?Uint8Array:Array)(this.l),this.f=this.J,this.t=this.H,this.o=this.I;break;default:t(Error("invalid inflate mode"))}}I.prototype.n=function(){var e,i,r,n,o,h,l,u=0;switch(l=this.a,e=ut){case ut:i=Math.LOG2E*Math.log(32768)-8;break;default:t(Error("invalid compression method"))}switch(r=i<<4|e,l[u++]=r,e){case ut:switch(this.h){case M.NONE:o=0;break;case M.r:o=1;break;case M.j:o=2;break;default:t(Error("unsupported compression type"))}break;default:t(Error("invalid compression method"))}return n=o<<6|0,l[u++]=n|31-(256*r+n)%31,h=a(this.input),this.z.b=u,u=(l=this.z.n()).length,s&&((l=new Uint8Array(l.buffer)).length<=u+4&&(this.a=new Uint8Array(l.length+4),this.a.set(l),l=this.a),l=l.subarray(0,u+4)),l[u++]=h>>24&255,l[u++]=h>>16&255,l[u++]=h>>8&255,l[u++]=255&h,l},n("Zlib.Deflate",I),n("Zlib.Deflate.compress",(function(t,e){return new I(t,e).n()})),n("Zlib.Deflate.CompressionType",M),n("Zlib.Deflate.CompressionType.NONE",M.NONE),n("Zlib.Deflate.CompressionType.FIXED",M.r),n("Zlib.Deflate.CompressionType.DYNAMIC",M.j);var P=0,N=1,L={D:P,C:N};B.prototype.p=function(){for(;!this.s;){var r=tt(this,3);switch(1&r&&(this.s=i),r>>>=1){case 0:var n=this.input,a=this.c,o=this.a,h=this.b,l=e,u=e,c=e,_=o.length,d=e;switch(this.e=this.g=0,(l=n[a++])===e&&t(Error("invalid uncompressed block header: LEN (first byte)")),u=l,(l=n[a++])===e&&t(Error("invalid uncompressed block header: LEN (second byte)")),u|=l<<8,(l=n[a++])===e&&t(Error("invalid uncompressed block header: NLEN (first byte)")),c=l,(l=n[a++])===e&&t(Error("invalid uncompressed block header: NLEN (second byte)")),u===~(c|=l<<8)&&t(Error("invalid uncompressed block header: length verify")),a+u>n.length&&t(Error("input buffer is broken")),this.m){case P:for(;h+u>o.length;){if(u-=d=_-h,s)o.set(n.subarray(a,a+d),h),h+=d,a+=d;else for(;d--;)o[h++]=n[a++];this.b=h,o=this.f(),h=this.b}break;case N:for(;h+u>o.length;)o=this.f({v:2});break;default:t(Error("invalid inflate mode"))}if(s)o.set(n.subarray(a,a+u),h),h+=u,a+=u;else for(;u--;)o[h++]=n[a++];this.c=a,this.b=h,this.a=o;break;case 1:this.o(Q,$);break;case 2:it(this);break;default:t(Error("unknown BTYPE: "+r))}}return this.t()};var F,D,U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],k=s?new Uint16Array(U):U,z=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],G=s?new Uint16Array(z):z,H=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],V=s?new Uint8Array(H):H,W=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],j=s?new Uint16Array(W):W,X=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Y=s?new Uint8Array(X):X,q=new(s?Uint8Array:Array)(288);for(F=0,D=q.length;F<D;++F)q[F]=143>=F?8:255>=F?9:279>=F?7:8;var K,Z,Q=f(q),J=new(s?Uint8Array:Array)(30);for(K=0,Z=J.length;K<Z;++K)J[K]=5;var $=f(J);function tt(i,r){for(var n,s=i.g,a=i.e,o=i.input,h=i.c;a<r;)(n=o[h++])===e&&t(Error("input buffer is broken")),s|=n<<a,a+=8;return n=s&(1<<r)-1,i.g=s>>>r,i.e=a-r,i.c=h,n}function et(i,r){for(var n,s,a,o=i.g,h=i.e,l=i.input,u=i.c,c=r[0],_=r[1];h<_;)(n=l[u++])===e&&t(Error("input buffer is broken")),o|=n<<h,h+=8;return a=(s=c[o&(1<<_)-1])>>>16,i.g=o>>a,i.e=h-a,i.c=u,65535&s}function it(t){function e(t,e,i){var r,n,s,a;for(a=0;a<t;)switch(r=et(this,e)){case 16:for(s=3+tt(this,2);s--;)i[a++]=n;break;case 17:for(s=3+tt(this,3);s--;)i[a++]=0;n=0;break;case 18:for(s=11+tt(this,7);s--;)i[a++]=0;n=0;break;default:n=i[a++]=r}return i}var i,r,n,a,o=tt(t,5)+257,h=tt(t,5)+1,l=tt(t,4)+4,u=new(s?Uint8Array:Array)(k.length);for(a=0;a<l;++a)u[k[a]]=tt(t,3);i=f(u),r=new(s?Uint8Array:Array)(o),n=new(s?Uint8Array:Array)(h),t.o(f(e.call(t,o,i,r)),f(e.call(t,h,i,n)))}function rt(e,i){var r,n;switch(this.input=e,this.c=0,!i&&(i={})||(i.index&&(this.c=i.index),i.verify&&(this.M=i.verify)),r=e[this.c++],n=e[this.c++],15&r){case ut:this.method=ut;break;default:t(Error("unsupported compression method"))}0!=((r<<8)+n)%31&&t(Error("invalid fcheck flag:"+((r<<8)+n)%31)),32&n&&t(Error("fdict flag is not supported")),this.A=new B(e,{index:this.c,bufferSize:i.bufferSize,bufferType:i.bufferType,resize:i.resize})}B.prototype.o=function(t,e){var i=this.a,r=this.b;this.u=t;for(var n,s,a,o,h=i.length-258;256!==(n=et(this,t));)if(256>n)r>=h&&(this.b=r,i=this.f(),r=this.b),i[r++]=n;else for(o=G[s=n-257],0<V[s]&&(o+=tt(this,V[s])),n=et(this,e),a=j[n],0<Y[n]&&(a+=tt(this,Y[n])),r>=h&&(this.b=r,i=this.f(),r=this.b);o--;)i[r]=i[r++-a];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},B.prototype.I=function(t,e){var i=this.a,r=this.b;this.u=t;for(var n,s,a,o,h=i.length;256!==(n=et(this,t));)if(256>n)r>=h&&(h=(i=this.f()).length),i[r++]=n;else for(o=G[s=n-257],0<V[s]&&(o+=tt(this,V[s])),n=et(this,e),a=j[n],0<Y[n]&&(a+=tt(this,Y[n])),r+o>h&&(h=(i=this.f()).length);o--;)i[r]=i[r++-a];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},B.prototype.f=function(){var t,e,i=new(s?Uint8Array:Array)(this.b-32768),r=this.b-32768,n=this.a;if(s)i.set(n.subarray(32768,i.length));else for(t=0,e=i.length;t<e;++t)i[t]=n[t+32768];if(this.k.push(i),this.q+=i.length,s)n.set(n.subarray(r,r+32768));else for(t=0;32768>t;++t)n[t]=n[r+t];return this.b=32768,n},B.prototype.J=function(t){var e,i,r,n=this.input.length/this.c+1|0,a=this.input,o=this.a;return t&&("number"==typeof t.v&&(n=t.v),"number"==typeof t.F&&(n+=t.F)),i=2>n?(r=(a.length-this.c)/this.u[2]/2*258|0)<o.length?o.length+r:o.length<<1:o.length*n,s?(e=new Uint8Array(i)).set(o):e=o,this.a=e},B.prototype.t=function(){var t,e,i,r,n,a=0,o=this.a,h=this.k,l=new(s?Uint8Array:Array)(this.q+(this.b-32768));if(0===h.length)return s?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(e=0,i=h.length;e<i;++e)for(r=0,n=(t=h[e]).length;r<n;++r)l[a++]=t[r];for(e=32768,i=this.b;e<i;++e)l[a++]=o[e];return this.k=[],this.buffer=l},B.prototype.H=function(){var t,e=this.b;return s?this.B?(t=new Uint8Array(e)).set(this.a.subarray(0,e)):t=this.a.subarray(0,e):(this.a.length>e&&(this.a.length=e),t=this.a),this.buffer=t},rt.prototype.p=function(){var e,i=this.input;return e=this.A.p(),this.c=this.A.c,this.M&&(i[this.c++]<<24|i[this.c++]<<16|i[this.c++]<<8|i[this.c++])>>>0!==a(e)&&t(Error("invalid adler-32 checksum")),e},n("Zlib.Inflate",rt),n("Zlib.Inflate.BufferType",L),L.ADAPTIVE=L.C,L.BLOCK=L.D,n("Zlib.Inflate.prototype.decompress",rt.prototype.p);var nt,st,at=new(s?Uint8Array:Array)(288);for(nt=0,st=at.length;nt<st;++nt)at[nt]=143>=nt?8:255>=nt?9:279>=nt?7:8;f(at);var ot,ht,lt=new(s?Uint8Array:Array)(30);for(ot=0,ht=lt.length;ot<ht;++ot)lt[ot]=5;f(lt);var ut=8}).call(vX);var yX=vX.Zlib;yX.Deflate=yX.Deflate,yX.Deflate.compress=yX.Deflate.compress,yX.Inflate=yX.Inflate,yX.Inflate.BufferType=yX.Inflate.BufferType,yX.Inflate.prototype.decompress=yX.Inflate.prototype.decompress;for(var TX=function(){function t(t){var e,i=this;this.pos=8,this.palette=[],this.imgData=[],this.text={},this.width=0,this.height=0,this.bits=0,this.colorType=0,this.compressionMethod=0,this.filterMethod=0,this.interlaceMethod=0,this.colors=0,this.hasAlphaChannel=!1,this.pixelBitlength=0,this.data=t,this.transparency={indexed:[],rgb:0,grayscale:0};for(var r=0,n=0,s=0;;){s=this.readUInt32();var a=function(){var t=[];for(r=0;r<4;++r)t.push(String.fromCharCode(i.data[i.pos++]));return t}.call(this).join("");switch(a){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(s);break;case"fcTL":e&&this.animation.frames.push(e),this.pos+=4,e={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};var o=this.readUInt16(),h=this.readUInt16()||100;e.delay=1e3*o/h,e.disposeOp=this.data[this.pos++],e.blendOp=this.data[this.pos++],e.data=[];break;case"IDAT":case"fdAT":for("fdAT"===a&&(this.pos+=4,s-=4),t=(null!=e?e.data:void 0)||this.imgData,r=0;0<=s?r<s:r>s;0<=s?++r:--r)t.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:this.transparency.indexed=this.read(s);var l=255-this.transparency.indexed.length;if(l>0)for(n=0;0<=l?n<l:n>l;0<=l?++n:--n)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(s)[0];break;case 2:this.transparency.rgb=this.read(s)}break;case"tEXt":var u=this.read(s),c=u.indexOf(0),_=String.fromCharCode.apply(String,u.slice(0,c));this.text[_]=String.fromCharCode.apply(String,u.slice(c+1));break;case"IEND":e&&this.animation.frames.push(e),this.colors=function(){switch(i.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this);var d=this.colorType;this.hasAlphaChannel=4===d||6===d;var p=this.colors+(this.hasAlphaChannel?1:0);return this.pixelBitlength=this.bits*p,this.colorSpace=function(){switch(i.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData instanceof Uint8Array||(this.imgData=new Uint8Array(this.imgData)));default:this.pos+=s}if(this.pos+=4,this.pos>this.data.length)throw new Error(F(6017))}}var e=t.prototype;return e.read=function(t){var e=0,i=[];for(e=0;0<=t?e<t:e>t;0<=t?++e:--e)i.push(this.data[this.pos++]);return i},e.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},e.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},e.decodePixels=function(t){if(null==t&&(t=this.imgData),0===t.length)return new Uint8Array(0);t=new yX.Inflate(t,{index:0,verify:!1}).decompress();for(var e=this.pixelBitlength/8,i=e*this.width,r=new Uint8Array(i*this.height),n=t.length,s=0,a=0,o=0,h=0,l=0,u=0,c=0,_=0,d=0,p=0,f=0,m=0,g=0,v=0,y=0,T=0,E=0,S=0,b=0;a<n;){switch(t[a++]){case 0:for(u=c=0;c<i;u=c+=1)r[o++]=t[a++];break;case 1:for(u=_=0;_<i;u=_+=1)h=t[a++],m=u<e?0:r[o-e],r[o++]=(h+m)%256;break;case 2:for(u=d=0;d<i;u=d+=1)h=t[a++],l=(u-u%e)/e,S=s&&r[(s-1)*i+l*e+u%e],r[o++]=(S+h)%256;break;case 3:for(u=p=0;p<i;u=p+=1)h=t[a++],l=(u-u%e)/e,m=u<e?0:r[o-e],S=s&&r[(s-1)*i+l*e+u%e],r[o++]=(h+Math.floor((m+S)/2))%256;break;case 4:for(u=f=0;f<i;u=f+=1)h=t[a++],l=(u-u%e)/e,m=u<e?0:r[o-e],0===s?S=b=0:(S=r[(s-1)*i+l*e+u%e],b=l&&r[(s-1)*i+(l-1)*e+u%e]),g=m+S-b,v=Math.abs(g-m),T=Math.abs(g-S),E=Math.abs(g-b),y=v<=T&&v<=E?m:T<=E?S:b,r[o++]=(h+y)%256;break;default:throw new Error(F(6018,t[a-1]))}s++}return r},e.copyToImageData=function(t,e){var i,r=this.hasAlphaChannel,n=this.colors;this.palette.length&&(i=null!=this._decodedPalette?this._decodedPalette:this._decodedPalette=this.decodePalette(),n=4,r=!0);var s=t.data||t,a=s.length,o=i||e,h=0,l=0,u=0,c=0;if(1===n)for(;h<a;)u=i?4*e[h/4]:l,c=o[u++],s[h++]=c,s[h++]=c,s[h++]=c,s[h++]=r?o[u++]:255,l=u;else for(;h<a;)u=i?4*e[h/4]:l,s[h++]=o[u++],s[h++]=o[u++],s[h++]=o[u++],s[h++]=r?o[u++]:255,l=u},e.decodePalette=function(){for(var t=this.palette,e=this.transparency.indexed||[],i=new Uint8Array((e.length||0)+t.length),r=0,n=0,s=0,a=0,o=0,h=t.length;o<h;a=o+=3)i[r++]=t[a],i[r++]=t[a+1],i[r++]=t[a+2],s=e[n++],i[r++]=null!=s?s:255;return i},e.render=function(t){t.width=this.width,t.height=this.height;var e=t.getContext("2d"),i=e.createImageData(this.width,this.height);return this.copyToImageData(i,this.decodePixels(null)),e.putImageData(i,0,0)},t}(),EX=function(){function t(){this._littleEndian=!1,this._tiffData=[],this._fileDirectories=[]}var e=t.prototype;return e.getUint8=function(t){return this._tiffData[t]},e.getUint16=function(t){return this._littleEndian?this._tiffData[t+1]<<8|this._tiffData[t]:this._tiffData[t]<<8|this._tiffData[t+1]},e.getUint32=function(t){var e=this._tiffData;return this._littleEndian?e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]:e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]},e.checkLittleEndian=function(){var t=this.getUint16(0);if(18761===t)this._littleEndian=!0;else{if(19789!==t)throw console.log(t),TypeError(F(6019));this._littleEndian=!1}return this._littleEndian},e.hasTowel=function(){if(42!==this.getUint16(2))throw RangeError(F(6020));return!0},e.getFieldTypeName=function(t){return t in bX?bX[t]:null},e.getFieldTagName=function(t){return t in SX?SX[t]:(x(6021,t),"Tag"+t)},e.getFieldTypeLength=function(t){return-1!==["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(t)?1:-1!==["SHORT","SSHORT"].indexOf(t)?2:-1!==["LONG","SLONG","FLOAT"].indexOf(t)?4:-1!==["RATIONAL","SRATIONAL","DOUBLE"].indexOf(t)?8:0},e.getFieldValues=function(t,e,i,r){var n=[],s=this.getFieldTypeLength(e);if(s*i<=4)!1===this._littleEndian?n.push(r>>>8*(4-s)):n.push(r);else for(var a=0;a<i;a++){var o=s*a;s>=8?-1!==["RATIONAL","SRATIONAL"].indexOf(e)?(n.push(this.getUint32(r+o)),n.push(this.getUint32(r+o+4))):x(8e3):n.push(this.getBytes(s,r+o))}return"ASCII"===e&&n.forEach((function(t,e,i){i[e]=String.fromCharCode(t)})),n},e.getBytes=function(t,e){if(t<=0)x(8001);else{if(t<=1)return this.getUint8(e);if(t<=2)return this.getUint16(e);if(t<=3)return this.getUint32(e)>>>8;if(t<=4)return this.getUint32(e);x(8002)}return 0},e.getBits=function(t,e,i){i=i||0;var r=e+Math.floor(i/8),n=i+t,s=32-t,a=0,o=0;return n<=0?x(6023):n<=8?(a=24+i,o=this.getUint8(r)):n<=16?(a=16+i,o=this.getUint16(r)):n<=32?(a=i,o=this.getUint32(r)):x(6022),{bits:o<<a>>>s,byteOffset:r+Math.floor(n/8),bitOffset:n%8}},e.parseFileDirectory=function(t){var e=this.getUint16(t),i=[],r=0,n=0;for(r=t+2,n=0;n<e;r+=12,n++){var s=this.getUint16(r),a=this.getUint16(r+2),o=this.getUint32(r+4),h=this.getUint32(r+8),l=this.getFieldTagName(s),u=this.getFieldTypeName(a),c=this.getFieldValues(l,u,o,h);i[l]={type:u,values:c}}this._fileDirectories.push(i);var _=this.getUint32(r);0!==_&&this.parseFileDirectory(_)},e.clampColorSample=function(t,e){var i=Math.pow(2,8-e);return Math.floor(t*i+(i-1))},e.parseTIFF=function(t,e){var i=this;if(e=e||document.createElement("canvas"),this._tiffData=t,this._canvas=e,this.checkLittleEndian(),this.hasTowel()){var r=this.getUint32(4);this._fileDirectories.length=0,this.parseFileDirectory(r);var n=this._fileDirectories[0],s=n.ImageWidth.values[0],a=n.ImageLength.values[0];this._canvas.width=s,this._canvas.height=a;var o=[],h=n.Compression?n.Compression.values[0]:1,l=n.SamplesPerPixel.values[0],u=[],c=0,_=!1;n.BitsPerSample.values.forEach((function(t,e){u[e]={bitsPerSample:t,hasBytesPerSample:!1,bytesPerSample:void 0},t%8==0&&(u[e].hasBytesPerSample=!0,u[e].bytesPerSample=t/8),c+=t}),this);var d=0;c%8==0&&(_=!0,d=c/8);var p,f=n.StripOffsets.values,m=f.length;if(n.StripByteCounts)p=n.StripByteCounts.values;else{if(x(8003),1!==m)throw Error(F(6024));p=[Math.ceil(s*a*c/8)]}for(var g=1,v=1,y=0;y<m;y++){var T=f[y];o[y]=[];for(var E=p[y],S=0,b=0,A=1,C=!0,w=[],R=0,O=0,I=0;S<E;S+=A)switch(h){case 1:w=[];for(var M=0;M<l;M++){var B=u[M];if(!B.hasBytesPerSample){var P=this.getBits(B.bitsPerSample,T+S,b);throw w.push(P.bits),S=P.byteOffset-T,b=P.bitOffset,RangeError(F(6025))}var N=B.bytesPerSample*M;w.push(this.getBytes(B.bytesPerSample,T+S+N))}if(o[y].push(w),!_)throw A=0,RangeError(F(6026));A=d;break;case 2:case 3:case 4:case 5:case 6:case 7:break;case 32773:if(C){C=!1;var L=this.getUint8(T+S);L>=0&&L<=127?g=L+1:L>=-127&&L<=-1?v=1-L:C=!0}else{for(var D=this.getUint8(T+S),U=0;U<v;U++){var k=u[O];if(!k.hasBytesPerSample)throw RangeError(F(6025));I=I<<8*R|D,++R===k.bytesPerSample&&(w.push(I),I=R=0,O++),O===l&&(o[y].push(w),w=[],O=0)}0==--g&&(C=!0)}A=1}}if(e.getContext){var z=this._canvas.getContext("2d");z.fillStyle="rgba(255, 255, 255, 0)";var G=n.RowsPerStrip?n.RowsPerStrip.values[0]:a,H=o.length,V=a%G,W=0===V?G:V,j=G,X=0,Y=n.PhotometricInterpretation.values[0],q=[],K=0;n.ExtraSamples&&(K=(q=n.ExtraSamples.values).length);var Z=[],Q=0;n.ColorMap&&(Z=n.ColorMap.values,Q=Math.pow(2,u[0].bitsPerSample));for(var J=0;J<H;J++){J+1===H&&(j=W);for(var $=o[J].length,tt=X*J,et=0,it=0;et<j&&it<$;et++)for(var rt=0;rt<s;rt++,it++){var nt=o[J][it],st=0,at=0,ot=0,ht=1;if(K>0)for(var lt=0;lt<K;lt++)if(1===q[lt]||2===q[lt]){ht=nt[3+lt]/256;break}!function(){switch(Y){case 0:var t=0;u[0].hasBytesPerSample&&(t=Math.pow(16,2*u[0].bytesPerSample)),nt.forEach((function(e,i,r){r[i]=t-e}));case 1:st=at=ot=i.clampColorSample(nt[0],u[0].bitsPerSample);break;case 2:st=i.clampColorSample(nt[0],u[0].bitsPerSample),at=i.clampColorSample(nt[1],u[1].bitsPerSample),ot=i.clampColorSample(nt[2],u[2].bitsPerSample);break;case 3:if(void 0===Z)throw Error(F(6027));var e=nt[0];st=i.clampColorSample(Z[e],16),at=i.clampColorSample(Z[Q+e],16),ot=i.clampColorSample(Z[2*Q+e],16);break;default:throw RangeError(F(6028,Y))}}(),z.fillStyle="rgba("+st+", "+at+", "+ot+", "+ht+")",z.fillRect(rt,tt+et,1,1)}X=j}}return this._canvas}},t}(),SX={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},bX={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"},AX=new Array(123),CX=0;CX<123;++CX)AX[CX]=64;for(var wX=0;wX<64;++wX)AX["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(wX)]=wX;var RX={name:"Jacob__Codec__Base64",decode:function(t){var e,i,r,n,s,a,o=[],h=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");h<t.length;)e=AX[t.charCodeAt(h++)]<<2|(n=AX[t.charCodeAt(h++)])>>4,i=(15&n)<<4|(s=AX[t.charCodeAt(h++)])>>2,r=(3&s)<<6|(a=AX[t.charCodeAt(h++)]),o.push(String.fromCharCode(e)),64!==s&&o.push(String.fromCharCode(i)),64!==a&&o.push(String.fromCharCode(r));return o.join("")},decodeAsArray:function(t,e){var i,r,n,s=this.decode(t),a=[];for(i=0,n=s.length/e;i<n;i++)for(a[i]=0,r=e-1;r>=0;--r)a[i]+=s.charCodeAt(i*e+r)<<8*r;return a}},xX=function(t){this.data=t,this.debug=!1,this.gpflags=void 0,this.files=0,this.unzipped=[],this.buf32k=new Array(32768),this.bIdx=0,this.modeZIP=!1,this.bytepos=0,this.bb=1,this.bits=0,this.nameBuf=[],this.fileout=void 0,this.literalTree=new Array(xX.LITERALS),this.distanceTree=new Array(32),this.treepos=0,this.Places=null,this.len=0,this.fpos=new Array(17),this.fpos[0]=0,this.flens=void 0,this.fmax=void 0};xX.gunzip=function(t){return t.constructor===Array||t.constructor,new xX(t).gunzip()[0][0]},xX.HufNode=function(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1},xX.LITERALS=288,xX.NAMEMAX=256,xX.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],xX.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],xX.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],xX.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],xX.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],xX.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],xX.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped},xX.prototype.readByte=function(){return this.bits+=8,this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1},xX.prototype.byteAlign=function(){this.bb=1},xX.prototype.readBit=function(){var t;return this.bits++,t=1&this.bb,this.bb>>=1,0===this.bb&&(this.bb=this.readByte(),t=1&this.bb,this.bb=this.bb>>1|128),t},xX.prototype.readBits=function(t){for(var e=0,i=t;i--;)e=e<<1|this.readBit();return t&&(e=xX.bitReverse[e]>>8-t),e},xX.prototype.flushBuffer=function(){this.bIdx=0},xX.prototype.addBuffer=function(t){this.buf32k[this.bIdx++]=t,this.outputArr.push(String.fromCharCode(t)),32768===this.bIdx&&(this.bIdx=0)},xX.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]===this.len)return this.fpos[this.len]++;this.fpos[this.len]++}},xX.prototype.Rec=function(){var t,e=this.Places[this.treepos];if(17===this.len)return-1;if(this.treepos++,this.len++,(t=this.IsPat())>=0)e.b0=t;else if(e.b0=32768,this.Rec())return-1;if((t=this.IsPat())>=0)e.b1=t,e.jump=null;else if(e.b1=32768,e.jump=this.Places[this.treepos],e.jumppos=this.treepos,this.Rec())return-1;return this.len--,0},xX.prototype.CreateTree=function(t,e,i){var r;for(this.Places=t,this.treepos=0,this.flens=i,this.fmax=e,r=0;r<17;r++)this.fpos[r]=0;return this.len=0,this.Rec()?-1:0},xX.prototype.DecodeValue=function(t){for(var e,i,r=0,n=t[r];;)if(this.readBit()){if(!(32768&n.b1))return n.b1;for(n=n.jump,e=t.length,i=0;i<e;i++)if(t[i]===n){r=i;break}}else{if(!(32768&n.b0))return n.b0;n=t[++r]}return-1},xX.prototype.DeflateLoop=function(){var t,e,i;do{var r,n;if(t=this.readBit(),0===(e=this.readBits(2)))for(this.byteAlign(),r=this.readByte(),r|=this.readByte()<<8,n=this.readByte(),65535&(r^~(n|=this.readByte()<<8))&&document.write("BlockLen checksum mismatch\n");r--;)s=this.readByte(),this.addBuffer(s);else if(1===e)for(;;)if((a=xX.bitReverse[this.readBits(7)]>>1)>23?(a=a<<1|this.readBit())>199?a=(a-=128)<<1|this.readBit():(a-=48)>143&&(a+=136):a+=256,a<256)this.addBuffer(a);else{if(256===a)break;for(a-=257,p=this.readBits(xX.cplext[a])+xX.cplens[a],a=xX.bitReverse[this.readBits(5)]>>3,xX.cpdext[a]>8?(f=this.readBits(8),f|=this.readBits(xX.cpdext[a]-8)<<8):f=this.readBits(xX.cpdext[a]),f+=xX.cpdist[a],a=0;a<p;a++){var s=this.buf32k[this.bIdx-f&32767];this.addBuffer(s)}}else if(2===e){var a,o,h,l,u,c=new Array(320);for(h=257+this.readBits(5),l=1+this.readBits(5),u=4+this.readBits(4),a=0;a<19;a++)c[a]=0;for(a=0;a<u;a++)c[xX.border[a]]=this.readBits(3);for(p=this.distanceTree.length,i=0;i<p;i++)this.distanceTree[i]=new xX.HufNode;if(this.CreateTree(this.distanceTree,19,c,0))return this.flushBuffer(),1;for(o=h+l,i=0;i<o;)if((a=this.DecodeValue(this.distanceTree))<16)c[i++]=a;else if(16===a){var _;if(i+(a=3+this.readBits(2))>o)return this.flushBuffer(),1;for(_=i?c[i-1]:0;a--;)c[i++]=_}else{if(i+(a=17===a?3+this.readBits(3):11+this.readBits(7))>o)return this.flushBuffer(),1;for(;a--;)c[i++]=0}for(p=this.literalTree.length,i=0;i<p;i++)this.literalTree[i]=new xX.HufNode;if(this.CreateTree(this.literalTree,h,c,0))return this.flushBuffer(),1;for(p=this.literalTree.length,i=0;i<p;i++)this.distanceTree[i]=new xX.HufNode;var d=new Array;for(i=h;i<c.length;i++)d[i-h]=c[i];if(this.CreateTree(this.distanceTree,l,d,0))return this.flushBuffer(),1;for(;;)if((a=this.DecodeValue(this.literalTree))>=256){var p,f;if(0==(a-=256))break;for(a--,p=this.readBits(xX.cplext[a])+xX.cplens[a],a=this.DecodeValue(this.distanceTree),xX.cpdext[a]>8?(f=this.readBits(8),f|=this.readBits(xX.cpdext[a]-8)<<8):f=this.readBits(xX.cpdext[a]),f+=xX.cpdist[a];p--;)s=this.buf32k[this.bIdx-f&32767],this.addBuffer(s)}else this.addBuffer(a)}}while(!t);return this.flushBuffer(),this.byteAlign(),0},xX.prototype.unzipFile=function(t){var e;for(this.gunzip(),e=0;e<this.unzipped.length;e++)if(this.unzipped[e][1]===t)return this.unzipped[e][0]},xX.prototype.nextFile=function(){this.outputArr=[],this.modeZIP=!1;var t=[];if(t[0]=this.readByte(),t[1]=this.readByte(),120===t[0]&&218===t[1]&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++),31===t[0]&&139===t[1]&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++),80===t[0]&&75===t[1]&&(this.modeZIP=!0,t[2]=this.readByte(),t[3]=this.readByte(),3===t[2]&&4===t[3])){t[0]=this.readByte(),t[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8;var e=this.readByte();e|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte();var i=this.readByte();i|=this.readByte()<<8;var r=this.readByte();for(r|=this.readByte()<<8,s=0,this.nameBuf=[];i--;){var n=this.readByte();"/"===n|":"===n?s=0:s<xX.NAMEMAX-1&&(this.nameBuf[s++]=String.fromCharCode(n))}this.fileout||(this.fileout=this.nameBuf);for(var s=0;s<r;)n=this.readByte(),s++;8===e&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++),this.skipdir()}},xX.prototype.skipdir=function(){var t,e,i=[];if(8&this.gpflags&&(i[0]=this.readByte(),i[1]=this.readByte(),i[2]=this.readByte(),i[3]=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte()),this.modeZIP&&this.nextFile(),i[0]=this.readByte(),8!==i[0])return 0;if(this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),4&this.gpflags)for(i[0]=this.readByte(),i[2]=this.readByte(),this.len=i[0]+256*i[1],t=0;t<this.len;t++)this.readByte();if(8&this.gpflags)for(t=0,this.nameBuf=[];e=this.readByte();)"7"!==e&&":"!==e||(t=0),t<xX.NAMEMAX-1&&(this.nameBuf[t++]=e);if(16&this.gpflags)for(;e=this.readByte(););2&this.gpflags&&(this.readByte(),this.readByte()),this.DeflateLoop(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.modeZIP&&this.nextFile()};var OX,IX,MX,BX,PX,NX,LX,FX,DX,UX,kX,zX,GX,HX,VX,WX,jX,XX,YX,qX,KX,ZX,QX,JX,$X,tY,eY,iY,rY,nY,sY,aY,oY,hY,lY,uY,cY,_Y,dY,pY,fY,mY,gY,vY,yY,TY,EY,SY,bY,AY,CY,wY,RY,xY,OY,IY,MY,BY,PY,NY,LY,FY,DY,UY,kY,zY,GY,HY,VY,WY,jY,XY,YY,qY,KY,ZY,QY,JY,$Y,tq,eq,iq,rq,nq,sq,aq,oq,hq,lq,uq,cq,_q,dq,pq,fq,mq,gq={name:"Jacob__Codec"};function vq(t){var e=t.parent,i=t.getComponent(Mq);return e&&i?vq(e):t.getComponentsInChildren(Mq)}gq.Base64=RX,gq.GZip=xX,gq.unzip=function(){return gq.GZip.gunzip.apply(gq.GZip,arguments)},gq.unzipBase64=function(){var t=gq.Base64.decode.apply(gq.Base64,arguments);try{return gq.GZip.gunzip.call(gq.GZip,t)}catch(e){return t.slice(7)}},gq.unzipBase64AsArray=function(t,e){e=e||1;var i,r,n,s=this.unzipBase64(t),a=[];for(i=0,n=s.length/e;i<n;i++)for(a[i]=0,r=e-1;r>=0;--r)a[i]+=s.charCodeAt(i*e+r)<<8*r;return a},gq.unzipAsArray=function(t,e){e=e||1;var i,r,n,s=this.unzip(t),a=[];for(i=0,n=s.length/e;i<n;i++)for(a[i]=0,r=e-1;r>=0;--r)a[i]+=s.charCodeAt(i*e+r)<<8*r;return a},function(t){t[t.JPG=0]="JPG",t[t.PNG=1]="PNG",t[t.TIFF=2]="TIFF",t[t.WEBP=3]="WEBP",t[t.PVR=4]="PVR",t[t.ETC=5]="ETC",t[t.S3TC=6]="S3TC",t[t.ATITC=7]="ATITC",t[t.TGA=8]="TGA",t[t.RAWDATA=9]="RAWDATA",t[t.UNKNOWN=10]="UNKNOWN"}(mq||(mq={}));var yq,Tq,Eq,Sq,bq,Aq,Cq,wq,Rq,xq,Oq,Iq,Mq=t("ParticleSystem2D",(OX=Ne("cc.ParticleSystem2D"),IX=We(),MX=$e(),BX=pi(gX),PX=$e(),NX=pi(um),LX=$e(),FX=$e(),DX=$e(),UX=$e(),kX=$e(),zX=$e(),GX=$e(),HX=$e(),VX=$e(),WX=$e(),jX=$e(),XX=$e(),YX=$e(),qX=$e(),KX=$e(),ZX=$e(),QX=$e(),JX=$e(),$X=$e(),tY=$e(),eY=$e(),iY=pi(oX),rY=$e(),nY=pi(aX),sY=$e(),aY=$e(),oY=$e(),hY=$e(),lY=$e(),uY=$e(),cY=$e(),_Y=$e(),dY=$e(),pY=$e(),fY=$e(),mY=$e(),gY=$e(),vY=$e(),yY=$e(),TY=$e(),EY=$e(),SY=$e(),OX(bY=IX(bY=je(bY=Ve((fq=pq=function(t){function e(){var e;return l(e=t.call(this)||this,"duration",CY,a(e)),l(e,"emissionRate",wY,a(e)),l(e,"life",RY,a(e)),l(e,"lifeVar",xY,a(e)),l(e,"angle",OY,a(e)),l(e,"angleVar",IY,a(e)),l(e,"startSize",MY,a(e)),l(e,"startSizeVar",BY,a(e)),l(e,"endSize",PY,a(e)),l(e,"endSizeVar",NY,a(e)),l(e,"startSpin",LY,a(e)),l(e,"startSpinVar",FY,a(e)),l(e,"endSpin",DY,a(e)),l(e,"endSpinVar",UY,a(e)),l(e,"sourcePos",kY,a(e)),l(e,"posVar",zY,a(e)),l(e,"emitterMode",GY,a(e)),l(e,"gravity",HY,a(e)),l(e,"speed",VY,a(e)),l(e,"speedVar",WY,a(e)),l(e,"tangentialAccel",jY,a(e)),l(e,"tangentialAccelVar",XY,a(e)),l(e,"radialAccel",YY,a(e)),l(e,"radialAccelVar",qY,a(e)),l(e,"rotationIsDir",KY,a(e)),l(e,"startRadius",ZY,a(e)),l(e,"startRadiusVar",QY,a(e)),l(e,"endRadius",JY,a(e)),l(e,"endRadiusVar",$Y,a(e)),l(e,"rotatePerS",tq,a(e)),l(e,"rotatePerSVar",eq,a(e)),e.aspectRatio=1,l(e,"preview",iq,a(e)),l(e,"playOnLoad",rq,a(e)),l(e,"autoRemoveOnFinish",nq,a(e)),l(e,"_custom",sq,a(e)),l(e,"_file",aq,a(e)),l(e,"_spriteFrame",oq,a(e)),l(e,"_totalParticles",hq,a(e)),l(e,"_startColor",lq,a(e)),l(e,"_startColorVar",uq,a(e)),l(e,"_endColor",cq,a(e)),l(e,"_endColorVar",_q,a(e)),l(e,"_positionType",dq,a(e)),e._stopped=!0,e._deferredloaded=!1,e.initProperties(),e}s(e,t),r(e,[{key:"custom",get:function(){return this._custom},set:function(t){this._custom!==t&&(this._custom=t,this._applyFile())}},{key:"file",get:function(){return this._file},set:function(t){this._file!==t&&(this._file=t,t?this._applyFile():this.custom=!0)}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){this._renderSpriteFrame!==t&&(this._renderSpriteFrame=t,t&&!t._uuid||(this._spriteFrame=t),this._applySpriteFrame())}},{key:"particleCount",get:function(){return this._simulator.particles.length}},{key:"totalParticles",get:function(){return this._totalParticles},set:function(t){this._totalParticles!==t&&(this._totalParticles=t)}},{key:"startColor",get:function(){return this._startColor},set:function(t){this._startColor.r=t.r,this._startColor.g=t.g,this._startColor.b=t.b,this._startColor.a=t.a}},{key:"startColorVar",get:function(){return this._startColorVar},set:function(t){this._startColorVar.r=t.r,this._startColorVar.g=t.g,this._startColorVar.b=t.b,this._startColorVar.a=t.a}},{key:"endColor",get:function(){return this._endColor},set:function(t){this._endColor.r=t.r,this._endColor.g=t.g,this._endColor.b=t.b,this._endColor.a=t.a}},{key:"endColorVar",get:function(){return this._endColorVar},set:function(t){this._endColorVar.r=t.r,this._endColorVar.g=t.g,this._endColorVar.b=t.b,this._endColorVar.a=t.a}},{key:"positionType",get:function(){return this._positionType},set:function(t){this._positionType=t,this._updateMaterial()}},{key:"stopped",get:function(){return this._stopped}},{key:"active",get:function(){return this._simulator.active}},{key:"assembler",get:function(){return this._assembler}}]);var i=e.prototype;return i.onEnable=function(){t.prototype.onEnable.call(this),this._updateMaterial()},i.onDestroy=function(){t.prototype.onDestroy.call(this),this.autoRemoveOnFinish&&(this.autoRemoveOnFinish=!1),this._simulator.uvFilled=0},i.initProperties=function(){this._previewTimer=null,this._focused=!1,this.aspectRatio=1,this._simulator=new mX(this)},i.onFocusInEditor=function(){this._focused=!0;for(var t=vq(this.node),e=0;e<t.length;++e)t[e]._startPreview()},i.onLostFocusInEditor=function(){this._focused=!1;for(var t=vq(this.node),e=0;e<t.length;++e)t[e]._stopPreview()},i._startPreview=function(){this.preview&&this.resetSystem()},i._stopPreview=function(){this.preview&&(this.resetSystem(),this.stopSystem()),this._previewTimer&&clearInterval(this._previewTimer)},i.__preload=function(){t.prototype.__preload.call(this),this._custom&&this.spriteFrame&&!this._renderSpriteFrame?this._applySpriteFrame():this._file&&(this._custom?!this._getTexture()&&this._applyFile():this._applyFile()),this.playOnLoad&&this.resetSystem()},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._assembler&&this._assembler.createData&&(this._simulator.renderData=this._assembler.createData(this))},i.lateUpdate=function(t){this._simulator.finished||this._simulator.step(t)},i.addParticle=function(){},i.stopSystem=function(){this._stopped=!0,this._simulator.stop()},i.resetSystem=function(){this._stopped=!1,this._simulator.reset(),this._renderFlag=this._canRender()},i.isFull=function(){return this.particleCount>=this.totalParticles},i._applyFile=function(){var t=this,e=this._file;if(e){var i=function(i){!i&&e?t.isValid&&(t._plistFile=e.nativeUrl,t._custom||(t._spriteFrame!==e.spriteFrame&&(t.spriteFrame=e.spriteFrame),t._initWithDictionary(e._nativeAsset)),t._spriteFrame?!t._renderSpriteFrame&&t._spriteFrame&&t._applySpriteFrame():e.spriteFrame?t.spriteFrame=e.spriteFrame:t._custom&&t._initTextureWithDictionary(e._nativeAsset),t._deferredloaded=!1):B(6029)};e._nativeAsset?i(null):(this._deferredloaded=!0,$D.postLoadNative(e,i))}},i._initTextureWithDictionary=function(t){var e,i=this;if(t.spriteFrameUuid){var r=t.spriteFrameUuid;$D.loadAny(r,(function(e,r){e?(t.spriteFrameUuid=void 0,i._initTextureWithDictionary(t),console.error(e)):i.spriteFrame=r}))}else{var n=vr(this._plistFile,t.textureFileName||"");if(t.textureFileName)$D.loadRemote(n,(function(e,r){e?(t.textureFileName=void 0,i._initTextureWithDictionary(t),console.error(e)):i.spriteFrame=um.createWithImage(r)}));else if(t.textureImageData){var s=t.textureImageData;if(!(s&&s.length>0))return!1;var a=$D.assets.get(n);if(!a){var o=gq.unzipBase64AsArray(s,1);if(!o)return I(6030,this._file.name),!1;var h=(e=o).length>8&&137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]?mq.PNG:e.length>2&&(73===e[0]&&73===e[1]||77===e[0]&&77===e[1]||255===e[0]&&216===e[1])?mq.TIFF:mq.UNKNOWN;if(h!==mq.TIFF&&h!==mq.PNG)return I(6031,this._file.name),!1;var l=document.createElement("canvas");h===mq.PNG?new TX(o).render(l):(this._tiffReader||(this._tiffReader=new EX),this._tiffReader.parseTIFF(o,l)),a=new Dd(l),$D.assets.add(n,a)}a||I(6032,this._file.name),this.spriteFrame=um.createWithImage(a)}}return!0},i._initWithDictionary=function(t){this.totalParticles=parseInt(t.maxParticles||0),this.life=parseFloat(t.particleLifespan||0),this.lifeVar=parseFloat(t.particleLifespanVariance||0);var e=t.emissionRate;this.emissionRate=e||Math.min(this.totalParticles/this.life,Number.MAX_VALUE),this.duration=parseFloat(t.duration||0),this.srcBlendFactor=parseInt(t.blendFuncSource||pl.SRC_ALPHA),this.dstBlendFactor=parseInt(t.blendFuncDestination||pl.ONE_MINUS_SRC_ALPHA);var i=this._startColor;i.r=255*parseFloat(t.startColorRed||0),i.g=255*parseFloat(t.startColorGreen||0),i.b=255*parseFloat(t.startColorBlue||0),i.a=255*parseFloat(t.startColorAlpha||0);var r=this._startColorVar;r.r=255*parseFloat(t.startColorVarianceRed||0),r.g=255*parseFloat(t.startColorVarianceGreen||0),r.b=255*parseFloat(t.startColorVarianceBlue||0),r.a=255*parseFloat(t.startColorVarianceAlpha||0);var n=this._endColor;n.r=255*parseFloat(t.finishColorRed||0),n.g=255*parseFloat(t.finishColorGreen||0),n.b=255*parseFloat(t.finishColorBlue||0),n.a=255*parseFloat(t.finishColorAlpha||0);var s=this._endColorVar;if(s.r=255*parseFloat(t.finishColorVarianceRed||0),s.g=255*parseFloat(t.finishColorVarianceGreen||0),s.b=255*parseFloat(t.finishColorVarianceBlue||0),s.a=255*parseFloat(t.finishColorVarianceAlpha||0),this.startSize=parseFloat(t.startParticleSize||0),this.startSizeVar=parseFloat(t.startParticleSizeVariance||0),this.endSize=parseFloat(t.finishParticleSize||0),this.endSizeVar=parseFloat(t.finishParticleSizeVariance||0),this.positionType=parseFloat(void 0!==t.positionType?t.positionType:oX.FREE),this.sourcePos.set(0,0),this.posVar.set(parseFloat(t.sourcePositionVariancex||0),parseFloat(t.sourcePositionVariancey||0)),this.angle=parseFloat(t.angle||0),this.angleVar=parseFloat(t.angleVariance||0),this.startSpin=parseFloat(t.rotationStart||0),this.startSpinVar=parseFloat(t.rotationStartVariance||0),this.endSpin=parseFloat(t.rotationEnd||0),this.endSpinVar=parseFloat(t.rotationEndVariance||0),this.emitterMode=parseInt(t.emitterType||aX.GRAVITY),this.emitterMode===aX.GRAVITY){this.gravity.set(parseFloat(t.gravityx||0),parseFloat(t.gravityy||0)),this.speed=parseFloat(t.speed||0),this.speedVar=parseFloat(t.speedVariance||0),this.radialAccel=parseFloat(t.radialAcceleration||0),this.radialAccelVar=parseFloat(t.radialAccelVariance||0),this.tangentialAccel=parseFloat(t.tangentialAcceleration||0),this.tangentialAccelVar=parseFloat(t.tangentialAccelVariance||0);var a=t.rotationIsDir||"";null!==a?(a=a.toString().toLowerCase(),this.rotationIsDir="true"===a||"1"===a):this.rotationIsDir=!1}else{if(this.emitterMode!==aX.RADIUS)return I(6009),!1;this.startRadius=parseFloat(t.maxRadius||0),this.startRadiusVar=parseFloat(t.maxRadiusVariance||0),this.endRadius=parseFloat(t.minRadius||0),this.endRadiusVar=parseFloat(t.minRadiusVariance||0),this.rotatePerS=parseFloat(t.rotatePerSecond||0),this.rotatePerSVar=parseFloat(t.rotatePerSecondVariance||0)}return this._initTextureWithDictionary(t),!0},i._onTextureLoaded=function(){this._simulator.updateUVs(!0),this._syncAspect(),this._updateMaterial(),this._stopped=!1,this._renderFlag=this._canRender()},i._syncAspect=function(){if(this._renderSpriteFrame){var t=this._renderSpriteFrame.rect;this.aspectRatio=t.width/t.height}},i._applySpriteFrame=function(){this._renderSpriteFrame=this._renderSpriteFrame||this._spriteFrame,this._renderSpriteFrame&&(this._renderSpriteFrame.textureLoaded()?this._onTextureLoaded():this._renderSpriteFrame.once("load",this._onTextureLoaded,this))},i._getTexture=function(){return this._renderSpriteFrame&&this._renderSpriteFrame.texture},i._updateMaterial=function(){var t=this.getMaterialInstance(0);t&&t.recompileShaders({USE_LOCAL:this._positionType!==oX.FREE})},i._finishedSimulation=function(){this.resetSystem(),this.stopSystem(),this._renderFlag=this._canRender(),this.autoRemoveOnFinish&&this._stopped&&this.node.destroy()},i._canRender=function(){return t.prototype._canRender.call(this)&&!this._stopped&&!this._deferredloaded},i._render=function(t){t.commitComp(this,this._spriteFrame,this._assembler,this._positionType===oX.RELATIVE?this.node.parent:null)},e}(fF),pq.EmitterMode=aX,pq.PositionType=oX,pq.DURATION_INFINITY=-1,pq.START_SIZE_EQUAL_TO_END_SIZE=-1,pq.START_RADIUS_EQUAL_TO_END_RADIUS=-1,u((AY=fq).prototype,"custom",[Ke,MX],Object.getOwnPropertyDescriptor(AY.prototype,"custom"),AY.prototype),u(AY.prototype,"file",[BX,PX],Object.getOwnPropertyDescriptor(AY.prototype,"file"),AY.prototype),u(AY.prototype,"spriteFrame",[NX,LX],Object.getOwnPropertyDescriptor(AY.prototype,"spriteFrame"),AY.prototype),u(AY.prototype,"totalParticles",[Ke,FX],Object.getOwnPropertyDescriptor(AY.prototype,"totalParticles"),AY.prototype),CY=u(AY.prototype,"duration",[ke,Ke,DX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),wY=u(AY.prototype,"emissionRate",[ke,Ke,UX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),RY=u(AY.prototype,"life",[ke,Ke,kX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),xY=u(AY.prototype,"lifeVar",[ke,Ke,zX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),u(AY.prototype,"startColor",[Ke,GX],Object.getOwnPropertyDescriptor(AY.prototype,"startColor"),AY.prototype),u(AY.prototype,"startColorVar",[Ke,HX],Object.getOwnPropertyDescriptor(AY.prototype,"startColorVar"),AY.prototype),u(AY.prototype,"endColor",[Ke,VX],Object.getOwnPropertyDescriptor(AY.prototype,"endColor"),AY.prototype),u(AY.prototype,"endColorVar",[Ke,WX],Object.getOwnPropertyDescriptor(AY.prototype,"endColorVar"),AY.prototype),OY=u(AY.prototype,"angle",[ke,Ke,jX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 90}}),IY=u(AY.prototype,"angleVar",[ke,Ke,XX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),MY=u(AY.prototype,"startSize",[ke,Ke,YX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),BY=u(AY.prototype,"startSizeVar",[ke,Ke,qX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),PY=u(AY.prototype,"endSize",[ke,Ke,KX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),NY=u(AY.prototype,"endSizeVar",[ke,Ke,ZX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),LY=u(AY.prototype,"startSpin",[ke,Ke,QX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),FY=u(AY.prototype,"startSpinVar",[ke,Ke,JX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),DY=u(AY.prototype,"endSpin",[ke,Ke,$X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),UY=u(AY.prototype,"endSpinVar",[ke,Ke,tY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),kY=u(AY.prototype,"sourcePos",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Es.ZERO.clone()}}),zY=u(AY.prototype,"posVar",[ke,Ke,eY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Es.ZERO.clone()}}),u(AY.prototype,"positionType",[iY,rY],Object.getOwnPropertyDescriptor(AY.prototype,"positionType"),AY.prototype),GY=u(AY.prototype,"emitterMode",[ke,Ke,nY,sY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return aX.GRAVITY}}),HY=u(AY.prototype,"gravity",[ke,Ke,aY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Es.ZERO.clone()}}),VY=u(AY.prototype,"speed",[ke,Ke,oY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 180}}),WY=u(AY.prototype,"speedVar",[ke,Ke,hY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),jY=u(AY.prototype,"tangentialAccel",[ke,Ke,lY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 80}}),XY=u(AY.prototype,"tangentialAccelVar",[ke,Ke,uY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),YY=u(AY.prototype,"radialAccel",[ke,Ke,cY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),qY=u(AY.prototype,"radialAccelVar",[ke,Ke,_Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),KY=u(AY.prototype,"rotationIsDir",[ke,Ke,dY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ZY=u(AY.prototype,"startRadius",[ke,Ke,pY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),QY=u(AY.prototype,"startRadiusVar",[ke,Ke,fY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),JY=u(AY.prototype,"endRadius",[ke,Ke,mY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$Y=u(AY.prototype,"endRadiusVar",[ke,Ke,gY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),tq=u(AY.prototype,"rotatePerS",[ke,Ke,vY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),eq=u(AY.prototype,"rotatePerSVar",[ke,Ke,yY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),iq=u(AY.prototype,"preview",[ke,Ke,TY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),rq=u(AY.prototype,"playOnLoad",[ke,Ke,EY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),nq=u(AY.prototype,"autoRemoveOnFinish",[ke,Ke,SY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),sq=u(AY.prototype,"_custom",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),aq=u(AY.prototype,"_file",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oq=u(AY.prototype,"_spriteFrame",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),hq=u(AY.prototype,"_totalParticles",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),lq=u(AY.prototype,"_startColor",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qs(255,255,255,255)}}),uq=u(AY.prototype,"_startColorVar",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qs(0,0,0,0)}}),cq=u(AY.prototype,"_endColor",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qs(255,255,255,0)}}),_q=u(AY.prototype,"_endColorVar",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qs(0,0,0,0)}}),dq=u(AY.prototype,"_positionType",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return oX.FREE}}),bY=AY))||bY)||bY)||bY)||bY)),Bq=t("MotionStreak",(yq=Ne("cc.MotionStreak"),Tq=We(),Eq=qe(),Sq=pi(pp),yq(bq=Ve(bq=je(bq=Tq(bq=Eq((u((Aq=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"_preview",Cq,a(e)),l(e,"_fadeTime",wq,a(e)),l(e,"_minSeg",Rq,a(e)),l(e,"_stroke",xq,a(e)),l(e,"_texture",Oq,a(e)),l(e,"_fastMode",Iq,a(e)),e._points=[],e}s(e,t);var i=e.prototype;return i.onEnable=function(){t.prototype.onEnable.call(this),this.reset()},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.material)},i.onFocusInEditor=function(){this._preview&&this.reset()},i.onLostFocusInEditor=function(){this._preview&&this.reset()},i.reset=function(){this._points.length=0,this._renderData&&this._renderData.clear()},i.lateUpdate=function(t){this._assembler&&this._assembler.update(this,t)},i._render=function(t){t.commitComp(this,this._texture,this._assembler,null)},r(e,[{key:"preview",get:function(){return this._preview},set:function(t){this._preview=t,this.reset()}},{key:"fadeTime",get:function(){return this._fadeTime},set:function(t){this._fadeTime=t,this.reset()}},{key:"minSeg",get:function(){return this._minSeg},set:function(t){this._minSeg=t}},{key:"stroke",get:function(){return this._stroke},set:function(t){this._stroke=t}},{key:"texture",get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t)}},{key:"fastMode",get:function(){return this._fastMode},set:function(t){this._fastMode=t}},{key:"points",get:function(){return this._points}}]),e}(fF)).prototype,"preview",[Ke],Object.getOwnPropertyDescriptor(Aq.prototype,"preview"),Aq.prototype),u(Aq.prototype,"fadeTime",[Ke],Object.getOwnPropertyDescriptor(Aq.prototype,"fadeTime"),Aq.prototype),u(Aq.prototype,"minSeg",[Ke],Object.getOwnPropertyDescriptor(Aq.prototype,"minSeg"),Aq.prototype),u(Aq.prototype,"stroke",[Ke],Object.getOwnPropertyDescriptor(Aq.prototype,"stroke"),Aq.prototype),u(Aq.prototype,"texture",[Sq],Object.getOwnPropertyDescriptor(Aq.prototype,"texture"),Aq.prototype),u(Aq.prototype,"fastMode",[Ke],Object.getOwnPropertyDescriptor(Aq.prototype,"fastMode"),Aq.prototype),Cq=u(Aq.prototype,"_preview",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),wq=u(Aq.prototype,"_fadeTime",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Rq=u(Aq.prototype,"_minSeg",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),xq=u(Aq.prototype,"_stroke",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),Oq=u(Aq.prototype,"_texture",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Iq=u(Aq.prototype,"_fastMode",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bq=Aq))||bq)||bq)||bq)||bq)||bq)),Pq=function(){function t(t,e){this.point=new Es,this.dir=new Es,this.distance=0,this.time=0,t&&this.point.set(t),e&&this.dir.set(e)}var e=t.prototype;return e.setPoint=function(t,e){this.point.x=t,this.point.y=e},e.setDir=function(t,e){this.dir.x=t,this.dir.y=e},t}(),Nq=(new Es,new Es,new Es),Lq=new Es;function Fq(t,e){return t.x=-e.y,t.y=e.x,t}var Dq={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.vertexCount=16,e.indicesCount=42,e},update:function(t,e){var i,r=t.stroke/2,n=t.node.worldMatrix,s=n.m12,a=n.m13,o=t.points;if(o.length>1){var h=o[0],l=h.x-s,u=h.y-a;l*l+u*u<t.minSeg&&(i=h)}i||(i=new Pq,o.splice(0,0,i)),i.setPoint(s,a),i.time=t.fadeTime+e;var c,_=0;if(!(o.length<2)){var d=t.renderData,p=t.color,f=p.r,m=p.g,g=p.b,v=p.a,y=o[1];y.distance=Es.subtract(Lq,i.point,y.point).length(),Lq.normalize(),y.setDir(Lq.x,Lq.y),i.setDir(Lq.x,Lq.y),d.dataLength=2*o.length;for(var T=d.data,E=t.fadeTime,S=!1,b=o.length-1;b>=0;b--){var A=o[b],C=A.point,w=A.dir;if(A.time-=e,A.time<0)o.splice(b,1);else{var R=A.time/E,x=o[b-1];if(!S){if(!x){o.splice(b,1);continue}C.x=x.point.x-w.x*R,C.y=x.point.y-w.y*R}S=!0,Fq(Nq,w);var O=(R*v<<24>>>0)+(g<<16)+(m<<8)+f,I=_;T[I].x=C.x+Nq.x*r,T[I].y=C.y+Nq.y*r,T[I].u=1,T[I].v=R,T[I].color._val=O,T[I+=1].x=C.x-Nq.x*r,T[I].y=C.y-Nq.y*r,T[I].u=0,T[I].v=R,T[I].color._val=O,_+=2}}c=_<=2?0:3*(_-2),d.vertexCount=_,d.indicesCount=c}},updateRenderData:function(){},fillBuffers:function(t,e){var i=t.renderData,r=i.data,n=(t.node,e.acquireBufferBatch()),s=n.byteOffset>>2,a=n.indicesOffset,o=n.vertexOffset;n.request(i.vertexCount,i.indicesCount)||(n=e.currBufferBatch,a=0,o=0);for(var h=n.vData,l=n.iData,u=i.vertexCount,c=i.indicesCount,_=0;_<u;_++){var d=r[_];h[s++]=d.x,h[s++]=d.y,h[s++]=d.z,h[s++]=d.u,h[s++]=d.v,Qs.toArray(h,d.color,s),s+=4}for(var p=0,f=c;p<f;p+=2){var m=o+p;l[a++]=m,l[a++]=m+2,l[a++]=m+1,l[a++]=m+1,l[a++]=m+2,l[a++]=m+3}}},Uq=t("MotionStreakAssemblerManager",{getAssembler:function(){return Dq}});Bq.Assembler=Uq;var kq,zq,Gq,Hq,Vq,Wq,jq,Xq,Yq,qq,Kq,Zq,Qq,Jq,$q,tK,eK={maxParticleDeltaTime:0,createData:function(){return cw.add()},updateRenderData:function(){},fillBuffers:function(t,e){if(null!==t){var i=t._simulator.renderData;if(0!==i.vertexCount&&0!==i.indicesCount){var r=e.acquireBufferBatch(),n=r.byteOffset>>2,s=r.indicesOffset,a=r.vertexOffset;r.request(i.vertexCount,i.indicesCount)||(r=e.currBufferBatch,s=0,a=0);for(var o=r.vData,h=r.iData,l=i.vData,u=i.iData,c=9*i.vertexCount,_=0;_<c;_++)o[n++]=l[_];for(var d=i.indicesCount,p=0;p<d;p++)h[s++]=u[p]+a}}}},iK=t("ParticleSystem2DAssembler",{getAssembler:function(){return eK.maxParticleDeltaTime||(eK.maxParticleDeltaTime=_.game.frameTime/1e3*2),eK}});Mq.Assembler=iK;var rK,nK,sK,aK,oK,hK,lK,uK,cK,_K,dK,pK,fK,mK,gK,vK,yK,TK,EK,SK,bK,AK,CK,wK,RK,xK,OK,IK,MK,BK,PK=function(e){return t({Billboard:e,BillboardComponent:e}),e}((kq=Ne("cc.Billboard"),zq=qe(),Gq=We(),Hq=pi(pp),Vq=pi(pp),Wq=$e(),jq=$e(),Xq=$e(),Yq=$e(),kq(qq=zq(qq=Gq(qq=Ve((tK=function(t){function e(){var e;return l(e=t.call(this)||this,"_texture",Zq,a(e)),l(e,"_height",Qq,a(e)),l(e,"_width",Jq,a(e)),l(e,"_rotation",$q,a(e)),e._model=null,e._mesh=null,e._material=null,e._uniform=new Os(1,1,0,0),e}s(e,t),r(e,[{key:"texture",get:function(){return this._texture},set:function(t){this._texture=t,this._material&&this._material.setProperty("mainTexture",t)}},{key:"height",get:function(){return this._height},set:function(t){this._height=t,this._material&&(this._uniform.y=t,this._material.setProperty("cc_size_rotation",this._uniform))}},{key:"width",get:function(){return this._width},set:function(t){this._width=t,this._material&&(this._uniform.x=t,this._material.setProperty("cc_size_rotation",this._uniform))}},{key:"rotation",get:function(){return Math.round(100*Nr(this._rotation))/100},set:function(t){this._rotation=Pr(t),this._material&&(this._uniform.z=this._rotation,this._material.setProperty("cc_size_rotation",this._uniform))}}]);var i=e.prototype;return i.onLoad=function(){this.createModel()},i.onEnable=function(){this.attachToScene(),this._model.enabled=!0,this.width=this._width,this.height=this._height,this.rotation=this.rotation,this.texture=this.texture},i.onDisable=function(){this.detachFromScene()},i.attachToScene=function(){this._model&&this.node&&this.node.scene&&(this._model.scene&&this.detachFromScene(),this._getRenderScene().addModel(this._model))},i.detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},i.createModel=function(){this._mesh=Yb({primitiveMode:ol.TRIANGLE_LIST,positions:[0,0,0,0,0,0,0,0,0,0,0,0],uvs:[0,0,1,0,0,1,1,1],colors:[Qs.WHITE.r,Qs.WHITE.g,Qs.WHITE.b,Qs.WHITE.a,Qs.WHITE.r,Qs.WHITE.g,Qs.WHITE.b,Qs.WHITE.a,Qs.WHITE.r,Qs.WHITE.g,Qs.WHITE.b,Qs.WHITE.a,Qs.WHITE.r,Qs.WHITE.g,Qs.WHITE.b,Qs.WHITE.a],attributes:[new hu(tl.ATTR_POSITION,il.RGB32F),new hu(tl.ATTR_TEX_COORD,il.RG32F),new hu(tl.ATTR_COLOR,il.RGBA8UI,!0)],indices:[0,1,2,1,2,3]},void 0,{calculateBounds:!1});var t=this._model=_.director.root.createModel(aC,this.node);t.node=t.transform=this.node,null==this._material&&(this._material=new mg,this._material.copy(wm.get("default-billboard-material"))),t.initSubModel(0,this._mesh.renderingSubMeshes[0],this._material)},e}(ds),Zq=u((Kq=tK).prototype,"_texture",[Hq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u(Kq.prototype,"texture",[Vq,Wq],Object.getOwnPropertyDescriptor(Kq.prototype,"texture"),Kq.prototype),Qq=u(Kq.prototype,"_height",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),u(Kq.prototype,"height",[jq],Object.getOwnPropertyDescriptor(Kq.prototype,"height"),Kq.prototype),Jq=u(Kq.prototype,"_width",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),u(Kq.prototype,"width",[Xq],Object.getOwnPropertyDescriptor(Kq.prototype,"width"),Kq.prototype),$q=u(Kq.prototype,"_rotation",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),u(Kq.prototype,"rotation",[Yq],Object.getOwnPropertyDescriptor(Kq.prototype,"rotation"),Kq.prototype),qq=Kq))||qq)||qq)||qq)||qq)),NK=[new hu(tl.ATTR_POSITION,il.RGB32F),new hu(tl.ATTR_TEX_COORD,il.RGBA32F),new hu(tl.ATTR_TEX_COORD1,il.RGB32F),new hu(tl.ATTR_COLOR,il.RGBA8,!0)],LK=new Cs,FK=new Cs,DK=function(t){function e(){var e;return(e=t.call(this)||this)._capacity=void 0,e._vertSize=0,e._vBuffer=null,e._vertAttrsFloatCount=0,e._vdataF32=null,e._vdataUint32=null,e._iaInfo=void 0,e._iaInfoBuffer=void 0,e._subMeshData=null,e._vertCount=0,e._indexCount=0,e._material=null,e.type=XA.LINE,e._capacity=100,e._iaInfo=new ql([new Xl]),e._iaInfoBuffer=e._device.createBuffer(new Kl(rl.INDIRECT,nl.HOST|nl.DEVICE,Yl,Yl)),e}s(e,t);var i=e.prototype;return i.setCapacity=function(t){this._capacity=t,this.createBuffer()},i.createBuffer=function(){this._vertSize=0;for(var t,e=h(NK);!(t=e()).done;){var i=t.value;i.offset=this._vertSize,this._vertSize+=zl[i.format].size}this._vertAttrsFloatCount=this._vertSize/4,this._vBuffer=this.createSubMeshData(),this._vdataF32=new Float32Array(this._vBuffer),this._vdataUint32=new Uint32Array(this._vBuffer)},i.updateMaterial=function(e){this._material=e,t.prototype.setSubModelMaterial.call(this,0,e)},i.createSubMeshData=function(){this._subMeshData&&this.destroySubMeshData(),this._vertCount=2,this._indexCount=6;var t=this._device.createBuffer(new Kl(rl.VERTEX|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,this._vertSize*this._capacity*this._vertCount,this._vertSize)),e=new ArrayBuffer(this._vertSize*this._capacity*this._vertCount);t.update(e);for(var i=new Uint16Array((this._capacity-1)*this._indexCount),r=0,n=0;n<this._capacity-1;++n){var s=2*n;i[r++]=s,i[r++]=s+1,i[r++]=s+2,i[r++]=s+3,i[r++]=s+2,i[r++]=s+1}var a=this._device.createBuffer(new Kl(rl.INDEX|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,(this._capacity-1)*this._indexCount*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT));return a.update(i),this._iaInfo.drawInfos[0].vertexCount=this._capacity*this._vertCount,this._iaInfo.drawInfos[0].indexCount=(this._capacity-1)*this._indexCount,this._iaInfoBuffer.update(this._iaInfo),this._subMeshData=new xf([t],NK,ol.TRIANGLE_LIST,a,this._iaInfoBuffer),this.initSubModel(0,this._subMeshData,this._material),e},i.addLineVertexData=function(t,e,i){if(t.length>1){var r=0;Cs.subtract(LK,t[1],t[0]),this._vdataF32[r++]=t[0].x,this._vdataF32[r++]=t[0].y,this._vdataF32[r++]=t[0].z,this._vdataF32[r++]=0,this._vdataF32[r++]=e.evaluate(0,1),this._vdataF32[r++]=0,this._vdataF32[r++]=0,this._vdataF32[r++]=LK.x,this._vdataF32[r++]=LK.y,this._vdataF32[r++]=LK.z,this._vdataUint32[r++]=i.evaluate(0,1)._val,this._vdataF32[r++]=t[0].x,this._vdataF32[r++]=t[0].y,this._vdataF32[r++]=t[0].z,this._vdataF32[r++]=1,this._vdataF32[r++]=e.evaluate(0,1),this._vdataF32[r++]=0,this._vdataF32[r++]=1,this._vdataF32[r++]=LK.x,this._vdataF32[r++]=LK.y,this._vdataF32[r++]=LK.z,this._vdataUint32[r++]=i.evaluate(0,1)._val;for(var n=1;n<t.length-1;n++){Cs.subtract(LK,t[n-1],t[n]),Cs.subtract(FK,t[n+1],t[n]),Cs.subtract(FK,FK,LK);var s=n/t.length;this._vdataF32[r++]=t[n].x,this._vdataF32[r++]=t[n].y,this._vdataF32[r++]=t[n].z,this._vdataF32[r++]=0,this._vdataF32[r++]=e.evaluate(s,1),this._vdataF32[r++]=s,this._vdataF32[r++]=0,this._vdataF32[r++]=FK.x,this._vdataF32[r++]=FK.y,this._vdataF32[r++]=FK.z,this._vdataUint32[r++]=i.evaluate(s,1)._val,this._vdataF32[r++]=t[n].x,this._vdataF32[r++]=t[n].y,this._vdataF32[r++]=t[n].z,this._vdataF32[r++]=1,this._vdataF32[r++]=e.evaluate(s,1),this._vdataF32[r++]=s,this._vdataF32[r++]=1,this._vdataF32[r++]=FK.x,this._vdataF32[r++]=FK.y,this._vdataF32[r++]=FK.z,this._vdataUint32[r++]=i.evaluate(s,1)._val}Cs.subtract(LK,t[t.length-1],t[t.length-2]),this._vdataF32[r++]=t[t.length-1].x,this._vdataF32[r++]=t[t.length-1].y,this._vdataF32[r++]=t[t.length-1].z,this._vdataF32[r++]=0,this._vdataF32[r++]=e.evaluate(1,1),this._vdataF32[r++]=1,this._vdataF32[r++]=0,this._vdataF32[r++]=LK.x,this._vdataF32[r++]=LK.y,this._vdataF32[r++]=LK.z,this._vdataUint32[r++]=i.evaluate(1,1)._val,this._vdataF32[r++]=t[t.length-1].x,this._vdataF32[r++]=t[t.length-1].y,this._vdataF32[r++]=t[t.length-1].z,this._vdataF32[r++]=1,this._vdataF32[r++]=e.evaluate(1,1),this._vdataF32[r++]=1,this._vdataF32[r++]=1,this._vdataF32[r++]=LK.x,this._vdataF32[r++]=LK.y,this._vdataF32[r++]=LK.z,this._vdataUint32[r++]=i.evaluate(1,1)._val}this.updateIA(Math.max(0,t.length-1))},i.updateIA=function(t){this._subModels[0].inputAssembler.vertexBuffers[0].update(this._vdataF32),this._iaInfo.drawInfos[0].firstIndex=0,this._iaInfo.drawInfos[0].indexCount=this._indexCount*t,this._iaInfoBuffer.update(this._iaInfo)},i.destroySubMeshData=function(){this._subMeshData&&(this._subMeshData.destroy(),this._subMeshData=null)},e}(aC),UK=Pt({Constant:0,Curve:1,TwoCurves:2,TwoConstants:3}),kK=t("CurveRange",(rK=Ne("cc.CurveRange"),nK=pi(UK),sK=pi(N_),aK=pi(N_),oK=pi(N_),rK((yK=vK=function(){function t(){l(this,"mode",uK,this),l(this,"curve",cK,this),l(this,"curveMin",_K,this),l(this,"curveMax",dK,this),l(this,"constant",pK,this),l(this,"constantMin",fK,this),l(this,"constantMax",mK,this),l(this,"multiplier",gK,this)}var e=t.prototype;return e.evaluate=function(t,e){switch(this.mode){case UK.Constant:return this.constant;case UK.Curve:return this.curve.evaluate(t)*this.multiplier;case UK.TwoCurves:return Br(this.curveMin.evaluate(t),this.curveMax.evaluate(t),e)*this.multiplier;case UK.TwoConstants:return Br(this.constantMin,this.constantMax,e)}},e.getMax=function(){switch(this.mode){case UK.Constant:return this.constant;case UK.Curve:return this.multiplier;case UK.TwoConstants:return this.constantMax;case UK.TwoCurves:return this.multiplier}return 0},e._onBeforeSerialize=function(){return(!1)[this.mode]},t}(),vK.Mode=UK,uK=u((lK=yK).prototype,"mode",[nK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return UK.Constant}}),cK=u(lK.prototype,"curve",[sK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new N_}}),_K=u(lK.prototype,"curveMin",[aK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new N_}}),dK=u(lK.prototype,"curveMax",[oK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new N_}}),pK=u(lK.prototype,"constant",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),fK=u(lK.prototype,"constantMin",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),mK=u(lK.prototype,"constantMax",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),gK=u(lK.prototype,"multiplier",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),hK=lK))||hK));function zK(t,e,i){switch(t.mode){case UK.Constant:return t.constant;case UK.Curve:return t.curve.evaluate(e)*t.multiplier;case UK.TwoCurves:return 0===i?t.curveMin.evaluate(e)*t.multiplier:t.curveMax.evaluate(e)*t.multiplier;case UK.TwoConstants:return 0===i?t.constantMin:t.constantMax;default:return 0}}function GK(t){switch(t.mode){case UK.TwoConstants:case UK.TwoCurves:return 2;default:return 1}}function HK(t,e,i){var r=new Dd({width:e,height:i,_data:t,_compressed:!1,format:Rd.RGBA32F}),n=new pp;return n.setFilters(Od.NEAREST,Od.NEAREST),n.setMipFilter(Od.NONE),n.setWrapMode(xd.CLAMP_TO_EDGE,xd.CLAMP_TO_EDGE,xd.CLAMP_TO_EDGE),n.image=r,n}function VK(t,e,i,r,n){for(var s=Math.max(GK(e),GK(i),GK(r)),a=new Float32Array(t*s*4),o=[e,i,r],h=1/(t-1),l=0;l<s;l++)for(var u=0;u<3;u++)for(var c=o[u],_=0,d=0,p=0;p<t;p++){var f=zK(c,h*p,l);d=n?f:(_+=f)/(p+1),a[4*p+u]=d}return HK(a,t,s)}var WK,jK,XK,YK,qK,KK,ZK,QK,JK,$K,tZ,eZ,iZ,rZ,nZ,sZ,aZ,oZ,hZ,lZ,uZ,cZ,_Z,dZ,pZ,fZ,mZ,gZ,vZ,yZ,TZ,EZ,SZ,bZ,AZ,CZ,wZ,RZ,xZ,OZ,IZ,MZ,BZ,PZ,NZ,LZ,FZ,DZ,UZ,kZ,zZ,GZ,HZ,VZ,WZ=Pt({Blend:0,Fixed:1}),jZ=(Ne("cc.ColorKey")((EK=u((TK=function(){l(this,"color",EK,this),l(this,"time",SK,this)}).prototype,"color",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Qs.WHITE.clone()}}),SK=u(TK.prototype,"time",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),TK)),Ne("cc.AlphaKey")((AK=u((bK=function(){l(this,"alpha",AK,this),l(this,"time",CK,this)}).prototype,"alpha",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),CK=u(bK.prototype,"time",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),bK)),Ne("cc.Gradient")((BK=MK=function(){function t(){l(this,"colorKeys",xK,this),l(this,"alphaKeys",OK,this),l(this,"mode",IK,this),this._color=void 0,this._color=Qs.WHITE.clone()}var e=t.prototype;return e.setKeys=function(t,e){this.colorKeys=t,this.alphaKeys=e},e.sortKeys=function(){this.colorKeys.length>1&&this.colorKeys.sort((function(t,e){return t.time-e.time})),this.alphaKeys.length>1&&this.alphaKeys.sort((function(t,e){return t.time-e.time}))},e.evaluate=function(t){return this.getRGB(t),this._color._set_a_unsafe(this.getAlpha(t)),this._color},e.randomColor=function(){var t=this.colorKeys[Math.trunc(Math.random()*this.colorKeys.length)],e=this.alphaKeys[Math.trunc(Math.random()*this.alphaKeys.length)];return this._color.set(t.color),this._color._set_a_unsafe(e.alpha),this._color},e.getRGB=function(t){if(!(this.colorKeys.length>1))return 1===this.colorKeys.length?(this._color.set(this.colorKeys[0].color),this._color):(this._color.set(Qs.WHITE),this._color);t=Hr(t,1);for(var e=1;e<this.colorKeys.length;++e){var i=this.colorKeys[e-1].time,r=this.colorKeys[e].time;if(t>=i&&t<r){if(this.mode===WZ.Fixed)return this.colorKeys[e].color;var n=(t-i)/(r-i);return Qs.lerp(this._color,this.colorKeys[e-1].color,this.colorKeys[e].color,n),this._color}}var s=this.colorKeys.length-1;t<this.colorKeys[0].time?Qs.lerp(this._color,Qs.BLACK,this.colorKeys[0].color,t/this.colorKeys[0].time):t>this.colorKeys[s].time&&Qs.lerp(this._color,this.colorKeys[s].color,Qs.BLACK,(t-this.colorKeys[s].time)/(1-this.colorKeys[s].time))},e.getAlpha=function(t){if(!(this.alphaKeys.length>1))return 1===this.alphaKeys.length?this.alphaKeys[0].alpha:255;t=Hr(t,1);for(var e=1;e<this.alphaKeys.length;++e){var i=this.alphaKeys[e-1].time,r=this.alphaKeys[e].time;if(t>=i&&t<r){if(this.mode===WZ.Fixed)return this.alphaKeys[e].alpha;var n=(t-i)/(r-i);return Br(this.alphaKeys[e-1].alpha,this.alphaKeys[e].alpha,n)}}var s=this.alphaKeys.length-1;return t<this.alphaKeys[0].time?Br(255,this.alphaKeys[0].alpha,t/this.alphaKeys[0].time):t>this.alphaKeys[s].time?Br(this.alphaKeys[s].alpha,255,(t-this.alphaKeys[s].time)/(1-this.alphaKeys[s].time)):void 0},t}(),MK.Mode=WZ,xK=u((RK=BK).prototype,"colorKeys",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Array}}),OK=u(RK.prototype,"alphaKeys",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Array}}),IK=u(RK.prototype,"mode",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return WZ.Blend}}),wK=RK))||wK),XZ=Pt({Color:0,Gradient:1,TwoColors:2,TwoGradients:3,RandomColor:4}),YZ=t("GradientRange",(WK=Ne("cc.GradientRange"),jK=pi(XZ),XK=pi(jZ),YK=pi(jZ),qK=pi(jZ),KK=pi(XZ),WK((aZ=sZ=function(){function t(){l(this,"color",JK,this),l(this,"colorMin",$K,this),l(this,"colorMax",tZ,this),l(this,"gradient",eZ,this),l(this,"gradientMin",iZ,this),l(this,"gradientMax",rZ,this),l(this,"_mode",nZ,this),this._color=Qs.WHITE.clone()}var e=t.prototype;return e.evaluate=function(t,e){switch(this._mode){case XZ.Color:return this.color;case XZ.TwoColors:return Qs.lerp(this._color,this.colorMin,this.colorMax,e),this._color;case XZ.RandomColor:return this.gradient.randomColor();case XZ.Gradient:return this.gradient.evaluate(t);case XZ.TwoGradients:return Qs.lerp(this._color,this.gradientMin.evaluate(t),this.gradientMax.evaluate(t),e),this._color;default:return this.color}},e._onBeforeSerialize=function(){return(!1)[this._mode]},r(t,[{key:"mode",get:function(){return this._mode},set:function(t){this._mode=t}}]),t}(),sZ.Mode=XZ,u((QK=aZ).prototype,"mode",[jK],Object.getOwnPropertyDescriptor(QK.prototype,"mode"),QK.prototype),JK=u(QK.prototype,"color",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Qs.WHITE.clone()}}),$K=u(QK.prototype,"colorMin",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Qs.WHITE.clone()}}),tZ=u(QK.prototype,"colorMax",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Qs.WHITE.clone()}}),eZ=u(QK.prototype,"gradient",[XK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new jZ}}),iZ=u(QK.prototype,"gradientMin",[YK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new jZ}}),rZ=u(QK.prototype,"gradientMax",[qK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new jZ}}),nZ=u(QK.prototype,"_mode",[KK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return XZ.Color}}),ZK=QK))||ZK));function qZ(t,e,i){switch(t.mode){case XZ.Color:return t.color;case XZ.TwoColors:return 0===i?t.colorMin:t.colorMax;case XZ.RandomColor:return t.gradient.randomColor();case XZ.Gradient:return t.gradient.evaluate(e);case XZ.TwoGradients:return 0===i?t.gradientMin.evaluate(e):t.gradientMax.evaluate(e);default:return t.color}}var KZ,ZZ,QZ,JZ,$Z,tQ,eQ,iQ,rQ,nQ,sQ,aQ,oQ,hQ,lQ,uQ,cQ,_Q,dQ,pQ,fQ,mQ,gQ,vQ,yQ,TQ,EQ,SQ,bQ,AQ,CQ,wQ,RQ,xQ,OQ={parent:null,owner:null,subModelIdx:0},IQ={CC_USE_WORLD_SPACE:!1},MQ=function(e){return t({Line:e,LineComponent:e}),e}((oZ=Ne("cc.Line"),hZ=qe(),lZ=We(),uZ=pi(pp),cZ=pi(pp),_Z=si(),dZ=$e(),pZ=si(),fZ=$e(),mZ=pi([Cs]),gZ=pi([Cs]),vZ=si(),yZ=$e(),TZ=pi(kK),EZ=pi(kK),SZ=si(),bZ=$e(),AZ=pi(Es),CZ=si(),wZ=$e(),RZ=pi(Es),xZ=si(),OZ=$e(),IZ=pi(YZ),MZ=pi(YZ),BZ=si(),PZ=$e(),oZ(NZ=hZ(NZ=lZ(NZ=Ve((VZ=function(t){function e(){var e;return l(e=t.call(this)||this,"_texture",FZ,a(e)),e._material=null,e._materialInstance=null,l(e,"_worldSpace",DZ,a(e)),l(e,"_positions",UZ,a(e)),l(e,"_width",kZ,a(e)),l(e,"_tile",zZ,a(e)),l(e,"_offset",GZ,a(e)),l(e,"_color",HZ,a(e)),e._model=null,e._tile_offset=new Os,e}s(e,t),r(e,[{key:"texture",get:function(){return this._texture},set:function(t){this._texture=t,this._materialInstance&&this._materialInstance.setProperty("mainTexture",t)}},{key:"worldSpace",get:function(){return this._worldSpace},set:function(t){this._worldSpace=t,this._materialInstance&&(IQ.CC_USE_WORLD_SPACE=this.worldSpace,this._materialInstance.recompileShaders(IQ),this._model&&this._model.setSubModelMaterial(0,this._materialInstance))}},{key:"positions",get:function(){return this._positions},set:function(t){this._positions=t,this._model&&this._model.addLineVertexData(this._positions,this._width,this._color)}},{key:"width",get:function(){return this._width},set:function(t){this._width=t,this._model&&this._model.addLineVertexData(this._positions,this._width,this._color)}},{key:"tile",get:function(){return this._tile},set:function(t){this._tile.set(t),this._materialInstance&&(this._tile_offset.x=this._tile.x,this._tile_offset.y=this._tile.y,this._materialInstance.setProperty("mainTiling_Offset",this._tile_offset))}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset.set(t),this._materialInstance&&(this._tile_offset.z=this._offset.x,this._tile_offset.w=this._offset.y,this._materialInstance.setProperty("mainTiling_Offset",this._tile_offset))}},{key:"color",get:function(){return this._color},set:function(t){this._color=t,this._model&&this._model.addLineVertexData(this._positions,this._width,this._color)}}]);var i=e.prototype;return i.onLoad=function(){var t=this._model=_.director.root.createModel(DK);t.node=t.transform=this.node,null===this._material&&(this._material=new mg,this._material.copy(wm.get("default-trail-material")),IQ.CC_USE_WORLD_SPACE=this.worldSpace,OQ.parent=this._material,OQ.subModelIdx=0,this._materialInstance=new Lg(OQ),this._materialInstance.recompileShaders(IQ)),t.updateMaterial(this._materialInstance),t.setCapacity(100)},i.onEnable=function(){this._model&&(this._attachToScene(),this.texture=this._texture,this.tile=this._tile,this.offset=this._offset,this._model.addLineVertexData(this._positions,this._width,this._color))},i.onDisable=function(){this._model&&this._detachFromScene()},i._attachToScene=function(){this._model&&this.node&&this.node.scene&&(this._model.scene&&this._detachFromScene(),this._getRenderScene().addModel(this._model))},i._detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},e}(ds),FZ=u((LZ=VZ).prototype,"_texture",[uZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u(LZ.prototype,"texture",[cZ,_Z,dZ],Object.getOwnPropertyDescriptor(LZ.prototype,"texture"),LZ.prototype),DZ=u(LZ.prototype,"_worldSpace",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),u(LZ.prototype,"worldSpace",[pZ,fZ],Object.getOwnPropertyDescriptor(LZ.prototype,"worldSpace"),LZ.prototype),UZ=u(LZ.prototype,"_positions",[mZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),u(LZ.prototype,"positions",[gZ,vZ,yZ],Object.getOwnPropertyDescriptor(LZ.prototype,"positions"),LZ.prototype),kZ=u(LZ.prototype,"_width",[TZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),u(LZ.prototype,"width",[EZ,SZ,bZ],Object.getOwnPropertyDescriptor(LZ.prototype,"width"),LZ.prototype),zZ=u(LZ.prototype,"_tile",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Es(1,1)}}),u(LZ.prototype,"tile",[AZ,CZ,wZ],Object.getOwnPropertyDescriptor(LZ.prototype,"tile"),LZ.prototype),GZ=u(LZ.prototype,"_offset",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Es(0,0)}}),u(LZ.prototype,"offset",[RZ,xZ,OZ],Object.getOwnPropertyDescriptor(LZ.prototype,"offset"),LZ.prototype),HZ=u(LZ.prototype,"_color",[IZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new YZ}}),u(LZ.prototype,"color",[MZ,BZ,PZ],Object.getOwnPropertyDescriptor(LZ.prototype,"color"),LZ.prototype),NZ=LZ))||NZ)||NZ)||NZ)||NZ)),BQ=function(t){this.particleSystem=void 0,this.position=void 0,this.velocity=void 0,this.animatedVelocity=void 0,this.ultimateVelocity=void 0,this.angularVelocity=void 0,this.axisOfRotation=void 0,this.rotation=void 0,this.startSize=void 0,this.size=void 0,this.startColor=void 0,this.color=void 0,this.randomSeed=void 0,this.remainingLifetime=void 0,this.startLifetime=void 0,this.emitAccumulator0=void 0,this.emitAccumulator1=void 0,this.frameIndex=void 0,this.startRow=void 0,this.particleSystem=t,this.position=new Cs(0,0,0),this.velocity=new Cs(0,0,0),this.animatedVelocity=new Cs(0,0,0),this.ultimateVelocity=new Cs(0,0,0),this.angularVelocity=new Cs(0,0,0),this.axisOfRotation=new Cs(0,0,0),this.rotation=new Cs(0,0,0),this.startSize=new Cs(0,0,0),this.size=new Cs(0,0,0),this.startColor=Qs.WHITE.clone(),this.color=Qs.WHITE.clone(),this.randomSeed=0,this.remainingLifetime=0,this.startLifetime=0,this.emitAccumulator0=0,this.emitAccumulator1=0,this.frameIndex=0,this.startRow=0},PQ=["sizeModule","colorModule","forceModule","velocityModule","limitModule","rotationModule","textureModule"],NQ=["_colorOverLifetimeModule","_shapeModule","_sizeOvertimeModule","_velocityOvertimeModule","_forceOvertimeModule","_limitVelocityOvertimeModule","_rotationOvertimeModule","_textureAnimationModule","_trailModule"],LQ=function(){function t(){this.target=null,this.needUpdate=!1,this.needAnimate=!0,this.name=void 0}var e=t.prototype;return e.bindTarget=function(t){this.target=t},e.update=function(){},t}(),FQ=Pt({World:0,Local:1,Custom:2}),DQ=Pt({Billboard:0,StrecthedBillboard:1,HorizontalBillboard:2,VerticalBillboard:3,Mesh:4}),UQ=Pt({Box:0,Circle:1,Cone:2,Sphere:3,Hemisphere:4}),kQ=Pt({Base:0,Edge:1,Shell:2,Volume:3}),zQ=Pt({Random:0,Loop:1,PingPong:2}),GQ=Pt({Particles:0}),HQ=Pt({Stretch:0}),VQ=(KZ=Ne("cc.ColorOvertimeModule"),ZZ=si(),QZ=pi(YZ),JZ=si(),KZ((rQ=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"_enable",eQ,a(e)),l(e,"color",iQ,a(e)),e.name="colorModule",e}return s(e,t),e.prototype.animate=function(t){t.color.set(t.startColor),t.color.multiply(this.color.evaluate(1-t.remainingLifetime/t.startLifetime,Ur(t.randomSeed+91041)))},r(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]),e}(LQ),eQ=u((tQ=rQ).prototype,"_enable",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),u(tQ.prototype,"enable",[ZZ],Object.getOwnPropertyDescriptor(tQ.prototype,"enable"),tQ.prototype),iQ=u(tQ.prototype,"color",[QZ,ke,JZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new YZ}}),$Z=tQ))||$Z),WQ=new Cs(0,0,-1);function jQ(t,e,i,r){return e!==t?(t===FQ.World||Hs.invert(i,i),Hs.getRotation(r,i),!0):(Ns.set(r,0,0,0,1),!1)}function XQ(t,e){Es.set(t,Math.cos(e),Math.sin(e))}function YQ(t){var e=Fr(-1,1),i=Fr(0,2*Math.PI),r=Math.sqrt(1-e*e),n=r*Math.cos(i),s=r*Math.sin(i);Cs.set(t,n,s,e)}function qQ(t,e,i){YQ(t),Cs.multiplyScalar(t,t,e+(i-e)*Lr())}function KQ(t,e,i,r){XQ(t,r),t.z=0,Cs.multiplyScalar(t,t,e+(i-e)*Lr())}function ZQ(t){for(var e=0;e<t.length;e++){var i=e+Dr(0,t.length-e),r=t[i];t[i]=t[e],t[e]=r}}function QQ(){var t=Fr(-1,1);return 0===t&&t++,fs(t)}var JQ,$Q,tJ,eJ,iJ,rJ,nJ,sJ,aJ,oJ,hJ,lJ,uJ,cJ,_J,dJ,pJ,fJ,mJ,gJ,vJ,yJ,TJ,EJ,SJ,bJ,AJ,CJ,wJ,RJ,xJ,OJ,IJ,MJ,BJ,PJ,NJ,LJ,FJ,DJ,UJ,kJ,zJ,GJ,HJ,VJ,WJ,jJ,XJ,YJ,qJ,KJ,ZJ,QJ,JJ,$J,t$,e$,i$,r$,n$=new Cs,s$=(nQ=Ne("cc.ForceOvertimeModule"),sQ=si(),aQ=pi(kK),oQ=ti(),hQ=si(),lQ=$e(),uQ=pi(kK),cQ=ti(),_Q=si(),dQ=$e(),pQ=pi(kK),fQ=ti(),mQ=si(),gQ=$e(),vQ=pi(FQ),yQ=si(),TQ=$e(),nQ((xQ=function(t){function e(){var e;return l(e=t.call(this)||this,"_enable",bQ,a(e)),l(e,"x",AQ,a(e)),l(e,"y",CQ,a(e)),l(e,"z",wQ,a(e)),l(e,"space",RQ,a(e)),e.randomized=!1,e.rotation=void 0,e.needTransform=void 0,e.name="forceModule",e.rotation=new Ns,e.needTransform=!1,e.needUpdate=!0,e}s(e,t),r(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]);var i=e.prototype;return i.update=function(t,e){this.needTransform=jQ(t,this.space,e,this.rotation)},i.animate=function(t,e){var i=1-t.remainingLifetime/t.startLifetime,r=Cs.set(n$,this.x.evaluate(i,Ur(t.randomSeed+212165)),this.y.evaluate(i,Ur(t.randomSeed+212165)),this.z.evaluate(i,Ur(t.randomSeed+212165)));this.needTransform&&Cs.transformQuat(r,r,this.rotation),Cs.scaleAndAdd(t.velocity,t.velocity,r,e),Cs.copy(t.ultimateVelocity,t.velocity)},e}(LQ),bQ=u((SQ=xQ).prototype,"_enable",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),u(SQ.prototype,"enable",[sQ],Object.getOwnPropertyDescriptor(SQ.prototype,"enable"),SQ.prototype),AQ=u(SQ.prototype,"x",[aQ,ke,oQ,hQ,lQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),CQ=u(SQ.prototype,"y",[uQ,ke,cQ,_Q,dQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),wQ=u(SQ.prototype,"z",[pQ,ke,fQ,mQ,gQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),RQ=u(SQ.prototype,"space",[vQ,ke,yQ,TQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return FQ.Local}}),EQ=SQ))||EQ),a$=new Cs,o$=new Cs,h$=(JQ=Ne("cc.LimitVelocityOvertimeModule"),$Q=si(),tJ=pi(kK),eJ=ti(),iJ=si(),rJ=$e(),nJ=pi(kK),sJ=ti(),aJ=si(),oJ=$e(),hJ=pi(kK),lJ=ti(),uJ=si(),cJ=$e(),_J=pi(kK),dJ=ti(),pJ=si(),fJ=$e(),mJ=si(),gJ=$e(),vJ=si(),yJ=$e(),TJ=pi(FQ),EJ=si(),SJ=$e(),JQ((PJ=function(t){function e(){var e;return l(e=t.call(this)||this,"_enable",CJ,a(e)),l(e,"limitX",wJ,a(e)),l(e,"limitY",RJ,a(e)),l(e,"limitZ",xJ,a(e)),l(e,"limit",OJ,a(e)),l(e,"dampen",IJ,a(e)),l(e,"separateAxes",MJ,a(e)),l(e,"space",BJ,a(e)),e.drag=null,e.multiplyDragByParticleSize=!1,e.multiplyDragByParticleVelocity=!1,e.name="limitModule",e.rotation=void 0,e.needTransform=void 0,e.rotation=new Ns,e.needTransform=!1,e.needUpdate=!0,e}s(e,t),r(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]);var i=e.prototype;return i.update=function(t,e){this.needTransform=jQ(t,this.space,e,this.rotation)},i.animate=function(t){var e=1-t.remainingLifetime/t.startLifetime,i=a$;this.separateAxes?(Cs.set(o$,this.limitX.evaluate(e,Ur(t.randomSeed+23541)),this.limitY.evaluate(e,Ur(t.randomSeed+23541)),this.limitZ.evaluate(e,Ur(t.randomSeed+23541))),this.needTransform&&Cs.transformQuat(o$,o$,this.rotation),Cs.set(i,l$(t.ultimateVelocity.x,o$.x,this.dampen),l$(t.ultimateVelocity.y,o$.y,this.dampen),l$(t.ultimateVelocity.z,o$.z,this.dampen))):(Cs.normalize(i,t.ultimateVelocity),Cs.multiplyScalar(i,i,l$(t.ultimateVelocity.length(),this.limit.evaluate(e,Ur(t.randomSeed+23541)),this.dampen))),Cs.copy(t.ultimateVelocity,i)},e}(LQ),CJ=u((AJ=PJ).prototype,"_enable",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),u(AJ.prototype,"enable",[$Q],Object.getOwnPropertyDescriptor(AJ.prototype,"enable"),AJ.prototype),wJ=u(AJ.prototype,"limitX",[tJ,ke,eJ,iJ,rJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),RJ=u(AJ.prototype,"limitY",[nJ,ke,sJ,aJ,oJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),xJ=u(AJ.prototype,"limitZ",[hJ,ke,lJ,uJ,cJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),OJ=u(AJ.prototype,"limit",[_J,ke,dJ,pJ,fJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),IJ=u(AJ.prototype,"dampen",[ke,mJ,gJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3}}),MJ=u(AJ.prototype,"separateAxes",[ke,vJ,yJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),BJ=u(AJ.prototype,"space",[TJ,ke,EJ,SJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return FQ.Local}}),bJ=AJ))||bJ);function l$(t,e,i){var r=Math.sign(t),n=Math.abs(t);return n>e&&(n=Br(n,e,i)),n*r}var u$,c$,_$,d$,p$,f$,m$,g$,v$,y$,T$,E$,S$,b$,A$,C$,w$,R$,x$,O$,I$,M$,B$,P$,N$,L$,F$,D$,U$,k$,z$,G$,H$,V$,W$,j$,X$,Y$,q$,K$,Z$,Q$,J$,$$,t0,e0,i0,r0,n0,s0,a0,o0,h0,l0,u0,c0,_0,d0,p0,f0,m0,g0,v0,y0,T0,E0,S0,b0,A0,C0,w0,R0,x0,O0,I0,M0,B0,P0,N0,L0,F0,D0,U0,k0,z0,G0,H0,V0,W0,j0,X0,Y0,q0,K0,Z0,Q0,J0,$0,t1,e1,i1,r1,n1,s1,a1,o1,h1,l1,u1,c1,_1,d1,p1,f1,m1,g1,v1,y1,T1,E1,S1,b1,A1,C1,w1,R1,x1,O1,I1,M1,B1,P1,N1,L1,F1,D1,U1,k1,z1,G1,H1,V1,W1,j1,X1,Y1,q1,K1,Z1,Q1,J1,$1,t2,e2,i2,r2,n2,s2,a2,o2,h2,l2,u2,c2,_2,d2,p2,f2,m2,g2,v2,y2,T2=(NJ=Ne("cc.RotationOvertimeModule"),LJ=si(),FJ=si(),DJ=$e(),UJ=pi(kK),kJ=ti(),zJ=si(),GJ=$e(),HJ=pi(kK),VJ=ti(),WJ=si(),jJ=$e(),XJ=pi(kK),YJ=ti(),qJ=si(),KJ=$e(),NJ((r$=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"_enable",JJ,a(e)),l(e,"_separateAxes",$J,a(e)),l(e,"x",t$,a(e)),l(e,"y",e$,a(e)),l(e,"z",i$,a(e)),e.name="rotationModule",e}return s(e,t),e.prototype.animate=function(t,e){var i=1-t.remainingLifetime/t.startLifetime;if(this._separateAxes){var r=Ur(t.randomSeed+125292);t.rotation.x+=this.x.evaluate(i,r)*e,t.rotation.y+=this.y.evaluate(i,r)*e,t.rotation.z+=this.z.evaluate(i,r)*e}else t.rotation.z+=this.z.evaluate(i,Ur(t.randomSeed+125292))*e},r(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}},{key:"separateAxes",get:function(){return this._separateAxes},set:function(t){this._separateAxes=t}}]),e}(LQ),JJ=u((QJ=r$).prototype,"_enable",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),u(QJ.prototype,"enable",[LJ],Object.getOwnPropertyDescriptor(QJ.prototype,"enable"),QJ.prototype),$J=u(QJ.prototype,"_separateAxes",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),u(QJ.prototype,"separateAxes",[FJ,DJ],Object.getOwnPropertyDescriptor(QJ.prototype,"separateAxes"),QJ.prototype),t$=u(QJ.prototype,"x",[UJ,ke,kJ,oi,zJ,GJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),e$=u(QJ.prototype,"y",[HJ,ke,VJ,oi,WJ,jJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),i$=u(QJ.prototype,"z",[XJ,ke,YJ,oi,qJ,KJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),ZJ=QJ))||ZJ),E2=(u$=Ne("cc.SizeOvertimeModule"),c$=si(),_$=si(),d$=$e(),p$=pi(kK),f$=si(),m$=$e(),g$=pi(kK),v$=si(),y$=$e(),T$=pi(kK),E$=si(),S$=$e(),b$=pi(kK),A$=si(),C$=$e(),u$((N$=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"_enable",x$,a(e)),l(e,"separateAxes",O$,a(e)),l(e,"size",I$,a(e)),l(e,"x",M$,a(e)),l(e,"y",B$,a(e)),l(e,"z",P$,a(e)),e.name="sizeModule",e}return s(e,t),e.prototype.animate=function(t){if(this.separateAxes){var e=1-t.remainingLifetime/t.startLifetime,i=Ur(t.randomSeed+39825);t.size.x=t.startSize.x*this.x.evaluate(e,i),t.size.y=t.startSize.y*this.y.evaluate(e,i),t.size.z=t.startSize.z*this.z.evaluate(e,i)}else Cs.multiplyScalar(t.size,t.startSize,this.size.evaluate(1-t.remainingLifetime/t.startLifetime,Ur(t.randomSeed+39825)))},r(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]),e}(LQ),x$=u((R$=N$).prototype,"_enable",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),u(R$.prototype,"enable",[c$],Object.getOwnPropertyDescriptor(R$.prototype,"enable"),R$.prototype),O$=u(R$.prototype,"separateAxes",[ke,_$,d$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),I$=u(R$.prototype,"size",[p$,ke,f$,m$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),M$=u(R$.prototype,"x",[g$,ke,v$,y$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),B$=u(R$.prototype,"y",[T$,ke,E$,S$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),P$=u(R$.prototype,"z",[b$,ke,A$,C$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),w$=R$))||w$),S2=Pt({Grid:0}),b2=Pt({WholeSheet:0,SingleRow:1}),A2=(L$=Ne("cc.TextureAnimationModule"),F$=ze("numTilesX"),D$=ze("numTilesY"),U$=si(),k$=pi(S2),z$=pi(S2),G$=si(),H$=$e(),V$=si(),W$=$e(),j$=si(),X$=$e(),Y$=pi(b2),q$=si(),K$=$e(),Z$=pi(kK),Q$=si(),J$=$e(),$$=pi(kK),t0=si(),e0=$e(),i0=si(),r0=$e(),n0=si(),s0=$e(),a0=si(),o0=$e(),L$((b0=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"_enable",u0,a(e)),l(e,"_numTilesX",c0,a(e)),l(e,"_numTilesY",_0,a(e)),l(e,"_mode",d0,a(e)),l(e,"animation",p0,a(e)),l(e,"frameOverTime",f0,a(e)),l(e,"startFrame",m0,a(e)),l(e,"cycleCount",g0,a(e)),l(e,"_flipU",v0,a(e)),l(e,"_flipV",y0,a(e)),l(e,"_uvChannelMask",T0,a(e)),l(e,"randomRow",E0,a(e)),l(e,"rowIndex",S0,a(e)),e.name="textureModule",e}s(e,t);var i=e.prototype;return i.init=function(t){t.startRow=Math.floor(Math.random()*this.numTilesY)},i.animate=function(t){var e=1-t.remainingLifetime/t.startLifetime,i=this.startFrame.evaluate(e,Ur(t.randomSeed+90794))/(this.numTilesX*this.numTilesY);if(this.animation===b2.WholeSheet)t.frameIndex=Hr(this.cycleCount*(this.frameOverTime.evaluate(e,Ur(t.randomSeed+90794))+i),1);else if(this.animation===b2.SingleRow){var r=1/this.numTilesY;if(this.randomRow){var n=Hr(this.cycleCount*(this.frameOverTime.evaluate(e,Ur(t.randomSeed+90794))+i),1),s=t.startRow*r,a=s+r;t.frameIndex=Br(s,a,n)}else{var o=this.rowIndex*r,h=o+r;t.frameIndex=Br(o,h,Hr(this.cycleCount*(this.frameOverTime.evaluate(e,Ur(t.randomSeed+90794))+i),1))}}},r(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&(this.target.updateMaterialParams(),this.target.enableModule(this.name,t,this)))}},{key:"mode",get:function(){return this._mode},set:function(t){t===S2.Grid||console.error("particle texture animation's sprites is not supported!")}},{key:"numTilesX",get:function(){return this._numTilesX},set:function(t){this._numTilesX!==t&&(this._numTilesX=t,this.target.updateMaterialParams())}},{key:"numTilesY",get:function(){return this._numTilesY},set:function(t){this._numTilesY!==t&&(this._numTilesY=t,this.target.updateMaterialParams())}},{key:"flipU",get:function(){return this._flipU},set:function(){console.error("particle texture animation's flipU is not supported!")}},{key:"flipV",get:function(){return this._flipV},set:function(){console.error("particle texture animation's flipV is not supported!")}},{key:"uvChannelMask",get:function(){return this._uvChannelMask},set:function(){console.error("particle texture animation's uvChannelMask is not supported!")}}]),e}(LQ),u0=u((l0=b0).prototype,"_enable",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),c0=u(l0.prototype,"_numTilesX",[F$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_0=u(l0.prototype,"_numTilesY",[D$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),u(l0.prototype,"enable",[U$],Object.getOwnPropertyDescriptor(l0.prototype,"enable"),l0.prototype),d0=u(l0.prototype,"_mode",[k$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return S2.Grid}}),u(l0.prototype,"mode",[z$,G$,H$],Object.getOwnPropertyDescriptor(l0.prototype,"mode"),l0.prototype),u(l0.prototype,"numTilesX",[V$,W$],Object.getOwnPropertyDescriptor(l0.prototype,"numTilesX"),l0.prototype),u(l0.prototype,"numTilesY",[j$,X$],Object.getOwnPropertyDescriptor(l0.prototype,"numTilesY"),l0.prototype),p0=u(l0.prototype,"animation",[Y$,ke,q$,K$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return b2.WholeSheet}}),f0=u(l0.prototype,"frameOverTime",[Z$,ke,Q$,J$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),m0=u(l0.prototype,"startFrame",[$$,ke,t0,e0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),g0=u(l0.prototype,"cycleCount",[ke,i0,r0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),v0=u(l0.prototype,"_flipU",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),y0=u(l0.prototype,"_flipV",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),T0=u(l0.prototype,"_uvChannelMask",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),E0=u(l0.prototype,"randomRow",[ke,n0,s0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),S0=u(l0.prototype,"rowIndex",[ke,a0,o0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),h0=l0))||h0),C2=new Cs,w2=(A0=Ne("cc.VelocityOvertimeModule"),C0=si(),w0=pi(kK),R0=ti(),x0=si(),O0=$e(),I0=pi(kK),M0=ti(),B0=si(),P0=$e(),N0=pi(kK),L0=ti(),F0=si(),D0=$e(),U0=pi(kK),k0=ti(),z0=si(),G0=$e(),H0=pi(FQ),V0=si(),W0=$e(),A0(($0=function(t){function e(){var e;return l(e=t.call(this)||this,"_enable",Y0,a(e)),l(e,"x",q0,a(e)),l(e,"y",K0,a(e)),l(e,"z",Z0,a(e)),l(e,"speedModifier",Q0,a(e)),l(e,"space",J0,a(e)),e.rotation=void 0,e.needTransform=void 0,e.name="velocityModule",e.rotation=new Ns,e.speedModifier.constant=1,e.needTransform=!1,e.needUpdate=!0,e}s(e,t),r(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]);var i=e.prototype;return i.update=function(t,e){this.needTransform=jQ(t,this.space,e,this.rotation)},i.animate=function(t){var e=1-t.remainingLifetime/t.startLifetime,i=Cs.set(C2,this.x.evaluate(e,Ur(197866^t.randomSeed)),this.y.evaluate(e,Ur(156497^t.randomSeed)),this.z.evaluate(e,Ur(984136^t.randomSeed)));this.needTransform&&Cs.transformQuat(i,i,this.rotation),Cs.add(t.animatedVelocity,t.animatedVelocity,i),Cs.add(t.ultimateVelocity,t.velocity,t.animatedVelocity),Cs.multiplyScalar(t.ultimateVelocity,t.ultimateVelocity,this.speedModifier.evaluate(1-t.remainingLifetime/t.startLifetime,Ur(t.randomSeed+197866)))},e}(LQ),Y0=u((X0=$0).prototype,"_enable",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),u(X0.prototype,"enable",[C0],Object.getOwnPropertyDescriptor(X0.prototype,"enable"),X0.prototype),q0=u(X0.prototype,"x",[w0,ke,R0,x0,O0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),K0=u(X0.prototype,"y",[I0,ke,M0,B0,P0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),Z0=u(X0.prototype,"z",[N0,ke,L0,F0,D0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),Q0=u(X0.prototype,"speedModifier",[U0,ke,k0,z0,G0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),J0=u(X0.prototype,"space",[H0,ke,V0,W0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return FQ.Local}}),j0=X0))||j0),R2=(t1=Ne("cc.Burst"),e1=pi(kK),t1((h1=function(){function t(){l(this,"_time",n1,this),l(this,"_repeatCount",s1,this),l(this,"repeatInterval",a1,this),l(this,"count",o1,this),this._remainingCount=void 0,this._curTime=void 0,this._remainingCount=0,this._curTime=0}r(t,[{key:"time",get:function(){return this._time},set:function(t){this._time=t,this._curTime=t}},{key:"repeatCount",get:function(){return this._repeatCount},set:function(t){this._repeatCount=t,this._remainingCount=t}}]);var e=t.prototype;return e.update=function(t,e){if(0===this._remainingCount&&(this._remainingCount=this._repeatCount,this._curTime=this._time),this._remainingCount>0){var i=Hr(t._time-t.startDelay.evaluate(0,1),t.duration)-e;i=i>0?i:0;var r=Hr(t.time-t.startDelay.evaluate(0,1),t.duration);this._curTime>=i&&this._curTime<r&&(t.emit(this.count.evaluate(this._curTime/t.duration,1),e-(r-this._curTime)),this._curTime+=this.repeatInterval,--this._remainingCount)}},e.getMaxCount=function(t){return this.count.getMax()*Math.min(Math.ceil(t.duration/this.repeatInterval),this.repeatCount)},t}(),n1=u((r1=h1).prototype,"_time",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),u(r1.prototype,"time",[Ke],Object.getOwnPropertyDescriptor(r1.prototype,"time"),r1.prototype),s1=u(r1.prototype,"_repeatCount",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),u(r1.prototype,"repeatCount",[Ke],Object.getOwnPropertyDescriptor(r1.prototype,"repeatCount"),r1.prototype),a1=u(r1.prototype,"repeatInterval",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),o1=u(r1.prototype,"count",[e1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),i1=r1))||i1),x2=new Cs(0,0,0),O2=new Array,I2=new Cs(.5,.5,.5),M2=(l1=Ne("cc.ShapeModule"),u1=si(),c1=$e(),_1=si(),d1=$e(),p1=si(),f1=$e(),m1=si(),g1=$e(),v1=si(),y1=$e(),T1=si(),E1=pi(UQ),S1=ze("shapeType"),b1=si(),A1=pi(UQ),C1=$e(),w1=pi(kQ),R1=si(),x1=$e(),O1=si(),I1=$e(),M1=si(),B1=$e(),P1=si(),N1=$e(),L1=si(),F1=$e(),D1=si(),U1=$e(),k1=si(),z1=$e(),G1=pi(zQ),H1=si(),V1=$e(),W1=si(),j1=$e(),X1=pi(kK),Y1=si(),q1=$e(),K1=si(),Z1=$e(),Q1=si(),J1=$e(),l1((u((t2=function(){function t(){l(this,"_enable",e2,this),l(this,"_shapeType",i2,this),l(this,"emitFrom",r2,this),l(this,"alignToDirection",n2,this),l(this,"randomDirectionAmount",s2,this),l(this,"sphericalDirectionAmount",a2,this),l(this,"randomPositionAmount",o2,this),l(this,"radius",h2,this),l(this,"radiusThickness",l2,this),l(this,"arcMode",u2,this),l(this,"arcSpread",c2,this),l(this,"arcSpeed",_2,this),l(this,"length",d2,this),l(this,"boxThickness",p2,this),l(this,"_position",f2,this),l(this,"_rotation",m2,this),l(this,"_scale",g2,this),l(this,"_arc",v2,this),l(this,"_angle",y2,this),this.mat=void 0,this.quat=void 0,this.particleSystem=void 0,this.lastTime=void 0,this.totalAngle=void 0,this.mat=new Hs,this.quat=new Ns,this.particleSystem=null,this.lastTime=0,this.totalAngle=0}r(t,[{key:"position",get:function(){return this._position},set:function(t){this._position=t,this.constructMat()}},{key:"rotation",get:function(){return this._rotation},set:function(t){this._rotation=t,this.constructMat()}},{key:"scale",get:function(){return this._scale},set:function(t){this._scale=t,this.constructMat()}},{key:"arc",get:function(){return Nr(this._arc)},set:function(t){this._arc=Pr(t)}},{key:"angle",get:function(){return Math.round(100*Nr(this._angle))/100},set:function(t){this._angle=Pr(t)}},{key:"enable",get:function(){return this._enable},set:function(t){this._enable=t}},{key:"shapeType",get:function(){return this._shapeType},set:function(t){switch(this._shapeType=t,this._shapeType){case UQ.Box:this.emitFrom===kQ.Base&&(this.emitFrom=kQ.Volume);break;case UQ.Cone:this.emitFrom===kQ.Edge&&(this.emitFrom=kQ.Base);break;case UQ.Sphere:case UQ.Hemisphere:this.emitFrom!==kQ.Base&&this.emitFrom!==kQ.Edge||(this.emitFrom=kQ.Volume)}}}]);var e=t.prototype;return e.onInit=function(t){this.particleSystem=t,this.constructMat(),this.lastTime=this.particleSystem._time},e.emit=function(t){switch(this.shapeType){case UQ.Box:!function(t,e,i,r){switch(t){case kQ.Volume:n=i,s=I2,Cs.set(n,Fr(-s.x,s.x),Fr(-s.y,s.y),Fr(-s.z,s.z));break;case kQ.Shell:O2.splice(0,O2.length),O2.push(Fr(-.5,.5)),O2.push(Fr(-.5,.5)),O2.push(.5*QQ()),ZQ(O2),B2(O2,e),Cs.set(i,O2[0],O2[1],O2[2]);break;case kQ.Edge:O2.splice(0,O2.length),O2.push(Fr(-.5,.5)),O2.push(.5*QQ()),O2.push(.5*QQ()),ZQ(O2),B2(O2,e),Cs.set(i,O2[0],O2[1],O2[2]);break;default:console.warn(t+" is not supported for box emitter.")}var n,s;Cs.copy(r,WQ)}(this.emitFrom,this.boxThickness,t.position,t.velocity);break;case UQ.Circle:!function(t,e,i,r,n){KQ(r,t*(1-e),t,i),Cs.normalize(n,r)}(this.radius,this.radiusThickness,this.generateArcAngle(),t.position,t.velocity);break;case UQ.Cone:!function(t,e,i,r,n,s,a,o){switch(t){case kQ.Base:KQ(a,e*(1-i),e,r),Es.multiplyScalar(o,a,Math.sin(n)),o.z=-Math.cos(n)*e,Cs.normalize(o,o),a.z=0;break;case kQ.Shell:XQ(a,r),Es.multiplyScalar(o,a,Math.sin(n)),o.z=-Math.cos(n),Cs.normalize(o,o),Es.multiplyScalar(a,a,e),a.z=0;break;case kQ.Volume:KQ(a,e*(1-i),e,r),Es.multiplyScalar(o,a,Math.sin(n)),o.z=-Math.cos(n)*e,Cs.normalize(o,o),a.z=0,Cs.add(a,a,Cs.multiplyScalar(x2,o,s*Lr()/-o.z));break;default:console.warn(t+" is not supported for cone emitter.")}}(this.emitFrom,this.radius,this.radiusThickness,this.generateArcAngle(),this._angle,this.length,t.position,t.velocity);break;case UQ.Sphere:!function(t,e,i,r,n){switch(t){case kQ.Volume:qQ(r,e*(1-i),e),Cs.normalize(n,r);break;case kQ.Shell:YQ(r),Cs.multiplyScalar(r,r,e),Cs.normalize(n,r);break;default:console.warn(t+" is not supported for sphere emitter.")}}(this.emitFrom,this.radius,this.radiusThickness,t.position,t.velocity);break;case UQ.Hemisphere:!function(t,e,i,r,n){switch(t){case kQ.Volume:qQ(r,e*(1-i),e),r.z>0&&(r.z*=-1),Cs.normalize(n,r);break;case kQ.Shell:YQ(r),Cs.multiplyScalar(r,r,e),r.z>0&&(r.z*=-1),Cs.normalize(n,r);break;default:console.warn(t+" is not supported for hemisphere emitter.")}}(this.emitFrom,this.radius,this.radiusThickness,t.position,t.velocity);break;default:console.warn(this.shapeType+" shapeType is not supported by ShapeModule.")}if(this.randomPositionAmount>0&&(t.position.x+=Fr(-this.randomPositionAmount,this.randomPositionAmount),t.position.y+=Fr(-this.randomPositionAmount,this.randomPositionAmount),t.position.z+=Fr(-this.randomPositionAmount,this.randomPositionAmount)),Cs.transformQuat(t.velocity,t.velocity,this.quat),Cs.transformMat4(t.position,t.position,this.mat),this.sphericalDirectionAmount>0){var e=Cs.normalize(x2,t.position);Cs.lerp(t.velocity,t.velocity,e,this.sphericalDirectionAmount)}this.lastTime=this.particleSystem._time},e.constructMat=function(){Ns.fromEuler(this.quat,this._rotation.x,this._rotation.y,this._rotation.z),Hs.fromRTS(this.mat,this.quat,this._position,this._scale)},e.generateArcAngle=function(){if(this.arcMode===zQ.Random)return Fr(0,this._arc);var t=this.totalAngle+2*Math.PI*this.arcSpeed.evaluate(this.particleSystem._time,1)*(this.particleSystem._time-this.lastTime);switch(this.totalAngle=t,0!==this.arcSpread&&(t=Math.floor(t/(this._arc*this.arcSpread))*this._arc*this.arcSpread),this.arcMode){case zQ.Loop:return Hr(t,this._arc);case zQ.PingPong:return Vr(t,this._arc)}},t}()).prototype,"position",[u1,c1],Object.getOwnPropertyDescriptor(t2.prototype,"position"),t2.prototype),u(t2.prototype,"rotation",[_1,d1],Object.getOwnPropertyDescriptor(t2.prototype,"rotation"),t2.prototype),u(t2.prototype,"scale",[p1,f1],Object.getOwnPropertyDescriptor(t2.prototype,"scale"),t2.prototype),u(t2.prototype,"arc",[m1,g1],Object.getOwnPropertyDescriptor(t2.prototype,"arc"),t2.prototype),u(t2.prototype,"angle",[v1,y1],Object.getOwnPropertyDescriptor(t2.prototype,"angle"),t2.prototype),e2=u(t2.prototype,"_enable",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),u(t2.prototype,"enable",[T1],Object.getOwnPropertyDescriptor(t2.prototype,"enable"),t2.prototype),i2=u(t2.prototype,"_shapeType",[E1,S1,b1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return UQ.Cone}}),u(t2.prototype,"shapeType",[A1,C1],Object.getOwnPropertyDescriptor(t2.prototype,"shapeType"),t2.prototype),r2=u(t2.prototype,"emitFrom",[w1,ke,R1,x1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return kQ.Volume}}),n2=u(t2.prototype,"alignToDirection",[ke,O1,I1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),s2=u(t2.prototype,"randomDirectionAmount",[ke,M1,B1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),a2=u(t2.prototype,"sphericalDirectionAmount",[ke,P1,N1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),o2=u(t2.prototype,"randomPositionAmount",[ke,L1,F1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),h2=u(t2.prototype,"radius",[ke,D1,U1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),l2=u(t2.prototype,"radiusThickness",[ke,k1,z1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),u2=u(t2.prototype,"arcMode",[G1,ke,H1,V1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zQ.Random}}),c2=u(t2.prototype,"arcSpread",[ke,W1,j1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_2=u(t2.prototype,"arcSpeed",[X1,ke,Y1,q1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),d2=u(t2.prototype,"length",[ke,K1,Z1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),p2=u(t2.prototype,"boxThickness",[ke,Q1,J1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cs(0,0,0)}}),f2=u(t2.prototype,"_position",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cs(0,0,0)}}),m2=u(t2.prototype,"_rotation",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cs(0,0,0)}}),g2=u(t2.prototype,"_scale",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cs(1,1,1)}}),v2=u(t2.prototype,"_arc",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Pr(360)}}),y2=u(t2.prototype,"_angle",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Pr(25)}}),$1=t2))||$1);function B2(t,e){e.x>0&&(t[0]+=.5*Fr(-e.x,e.x),t[0]=Ir(t[0],-.5,.5)),e.y>0&&(t[1]+=.5*Fr(-e.y,e.y),t[1]=Ir(t[1],-.5,.5)),e.z>0&&(t[2]+=.5*Fr(-e.z,e.z),t[2]=Ir(t[2],-.5,.5))}var P2,N2,L2,F2,D2,U2,k2,z2,G2,H2,V2,W2,j2,X2,Y2,q2,K2,Z2,Q2,J2,$2,t3,e3,i3,r3,n3,s3,a3,o3=[0,0,1,0,0,1,1,1],h3=function(t){function e(){var e;return(e=t.call(this)||this)._capacity=void 0,e._vertAttrs=void 0,e._vertSize=void 0,e._vBuffer=void 0,e._vertAttrsFloatCount=void 0,e._vdataF32=void 0,e._vdataUint32=void 0,e._iaInfo=void 0,e._iaInfoBuffer=void 0,e._subMeshData=void 0,e._mesh=void 0,e._vertCount=0,e._indexCount=0,e._startTimeOffset=0,e._lifeTimeOffset=0,e._material=null,e.type=XA.PARTICLE_BATCH,e._capacity=0,e._vertAttrs=null,e._vertSize=0,e._vBuffer=null,e._vertAttrsFloatCount=0,e._vdataF32=null,e._vdataUint32=null,e._iaInfo=new ql([new Xl]),e._iaInfoBuffer=e._device.createBuffer(new Kl(rl.INDIRECT,nl.HOST|nl.DEVICE,Yl,Yl)),e._subMeshData=null,e._mesh=null,e}s(e,t);var i=e.prototype;return i.setCapacity=function(t){var e=this._capacity!==t;this._capacity=t,this._subMeshData&&e&&this.rebuild()},i.setVertexAttributes=function(t,e){if(this._mesh!==t||this._vertAttrs!==e){this._mesh=t,this._vertAttrs=e,this._vertSize=0;for(var i,r=h(this._vertAttrs);!(i=r()).done;){var n=i.value;n.offset=this._vertSize,this._vertSize+=zl[n.format].size}this._vertAttrsFloatCount=this._vertSize/4,this.rebuild()}},i.createSubMeshData=function(){this.destroySubMeshData(),this._vertCount=4,this._indexCount=6,this._mesh&&(this._vertCount=this._mesh.struct.vertexBundles[this._mesh.struct.primitives[0].vertexBundelIndices[0]].view.count,this._indexCount=this._mesh.struct.primitives[0].indexView.count);var t=this._device.createBuffer(new Kl(rl.VERTEX|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,this._vertSize*this._capacity*this._vertCount,this._vertSize)),e=new ArrayBuffer(this._vertSize*this._capacity*this._vertCount);if(this._mesh){var i=this._vertAttrs.findIndex((function(t){return t.name===tl.ATTR_TEX_COORD3})),r=this._vertAttrs[i++].offset;if(this._mesh.copyAttribute(0,tl.ATTR_POSITION,e,this._vertSize,r),r=this._vertAttrs[i++].offset,this._mesh.copyAttribute(0,tl.ATTR_NORMAL,e,this._vertSize,r),r=this._vertAttrs[this._vertAttrs.findIndex((function(t){return t.name===tl.ATTR_TEX_COORD}))].offset,this._mesh.copyAttribute(0,tl.ATTR_TEX_COORD,e,this._vertSize,r),r=this._vertAttrs[i++].offset,!this._mesh.copyAttribute(0,tl.ATTR_COLOR,e,this._vertSize,r))for(var n=new Uint32Array(e),s=0;s<this._vertCount;++s)n[s*this._vertAttrsFloatCount+r/4]=Qs.WHITE._val;for(var a=new Float32Array(e),o=1;o<this._capacity;o++)a.copyWithin(o*this._vertSize*this._vertCount/4,0,this._vertSize*this._vertCount/4)}t.update(e);var h=new Uint16Array(this._capacity*this._indexCount);if(this._mesh){this._mesh.copyIndices(0,h);for(var l=1;l<this._capacity;l++)for(var u=0;u<this._indexCount;u++)h[l*this._indexCount+u]=h[u]+l*this._vertCount}else for(var c=0,_=0;_<this._capacity;++_){var d=4*_;h[c++]=d,h[c++]=d+1,h[c++]=d+2,h[c++]=d+3,h[c++]=d+2,h[c++]=d+1}var p=this._device.createBuffer(new Kl(rl.INDEX|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,this._capacity*this._indexCount*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT));return p.update(h),this._iaInfo.drawInfos[0].vertexCount=this._capacity*this._vertCount,this._iaInfo.drawInfos[0].indexCount=this._capacity*this._indexCount,this._iaInfoBuffer||(this._iaInfoBuffer=this._device.createBuffer(new Kl(rl.INDIRECT,nl.HOST|nl.DEVICE,Yl,Yl))),this._iaInfoBuffer.update(this._iaInfo),this._subMeshData=new xf([t],this._vertAttrs,ol.TRIANGLE_LIST,p,this._iaInfoBuffer),this.initSubModel(0,this._subMeshData,this._material),e},i.updateMaterial=function(t){this._material=t,this.setSubModelMaterial(0,t)},i.addParticleVertexData=function(t,e){if(this._mesh)for(var i=0;i<this._vertCount;i++){var r=(t*this._vertCount+i)*this._vertAttrsFloatCount;this._vdataF32[r++]=e[0].x,this._vdataF32[r++]=e[0].y,this._vdataF32[r++]=e[0].z,r+=2,this._vdataF32[r++]=e[1].z,this._vdataF32[r++]=e[2].x,this._vdataF32[r++]=e[2].y,this._vdataF32[r++]=e[2].z,this._vdataF32[r++]=e[3].x,this._vdataF32[r++]=e[3].y,this._vdataF32[r++]=e[3].z,this._vdataUint32[r++]=e[4]}else{var n=t*this._vertAttrsFloatCount;this._vdataF32[n++]=e[0].x,this._vdataF32[n++]=e[0].y,this._vdataF32[n++]=e[0].z,this._vdataF32[n++]=e[1].x,this._vdataF32[n++]=e[1].y,this._vdataF32[n++]=e[1].z,this._vdataF32[n++]=e[2].x,this._vdataF32[n++]=e[2].y,this._vdataF32[n++]=e[2].z,this._vdataF32[n++]=e[3].x,this._vdataF32[n++]=e[3].y,this._vdataF32[n++]=e[3].z,this._vdataUint32[n++]=e[4],e[5]&&(this._vdataF32[n++]=e[5].x,this._vdataF32[n++]=e[5].y,this._vdataF32[n++]=e[5].z)}},i.addGPUParticleVertexData=function(t,e,i){for(var r=e*this._vertAttrsFloatCount*this._vertCount,n=0;n<this._vertCount;n++){var s=r;this._vdataF32[s++]=t.position.x,this._vdataF32[s++]=t.position.y,this._vdataF32[s++]=t.position.z,this._vdataF32[s++]=i,this._vdataF32[s++]=t.startSize.x,this._vdataF32[s++]=t.startSize.y,this._vdataF32[s++]=t.startSize.z,this._vdataF32[s++]=o3[2*n],this._vdataF32[s++]=t.rotation.x,this._vdataF32[s++]=t.rotation.y,this._vdataF32[s++]=t.rotation.z,this._vdataF32[s++]=o3[2*n+1],this._vdataF32[s++]=t.startColor.r/255,this._vdataF32[s++]=t.startColor.g/255,this._vdataF32[s++]=t.startColor.b/255,this._vdataF32[s++]=t.startColor.a/255,this._vdataF32[s++]=t.velocity.x,this._vdataF32[s++]=t.velocity.y,this._vdataF32[s++]=t.velocity.z,this._vdataF32[s++]=t.startLifetime,this._vdataF32[s++]=t.randomSeed,r+=this._vertAttrsFloatCount}},i.updateGPUParticles=function(t,e,i){for(var r=this._vertAttrsFloatCount*this._vertCount,n=0,s=0,a=0,o=0;o<t;++o)n=o*r,s=this._vdataF32[n+this._startTimeOffset],this._vdataF32[n+this._lifeTimeOffset]-(e-s)<i&&(a=--t*r,this._vdataF32.copyWithin(n,a,a+r),o--);return t},i.constructAttributeIndex=function(){if(this._vertAttrs){var t=this._vertAttrs.findIndex((function(t){return"a_position_starttime"===t.name})),e=this._vertAttrs[t].offset;this._startTimeOffset=e/4+3,t=this._vertAttrs.findIndex((function(t){return"a_dir_life"===t.name})),e=this._vertAttrs[t].offset,this._lifeTimeOffset=e/4+3}},i.updateIA=function(t){this._subModels[0].inputAssembler.vertexBuffers[0].update(this._vdataF32),this._iaInfo.drawInfos[0].firstIndex=0,this._iaInfo.drawInfos[0].indexCount=this._indexCount*t,this._iaInfoBuffer.update(this._iaInfo)},i.clear=function(){this._subModels[0].inputAssembler.indexCount=0},i.destroy=function(){t.prototype.destroy.call(this),this._vBuffer=null,this._vdataF32=null,this.destroySubMeshData(),this._iaInfoBuffer&&(this._iaInfoBuffer.destroy(),this._iaInfoBuffer=null)},i.rebuild=function(){this._vBuffer=this.createSubMeshData(),this._vdataF32=new Float32Array(this._vBuffer),this._vdataUint32=new Uint32Array(this._vBuffer)},i.destroySubMeshData=function(){this._subMeshData&&(this._subMeshData.destroy(),this._subMeshData=null)},e}(aC),l3=function(){function t(t){this._particleSystem=null,this._model=null,this._renderInfo=null,this._vertAttrs=[],this._renderInfo=t}var e=t.prototype;return e.onInit=function(t){this._particleSystem=t},e.onEnable=function(){if(this._particleSystem){this.attachToScene();var t=this._model;t&&(t.node=t.transform=this._particleSystem.node,t.enabled=this._particleSystem.enabledInHierarchy)}},e.onDisable=function(){this.detachFromScene()},e.onDestroy=function(){this._model&&(_.director.root.destroyModel(this._model),this._model=null)},e.attachToScene=function(){this._model&&(this._model.scene&&this.detachFromScene(),this._particleSystem._getRenderScene().addModel(this._model))},e.detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},e.setVertexAttributes=function(){this._model&&this._model.setVertexAttributes(this._renderInfo.renderMode===DQ.Mesh?this._renderInfo.mesh:null,this._vertAttrs)},e._initModel=function(){this._model||(this._model=_.director.root.createModel(h3),this._model.setCapacity(this._particleSystem.capacity),this._model.visFlags=this._particleSystem.visibility)},e.updateTrailMaterial=function(){},e.getDefaultTrailMaterial=function(){return null},t}(),u3=new Cs,c3=new Hs,_3=["_colorOverLifetimeModule","_sizeOvertimeModule","_velocityOvertimeModule","_forceOvertimeModule","_limitVelocityOvertimeModule","_rotationOvertimeModule","_textureAnimationModule"],d3=[0,0,1,0,0,1,1,1],p3=[new hu(tl.ATTR_POSITION,il.RGB32F),new hu(tl.ATTR_TEX_COORD,il.RGB32F),new hu(tl.ATTR_TEX_COORD1,il.RGB32F),new hu(tl.ATTR_TEX_COORD2,il.RGB32F),new hu(tl.ATTR_COLOR,il.RGBA8,!0)],f3=[new hu(tl.ATTR_POSITION,il.RGB32F),new hu(tl.ATTR_TEX_COORD,il.RGB32F),new hu(tl.ATTR_TEX_COORD1,il.RGB32F),new hu(tl.ATTR_TEX_COORD2,il.RGB32F),new hu(tl.ATTR_COLOR,il.RGBA8,!0),new hu(tl.ATTR_COLOR1,il.RGB32F)],m3=[new hu(tl.ATTR_POSITION,il.RGB32F),new hu(tl.ATTR_TEX_COORD,il.RGB32F),new hu(tl.ATTR_TEX_COORD1,il.RGB32F),new hu(tl.ATTR_TEX_COORD2,il.RGB32F),new hu(tl.ATTR_COLOR,il.RGBA8,!0),new hu(tl.ATTR_TEX_COORD3,il.RGB32F),new hu(tl.ATTR_NORMAL,il.RGB32F),new hu(tl.ATTR_COLOR1,il.RGBA8,!0)],g3={parent:null,owner:null,subModelIdx:0},v3=function(t){function e(e){var i;return(i=t.call(this,e)||this)._defines=void 0,i._trailDefines=void 0,i._frameTile_velLenScale=void 0,i._defaultMat=null,i._node_scale=void 0,i._attrs=void 0,i._particles=null,i._defaultTrailMat=null,i._updateList=new Map,i._animateList=new Map,i._runAnimateList=new Array,i._fillDataFunc=null,i._uScaleHandle=0,i._uLenHandle=0,i._inited=!1,i._model=null,i._frameTile_velLenScale=new Os(1,1,0,0),i._node_scale=new Os,i._attrs=new Array(5),i._defines={CC_USE_WORLD_SPACE:!0,CC_USE_BILLBOARD:!0,CC_USE_STRETCHED_BILLBOARD:!1,CC_USE_HORIZONTAL_BILLBOARD:!1,CC_USE_VERTICAL_BILLBOARD:!1},i._trailDefines={CC_USE_WORLD_SPACE:!0},i}s(e,t);var i=e.prototype;return i.onInit=function(e){var i=this;t.prototype.onInit.call(this,e),this._particles=new Vi((function(){return new BQ(i)}),16),this._setVertexAttrib(),this._setFillFunc(),this._initModuleList(),this._initModel(),this.updateMaterialParams(),this.updateTrailMaterial(),this.setVertexAttributes(),this._inited=!0},i.clear=function(){this._particles.reset(),this._particleSystem._trailModule&&this._particleSystem._trailModule.clear(),this.updateRenderData()},i.updateRenderMode=function(){this._setVertexAttrib(),this._setFillFunc(),this.updateMaterialParams(),this.setVertexAttributes()},i.getFreeParticle=function(){return this._particles.length>=this._particleSystem.capacity?null:this._particles.add()},i.getDefaultTrailMaterial=function(){return this._defaultTrailMat},i.setNewParticle=function(){},i._initModuleList=function(){var t=this;_3.forEach((function(e){var i=t._particleSystem[e];i&&i.enable&&(i.needUpdate&&(t._updateList[i.name]=i),i.needAnimate&&(t._animateList[i.name]=i))})),this._runAnimateList.length=0;for(var e=0,i=PQ.length;e<i;e++){var r=this._animateList[PQ[e]];r&&this._runAnimateList.push(r)}},i.enableModule=function(t,e,i){e?(i.needUpdate&&(this._updateList[i.name]=i),i.needAnimate&&(this._animateList[i.name]=i)):(delete this._animateList[t],delete this._updateList[t]),this._runAnimateList.length=0;for(var r=0,n=PQ.length;r<n;r++){var s=this._animateList[PQ[r]];s&&this._runAnimateList.push(s)}},i.updateParticles=function(t){var e=this,i=this._particleSystem;if(!i)return this._particles.length;switch(i.node.getWorldMatrix(c3),i.scaleSpace){case FQ.Local:i.node.getScale(this._node_scale);break;case FQ.World:i.node.getWorldScale(this._node_scale)}(i.getMaterialInstance(0)||this._defaultMat).passes[0].setUniform(this._uScaleHandle,this._node_scale),this._updateList.forEach((function(t){t.update(i._simulationSpace,c3)}));var r=i._trailModule,n=r&&r.enable;n&&r.update();for(var s=function(s){var o=e._particles.data[s];if(o.remainingLifetime-=t,Cs.set(o.animatedVelocity,0,0,0),o.remainingLifetime<0)return n&&r.removeParticle(o),e._particles.removeAt(s),--s,a=s,"continue";o.velocity.y-=9.8*i.gravityModifier.evaluate(1-o.remainingLifetime/o.startLifetime,Ur(o.randomSeed))*t,Cs.copy(o.ultimateVelocity,o.velocity),e._runAnimateList.forEach((function(e){e.animate(o,t)})),Cs.scaleAndAdd(o.position,o.position,o.ultimateVelocity,t),n&&r.animate(o,t),a=s},a=0;a<this._particles.length;++a)s(a);return this._particles.length},i.updateRenderData=function(){for(var t=0,e=0;e<this._particles.length;++e){var i=this._particles.data[e],r=0,n=this._particleSystem._textureAnimationModule;n&&n.enable&&(r=i.frameIndex),t=4*e,this._fillDataFunc(i,t,r)}this._model.updateIA(this._particles.length)},i.getParticleCount=function(){return this._particles.length},i.onMaterialModified=function(t){this._inited&&(0===t?this.updateMaterialParams():this.updateTrailMaterial())},i.onRebuildPSO=function(t,e){this._model&&0===t&&this._model.setSubModelMaterial(0,e);var i=this._particleSystem._trailModule;i&&i._trailModel&&1===t&&i._trailModel.setSubModelMaterial(0,e)},i._setFillFunc=function(){this._renderInfo.renderMode===DQ.Mesh?this._fillDataFunc=this._fillMeshData:this._renderInfo.renderMode===DQ.StrecthedBillboard?this._fillDataFunc=this._fillStrecthedData:this._fillDataFunc=this._fillNormalData},i._fillMeshData=function(t,e,i){var r=e/4,n=0;this._attrs[n++]=t.position,u3.z=i,this._attrs[n++]=u3,this._attrs[n++]=t.size,this._attrs[n++]=t.rotation,this._attrs[n++]=t.color._val,this._model.addParticleVertexData(r,this._attrs)},i._fillStrecthedData=function(t,e,i){for(var r=0,n=0;n<4;++n)r=0,this._attrs[r++]=t.position,u3.x=d3[2*n],u3.y=d3[2*n+1],u3.z=i,this._attrs[r++]=u3,this._attrs[r++]=t.size,this._attrs[r++]=t.rotation,this._attrs[r++]=t.color._val,this._attrs[r++]=t.ultimateVelocity,this._attrs[r++]=t.ultimateVelocity,this._model.addParticleVertexData(e++,this._attrs)},i._fillNormalData=function(t,e,i){for(var r=0,n=0;n<4;++n)r=0,this._attrs[r++]=t.position,u3.x=d3[2*n],u3.y=d3[2*n+1],u3.z=i,this._attrs[r++]=u3,this._attrs[r++]=t.size,this._attrs[r++]=t.rotation,this._attrs[r++]=t.color._val,this._attrs[r++]=null,this._model.addParticleVertexData(e++,this._attrs)},i._setVertexAttrib=function(){switch(this._renderInfo.renderMode){case DQ.StrecthedBillboard:this._vertAttrs=f3.slice();break;case DQ.Mesh:this._vertAttrs=m3.slice();break;default:this._vertAttrs=p3.slice()}},i.updateMaterialParams=function(){if(this._particleSystem){var t=this._particleSystem,e=t.sharedMaterial;if(null!=e){var i=e._effectAsset._name;this._renderInfo.mainTexture=e.getProperty("mainTexture",0),-1!==i.indexOf("particle")&&-1===i.indexOf("particle-gpu")||t.setMaterial(null,0)}null==t.sharedMaterial&&null==this._defaultMat&&(g3.parent=wm.get("default-particle-material"),g3.owner=this._particleSystem,g3.subModelIdx=0,this._defaultMat=new Lg(g3),null!==this._renderInfo.mainTexture&&this._defaultMat.setProperty("mainTexture",this._renderInfo.mainTexture));var r=t.getMaterialInstance(0)||this._defaultMat;t._simulationSpace===FQ.World?this._defines.CC_USE_WORLD_SPACE=!0:this._defines.CC_USE_WORLD_SPACE=!1;var n=r.passes[0];this._uScaleHandle=n.getHandle("scale"),this._uLenHandle=n.getHandle("frameTile_velLenScale");var s=this._renderInfo.renderMode,a=this._frameTile_velLenScale;s===DQ.Billboard?this._defines.CC_RENDER_MODE=0:s===DQ.StrecthedBillboard?(this._defines.CC_RENDER_MODE=1,a.z=this._renderInfo.velocityScale,a.w=this._renderInfo.lengthScale):s===DQ.HorizontalBillboard?this._defines.CC_RENDER_MODE=2:s===DQ.VerticalBillboard?this._defines.CC_RENDER_MODE=3:s===DQ.Mesh?this._defines.CC_RENDER_MODE=4:console.warn("particle system renderMode "+s+" not support.");var o=t._textureAnimationModule;o&&o.enable?(Es.set(a,o.numTilesX,o.numTilesY),n.setUniform(this._uLenHandle,a)):n.setUniform(this._uLenHandle,a),r.recompileShaders(this._defines),this._model&&this._model.updateMaterial(r)}},i.updateTrailMaterial=function(){if(this._particleSystem){var t=this._particleSystem,e=t._trailModule;if(e&&e.enable){t.simulationSpace===FQ.World||e.space===FQ.World?this._trailDefines.CC_USE_WORLD_SPACE=!0:this._trailDefines.CC_USE_WORLD_SPACE=!1;var i=t.getMaterialInstance(1);null===i&&null===this._defaultTrailMat&&(g3.parent=wm.get("default-trail-material"),g3.owner=this._particleSystem,g3.subModelIdx=1,this._defaultTrailMat=new Lg(g3)),(i=i||this._defaultTrailMat).recompileShaders(this._trailDefines),e.updateMaterial()}}},e}(l3),y3=new Hs,T3=new Os,E3=new Ns,S3=[new hu("a_position_starttime",il.RGBA32F),new hu("a_size_uv",il.RGBA32F),new hu("a_rotation_uv",il.RGBA32F),new hu("a_color",il.RGBA32F),new hu("a_dir_life",il.RGBA32F),new hu("a_rndSeed",il.R32F)],b3=[new hu("a_position_starttime",il.RGBA32F),new hu("a_size_uv",il.RGBA32F),new hu("a_rotation_uv",il.RGBA32F),new hu("a_color",il.RGBA32F),new hu("a_dir_life",il.RGBA32F),new hu("a_rndSeed",il.R32F),new hu(tl.ATTR_TEX_COORD,il.RGB32F),new hu(tl.ATTR_TEX_COORD3,il.RGB32F),new hu(tl.ATTR_NORMAL,il.RGB32F),new hu(tl.ATTR_COLOR1,il.RGBA8,!0)],A3={parent:null,owner:null,subModelIdx:0},C3=function(t){function e(e){var i;return(i=t.call(this,e)||this)._defines=void 0,i._frameTile_velLenScale=void 0,i._node_scale=void 0,i._vertAttrs=[],i._defaultMat=null,i._particleNum=0,i._tempParticle=null,i._colorTexture=null,i._forceTexture=null,i._velocityTexture=null,i._rotationTexture=null,i._sizeTexture=null,i._animTexture=null,i._uTimeHandle=0,i._uRotHandle=0,i._inited=!1,i._frameTile_velLenScale=new Os(1,1,0,0),i._node_scale=new Os,i._defines={CC_USE_WORLD_SPACE:!0,CC_USE_BILLBOARD:!0,CC_USE_STRETCHED_BILLBOARD:!1,CC_USE_HORIZONTAL_BILLBOARD:!1,CC_USE_VERTICAL_BILLBOARD:!1,COLOR_OVER_TIME_MODULE_ENABLE:!1},i._tempParticle=new BQ(null),i._particleNum=0,i}s(e,t);var i=e.prototype;return i.onInit=function(e){t.prototype.onInit.call(this,e),this._setVertexAttrib(),this._initModel(),this.updateMaterialParams(),this.setVertexAttributes(),this._inited=!0},i.updateRenderMode=function(){this._setVertexAttrib(),this.updateMaterialParams(),this.setVertexAttributes()},i.setVertexAttributes=function(){t.prototype.setVertexAttributes.call(this),this._model.constructAttributeIndex()},i.clear=function(){this._particleNum=0,this.updateRenderData()},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._forceTexture&&this._forceTexture.destroy(),this._velocityTexture&&this._velocityTexture.destroy(),this._colorTexture&&this._colorTexture.destroy(),this._sizeTexture&&this._sizeTexture.destroy(),this._rotationTexture&&this._rotationTexture.destroy(),this._animTexture&&this._animTexture.destroy()},i.enableModule=function(){var t=this._particleSystem.getMaterialInstance(0)||this._defaultMat;t&&(this.initShaderUniform(t),t.recompileShaders(this._defines),this._model&&this._model.setSubModelMaterial(0,t))},i.getFreeParticle=function(){return this._particleNum>=this._particleSystem._capacity?null:this._tempParticle},i.setNewParticle=function(t){this._model.addGPUParticleVertexData(t,this._particleNum,this._particleSystem._time),this._particleNum++},i.updateParticles=function(t){return this._particleNum=this._model.updateGPUParticles(this._particleNum,this._particleSystem._time,t),this.updateShaderUniform(t),this._particleNum},i.updateRenderData=function(){this._model.updateIA(this._particleNum)},i.updateShaderUniform=function(t){var e=this._particleSystem.getMaterialInstance(0)||this._defaultMat;if(e){var i=e.passes[0];T3.x=this._particleSystem._time,T3.y=t,i.setUniform(this._uTimeHandle,T3),this._particleSystem.node.getWorldRotation(E3),i.setUniform(this._uRotHandle,E3)}},i.initShaderUniform=function(t){var e=t.passes[0];this._uTimeHandle=e.getHandle("u_timeDelta"),this._uRotHandle=e.getHandle("u_worldRot"),e.setUniform(e.getHandle("scale"),this._node_scale),e.setUniform(e.getHandle("frameTile_velLenScale"),this._frameTile_velLenScale),T3.x=32,T3.y=1/32,e.setUniform(e.getHandle("u_sampleInfo"),T3);var i=!1,r=this._particleSystem._forceOvertimeModule;if(i=r&&r.enable,this._defines.FORCE_OVER_TIME_MODULE_ENABLE=i,i){this._forceTexture&&this._forceTexture.destroy(),this._forceTexture=VK(32,r.x,r.y,r.z);var n=e.getHandle("force_over_time_tex0"),s=Mm.getBindingFromHandle(n);e.bindSampler(s,this._forceTexture.getGFXSampler()),e.bindTexture(s,this._forceTexture.getGFXTexture());var a=e.getHandle("u_force_space");e.setUniform(a,r.space);var o=e.getHandle("u_force_mode");e.setUniform(o,this._forceTexture.height)}var h=this._particleSystem._velocityOvertimeModule;if(i=h&&h.enable,this._defines.VELOCITY_OVER_TIME_MODULE_ENABLE=i,i){this._velocityTexture&&this._velocityTexture.destroy(),this._velocityTexture=function(t,e,i,r,n){for(var s=Math.max(GK(e),GK(i),GK(r),GK(n)),a=new Float32Array(128*s),o=[e,i,r,n],h=0;h<s;h++)for(var l=0;l<4;l++)for(var u=o[l],c=0,_=0,d=0;d<32;d++){var p=zK(u,1/31*d,h);_=(c+=p)/(d+1),a[4*d+l]=_}return HK(a,32,s)}(0,h.x,h.y,h.z,h.speedModifier);var l=e.getHandle("velocity_over_time_tex0"),u=Mm.getBindingFromHandle(l);e.bindSampler(u,this._velocityTexture.getGFXSampler()),e.bindTexture(u,this._velocityTexture.getGFXTexture());var c=e.getHandle("u_velocity_space");e.setUniform(c,h.space);var _=e.getHandle("u_velocity_mode");e.setUniform(_,this._velocityTexture.height)}var d=this._particleSystem._colorOverLifetimeModule;if(i=d&&d.enable,this._defines.COLOR_OVER_TIME_MODULE_ENABLE=i,i){this._colorTexture&&this._colorTexture.destroy(),this._colorTexture=function(t,e){for(var i=function(t){switch(t.mode){case XZ.TwoColors:case XZ.TwoGradients:return 2;default:return 1}}(e),r=new Uint8Array(t*i*4),n=1/(t-1),s=0,a=0;a<i;a++)for(var o=0;o<t;o++){var h=qZ(e,n*o,a);r[s]=h.r,r[s+1]=h.g,r[s+2]=h.b,r[s+3]=h.a,s+=4}var l=new pp;return l.create(t,i,Rd.RGBA8888),l.setFilters(Od.LINEAR,Od.LINEAR),l.setWrapMode(xd.CLAMP_TO_EDGE,xd.CLAMP_TO_EDGE),l.uploadData(r),l}(32,d.color);var p=e.getHandle("color_over_time_tex0"),f=Mm.getBindingFromHandle(p);e.bindSampler(f,this._colorTexture.getGFXSampler()),e.bindTexture(f,this._colorTexture.getGFXTexture());var m=e.getHandle("u_color_mode");e.setUniform(m,this._colorTexture.height)}var g=this._particleSystem._rotationOvertimeModule;if(i=g&&g.enable,this._defines.ROTATION_OVER_TIME_MODULE_ENABLE=i,i){this._rotationTexture&&this._rotationTexture.destroy(),g.separateAxes?this._rotationTexture=VK(32,g.x,g.y,g.z):this._rotationTexture=function(t,e){for(var i=GK(e),r=new Float32Array(128*i),n=0,s=0;s<i;s++)for(var a=0;a<32;a++){var o=zK(e,1/31*a,s);r[n+2]=o,n+=4}return HK(r,32,i)}(0,g.z);var v=e.getHandle("rotation_over_time_tex0"),y=Mm.getBindingFromHandle(v);e.bindSampler(y,this._rotationTexture.getGFXSampler()),e.bindTexture(y,this._rotationTexture.getGFXTexture());var T=e.getHandle("u_rotation_mode");e.setUniform(T,this._rotationTexture.height)}var E=this._particleSystem._sizeOvertimeModule;if(i=E&&E.enable,this._defines.SIZE_OVER_TIME_MODULE_ENABLE=i,i){this._sizeTexture&&this._sizeTexture.destroy(),E.separateAxes?this._sizeTexture=VK(32,E.x,E.y,E.z,!0):this._sizeTexture=function(t,e){for(var i=GK(e),r=new Float32Array(128*i),n=0,s=0,a=0;a<i;a++){0;for(var o=0;o<32;o++){var h=zK(e,1/31*o,a);n=h,r[s]=n,r[s+1]=n,r[s+2]=n,s+=4}}return HK(r,32,i)}(0,E.size);var S=e.getHandle("size_over_time_tex0"),b=Mm.getBindingFromHandle(S);e.bindSampler(b,this._sizeTexture.getGFXSampler()),e.bindTexture(b,this._sizeTexture.getGFXTexture());var A=e.getHandle("u_size_mode");e.setUniform(A,this._sizeTexture.height)}var C=this._particleSystem._textureAnimationModule;if(i=C&&C.enable,this._defines.TEXTURE_ANIMATION_MODULE_ENABLE=i,i){this._animTexture&&this._animTexture.destroy(),this._animTexture=function(t,e,i){for(var r=Math.max(GK(e),GK(i)),n=new Float32Array(128*r),s=[e,i],a=0;a<r;a++)for(var o=0;o<2;o++)for(var h=s[o],l=0,u=0,c=0;c<32;c++){var _=zK(h,1/31*c,a);u=(l+=_)/(c+1),n[4*c+o]=u}return HK(n,32,r)}(0,C.startFrame,C.frameOverTime);var w=e.getHandle("texture_animation_tex0"),R=Mm.getBindingFromHandle(w);e.bindSampler(R,this._animTexture.getGFXSampler()),e.bindTexture(R,this._animTexture.getGFXTexture());var x=e.getHandle("u_anim_info");T3.x=this._animTexture.height,T3.y=C.numTilesX*C.numTilesY,T3.z=C.cycleCount,e.setUniform(x,T3)}},i.getParticleCount=function(){return this._particleNum},i.onMaterialModified=function(){this._inited&&this.updateMaterialParams()},i.onRebuildPSO=function(t,e){this._model&&0===t&&this._model.setSubModelMaterial(0,e)},i._setVertexAttrib=function(){switch(this._renderInfo.renderMode){case DQ.StrecthedBillboard:this._vertAttrs=S3.slice();break;case DQ.Mesh:this._vertAttrs=b3.slice();break;default:this._vertAttrs=S3.slice()}},i.updateMaterialParams=function(){if(this._particleSystem){var t=this._particleSystem,e=t.sharedMaterial;if(null!==e){var i=e._effectAsset._name;this._renderInfo.mainTexture=e.getProperty("mainTexture",0),-1===i.indexOf("particle-gpu")&&(this._renderInfo.mainTexture=e.getProperty("mainTexture",0),this._particleSystem.setMaterial(null,0))}null==t.sharedMaterial&&null==this._defaultMat&&(A3.parent=wm.get("default-particle-gpu-material"),A3.owner=t,A3.subModelIdx=0,this._defaultMat=new Lg(A3),null!==this._renderInfo.mainTexture&&this._defaultMat.setProperty("mainTexture",this._renderInfo.mainTexture));var r=t.getMaterialInstance(0)||this._defaultMat;switch(t.node.getWorldMatrix(y3),t.scaleSpace){case FQ.Local:t.node.getScale(this._node_scale);break;case FQ.World:t.node.getWorldScale(this._node_scale)}t._simulationSpace===FQ.World?this._defines.CC_USE_WORLD_SPACE=!0:this._defines.CC_USE_WORLD_SPACE=!1;var n=this._renderInfo.renderMode;n===DQ.Billboard?this._defines.CC_RENDER_MODE=0:n===DQ.StrecthedBillboard?(this._defines.CC_RENDER_MODE=1,this._frameTile_velLenScale.z=this._renderInfo.velocityScale,this._frameTile_velLenScale.w=this._renderInfo.lengthScale):n===DQ.HorizontalBillboard?this._defines.CC_RENDER_MODE=2:n===DQ.VerticalBillboard?this._defines.CC_RENDER_MODE=3:n===DQ.Mesh?this._defines.CC_RENDER_MODE=4:console.warn("particle system renderMode "+n+" not support.");var s=t._textureAnimationModule;s&&s.enable&&Es.set(this._frameTile_velLenScale,s.numTilesX,s.numTilesY),this.initShaderUniform(r),r.recompileShaders(this._defines),this._model&&this._model.updateMaterial(r)}},e}(l3);function w3(){var t=NF.root.device;return!!(t.maxVertexTextureUnits>=8&&t.hasFeature(Fl.TEXTURE_FLOAT))||(_.warn("Maybe the device has restrictions on vertex textures or does not support float textures."),!1)}var R3,x3,O3,I3,M3,B3,P3,N3,L3,F3,D3,U3,k3,z3,G3,H3,V3,W3,j3,X3,Y3,q3,K3,Z3,Q3,J3,$3,t5,e5,i5,r5,n5,s5,a5,o5,h5,l5,u5,c5,_5,d5,p5,f5,m5,g5,v5,y5,T5,E5,S5,b5,A5,C5,w5,R5,x5,O5,I5,M5,B5,P5,N5,L5,F5,D5,U5,k5,z5,G5,H5,V5,W5,j5,X5,Y5,q5,K5,Z5,Q5,J5,$5,t4,e4,i4,r4,n4,s4,a4,o4,h4,l4,u4,c4,_4,d4,p4,f4,m4,g4,v4,y4,T4,E4,S4,b4,A4,C4,w4,R4,x4,O4,I4,M4,B4,P4,N4,L4,F4,D4,U4,k4,z4,G4,H4,V4,W4,j4,X4,Y4,q4,K4,Z4,Q4,J4,$4,t8,e8,i8,r8,n8,s8,a8,o8,h8,l8,u8,c8,_8,d8,p8,f8,m8,g8,v8,y8,T8,E8,S8,b8,A8,C8,w8,R8,x8,O8,I8,M8,B8,P8,N8,L8,F8,D8,U8,k8,z8,G8,H8,V8,W8,j8,X8,Y8,q8,K8,Z8,Q8,J8,$8,t6,e6,i6,r6,n6,s6,a6,o6,h6,l6,u6,c6,_6=(P2=Ne("cc.ParticleSystemRenderer"),N2=pi(DQ),L2=si(),F2=$e(),D2=si(),U2=$e(),k2=si(),z2=$e(),G2=pi(DQ),H2=pi(Bf),V2=si(),W2=$e(),j2=pi(mg),X2=si(),Y2=$e(),q2=pi(mg),K2=si(),Z2=$e(),Q2=si(),J2=$e(),P2((u((t3=function(){function t(){l(this,"_renderMode",e3,this),l(this,"_velocityScale",i3,this),l(this,"_lengthScale",r3,this),l(this,"_mesh",n3,this),l(this,"_mainTexture",s3,this),l(this,"_useGPU",a3,this),this._particleSystem=null}var e=t.prototype;return e.onInit=function(t){this._particleSystem=t;var e=this._useGPU&&w3();this._particleSystem.processor=e?new C3(this):new v3(this),this._particleSystem.processor.onInit(t)},e._switchProcessor=function(){this._particleSystem.processor&&(this._particleSystem.processor.detachFromScene(),this._particleSystem.processor.clear(),this._particleSystem.processor=null),this._particleSystem.processor=this._useGPU?new C3(this):new v3(this),this._particleSystem.processor.onInit(this._particleSystem),this._particleSystem.processor.onEnable(),this._particleSystem.bindModule()},r(t,[{key:"renderMode",get:function(){return this._renderMode},set:function(t){this._renderMode!==t&&(this._renderMode=t,this._particleSystem.processor.updateRenderMode())}},{key:"velocityScale",get:function(){return this._velocityScale},set:function(t){this._velocityScale=t,this._particleSystem.processor.updateMaterialParams()}},{key:"lengthScale",get:function(){return this._lengthScale},set:function(t){this._lengthScale=t,this._particleSystem.processor.updateMaterialParams()}},{key:"mesh",get:function(){return this._mesh},set:function(t){this._mesh=t,this._particleSystem.processor.setVertexAttributes()}},{key:"particleMaterial",get:function(){return this._particleSystem?this._particleSystem.getMaterial(0):null},set:function(t){this._particleSystem.setMaterial(t,0)}},{key:"trailMaterial",get:function(){return this._particleSystem?this._particleSystem.getMaterial(1):null},set:function(t){this._particleSystem.setMaterial(t,1)}},{key:"mainTexture",get:function(){return this._mainTexture},set:function(t){this._mainTexture=t}},{key:"useGPU",get:function(){return this._useGPU},set:function(t){this._useGPU!==t&&(w3()?this._useGPU=t:this._useGPU=!1,this._switchProcessor())}}]),t}()).prototype,"renderMode",[N2,L2,F2],Object.getOwnPropertyDescriptor(t3.prototype,"renderMode"),t3.prototype),u(t3.prototype,"velocityScale",[D2,U2],Object.getOwnPropertyDescriptor(t3.prototype,"velocityScale"),t3.prototype),u(t3.prototype,"lengthScale",[k2,z2],Object.getOwnPropertyDescriptor(t3.prototype,"lengthScale"),t3.prototype),e3=u(t3.prototype,"_renderMode",[G2,ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return DQ.Billboard}}),i3=u(t3.prototype,"_velocityScale",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),r3=u(t3.prototype,"_lengthScale",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),n3=u(t3.prototype,"_mesh",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u(t3.prototype,"mesh",[H2,V2,W2],Object.getOwnPropertyDescriptor(t3.prototype,"mesh"),t3.prototype),u(t3.prototype,"particleMaterial",[j2,X2,Y2],Object.getOwnPropertyDescriptor(t3.prototype,"particleMaterial"),t3.prototype),u(t3.prototype,"trailMaterial",[q2,K2,Z2],Object.getOwnPropertyDescriptor(t3.prototype,"trailMaterial"),t3.prototype),s3=u(t3.prototype,"_mainTexture",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),a3=u(t3.prototype,"_useGPU",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),u(t3.prototype,"useGPU",[Q2,J2],Object.getOwnPropertyDescriptor(t3.prototype,"useGPU"),t3.prototype),$2=t3))||$2),d6=Math.cos(Pr(100)),p6={position:new Cs,velocity:new Cs},f6=new Ns,m6=new Hs,g6=new Cs,v6=new Cs,y6=new Qs,T6=function(){function t(t){for(this.start=void 0,this.end=void 0,this.trailElements=void 0,this.start=-1,this.end=-1,this.trailElements=[];t--;)this.trailElements.push({position:new Cs,lifetime:0,width:0,velocity:new Cs,direction:0,color:new Qs})}var e=t.prototype;return e.getElement=function(t){return-1===this.start?null:(t<0&&(t=(t+this.trailElements.length)%this.trailElements.length),t>=this.trailElements.length&&(t%=this.trailElements.length),this.trailElements[t])},e.addElement=function(){if(0===this.trailElements.length)return null;if(-1===this.start)return this.start=0,this.end=1,this.trailElements[0];this.start===this.end&&(this.trailElements.splice(this.end,0,{position:new Cs,lifetime:0,width:0,velocity:new Cs,direction:0,color:new Qs}),this.start++,this.start%=this.trailElements.length);var t=this.end++;return this.end%=this.trailElements.length,this.trailElements[t]},e.iterateElement=function(t,e,i,r){for(var n=this.start>=this.end?this.end+this.trailElements.length:this.end,s=this.start;s<n;s++)e(t,this.trailElements[s%this.trailElements.length],i,r)&&(this.start++,this.start%=this.trailElements.length);this.start===n&&(this.start=-1,this.end=-1)},e.count=function(){return this.start<this.end?this.end-this.start:this.trailElements.length+this.end-this.start},e.clear=function(){this.start=-1,this.end=-1},t}(),E6=(R3=Ne("cc.TrailModule"),x3=si(),O3=pi(GQ),I3=si(),M3=$e(),B3=pi(kK),P3=si(),N3=$e(),L3=si(),F3=$e(),D3=pi(FQ),U3=si(),k3=$e(),z3=pi(HQ),G3=si(),H3=$e(),V3=si(),W3=$e(),j3=pi(kK),X3=si(),Y3=$e(),q3=si(),K3=$e(),Z3=pi(YZ),Q3=si(),J3=$e(),$3=pi(YZ),t5=si(),e5=$e(),i5=pi(FQ),R3((u((n5=function(){function t(){l(this,"_enable",s5,this),l(this,"mode",a5,this),l(this,"lifeTime",o5,this),l(this,"_minParticleDistance",h5,this),l(this,"existWithParticles",l5,this),l(this,"textureMode",u5,this),l(this,"widthFromParticle",c5,this),l(this,"widthRatio",_5,this),l(this,"colorFromParticle",d5,this),l(this,"colorOverTrail",p5,this),l(this,"colorOvertime",f5,this),l(this,"_space",m5,this),l(this,"_particleSystem",g5,this),this._minSquaredDistance=0,this._vertSize=void 0,this._trailNum=0,this._trailLifetime=0,this.vbOffset=0,this.ibOffset=0,this._trailSegments=null,this._particleTrail=void 0,this._trailModel=null,this._iaInfo=void 0,this._iaInfoBuffer=null,this._subMeshData=null,this._vertAttrs=void 0,this._vbF32=null,this._vbUint32=null,this._iBuffer=null,this._needTransform=!1,this._material=null,this._iaInfo=new ql([new Xl]),this._vertAttrs=[new hu(tl.ATTR_POSITION,il.RGB32F),new hu(tl.ATTR_TEX_COORD,il.RGBA32F),new hu(tl.ATTR_TEX_COORD1,il.RGB32F),new hu(tl.ATTR_COLOR,il.RGBA8,!0)],this._vertSize=0;for(var t,e=h(this._vertAttrs);!(t=e()).done;){var i=t.value;this._vertSize+=zl[i.format].size}this._particleTrail=new Map}r(t,[{key:"enable",get:function(){return this._enable},set:function(t){t===this._enable&&this._trailModel||(t&&!this._enable&&(this._enable=t,this._particleSystem.processor.updateTrailMaterial()),t&&!this._trailModel&&(this._createModel(),this.rebuild()),this._enable=t,this._trailModel&&(this._trailModel.enabled=t),t?this.onEnable():this.onDisable())}},{key:"minParticleDistance",get:function(){return this._minParticleDistance},set:function(t){this._minParticleDistance=t,this._minSquaredDistance=t*t}},{key:"space",get:function(){return this._space},set:function(t){this._space=t,this._particleSystem&&this._particleSystem.processor.updateTrailMaterial()}}]);var e=t.prototype;return e.onInit=function(t){this._particleSystem=t,this.minParticleDistance=this._minParticleDistance;for(var e=0,i=t.startLifetime.getMax(),r=t.rateOverTime.getMax(),n=t.duration,s=0,a=t.bursts.length;s<a;s++)e+=t.bursts[s].getMaxCount(t)*Math.ceil(i/n);this._trailNum=Math.ceil(i*this.lifeTime.getMax()*60*(r*n+e)),this._trailSegments=new Hi((function(){return new T6(10)}),Math.ceil(r*n)),this._enable&&(this.enable=this._enable)},e.onEnable=function(){this._attachToScene()},e.onDisable=function(){this._particleTrail.clear(),this._detachFromScene()},e._attachToScene=function(){this._trailModel&&(this._trailModel.scene&&this._detachFromScene(),this._particleSystem._getRenderScene().addModel(this._trailModel))},e._detachFromScene=function(){this._trailModel&&this._trailModel.scene&&this._trailModel.scene.removeModel(this._trailModel)},e.destroy=function(){this.destroySubMeshData(),this._trailModel&&(NF.root.destroyModel(this._trailModel),this._trailModel=null),this._trailSegments&&(this._trailSegments.destroy((function(t){t.trailElements.length=0})),this._trailSegments=null)},e.clear=function(){if(this.enable){for(var t=this._particleTrail.values(),e=t.next();!e.done;)e.value.clear(),e=t.next();this._particleTrail.clear(),this.updateRenderData()}},e.updateMaterial=function(){this._particleSystem&&(this._material=this._particleSystem.getMaterialInstance(1)||this._particleSystem.processor._defaultTrailMat,this._trailModel&&this._trailModel.setSubModelMaterial(0,this._material))},e.update=function(){this._trailLifetime=this.lifeTime.evaluate(this._particleSystem._time,1),this.space===FQ.World&&this._particleSystem._simulationSpace===FQ.Local?(this._needTransform=!0,this._particleSystem.node.getWorldMatrix(m6),this._particleSystem.node.getWorldRotation(f6)):this._needTransform=!1},e.animate=function(t,e){if(this._trailSegments){var i=this._particleTrail.get(t);if(!i)return i=this._trailSegments.alloc(),void this._particleTrail.set(t,i);var r=i.getElement(i.end-1);if(this._needTransform?Cs.transformMat4(g6,t.position,m6):Cs.copy(g6,t.position),!(r&&(i.iterateElement(this,this._updateTrailElement,t,e),Cs.squaredDistance(r.position,g6)<this._minSquaredDistance))&&(r=i.addElement())){Cs.copy(r.position,g6),r.lifetime=0,this.widthFromParticle?r.width=t.size.x*this.widthRatio.evaluate(0,1):r.width=this.widthRatio.evaluate(0,1);var n=i.count();if(2===n){var s=i.getElement(i.end-2);Cs.subtract(s.velocity,r.position,s.position)}else if(n>2){var a=i.getElement(i.end-2),o=i.getElement(i.end-3);Cs.subtract(g6,o.position,a.position),Cs.subtract(v6,r.position,a.position),Cs.subtract(a.velocity,v6,g6),Cs.equals(Cs.ZERO,a.velocity)&&Cs.copy(a.velocity,g6),Cs.normalize(a.velocity,a.velocity),this._checkDirectionReverse(a,o)}this.colorFromParticle?r.color.set(t.color):r.color.set(this.colorOvertime.evaluate(0,1))}}},e.removeParticle=function(t){var e=this._particleTrail.get(t);e&&this._trailSegments&&(e.clear(),this._trailSegments.free(e),this._particleTrail.delete(t))},e.updateRenderData=function(){this.vbOffset=0,this.ibOffset=0;for(var t,e=h(this._particleTrail.keys());!(t=e()).done;){var i=t.value,r=this._particleTrail.get(i);if(-1!==r.start){var n=4*this.vbOffset/this._vertSize,s=r.start>=r.end?r.end+r.trailElements.length:r.end,a=s-r.start,o=1/a,l=r.trailElements[r.start];this._fillVertexBuffer(l,this.colorOverTrail.evaluate(1,1),n,1,0,4);for(var u=r.start+1;u<s;u++){var c=r.trailElements[u%r.trailElements.length],_=u-r.start;this._fillVertexBuffer(c,this.colorOverTrail.evaluate(1-_/a,1),n,1-_*o,_,5)}if(this._needTransform?Cs.transformMat4(p6.position,i.position,m6):Cs.copy(p6.position,i.position),1===a||2===a){var d=r.getElement(r.end-1);Cs.subtract(d.velocity,p6.position,d.position),this._vbF32[this.vbOffset-this._vertSize/4-4]=d.velocity.x,this._vbF32[this.vbOffset-this._vertSize/4-3]=d.velocity.y,this._vbF32[this.vbOffset-this._vertSize/4-2]=d.velocity.z,this._vbF32[this.vbOffset-4]=d.velocity.x,this._vbF32[this.vbOffset-3]=d.velocity.y,this._vbF32[this.vbOffset-2]=d.velocity.z,Cs.subtract(p6.velocity,p6.position,d.position),this._checkDirectionReverse(p6,d)}else if(a>2){var p=r.getElement(r.end-1),f=r.getElement(r.end-2);Cs.subtract(g6,f.position,p.position),Cs.subtract(v6,p6.position,p.position),Cs.normalize(g6,g6),Cs.normalize(v6,v6),Cs.subtract(p.velocity,v6,g6),Cs.normalize(p.velocity,p.velocity),this._checkDirectionReverse(p,f),this.vbOffset-=this._vertSize/4*2,this.ibOffset-=6,this._fillVertexBuffer(p,this.colorOverTrail.evaluate(o,1),n,o,a-1,5),Cs.subtract(p6.velocity,p6.position,p.position),Cs.normalize(p6.velocity,p6.velocity),this._checkDirectionReverse(p6,p)}this.widthFromParticle?p6.width=i.size.x*this.widthRatio.evaluate(0,1):p6.width=this.widthRatio.evaluate(0,1),p6.color=i.color,Cs.equals(p6.velocity,Cs.ZERO)?this.ibOffset-=3:this._fillVertexBuffer(p6,this.colorOverTrail.evaluate(0,1),n,0,a,1)}}this.updateIA(this.ibOffset)},e.updateIA=function(t){var e=this._trailModel&&this._trailModel.subModels;if(e&&e.length>0){var i=e[0];i.inputAssembler.vertexBuffers[0].update(this._vbF32),i.inputAssembler.indexBuffer.update(this._iBuffer),this._iaInfo.drawInfos[0].firstIndex=0,this._iaInfo.drawInfos[0].indexCount=t,this._iaInfoBuffer.update(this._iaInfo)}},e._createModel=function(){this._trailModel||(this._trailModel=_.director.root.createModel(aC))},e.rebuild=function(){var t=NF.root.device,e=t.createBuffer(new Kl(rl.VERTEX|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,this._vertSize*(this._trailNum+1)*2,this._vertSize)),i=new ArrayBuffer(this._vertSize*(this._trailNum+1)*2);this._vbF32=new Float32Array(i),this._vbUint32=new Uint32Array(i),e.update(i);var r=t.createBuffer(new Kl(rl.INDEX|rl.TRANSFER_DST,nl.HOST|nl.DEVICE,6*this._trailNum*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT));this._iBuffer=new Uint16Array(6*this._trailNum),r.update(this._iBuffer),this._iaInfoBuffer=t.createBuffer(new Kl(rl.INDIRECT,nl.HOST|nl.DEVICE,Yl,Yl)),this._iaInfo.drawInfos[0].vertexCount=2*(this._trailNum+1),this._iaInfo.drawInfos[0].indexCount=6*this._trailNum,this._iaInfoBuffer.update(this._iaInfo),this._subMeshData=new xf([e],this._vertAttrs,ol.TRIANGLE_LIST,r,this._iaInfoBuffer);var n=this._trailModel;n&&(n.node=n.transform=this._particleSystem.node,n.visFlags=this._particleSystem.visibility,n.initSubModel(0,this._subMeshData,this._material),n.enabled=!0)},e._updateTrailElement=function(t,e,i,r){return e.lifetime+=r,t.colorFromParticle?(e.color.set(i.color),e.color.multiply(t.colorOvertime.evaluate(1-i.remainingLifetime/i.startLifetime,1))):e.color.set(t.colorOvertime.evaluate(1-i.remainingLifetime/i.startLifetime,1)),t.widthFromParticle?e.width=i.size.x*t.widthRatio.evaluate(e.lifetime/t._trailLifetime,1):e.width=t.widthRatio.evaluate(e.lifetime/t._trailLifetime,1),e.lifetime>t._trailLifetime},e._fillVertexBuffer=function(t,e,i,r,n,s){this._vbF32[this.vbOffset++]=t.position.x,this._vbF32[this.vbOffset++]=t.position.y,this._vbF32[this.vbOffset++]=t.position.z,this._vbF32[this.vbOffset++]=t.direction,this._vbF32[this.vbOffset++]=t.width,this._vbF32[this.vbOffset++]=r,this._vbF32[this.vbOffset++]=0,this._vbF32[this.vbOffset++]=t.velocity.x,this._vbF32[this.vbOffset++]=t.velocity.y,this._vbF32[this.vbOffset++]=t.velocity.z,y6.set(t.color),y6.multiply(e),this._vbUint32[this.vbOffset++]=y6._val,this._vbF32[this.vbOffset++]=t.position.x,this._vbF32[this.vbOffset++]=t.position.y,this._vbF32[this.vbOffset++]=t.position.z,this._vbF32[this.vbOffset++]=1-t.direction,this._vbF32[this.vbOffset++]=t.width,this._vbF32[this.vbOffset++]=r,this._vbF32[this.vbOffset++]=1,this._vbF32[this.vbOffset++]=t.velocity.x,this._vbF32[this.vbOffset++]=t.velocity.y,this._vbF32[this.vbOffset++]=t.velocity.z,this._vbUint32[this.vbOffset++]=y6._val,1&s&&(this._iBuffer[this.ibOffset++]=i+2*n,this._iBuffer[this.ibOffset++]=i+2*n-1,this._iBuffer[this.ibOffset++]=i+2*n+1),4&s&&(this._iBuffer[this.ibOffset++]=i+2*n,this._iBuffer[this.ibOffset++]=i+2*n+1,this._iBuffer[this.ibOffset++]=i+2*n+2)},e._checkDirectionReverse=function(t,e){Cs.dot(t.velocity,e.velocity)<d6?t.direction=1-e.direction:t.direction=e.direction},e.destroySubMeshData=function(){this._subMeshData&&(this._subMeshData.destroy(),this._subMeshData=null)},t}()).prototype,"enable",[x3],Object.getOwnPropertyDescriptor(n5.prototype,"enable"),n5.prototype),s5=u(n5.prototype,"_enable",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),a5=u(n5.prototype,"mode",[O3,ke,I3,M3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return GQ.Particles}}),o5=u(n5.prototype,"lifeTime",[B3,ke,P3,N3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),h5=u(n5.prototype,"_minParticleDistance",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),u(n5.prototype,"minParticleDistance",[L3,F3],Object.getOwnPropertyDescriptor(n5.prototype,"minParticleDistance"),n5.prototype),u(n5.prototype,"space",[D3,U3,k3],Object.getOwnPropertyDescriptor(n5.prototype,"space"),n5.prototype),l5=u(n5.prototype,"existWithParticles",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),u5=u(n5.prototype,"textureMode",[z3,ke,G3,H3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return HQ.Stretch}}),c5=u(n5.prototype,"widthFromParticle",[ke,V3,W3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),_5=u(n5.prototype,"widthRatio",[j3,ke,X3,Y3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),d5=u(n5.prototype,"colorFromParticle",[ke,q3,K3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),p5=u(n5.prototype,"colorOverTrail",[Z3,ke,Q3,J3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new YZ}}),f5=u(n5.prototype,"colorOvertime",[$3,ke,t5,e5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new YZ}}),m5=u(n5.prototype,"_space",[i5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return FQ.World}}),g5=u(n5.prototype,"_particleSystem",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),r5=n5))||r5),S6=new Hs,b6=new Ns,A6=Object.getOwnPropertyDescriptor(Kw.prototype,"sharedMaterials"),C6=function(e){return t({ParticleSystem:e,ParticleSystemComponent:e}),e}((v5=Ne("cc.ParticleSystem"),y5=qe(),T5=We(),E5=Fe(99),S5=si(),b5=$e(),A5=pi(YZ),C5=si(),w5=$e(),R5=pi(FQ),x5=si(),O5=$e(),I5=si(),M5=$e(),B5=ze("startSize"),P5=pi(kK),N5=si(),L5=$e(),F5=pi(kK),D5=si(),U5=$e(),k5=pi(kK),z5=si(),G5=$e(),H5=pi(kK),V5=ti(),W5=si(),j5=$e(),X5=si(),Y5=$e(),q5=pi(kK),K5=ti(),Z5=si(),Q5=$e(),J5=pi(kK),$5=ti(),t4=si(),e4=$e(),i4=pi(kK),r4=ze("startRotation"),n4=ti(),s4=si(),a4=$e(),o4=pi(kK),h4=si(),l4=$e(),u4=pi(kK),c4=si(),_4=$e(),d4=si(),p4=$e(),f4=si(),m4=$e(),g4=si(),v4=$e(),y4=pi(FQ),T4=si(),E4=$e(),S4=si(),b4=$e(),A4=si(),C4=$e(),w4=pi(kK),R4=ti(),x4=si(),O4=$e(),I4=pi(kK),M4=si(),B4=$e(),P4=pi(kK),N4=si(),L4=$e(),F4=pi([R2]),D4=si(),U4=$e(),k4=pi(mg),z4=Je(),G4=Ze(),H4=pi(VQ),V4=pi(VQ),W4=si(),j4=$e(),X4=pi(M2),Y4=pi(M2),q4=si(),K4=$e(),Z4=pi(E2),Q4=pi(E2),J4=si(),$4=$e(),t8=pi(w2),e8=pi(w2),i8=si(),r8=$e(),n8=pi(s$),s8=pi(s$),a8=si(),o8=$e(),h8=pi(h$),l8=pi(h$),u8=si(),c8=$e(),_8=pi(T2),d8=pi(T2),p8=si(),f8=$e(),m8=pi(A2),g8=pi(A2),v8=si(),y8=$e(),T8=pi(E6),E8=pi(E6),S8=si(),b8=$e(),A8=pi(_6),C8=si(),w8=$e(),R8=si(),x8=$e(),v5(O8=y5(O8=T5(O8=E5(O8=Ve((u((I8=function(t){function e(){var e;return l(e=t.call(this)||this,"startColor",M8,a(e)),l(e,"scaleSpace",B8,a(e)),l(e,"startSize3D",P8,a(e)),l(e,"startSizeX",N8,a(e)),l(e,"startSizeY",L8,a(e)),l(e,"startSizeZ",F8,a(e)),l(e,"startSpeed",D8,a(e)),l(e,"startRotation3D",U8,a(e)),l(e,"startRotationX",k8,a(e)),l(e,"startRotationY",z8,a(e)),l(e,"startRotationZ",G8,a(e)),l(e,"startDelay",H8,a(e)),l(e,"startLifetime",V8,a(e)),l(e,"duration",W8,a(e)),l(e,"loop",j8,a(e)),l(e,"simulationSpeed",X8,a(e)),l(e,"playOnAwake",Y8,a(e)),l(e,"gravityModifier",q8,a(e)),l(e,"rateOverTime",K8,a(e)),l(e,"rateOverDistance",Z8,a(e)),l(e,"bursts",Q8,a(e)),l(e,"_colorOverLifetimeModule",J8,a(e)),l(e,"_shapeModule",$8,a(e)),l(e,"_sizeOvertimeModule",t6,a(e)),l(e,"_velocityOvertimeModule",e6,a(e)),l(e,"_forceOvertimeModule",i6,a(e)),l(e,"_limitVelocityOvertimeModule",r6,a(e)),l(e,"_rotationOvertimeModule",n6,a(e)),l(e,"_textureAnimationModule",s6,a(e)),l(e,"_trailModule",a6,a(e)),l(e,"renderer",o6,a(e)),l(e,"enableCulling",h6,a(e)),e._isPlaying=void 0,e._isPaused=void 0,e._isStopped=void 0,e._isEmitting=void 0,e._time=void 0,e._emitRateTimeCounter=void 0,e._emitRateDistanceCounter=void 0,e._oldWPos=void 0,e._curWPos=void 0,e._customData1=void 0,e._customData2=void 0,e._subEmitters=void 0,l(e,"_prewarm",l6,a(e)),l(e,"_capacity",u6,a(e)),l(e,"_simulationSpace",c6,a(e)),e.processor=null,e.rateOverTime.constant=10,e.startLifetime.constant=5,e.startSizeX.constant=1,e.startSpeed.constant=5,e._isPlaying=!1,e._isPaused=!1,e._isStopped=!0,e._isEmitting=!1,e._time=0,e._emitRateTimeCounter=0,e._emitRateDistanceCounter=0,e._oldWPos=new Cs,e._curWPos=new Cs,e._customData1=new Es,e._customData2=new Es,e._subEmitters=[],e}s(e,t),r(e,[{key:"capacity",get:function(){return this._capacity},set:function(t){this._capacity=Math.floor(t),this.processor&&this.processor._model&&this.processor._model.setCapacity(this._capacity)}},{key:"prewarm",get:function(){return this._prewarm},set:function(t){!0===t&&this.loop,this._prewarm=t}},{key:"simulationSpace",get:function(){return this._simulationSpace},set:function(t){t!==this._simulationSpace&&(this._simulationSpace=t,this.processor&&(this.processor.updateMaterialParams(),this.processor.updateTrailMaterial()))}},{key:"sharedMaterials",get:function(){return A6.get.call(this)},set:function(t){A6.set.call(this,t)}},{key:"colorOverLifetimeModule",get:function(){return this._colorOverLifetimeModule},set:function(t){t&&(this._colorOverLifetimeModule=t)}},{key:"shapeModule",get:function(){return this._shapeModule},set:function(t){t&&(this._shapeModule=t)}},{key:"sizeOvertimeModule",get:function(){return this._sizeOvertimeModule},set:function(t){t&&(this._sizeOvertimeModule=t)}},{key:"velocityOvertimeModule",get:function(){return this._velocityOvertimeModule},set:function(t){t&&(this._velocityOvertimeModule=t)}},{key:"forceOvertimeModule",get:function(){return this._forceOvertimeModule},set:function(t){t&&(this._forceOvertimeModule=t)}},{key:"limitVelocityOvertimeModule",get:function(){return this._limitVelocityOvertimeModule},set:function(t){t&&(this._limitVelocityOvertimeModule=t)}},{key:"rotationOvertimeModule",get:function(){return this._rotationOvertimeModule},set:function(t){t&&(this._rotationOvertimeModule=t)}},{key:"textureAnimationModule",get:function(){return this._textureAnimationModule},set:function(t){t&&(this._textureAnimationModule=t)}},{key:"trailModule",get:function(){return this._trailModule},set:function(t){t&&(this._trailModule=t)}}]);var i=e.prototype;return i.onLoad=function(){this.renderer.onInit(this),this._shapeModule&&this._shapeModule.onInit(this),this._trailModule&&this._trailModule.onInit(this),this.bindModule(),this._resetPosition()},i._onMaterialModified=function(t,e){this.processor.onMaterialModified(t,e)},i._onRebuildPSO=function(t,e){this.processor.onRebuildPSO(t,e)},i._collectModels=function(){return this._models.length=0,this._models.push(this.processor._model),this._trailModule&&this._trailModule.enable&&this._trailModule._trailModel&&this._models.push(this._trailModule._trailModel),this._models},i._attachToScene=function(){this.processor.attachToScene(),this._trailModule&&this._trailModule.enable&&this._trailModule._attachToScene()},i._detachFromScene=function(){this.processor.detachFromScene(),this._trailModule&&this._trailModule.enable&&this._trailModule._detachFromScene()},i.bindModule=function(){this._colorOverLifetimeModule&&this._colorOverLifetimeModule.bindTarget(this.processor),this._sizeOvertimeModule&&this._sizeOvertimeModule.bindTarget(this.processor),this._rotationOvertimeModule&&this._rotationOvertimeModule.bindTarget(this.processor),this._forceOvertimeModule&&this._forceOvertimeModule.bindTarget(this.processor),this._limitVelocityOvertimeModule&&this._limitVelocityOvertimeModule.bindTarget(this.processor),this._velocityOvertimeModule&&this._velocityOvertimeModule.bindTarget(this.processor),this._textureAnimationModule&&this._textureAnimationModule.bindTarget(this.processor)},i.play=function(){this._isPaused&&(this._isPaused=!1),this._isStopped&&(this._isStopped=!1),this._isPlaying=!0,this._isEmitting=!0,this._resetPosition(),this._prewarm&&this._prewarmSystem()},i.pause=function(){this._isStopped?console.warn("pause(): particle system is already stopped."):(this._isPlaying&&(this._isPlaying=!1),this._isPaused=!0)},i.stop=function(){(this._isPlaying||this._isPaused)&&this.clear(),this._isPlaying&&(this._isPlaying=!1),this._isPaused&&(this._isPaused=!1),this._time=0,this._emitRateTimeCounter=0,this._emitRateDistanceCounter=0,this._isStopped=!0},i.clear=function(){this.enabledInHierarchy&&(this.processor.clear(),this._trailModule&&this._trailModule.clear())},i.getParticleCount=function(){return this.processor.getParticleCount()},i.setCustomData1=function(t,e){Es.set(this._customData1,t,e)},i.setCustomData2=function(t,e){Es.set(this._customData2,t,e)},i.onDestroy=function(){this.processor.onDestroy(),this._trailModule&&this._trailModule.destroy()},i.onEnable=function(){this.playOnAwake&&this.play(),this.processor.onEnable(),this._trailModule&&this._trailModule.onEnable()},i.onDisable=function(){this.processor.onDisable(),this._trailModule&&this._trailModule.onDisable()},i.update=function(t){var e=t*this.simulationSpeed;this._isPlaying&&(this._time+=e,this._emit(e),0!==this.processor.updateParticles(e)||this._isEmitting||this.stop(),this.processor.updateRenderData(),this._trailModule&&this._trailModule.enable&&this._trailModule.updateRenderData())},i._onVisibilityChange=function(t){this.processor._model&&(this.processor._model.visFlags=t)},i.emit=function(t,e){var i=this._time/this.duration;this._simulationSpace===FQ.World&&(this.node.getWorldMatrix(S6),this.node.getWorldRotation(b6));for(var r=0;r<t;++r){var n=this.processor.getFreeParticle();if(null===n)return;var s=Ur(Dr(0,2147483647));this._shapeModule&&this._shapeModule.enable?this._shapeModule.emit(n):(Cs.set(n.position,0,0,0),Cs.copy(n.velocity,WQ)),this._textureAnimationModule&&this._textureAnimationModule.enable&&this._textureAnimationModule.init(n),Cs.multiplyScalar(n.velocity,n.velocity,this.startSpeed.evaluate(i,s)),this._simulationSpace===FQ.World&&(Cs.transformMat4(n.position,n.position,S6),Cs.transformQuat(n.velocity,n.velocity,b6)),Cs.copy(n.ultimateVelocity,n.velocity),this.startRotation3D?Cs.set(n.rotation,this.startRotationX.evaluate(i,s),this.startRotationY.evaluate(i,s),this.startRotationZ.evaluate(i,s)):Cs.set(n.rotation,0,0,this.startRotationZ.evaluate(i,s)),this.startSize3D?Cs.set(n.startSize,this.startSizeX.evaluate(i,s),this.startSizeY.evaluate(i,s),this.startSizeZ.evaluate(i,s)):(Cs.set(n.startSize,this.startSizeX.evaluate(i,s),1,1),n.startSize.y=n.startSize.x),Cs.copy(n.size,n.startSize),n.startColor.set(this.startColor.evaluate(i,s)),n.color.set(n.startColor),n.startLifetime=this.startLifetime.evaluate(i,s)+e,n.remainingLifetime=n.startLifetime,n.randomSeed=Dr(0,233280),this.processor.setNewParticle(n)}},i._prewarmSystem=function(){this.startDelay.mode=UK.Constant,this.startDelay.constant=0;for(var t=this.duration/1,e=0;e<t;++e)this._time+=1,this._emit(1),this.processor.updateParticles(1)},i._emit=function(t){var e=this.startDelay.evaluate(0,1);if(this._time>e){if(this._time>this.duration+e&&!this.loop)return void(this._isEmitting=!1);if(this._emitRateTimeCounter+=this.rateOverTime.evaluate(this._time/this.duration,1)*t,this._emitRateTimeCounter>1&&this._isEmitting){var i=Math.floor(this._emitRateTimeCounter);this._emitRateTimeCounter-=i,this.emit(i,t)}this.node.getWorldPosition(this._curWPos);var r=Cs.distance(this._curWPos,this._oldWPos);if(Cs.copy(this._oldWPos,this._curWPos),this._emitRateDistanceCounter+=r*this.rateOverDistance.evaluate(this._time/this.duration,1),this._emitRateDistanceCounter>1&&this._isEmitting){var n=Math.floor(this._emitRateDistanceCounter);this._emitRateDistanceCounter-=n,this.emit(n,t)}for(var s,a=h(this.bursts);!(s=a()).done;)s.value.update(this,t)}},i._resetPosition=function(){this.node.getWorldPosition(this._oldWPos),Cs.copy(this._curWPos,this._oldWPos)},i.addSubEmitter=function(t){this._subEmitters.push(t)},i.removeSubEmitter=function(t){this._subEmitters.splice(this._subEmitters.indexOf(t),1)},i.addBurst=function(t){this.bursts.push(t)},i.removeBurst=function(t){this.bursts.splice(this.bursts.indexOf(t),1)},i._onBeforeSerialize=function(t){var e=this;return this.enableCulling?t.filter((function(t){return!NQ.includes(t)||e[t]&&e[t].enable})):t},r(e,[{key:"isPlaying",get:function(){return this._isPlaying}},{key:"isPaused",get:function(){return this._isPaused}},{key:"isStopped",get:function(){return this._isStopped}},{key:"isEmitting",get:function(){return this._isEmitting}},{key:"time",get:function(){return this._time}}]),e}(Kw)).prototype,"capacity",[S5,b5],Object.getOwnPropertyDescriptor(I8.prototype,"capacity"),I8.prototype),M8=u(I8.prototype,"startColor",[A5,ke,C5,w5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new YZ}}),B8=u(I8.prototype,"scaleSpace",[R5,ke,x5,O5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return FQ.Local}}),P8=u(I8.prototype,"startSize3D",[ke,I5,M5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),N8=u(I8.prototype,"startSizeX",[B5,P5,N5,L5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),L8=u(I8.prototype,"startSizeY",[F5,ke,D5,U5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),F8=u(I8.prototype,"startSizeZ",[k5,ke,z5,G5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),D8=u(I8.prototype,"startSpeed",[H5,ke,V5,W5,j5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),U8=u(I8.prototype,"startRotation3D",[ke,X5,Y5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),k8=u(I8.prototype,"startRotationX",[q5,ke,K5,oi,Z5,Q5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),z8=u(I8.prototype,"startRotationY",[J5,ke,$5,oi,t4,e4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),G8=u(I8.prototype,"startRotationZ",[i4,r4,n4,oi,s4,a4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),H8=u(I8.prototype,"startDelay",[o4,ke,h4,l4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),V8=u(I8.prototype,"startLifetime",[u4,ke,c4,_4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),W8=u(I8.prototype,"duration",[ke,d4,p4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),j8=u(I8.prototype,"loop",[ke,f4,m4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),u(I8.prototype,"prewarm",[g4,v4],Object.getOwnPropertyDescriptor(I8.prototype,"prewarm"),I8.prototype),u(I8.prototype,"simulationSpace",[y4,ke,T4,E4],Object.getOwnPropertyDescriptor(I8.prototype,"simulationSpace"),I8.prototype),X8=u(I8.prototype,"simulationSpeed",[ke,S4,b4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Y8=u(I8.prototype,"playOnAwake",[ke,A4,C4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),q8=u(I8.prototype,"gravityModifier",[w4,ke,R4,x4,O4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),K8=u(I8.prototype,"rateOverTime",[I4,ke,M4,B4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),Z8=u(I8.prototype,"rateOverDistance",[P4,ke,N4,L4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kK}}),Q8=u(I8.prototype,"bursts",[F4,ke,D4,U4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),u(I8.prototype,"sharedMaterials",[fi,k4,ke,z4,G4],Object.getOwnPropertyDescriptor(I8.prototype,"sharedMaterials"),I8.prototype),J8=u(I8.prototype,"_colorOverLifetimeModule",[H4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u(I8.prototype,"colorOverLifetimeModule",[V4,W4,j4],Object.getOwnPropertyDescriptor(I8.prototype,"colorOverLifetimeModule"),I8.prototype),$8=u(I8.prototype,"_shapeModule",[X4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u(I8.prototype,"shapeModule",[Y4,q4,K4],Object.getOwnPropertyDescriptor(I8.prototype,"shapeModule"),I8.prototype),t6=u(I8.prototype,"_sizeOvertimeModule",[Z4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u(I8.prototype,"sizeOvertimeModule",[Q4,J4,$4],Object.getOwnPropertyDescriptor(I8.prototype,"sizeOvertimeModule"),I8.prototype),e6=u(I8.prototype,"_velocityOvertimeModule",[t8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u(I8.prototype,"velocityOvertimeModule",[e8,i8,r8],Object.getOwnPropertyDescriptor(I8.prototype,"velocityOvertimeModule"),I8.prototype),i6=u(I8.prototype,"_forceOvertimeModule",[n8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u(I8.prototype,"forceOvertimeModule",[s8,a8,o8],Object.getOwnPropertyDescriptor(I8.prototype,"forceOvertimeModule"),I8.prototype),r6=u(I8.prototype,"_limitVelocityOvertimeModule",[h8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u(I8.prototype,"limitVelocityOvertimeModule",[l8,u8,c8],Object.getOwnPropertyDescriptor(I8.prototype,"limitVelocityOvertimeModule"),I8.prototype),n6=u(I8.prototype,"_rotationOvertimeModule",[_8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u(I8.prototype,"rotationOvertimeModule",[d8,p8,f8],Object.getOwnPropertyDescriptor(I8.prototype,"rotationOvertimeModule"),I8.prototype),s6=u(I8.prototype,"_textureAnimationModule",[m8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u(I8.prototype,"textureAnimationModule",[g8,v8,y8],Object.getOwnPropertyDescriptor(I8.prototype,"textureAnimationModule"),I8.prototype),a6=u(I8.prototype,"_trailModule",[T8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u(I8.prototype,"trailModule",[E8,S8,b8],Object.getOwnPropertyDescriptor(I8.prototype,"trailModule"),I8.prototype),o6=u(I8.prototype,"renderer",[A8,ke,C8,w8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _6}}),h6=u(I8.prototype,"enableCulling",[ke,R8,x8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),l6=u(I8.prototype,"_prewarm",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),u6=u(I8.prototype,"_capacity",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),c6=u(I8.prototype,"_simulationSpace",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return FQ.Local}}),O8=I8))||O8)||O8)||O8)||O8)||O8)),w6=t("ParticleUtils",function(){function t(){}return t.instantiate=function(t){return this.registeredSceneEvent||(NF.on(PF.EVENT_BEFORE_SCENE_LAUNCH,this.onSceneUnload,this),this.registeredSceneEvent=!0),this.particleSystemPool.has(t._uuid)||this.particleSystemPool.set(t._uuid,new Hi((function(){return YR(t)||new py}),1)),this.particleSystemPool.get(t._uuid).alloc()},t.destroy=function(t){this.particleSystemPool.has(t._prefab.asset._uuid)&&(this.stop(t),this.particleSystemPool.get(t._prefab.asset._uuid).free(t))},t.play=function(t){for(var e,i=h(t.getComponentsInChildren(C6));!(e=i()).done;)e.value.play()},t.stop=function(t){for(var e,i=h(t.getComponentsInChildren(C6));!(e=i()).done;)e.value.stop()},t.onSceneUnload=function(){this.particleSystemPool.forEach((function(t){t.destroy((function(t){t.destroy()}))})),this.particleSystemPool.clear()},t}());function R6(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}w6.particleSystemPool=new Map,w6.registeredSceneEvent=!1,ta(R2.prototype,"Burst.prototype",[{name:"minCount"},{name:"maxCount"}]),_.ParticleSystemComponent=C6,Mt.setClassAlias(C6,"cc.ParticleSystemComponent"),_.BillboardComponent=PK,Mt.setClassAlias(PK,"cc.BillboardComponent"),_.LineComponent=MQ,Mt.setClassAlias(MQ,"cc.LineComponent"),_.ParticleUtils=w6;var x6,O6,I6,M6,B6,P6,N6,L6,F6=function(t,e){return function(t){t.exports=function t(e,i,r){function n(a,o){if(!i[a]){if(!e[a]){if(!o&&R6)return R6();if(s)return s(a,!0);throw new Error("Cannot find module '"+a+"'")}var h=i[a]={exports:{}};e[a][0].call(h.exports,(function(t){return n(e[a][1][t]||t)}),h,h.exports,t,e,i,r)}return i[a].exports}for(var s=R6,a=0;a<r.length;a++)n(r[a]);return n}({1:[function(t,e){e.exports={name:"@cocos/cannon",version:"1.1.1-exp.4",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/cocos-creator/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se), JayceLai",keywords:["cannon.js","cocos","creator","physics","engine","3d"],scripts:{build:"grunt && npm run preprocess && grunt addLicense && grunt addDate",preprocess:"node node_modules/uglify-js/bin/uglifyjs build/cannon.js -o build/cannon.min.js -c -m"},main:"./build/cannon.min.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/cocos-creator/cannon.js.git"},bugs:{url:"https://github.com/cocos-creator/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(t,e){e.exports={version:t("../package.json").version,AABB:t("./collision/AABB"),ArrayCollisionMatrix:t("./collision/ArrayCollisionMatrix"),Body:t("./objects/Body"),Box:t("./shapes/Box"),Broadphase:t("./collision/Broadphase"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),Narrowphase:t("./world/Narrowphase"),ConeTwistConstraint:t("./constraints/ConeTwistConstraint"),ContactMaterial:t("./material/ContactMaterial"),ConvexPolyhedron:t("./shapes/ConvexPolyhedron"),Cylinder:t("./shapes/Cylinder"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventTarget:t("./utils/EventTarget"),FrictionEquation:t("./equations/FrictionEquation"),GSSolver:t("./solver/GSSolver"),GridBroadphase:t("./collision/GridBroadphase"),Heightfield:t("./shapes/Heightfield"),HingeConstraint:t("./constraints/HingeConstraint"),LockConstraint:t("./constraints/LockConstraint"),Mat3:t("./math/Mat3"),Material:t("./material/Material"),NaiveBroadphase:t("./collision/NaiveBroadphase"),ObjectCollisionMatrix:t("./collision/ObjectCollisionMatrix"),Pool:t("./utils/Pool"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),PointToPointConstraint:t("./constraints/PointToPointConstraint"),Quaternion:t("./math/Quaternion"),Ray:t("./collision/Ray"),RaycastVehicle:t("./objects/RaycastVehicle"),RaycastResult:t("./collision/RaycastResult"),RigidVehicle:t("./objects/RigidVehicle"),RotationalEquation:t("./equations/RotationalEquation"),RotationalMotorEquation:t("./equations/RotationalMotorEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),SPHSystem:t("./objects/SPHSystem"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Sphere:t("./shapes/Sphere"),SplitSolver:t("./solver/SplitSolver"),Spring:t("./objects/Spring"),Transform:t("./math/Transform"),Trimesh:t("./shapes/Trimesh"),Vec3:t("./math/Vec3"),Vec3Pool:t("./utils/Vec3Pool"),World:t("./world/World"),Octree:t("./utils/Octree"),CMath:t("./math/CMath")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":10,"./collision/RaycastResult":11,"./collision/SAPBroadphase":12,"./constraints/ConeTwistConstraint":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/HingeConstraint":16,"./constraints/LockConstraint":17,"./constraints/PointToPointConstraint":18,"./equations/ContactEquation":20,"./equations/Equation":21,"./equations/FrictionEquation":22,"./equations/RotationalEquation":23,"./equations/RotationalMotorEquation":24,"./material/ContactMaterial":25,"./material/Material":26,"./math/CMath":27,"./math/Mat3":29,"./math/Quaternion":30,"./math/Transform":31,"./math/Vec3":32,"./objects/Body":33,"./objects/RaycastVehicle":34,"./objects/RigidVehicle":35,"./objects/SPHSystem":36,"./objects/Spring":37,"./shapes/Box":39,"./shapes/ConvexPolyhedron":40,"./shapes/Cylinder":41,"./shapes/Heightfield":42,"./shapes/Particle":43,"./shapes/Plane":44,"./shapes/Shape":45,"./shapes/Sphere":46,"./shapes/Trimesh":47,"./solver/GSSolver":48,"./solver/Solver":49,"./solver/SplitSolver":50,"./utils/EventTarget":51,"./utils/Octree":52,"./utils/Pool":53,"./utils/Vec3Pool":56,"./world/Narrowphase":57,"./world/World":58}],3:[function(t,e){var i=t("../math/Vec3");function r(t){t=t||{},this.lowerBound=new i,t.lowerBound&&this.lowerBound.copy(t.lowerBound),this.upperBound=new i,t.upperBound&&this.upperBound.copy(t.upperBound)}t("../utils/Utils"),e.exports=r;var n=new i;r.prototype.setFromPoints=function(t,e,i,r){var s=this.lowerBound,a=this.upperBound,o=i;s.copy(t[0]),o&&o.vmult(s,s),a.copy(s);for(var h=1;h<t.length;h++){var l=t[h];o&&(o.vmult(l,n),l=n),l.x>a.x&&(a.x=l.x),l.x<s.x&&(s.x=l.x),l.y>a.y&&(a.y=l.y),l.y<s.y&&(s.y=l.y),l.z>a.z&&(a.z=l.z),l.z<s.z&&(s.z=l.z)}return e&&(e.vadd(s,s),e.vadd(a,a)),r&&(s.x-=r,s.y-=r,s.z-=r,a.x+=r,a.y+=r,a.z+=r),this},r.prototype.copy=function(t){return this.lowerBound.copy(t.lowerBound),this.upperBound.copy(t.upperBound),this},r.prototype.clone=function(){return(new r).copy(this)},r.prototype.extend=function(t){this.lowerBound.x=Math.min(this.lowerBound.x,t.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,t.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,t.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,t.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,t.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,t.upperBound.z)},r.prototype.overlaps=function(t){var e=this.lowerBound,i=this.upperBound,r=t.lowerBound,n=t.upperBound,s=r.x<=i.x&&i.x<=n.x||e.x<=n.x&&n.x<=i.x,a=r.y<=i.y&&i.y<=n.y||e.y<=n.y&&n.y<=i.y,o=r.z<=i.z&&i.z<=n.z||e.z<=n.z&&n.z<=i.z;return s&&a&&o},r.prototype.volume=function(){var t=this.lowerBound,e=this.upperBound;return(e.x-t.x)*(e.y-t.y)*(e.z-t.z)},r.prototype.contains=function(t){var e=this.lowerBound,i=this.upperBound,r=t.lowerBound,n=t.upperBound;return e.x<=r.x&&i.x>=n.x&&e.y<=r.y&&i.y>=n.y&&e.z<=r.z&&i.z>=n.z},r.prototype.getCorners=function(t,e,i,r,n,s,a,o){var h=this.lowerBound,l=this.upperBound;t.copy(h),e.set(l.x,h.y,h.z),i.set(l.x,l.y,h.z),r.set(h.x,l.y,l.z),n.set(l.x,h.y,l.z),s.set(h.x,l.y,h.z),a.set(h.x,h.y,l.z),o.copy(l)};var s=[new i,new i,new i,new i,new i,new i,new i,new i];r.prototype.toLocalFrame=function(t,e){var i=s,r=i[0],n=i[1],a=i[2],o=i[3],h=i[4],l=i[5],u=i[6],c=i[7];this.getCorners(r,n,a,o,h,l,u,c);for(var _=0;8!==_;_++){var d=i[_];t.pointToLocal(d,d)}return e.setFromPoints(i)},r.prototype.toWorldFrame=function(t,e){var i=s,r=i[0],n=i[1],a=i[2],o=i[3],h=i[4],l=i[5],u=i[6],c=i[7];this.getCorners(r,n,a,o,h,l,u,c);for(var _=0;8!==_;_++){var d=i[_];t.pointToWorld(d,d)}return e.setFromPoints(i)},r.prototype.overlapsRay=function(t){var e=1/t._direction.x,i=1/t._direction.y,r=1/t._direction.z,n=(this.lowerBound.x-t.from.x)*e,s=(this.upperBound.x-t.from.x)*e,a=(this.lowerBound.y-t.from.y)*i,o=(this.upperBound.y-t.from.y)*i,h=(this.lowerBound.z-t.from.z)*r,l=(this.upperBound.z-t.from.z)*r,u=Math.max(Math.max(Math.min(n,s),Math.min(a,o)),Math.min(h,l)),c=Math.min(Math.min(Math.max(n,s),Math.max(a,o)),Math.max(h,l));return!(c<0||c<u)}},{"../math/Vec3":32,"../utils/Utils":55}],4:[function(t,e){function i(){this.matrix=[]}(e.exports=i).prototype.get=function(t,e){if((t=t.index)<(e=e.index)){var i=e;e=t,t=i}return this.matrix[(t*(t+1)>>1)+e-1]},i.prototype.set=function(t,e,i){if((t=t.index)<(e=e.index)){var r=e;e=t,t=r}this.matrix[(t*(t+1)>>1)+e-1]=i?1:0},i.prototype.reset=function(){for(var t=0,e=this.matrix.length;t!==e;t++)this.matrix[t]=0},i.prototype.setNumObjects=function(t){this.matrix.length=t*(t-1)>>1}},{}],5:[function(t,e){var i=t("../objects/Body"),r=t("../math/Vec3"),n=t("../math/Quaternion");function s(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}t("../shapes/Shape"),t("../shapes/Plane"),(e.exports=s).prototype.collisionPairs=function(){throw new Error("collisionPairs not implemented for this BroadPhase class!")},s.prototype.needBroadphaseCollision=function(t,e){return 0!=(t.collisionFilterGroup&e.collisionFilterMask)&&0!=(e.collisionFilterGroup&t.collisionFilterMask)&&(!(!t.hasTrigger&&!e.hasTrigger)||0==(t.type&i.STATIC)&&t.sleepState!==i.SLEEPING||0==(e.type&i.STATIC)&&e.sleepState!==i.SLEEPING)},s.prototype.intersectionTest=function(t,e,i,r){this.useBoundingBoxes?this.doBoundingBoxBroadphase(t,e,i,r):this.doBoundingSphereBroadphase(t,e,i,r)};var a=new r;new r,new n,new r,s.prototype.doBoundingSphereBroadphase=function(t,e,i,r){var n=a;e.position.vsub(t.position,n);var s=Math.pow(t.boundingRadius+e.boundingRadius,2);n.norm2()<s&&(i.push(t),r.push(e))},s.prototype.doBoundingBoxBroadphase=function(t,e,i,r){t.aabbNeedsUpdate&&t.computeAABB(),e.aabbNeedsUpdate&&e.computeAABB(),t.aabb.overlaps(e.aabb)&&(i.push(t),r.push(e))};var o={keys:[]},h=[],l=[];s.prototype.makePairsUnique=function(t,e){for(var i=o,r=h,n=l,s=t.length,a=0;a!==s;a++)r[a]=t[a],n[a]=e[a];for(t.length=0,a=e.length=0;a!==s;a++){var u=r[a].id,c=n[a].id;i[_=u<c?u+","+c:c+","+u]=a,i.keys.push(_)}for(a=0;a!==i.keys.length;a++){var _=i.keys.pop(),d=i[_];t.push(r[d]),e.push(n[d]),delete i[_]}},s.prototype.setWorld=function(){};var u=new r;s.boundingSphereCheck=function(t,e){var i=u;return t.position.vsub(e.position,i),Math.pow(t.shape.boundingSphereRadius+e.shape.boundingSphereRadius,2)>i.norm2()},s.prototype.aabbQuery=function(){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":30,"../math/Vec3":32,"../objects/Body":33,"../shapes/Plane":44,"../shapes/Shape":45}],6:[function(t,e){e.exports=s;var i=t("./Broadphase"),r=t("../math/Vec3"),n=t("../shapes/Shape");function s(t,e,n,s,a){i.apply(this),this.nx=n||10,this.ny=s||10,this.nz=a||10,this.aabbMin=t||new r(100,100,100),this.aabbMax=e||new r(-100,-100,-100);var o=this.nx*this.ny*this.nz;if(o<=0)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=o,this.binLengths.length=o;for(var h=0;h<o;h++)this.bins[h]=[],this.binLengths[h]=0}(s.prototype=new i).constructor=s;var a=new r;new r,s.prototype.collisionPairs=function(t,e,i){for(var r=t.numObjects(),s=t.bodies,o=this.aabbMax,h=this.aabbMin,l=this.nx,u=this.ny,c=this.nz,_=u*c,d=c,p=o.x,f=o.y,m=o.z,g=h.x,v=h.y,y=h.z,T=l/(p-g),E=u/(f-v),S=c/(m-y),b=(p-g)/l,A=(f-v)/u,C=(m-y)/c,w=.5*Math.sqrt(b*b+A*A+C*C),R=n.types,x=R.SPHERE,O=R.PLANE,I=(R.BOX,R.COMPOUND,R.CONVEXPOLYHEDRON,this.bins),M=this.binLengths,B=this.bins.length,P=0;P!==B;P++)M[P]=0;var N=Math.ceil;function L(t,e,i,r,n,s,a){var o=(t-g)*T|0,h=(e-v)*E|0,p=(i-y)*S|0,f=N((r-g)*T),m=N((n-v)*E),b=N((s-y)*S);o<0?o=0:l<=o&&(o=l-1),h<0?h=0:u<=h&&(h=u-1),p<0?p=0:c<=p&&(p=c-1),f<0?f=0:l<=f&&(f=l-1),m<0?m=0:u<=m&&(m=u-1),b<0?b=0:c<=b&&(b=c-1),h*=d,p*=1,f*=_,m*=d,b*=1;for(var A=o*=_;A<=f;A+=_)for(var C=h;C<=m;C+=d)for(var w=p;w<=b;w+=1){var R=A+C+w;I[R][M[R]++]=a}}for(h=Math.min,o=Math.max,P=0;P!==r;P++){var F=(et=s[P]).shape;switch(F.type){case x:var D=et.position.x,U=et.position.y,k=et.position.z,z=F.radius;L(D-z,U-z,k-z,D+z,U+z,k+z,et);break;case O:F.worldNormalNeedsUpdate&&F.computeWorldNormal(et.quaternion);var G=F.worldNormal,H=g+.5*b-et.position.x,V=v+.5*A-et.position.y,W=y+.5*C-et.position.z,j=a;j.set(H,V,W);for(var X=0,Y=0;X!==l;X++,Y+=_,j.y=V,j.x+=b)for(var q=0,K=0;q!==u;q++,K+=d,j.z=W,j.y+=A)for(var Z=0,Q=0;Z!==c;Z++,Q+=1,j.z+=C)if(j.dot(G)<w){var J=Y+K+Q;I[J][M[J]++]=et}break;default:et.aabbNeedsUpdate&&et.computeAABB(),L(et.aabb.lowerBound.x,et.aabb.lowerBound.y,et.aabb.lowerBound.z,et.aabb.upperBound.x,et.aabb.upperBound.y,et.aabb.upperBound.z,et)}}for(P=0;P!==B;P++){var $=M[P];if(1<$){var tt=I[P];for(X=0;X!==$;X++){var et=tt[X];for(q=0;q!==X;q++){var it=tt[q];this.needBroadphaseCollision(et,it)&&this.intersectionTest(et,it,e,i)}}}}this.makePairsUnique(e,i)}},{"../math/Vec3":32,"../shapes/Shape":45,"./Broadphase":5}],7:[function(t,e){e.exports=n;var i=t("./Broadphase"),r=t("./AABB");function n(){i.apply(this)}((n.prototype=new i).constructor=n).prototype.collisionPairs=function(t,e,i){var r,n,s,a,o=t.bodies,h=o.length;for(r=0;r!==h;r++)for(n=0;n!==r;n++)s=o[r],a=o[n],this.needBroadphaseCollision(s,a)&&this.intersectionTest(s,a,e,i)},new r,n.prototype.aabbQuery=function(t,e,i){i=i||[];for(var r=0;r<t.bodies.length;r++){var n=t.bodies[r];n.aabbNeedsUpdate&&n.computeAABB(),n.aabb.overlaps(e)&&i.push(n)}return i}},{"./AABB":3,"./Broadphase":5}],8:[function(t,e){function i(){this.matrix={}}(e.exports=i).prototype.get=function(t,e){if((t=t.id)<(e=e.id)){var i=e;e=t,t=i}return t+"-"+e in this.matrix},i.prototype.set=function(t,e,i){if((t=t.id)<(e=e.id)){var r=e;e=t,t=r}i?this.matrix[t+"-"+e]=!0:delete this.matrix[t+"-"+e]},i.prototype.reset=function(){this.matrix={}},i.prototype.setNumObjects=function(){}},{}],9:[function(t,e){function i(){this.current=[],this.previous=[]}function r(t,e){t.push((4294901760&e)>>16,65535&e)}(e.exports=i).prototype.getKey=function(t,e){if(e<t){var i=e;e=t,t=i}return t<<16|e},i.prototype.set=function(t,e){for(var i=this.getKey(t,e),r=this.current,n=0;i>r[n];)n++;if(i!==r[n]){for(e=r.length-1;n<=e;e--)r[e+1]=r[e];r[n]=i}},i.prototype.tick=function(){var t=this.current;this.current=this.previous,this.previous=t,this.current.length=0},i.prototype.getDiff=function(t,e){for(var i=this.current,n=this.previous,s=i.length,a=n.length,o=0,h=0;h<s;h++){for(var l=i[h];l>n[o];)o++;l===n[o]||r(t,l)}for(h=o=0;h<a;h++){for(var u=n[h];u>i[o];)o++;i[o]===u||r(e,u)}}},{}],10:[function(t,e){e.exports=h;var i=t("../math/Vec3"),r=t("../math/Quaternion"),n=t("../math/Transform"),s=(t("../shapes/ConvexPolyhedron"),t("../shapes/Box"),t("../collision/RaycastResult")),a=t("../shapes/Shape"),o=t("../collision/AABB");function h(t,e){this.from=t?t.clone():new i,this.to=e?e.clone():new i,this._direction=new i,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=h.ANY,this.result=new s,this.hasHit=!1,this.callback=function(){}}(h.prototype.constructor=h).CLOSEST=1,h.ANY=2,h.ALL=4;var l=new o,u=[];h.prototype.intersectWorld=function(t,e){return this.mode=e.mode||h.ANY,this.result=e.result||new s,this.skipBackfaces=!!e.skipBackfaces,this.checkCollisionResponse=!!e.checkCollisionResponse,this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:-1,e.from&&this.from.copy(e.from),e.to&&this.to.copy(e.to),this.callback=e.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(l),u.length=0,t.broadphase.aabbQuery(t,l,u),this.intersectBodies(u),this.hasHit};var c=new i,_=new i;function d(t,e,i,r){r.vsub(e,F),i.vsub(e,c),t.vsub(e,_);var n,s,a=F.dot(F),o=F.dot(c),h=F.dot(_),l=c.dot(c),u=c.dot(_);return 0<=(n=l*h-o*u)&&0<=(s=a*u-o*h)&&n+s<a*l-o*o}h.pointInTriangle=d;var p=new i,f=new r;h.prototype.intersectBody=function(t,e){e&&(this.result=e,this._updateDirection());var i=this.checkCollisionResponse;if((!i||t.collisionResponse)&&0!=(this.collisionFilterGroup&t.collisionFilterMask)&&0!=(t.collisionFilterGroup&this.collisionFilterMask))for(var r=p,n=f,s=0,a=t.shapes.length;s<a;s++){var o=t.shapes[s];if((!i||o.collisionResponse)&&(t.quaternion.mult(t.shapeOrientations[s],n),t.quaternion.vmult(t.shapeOffsets[s],r),r.vadd(t.position,r),this.intersectShape(o,n,r,t),this.result._shouldStop))break}},h.prototype.intersectBodies=function(t,e){e&&(this.result=e,this._updateDirection());for(var i=0,r=t.length;!this.result._shouldStop&&i<r;i++)this.intersectBody(t[i])},h.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},h.prototype.intersectShape=function(t,e,i,r){if(!(function(t,e,i){i.vsub(t,F);var r=F.dot(e);return e.mult(r,D),D.vadd(t,D),i.distanceTo(D)}(this.from,this._direction,i)>t.boundingSphereRadius)){var n=this[t.type];n&&n.call(this,t,e,i,r,t)}},new i,new i;var m=new i,g=new i,v=new i,y=new i;new i,new s,h.prototype.intersectBox=function(t,e,i,r,n){return this.intersectConvex(t.convexPolyhedronRepresentation,e,i,r,n)},h.prototype[a.types.BOX]=h.prototype.intersectBox,h.prototype.intersectPlane=function(t,e,r,n,s){var a=this.from,o=this.to,h=this._direction,l=new i(0,0,1);e.vmult(l,l);var u=new i;a.vsub(r,u);var c=u.dot(l);if(o.vsub(r,u),!(0<c*u.dot(l)||a.distanceTo(o)<c)){var _=l.dot(h);if(!(Math.abs(_)<this.precision)){var d=new i,p=new i,f=new i;a.vsub(r,d);var m=-l.dot(d)/_;h.scale(m,p),a.vadd(p,f),this.reportIntersection(l,f,s,n,-1)}}},h.prototype[a.types.PLANE]=h.prototype.intersectPlane,h.prototype.getAABB=function(t){var e=this.to,i=this.from;t.lowerBound.x=Math.min(e.x,i.x),t.lowerBound.y=Math.min(e.y,i.y),t.lowerBound.z=Math.min(e.z,i.z),t.upperBound.x=Math.max(e.x,i.x),t.upperBound.y=Math.max(e.y,i.y),t.upperBound.z=Math.max(e.z,i.z)};var T={faceList:[0]},E=new i,S=new h,b=[];h.prototype.intersectHeightfield=function(t,e,i,r,s){t.data,t.elementSize;var a=S;a.from.copy(this.from),a.to.copy(this.to),n.pointToLocalFrame(i,e,a.from,a.from),n.pointToLocalFrame(i,e,a.to,a.to),a._updateDirection();var h,l,u,c,_=b;h=l=0,u=c=t.data.length-1;var d=new o;a.getAABB(d),t.getIndexOfPosition(d.lowerBound.x,d.lowerBound.y,_,!0),h=Math.max(h,_[0]),l=Math.max(l,_[1]),t.getIndexOfPosition(d.upperBound.x,d.upperBound.y,_,!0),u=Math.min(u,_[0]+1),c=Math.min(c,_[1]+1);for(var p=h;p<u;p++)for(var f=l;f<c;f++){if(this.result._shouldStop)return;if(t.getAabbAtIndex(p,f,d),d.overlapsRay(a)){if(t.getConvexTrianglePillar(p,f,!1),n.pointToWorldFrame(i,e,t.pillarOffset,E),this.intersectConvex(t.pillarConvex,e,E,r,s,T),this.result._shouldStop)return;t.getConvexTrianglePillar(p,f,!0),n.pointToWorldFrame(i,e,t.pillarOffset,E),this.intersectConvex(t.pillarConvex,e,E,r,s,T)}}},h.prototype[a.types.HEIGHTFIELD]=h.prototype.intersectHeightfield;var A=new i,C=new i;h.prototype.intersectSphere=function(t,e,i,r,n){var s=this.from,a=this.to,o=t.radius,h=Math.pow(a.x-s.x,2)+Math.pow(a.y-s.y,2)+Math.pow(a.z-s.z,2),l=2*((a.x-s.x)*(s.x-i.x)+(a.y-s.y)*(s.y-i.y)+(a.z-s.z)*(s.z-i.z)),u=Math.pow(s.x-i.x,2)+Math.pow(s.y-i.y,2)+Math.pow(s.z-i.z,2)-Math.pow(o,2),c=Math.pow(l,2)-4*h*u,_=A,d=C;if(!(c<0))if(0==c)s.lerp(a,c,_),_.vsub(i,d),d.normalize(),this.reportIntersection(d,_,n,r,-1);else{var p=(-l-Math.sqrt(c))/(2*h),f=(-l+Math.sqrt(c))/(2*h);if(0<=p&&p<=1&&(s.lerp(a,p,_),_.vsub(i,d),d.normalize(),this.reportIntersection(d,_,n,r,-1)),this.result._shouldStop)return;0<=f&&f<=1&&(s.lerp(a,f,_),_.vsub(i,d),d.normalize(),this.reportIntersection(d,_,n,r,-1))}},h.prototype[a.types.SPHERE]=h.prototype.intersectSphere;var w=new i,R=(new i,new i,new i);h.prototype.intersectConvex=function(t,e,i,r,n,s){for(var a=w,o=R,h=s&&s.faceList||null,l=t.faces,u=t.vertices,c=t.faceNormals,_=this._direction,p=this.from,f=this.to,T=p.distanceTo(f),E=h?h.length:l.length,S=this.result,b=0;!S._shouldStop&&b<E;b++){var A=h?h[b]:b,C=l[A],x=c[A],O=e,I=i;o.copy(u[C[0]]),O.vmult(o,o),o.vadd(I,o),o.vsub(p,o),O.vmult(x,a);var M=_.dot(a);if(!(Math.abs(M)<this.precision)){var B=a.dot(o)/M;if(!(B<0)){_.mult(B,m),m.vadd(p,m),g.copy(u[C[0]]),O.vmult(g,g),I.vadd(g,g);for(var P=1;!S._shouldStop&&P<C.length-1;P++){v.copy(u[C[P]]),y.copy(u[C[P+1]]),O.vmult(v,v),O.vmult(y,y),I.vadd(v,v),I.vadd(y,y);var N=m.distanceTo(p);!d(m,g,v,y)&&!d(m,v,g,y)||T<N||this.reportIntersection(a,m,n,r,A)}}}}},h.prototype[a.types.CONVEXPOLYHEDRON]=h.prototype.intersectConvex;var x=new i,O=new i,I=new i,M=new i,B=new i,P=new i,N=(new o,[]),L=new n;h.prototype.intersectTrimesh=function(t,e,i,r,s,a){var o=x,h=N,l=L,u=R,c=O,_=I,p=M,f=P,T=B,E=(a&&a.faceList,t.indices),S=(t.vertices,t.faceNormals,this.from),b=this.to,A=this._direction;l.position.copy(i),l.quaternion.copy(e),n.vectorToLocalFrame(i,e,A,c),n.pointToLocalFrame(i,e,S,_),n.pointToLocalFrame(i,e,b,p),p.x*=t.scale.x,p.y*=t.scale.y,p.z*=t.scale.z,_.x*=t.scale.x,_.y*=t.scale.y,_.z*=t.scale.z,p.vsub(_,c),c.normalize();var C=_.distanceSquared(p);t.tree.rayQuery(this,l,h);for(var w=0,F=h.length;!this.result._shouldStop&&w!==F;w++){var D=h[w];t.getNormal(D,o),t.getVertex(E[3*D],g),g.vsub(_,u);var U=c.dot(o),k=o.dot(u)/U;if(!(k<0)){c.scale(k,m),m.vadd(_,m),t.getVertex(E[3*D+1],v),t.getVertex(E[3*D+2],y);var z=m.distanceSquared(_);!d(m,v,g,y)&&!d(m,g,v,y)||C<z||(n.vectorToWorldFrame(e,o,T),n.pointToWorldFrame(i,e,m,f),this.reportIntersection(T,f,s,r,D))}}h.length=0},h.prototype[a.types.TRIMESH]=h.prototype.intersectTrimesh,h.prototype.reportIntersection=function(t,e,i,r,n){var s=this.from,a=this.to,o=s.distanceTo(e),l=this.result;if(!(this.skipBackfaces&&0<t.dot(this._direction)))switch(l.hitFaceIndex=void 0!==n?n:-1,this.mode){case h.ALL:this.hasHit=!0,l.set(s,a,t,e,i,r,o),l.hasHit=!0,this.callback(l);break;case h.CLOSEST:(o<l.distance||!l.hasHit)&&(this.hasHit=!0,l.hasHit=!0,l.set(s,a,t,e,i,r,o));break;case h.ANY:this.hasHit=!0,l.hasHit=!0,l.set(s,a,t,e,i,r,o),l._shouldStop=!0}};var F=new i,D=new i},{"../collision/AABB":3,"../collision/RaycastResult":11,"../math/Quaternion":30,"../math/Transform":31,"../math/Vec3":32,"../shapes/Box":39,"../shapes/ConvexPolyhedron":40,"../shapes/Shape":45}],11:[function(t,e){var i=t("../math/Vec3");function r(){this.rayFromWorld=new i,this.rayToWorld=new i,this.hitNormalWorld=new i,this.hitPointWorld=new i,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}(e.exports=r).prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},r.prototype.abort=function(){this._shouldStop=!0},r.prototype.set=function(t,e,i,r,n,s,a){this.rayFromWorld.copy(t),this.rayToWorld.copy(e),this.hitNormalWorld.copy(i),this.hitPointWorld.copy(r),this.shape=n,this.body=s,this.distance=a}},{"../math/Vec3":32}],12:[function(t,e){t("../shapes/Shape");var i=t("../collision/Broadphase");function r(t){i.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var e=this.axisList;this._addBodyHandler=function(t){e.push(t.body)},this._removeBodyHandler=function(t){var i=e.indexOf(t.body);-1!==i&&e.splice(i,1)},t&&this.setWorld(t)}((e.exports=r).prototype=new i).setWorld=function(t){for(var e=this.axisList.length=0;e<t.bodies.length;e++)this.axisList.push(t.bodies[e]);t.removeEventListener("addBody",this._addBodyHandler),t.removeEventListener("removeBody",this._removeBodyHandler),t.addEventListener("addBody",this._addBodyHandler),t.addEventListener("removeBody",this._removeBodyHandler),this.world=t,this.dirty=!0},r.insertionSortX=function(t){for(var e=1,i=t.length;e<i;e++){for(var r=t[e],n=e-1;0<=n&&!(t[n].aabb.lowerBound.x<=r.aabb.lowerBound.x);n--)t[n+1]=t[n];t[n+1]=r}return t},r.insertionSortY=function(t){for(var e=1,i=t.length;e<i;e++){for(var r=t[e],n=e-1;0<=n&&!(t[n].aabb.lowerBound.y<=r.aabb.lowerBound.y);n--)t[n+1]=t[n];t[n+1]=r}return t},r.insertionSortZ=function(t){for(var e=1,i=t.length;e<i;e++){for(var r=t[e],n=e-1;0<=n&&!(t[n].aabb.lowerBound.z<=r.aabb.lowerBound.z);n--)t[n+1]=t[n];t[n+1]=r}return t},r.prototype.collisionPairs=function(t,e,i){var n,s,a=this.axisList,o=a.length,h=this.axisIndex;for(this.dirty&&(this.sortList(),this.dirty=!1),n=0;n!==o;n++){var l=a[n];for(s=n+1;s<o;s++){var u=a[s];if(this.needBroadphaseCollision(l,u)){if(!r.checkBounds(l,u,h))break;this.intersectionTest(l,u,e,i)}}}},r.prototype.sortList=function(){for(var t=this.axisList,e=this.axisIndex,i=t.length,n=0;n!==i;n++){var s=t[n];s.aabbNeedsUpdate&&s.computeAABB()}0===e?r.insertionSortX(t):1===e?r.insertionSortY(t):2===e&&r.insertionSortZ(t)},r.checkBounds=function(t,e,i){var r,n;0===i?(r=t.position.x,n=e.position.x):1===i?(r=t.position.y,n=e.position.y):2===i&&(r=t.position.z,n=e.position.z);var s=t.boundingRadius;return n-e.boundingRadius<r+s},r.prototype.autoDetectAxis=function(){for(var t=0,e=0,i=0,r=0,n=0,s=0,a=this.axisList,o=a.length,h=1/o,l=0;l!==o;l++){var u=a[l],c=u.position.x;t+=c,e+=c*c;var _=u.position.y;i+=_,r+=_*_;var d=u.position.z;n+=d,s+=d*d}var p=e-t*t*h,f=r-i*i*h,m=s-n*n*h;this.axisIndex=f<p?m<p?0:2:m<f?1:2},r.prototype.aabbQuery=function(t,e,i){i=i||[],this.dirty&&(this.sortList(),this.dirty=!1);var r=this.axisIndex,n="x";1===r&&(n="y"),2===r&&(n="z");for(var s=this.axisList,a=(e.lowerBound[n],e.upperBound[n],0);a<s.length;a++){var o=s[a];o.aabbNeedsUpdate&&o.computeAABB(),o.aabb.overlaps(e)&&i.push(o)}return i}},{"../collision/Broadphase":5,"../shapes/Shape":45}],13:[function(t,e){e.exports=a,t("./Constraint");var i=t("./PointToPointConstraint"),r=t("../equations/ConeEquation"),n=t("../equations/RotationalEquation"),s=(t("../equations/ContactEquation"),t("../math/Vec3"));function a(t,e,a){var o=void 0!==(a=a||{}).maxForce?a.maxForce:1e6,h=a.pivotA?a.pivotA.clone():new s,l=a.pivotB?a.pivotB.clone():new s;this.axisA=a.axisA?a.axisA.clone():new s,this.axisB=a.axisB?a.axisB.clone():new s,i.call(this,t,h,e,l,o),this.collideConnected=!!a.collideConnected,this.angle=void 0!==a.angle?a.angle:0;var u=this.coneEquation=new r(t,e,a),c=this.twistEquation=new n(t,e,a);this.twistAngle=void 0!==a.twistAngle?a.twistAngle:0,u.maxForce=0,u.minForce=-o,c.maxForce=0,c.minForce=-o,this.equations.push(u,c)}a.prototype=new i,a.constructor=a,new s,new s,a.prototype.update=function(){var t=this.bodyA,e=this.bodyB,r=this.coneEquation,n=this.twistEquation;i.prototype.update.call(this),t.vectorToWorldFrame(this.axisA,r.axisA),e.vectorToWorldFrame(this.axisB,r.axisB),this.axisA.tangents(n.axisA,n.axisA),t.vectorToWorldFrame(n.axisA,n.axisA),this.axisB.tangents(n.axisB,n.axisB),e.vectorToWorldFrame(n.axisB,n.axisB),r.angle=this.angle,n.maxAngle=this.twistAngle}},{"../equations/ConeEquation":19,"../equations/ContactEquation":20,"../equations/RotationalEquation":23,"../math/Vec3":32,"./Constraint":14,"./PointToPointConstraint":18}],14:[function(t,e){e.exports=r;var i=t("../utils/Utils");function r(t,e,n){n=i.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.id=r.idCounter++,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}r.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},r.prototype.enable=function(){for(var t=this.equations,e=0;e<t.length;e++)t[e].enabled=!0},r.prototype.disable=function(){for(var t=this.equations,e=0;e<t.length;e++)t[e].enabled=!1},r.idCounter=0},{"../utils/Utils":55}],15:[function(t,e){e.exports=n;var i=t("./Constraint"),r=t("../equations/ContactEquation");function n(t,e,n,s){i.call(this,t,e),void 0===n&&(n=t.position.distanceTo(e.position)),void 0===s&&(s=1e6),this.distance=n;var a=this.distanceEquation=new r(t,e);this.equations.push(a),a.minForce=-s,a.maxForce=s}(n.prototype=new i).update=function(){var t=this.bodyA,e=this.bodyB,i=this.distanceEquation,r=.5*this.distance,n=i.ni;e.position.vsub(t.position,n),n.normalize(),n.mult(r,i.ri),n.mult(-r,i.rj)}},{"../equations/ContactEquation":20,"./Constraint":14}],16:[function(t,e){e.exports=a,t("./Constraint");var i=t("./PointToPointConstraint"),r=t("../equations/RotationalEquation"),n=t("../equations/RotationalMotorEquation"),s=(t("../equations/ContactEquation"),t("../math/Vec3"));function a(t,e,a){var o=void 0!==(a=a||{}).maxForce?a.maxForce:1e6,h=a.pivotA?a.pivotA.clone():new s,l=a.pivotB?a.pivotB.clone():new s;i.call(this,t,h,e,l,o),(this.axisA=a.axisA?a.axisA.clone():new s(1,0,0)).normalize(),(this.axisB=a.axisB?a.axisB.clone():new s(1,0,0)).normalize();var u=this.rotationalEquation1=new r(t,e,a),c=this.rotationalEquation2=new r(t,e,a),_=this.motorEquation=new n(t,e,o);_.enabled=!1,this.equations.push(u,c,_)}a.prototype=new i,(a.constructor=a).prototype.enableMotor=function(){this.motorEquation.enabled=!0},a.prototype.disableMotor=function(){this.motorEquation.enabled=!1},a.prototype.setMotorSpeed=function(t){this.motorEquation.targetVelocity=t},a.prototype.setMotorMaxForce=function(t){this.motorEquation.maxForce=t,this.motorEquation.minForce=-t};var o=new s,h=new s;a.prototype.update=function(){var t=this.bodyA,e=this.bodyB,r=this.motorEquation,n=this.rotationalEquation1,s=this.rotationalEquation2,a=o,l=h,u=this.axisA,c=this.axisB;i.prototype.update.call(this),t.quaternion.vmult(u,a),e.quaternion.vmult(c,l),a.tangents(n.axisA,s.axisA),n.axisB.copy(l),s.axisB.copy(l),this.motorEquation.enabled&&(t.quaternion.vmult(this.axisA,r.axisA),e.quaternion.vmult(this.axisB,r.axisB))}},{"../equations/ContactEquation":20,"../equations/RotationalEquation":23,"../equations/RotationalMotorEquation":24,"../math/Vec3":32,"./Constraint":14,"./PointToPointConstraint":18}],17:[function(t,e){e.exports=s,t("./Constraint");var i=t("./PointToPointConstraint"),r=t("../equations/RotationalEquation"),n=(t("../equations/RotationalMotorEquation"),t("../equations/ContactEquation"),t("../math/Vec3"));function s(t,e,s){var a=void 0!==(s=s||{}).maxForce?s.maxForce:1e6,o=new n,h=new n,l=new n;t.position.vadd(e.position,l),l.scale(.5,l),e.pointToLocalFrame(l,h),t.pointToLocalFrame(l,o),i.call(this,t,o,e,h,a),this.xA=t.vectorToLocalFrame(n.UNIT_X),this.xB=e.vectorToLocalFrame(n.UNIT_X),this.yA=t.vectorToLocalFrame(n.UNIT_Y),this.yB=e.vectorToLocalFrame(n.UNIT_Y),this.zA=t.vectorToLocalFrame(n.UNIT_Z),this.zB=e.vectorToLocalFrame(n.UNIT_Z);var u=this.rotationalEquation1=new r(t,e,s),c=this.rotationalEquation2=new r(t,e,s),_=this.rotationalEquation3=new r(t,e,s);this.equations.push(u,c,_)}s.prototype=new i,s.constructor=s,new n,new n,s.prototype.update=function(){var t=this.bodyA,e=this.bodyB,r=(this.motorEquation,this.rotationalEquation1),n=this.rotationalEquation2,s=this.rotationalEquation3;i.prototype.update.call(this),t.vectorToWorldFrame(this.xA,r.axisA),e.vectorToWorldFrame(this.yB,r.axisB),t.vectorToWorldFrame(this.yA,n.axisA),e.vectorToWorldFrame(this.zB,n.axisB),t.vectorToWorldFrame(this.zA,s.axisA),e.vectorToWorldFrame(this.xB,s.axisB)}},{"../equations/ContactEquation":20,"../equations/RotationalEquation":23,"../equations/RotationalMotorEquation":24,"../math/Vec3":32,"./Constraint":14,"./PointToPointConstraint":18}],18:[function(t,e){e.exports=s;var i=t("./Constraint"),r=t("../equations/ContactEquation"),n=t("../math/Vec3");function s(t,e,s,a,o){i.call(this,t,s),o=void 0!==o?o:1e6,this.pivotA=e?e.clone():new n,this.pivotB=a?a.clone():new n;var h=this.equationX=new r(t,s),l=this.equationY=new r(t,s),u=this.equationZ=new r(t,s);this.equations.push(h,l,u),h.minForce=l.minForce=u.minForce=-o,h.maxForce=l.maxForce=u.maxForce=o,h.ni.set(1,0,0),l.ni.set(0,1,0),u.ni.set(0,0,1)}(s.prototype=new i).update=function(){var t=this.bodyA,e=this.bodyB,i=this.equationX,r=this.equationY,n=this.equationZ;t.quaternion.vmult(this.pivotA,i.ri),e.quaternion.vmult(this.pivotB,i.rj),r.ri.copy(i.ri),r.rj.copy(i.rj),n.ri.copy(i.ri),n.rj.copy(i.rj)}},{"../equations/ContactEquation":20,"../math/Vec3":32,"./Constraint":14}],19:[function(t,e){e.exports=s;var i=t("../math/Vec3"),r=(t("../math/Mat3"),t("./Equation")),n=t("../math/CMath");function s(t,e,n){var s=void 0!==(n=n||{}).maxForce?n.maxForce:1e6;r.call(this,t,e,-s,s),this.axisA=n.axisA?n.axisA.clone():new i(1,0,0),this.axisB=n.axisB?n.axisB.clone():new i(0,1,0),this.angle=void 0!==n.angle?n.angle:0}(s.prototype=new r).constructor=s;var a=new i,o=new i;s.prototype.computeB=function(t){var e=this.a,i=this.b,r=this.axisA,s=this.axisB,h=a,l=o,u=this.jacobianElementA,c=this.jacobianElementB;return r.cross(s,h),s.cross(r,l),u.rotational.copy(l),c.rotational.copy(h),-(n.cos(this.angle)-r.dot(s))*e-this.computeGW()*i-t*this.computeGiMf()}},{"../math/CMath":27,"../math/Mat3":29,"../math/Vec3":32,"./Equation":21}],20:[function(t,e){e.exports=n;var i=t("./Equation"),r=t("../math/Vec3");function n(t,e,n){n=void 0!==n?n:1e6,i.call(this,t,e,0,n),this.si=null,this.sj=null,this.restitution=0,this.ri=new r,this.rj=new r,this.ni=new r}t("../math/Mat3"),(n.prototype=new i).constructor=n;var s=new r,a=new r,o=new r;n.prototype.computeB=function(t){var e=this.a,i=this.b,r=this.bi,n=this.bj,h=this.ri,l=this.rj,u=s,c=a,_=r.velocity,d=r.angularVelocity,p=(r.force,r.torque,n.velocity),f=n.angularVelocity,m=(n.force,n.torque,o),g=this.jacobianElementA,v=this.jacobianElementB,y=this.ni;h.cross(y,u),l.cross(y,c),y.negate(g.spatial),u.negate(g.rotational),v.spatial.copy(y),v.rotational.copy(c),m.copy(n.position),m.vadd(l,m),m.vsub(r.position,m),m.vsub(h,m);var T=y.dot(m),E=this.restitution+1;return-T*e-(E*p.dot(y)-E*_.dot(y)+f.dot(c)-d.dot(u))*i-t*this.computeGiMf()};var h=new r,l=new r,u=new r,c=new r,_=new r;n.prototype.getImpactVelocityAlongNormal=function(){var t=h,e=l,i=u,r=c,n=_;return this.bi.position.vadd(this.ri,i),this.bj.position.vadd(this.rj,r),this.bi.getVelocityAtWorldPoint(i,t),this.bj.getVelocityAtWorldPoint(r,e),t.vsub(e,n),this.ni.dot(n)}},{"../math/Mat3":29,"../math/Vec3":32,"./Equation":21}],21:[function(t,e){e.exports=n;var i=t("../math/JacobianElement"),r=t("../math/Vec3");function n(t,e,r,s){this.id=n.id++,this.minForce=void 0===r?-1e6:r,this.maxForce=void 0===s?1e6:s,this.bi=t,this.bj=e,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new i,this.jacobianElementB=new i,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}(n.prototype.constructor=n).id=0,n.prototype.setSpookParams=function(t,e,i){var r=e,n=t,s=i;this.a=4/(s*(1+4*r)),this.b=4*r/(1+4*r),this.eps=4/(s*s*n*(1+4*r))},n.prototype.computeB=function(t,e,i){var r=this.computeGW();return-this.computeGq()*t-r*e-this.computeGiMf()*i},n.prototype.computeGq=function(){var t=this.jacobianElementA,e=this.jacobianElementB,i=this.bi,r=this.bj,n=i.position,s=r.position;return t.spatial.dot(n)+e.spatial.dot(s)},new r,n.prototype.computeGW=function(){var t=this.jacobianElementA,e=this.jacobianElementB,i=this.bi,r=this.bj,n=i.velocity,s=r.velocity,a=i.angularVelocity,o=r.angularVelocity;return t.multiplyVectors(n,a)+e.multiplyVectors(s,o)},n.prototype.computeGWlambda=function(){var t=this.jacobianElementA,e=this.jacobianElementB,i=this.bi,r=this.bj,n=i.vlambda,s=r.vlambda,a=i.wlambda,o=r.wlambda;return t.multiplyVectors(n,a)+e.multiplyVectors(s,o)};var s=new r,a=new r,o=new r,h=new r;n.prototype.computeGiMf=function(){var t=this.jacobianElementA,e=this.jacobianElementB,i=this.bi,r=this.bj,n=i.force,l=i.torque,u=r.force,c=r.torque,_=i.invMassSolve,d=r.invMassSolve;return n.scale(_,s),u.scale(d,a),i.invInertiaWorldSolve.vmult(l,o),r.invInertiaWorldSolve.vmult(c,h),t.multiplyVectors(s,o)+e.multiplyVectors(a,h)};var l=new r;n.prototype.computeGiMGt=function(){var t=this.jacobianElementA,e=this.jacobianElementB,i=this.bi,r=this.bj,n=i.invMassSolve,s=r.invMassSolve,a=i.invInertiaWorldSolve,o=r.invInertiaWorldSolve,h=n+s;return a.vmult(t.rotational,l),h+=l.dot(t.rotational),o.vmult(e.rotational,l),h+l.dot(e.rotational)};var u=new r;new r,new r,new r,new r,new r,n.prototype.addToWlambda=function(t){var e=this.jacobianElementA,i=this.jacobianElementB,r=this.bi,n=this.bj,s=u;r.vlambda.addScaledVector(r.invMassSolve*t,e.spatial,r.vlambda),n.vlambda.addScaledVector(n.invMassSolve*t,i.spatial,n.vlambda),r.invInertiaWorldSolve.vmult(e.rotational,s),r.wlambda.addScaledVector(t,s,r.wlambda),n.invInertiaWorldSolve.vmult(i.rotational,s),n.wlambda.addScaledVector(t,s,n.wlambda)},n.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":28,"../math/Vec3":32}],22:[function(t,e){e.exports=n;var i=t("./Equation"),r=t("../math/Vec3");function n(t,e,n){i.call(this,t,e,-n,n),this.ri=new r,this.rj=new r,this.t=new r}t("../math/Mat3"),(n.prototype=new i).constructor=n;var s=new r,a=new r;n.prototype.computeB=function(t){this.a;var e=this.b,i=(this.bi,this.bj,this.ri),r=this.rj,n=s,o=a,h=this.t;i.cross(h,n),r.cross(h,o);var l=this.jacobianElementA,u=this.jacobianElementB;return h.negate(l.spatial),n.negate(l.rotational),u.spatial.copy(h),u.rotational.copy(o),-this.computeGW()*e-t*this.computeGiMf()}},{"../math/Mat3":29,"../math/Vec3":32,"./Equation":21}],23:[function(t,e){e.exports=s;var i=t("../math/Vec3"),r=(t("../math/Mat3"),t("./Equation")),n=t("../math/CMath");function s(t,e,n){var s=void 0!==(n=n||{}).maxForce?n.maxForce:1e6;r.call(this,t,e,-s,s),this.axisA=n.axisA?n.axisA.clone():new i(1,0,0),this.axisB=n.axisB?n.axisB.clone():new i(0,1,0),this.maxAngle=Math.PI/2}(s.prototype=new r).constructor=s;var a=new i,o=new i;s.prototype.computeB=function(t){var e=this.a,i=this.b,r=this.axisA,s=this.axisB,h=a,l=o,u=this.jacobianElementA,c=this.jacobianElementB;return r.cross(s,h),s.cross(r,l),u.rotational.copy(l),c.rotational.copy(h),-(n.cos(this.maxAngle)-r.dot(s))*e-this.computeGW()*i-t*this.computeGiMf()}},{"../math/CMath":27,"../math/Mat3":29,"../math/Vec3":32,"./Equation":21}],24:[function(t,e){e.exports=n;var i=t("../math/Vec3"),r=(t("../math/Mat3"),t("./Equation"));function n(t,e,n){n=void 0!==n?n:1e6,r.call(this,t,e,-n,n),this.axisA=new i,this.axisB=new i,this.targetVelocity=0}((n.prototype=new r).constructor=n).prototype.computeB=function(t){this.a;var e=this.b,i=(this.bi,this.bj,this.axisA),r=this.axisB,n=this.jacobianElementA,s=this.jacobianElementB;return n.rotational.copy(i),r.negate(s.rotational),-(this.computeGW()-this.targetVelocity)*e-t*this.computeGiMf()}},{"../math/Mat3":29,"../math/Vec3":32,"./Equation":21}],25:[function(t,e){var i=t("../utils/Utils");(e.exports=function t(e,r,n){n=i.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=t.idCounter++,this.materials=[e,r],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}).idCounter=0},{"../utils/Utils":55}],26:[function(t,e){(e.exports=function t(e){var i="";"string"==typeof(e=e||{})?(i=e,e={}):"object"==typeof e&&(i=""),this.name=i,this.id=t.idCounter++,this.friction=void 0!==e.friction?e.friction:-1,this.restitution=void 0!==e.restitution?e.restitution:-1}).idCounter=0},{}],27:[function(t,e){var i=180/Math.PI;function r(t){return t*i}var n={};function s(t){if(n.digit!=t){for(var e=1/Math.pow(10,t),r=0;r<=90;r+=e)n[r.toFixed(t)]=Math.sin(r/i);n.digit=t}}function a(t,e){return t<=90?n[t.toFixed(e)]:t<=180?n[(t=180-t).toFixed(e)]:t<=270?-n[(t-=180).toFixed(e)]:-n[(t=360-t).toFixed(e)]}function o(t){var e=r(t)%360;return e<0&&(e+=360),a(e,c._digit)}function h(t){var e=(r(t)+90)%360;return e<0&&(e+=360),a(e,c._digit)}function l(t){return Math.sin(t).toFixed(c.digit)}function u(t){return Math.cos(t).toFixed(c.digit)}var c={sin:Math.sin,cos:Math.cos,atan2:Math.atan2};c._sin=o,c._cos=h,c._sinArr=n,c._sin360=a,c._sinNative=l,c._cosNative=u,c._radian2angle=r,c._calculateSinByDigit=s,c._digit=1,Object.defineProperty(c,"digit",{get:function(){return this._digit},set:function(t){this._digit=t,1==this._mode&&s(t)}}),c._mode=0,Object.defineProperty(c,"mode",{get:function(){return this._mode},set:function(t){this._mode!=t&&(0==(this._mode=t)?(c.sin=Math.sin,c.cos=Math.cos):1==t?(c.digit=c._digit,c.sin=o,c.cos=h):2==t&&(c.sin=l,c.cos=u))}}),e.exports=c},{}],28:[function(t,e){e.exports=r;var i=t("./Vec3");function r(){this.spatial=new i,this.rotational=new i}r.prototype.multiplyElement=function(t){return t.spatial.dot(this.spatial)+t.rotational.dot(this.rotational)},r.prototype.multiplyVectors=function(t,e){return t.dot(this.spatial)+e.dot(this.rotational)}},{"./Vec3":32}],29:[function(t,e){e.exports=r;var i=t("./Vec3");function r(t){this.elements=t||[0,0,0,0,0,0,0,0,0]}r.prototype.identity=function(){var t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1},r.prototype.setZero=function(){var t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0},r.prototype.setTrace=function(t){var e=this.elements;e[0]=t.x,e[4]=t.y,e[8]=t.z},r.prototype.getTrace=function(t){t=t||new i;var e=this.elements;t.x=e[0],t.y=e[4],t.z=e[8]},r.prototype.vmult=function(t,e){e=e||new i;var r=this.elements,n=t.x,s=t.y,a=t.z;return e.x=r[0]*n+r[1]*s+r[2]*a,e.y=r[3]*n+r[4]*s+r[5]*a,e.z=r[6]*n+r[7]*s+r[8]*a,e},r.prototype.smult=function(t){for(var e=0;e<this.elements.length;e++)this.elements[e]*=t},r.prototype.mmult=function(t,e){for(var i=e||new r,n=0;n<3;n++)for(var s=0;s<3;s++){for(var a=0,o=0;o<3;o++)a+=t.elements[n+3*o]*this.elements[o+3*s];i.elements[n+3*s]=a}return i},r.prototype.scale=function(t,e){e=e||new r;for(var i=this.elements,n=e.elements,s=0;3!==s;s++)n[3*s+0]=t.x*i[3*s+0],n[3*s+1]=t.y*i[3*s+1],n[3*s+2]=t.z*i[3*s+2];return e},r.prototype.solve=function(t,e){e=e||new i;for(var r,n=[],s=0;s<12;s++)n.push(0);for(s=0;s<3;s++)for(r=0;r<3;r++)n[s+4*r]=this.elements[s+3*r];n[3]=t.x,n[7]=t.y,n[11]=t.z;var a,o,h=3,l=h;do{if(0===n[(s=l-h)+4*s])for(r=s+1;r<l;r++)if(0!==n[s+4*r]){for(a=4;n[(o=4-a)+4*s]+=n[o+4*r],--a;);break}if(0!==n[s+4*s])for(r=s+1;r<l;r++){var u=n[s+4*r]/n[s+4*s];for(a=4;n[(o=4-a)+4*r]=o<=s?0:n[o+4*r]-n[o+4*s]*u,--a;);}}while(--h);if(e.z=n[11]/n[10],e.y=(n[7]-n[6]*e.z)/n[5],e.x=(n[3]-n[2]*e.z-n[1]*e.y)/n[0],isNaN(e.x)||isNaN(e.y)||isNaN(e.z)||e.x===1/0||e.y===1/0||e.z===1/0)throw"Could not solve equation! Got x=["+e.toString()+"], b=["+t.toString()+"], A=["+this.toString()+"]";return e},r.prototype.e=function(t,e,i){if(void 0===i)return this.elements[e+3*t];this.elements[e+3*t]=i},r.prototype.copy=function(t){for(var e=0;e<t.elements.length;e++)this.elements[e]=t.elements[e];return this},r.prototype.toString=function(){for(var t="",e=0;e<9;e++)t+=this.elements[e]+",";return t},r.prototype.reverse=function(t){t=t||new r;for(var e,i=[],n=0;n<18;n++)i.push(0);for(n=0;n<3;n++)for(e=0;e<3;e++)i[n+6*e]=this.elements[n+3*e];i[3]=1,i[9]=0,i[15]=0,i[4]=0,i[10]=1,i[16]=0,i[5]=0,i[11]=0,i[17]=1;var s,a,o=3,h=o;do{if(0===i[(n=h-o)+6*n])for(e=n+1;e<h;e++)if(0!==i[n+6*e]){for(s=6;i[(a=6-s)+6*n]+=i[a+6*e],--s;);break}if(0!==i[n+6*n])for(e=n+1;e<h;e++){var l=i[n+6*e]/i[n+6*n];for(s=6;i[(a=6-s)+6*e]=a<=n?0:i[a+6*e]-i[a+6*n]*l,--s;);}}while(--o);n=2;do{e=n-1;do{for(l=i[n+6*e]/i[n+6*n],s=6;i[(a=6-s)+6*e]=i[a+6*e]-i[a+6*n]*l,--s;);}while(e--)}while(--n);n=2;do{for(l=1/i[n+6*n],s=6;i[(a=6-s)+6*n]=i[a+6*n]*l,--s;);}while(n--);n=2;do{e=2;do{if(a=i[3+e+6*n],isNaN(a)||a===1/0)throw"Could not reverse! A=["+this.toString()+"]";t.e(n,e,a)}while(e--)}while(n--);return t},r.prototype.setRotationFromQuaternion=function(t){var e=t.x,i=t.y,r=t.z,n=t.w,s=e+e,a=i+i,o=r+r,h=e*s,l=e*a,u=e*o,c=i*a,_=i*o,d=r*o,p=n*s,f=n*a,m=n*o,g=this.elements;return g[0]=1-(c+d),g[1]=l-m,g[2]=u+f,g[3]=l+m,g[4]=1-(h+d),g[5]=_-p,g[6]=u-f,g[7]=_+p,g[8]=1-(h+c),this},r.prototype.transpose=function(t){for(var e=(t=t||new r).elements,i=this.elements,n=0;3!==n;n++)for(var s=0;3!==s;s++)e[3*n+s]=i[3*s+n];return t}},{"./Vec3":32}],30:[function(t,e){e.exports=n;var i=t("./Vec3"),r=t("./CMath");function n(t,e,i,r){this.x=void 0!==t?t:0,this.y=void 0!==e?e:0,this.z=void 0!==i?i:0,this.w=void 0!==r?r:1}n.prototype.set=function(t,e,i,r){return this.x=t,this.y=e,this.z=i,this.w=r,this},n.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},n.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},n.prototype.setFromAxisAngle=function(t,e){var i=r.sin(.5*e);return this.x=t.x*i,this.y=t.y*i,this.z=t.z*i,this.w=r.cos(.5*e),this},n.prototype.toAxisAngle=function(t){t=t||new i,this.normalize();var e=2*Math.acos(this.w),r=Math.sqrt(1-this.w*this.w);return r<.001?(t.x=this.x,t.y=this.y,t.z=this.z):(t.x=this.x/r,t.y=this.y/r,t.z=this.z/r),[t,e]};var s=new i,a=new i;n.prototype.setFromVectors=function(t,e){if(t.isAntiparallelTo(e)){var i=s,r=a;t.tangents(i,r),this.setFromAxisAngle(i,Math.PI)}else{var n=t.cross(e);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(Math.pow(t.norm(),2)*Math.pow(e.norm(),2))+t.dot(e),this.normalize()}return this},new i,new i,new i,n.prototype.mult=function(t,e){e=e||new n;var i=this.x,r=this.y,s=this.z,a=this.w,o=t.x,h=t.y,l=t.z,u=t.w;return e.x=i*u+a*o+r*l-s*h,e.y=r*u+a*h+s*o-i*l,e.z=s*u+a*l+i*h-r*o,e.w=a*u-i*o-r*h-s*l,e},n.prototype.inverse=function(t){var e=this.x,i=this.y,r=this.z,s=this.w;t=t||new n,this.conjugate(t);var a=1/(e*e+i*i+r*r+s*s);return t.x*=a,t.y*=a,t.z*=a,t.w*=a,t},n.prototype.conjugate=function(t){return(t=t||new n).x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t},n.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this},n.prototype.normalizeFast=function(){var t=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0==t?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t,this.y*=t,this.z*=t,this.w*=t),this},n.prototype.vmult=function(t,e){e=e||new i;var r=t.x,n=t.y,s=t.z,a=this.x,o=this.y,h=this.z,l=this.w,u=l*r+o*s-h*n,c=l*n+h*r-a*s,_=l*s+a*n-o*r,d=-a*r-o*n-h*s;return e.x=u*l+d*-a+c*-h-_*-o,e.y=c*l+d*-o+_*-a-u*-h,e.z=_*l+d*-h+u*-o-c*-a,e},n.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},n.prototype.toEuler=function(t,e){var i,n,s;e=e||"YZX";var a=this.x,o=this.y,h=this.z,l=this.w;switch(e){case"YZX":var u=a*o+h*l;if(.499<u&&(i=2*r.atan2(a,l),n=Math.PI/2,s=0),u<-.499&&(i=-2*r.atan2(a,l),n=-Math.PI/2,s=0),isNaN(i)){var c=a*a,_=o*o,d=h*h;i=r.atan2(2*o*l-2*a*h,1-2*_-2*d),n=Math.asin(2*u),s=r.atan2(2*a*l-2*o*h,1-2*c-2*d)}break;default:throw new Error("Euler order "+e+" not supported yet.")}t.y=i,t.z=n,t.x=s},n.prototype.setFromEuler=function(t,e,i,n){n=n||"XYZ";var s=r.cos(t/2),a=r.cos(e/2),o=r.cos(i/2),h=r.sin(t/2),l=r.sin(e/2),u=r.sin(i/2);return"XYZ"===n?(this.x=h*a*o+s*l*u,this.y=s*l*o-h*a*u,this.z=s*a*u+h*l*o,this.w=s*a*o-h*l*u):"YXZ"===n?(this.x=h*a*o+s*l*u,this.y=s*l*o-h*a*u,this.z=s*a*u-h*l*o,this.w=s*a*o+h*l*u):"ZXY"===n?(this.x=h*a*o-s*l*u,this.y=s*l*o+h*a*u,this.z=s*a*u+h*l*o,this.w=s*a*o-h*l*u):"ZYX"===n?(this.x=h*a*o-s*l*u,this.y=s*l*o+h*a*u,this.z=s*a*u-h*l*o,this.w=s*a*o+h*l*u):"YZX"===n?(this.x=h*a*o+s*l*u,this.y=s*l*o+h*a*u,this.z=s*a*u-h*l*o,this.w=s*a*o-h*l*u):"XZY"===n&&(this.x=h*a*o-s*l*u,this.y=s*l*o-h*a*u,this.z=s*a*u+h*l*o,this.w=s*a*o+h*l*u),this},n.prototype.clone=function(){return new n(this.x,this.y,this.z,this.w)},n.prototype.slerp=function(t,e,i){i=i||new n;var s,a,o,h,l,u=this.x,c=this.y,_=this.z,d=this.w,p=t.x,f=t.y,m=t.z,g=t.w;return(a=u*p+c*f+_*m+d*g)<0&&(a=-a,p=-p,f=-f,m=-m,g=-g),l=1e-6<1-a?(s=Math.acos(a),o=r.sin(s),h=r.sin((1-e)*s)/o,r.sin(e*s)/o):(h=1-e,e),i.x=h*u+l*p,i.y=h*c+l*f,i.z=h*_+l*m,i.w=h*d+l*g,i},n.prototype.integrate=function(t,e,i,r){r=r||new n;var s=t.x*i.x,a=t.y*i.y,o=t.z*i.z,h=this.x,l=this.y,u=this.z,c=this.w,_=.5*e;return r.x+=_*(s*c+a*u-o*l),r.y+=_*(a*c+o*h-s*u),r.z+=_*(o*c+s*l-a*h),r.w+=_*(-s*h-a*l-o*u),r}},{"./CMath":27,"./Vec3":32}],31:[function(t,e){var i=t("./Vec3"),r=t("./Quaternion");function n(t){t=t||{},this.position=new i,t.position&&this.position.copy(t.position),this.quaternion=new r,t.quaternion&&this.quaternion.copy(t.quaternion)}e.exports=n;var s=new r;n.pointToLocalFrame=function(t,e,r,n){return n=n||new i,r.vsub(t,n),e.conjugate(s),s.vmult(n,n),n},n.prototype.pointToLocal=function(t,e){return n.pointToLocalFrame(this.position,this.quaternion,t,e)},n.pointToWorldFrame=function(t,e,r,n){return n=n||new i,e.vmult(r,n),n.vadd(t,n),n},n.prototype.pointToWorld=function(t,e){return n.pointToWorldFrame(this.position,this.quaternion,t,e)},n.prototype.vectorToWorldFrame=function(t,e){return e=e||new i,this.quaternion.vmult(t,e),e},n.vectorToWorldFrame=function(t,e,i){return t.vmult(e,i),i},n.vectorToLocalFrame=function(t,e,r,n){return n=n||new i,e.w*=-1,e.vmult(r,n),e.w*=-1,n}},{"./Quaternion":30,"./Vec3":32}],32:[function(t,e){e.exports=r;var i=t("./Mat3");function r(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0}r.ZERO=new r(0,0,0),r.UNIT_X=new r(1,0,0),r.UNIT_Y=new r(0,1,0),r.UNIT_Z=new r(0,0,1),r.prototype.cross=function(t,e){var i=t.x,n=t.y,s=t.z,a=this.x,o=this.y,h=this.z;return(e=e||new r).x=o*s-h*n,e.y=h*i-a*s,e.z=a*n-o*i,e},r.prototype.set=function(t,e,i){return this.x=t,this.y=e,this.z=i,this},r.prototype.setZero=function(){this.x=this.y=this.z=0},r.prototype.vadd=function(t,e){if(!e)return new r(this.x+t.x,this.y+t.y,this.z+t.z);e.x=t.x+this.x,e.y=t.y+this.y,e.z=t.z+this.z},r.prototype.vsub=function(t,e){if(!e)return new r(this.x-t.x,this.y-t.y,this.z-t.z);e.x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z},r.prototype.crossmat=function(){return new i([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},r.prototype.normalize=function(){var t=this.x,e=this.y,i=this.z,r=Math.sqrt(t*t+e*e+i*i);if(0<r){var n=1/r;this.x*=n,this.y*=n,this.z*=n}else this.x=0,this.y=0,this.z=0;return r},r.prototype.unit=function(t){t=t||new r;var e=this.x,i=this.y,n=this.z,s=Math.sqrt(e*e+i*i+n*n);return 0<s?(s=1/s,t.x=e*s,t.y=i*s,t.z=n*s):(t.x=1,t.y=0,t.z=0),t},r.prototype.length=r.prototype.norm=function(){var t=this.x,e=this.y,i=this.z;return Math.sqrt(t*t+e*e+i*i)},r.prototype.lengthSquared=r.prototype.norm2=function(){return this.dot(this)},r.prototype.distanceTo=function(t){var e=this.x,i=this.y,r=this.z,n=t.x,s=t.y,a=t.z;return Math.sqrt((n-e)*(n-e)+(s-i)*(s-i)+(a-r)*(a-r))},r.prototype.distanceSquared=function(t){var e=this.x,i=this.y,r=this.z,n=t.x,s=t.y,a=t.z;return(n-e)*(n-e)+(s-i)*(s-i)+(a-r)*(a-r)},r.prototype.mult=function(t,e){e=e||new r;var i=this.x,n=this.y,s=this.z;return e.x=t*i,e.y=t*n,e.z=t*s,e},r.prototype.vmul=function(t,e){return(e=e||new r).x=t.x*this.x,e.y=t.y*this.y,e.z=t.z*this.z,e},r.prototype.scale=r.prototype.mult,r.prototype.addScaledVector=function(t,e,i){return(i=i||new r).x=this.x+t*e.x,i.y=this.y+t*e.y,i.z=this.z+t*e.z,i},r.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},r.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},r.prototype.negate=function(t){return(t=t||new r).x=-this.x,t.y=-this.y,t.z=-this.z,t};var n=new r,s=new r;r.prototype.tangents=function(t,e){var i=this.norm();if(0<i){var r=n,a=1/i;r.set(this.x*a,this.y*a,this.z*a);var o=s;Math.abs(r.x)<.9?o.set(1,0,0):o.set(0,1,0),r.cross(o,t),r.cross(t,e)}else t.set(1,0,0),e.set(0,1,0)},r.prototype.toString=function(){return this.x+","+this.y+","+this.z},r.prototype.toArray=function(){return[this.x,this.y,this.z]},r.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},r.prototype.lerp=function(t,e,i){var r=this.x,n=this.y,s=this.z;i.x=r+(t.x-r)*e,i.y=n+(t.y-n)*e,i.z=s+(t.z-s)*e},r.prototype.almostEquals=function(t,e){return void 0===e&&(e=1e-6),!(Math.abs(this.x-t.x)>e||Math.abs(this.y-t.y)>e||Math.abs(this.z-t.z)>e)},r.prototype.almostZero=function(t){return void 0===t&&(t=1e-6),!(Math.abs(this.x)>t||Math.abs(this.y)>t||Math.abs(this.z)>t)};var a=new r;r.prototype.isAntiparallelTo=function(t,e){return this.negate(a),a.almostEquals(t,e)},r.prototype.clone=function(){return new r(this.x,this.y,this.z)}},{"./Mat3":29}],33:[function(t,e){e.exports=l;var i=t("../utils/EventTarget"),r=(t("../shapes/Shape"),t("../math/Vec3")),n=t("../math/Mat3"),s=t("../math/Quaternion"),a=(t("../material/Material"),t("../collision/AABB")),o=t("../shapes/Box"),h=t("../world/World");function l(t){t=t||{},i.apply(this),this.id=l.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new r,this.collisionFilterGroup="number"==typeof t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionResponse=!0,this.position=new r,this.previousPosition=new r,this.interpolatedPosition=new r,this.initPosition=new r,t.position&&(this.position.copy(t.position),this.previousPosition.copy(t.position),this.interpolatedPosition.copy(t.position),this.initPosition.copy(t.position)),this.velocity=new r,t.velocity&&this.velocity.copy(t.velocity),this.initVelocity=new r,this.force=new r;var e="number"==typeof t.mass?t.mass:0;this.mass=e,this.invMass=0<e?1/e:0,this.material=t.material||null,this.linearDamping="number"==typeof t.linearDamping?t.linearDamping:.01,this.type=e<=0?l.STATIC:l.DYNAMIC,typeof t.type==typeof l.STATIC&&(this.type=t.type),this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.sleepState=0,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new r,this.quaternion=new s,this.initQuaternion=new s,this.previousQuaternion=new s,this.interpolatedQuaternion=new s,t.quaternion&&(this.quaternion.copy(t.quaternion),this.initQuaternion.copy(t.quaternion),this.previousQuaternion.copy(t.quaternion),this.interpolatedQuaternion.copy(t.quaternion)),this.angularVelocity=new r,t.angularVelocity&&this.angularVelocity.copy(t.angularVelocity),this.initAngularVelocity=new r,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new r,this.invInertia=new r,this.invInertiaWorld=new n,this.invMassSolve=0,this.invInertiaSolve=new r,this.invInertiaWorldSolve=new n,this.fixedRotation=void 0!==t.fixedRotation&&t.fixedRotation,this.useGravity=!0,this.angularDamping=void 0!==t.angularDamping?t.angularDamping:.01,this.linearFactor=new r(1,1,1),t.linearFactor&&this.linearFactor.copy(t.linearFactor),this.angularFactor=new r(1,1,1),t.angularFactor&&this.angularFactor.copy(t.angularFactor),this.aabb=new a,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new r,t.shape&&this.addShape(t.shape),this.hasTrigger=!0,this.updateMassProperties()}((l.prototype=new i).constructor=l).COLLIDE_EVENT_NAME="collide",l.DYNAMIC=1,l.STATIC=2,l.KINEMATIC=4,l.AWAKE=0,l.SLEEPY=1,l.SLEEPING=2,l.idCounter=0,l.wakeupEvent={type:"wakeup"},l.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=0,this._wakeUpAfterNarrowphase=!1,t===l.SLEEPING&&this.dispatchEvent(l.wakeupEvent)},l.prototype.sleep=function(){this.sleepState=l.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this._wakeUpAfterNarrowphase=!1},l.sleepyEvent={type:"sleepy"},l.sleepEvent={type:"sleep"},l.prototype.sleepTick=function(t){if(this.allowSleep){var e=this.sleepState,i=this.velocity.norm2()+this.angularVelocity.norm2(),r=Math.pow(this.sleepSpeedLimit,2);e===l.AWAKE&&i<r?(this.sleepState=l.SLEEPY,this.timeLastSleepy=t,this.dispatchEvent(l.sleepyEvent)):e===l.SLEEPY&&r<i?this.wakeUp():e===l.SLEEPY&&t-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(l.sleepEvent))}},l.prototype.updateSolveMassProperties=function(){this.sleepState===l.SLEEPING||this.type===l.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},l.prototype.pointToLocalFrame=function(t,e){return e=e||new r,t.vsub(this.position,e),this.quaternion.conjugate().vmult(e,e),e},l.prototype.vectorToLocalFrame=function(t,e){return e=e||new r,this.quaternion.conjugate().vmult(t,e),e},l.prototype.pointToWorldFrame=function(t,e){return e=e||new r,this.quaternion.vmult(t,e),e.vadd(this.position,e),e},l.prototype.vectorToWorldFrame=function(t,e){return e=e||new r,this.quaternion.vmult(t,e),e};var u=new r,c=new s;l.prototype.addShape=function(t,e,i){var n=new r,a=new s;return e&&n.copy(e),i&&a.copy(i),this.shapes.push(t),this.shapeOffsets.push(n),this.shapeOrientations.push(a),this.aabbNeedsUpdate=!0,this.updateMassProperties(),this.updateBoundingRadius(),this.updateHasTrigger(),(h.idToShapeMap[t.id]=t).body=this},l.prototype.removeShape=function(t){var e=this.shapes.indexOf(t);-1!==e&&(this.shapes.splice(e,1),this.shapeOffsets.splice(e,1),this.shapeOrientations.splice(e,1),this.aabbNeedsUpdate=!0,this.updateMassProperties(),this.updateBoundingRadius(),this.updateHasTrigger())},l.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=this.shapeOffsets,i=t.length,r=0,n=0;n!==i;n++){var s=t[n];s.updateBoundingSphereRadius();var a=e[n].norm(),o=s.boundingSphereRadius;r<a+o&&(r=a+o)}this.boundingRadius=r};var _=new a;l.prototype.computeAABB=function(){for(var t=this.shapes,e=this.shapeOffsets,i=this.shapeOrientations,r=t.length,n=u,s=c,a=this.quaternion,o=this.aabb,h=_,l=0;l!==r;l++){var d=t[l];a.vmult(e[l],n),n.vadd(this.position,n),i[l].mult(a,s),d.calculateWorldAABB(n,s,h.lowerBound,h.upperBound),0===l?o.copy(h):o.extend(h)}this.aabbNeedsUpdate=!1};var d=new n,p=new n;new n,l.prototype.updateInertiaWorld=function(t){var e=this.invInertia;if(e.x!==e.y||e.y!==e.z||t){var i=d,r=p;i.setRotationFromQuaternion(this.quaternion),i.transpose(r),i.scale(e,i),i.mmult(r,this.invInertiaWorld)}},new r;var f=new r;l.prototype.applyForce=function(t,e){if(this.type===l.DYNAMIC){var i=f;e.cross(t,i),this.force.vadd(t,this.force),this.torque.vadd(i,this.torque)}};var m=new r,g=new r;l.prototype.applyLocalForce=function(t,e){if(this.type===l.DYNAMIC){var i=m,r=g;this.vectorToWorldFrame(t,i),this.vectorToWorldFrame(e,r),this.applyForce(i,r)}},new r;var v=new r,y=new r;l.prototype.applyImpulse=function(t,e){if(this.type===l.DYNAMIC){var i=e,r=v;r.copy(t),r.mult(this.invMass,r),this.velocity.vadd(r,this.velocity);var n=y;i.cross(t,n),this.invInertiaWorld.vmult(n,n),this.angularVelocity.vadd(n,this.angularVelocity)}};var T=new r,E=new r;l.prototype.applyLocalImpulse=function(t,e){if(this.type===l.DYNAMIC){var i=T,r=E;this.vectorToWorldFrame(t,i),this.vectorToWorldFrame(e,r),this.applyImpulse(i,r)}};var S=new r;l.prototype.updateMassProperties=function(){var t=S;this.invMass=0<this.mass?1/this.mass:0;var e=this.inertia,i=this.fixedRotation;this.computeAABB(),t.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),o.calculateInertia(t,this.mass,e),this.invInertia.set(0<e.x&&!i?1/e.x:0,0<e.y&&!i?1/e.y:0,0<e.z&&!i?1/e.z:0),this.updateInertiaWorld(!0)},l.prototype.getVelocityAtWorldPoint=function(t,e){var i=new r;return t.vsub(this.position,i),this.angularVelocity.cross(i,e),this.velocity.vadd(e,e),e},new r,new r,new s,new s,l.prototype.integrate=function(t,e,i){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),(this.type===l.DYNAMIC||this.type===l.KINEMATIC)&&this.sleepState!==l.SLEEPING){var r=this.velocity,n=this.angularVelocity,s=this.position,a=this.force,o=this.torque,h=this.quaternion,u=this.invMass,c=this.invInertiaWorld,_=this.linearFactor,d=u*t;r.x+=a.x*d*_.x,r.y+=a.y*d*_.y,r.z+=a.z*d*_.z;var p=c.elements,f=this.angularFactor,m=o.x*f.x,g=o.y*f.y,v=o.z*f.z;n.x+=t*(p[0]*m+p[1]*g+p[2]*v),n.y+=t*(p[3]*m+p[4]*g+p[5]*v),n.z+=t*(p[6]*m+p[7]*g+p[8]*v),s.x+=r.x*t,s.y+=r.y*t,s.z+=r.z*t,h.integrate(this.angularVelocity,t,this.angularFactor,h),e&&(i?h.normalizeFast():h.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}},l.prototype.isSleeping=function(){return this.sleepState===l.SLEEPING},l.prototype.isSleepy=function(){return this.sleepState===l.SLEEPY},l.prototype.isAwake=function(){return this.sleepState===l.AWAKE},l.prototype.updateHasTrigger=function(){for(var t=this.shapes.length;t--&&(this.hasTrigger=!this.shapes[t].collisionResponse,!this.hasTrigger););}},{"../collision/AABB":3,"../material/Material":26,"../math/Mat3":29,"../math/Quaternion":30,"../math/Vec3":32,"../shapes/Box":39,"../shapes/Shape":45,"../utils/EventTarget":51,"../world/World":58}],34:[function(t,e){t("./Body");var i=t("../math/Vec3"),r=t("../math/Quaternion"),n=(t("../collision/RaycastResult"),t("../collision/Ray")),s=t("../objects/WheelInfo");function a(t){this.chassisBody=t.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==t.indexRightAxis?t.indexRightAxis:1,this.indexForwardAxis=void 0!==t.indexForwardAxis?t.indexForwardAxis:0,this.indexUpAxis=void 0!==t.indexUpAxis?t.indexUpAxis:2}e.exports=a,new i,new i,new i;var o=new i,h=new i,l=new i;new n,a.prototype.addWheel=function(t){var e=new s(t=t||{}),i=this.wheelInfos.length;return this.wheelInfos.push(e),i},a.prototype.setSteeringValue=function(t,e){this.wheelInfos[e].steering=t},new i,a.prototype.applyEngineForce=function(t,e){this.wheelInfos[e].engineForce=t},a.prototype.setBrake=function(t,e){this.wheelInfos[e].brake=t},a.prototype.addToWorld=function(t){this.constraints,t.addBody(this.chassisBody);var e=this;this.preStepCallback=function(){e.updateVehicle(t.dt)},t.addEventListener("preStep",this.preStepCallback),this.world=t},a.prototype.getVehicleAxisWorld=function(t,e){e.set(0===t?1:0,1===t?1:0,2===t?1:0),this.chassisBody.vectorToWorldFrame(e,e)},a.prototype.updateVehicle=function(t){for(var e=this.wheelInfos,r=e.length,n=this.chassisBody,s=0;s<r;s++)this.updateWheelTransform(s);this.currentVehicleSpeedKmHour=3.6*n.velocity.norm();var a=new i;for(this.getVehicleAxisWorld(this.indexForwardAxis,a),a.dot(n.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1),s=0;s<r;s++)this.castRay(e[s]);this.updateSuspension(t);var o=new i,h=new i;for(s=0;s<r;s++){var l=(d=e[s]).suspensionForce;l>d.maxSuspensionForce&&(l=d.maxSuspensionForce),d.raycastResult.hitNormalWorld.scale(l*t,o),d.raycastResult.hitPointWorld.vsub(n.position,h),n.applyImpulse(o,h)}this.updateFriction(t);var u=new i,c=new i,_=new i;for(s=0;s<r;s++){var d=e[s];n.getVelocityAtWorldPoint(d.chassisConnectionPointWorld,_);var p=1;switch(this.indexUpAxis){case 1:p=-1}if(d.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,c);var f=c.dot(d.raycastResult.hitNormalWorld);d.raycastResult.hitNormalWorld.scale(f,u),c.vsub(u,c);var m=c.dot(_);d.deltaRotation=p*m*t/d.radius}!d.sliding&&d.isInContact||0===d.engineForce||!d.useCustomSlidingRotationalSpeed||(d.deltaRotation=(0<d.engineForce?1:-1)*d.customSlidingRotationalSpeed*t),Math.abs(d.brake)>Math.abs(d.engineForce)&&(d.deltaRotation=0),d.rotation+=d.deltaRotation,d.deltaRotation*=.99}},a.prototype.updateSuspension=function(){for(var t=this.chassisBody.mass,e=this.wheelInfos,i=e.length,r=0;r<i;r++){var n=e[r];if(n.isInContact){var s,a=n.suspensionRestLength-n.suspensionLength;s=n.suspensionStiffness*a*n.clippedInvContactDotSuspension;var o=n.suspensionRelativeVelocity;s-=(o<0?n.dampingCompression:n.dampingRelaxation)*o,n.suspensionForce=s*t,n.suspensionForce<0&&(n.suspensionForce=0)}else n.suspensionForce=0}},a.prototype.removeFromWorld=function(t){this.constraints,t.remove(this.chassisBody),t.removeEventListener("preStep",this.preStepCallback),this.world=null};var u=new i,c=new i;a.prototype.castRay=function(t){var e=u,r=c;this.updateWheelTransformWorld(t);var n=this.chassisBody,s=-1,a=t.suspensionRestLength+t.radius;t.directionWorld.scale(a,e);var o=t.chassisConnectionPointWorld;o.vadd(e,r);var h=t.raycastResult;h.reset();var l=n.collisionResponse;n.collisionResponse=!1,this.world.rayTest(o,r,h),n.collisionResponse=l;var _=h.body;if(t.raycastResult.groundObject=0,_){s=h.distance,t.raycastResult.hitNormalWorld=h.hitNormalWorld,t.isInContact=!0;var d=h.distance;t.suspensionLength=d-t.radius;var p=t.suspensionRestLength-t.maxSuspensionTravel,f=t.suspensionRestLength+t.maxSuspensionTravel;t.suspensionLength<p&&(t.suspensionLength=p),t.suspensionLength>f&&(t.suspensionLength=f,t.raycastResult.reset());var m=t.raycastResult.hitNormalWorld.dot(t.directionWorld),g=new i;n.getVelocityAtWorldPoint(t.raycastResult.hitPointWorld,g);var v=t.raycastResult.hitNormalWorld.dot(g);if(-.1<=m)t.suspensionRelativeVelocity=0,t.clippedInvContactDotSuspension=10;else{var y=-1/m;t.suspensionRelativeVelocity=v*y,t.clippedInvContactDotSuspension=y}}else t.suspensionLength=t.suspensionRestLength+0*t.maxSuspensionTravel,t.suspensionRelativeVelocity=0,t.directionWorld.scale(-1,t.raycastResult.hitNormalWorld),t.clippedInvContactDotSuspension=1;return s},a.prototype.updateWheelTransformWorld=function(t){t.isInContact=!1;var e=this.chassisBody;e.pointToWorldFrame(t.chassisConnectionPointLocal,t.chassisConnectionPointWorld),e.vectorToWorldFrame(t.directionLocal,t.directionWorld),e.vectorToWorldFrame(t.axleLocal,t.axleWorld)},a.prototype.updateWheelTransform=function(t){var e=o,i=h,n=l,s=this.wheelInfos[t];this.updateWheelTransformWorld(s),s.directionLocal.scale(-1,e),i.copy(s.axleLocal),e.cross(i,n),n.normalize(),i.normalize();var a=s.steering,u=new r;u.setFromAxisAngle(e,a);var c=new r;c.setFromAxisAngle(i,s.rotation);var _=s.worldTransform.quaternion;this.chassisBody.quaternion.mult(u,_),_.mult(c,_),_.normalize();var d=s.worldTransform.position;d.copy(s.directionWorld),d.scale(s.suspensionLength,d),d.vadd(s.chassisConnectionPointWorld,d)};var _=[new i(1,0,0),new i(0,1,0),new i(0,0,1)];a.prototype.getWheelTransformWorld=function(t){return this.wheelInfos[t].worldTransform};var d=new i,p=[],f=[];a.prototype.updateFriction=function(t){for(var e=d,r=this.wheelInfos,n=r.length,s=this.chassisBody,a=f,o=p,h=0;h<n;h++)m=(w=r[h]).raycastResult.body,w.sideImpulse=0,w.forwardImpulse=0,a[h]||(a[h]=new i),o[h]||(o[h]=new i);for(h=0;h<n;h++)if(m=(w=r[h]).raycastResult.body){var l=o[h];this.getWheelTransformWorld(h).vectorToWorldFrame(_[this.indexRightAxis],l);var u=w.raycastResult.hitNormalWorld,c=l.dot(u);u.scale(c,e),l.vsub(e,l),l.normalize(),u.cross(l,a[h]),a[h].normalize(),w.sideImpulse=x(s,w.raycastResult.hitPointWorld,m,w.raycastResult.hitPointWorld,l),w.sideImpulse*=1}for(this.sliding=!1,h=0;h<n;h++){var m=(w=r[h]).raycastResult.body,g=0;if(w.slipInfo=1,m){var v=w.brake?w.brake:0;g=y(s,m,w.raycastResult.hitPointWorld,a[h],v);var T=v/(g+=w.engineForce*t);w.slipInfo*=T}if(w.forwardImpulse=0,w.skidInfo=1,m){w.skidInfo=1;var E=w.suspensionForce*t*w.frictionSlip,S=E*E;w.forwardImpulse=g;var b=.5*w.forwardImpulse,A=1*w.sideImpulse,C=b*b+A*A;w.sliding=!1,S<C&&(this.sliding=!0,w.sliding=!0,T=E/Math.sqrt(C),w.skidInfo*=T)}}if(this.sliding)for(h=0;h<n;h++)0!==(w=r[h]).sideImpulse&&w.skidInfo<1&&(w.forwardImpulse*=w.skidInfo,w.sideImpulse*=w.skidInfo);for(h=0;h<n;h++){var w=r[h],R=new i;if(w.raycastResult.hitPointWorld.vsub(s.position,R),0!==w.forwardImpulse){var O=new i;a[h].scale(w.forwardImpulse,O),s.applyImpulse(O,R)}if(0!==w.sideImpulse){m=w.raycastResult.body;var I=new i;w.raycastResult.hitPointWorld.vsub(m.position,I);var M=new i;o[h].scale(w.sideImpulse,M),s.vectorToLocalFrame(R,R),R["xyz"[this.indexUpAxis]]*=w.rollInfluence,s.vectorToWorldFrame(R,R),s.applyImpulse(M,R),M.scale(-1,M),m.applyImpulse(M,I)}}};var m=new i,g=new i,v=new i;function y(t,e,i,r,n){var s=0,a=i,o=m,h=g,l=v;return t.getVelocityAtWorldPoint(a,o),e.getVelocityAtWorldPoint(a,h),o.vsub(h,l),n<(s=-r.dot(l)*(1/(A(t,i,r)+A(e,i,r))))&&(s=n),s<-n&&(s=-n),s}var T=new i,E=new i,S=new i,b=new i;function A(t,e,i){var r=T,n=E,s=S,a=b;return e.vsub(t.position,r),r.cross(i,n),t.invInertiaWorld.vmult(n,a),a.cross(r,s),t.invMass+i.dot(s)}var C=new i,w=new i,R=new i;function x(t,e,i,r,n){if(1.1<n.norm2())return 0;var s=C,a=w,o=R;return t.getVelocityAtWorldPoint(e,s),i.getVelocityAtWorldPoint(r,a),s.vsub(a,o),-.2*n.dot(o)*(1/(t.invMass+i.invMass))}},{"../collision/Ray":10,"../collision/RaycastResult":11,"../math/Quaternion":30,"../math/Vec3":32,"../objects/WheelInfo":38,"./Body":33}],35:[function(t,e){var i=t("./Body"),r=t("../shapes/Sphere"),n=t("../shapes/Box"),s=t("../math/Vec3"),a=t("../constraints/HingeConstraint"),o=t("../math/CMath");function h(t){if(this.wheelBodies=[],this.coordinateSystem=void 0===t.coordinateSystem?new s(1,2,3):t.coordinateSystem.clone(),this.chassisBody=t.chassisBody,!this.chassisBody){var e=new n(new s(5,2,.5));this.chassisBody=new i(1,e)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}(e.exports=h).prototype.addWheel=function(t){var e=(t=t||{}).body;e=e||new i(1,new r(1.2)),this.wheelBodies.push(e),this.wheelForces.push(0),new s;var n=void 0!==t.position?t.position.clone():new s,o=new s;this.chassisBody.pointToWorldFrame(n,o),e.position.set(o.x,o.y,o.z);var h=void 0!==t.axis?t.axis.clone():new s(0,1,0);this.wheelAxes.push(h);var l=new a(this.chassisBody,e,{pivotA:n,axisA:h,pivotB:s.ZERO,axisB:h,collideConnected:!1});return this.constraints.push(l),this.wheelBodies.length-1},h.prototype.setSteeringValue=function(t,e){var i=this.wheelAxes[e],r=o.cos(t),n=o.sin(t),s=i.x,a=i.y;this.constraints[e].axisA.set(r*s-n*a,n*s+r*a,0)},h.prototype.setMotorSpeed=function(t,e){var i=this.constraints[e];i.enableMotor(),i.motorTargetVelocity=t},h.prototype.disableMotor=function(t){this.constraints[t].disableMotor()};var l=new s;h.prototype.setWheelForce=function(t,e){this.wheelForces[e]=t},h.prototype.applyWheelForce=function(t,e){var i=this.wheelAxes[e],r=this.wheelBodies[e],n=r.torque;i.scale(t,l),r.vectorToWorldFrame(l,l),n.vadd(l,n)},h.prototype.addToWorld=function(t){for(var e=this.constraints,i=this.wheelBodies.concat([this.chassisBody]),r=0;r<i.length;r++)t.addBody(i[r]);for(r=0;r<e.length;r++)t.addConstraint(e[r]);t.addEventListener("preStep",this._update.bind(this))},h.prototype._update=function(){for(var t=this.wheelForces,e=0;e<t.length;e++)this.applyWheelForce(t[e],e)},h.prototype.removeFromWorld=function(t){for(var e=this.constraints,i=this.wheelBodies.concat([this.chassisBody]),r=0;r<i.length;r++)t.remove(i[r]);for(r=0;r<e.length;r++)t.removeConstraint(e[r])};var u=new s;h.prototype.getWheelSpeed=function(t){var e=this.wheelAxes[t],i=this.wheelBodies[t].angularVelocity;return this.chassisBody.vectorToWorldFrame(e,u),i.dot(u)}},{"../constraints/HingeConstraint":16,"../math/CMath":27,"../math/Vec3":32,"../shapes/Box":39,"../shapes/Sphere":46,"./Body":33}],36:[function(t,e){e.exports=r,t("../shapes/Shape");var i=t("../math/Vec3");function r(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}t("../math/Quaternion"),t("../shapes/Particle"),t("../objects/Body"),t("../material/Material"),r.prototype.add=function(t){this.particles.push(t),this.neighbors.length<this.particles.length&&this.neighbors.push([])},r.prototype.remove=function(t){var e=this.particles.indexOf(t);-1!==e&&(this.particles.splice(e,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var n=new i;r.prototype.getNeighbors=function(t,e){for(var i=this.particles.length,r=t.id,s=this.smoothingRadius*this.smoothingRadius,a=n,o=0;o!==i;o++){var h=this.particles[o];h.position.vsub(t.position,a),r!==h.id&&a.norm2()<s&&e.push(h)}};var s=new i,a=new i,o=new i,h=new i,l=new i,u=new i;r.prototype.update=function(){for(var t=this.particles.length,e=s,i=this.speedOfSound,r=this.eps,n=0;n!==t;n++){var c=this.particles[n];(A=this.neighbors[n]).length=0,this.getNeighbors(c,A),A.push(this.particles[n]);for(var _=A.length,d=0,p=0;p!==_;p++){c.position.vsub(A[p].position,e);var f=e.norm(),m=this.w(f);d+=A[p].mass*m}this.densities[n]=d,this.pressures[n]=i*i*(this.densities[n]-this.density)}var g=a,v=o,y=h,T=l,E=u;for(n=0;n!==t;n++){var S,b,A,C=this.particles[n];for(g.set(0,0,0),v.set(0,0,0),_=(A=this.neighbors[n]).length,p=0;p!==_;p++){var w=A[p];C.position.vsub(w.position,T);var R=T.norm();S=-w.mass*(this.pressures[n]/(this.densities[n]*this.densities[n]+r)+this.pressures[p]/(this.densities[p]*this.densities[p]+r)),this.gradw(T,y),y.mult(S,y),g.vadd(y,g),w.velocity.vsub(C.velocity,E),E.mult(1/(1e-4+this.densities[n]*this.densities[p])*this.viscosity*w.mass,E),b=this.nablaw(R),E.mult(b,E),v.vadd(E,v)}v.mult(C.mass,v),g.mult(C.mass,g),C.force.vadd(v,C.force),C.force.vadd(g,C.force)}},r.prototype.w=function(t){var e=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(e,9))*Math.pow(e*e-t*t,3)},r.prototype.gradw=function(t,e){var i=t.norm(),r=this.smoothingRadius;t.mult(945/(32*Math.PI*Math.pow(r,9))*Math.pow(r*r-i*i,2),e)},r.prototype.nablaw=function(t){var e=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(e,9))*(e*e-t*t)*(7*t*t-3*e*e)}},{"../material/Material":26,"../math/Quaternion":30,"../math/Vec3":32,"../objects/Body":33,"../shapes/Particle":43,"../shapes/Shape":45}],37:[function(t,e){var i=t("../math/Vec3");function r(t,e,r){r=r||{},this.restLength="number"==typeof r.restLength?r.restLength:1,this.stiffness=r.stiffness||100,this.damping=r.damping||1,this.bodyA=t,this.bodyB=e,this.localAnchorA=new i,this.localAnchorB=new i,r.localAnchorA&&this.localAnchorA.copy(r.localAnchorA),r.localAnchorB&&this.localAnchorB.copy(r.localAnchorB),r.worldAnchorA&&this.setWorldAnchorA(r.worldAnchorA),r.worldAnchorB&&this.setWorldAnchorB(r.worldAnchorB)}(e.exports=r).prototype.setWorldAnchorA=function(t){this.bodyA.pointToLocalFrame(t,this.localAnchorA)},r.prototype.setWorldAnchorB=function(t){this.bodyB.pointToLocalFrame(t,this.localAnchorB)},r.prototype.getWorldAnchorA=function(t){this.bodyA.pointToWorldFrame(this.localAnchorA,t)},r.prototype.getWorldAnchorB=function(t){this.bodyB.pointToWorldFrame(this.localAnchorB,t)};var n=new i,s=new i,a=new i,o=new i,h=new i,l=new i,u=new i,c=new i,_=new i,d=new i,p=new i;r.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restLength,r=this.bodyA,f=this.bodyB,m=n,g=s,v=a,y=o,T=p,E=h,S=l,b=u,A=c,C=_,w=d;this.getWorldAnchorA(E),this.getWorldAnchorB(S),E.vsub(r.position,b),S.vsub(f.position,A),S.vsub(E,m);var R=m.norm();g.copy(m),g.normalize(),f.velocity.vsub(r.velocity,v),f.angularVelocity.cross(A,T),v.vadd(T,v),r.angularVelocity.cross(b,T),v.vsub(T,v),g.mult(-t*(R-i)-e*v.dot(g),y),r.force.vsub(y,r.force),f.force.vadd(y,f.force),b.cross(y,C),A.cross(y,w),r.torque.vsub(C,r.torque),f.torque.vadd(w,f.torque)}},{"../math/Vec3":32}],38:[function(t,e){var i=t("../math/Vec3"),r=t("../math/Transform"),n=t("../collision/RaycastResult"),s=t("../utils/Utils");function a(t){t=s.defaults(t,{chassisConnectionPointLocal:new i,chassisConnectionPointWorld:new i,directionLocal:new i,directionWorld:new i,axleLocal:new i,axleWorld:new i,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=t.maxSuspensionTravel,this.customSlidingRotationalSpeed=t.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=t.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=t.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=t.chassisConnectionPointWorld.clone(),this.directionLocal=t.directionLocal.clone(),this.directionWorld=t.directionWorld.clone(),this.axleLocal=t.axleLocal.clone(),this.axleWorld=t.axleWorld.clone(),this.suspensionRestLength=t.suspensionRestLength,this.suspensionMaxLength=t.suspensionMaxLength,this.radius=t.radius,this.suspensionStiffness=t.suspensionStiffness,this.dampingCompression=t.dampingCompression,this.dampingRelaxation=t.dampingRelaxation,this.frictionSlip=t.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=t.rollInfluence,this.maxSuspensionForce=t.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=t.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new n,this.worldTransform=new r,this.isInContact=!1}e.exports=a;var o=new i,h=new i;o=new i,a.prototype.updateWheel=function(t){var e=this.raycastResult;if(this.isInContact){var i=e.hitNormalWorld.dot(e.directionWorld);e.hitPointWorld.vsub(t.position,h),t.getVelocityAtWorldPoint(h,o);var r=e.hitNormalWorld.dot(o);if(-.1<=i)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{var n=-1/i;this.suspensionRelativeVelocity=r*n,this.clippedInvContactDotSuspension=n}}else e.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,e.directionWorld.scale(-1,e.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":11,"../math/Transform":31,"../math/Vec3":32,"../utils/Utils":55}],39:[function(t,e){e.exports=s;var i=t("./Shape"),r=t("../math/Vec3"),n=t("./ConvexPolyhedron");function s(t){i.call(this,{type:i.types.BOX}),this.halfExtents=t,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}((s.prototype=new i).constructor=s).prototype.updateConvexPolyhedronRepresentation=function(){var t=this.halfExtents.x,e=this.halfExtents.y,i=this.halfExtents.z,s=r,a=[new s(-t,-e,-i),new s(t,-e,-i),new s(t,e,-i),new s(-t,e,-i),new s(-t,-e,i),new s(t,-e,i),new s(t,e,i),new s(-t,e,i)],o=(new s(0,0,1),new s(0,1,0),new s(1,0,0),new n(a,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]));(this.convexPolyhedronRepresentation=o).material=this.material},s.prototype.calculateLocalInertia=function(t,e){return e=e||new r,s.calculateInertia(this.halfExtents,t,e),e},s.calculateInertia=function(t,e,i){var r=t;r.isZero()?(i.x=2/12*e,i.y=2/12*e,i.z=2/12*e):(i.x=1/12*e*(4*r.y*r.y+4*r.z*r.z),i.y=1/12*e*(4*r.x*r.x+4*r.z*r.z),i.z=1/12*e*(4*r.y*r.y+4*r.x*r.x))},s.prototype.getSideNormals=function(t,e){var i=t,r=this.halfExtents;if(i[0].set(r.x,0,0),i[1].set(0,r.y,0),i[2].set(0,0,r.z),i[3].set(-r.x,0,0),i[4].set(0,-r.y,0),i[5].set(0,0,-r.z),void 0!==e)for(var n=0;n!==i.length;n++)e.vmult(i[n],i[n]);return i},s.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},s.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var a=new r;new r,s.prototype.forEachWorldCorner=function(t,e,i){for(var r=this.halfExtents,n=[[r.x,r.y,r.z],[-r.x,r.y,r.z],[-r.x,-r.y,r.z],[-r.x,-r.y,-r.z],[r.x,-r.y,-r.z],[r.x,r.y,-r.z],[-r.x,r.y,-r.z],[r.x,-r.y,r.z]],s=0;s<n.length;s++)a.set(n[s][0],n[s][1],n[s][2]),e.vmult(a,a),t.vadd(a,a),i(a.x,a.y,a.z)};var o=[new r,new r,new r,new r,new r,new r,new r,new r];s.prototype.calculateWorldAABB=function(t,e,i,r){var n=this.halfExtents;o[0].set(n.x,n.y,n.z),o[1].set(-n.x,n.y,n.z),o[2].set(-n.x,-n.y,n.z),o[3].set(-n.x,-n.y,-n.z),o[4].set(n.x,-n.y,-n.z),o[5].set(n.x,n.y,-n.z),o[6].set(-n.x,n.y,-n.z),o[7].set(n.x,-n.y,n.z);var s=o[0];e.vmult(s,s),t.vadd(s,s),r.copy(s),i.copy(s);for(var a=1;a<8;a++){s=o[a],e.vmult(s,s),t.vadd(s,s);var h=s.x,l=s.y,u=s.z;h>r.x&&(r.x=h),l>r.y&&(r.y=l),u>r.z&&(r.z=u),h<i.x&&(i.x=h),l<i.y&&(i.y=l),u<i.z&&(i.z=u)}}},{"../math/Vec3":32,"./ConvexPolyhedron":40,"./Shape":45}],40:[function(t,e){e.exports=s;var i=t("./Shape"),r=t("../math/Vec3"),n=(t("../math/Quaternion"),t("../math/Transform"));function s(t,e,r){i.call(this,{type:i.types.CONVEXPOLYHEDRON}),this.vertices=t||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=e||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=r?r.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}(s.prototype=new i).constructor=s;var a=new r;s.prototype.computeEdges=function(){var t=this.faces,e=this.vertices,i=(e.length,this.uniqueEdges);i.length=0;for(var r=a,n=0;n!==t.length;n++)for(var s=t[n],o=s.length,h=0;h!==o;h++){var l=(h+1)%o;e[s[h]].vsub(e[s[l]],r),r.normalize();for(var u=!1,c=0;c!==i.length;c++)if(i[c].almostEquals(r)||i[c].almostEquals(r)){u=!0;break}u||i.push(r.clone())}},s.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var t=0;t<this.faces.length;t++){for(var e=0;e<this.faces[t].length;e++)if(!this.vertices[this.faces[t][e]])throw new Error("Vertex "+this.faces[t][e]+" not found!");var i=this.faceNormals[t]||new r;this.getFaceNormal(t,i),i.negate(i),this.faceNormals[t]=i;var n=this.vertices[this.faces[t][0]];if(i.dot(n)<0)for(console.error(".faceNormals["+t+"] = Vec3("+i.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule."),e=0;e<this.faces[t].length;e++)console.warn(".vertices["+this.faces[t][e]+"] = Vec3("+this.vertices[this.faces[t][e]].toString()+")")}};var o=new r,h=new r;s.computeNormal=function(t,e,i,r){e.vsub(t,h),i.vsub(e,o),o.cross(h,r),r.isZero()||r.normalize()},s.prototype.getFaceNormal=function(t,e){var i=this.faces[t],r=this.vertices[i[0]],n=this.vertices[i[1]],a=this.vertices[i[2]];return s.computeNormal(r,n,a,e)};var l=new r;s.prototype.clipAgainstHull=function(t,e,i,n,s,a,o,h,u){for(var c=l,_=-1,d=-Number.MAX_VALUE,p=0;p<i.faces.length;p++){c.copy(i.faceNormals[p]),s.vmult(c,c);var f=c.dot(a);d<f&&(d=f,_=p)}for(var m=[],g=i.faces[_],v=g.length,y=0;y<v;y++){var T=i.vertices[g[y]],E=new r;E.copy(T),s.vmult(E,E),n.vadd(E,E),m.push(E)}0<=_&&this.clipFaceAgainstHull(a,t,e,m,o,h,u)};var u=new r,c=new r,_=new r,d=new r,p=new r,f=new r;s.prototype.findSeparatingAxis=function(t,e,i,r,n,s,a,o){var h=u,l=c,m=_,g=d,v=p,y=f,T=Number.MAX_VALUE,E=this;if(E.uniqueAxes)for(b=0;b!==E.uniqueAxes.length;b++){if(i.vmult(E.uniqueAxes[b],h),!1===(w=E.testSepAxis(h,t,e,i,r,n)))return!1;w<T&&(T=w,s.copy(h))}else for(var S=a?a.length:E.faces.length,b=0;b<S;b++){var A=a?a[b]:b;if(h.copy(E.faceNormals[A]),i.vmult(h,h),!1===(w=E.testSepAxis(h,t,e,i,r,n)))return!1;w<T&&(T=w,s.copy(h))}if(t.uniqueAxes)for(b=0;b!==t.uniqueAxes.length;b++){if(n.vmult(t.uniqueAxes[b],l),!1===(w=E.testSepAxis(l,t,e,i,r,n)))return!1;w<T&&(T=w,s.copy(l))}else{var C=o?o.length:t.faces.length;for(b=0;b<C;b++){var w;if(A=o?o[b]:b,l.copy(t.faceNormals[A]),n.vmult(l,l),!1===(w=E.testSepAxis(l,t,e,i,r,n)))return!1;w<T&&(T=w,s.copy(l))}}for(var R=0;R!==E.uniqueEdges.length;R++){i.vmult(E.uniqueEdges[R],g);for(var x=0;x!==t.uniqueEdges.length;x++)if(n.vmult(t.uniqueEdges[x],v),g.cross(v,y),!y.almostZero()){y.normalize();var O=E.testSepAxis(y,t,e,i,r,n);if(!1===O)return!1;O<T&&(T=O,s.copy(y))}}return r.vsub(e,m),0<m.dot(s)&&s.negate(s),!0};var m=[],g=[];s.prototype.testSepAxis=function(t,e,i,r,n,a){s.project(this,t,i,r,m),s.project(e,t,n,a,g);var o=m[0],h=m[1],l=g[0],u=g[1];if(o<u||l<h)return!1;var c=o-u,_=l-h;return c<_?c:_};var v=new r,y=new r;s.prototype.calculateLocalInertia=function(t,e){this.computeLocalAABB(v,y);var i=y.x-v.x,r=y.y-v.y,n=y.z-v.z;e.x=1/12*t*(4*r*r+4*n*n),e.y=1/12*t*(4*i*i+4*n*n),e.z=1/12*t*(4*r*r+4*i*i)},s.prototype.getPlaneConstantOfFace=function(t){var e=this.faces[t],i=this.faceNormals[t],r=this.vertices[e[0]];return-i.dot(r)};var T=new r,E=new r,S=new r,b=new r,A=new r,C=new r,w=new r,R=new r;s.prototype.clipFaceAgainstHull=function(t,e,i,r,n,s,a){for(var o=T,h=E,l=S,u=b,c=A,_=C,d=w,p=R,f=this,m=r,g=[],v=-1,y=Number.MAX_VALUE,x=0;x<f.faces.length;x++){o.copy(f.faceNormals[x]),i.vmult(o,o);var O=o.dot(t);O<y&&(y=O,v=x)}if(!(v<0)){var I=f.faces[v];I.connectedFaces=[];for(var M=0;M<f.faces.length;M++)for(var B=0;B<f.faces[M].length;B++)-1!==I.indexOf(f.faces[M][B])&&M!==v&&-1===I.connectedFaces.indexOf(M)&&I.connectedFaces.push(M);m.length;for(var P=I.length,N=0;N<P;N++){var L=f.vertices[I[N]],F=f.vertices[I[(N+1)%P]];L.vsub(F,h),l.copy(h),i.vmult(l,l),e.vadd(l,l),u.copy(this.faceNormals[v]),i.vmult(u,u),e.vadd(u,u),l.cross(u,c),c.negate(c),_.copy(L),i.vmult(_,_),e.vadd(_,_),_.dot(c);var D=I.connectedFaces[N];d.copy(this.faceNormals[D]);var U=this.getPlaneConstantOfFace(D);p.copy(d),i.vmult(p,p);var k=U-p.dot(e);for(this.clipFaceAgainstPlane(m,g,p,k);m.length;)m.shift();for(;g.length;)m.push(g.shift())}for(d.copy(this.faceNormals[v]),U=this.getPlaneConstantOfFace(v),p.copy(d),i.vmult(p,p),k=U-p.dot(e),M=0;M<m.length;M++){var z=p.dot(m[M])+k;if(z<=n&&(z=n),z<=s){var G=m[M];if(z<=0){var H={point:G,normal:p,depth:z};a.push(H)}}}}},s.prototype.clipFaceAgainstPlane=function(t,e,i,n){var s,a,o=t.length;if(o<2)return e;var h=t[t.length-1],l=t[0];s=i.dot(h)+n;for(var u=0;u<o;u++){if(l=t[u],a=i.dot(l)+n,s<0)if(a<0)(c=new r).copy(l),e.push(c);else{var c=new r;h.lerp(l,s/(s-a),c),e.push(c)}else a<0&&(c=new r,h.lerp(l,s/(s-a),c),e.push(c),e.push(l));h=l,s=a}return e},s.prototype.computeWorldVertices=function(t,e){for(var i=this.vertices.length;this.worldVertices.length<i;)this.worldVertices.push(new r);for(var n=this.vertices,s=this.worldVertices,a=0;a!==i;a++)e.vmult(n[a],s[a]),t.vadd(s[a],s[a]);this.worldVerticesNeedsUpdate=!1},new r,s.prototype.computeLocalAABB=function(t,e){var i=this.vertices.length,r=this.vertices;t.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var n=0;n<i;n++){var s=r[n];s.x<t.x?t.x=s.x:s.x>e.x&&(e.x=s.x),s.y<t.y?t.y=s.y:s.y>e.y&&(e.y=s.y),s.z<t.z?t.z=s.z:s.z>e.z&&(e.z=s.z)}},s.prototype.computeWorldFaceNormals=function(t){for(var e=this.faceNormals.length;this.worldFaceNormals.length<e;)this.worldFaceNormals.push(new r);for(var i=this.faceNormals,n=this.worldFaceNormals,s=0;s!==e;s++)t.vmult(i[s],n[s]);this.worldFaceNormalsNeedsUpdate=!1},s.prototype.updateBoundingSphereRadius=function(){for(var t=0,e=this.vertices,i=0,r=e.length;i!==r;i++){var n=e[i].norm2();t<n&&(t=n)}this.boundingSphereRadius=Math.sqrt(t)};var x=new r;s.prototype.calculateWorldAABB=function(t,e,i,r){for(var n,s,a,o,h,l,u=this.vertices.length,c=this.vertices,_=0;_<u;_++)x.copy(c[_]),e.vmult(x,x),t.vadd(x,x),(x.x<n||void 0===n)&&(n=x.x),(x.x>o||void 0===o)&&(o=x.x),(x.y<s||void 0===s)&&(s=x.y),(x.y>h||void 0===h)&&(h=x.y),(x.z<a||void 0===a)&&(a=x.z),(x.z>l||void 0===l)&&(l=x.z);i.set(n,s,a),r.set(o,h,l)},s.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},s.prototype.getAveragePointLocal=function(t){t=t||new r;for(var e=this.vertices.length,i=this.vertices,n=0;n<e;n++)t.vadd(i[n],t);return t.mult(1/e,t),t},s.prototype.transformAllPoints=function(t,e){var i=this.vertices.length,r=this.vertices;if(e){for(var n=0;n<i;n++){var s=r[n];e.vmult(s,s)}for(n=0;n<this.faceNormals.length;n++)s=this.faceNormals[n],e.vmult(s,s)}if(t)for(n=0;n<i;n++)(s=r[n]).vadd(t,s)};var O=new r,I=new r,M=new r;s.prototype.pointIsInside=function(t){var e=this.vertices.length,i=this.vertices,r=this.faces,n=this.faceNormals,s=this.faces.length,a=O;this.getAveragePointLocal(a);for(var o=0;o<s;o++){this.faces[o].length,e=n[o];var h=i[r[o][0]],l=I;t.vsub(h,l);var u=e.dot(l),c=M;a.vsub(h,c);var _=e.dot(c);if(u<0&&0<_||0<u&&_<0)return!1}return-1},new r;var B=new r,P=new r;s.project=function(t,e,i,r,s){var a=t.vertices.length,o=B,h=0,l=0,u=P,c=t.vertices;u.setZero(),n.vectorToLocalFrame(i,r,e,o),n.pointToLocalFrame(i,r,u,u);var _=u.dot(o);l=h=c[0].dot(o);for(var d=1;d<a;d++){var p=c[d].dot(o);h<p&&(h=p),p<l&&(l=p)}if((h-=_)<(l-=_)){var f=l;l=h,h=f}s[0]=h,s[1]=l}},{"../math/Quaternion":30,"../math/Transform":31,"../math/Vec3":32,"./Shape":45}],41:[function(t,e){e.exports=s,t("./Shape");var i=t("../math/Vec3"),r=(t("../math/Quaternion"),t("./ConvexPolyhedron")),n=t("../math/CMath");function s(t,e,s,a,o){if(o){for(var h=a,l=n.cos,u=n.sin,c=s/2,_=[],d=[],p=[0],f=[1],m=[],g=2*Math.PI/h,v=0;v<h;v++)_.push(new i(t*l(g*v),c,t*u(g*v))),_.push(new i(t*l(g*v),-c,t*u(g*v))),v<h-1?(d.push([2*v+2,2*v+3,2*v+1,2*v]),p.push(2*v+2),f.push(2*v+3)):d.push([0,1,2*v+1,2*v]),(h%2==1||v<h/2)&&m.push(new i(l(g*(v+.5)),0,u(g*(v+.5))));d.push(f);var y=[];for(v=0;v<p.length;v++)y.push(p[p.length-v-1]);return d.push(y),m.push(new i(0,1,0)),void r.call(this,_,d,m)}h=a;var T=[],E=(m=[],[]),S=[],b=[];for(l=n.cos,u=n.sin,T.push(new i(e*l(0),e*u(0),.5*-s)),S.push(0),T.push(new i(t*l(0),t*u(0),.5*s)),b.push(1),v=0;v<h;v++){g=2*Math.PI/h*(v+1);var A=2*Math.PI/h*(v+.5);v<h-1?(T.push(new i(e*l(g),e*u(g),.5*-s)),S.push(2*v+2),T.push(new i(t*l(g),t*u(g),.5*s)),b.push(2*v+3),E.push([2*v+2,2*v+3,2*v+1,2*v])):E.push([0,1,2*v+1,2*v]),(h%2==1||v<h/2)&&m.push(new i(l(A),u(A),0))}for(E.push(b),m.push(new i(0,0,1)),y=[],v=0;v<S.length;v++)y.push(S[S.length-v-1]);E.push(y),r.call(this,T,E,m)}s.prototype=new r},{"../math/CMath":27,"../math/Quaternion":30,"../math/Vec3":32,"./ConvexPolyhedron":40,"./Shape":45}],42:[function(t,e){var i=t("./Shape"),r=t("./ConvexPolyhedron"),n=t("../math/Vec3"),s=t("../utils/Utils");function a(t,e){e=s.defaults(e,{maxValue:null,minValue:null,elementSize:1}),this.data=t,this.maxValue=e.maxValue,this.minValue=e.minValue,this.elementSize=e.elementSize,null===e.minValue&&this.updateMinValue(),null===e.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,i.call(this,{type:i.types.HEIGHTFIELD}),this.pillarConvex=new r,this.pillarOffset=new n,this.updateBoundingSphereRadius(),this._cachedPillars={}}((e.exports=a).prototype=new i).update=function(){this._cachedPillars={}},a.prototype.updateMinValue=function(){for(var t=this.data,e=t[0][0],i=0;i!==t.length;i++)for(var r=0;r!==t[i].length;r++){var n=t[i][r];n<e&&(e=n)}this.minValue=e},a.prototype.updateMaxValue=function(){for(var t=this.data,e=t[0][0],i=0;i!==t.length;i++)for(var r=0;r!==t[i].length;r++){var n=t[i][r];e<n&&(e=n)}this.maxValue=e},a.prototype.setHeightValueAtIndex=function(t,e,i){this.data[t][e]=i,this.clearCachedConvexTrianglePillar(t,e,!1),0<t&&(this.clearCachedConvexTrianglePillar(t-1,e,!0),this.clearCachedConvexTrianglePillar(t-1,e,!1)),0<e&&(this.clearCachedConvexTrianglePillar(t,e-1,!0),this.clearCachedConvexTrianglePillar(t,e-1,!1)),0<e&&0<t&&this.clearCachedConvexTrianglePillar(t-1,e-1,!0)},a.prototype.getRectMinMax=function(t,e,i,r,n){n=n||[];for(var s=this.data,a=this.minValue,o=t;o<=i;o++)for(var h=e;h<=r;h++){var l=s[o][h];a<l&&(a=l)}n[0]=this.minValue,n[1]=a},a.prototype.getIndexOfPosition=function(t,e,i,r){var n=this.elementSize,s=this.data,a=Math.floor(t/n),o=Math.floor(e/n);return i[0]=a,i[1]=o,r&&(a<0&&(a=0),o<0&&(o=0),a>=s.length-1&&(a=s.length-1),o>=s[0].length-1&&(o=s[0].length-1)),!(a<0||o<0||a>=s.length-1||o>=s[0].length-1)};var o=[],h=new n,l=new n,u=new n,c=new n;a.prototype.getTriangleAt=function(t,e,i,r,n,s){var a=o;this.getIndexOfPosition(t,e,a,i);var h=a[0],l=a[1],u=this.data;i&&(h=Math.min(u.length-2,Math.max(0,h)),l=Math.min(u[0].length-2,Math.max(0,l)));var c=this.elementSize,_=Math.pow(t/c-h,2)+Math.pow(e/c-l,2),d=Math.pow(t/c-(h+1),2)+Math.pow(e/c-(l+1),2)<_;return this.getTriangle(h,l,d,r,n,s),d};var _=new n,d=new n,p=new n,f=new n,m=new n;a.prototype.getNormalAt=function(t,e,i,r){var n=_,s=d,a=p,o=f,h=m;this.getTriangleAt(t,e,i,n,s,a),s.vsub(n,o),a.vsub(n,h),o.cross(h,r),r.normalize()},a.prototype.getAabbAtIndex=function(t,e,i){var r=this.data,n=this.elementSize;i.lowerBound.set(t*n,e*n,r[t][e]),i.upperBound.set((t+1)*n,(e+1)*n,r[t+1][e+1])},a.prototype.getHeightAt=function(t,e,i){var r=this.data,n=l,s=u,a=c,_=o;this.getIndexOfPosition(t,e,_,i);var d=_[0],p=_[1];i&&(d=Math.min(r.length-2,Math.max(0,d)),p=Math.min(r[0].length-2,Math.max(0,p)));var f,m,g,v,y,T,E,S,b,A=this.getTriangleAt(t,e,i,n,s,a);return f=t,m=e,g=n.x,v=n.y,y=s.x,T=s.y,E=a.x,S=a.y,(b=h).x=((T-S)*(f-E)+(E-y)*(m-S))/((T-S)*(g-E)+(E-y)*(v-S)),b.y=((S-v)*(f-E)+(g-E)*(m-S))/((T-S)*(g-E)+(E-y)*(v-S)),b.z=1-b.x-b.y,A?r[d+1][p+1]*h.x+r[d][p+1]*h.y+r[d+1][p]*h.z:r[d][p]*h.x+r[d+1][p]*h.y+r[d][p+1]*h.z},a.prototype.getCacheConvexTrianglePillarKey=function(t,e,i){return t+"_"+e+"_"+(i?1:0)},a.prototype.getCachedConvexTrianglePillar=function(t,e,i){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,i)]},a.prototype.setCachedConvexTrianglePillar=function(t,e,i,r,n){this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,i)]={convex:r,offset:n}},a.prototype.clearCachedConvexTrianglePillar=function(t,e,i){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,i)]},a.prototype.getTriangle=function(t,e,i,r,n,s){var a=this.data,o=this.elementSize;i?(r.set((t+1)*o,(e+1)*o,a[t+1][e+1]),n.set(t*o,(e+1)*o,a[t][e+1]),s.set((t+1)*o,e*o,a[t+1][e])):(r.set(t*o,e*o,a[t][e]),n.set((t+1)*o,e*o,a[t+1][e]),s.set(t*o,(e+1)*o,a[t][e+1]))},a.prototype.getConvexTrianglePillar=function(t,e,i){var s=this.pillarConvex,a=this.pillarOffset;if(this.cacheEnabled){if(o=this.getCachedConvexTrianglePillar(t,e,i))return this.pillarConvex=o.convex,void(this.pillarOffset=o.offset);s=new r,a=new n,this.pillarConvex=s,this.pillarOffset=a}var o=this.data,h=this.elementSize,l=s.faces;s.vertices.length=6;for(var u=0;u<6;u++)s.vertices[u]||(s.vertices[u]=new n);for(l.length=5,u=0;u<5;u++)l[u]||(l[u]=[]);var c=s.vertices,_=(Math.min(o[t][e],o[t+1][e],o[t][e+1],o[t+1][e+1])-this.minValue)/2+this.minValue;i?(a.set((t+.75)*h,(e+.75)*h,_),c[0].set(.25*h,.25*h,o[t+1][e+1]-_),c[1].set(-.75*h,.25*h,o[t][e+1]-_),c[2].set(.25*h,-.75*h,o[t+1][e]-_),c[3].set(.25*h,.25*h,-_-1),c[4].set(-.75*h,.25*h,-_-1),c[5].set(.25*h,-.75*h,-_-1),l[0][0]=0,l[0][1]=1,l[0][2]=2,l[1][0]=5,l[1][1]=4,l[1][2]=3,l[2][0]=2,l[2][1]=5,l[2][2]=3,l[2][3]=0,l[3][0]=3,l[3][1]=4,l[3][2]=1,l[3][3]=0,l[4][0]=1,l[4][1]=4,l[4][2]=5,l[4][3]=2):(a.set((t+.25)*h,(e+.25)*h,_),c[0].set(-.25*h,-.25*h,o[t][e]-_),c[1].set(.75*h,-.25*h,o[t+1][e]-_),c[2].set(-.25*h,.75*h,o[t][e+1]-_),c[3].set(-.25*h,-.25*h,-_-1),c[4].set(.75*h,-.25*h,-_-1),c[5].set(-.25*h,.75*h,-_-1),l[0][0]=0,l[0][1]=1,l[0][2]=2,l[1][0]=5,l[1][1]=4,l[1][2]=3,l[2][0]=0,l[2][1]=2,l[2][2]=5,l[2][3]=3,l[3][0]=1,l[3][1]=0,l[3][2]=3,l[3][3]=4,l[4][0]=4,l[4][1]=5,l[4][2]=2,l[4][3]=1),s.computeNormals(),s.computeEdges(),s.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(t,e,i,s,a)},a.prototype.calculateLocalInertia=function(t,e){return(e=e||new n).set(0,0,0),e},a.prototype.volume=function(){return Number.MAX_VALUE},a.prototype.calculateWorldAABB=function(t,e,i,r){i.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),r.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},a.prototype.updateBoundingSphereRadius=function(){var t=this.data,e=this.elementSize;this.boundingSphereRadius=new n(t.length*e,t[0].length*e,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()},a.prototype.setHeightsFromImage=function(t,e){var i=document.createElement("canvas");i.width=t.width,i.height=t.height;var r=i.getContext("2d");r.drawImage(t,0,0);var n=r.getImageData(0,0,t.width,t.height),s=this.data;s.length=0,this.elementSize=Math.abs(e.x)/n.width;for(var a=0;a<n.height;a++){for(var o=[],h=0;h<n.width;h++){var l=(n.data[4*(a*n.height+h)]+n.data[4*(a*n.height+h)+1]+n.data[4*(a*n.height+h)+2])/4/255*e.z;e.x<0?o.push(l):o.unshift(l)}e.y<0?s.unshift(o):s.push(o)}this.updateMaxValue(),this.updateMinValue(),this.update()}},{"../math/Vec3":32,"../utils/Utils":55,"./ConvexPolyhedron":40,"./Shape":45}],43:[function(t,e){e.exports=n;var i=t("./Shape"),r=t("../math/Vec3");function n(){i.call(this,{type:i.types.PARTICLE})}((n.prototype=new i).constructor=n).prototype.calculateLocalInertia=function(t,e){return(e=e||new r).set(0,0,0),e},n.prototype.volume=function(){return 0},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},n.prototype.calculateWorldAABB=function(t,e,i,r){i.copy(t),r.copy(t)}},{"../math/Vec3":32,"./Shape":45}],44:[function(t,e){e.exports=n;var i=t("./Shape"),r=t("../math/Vec3");function n(){i.call(this,{type:i.types.PLANE}),this.worldNormal=new r,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}((n.prototype=new i).constructor=n).prototype.computeWorldNormal=function(t){var e=this.worldNormal;e.set(0,0,1),t.vmult(e,e),this.worldNormalNeedsUpdate=!1},n.prototype.calculateLocalInertia=function(t,e){return e||new r},n.prototype.volume=function(){return Number.MAX_VALUE};var s=new r;n.prototype.calculateWorldAABB=function(t,e,i,r){s.set(0,0,1),e.vmult(s,s);var n=Number.MAX_VALUE;i.set(-n,-n,-n),r.set(n,n,n),1===s.x&&(r.x=t.x),1===s.y&&(r.y=t.y),1===s.z&&(r.z=t.z),-1===s.x&&(i.x=t.x),-1===s.y&&(i.y=t.y),-1===s.z&&(i.z=t.z)},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":32,"./Shape":45}],45:[function(t,e){e.exports=r;var i=t("../utils/EventTarget"),r=t("./Shape");function r(t){t=t||{},i.apply(this),this.id=r.idCounter++,this.type=t.type||0,this.boundingSphereRadius=0,this.collisionResponse=!t.collisionResponse||t.collisionResponse,this.collisionFilterGroup=void 0!==t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask=void 0!==t.collisionFilterMask?t.collisionFilterMask:-1,this.material=t.material?t.material:null,this.body=null}t("../math/Vec3"),t("../math/Quaternion"),t("../material/Material"),r.prototype=new i,(r.prototype.constructor=r).prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},r.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},r.prototype.calculateLocalInertia=function(){throw"calculateLocalInertia() not implemented for shape type "+this.type},r.idCounter=0,r.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":26,"../math/Quaternion":30,"../math/Vec3":32,"../utils/EventTarget":51,"./Shape":45}],46:[function(t,e){e.exports=n;var i=t("./Shape"),r=t("../math/Vec3");function n(t){if(i.call(this,{type:i.types.SPHERE}),this.radius=void 0!==t?t:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}((n.prototype=new i).constructor=n).prototype.calculateLocalInertia=function(t,e){e=e||new r;var i=2*t*this.radius*this.radius/5;return e.x=i,e.y=i,e.z=i,e},n.prototype.volume=function(){return 4*Math.PI*this.radius/3},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},n.prototype.calculateWorldAABB=function(t,e,i,r){for(var n=this.radius,s=["x","y","z"],a=0;a<s.length;a++){var o=s[a];i[o]=t[o]-n,r[o]=t[o]+n}}},{"../math/Vec3":32,"./Shape":45}],47:[function(t,e){e.exports=h;var i=t("./Shape"),r=t("../math/Vec3"),n=(t("../math/Quaternion"),t("../math/Transform")),s=t("../collision/AABB"),a=t("../utils/Octree"),o=t("../math/CMath");function h(t,e){i.call(this,{type:i.types.TRIMESH}),this.vertices=new Float32Array(t),this.indices=new Int16Array(e),this.normals=new Float32Array(e.length),this.aabb=new s,this.edges=null,this.scale=new r(1,1,1),this.tree=new a,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}(h.prototype=new i).constructor=h;var l=new r;h.prototype.updateTree=function(){var t=this.tree;t.reset(),t.aabb.copy(this.aabb);var e=this.scale;t.aabb.lowerBound.x*=1/e.x,t.aabb.lowerBound.y*=1/e.y,t.aabb.lowerBound.z*=1/e.z,t.aabb.upperBound.x*=1/e.x,t.aabb.upperBound.y*=1/e.y,t.aabb.upperBound.z*=1/e.z;for(var i=new s,n=new r,a=new r,o=new r,h=[n,a,o],l=0;l<this.indices.length/3;l++){var u=3*l;this._getUnscaledVertex(this.indices[u],n),this._getUnscaledVertex(this.indices[1+u],a),this._getUnscaledVertex(this.indices[2+u],o),i.setFromPoints(h),t.insert(i,l)}t.removeEmptyNodes()};var u=new s;h.prototype.getTrianglesInAABB=function(t,e){u.copy(t);var i=this.scale,r=i.x,n=i.y,s=i.z,a=u.lowerBound,o=u.upperBound;return a.x/=r,a.y/=n,a.z/=s,o.x/=r,o.y/=n,o.z/=s,this.tree.aabbQuery(u,e)},h.prototype.setScale=function(t){var e=this.scale.x===this.scale.y===this.scale.z,i=t.x===t.y===t.z;e&&i||this.updateNormals(),this.scale.copy(t),this.updateAABB(),this.updateBoundingSphereRadius()},h.prototype.updateNormals=function(){for(var t=l,e=this.normals,i=0;i<this.indices.length/3;i++){var r=3*i,n=this.indices[r],s=this.indices[1+r],a=this.indices[2+r];this.getVertex(n,f),this.getVertex(s,m),this.getVertex(a,g),h.computeNormal(m,f,g,t),e[r]=t.x,e[1+r]=t.y,e[2+r]=t.z}},h.prototype.updateEdges=function(){function t(){e[n<s?n+"_"+s:s+"_"+n]=!0}for(var e={},i=0;i<this.indices.length/3;i++){var r=3*i,n=this.indices[r],s=this.indices[1+r];this.indices[2+r],t(),t(),t()}var a=Object.keys(e);for(this.edges=new Int16Array(2*a.length),i=0;i<a.length;i++){var o=a[i].split("_");this.edges[2*i]=parseInt(o[0],10),this.edges[2*i+1]=parseInt(o[1],10)}},h.prototype.getEdgeVertex=function(t,e,i){var r=this.edges[2*t+(e?1:0)];this.getVertex(r,i)};var c=new r,_=new r;h.prototype.getEdgeVector=function(t,e){var i=c,r=_;this.getEdgeVertex(t,0,i),this.getEdgeVertex(t,1,r),r.vsub(i,e)};var d=new r,p=new r;h.computeNormal=function(t,e,i,r){e.vsub(t,p),i.vsub(e,d),d.cross(p,r),r.isZero()||r.normalize()};var f=new r,m=new r,g=new r;h.prototype.getVertex=function(t,e){var i=this.scale;return this._getUnscaledVertex(t,e),e.x*=i.x,e.y*=i.y,e.z*=i.z,e},h.prototype._getUnscaledVertex=function(t,e){var i=3*t,r=this.vertices;return e.set(r[i],r[1+i],r[2+i])},h.prototype.getWorldVertex=function(t,e,i,r){return this.getVertex(t,r),n.pointToWorldFrame(e,i,r,r),r},h.prototype.getTriangleVertices=function(t,e,i,r){var n=3*t;this.getVertex(this.indices[n],e),this.getVertex(this.indices[1+n],i),this.getVertex(this.indices[2+n],r)},h.prototype.getNormal=function(t,e){var i=3*t;return e.set(this.normals[i],this.normals[1+i],this.normals[2+i])};var v=new s;h.prototype.calculateLocalInertia=function(t,e){this.computeLocalAABB(v);var i=v.upperBound.x-v.lowerBound.x,r=v.upperBound.y-v.lowerBound.y,n=v.upperBound.z-v.lowerBound.z;return e.set(1/12*t*(4*r*r+4*n*n),1/12*t*(4*i*i+4*n*n),1/12*t*(4*r*r+4*i*i))};var y=new r;h.prototype.computeLocalAABB=function(t){var e=t.lowerBound,i=t.upperBound,r=this.vertices.length,n=(this.vertices,y);this.getVertex(0,n),e.copy(n),i.copy(n);for(var s=0;s!==r;s++)this.getVertex(s,n),n.x<e.x?e.x=n.x:n.x>i.x&&(i.x=n.x),n.y<e.y?e.y=n.y:n.y>i.y&&(i.y=n.y),n.z<e.z?e.z=n.z:n.z>i.z&&(i.z=n.z)},h.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},h.prototype.updateBoundingSphereRadius=function(){for(var t=0,e=this.vertices,i=new r,n=0,s=e.length/3;n!==s;n++){this.getVertex(n,i);var a=i.norm2();t<a&&(t=a)}this.boundingSphereRadius=Math.sqrt(t)},new r;var T=new n,E=new s;h.prototype.calculateWorldAABB=function(t,e,i,r){var n=T,s=E;n.position=t,n.quaternion=e,this.aabb.toWorldFrame(n,s),i.copy(s.lowerBound),r.copy(s.upperBound)},h.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},h.createTorus=function(t,e,i,r,n){t=t||1,e=e||.5,i=i||8,r=r||6,n=n||2*Math.PI;for(var s=[],a=[],l=0;l<=i;l++)for(var u=0;u<=r;u++){var c=u/r*n,_=l/i*Math.PI*2,d=(t+e*o.cos(_))*o.cos(c),p=(t+e*o.cos(_))*o.sin(c),f=e*o.sin(_);s.push(d,p,f)}for(l=1;l<=i;l++)for(u=1;u<=r;u++){var m=(r+1)*l+u-1,g=(r+1)*(l-1)+u-1,v=(r+1)*(l-1)+u,y=(r+1)*l+u;a.push(m,g,y),a.push(g,v,y)}return new h(s,a)}},{"../collision/AABB":3,"../math/CMath":27,"../math/Quaternion":30,"../math/Transform":31,"../math/Vec3":32,"../utils/Octree":52,"./Shape":45}],48:[function(t,e){e.exports=r,t("../math/Vec3"),t("../math/Quaternion");var i=t("./Solver");function r(){i.call(this),this.iterations=10,this.tolerance=1e-7}r.prototype=new i;var n=[],s=[],a=[];r.prototype.solve=function(t,e){var i,r,o,h,l,u=0,c=this.iterations,_=this.tolerance*this.tolerance,d=this.equations,p=d.length,f=e.bodies,m=f.length,g=t;if(0!==p)for(var v=0;v!==m;v++)f[v].updateSolveMassProperties();var y=s,T=a,E=n;for(y.length=p,T.length=p,E.length=p,v=0;v!==p;v++){var S=d[v];E[v]=0,T[v]=S.computeB(g),y[v]=1/S.computeC()}if(0!==p){for(v=0;v!==m;v++){var b=(w=f[v]).vlambda,A=w.wlambda;b.set(0,0,0),A.set(0,0,0)}for(u=0;u!==c;u++){for(var C=h=0;C!==p;C++)S=d[C],i=T[C],r=y[C],(l=E[C])+(o=r*(i-S.computeGWlambda()-S.eps*l))<S.minForce?o=S.minForce-l:l+o>S.maxForce&&(o=S.maxForce-l),E[C]+=o,h+=0<o?o:-o,S.addToWlambda(o);if(h*h<_)break}for(v=0;v!==m;v++){var w,R=(w=f[v]).velocity,x=w.angularVelocity;w.vlambda.vmul(w.linearFactor,w.vlambda),R.vadd(w.vlambda,R),w.wlambda.vmul(w.angularFactor,w.wlambda),x.vadd(w.wlambda,x)}for(var O=d.length,I=1/g;O--;)d[O].multiplier=E[O]*I}return u}},{"../math/Quaternion":30,"../math/Vec3":32,"./Solver":49}],49:[function(t,e){function i(){this.equations=[]}(e.exports=i).prototype.solve=function(){return 0},i.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},i.prototype.removeEquation=function(t){var e=this.equations,i=e.indexOf(t);-1!==i&&e.splice(i,1)},i.prototype.removeAllEquations=function(){this.equations.length=0}},{}],50:[function(t,e){e.exports=n,t("../math/Vec3"),t("../math/Quaternion");var i=t("./Solver"),r=t("../objects/Body");function n(t){for(i.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=t,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}n.prototype=new i;var s=[],a=[],o={bodies:[]},h=r.STATIC;function l(t){for(var e=t.length,i=0;i!==e;i++){var r=t[i];if(!(r.visited||r.body.type&h))return r}return!1}var u=[];function c(t,e,i,r){for(u.push(t),t.visited=!0,e(t,i,r);u.length;)for(var n,s=u.pop();n=l(s.children);)n.visited=!0,e(n,i,r),u.push(n)}function _(t,e,i){e.push(t.body);for(var r=t.eqs.length,n=0;n!==r;n++){var s=t.eqs[n];-1===i.indexOf(s)&&i.push(s)}}function d(t,e){return e.id-t.id}n.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},n.prototype.solve=function(t,e){for(var i=s,r=this.nodePool,n=e.bodies,h=this.equations,u=h.length,p=n.length,f=this.subsolver;r.length<p;)r.push(this.createNode());i.length=p;for(var m=0;m<p;m++)i[m]=r[m];for(m=0;m!==p;m++){var g=i[m];g.body=n[m],g.children.length=0,g.eqs.length=0,g.visited=!1}for(var v=0;v!==u;v++){var y=h[v],T=(m=n.indexOf(y.bi),n.indexOf(y.bj)),E=i[m],S=i[T];E.children.push(S),E.eqs.push(y),S.children.push(E),S.eqs.push(y)}var b,A=0,C=a;f.tolerance=this.tolerance,f.iterations=this.iterations;for(var w=o;b=l(i);){C.length=0,w.bodies.length=0,c(b,_,w.bodies,C);var R=C.length;for(C=C.sort(d),m=0;m!==R;m++)f.addEquation(C[m]);f.solve(t,w),f.removeAllEquations(),A++}return A}},{"../math/Quaternion":30,"../math/Vec3":32,"../objects/Body":33,"./Solver":49}],51:[function(t,e){function i(){}(e.exports=i).prototype={constructor:i,addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var i=this._listeners;return void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e),this},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)},hasAnyEventListener:function(t){return void 0!==this._listeners&&void 0!==this._listeners[t]},removeEventListener:function(t,e){if(void 0===this._listeners)return this;var i=this._listeners;if(void 0===i[t])return this;var r=i[t].indexOf(e);return-1!==r&&i[t].splice(r,1),this},dispatchEvent:function(t){if(void 0===this._listeners)return this;var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var i=0,r=e.length;i<r;i++)e[i].call(this,t)}return this}}},{}],52:[function(t,e){var i=t("../collision/AABB"),r=t("../math/Vec3");function n(t){t=t||{},this.root=t.root||null,this.aabb=t.aabb?t.aabb.clone():new i,this.data=[],this.children=[]}(e.exports=function(t,e){(e=e||{}).root=null,e.aabb=t,n.call(this,e),this.maxDepth=void 0!==e.maxDepth?e.maxDepth:8}).prototype=new n,n.prototype.reset=function(){this.children.length=this.data.length=0},n.prototype.insert=function(t,e,i){var r=this.data;if(i=i||0,!this.aabb.contains(t))return!1;var n=this.children;if(i<(this.maxDepth||this.root.maxDepth)){var s=!1;n.length||(this.subdivide(),s=!0);for(var a=0;8!==a;a++)if(n[a].insert(t,e,i+1))return!0;s&&(n.length=0)}return r.push(e),!0};var s=new r;n.prototype.subdivide=function(){var t=this.aabb,e=t.lowerBound,a=t.upperBound,o=this.children;o.push(new n({aabb:new i({lowerBound:new r(0,0,0)})}),new n({aabb:new i({lowerBound:new r(1,0,0)})}),new n({aabb:new i({lowerBound:new r(1,1,0)})}),new n({aabb:new i({lowerBound:new r(1,1,1)})}),new n({aabb:new i({lowerBound:new r(0,1,1)})}),new n({aabb:new i({lowerBound:new r(0,0,1)})}),new n({aabb:new i({lowerBound:new r(1,0,1)})}),new n({aabb:new i({lowerBound:new r(0,1,0)})})),a.vsub(e,s),s.scale(.5,s);for(var h=this.root||this,l=0;8!==l;l++){var u=o[l];u.root=h;var c=u.aabb.lowerBound;c.x*=s.x,c.y*=s.y,c.z*=s.z,c.vadd(e,c),c.vadd(s,u.aabb.upperBound)}},n.prototype.aabbQuery=function(t,e){this.data,this.children;for(var i=[this];i.length;){var r=i.pop();r.aabb.overlaps(t)&&Array.prototype.push.apply(e,r.data),Array.prototype.push.apply(i,r.children)}return e};var a=new i;n.prototype.rayQuery=function(t,e,i){return t.getAABB(a),a.toLocalFrame(e,a),this.aabbQuery(a,i),i},n.prototype.removeEmptyNodes=function(){for(var t=this.children.length-1;0<=t;t--)this.children[t].removeEmptyNodes(),this.children[t].children.length||this.children[t].data.length||this.children.splice(t,1)}},{"../collision/AABB":3,"../math/Vec3":32}],53:[function(t,e){function i(){this.objects=[],this.type=Object}(e.exports=i).prototype.release=function(){for(var t=arguments.length,e=0;e!==t;e++)this.objects.push(arguments[e]);return this},i.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()},i.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")},i.prototype.resize=function(t){for(var e=this.objects;e.length>t;)e.pop();for(;e.length<t;)e.push(this.constructObject());return this}},{}],54:[function(t,e){function i(){this.data={keys:[]}}(e.exports=i).prototype.get=function(t,e){if(e<t){var i=e;e=t,t=i}return this.data[t+"-"+e]},i.prototype.set=function(t,e,i){if(e<t){var r=e;e=t,t=r}var n=t+"-"+e;return this.get(t,e)||this.data.keys.push(n),this.data[n]=i,this.data[n]},i.prototype.del=function(t,e){if(e<t){var i=e;e=t,t=i}var r=t+"-"+e,n=this.data.keys.indexOf(r);return 0<=n&&(this.data.keys.splice(n,1),delete this.data[r],!0)},i.prototype.reset=function(){this.data={keys:[]}},i.prototype.getLength=function(){return this.data.keys.length},i.prototype.getKeyByIndex=function(t){return this.data.keys[t]},i.prototype.getDataByKey=function(t){return this.data[t]}},{}],55:[function(t,e){(e.exports=function(){}).defaults=function(t,e){for(var i in t=t||{},e)i in t||(t[i]=e[i]);return t}},{}],56:[function(t,e){e.exports=n;var i=t("../math/Vec3"),r=t("./Pool");function n(){r.call(this),this.type=i}(n.prototype=new r).constructObject=function(){return new i}},{"../math/Vec3":32,"./Pool":53}],57:[function(t,e){e.exports=_;var i=t("../collision/AABB"),r=t("../objects/Body"),n=t("../shapes/Shape"),s=t("../collision/Ray"),a=t("../math/Vec3"),o=t("../math/Transform"),h=(t("../shapes/ConvexPolyhedron"),t("../math/Quaternion")),l=(t("../solver/Solver"),t("../utils/Vec3Pool")),u=t("../equations/ContactEquation"),c=t("../equations/FrictionEquation");function _(t){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new l,this.world=t,this.currentContactMaterial=null,this.enableFrictionReduction=!1}_.prototype.createContactEquation=function(t,e,i,r,n,s){var a;this.contactPointPool.length?((a=this.contactPointPool.pop()).bi=t,a.bj=e):a=new u(t,e),a.enabled=t.collisionResponse&&e.collisionResponse&&i.collisionResponse&&r.collisionResponse;var o=this.currentContactMaterial;a.restitution=o.restitution,a.setSpookParams(o.contactEquationStiffness,o.contactEquationRelaxation,this.world.dt);var h=i.material||t.material,l=r.material||e.material;return h&&l&&0<=h.restitution&&0<=l.restitution&&(a.restitution=h.restitution*l.restitution),a.si=n||i,a.sj=s||r,a},_.prototype.createFrictionEquationsFromContact=function(t,e){var i=t.bi,r=t.bj,n=t.si,s=t.sj,a=this.world,o=this.currentContactMaterial,h=o.friction,l=n.material||i.material,u=s.material||r.material;if(l&&u&&0<=l.friction&&0<=u.friction&&(h=l.friction*u.friction),0<h){var _=h*a.gravity.length(),d=i.invMass+r.invMass;0<d&&(d=1/d);var p=this.frictionEquationPool,f=p.length?p.pop():new c(i,r,_*d),m=p.length?p.pop():new c(i,r,_*d);return f.bi=m.bi=i,f.bj=m.bj=r,f.minForce=m.minForce=-_*d,f.maxForce=m.maxForce=_*d,f.ri.copy(t.ri),f.rj.copy(t.rj),m.ri.copy(t.ri),m.rj.copy(t.rj),t.ni.tangents(f.t,m.t),f.setSpookParams(o.frictionEquationStiffness,o.frictionEquationRelaxation,a.dt),m.setSpookParams(o.frictionEquationStiffness,o.frictionEquationRelaxation,a.dt),f.enabled=m.enabled=t.enabled,e.push(f,m),!0}return!1};var d=new a,p=new a,f=new a;_.prototype.createFrictionFromAverage=function(t){var e=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(e,this.frictionResult)&&1!==t){var i=this.frictionResult[this.frictionResult.length-2],r=this.frictionResult[this.frictionResult.length-1];d.setZero(),p.setZero(),f.setZero();for(var n=e.bi,s=(e.bj,0);s!==t;s++)(e=this.result[this.result.length-1-s]).bodyA!==n?(d.vadd(e.ni,d),p.vadd(e.ri,p),f.vadd(e.rj,f)):(d.vsub(e.ni,d),p.vadd(e.rj,p),f.vadd(e.ri,f));var a=1/t;p.scale(a,i.ri),f.scale(a,i.rj),r.ri.copy(i.ri),r.rj.copy(i.rj),d.normalize(),d.tangents(i.t,r.t)}};var m=new a,g=new a,v=new h,y=new h;_.prototype.getContacts=function(t,e,i,n,s,a,o){this.contactPointPool=s,this.frictionEquationPool=o,this.result=n,this.frictionResult=a;for(var h=v,l=y,u=m,c=g,_=0,d=t.length;_!==d;_++){var p=t[_],f=e[_],T=null;p.material&&f.material&&(T=i.getContactMaterial(p.material,f.material)||null);for(var E=0==p.collisionResponse||0==f.collisionResponse||p.type&r.KINEMATIC&&f.type&r.STATIC||p.type&r.STATIC&&f.type&r.KINEMATIC||p.type&r.KINEMATIC&&f.type&r.KINEMATIC,S=0;S<p.shapes.length;S++){p.quaternion.mult(p.shapeOrientations[S],h),p.quaternion.vmult(p.shapeOffsets[S],u),u.vadd(p.position,u);for(var b=p.shapes[S],A=0;A<f.shapes.length;A++){f.quaternion.mult(f.shapeOrientations[A],l),f.quaternion.vmult(f.shapeOffsets[A],c),c.vadd(f.position,c);var C=f.shapes[A];if(b.collisionFilterMask&C.collisionFilterGroup&&C.collisionFilterMask&b.collisionFilterGroup&&!(u.distanceTo(c)>b.boundingSphereRadius+C.boundingSphereRadius)){E|=0==b.collisionResponse||0==C.collisionResponse;var w=null;b.material&&C.material&&(w=i.getContactMaterial(b.material,C.material)||null),this.currentContactMaterial=w||T||i.defaultContactMaterial;var R=this[b.type|C.type];if(R&&(b.type<C.type?R.call(this,b,C,u,c,h,l,p,f,b,C,E):R.call(this,C,b,c,u,l,h,f,p,b,C,E))&&E){i.shapeOverlapKeeper.set(b.id,C.id),i.bodyOverlapKeeper.set(p.id,f.id);var x={si:b,sj:C};i.triggerDic.set(b.id,C.id,x),i.oldTriggerDic.set(b.id,C.id,x)}}}}}},_.prototype[n.types.BOX|n.types.BOX]=_.prototype.boxBox=function(t,e,i,r,n,s,a,o,h,l,u){return t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e.convexPolyhedronRepresentation,i,r,n,s,a,o,t,e,u)},_.prototype[n.types.BOX|n.types.CONVEXPOLYHEDRON]=_.prototype.boxConvex=function(t,e,i,r,n,s,a,o,h,l,u){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e,i,r,n,s,a,o,t,e,u)},_.prototype[n.types.BOX|n.types.PARTICLE]=_.prototype.boxParticle=function(t,e,i,r,n,s,a,o,h,l,u){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexParticle(t.convexPolyhedronRepresentation,e,i,r,n,s,a,o,t,e,u)},_.prototype[n.types.SPHERE]=_.prototype.sphereSphere=function(t,e,i,r,n,s,a,o,h,l,u){if(u)return i.distanceSquared(r)<Math.pow(t.radius+e.radius,2);var c=this.createContactEquation(a,o,t,e,h,l);r.vsub(i,c.ni),c.ni.normalize(),c.ri.copy(c.ni),c.rj.copy(c.ni),c.ri.mult(t.radius,c.ri),c.rj.mult(-e.radius,c.rj),c.ri.vadd(i,c.ri),c.ri.vsub(a.position,c.ri),c.rj.vadd(r,c.rj),c.rj.vsub(o.position,c.rj),this.result.push(c),this.createFrictionEquationsFromContact(c,this.frictionResult)};var T=new a,E=new a,S=new a;_.prototype[n.types.PLANE|n.types.TRIMESH]=_.prototype.planeTrimesh=function(t,e,i,r,n,s,h,l,u,c,_){var d=new a,p=T;p.set(0,0,1),n.vmult(p,p);for(var f=0;f<e.vertices.length/3;f++){e.getVertex(f,d);var m=new a;m.copy(d),o.pointToWorldFrame(r,s,m,d);var g=E;if(d.vsub(i,g),p.dot(g)<=0){if(_)return!0;var v=this.createContactEquation(h,l,t,e,u,c);v.ni.copy(p);var y=S;p.scale(g.dot(p),y),d.vsub(y,y),v.ri.copy(y),v.ri.vsub(h.position,v.ri),v.rj.copy(d),v.rj.vsub(l.position,v.rj),this.result.push(v),this.createFrictionEquationsFromContact(v,this.frictionResult)}}};var b=new a,A=new a,C=(new a,new a),w=new a,R=new a,x=new a,O=new a,I=new a,M=new a,B=new a,P=new a,N=new a,L=new a,F=new i,D=[];_.prototype[n.types.SPHERE|n.types.TRIMESH]=_.prototype.sphereTrimesh=function(t,e,i,r,n,a,h,l,u,c,_){var d=R,p=x,f=O,m=I,g=M,v=B,y=F,T=w,E=A,S=D;o.pointToLocalFrame(r,a,i,g);var U=t.radius;y.lowerBound.set(g.x-U,g.y-U,g.z-U),y.upperBound.set(g.x+U,g.y+U,g.z+U),e.getTrianglesInAABB(y,S);for(var k=C,z=t.radius*t.radius,G=0;G<S.length;G++)for(var H=0;H<3;H++)if(e.getVertex(e.indices[3*S[G]+H],k),k.vsub(g,E),E.norm2()<=z){if(T.copy(k),o.pointToWorldFrame(r,a,T,k),k.vsub(i,E),_)return!0;(j=this.createContactEquation(h,l,t,e,u,c)).ni.copy(E),j.ni.normalize(),j.ri.copy(j.ni),j.ri.scale(t.radius,j.ri),j.ri.vadd(i,j.ri),j.ri.vsub(h.position,j.ri),j.rj.copy(k),j.rj.vsub(l.position,j.rj),this.result.push(j),this.createFrictionEquationsFromContact(j,this.frictionResult)}for(G=0;G<S.length;G++)for(H=0;H<3;H++){e.getVertex(e.indices[3*S[G]+H],d),e.getVertex(e.indices[3*S[G]+(H+1)%3],p),p.vsub(d,f),g.vsub(p,v);var V=v.dot(f);g.vsub(d,v);var W=v.dot(f);if(0<W&&V<0&&(g.vsub(d,v),m.copy(f),m.normalize(),W=v.dot(m),m.scale(W,v),v.vadd(d,v),(Q=v.distanceTo(g))<t.radius)){if(_)return!0;var j=this.createContactEquation(h,l,t,e,u,c);v.vsub(g,j.ni),j.ni.normalize(),j.ni.scale(t.radius,j.ri),o.pointToWorldFrame(r,a,v,v),v.vsub(l.position,j.rj),o.vectorToWorldFrame(a,j.ni,j.ni),o.vectorToWorldFrame(a,j.ri,j.ri),this.result.push(j),this.createFrictionEquationsFromContact(j,this.frictionResult)}}for(var X=P,Y=N,q=L,K=b,Z=(G=0,S.length);G!==Z;G++){e.getTriangleVertices(S[G],X,Y,q),e.getNormal(S[G],K),g.vsub(X,v);var Q=v.dot(K);if(K.scale(Q,v),g.vsub(v,v),Q=v.distanceTo(g),s.pointInTriangle(v,X,Y,q)&&Q<t.radius){if(_)return!0;j=this.createContactEquation(h,l,t,e,u,c),v.vsub(g,j.ni),j.ni.normalize(),j.ni.scale(t.radius,j.ri),o.pointToWorldFrame(r,a,v,v),v.vsub(l.position,j.rj),o.vectorToWorldFrame(a,j.ni,j.ni),o.vectorToWorldFrame(a,j.ri,j.ri),this.result.push(j),this.createFrictionEquationsFromContact(j,this.frictionResult)}}S.length=0};var U=new a,k=new a,z=new a,G=new a,H=new a;_.prototype[n.types.SPHERE|n.types.PLANE]=_.prototype.spherePlane=function(t,e,i,r,n,s,a,o,h,l,u){if(z.set(0,0,1),s.vmult(z,z),z.negate(z),z.normalize(),z.mult(t.radius,G),i.vsub(r,U),z.mult(z.dot(U),k),U.vsub(k,H),-U.dot(z)<=t.radius){if(u)return!0;var c=this.createContactEquation(a,o,t,e,h,l);c.ni.copy(z),c.ri.copy(G),c.rj.copy(H);var _=c.ri,d=c.rj;_.vadd(i,_),_.vsub(a.position,_),d.vadd(r,d),d.vsub(o.position,d),this.result.push(c),this.createFrictionEquationsFromContact(c,this.frictionResult)}return!1};var V=new a,W=new a,j=new a;function X(t,e,i){for(var r=null,n=t.length,s=0;s!==n;s++){var a=t[s],o=V;t[(s+1)%n].vsub(a,o);var h=W;o.cross(e,h);var l=j;i.vsub(a,l);var u=h.dot(l);if(!(null===r||0<u&&!0===r||u<=0&&!1===r))return!1;null===r&&(r=0<u)}return!0}var Y=new a,q=new a,K=new a,Z=new a,Q=[new a,new a,new a,new a,new a,new a],J=new a,$=new a,tt=new a,et=new a;_.prototype[n.types.SPHERE|n.types.BOX]=_.prototype.sphereBox=function(t,e,i,r,n,s,a,o,h,l,u){var c=this.v3pool,_=Q;i.vsub(r,Y),e.getSideNormals(_,s);for(var d=t.radius,p=!1,f=$,m=tt,g=et,v=null,y=0,T=0,E=0,S=null,b=0,A=_.length;b!==A&&!1===p;b++){var C=q;C.copy(_[b]);var w=C.norm();C.normalize();var R=Y.dot(C);if(R<w+d&&0<R){var x=K,O=Z;x.copy(_[(b+1)%3]),O.copy(_[(b+2)%3]);var I=x.norm(),M=O.norm();x.normalize(),O.normalize();var B=Y.dot(x),P=Y.dot(O);if(B<I&&-I<B&&P<M&&-M<P){var N=Math.abs(R-w-d);if((null===S||N<S)&&(S=N,T=B,E=P,v=w,f.copy(C),m.copy(x),g.copy(O),y++,u))return!0}}}if(y){p=!0;var L=this.createContactEquation(a,o,t,e,h,l);f.mult(-d,L.ri),L.ni.copy(f),L.ni.negate(L.ni),f.mult(v,f),m.mult(T,m),f.vadd(m,f),g.mult(E,g),f.vadd(g,L.rj),L.ri.vadd(i,L.ri),L.ri.vsub(a.position,L.ri),L.rj.vadd(r,L.rj),L.rj.vsub(o.position,L.rj),this.result.push(L),this.createFrictionEquationsFromContact(L,this.frictionResult)}for(var F=c.get(),D=J,U=0;2!==U&&!p;U++)for(var k=0;2!==k&&!p;k++)for(var z=0;2!==z&&!p;z++)if(F.set(0,0,0),U?F.vadd(_[0],F):F.vsub(_[0],F),k?F.vadd(_[1],F):F.vsub(_[1],F),z?F.vadd(_[2],F):F.vsub(_[2],F),r.vadd(F,D),D.vsub(i,D),D.norm2()<d*d){if(u)return!0;p=!0,(L=this.createContactEquation(a,o,t,e,h,l)).ri.copy(D),L.ri.normalize(),L.ni.copy(L.ri),L.ri.mult(d,L.ri),L.rj.copy(F),L.ri.vadd(i,L.ri),L.ri.vsub(a.position,L.ri),L.rj.vadd(r,L.rj),L.rj.vsub(o.position,L.rj),this.result.push(L),this.createFrictionEquationsFromContact(L,this.frictionResult)}c.release(F),F=null;var G=c.get(),H=c.get(),V=(L=c.get(),c.get()),W=(N=c.get(),_.length);for(U=0;U!==W&&!p;U++)for(k=0;k!==W&&!p;k++)if(U%3!=k%3){_[k].cross(_[U],G),G.normalize(),_[U].vadd(_[k],H),L.copy(i),L.vsub(H,L),L.vsub(r,L);var j=L.dot(G);for(G.mult(j,V),z=0;z===U%3||z===k%3;)z++;N.copy(i),N.vsub(V,N),N.vsub(H,N),N.vsub(r,N);var X=Math.abs(j),it=N.norm();if(X<_[z].norm()&&it<d){if(u)return!0;p=!0;var rt=this.createContactEquation(a,o,t,e,h,l);H.vadd(V,rt.rj),rt.rj.copy(rt.rj),N.negate(rt.ni),rt.ni.normalize(),rt.ri.copy(rt.rj),rt.ri.vadd(r,rt.ri),rt.ri.vsub(i,rt.ri),rt.ri.normalize(),rt.ri.mult(d,rt.ri),rt.ri.vadd(i,rt.ri),rt.ri.vsub(a.position,rt.ri),rt.rj.vadd(r,rt.rj),rt.rj.vsub(o.position,rt.rj),this.result.push(rt),this.createFrictionEquationsFromContact(rt,this.frictionResult)}}c.release(G,H,L,V,N)};var it=new a,rt=new a,nt=new a,st=new a,at=new a,ot=new a,ht=new a,lt=new a,ut=new a,ct=new a;_.prototype[n.types.SPHERE|n.types.CONVEXPOLYHEDRON]=_.prototype.sphereConvex=function(t,e,i,r,n,s,a,o,h,l,u){var c=this.v3pool;i.vsub(r,it);for(var _=e.faceNormals,d=e.faces,p=e.vertices,f=t.radius,m=0;m!==p.length;m++){var g=p[m],v=at;s.vmult(g,v),r.vadd(v,v);var y=st;if(v.vsub(i,y),y.norm2()<f*f)return!!u||(T=!0,(N=this.createContactEquation(a,o,t,e,h,l)).ri.copy(y),N.ri.normalize(),N.ni.copy(N.ri),N.ri.mult(f,N.ri),v.vsub(r,N.rj),N.ri.vadd(i,N.ri),N.ri.vsub(a.position,N.ri),N.rj.vadd(r,N.rj),N.rj.vsub(o.position,N.rj),this.result.push(N),void this.createFrictionEquationsFromContact(N,this.frictionResult))}for(var T=!1,E=(m=0,d.length);m!==E&&!1===T;m++){var S=_[m],b=d[m],A=ot;s.vmult(S,A);var C=ht;s.vmult(p[b[0]],C),C.vadd(r,C);var w=lt;A.mult(-f,w),i.vadd(w,w);var R=ut;w.vsub(C,R);var x=R.dot(A),O=ct;if(i.vsub(C,O),x<0&&0<O.dot(A)){for(var I=[],M=0,B=b.length;M!==B;M++){var P=c.get();s.vmult(p[b[M]],P),r.vadd(P,P),I.push(P)}if(X(I,A,i)){if(u)return!0;T=!0;var N=this.createContactEquation(a,o,t,e,h,l);A.mult(-f,N.ri),A.negate(N.ni);var L=c.get();A.mult(-x,L);var F=c.get();A.mult(-f,F),i.vsub(r,N.rj),N.rj.vadd(F,N.rj),N.rj.vadd(L,N.rj),N.rj.vadd(r,N.rj),N.rj.vsub(o.position,N.rj),N.ri.vadd(i,N.ri),N.ri.vsub(a.position,N.ri),c.release(L),c.release(F),this.result.push(N),this.createFrictionEquationsFromContact(N,this.frictionResult),M=0;for(var D=I.length;M!==D;M++)c.release(I[M]);return}for(M=0;M!==b.length;M++){var U=c.get(),k=c.get();s.vmult(p[b[(M+1)%b.length]],U),s.vmult(p[b[(M+2)%b.length]],k),r.vadd(U,U),r.vadd(k,k);var z=rt;k.vsub(U,z);var G=nt;z.unit(G);var H=c.get(),V=c.get();i.vsub(U,V);var W=V.dot(G);G.mult(W,H),H.vadd(U,H);var j=c.get();if(H.vsub(i,j),0<W&&W*W<z.norm2()&&j.norm2()<f*f){if(u)return!0;for(N=this.createContactEquation(a,o,t,e,h,l),H.vsub(r,N.rj),H.vsub(i,N.ni),N.ni.normalize(),N.ni.mult(f,N.ri),N.rj.vadd(r,N.rj),N.rj.vsub(o.position,N.rj),N.ri.vadd(i,N.ri),N.ri.vsub(a.position,N.ri),this.result.push(N),this.createFrictionEquationsFromContact(N,this.frictionResult),M=0,D=I.length;M!==D;M++)c.release(I[M]);return c.release(U),c.release(k),c.release(H),c.release(j),void c.release(V)}c.release(U),c.release(k),c.release(H),c.release(j),c.release(V)}for(M=0,D=I.length;M!==D;M++)c.release(I[M])}}},new a,new a,_.prototype[n.types.PLANE|n.types.BOX]=_.prototype.planeBox=function(t,e,i,r,n,s,a,o,h,l,u){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,e.convexPolyhedronRepresentation.id=e.id,this.planeConvex(t,e.convexPolyhedronRepresentation,i,r,n,s,a,o,t,e,u)};var _t=new a,dt=new a,pt=new a,ft=new a;_.prototype[n.types.PLANE|n.types.CONVEXPOLYHEDRON]=_.prototype.planeConvex=function(t,e,i,r,n,s,a,o,h,l,u){var c=_t,_=dt;_.set(0,0,1),n.vmult(_,_);for(var d=0,p=pt,f=0;f!==e.vertices.length;f++)if(c.copy(e.vertices[f]),s.vmult(c,c),r.vadd(c,c),c.vsub(i,p),_.dot(p)<=0){if(u)return!0;var m=this.createContactEquation(a,o,t,e,h,l),g=ft;_.mult(_.dot(p),g),c.vsub(g,g),g.vsub(i,m.ri),m.ni.copy(_),c.vsub(r,m.rj),m.ri.vadd(i,m.ri),m.ri.vsub(a.position,m.ri),m.rj.vadd(r,m.rj),m.rj.vsub(o.position,m.rj),this.result.push(m),d++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(m,this.frictionResult)}this.enableFrictionReduction&&d&&this.createFrictionFromAverage(d)};var mt=new a,gt=new a;_.prototype[n.types.CONVEXPOLYHEDRON]=_.prototype.convexConvex=function(t,e,i,r,n,s,a,o,h,l,u,c,_){var d=mt;if(!(i.distanceTo(r)>t.boundingSphereRadius+e.boundingSphereRadius)&&t.findSeparatingAxis(e,i,n,r,s,d,c,_)){var p=[],f=gt;t.clipAgainstHull(i,n,e,r,s,d,-100,100,p);for(var m=0,g=0;g!==p.length;g++){if(u)return!0;var v=this.createContactEquation(a,o,t,e,h,l),y=v.ri,T=v.rj;d.negate(v.ni),p[g].normal.negate(f),f.mult(p[g].depth,f),p[g].point.vadd(f,y),T.copy(p[g].point),y.vsub(i,y),T.vsub(r,T),y.vadd(i,y),y.vsub(a.position,y),T.vadd(r,T),T.vsub(o.position,T),this.result.push(v),m++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(v,this.frictionResult)}this.enableFrictionReduction&&m&&this.createFrictionFromAverage(m)}};var vt=new a,yt=new a,Tt=new a;_.prototype[n.types.PLANE|n.types.PARTICLE]=_.prototype.planeParticle=function(t,e,i,r,n,s,a,o,h,l,u){var c=vt;c.set(0,0,1),a.quaternion.vmult(c,c);var _=yt;if(r.vsub(a.position,_),c.dot(_)<=0){if(u)return!0;var d=this.createContactEquation(o,a,e,t,h,l);d.ni.copy(c),d.ni.negate(d.ni),d.ri.set(0,0,0);var p=Tt;c.mult(c.dot(r),p),r.vsub(p,p),d.rj.copy(p),this.result.push(d),this.createFrictionEquationsFromContact(d,this.frictionResult)}};var Et=new a;_.prototype[n.types.PARTICLE|n.types.SPHERE]=_.prototype.sphereParticle=function(t,e,i,r,n,s,a,o,h,l,u){var c=Et;if(c.set(0,0,1),r.vsub(i,c),c.norm2()<=t.radius*t.radius){if(u)return!0;var _=this.createContactEquation(o,a,e,t,h,l);c.normalize(),_.rj.copy(c),_.rj.mult(t.radius,_.rj),_.ni.copy(c),_.ni.negate(_.ni),_.ri.set(0,0,0),this.result.push(_),this.createFrictionEquationsFromContact(_,this.frictionResult)}};var St=new h,bt=new a,At=(new a,new a),Ct=new a,wt=new a;_.prototype[n.types.PARTICLE|n.types.CONVEXPOLYHEDRON]=_.prototype.convexParticle=function(t,e,i,r,n,s,a,o,h,l,u){var c=-1,_=At,d=wt,p=null,f=bt;if(f.copy(r),f.vsub(i,f),n.conjugate(St),St.vmult(f,f),t.pointIsInside(f)){t.worldVerticesNeedsUpdate&&t.computeWorldVertices(i,n),t.worldFaceNormalsNeedsUpdate&&t.computeWorldFaceNormals(n);for(var m=0,g=t.faces.length;m!==g;m++){var v=[t.worldVertices[t.faces[m][0]]],y=t.worldFaceNormals[m];r.vsub(v[0],Ct);var T=-y.dot(Ct);if(null===p||Math.abs(T)<Math.abs(p)){if(u)return!0;p=T,c=m,_.copy(y)}}if(-1!==c){var E=this.createContactEquation(o,a,e,t,h,l);_.mult(p,d),d.vadd(r,d),d.vsub(i,d),E.rj.copy(d),_.negate(E.ni),E.ri.set(0,0,0);var S=E.ri,b=E.rj;S.vadd(r,S),S.vsub(o.position,S),b.vadd(i,b),b.vsub(a.position,b),this.result.push(E),this.createFrictionEquationsFromContact(E,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},_.prototype[n.types.BOX|n.types.HEIGHTFIELD]=_.prototype.boxHeightfield=function(t,e,i,r,n,s,a,o,h,l,u){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexHeightfield(t.convexPolyhedronRepresentation,e,i,r,n,s,a,o,t,e,u)};var Rt=new a,xt=new a,Ot=[0];_.prototype[n.types.CONVEXPOLYHEDRON|n.types.HEIGHTFIELD]=_.prototype.convexHeightfield=function(t,e,i,r,n,s,a,h,l,u,c){var _=e.data,d=e.elementSize,p=t.boundingSphereRadius,f=xt,m=Ot,g=Rt;o.pointToLocalFrame(r,s,i,g);var v=Math.floor((g.x-p)/d)-1,y=Math.ceil((g.x+p)/d)+1,T=Math.floor((g.y-p)/d)-1,E=Math.ceil((g.y+p)/d)+1;if(!(y<0||E<0||v>_.length||T>_[0].length)){v<0&&(v=0),y<0&&(y=0),T<0&&(T=0),E<0&&(E=0),v>=_.length&&(v=_.length-1),y>=_.length&&(y=_.length-1),E>=_[0].length&&(E=_[0].length-1),T>=_[0].length&&(T=_[0].length-1);var S=[];e.getRectMinMax(v,T,y,E,S);var b=S[0],A=S[1];if(!(g.z-p>A||g.z+p<b))for(var C=v;C<y;C++)for(var w=T;w<E;w++){var R=!1;if(e.getConvexTrianglePillar(C,w,!1),o.pointToWorldFrame(r,s,e.pillarOffset,f),i.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(R=this.convexConvex(t,e.pillarConvex,i,f,n,s,a,h,l,u,c,m,null)),c&&R)return!0;if(e.getConvexTrianglePillar(C,w,!0),o.pointToWorldFrame(r,s,e.pillarOffset,f),i.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(R=this.convexConvex(t,e.pillarConvex,i,f,n,s,a,h,l,u,c,m,null)),c&&R)return!0}}};var It=new a,Mt=new a;_.prototype[n.types.SPHERE|n.types.HEIGHTFIELD]=_.prototype.sphereHeightfield=function(t,e,i,r,n,s,a,h,l,u,c){var _=e.data,d=t.radius,p=e.elementSize,f=Mt,m=It;o.pointToLocalFrame(r,s,i,m);var g=Math.floor((m.x-d)/p)-1,v=Math.ceil((m.x+d)/p)+1,y=Math.floor((m.y-d)/p)-1,T=Math.ceil((m.y+d)/p)+1;if(!(v<0||T<0||g>_.length||y>_[0].length)){g<0&&(g=0),v<0&&(v=0),y<0&&(y=0),T<0&&(T=0),g>=_.length&&(g=_.length-1),v>=_.length&&(v=_.length-1),T>=_[0].length&&(T=_[0].length-1),y>=_[0].length&&(y=_[0].length-1);var E=[];e.getRectMinMax(g,y,v,T,E);var S=E[0],b=E[1];if(!(m.z-d>b||m.z+d<S))for(var A=this.result,C=g;C<v;C++)for(var w=y;w<T;w++){var R=A.length,x=!1;if(e.getConvexTrianglePillar(C,w,!1),o.pointToWorldFrame(r,s,e.pillarOffset,f),i.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(x=this.sphereConvex(t,e.pillarConvex,i,f,n,s,a,h,t,e,c)),c&&x)return!0;if(e.getConvexTrianglePillar(C,w,!0),o.pointToWorldFrame(r,s,e.pillarOffset,f),i.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(x=this.sphereConvex(t,e.pillarConvex,i,f,n,s,a,h,t,e,c)),c&&x)return!0;if(2<A.length-R)return}}}},{"../collision/AABB":3,"../collision/Ray":10,"../equations/ContactEquation":20,"../equations/FrictionEquation":22,"../math/Quaternion":30,"../math/Transform":31,"../math/Vec3":32,"../objects/Body":33,"../shapes/ConvexPolyhedron":40,"../shapes/Shape":45,"../solver/Solver":49,"../utils/Vec3Pool":56}],58:[function(t,e){e.exports=v,t("../shapes/Shape");var i=t("../math/Vec3"),r=t("../math/Quaternion"),n=t("../solver/GSSolver"),s=(t("../equations/ContactEquation"),t("../equations/FrictionEquation"),t("./Narrowphase")),a=t("../utils/EventTarget"),o=t("../collision/ArrayCollisionMatrix"),h=t("../collision/ObjectCollisionMatrix"),l=t("../collision/OverlapKeeper"),u=t("../material/Material"),c=t("../material/ContactMaterial"),_=t("../objects/Body"),d=t("../utils/TupleDictionary"),p=t("../collision/RaycastResult"),f=t("../collision/AABB"),m=t("../collision/Ray"),g=t("../collision/NaiveBroadphase");function v(t){t=t||{},a.apply(this),this.dt=-1,this.allowSleep=!!t.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=void 0!==t.quatNormalizeSkip?t.quatNormalizeSkip:0,this.quatNormalizeFast=void 0!==t.quatNormalizeFast&&t.quatNormalizeFast,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new i,t.gravity&&this.gravity.copy(t.gravity),this.broadphase=void 0!==t.broadphase?t.broadphase:new g,this.bodies=[],this.solver=void 0!==t.solver?t.solver:new n,this.constraints=[],this.narrowphase=new s(this),this.collisionMatrix=new o,this.collisionMatrixPrevious=new o,this.bodyOverlapKeeper=new l,this.shapeOverlapKeeper=new l,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new d,this.defaultMaterial=new u("default"),this.defaultContactMaterial=new c(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this),this.substeps=0,this.cm=new h,this.tm=new h,this.triggerDic=new d,this.oldTriggerDic=new d,this.contactsDic=new d,this.oldContactsDic=new d}v.idToBodyMap={},v.idToShapeMap={},v.prototype=new a,new f;var y=new m;if(v.prototype.getContactMaterial=function(t,e){return this.contactMaterialTable.get(t.id,e.id)},v.prototype.numObjects=function(){return this.bodies.length},v.prototype.collisionMatrixTick=function(){var t=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=t,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()},v.prototype.add=v.prototype.addBody=function(t){-1===this.bodies.indexOf(t)&&(t.index=this.bodies.length,this.bodies.push(t),t.world=this,t.initPosition.copy(t.position),t.initVelocity.copy(t.velocity),t.timeLastSleepy=this.time,t instanceof _&&(t.initAngularVelocity.copy(t.angularVelocity),t.initQuaternion.copy(t.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=t,this.cm.setNumObjects(this.bodies.length),v.idToBodyMap[t.id]=t,this.dispatchEvent(this.addBodyEvent))},v.prototype.addConstraint=function(t){this.constraints.push(t)},v.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e&&this.constraints.splice(e,1)},v.prototype.rayTest=function(t,e,i){i instanceof p?this.raycastClosest(t,e,{skipBackfaces:!0},i):this.raycastAll(t,e,{skipBackfaces:!0},i)},v.prototype.raycastAll=function(t,e,i,r){return i.mode=m.ALL,i.from=t,i.to=e,i.callback=r,y.intersectWorld(this,i)},v.prototype.raycastAny=function(t,e,i,r){return i.mode=m.ANY,i.from=t,i.to=e,i.result=r,y.intersectWorld(this,i)},v.prototype.raycastClosest=function(t,e,i,r){return i.mode=m.CLOSEST,i.from=t,i.to=e,i.result=r,y.intersectWorld(this,i)},v.prototype.removeBody=v.prototype.remove=function(t){t.world=null;var e=this.bodies.length-1,i=this.bodies,r=i.indexOf(t);if(-1!==r){i.splice(r,1);for(var n=0;n!==i.length;n++)i[n].index=n;this.collisionMatrix.setNumObjects(e),this.removeBodyEvent.body=t,delete v.idToBodyMap[t.id],this.cm.setNumObjects(e),this.dispatchEvent(this.removeBodyEvent)}},v.prototype.getBodyById=function(t){return v.idToBodyMap[t]},v.prototype.getShapeById=function(t){return v.idToShapeMap[t]},v.prototype.addMaterial=function(t){this.materials.push(t)},v.prototype.addContactMaterial=function(t){this.contactmaterials.push(t),this.contactMaterialTable.set(t.materials[0].id,t.materials[1].id,t)},"undefined"==typeof performance&&(performance={}),!performance.now){var T=Date.now();performance.timing&&performance.timing.navigationStart&&(T=performance.timing.navigationStart),performance.now=function(){return Date.now()-T}}new i,v.prototype.step=function(t,e,i){if(i=i||10,0===(e=e||0))this.internalStep(t),this.time+=t,this.substeps=1;else{for(this.accumulator+=e,this.substeps=0;this.accumulator>=t&&this.substeps<i;)this.internalStep(t),this.accumulator-=t,this.substeps++;for(var r=this.accumulator%t/t,n=0;n!==this.bodies.length;n++){var s=this.bodies[n];s.previousPosition.lerp(s.position,r,s.interpolatedPosition),s.previousQuaternion.slerp(s.quaternion,r,s.interpolatedQuaternion),s.previousQuaternion.normalize()}this.time+=e}};var E,S,b,A,C,w,R={type:"postStep"},x={type:"preStep"},O={type:"collide",body:null,contact:null},I=[],M=[],B=[],P=[];new i,new i,new i,new i,new i,new i,new i,new i,new i,new r,new r,new r,new i,v.prototype.internalStep=function(t){this.dt=t;var e,i=this.contacts,r=B,n=P,s=this.numObjects(),a=this.bodies,o=this.solver,h=this.gravity,l=this.doProfiling,u=this.profile,c=_.DYNAMIC,d=this.constraints,p=M,f=(h.norm(),h.x),m=h.y,g=h.z,v=0;for(l&&(e=performance.now()),v=0;v!==s;v++)if((F=a[v]).useGravity&&F.type===c){var y=F.force,T=F.mass;y.x+=T*f,y.y+=T*m,y.z+=T*g}v=0;for(var E=this.subsystems.length;v!==E;v++)this.subsystems[v].update();l&&(e=performance.now()),r.length=0,n.length=0,this.broadphase.collisionPairs(this,r,n),l&&(u.broadphase=performance.now()-e);var S=d.length;for(v=0;v!==S;v++)if(!(H=d[v]).collideConnected)for(var b=r.length-1;0<=b;--b)(H.bodyA===r[b]&&H.bodyB===n[b]||H.bodyB===r[b]&&H.bodyA===n[b])&&(r.splice(b,1),n.splice(b,1));this.collisionMatrixTick(),l&&(e=performance.now());var A=I,C=i.length;for(v=0;v!==C;v++)A.push(i[v]);i.length=0;var w=this.frictionEquations.length;for(v=0;v!==w;v++)p.push(this.frictionEquations[v]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(r,n,this,i,A,this.frictionEquations,p),l&&(u.narrowphase=performance.now()-e),l&&(e=performance.now()),v=0;v<this.frictionEquations.length;v++)o.addEquation(this.frictionEquations[v]);for(var N=i.length,L=0;L!==N;L++){var F=(H=i[L]).bi,D=H.bj,U=H.si,k=H.sj;if(U.material&&k.material?0<=U.material.restitution&&0<=k.material.restitution&&(H.restitution=U.material.restitution*k.material.restitution):F.material&&D.material&&0<=F.material.restitution&&0<=D.material.restitution&&(H.restitution=F.material.restitution*D.material.restitution),o.addEquation(H),F.allowSleep&&F.type===_.DYNAMIC&&F.sleepState===_.SLEEPING&&D.sleepState===_.AWAKE&&D.type!==_.STATIC){var z=D.velocity.norm2()+D.angularVelocity.norm2();2*Math.pow(D.sleepSpeedLimit,2)<=z&&(F._wakeUpAfterNarrowphase=!0)}if(D.allowSleep&&D.type===_.DYNAMIC&&D.sleepState===_.SLEEPING&&F.sleepState===_.AWAKE&&F.type!==_.STATIC){var G=F.velocity.norm2()+F.angularVelocity.norm2();2*Math.pow(F.sleepSpeedLimit,2)<=G&&(D._wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(F,D,!0),this.collisionMatrixPrevious.get(F,D)||(O.body=D,O.contact=H,F.dispatchEvent(O),O.body=F,D.dispatchEvent(O)),this.bodyOverlapKeeper.set(F.id,D.id),this.shapeOverlapKeeper.set(U.id,k.id)}for(this.emitContactEvents(),l&&(u.makeContactConstraints=performance.now()-e,e=performance.now()),v=0;v!==s;v++)(F=a[v])._wakeUpAfterNarrowphase&&(F.wakeUp(),F._wakeUpAfterNarrowphase=!1);for(S=d.length,v=0;v!==S;v++){var H;(H=d[v]).update(),b=0;for(var V=H.equations.length;b!==V;b++){var W=H.equations[b];o.addEquation(W)}}o.solve(t,this),l&&(u.solve=performance.now()-e),o.removeAllEquations();var j=Math.pow;for(v=0;v!==s;v++)if((F=a[v]).type&c){var X=j(1-F.linearDamping,t),Y=F.velocity;Y.mult(X,Y);var q=F.angularVelocity;if(q){var K=j(1-F.angularDamping,t);q.mult(K,q)}}for(this.dispatchEvent(x),v=0;v!==s;v++)(F=a[v]).preStep&&F.preStep.call(F);l&&(e=performance.now());var Z=this.stepnumber%(this.quatNormalizeSkip+1)==0,Q=this.quatNormalizeFast;for(v=0;v!==s;v++)a[v].integrate(t,Z,Q);for(this.clearForces(),this.broadphase.dirty=!0,l&&(u.integrate=performance.now()-e),this.time+=t,this.stepnumber+=1,this.dispatchEvent(R),v=0;v!==s;v++){var J=(F=a[v]).postStep;J&&J.call(F)}if(this.allowSleep)for(v=0;v!==s;v++)a[v].sleepTick(this.time)},v.prototype.emitContactEvents=(E=[],S=[],b={type:"beginContact",bodyA:null,bodyB:null},A={type:"endContact",bodyA:null,bodyB:null},C={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},w={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},function(){var t=this.hasAnyEventListener("beginContact"),e=this.hasAnyEventListener("endContact");if((t||e)&&this.bodyOverlapKeeper.getDiff(E,S),t){for(var i=0,r=E.length;i<r;i+=2)b.bodyA=this.getBodyById(E[i]),b.bodyB=this.getBodyById(E[i+1]),this.dispatchEvent(b);b.bodyA=b.bodyB=null}if(e){for(i=0,r=S.length;i<r;i+=2)A.bodyA=this.getBodyById(S[i]),A.bodyB=this.getBodyById(S[i+1]),this.dispatchEvent(A);A.bodyA=A.bodyB=null}E.length=S.length=0;var n=this.hasAnyEventListener("beginShapeContact"),s=this.hasAnyEventListener("endShapeContact");if((n||s)&&this.shapeOverlapKeeper.getDiff(E,S),n){for(i=0,r=E.length;i<r;i+=2){var a=this.getShapeById(E[i]),o=this.getShapeById(E[i+1]);C.shapeA=a,C.shapeB=o,C.bodyA=a.body,C.bodyB=o.body,this.dispatchEvent(C)}C.bodyA=C.bodyB=C.shapeA=C.shapeB=null}if(s){for(i=0,r=S.length;i<r;i+=2)a=this.getShapeById(S[i]),o=this.getShapeById(S[i+1]),w.shapeA=a,w.shapeB=o,w.bodyA=a.body,w.bodyB=o.body,this.dispatchEvent(w);w.bodyA=w.bodyB=w.shapeA=w.shapeB=null}}),v.prototype.clearForces=function(){for(var t=this.bodies,e=t.length,i=0;i!==e;i++){var r=t[i];r.force,r.torque,r.force.set(0,0,0),r.torque.set(0,0,0)}};var N={type:"cc-trigger",event:"",selfBody:null,otherBody:null,selfShape:null,otherShape:null},L={type:"cc-collide",event:"",body:null,selfShape:null,otherShape:null,contacts:null},F=[];v.prototype.emitTriggeredEvents=function(){if(0!=this.substeps){for(var t,e,i=this.triggerDic.getLength();i--;)if(t=this.triggerDic.getKeyByIndex(i),null!=(e=this.triggerDic.getDataByKey(t))){var r=e.si,n=e.sj;this.tm.get(r,n)?N.event="onTriggerStay":(this.tm.set(r,n,!0),N.event="onTriggerEnter"),N.selfShape=r,N.otherShape=n,N.selfBody=r.body,N.otherBody=n.body,r.dispatchEvent(N),N.selfShape=n,N.otherShape=r,N.selfBody=n.body,N.otherBody=r.body,n.dispatchEvent(N)}for(i=this.oldTriggerDic.getLength();0<i;)i--,t=this.oldTriggerDic.getKeyByIndex(i),null==this.triggerDic.getDataByKey(t)&&null!=(e=this.oldTriggerDic.getDataByKey(t))&&(r=e.si,n=e.sj,this.tm.set(r,n,!1),this.oldTriggerDic.del(r.id,n.id)&&i--,N.event="onTriggerExit",N.selfShape=r,N.otherShape=n,N.selfBody=r.body,N.otherBody=n.body,r.dispatchEvent(N),N.selfShape=n,N.otherShape=r,N.selfBody=n.body,N.otherBody=r.body,n.dispatchEvent(N));this.triggerDic.reset()}},v.prototype.emitCollisionEvents=function(){if(0!=this.substeps){for(var t,e,i=this.contacts,r=this.contacts.length;r--;){var n=(u=i[r]).si,s=u.sj,a=this.contactsDic.get(n.id,s.id);null==a&&(a=this.contactsDic.set(n.id,s.id,[])),a.push(u)}for(r=this.contactsDic.getLength();r--;)if(t=this.contactsDic.getKeyByIndex(r),null!=(e=this.contactsDic.getDataByKey(t))){n=e[0].si,s=e[0].sj;var o=n.body,h=s.body;this.cm.get(o,h)?L.event="onCollisionStay":(this.cm.set(o,h,!0),L.event="onCollisionEnter"),L.bi=o,L.contact=e[0],L.contacts=e,L.body=h,L.selfShape=n,L.otherShape=s,o.dispatchEvent(L),L.body=o,L.selfShape=s,L.otherShape=n,h.dispatchEvent(L)}var l=F;for(r=l.length;r--;){var u;n=(u=l[r]).si,s=u.sj,null==this.oldContactsDic.get(n.id,s.id)&&this.oldContactsDic.set(n.id,s.id,u)}for(r=this.oldContactsDic.getLength();r--;)t=this.oldContactsDic.getKeyByIndex(r),null==this.contactsDic.getDataByKey(t)&&(n=(e=this.oldContactsDic.getDataByKey(t)).si,s=e.sj,o=n.body,h=s.body,this.cm.get(o,h)&&(o.isSleeping()&&h.isSleeping()||(this.cm.set(o,h,!1),L.bi=o,L.contact=e,L.event="onCollisionExit",L.body=h,L.selfShape=n,L.otherShape=s,L.contacts.length=0,L.contacts.push(e),o.dispatchEvent(L),L.body=o,L.selfShape=s,L.otherShape=n,h.dispatchEvent(L))));this.contactsDic.reset(),this.oldContactsDic.reset(),I=F,F=this.contacts.slice(),this.contacts.length=0}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/ObjectCollisionMatrix":8,"../collision/OverlapKeeper":9,"../collision/Ray":10,"../collision/RaycastResult":11,"../equations/ContactEquation":20,"../equations/FrictionEquation":22,"../material/ContactMaterial":25,"../material/Material":26,"../math/Quaternion":30,"../math/Vec3":32,"../objects/Body":33,"../shapes/Shape":45,"../solver/GSSolver":48,"../utils/EventTarget":51,"../utils/TupleDictionary":54,"./Narrowphase":57}]},{},[2])(2)}(e={exports:{}}),e.exports}();!function(t){t[t.DYNAMIC=1]="DYNAMIC",t[t.STATIC=2]="STATIC",t[t.KINEMATIC=4]="KINEMATIC"}(I6||(I6=t("ERigidBodyType",{}))),Pt(I6),function(t){t[t.X_AXIS=0]="X_AXIS",t[t.Y_AXIS=1]="Y_AXIS",t[t.Z_AXIS=2]="Z_AXIS"}(M6||(M6=t("EAxisDirection",{}))),Pt(M6),function(t){t[t.VERTEX=1]="VERTEX",t[t.LINE=2]="LINE",t[t.TRIANGLE=3]="TRIANGLE",t[t.TETRAHEDRON=4]="TETRAHEDRON"}(B6||(B6={})),Pt(B6),function(t){t[t.BOX=0]="BOX",t[t.SPHERE=1]="SPHERE",t[t.CAPSULE=2]="CAPSULE",t[t.CYLINDER=3]="CYLINDER",t[t.CONE=4]="CONE",t[t.MESH=5]="MESH",t[t.PLANE=6]="PLANE",t[t.SIMPLEX=7]="SIMPLEX",t[t.TERRAIN=8]="TERRAIN"}(P6||(P6={})),Pt(P6),function(t){t[t.POINT_TO_POINT=0]="POINT_TO_POINT",t[t.HINGE=1]="HINGE",t[t.CONE_TWIST=2]="CONE_TWIST"}(N6||(N6={})),Pt(N6),function(t){t[t.DEFAULT=1]="DEFAULT"}(L6||(L6={})),Pt(L6);var D6={INITED:!1},U6=function(){return 0},k6={impl:null,collider:null,attachedRigidBody:null,initialize:U6,onLoad:U6,onEnable:U6,onDisable:U6,onDestroy:U6,setGroup:U6,getGroup:U6,addGroup:U6,removeGroup:U6,setMask:U6,getMask:U6,addMask:U6,removeMask:U6,setMaterial:U6,setAsTrigger:U6,setCenter:U6,getAABB:U6,getBoundingSphere:U6,setSize:U6,setRadius:U6,setCylinderHeight:U6,setDirection:U6,setHeight:U6,setShapeType:U6,setVertices:U6,setMesh:U6,setTerrain:U6,setNormal:U6,setConstant:U6};var z6,G6,H6,V6,W6,j6,X6,Y6,q6={INITED:!1},K6={impl:null,initialize:U6,onLoad:U6,onEnable:U6,onDisable:U6,onDestroy:U6,setEnableCollision:U6,setConnectedBody:U6,setPivotA:U6,setPivotB:U6};var Z6=function(e){return t({PhysicsMaterial:e,PhysicMaterial:e}),e}(Ne("cc.PhysicsMaterial")((Y6=X6=function(t){function e(){var i;return l(i=t.call(this)||this,"_friction",H6,a(i)),l(i,"_rollingFriction",V6,a(i)),l(i,"_spinningFriction",W6,a(i)),l(i,"_restitution",j6,a(i)),e.allMaterials.push(a(i)),""==i._uuid&&(i._uuid="pm_"+e._idCounter++),i}s(e,t),r(e,[{key:"friction",get:function(){return this._friction},set:function(t){xr(this._friction,t)||(this._friction=t,this.emit("physics_material_update"))}},{key:"rollingFriction",get:function(){return this._rollingFriction},set:function(t){xr(this._rollingFriction,t)||(this._rollingFriction=t,this.emit("physics_material_update"))}},{key:"spinningFriction",get:function(){return this._spinningFriction},set:function(t){xr(this._spinningFriction,t)||(this._spinningFriction=t,this.emit("physics_material_update"))}},{key:"restitution",get:function(){return this._restitution},set:function(t){xr(this._restitution,t)||(this._restitution=t,this.emit("physics_material_update"))}}]);var i=e.prototype;return i.clone=function(){var t=new e;return t._friction=this._friction,t._restitution=this._restitution,t._rollingFriction=this._rollingFriction,t._spinningFriction=this._spinningFriction,t},i.destroy=function(){if(t.prototype.destroy.call(this)){var i=e.allMaterials.indexOf(this);return i>=0&&e.allMaterials.splice(i,1),!0}return!1},e}(Sr),X6.allMaterials=[],X6._idCounter=0,u((G6=Y6).prototype,"friction",[Ke],Object.getOwnPropertyDescriptor(G6.prototype,"friction"),G6.prototype),u(G6.prototype,"rollingFriction",[Ke],Object.getOwnPropertyDescriptor(G6.prototype,"rollingFriction"),G6.prototype),u(G6.prototype,"spinningFriction",[Ke],Object.getOwnPropertyDescriptor(G6.prototype,"spinningFriction"),G6.prototype),u(G6.prototype,"restitution",[Ke],Object.getOwnPropertyDescriptor(G6.prototype,"restitution"),G6.prototype),H6=u(G6.prototype,"_friction",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),V6=u(G6.prototype,"_rollingFriction",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),W6=u(G6.prototype,"_spinningFriction",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),j6=u(G6.prototype,"_restitution",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),z6=G6))||z6),Q6=t("PhysicsRayResult",function(){function t(){this._hitPoint=new Cs,this._hitNormal=new Cs,this._distance=0,this._collider=null}var e=t.prototype;return e._assign=function(t,e,i,r){Cs.copy(this._hitPoint,t),Cs.copy(this._hitNormal,r),this._distance=e,this._collider=i},e.clone=function(){var e=new t;return Cs.copy(e._hitPoint,this._hitPoint),Cs.copy(e._hitNormal,this._hitNormal),e._distance=this._distance,e._collider=this._collider,e},r(t,[{key:"hitPoint",get:function(){return this._hitPoint}},{key:"distance",get:function(){return this._distance}},{key:"collider",get:function(){return this._collider}},{key:"hitNormal",get:function(){return this._hitNormal}}]),t}()),J6=function(){for(var t=0;t<32;t++)this[""+(1<<t)]=0;this[1]=L6.DEFAULT};_.internal.PhysicsGroup=L6;var $6,t7,e7,i7,r7,n7,s7,a7,o7,h7,l7,u7,c7,_7,d7,p7,f7,m7,g7,v7,y7,T7,E7,S7,b7,A7,C7,w7,R7,x7,O7,I7,M7,B7,P7,N7,L7,F7,D7,U7,k7,z7,G7,H7,V7=t("PhysicsSystem",function(t){function e(){var e;(e=t.call(this)||this).physicsWorld=void 0,e.raycastClosestResult=new Q6,e.raycastResults=[],e.collisionMatrix=new J6,e.useNodeChains=void 0,e._enable=!0,e._allowSleep=!0,e._maxSubSteps=1,e._subStepCount=0,e._fixedTimeStep=1/60,e._autoSimulation=!0,e._accumulator=0,e._sleepThreshold=.1,e._gravity=new Cs(0,-10,0),e._material=new Z6,e.raycastOptions={group:-1,mask:-1,queryTrigger:!0,maxDistance:1e7},e.raycastResultPool=new Vi((function(){return new Q6}),1);var i=PO.config?PO.config.physics:null;if(i){if(Cs.copy(e._gravity,i.gravity),e._allowSleep=i.allowSleep,e._fixedTimeStep=i.fixedTimeStep,e._maxSubSteps=i.maxSubSteps,e._sleepThreshold=i.sleepThreshold,e.autoSimulation=i.autoSimulation,e.useNodeChains=i.useNodeChains,i.defaultMaterial&&(e._material.friction=i.defaultMaterial.friction,e._material.rollingFriction=i.defaultMaterial.rollingFriction,e._material.spinningFriction=i.defaultMaterial.spinningFriction,e._material.restitution=i.defaultMaterial.restitution),i.collisionMatrix)for(var r in i.collisionMatrix){var n=1<<parseInt(r);e.collisionMatrix[""+n]=i.collisionMatrix[r]}}else e.useNodeChains=!1;return e._material.on("physics_material_update",e._updateMaterial,a(e)),e.physicsWorld=new x6.PhysicsWorld,e.physicsWorld.setGravity(e._gravity),e.physicsWorld.setAllowSleep(e._allowSleep),e.physicsWorld.setDefaultMaterial(e._material),e}s(e,t),r(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable=t}},{key:"allowSleep",get:function(){return this._allowSleep},set:function(t){this._allowSleep=t,this.physicsWorld.setAllowSleep(t)}},{key:"maxSubSteps",get:function(){return this._maxSubSteps},set:function(t){this._maxSubSteps=t}},{key:"fixedTimeStep",get:function(){return this._fixedTimeStep},set:function(t){this._fixedTimeStep=t}},{key:"gravity",get:function(){return this._gravity},set:function(t){this._gravity.set(t),this.physicsWorld.setGravity(t)}},{key:"sleepThreshold",get:function(){return this._sleepThreshold},set:function(t){this._sleepThreshold=t}},{key:"autoSimulation",get:function(){return this._autoSimulation},set:function(t){this._autoSimulation=t}},{key:"defaultMaterial",get:function(){return this._material}}],[{key:"PHYSICS_NONE",get:function(){return!O6}},{key:"PHYSICS_BUILTIN",get:function(){return"builtin"===O6}},{key:"PHYSICS_CANNON",get:function(){return"cannon.js"===O6}},{key:"PHYSICS_AMMO",get:function(){return"ammo.js"===O6}},{key:"PhysicsGroup",get:function(){return L6}},{key:"instance",get:function(){return e._instance}}]);var i=e.prototype;return i.postUpdate=function(t){if(this._enable){if(this._autoSimulation){for(this._subStepCount=0,this._accumulator+=t,NF.emit(PF.EVENT_BEFORE_PHYSICS);this._subStepCount<this._maxSubSteps;){if(!(this._accumulator>this._fixedTimeStep)){this.physicsWorld.syncSceneToPhysics();break}this.physicsWorld.syncSceneToPhysics(),this.physicsWorld.step(this._fixedTimeStep),this._accumulator-=this._fixedTimeStep,this._subStepCount++,this.physicsWorld.emitEvents(),this.physicsWorld.syncSceneToPhysics()}NF.emit(PF.EVENT_AFTER_PHYSICS)}}else this.physicsWorld.syncSceneToPhysics()},i.resetAccumulator=function(t){void 0===t&&(t=0),this._accumulator=t},i.step=function(t,e,i){this.physicsWorld.step(t,e,i)},i.syncSceneToPhysics=function(){this.physicsWorld.syncSceneToPhysics()},i.emitEvents=function(){this.physicsWorld.emitEvents()},i.raycast=function(t,e,i,r){return void 0===e&&(e=4294967295),void 0===i&&(i=1e7),void 0===r&&(r=!0),this.raycastResultPool.reset(),this.raycastResults.length=0,this.raycastOptions.mask=e,this.raycastOptions.maxDistance=i,this.raycastOptions.queryTrigger=r,this.physicsWorld.raycast(t,this.raycastOptions,this.raycastResultPool,this.raycastResults)},i.raycastClosest=function(t,e,i,r){return void 0===e&&(e=4294967295),void 0===i&&(i=1e7),void 0===r&&(r=!0),this.raycastOptions.mask=e,this.raycastOptions.maxDistance=i,this.raycastOptions.queryTrigger=r,this.physicsWorld.raycastClosest(t,this.raycastOptions,this.raycastClosestResult)},i._updateMaterial=function(){this.physicsWorld.setDefaultMaterial(this._material)},e}(qO));V7.ID="PHYSICS",V7._instance=void 0,NF.once(PF.EVENT_INIT,(function(){!function(){if(!V7.PHYSICS_NONE){var t=new _.PhysicsSystem;_.PhysicsSystem._instance=t,NF.registerSystem(V7.ID,t,0)}}()}));var W7,j7,X7,Y7,q7,K7,Z7,Q7,J7,$7,t9,e9,i9,r9,n9,s9,a9,o9,h9,l9,u9,c9=function(e){return t({RigidBody:e,RigidBodyComponent:e}),e}(($6=Ne("cc.RigidBody"),t7=qe(),e7=We(),i7=Fe(-1),r7=pi(V7.PhysicsGroup),n7=si(),s7=$e(),a7=pi(I6),o7=si(),h7=$e(),l7=Ze(),u7=si(),c7=$e(),_7=Ze(),d7=si(),p7=$e(),f7=Ze(),m7=si(),g7=$e(),v7=Ze(),y7=si(),T7=$e(),E7=Ze(),S7=si(),b7=$e(),A7=Ze(),C7=si(),w7=$e(),R7=Ze(),x7=si(),O7=$e(),$6(I7=t7(I7=e7(I7=Ve(I7=De(I7=i7((H7=G7=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._body=null,l(e,"_group",B7,a(e)),l(e,"_type",P7,a(e)),l(e,"_mass",N7,a(e)),l(e,"_allowSleep",L7,a(e)),l(e,"_linearDamping",F7,a(e)),l(e,"_angularDamping",D7,a(e)),l(e,"_useGravity",U7,a(e)),l(e,"_linearFactor",k7,a(e)),l(e,"_angularFactor",z7,a(e)),e}s(e,t);var i=e.prototype;return i.onLoad=function(){this._body=new x6.RigidBody,this._body.initialize(this)},i.onEnable=function(){this._body&&this._body.onEnable()},i.onDisable=function(){this._body&&this._body.onDisable()},i.onDestroy=function(){this._body&&this._body.onDestroy()},i.applyForce=function(t,e){this._assertOnLoadCalled&&this._body.applyForce(t,e)},i.applyLocalForce=function(t,e){this._assertOnLoadCalled&&this._body.applyLocalForce(t,e)},i.applyImpulse=function(t,e){this._assertOnLoadCalled&&this._body.applyImpulse(t,e)},i.applyLocalImpulse=function(t,e){this._assertOnLoadCalled&&this._body.applyLocalImpulse(t,e)},i.applyTorque=function(t){this._assertOnLoadCalled&&this._body.applyTorque(t)},i.applyLocalTorque=function(t){this._assertOnLoadCalled&&this._body.applyLocalTorque(t)},i.wakeUp=function(){this._assertOnLoadCalled&&this._body.wakeUp()},i.sleep=function(){this._assertOnLoadCalled&&this._body.sleep()},i.clearState=function(){this._assertOnLoadCalled&&this._body.clearState()},i.clearForces=function(){this._assertOnLoadCalled&&this._body.clearForces()},i.clearVelocity=function(){this._assertOnLoadCalled&&this._body.clearVelocity()},i.getLinearVelocity=function(t){this._assertOnLoadCalled&&this._body.getLinearVelocity(t)},i.setLinearVelocity=function(t){this._assertOnLoadCalled&&this._body.setLinearVelocity(t)},i.getAngularVelocity=function(t){this._assertOnLoadCalled&&this._body.getAngularVelocity(t)},i.setAngularVelocity=function(t){this._assertOnLoadCalled&&this._body.setAngularVelocity(t)},i.getGroup=function(){return this._assertOnLoadCalled?this._body.getGroup():0},i.setGroup=function(t){this._assertOnLoadCalled&&(this.group=t)},i.addGroup=function(t){this._assertOnLoadCalled&&this._body.addGroup(t)},i.removeGroup=function(t){this._assertOnLoadCalled&&this._body.removeGroup(t)},i.getMask=function(){return this._assertOnLoadCalled?this._body.getMask():0},i.setMask=function(t){this._assertOnLoadCalled&&this._body.setMask(t)},i.addMask=function(t){this._assertOnLoadCalled&&this._body.addMask(t)},i.removeMask=function(t){this._assertOnLoadCalled&&this._body.removeMask(t)},r(e,[{key:"group",get:function(){return this._group},set:function(t){this._group!=t&&(this._group=t,this._body&&this._body.setGroup(t))}},{key:"type",get:function(){return this._type},set:function(t){this._type!=t&&(this._type=t,this._body&&this._body.setType(t))}},{key:"mass",get:function(){return this._mass},set:function(t){this._mass!=t&&(t=t<0?0:t,this._mass=t,this._body&&this._body.setMass(t))}},{key:"allowSleep",get:function(){return this._allowSleep},set:function(t){this._allowSleep=t,this._body&&this._body.setAllowSleep(t)}},{key:"linearDamping",get:function(){return this._linearDamping},set:function(t){this._linearDamping=t,this._body&&this._body.setLinearDamping(t)}},{key:"angularDamping",get:function(){return this._angularDamping},set:function(t){this._angularDamping=t,this._body&&this._body.setAngularDamping(t)}},{key:"useGravity",get:function(){return this._useGravity},set:function(t){this._useGravity=t,this._body&&this._body.useGravity(t)}},{key:"linearFactor",get:function(){return this._linearFactor},set:function(t){Cs.copy(this._linearFactor,t),this._body&&this._body.setLinearFactor(this._linearFactor)}},{key:"angularFactor",get:function(){return this._angularFactor},set:function(t){Cs.copy(this._angularFactor,t),this._body&&this._body.setAngularFactor(this._angularFactor)}},{key:"sleepThreshold",get:function(){return this._assertOnLoadCalled?this._body.getSleepThreshold():0},set:function(t){this._assertOnLoadCalled&&this._body.setSleepThreshold(t)}},{key:"isAwake",get:function(){return!!this._assertOnLoadCalled&&this._body.isAwake}},{key:"isSleepy",get:function(){return!!this._assertOnLoadCalled&&this._body.isSleepy}},{key:"isSleeping",get:function(){return!!this._assertOnLoadCalled&&this._body.isSleeping}},{key:"isStatic",get:function(){return this._type==I6.STATIC},set:function(t){t&&this.isStatic||!t&&!this.isStatic||(this.type=t?I6.STATIC:I6.DYNAMIC)}},{key:"isDynamic",get:function(){return this._type==I6.DYNAMIC},set:function(t){t&&this.isDynamic||!t&&!this.isDynamic||(this.type=t?I6.DYNAMIC:I6.KINEMATIC)}},{key:"isKinematic",get:function(){return this._type==I6.KINEMATIC},set:function(t){t&&this.isKinematic||!t&&!this.isKinematic||(this.type=t?I6.KINEMATIC:I6.DYNAMIC)}},{key:"body",get:function(){return this._body}},{key:"_assertOnLoadCalled",get:function(){var t=0==this._isOnLoadCalled;return t&&S("[Physics]: Please make sure that the node has been added to the scene"),!t}}]),e}(ds),G7.Type=I6,u((M7=H7).prototype,"group",[r7,n7,s7],Object.getOwnPropertyDescriptor(M7.prototype,"group"),M7.prototype),u(M7.prototype,"type",[a7,o7,h7],Object.getOwnPropertyDescriptor(M7.prototype,"type"),M7.prototype),u(M7.prototype,"mass",[l7,u7,c7],Object.getOwnPropertyDescriptor(M7.prototype,"mass"),M7.prototype),u(M7.prototype,"allowSleep",[_7,d7,p7],Object.getOwnPropertyDescriptor(M7.prototype,"allowSleep"),M7.prototype),u(M7.prototype,"linearDamping",[f7,m7,g7],Object.getOwnPropertyDescriptor(M7.prototype,"linearDamping"),M7.prototype),u(M7.prototype,"angularDamping",[v7,y7,T7],Object.getOwnPropertyDescriptor(M7.prototype,"angularDamping"),M7.prototype),u(M7.prototype,"useGravity",[E7,S7,b7],Object.getOwnPropertyDescriptor(M7.prototype,"useGravity"),M7.prototype),u(M7.prototype,"linearFactor",[A7,C7,w7],Object.getOwnPropertyDescriptor(M7.prototype,"linearFactor"),M7.prototype),u(M7.prototype,"angularFactor",[R7,x7,O7],Object.getOwnPropertyDescriptor(M7.prototype,"angularFactor"),M7.prototype),B7=u(M7.prototype,"_group",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return V7.PhysicsGroup.DEFAULT}}),P7=u(M7.prototype,"_type",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return I6.DYNAMIC}}),N7=u(M7.prototype,"_mass",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),L7=u(M7.prototype,"_allowSleep",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),F7=u(M7.prototype,"_linearDamping",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),D7=u(M7.prototype,"_angularDamping",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),U7=u(M7.prototype,"_useGravity",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),k7=u(M7.prototype,"_linearFactor",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cs(1,1,1)}}),z7=u(M7.prototype,"_angularFactor",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cs(1,1,1)}}),I7=M7))||I7)||I7)||I7)||I7)||I7)||I7));c9||(c9=function(e){return t({RigidBody:e,RigidBodyComponent:e}),e}({}));var _9,d9,p9,f9,m9,g9,v9,y9,T9=function(e){return t({Collider:e,ColliderComponent:e}),e}((W7=Ne("cc.Collider"),j7=pi(c9),X7=Je(),Y7=si(),q7=pi(Z6),K7=Je(),Z7=si(),Q7=$e(),J7=si(),$7=$e(),t9=pi(Cs),e9=si(),i9=$e(),r9=pi(Z6),W7((u9=l9=function(t){function e(e){var i;return(i=t.call(this)||this).TYPE=void 0,i._shape=null,i._aabb=null,i._boundingSphere=null,i._isSharedMaterial=!0,i._needTriggerEvent=!1,i._needCollisionEvent=!1,l(i,"_material",a9,a(i)),l(i,"_isTrigger",o9,a(i)),l(i,"_center",h9,a(i)),i.TYPE=e,i}s(e,t),r(e,[{key:"attachedRigidBody",get:function(){return(t=this.node.getComponent(c9))&&t.isValid?t:null;var t}},{key:"sharedMaterial",get:function(){return this._material},set:function(t){this.material=t}},{key:"material",get:function(){return this._isSharedMaterial&&null!=this._material&&(this._material.off("physics_material_update",this._updateMaterial,this),this._material=this._material.clone(),this._material.on("physics_material_update",this._updateMaterial,this),this._isSharedMaterial=!1),this._material},set:function(t){this._shape&&(null!=t&&null!=this._material?this._material._uuid!=t._uuid&&(this._material.off("physics_material_update",this._updateMaterial,this),t.on("physics_material_update",this._updateMaterial,this),this._isSharedMaterial=!1,this._material=t):null!=t&&null==this._material?(t.on("physics_material_update",this._updateMaterial,this),this._material=t):null==t&&null!=this._material&&(this._material.off("physics_material_update",this._updateMaterial,this),this._material=t),this._updateMaterial())}},{key:"isTrigger",get:function(){return this._isTrigger},set:function(t){this._isTrigger=t,this._shape&&this._shape.setAsTrigger(this._isTrigger)}},{key:"center",get:function(){return this._center},set:function(t){Cs.copy(this._center,t),this._shape&&this._shape.setCenter(this._center)}},{key:"shape",get:function(){return this._shape}},{key:"worldBounds",get:function(){return null==this._aabb&&(this._aabb=new y_),this._shape&&this._shape.getAABB(this._aabb),this._aabb}},{key:"boundingSphere",get:function(){return null==this._boundingSphere&&(this._boundingSphere=new Qh),this._shape&&this._shape.getBoundingSphere(this._boundingSphere),this._boundingSphere}},{key:"needTriggerEvent",get:function(){return this._needTriggerEvent}},{key:"needCollisionEvent",get:function(){return this._needCollisionEvent}},{key:"_assertOnLoadCalled",get:function(){var t=0==this._isOnLoadCalled;return t&&S("[Physics]: Please make sure that the node has been added to the scene"),!t}}]);var i=e.prototype;return i.on=function(e,i,r,n){var s=t.prototype.on.call(this,e,i,r,n);return this._updateNeedEvent(e),s},i.off=function(e,i,r){t.prototype.off.call(this,e,i,r),this._updateNeedEvent()},i.once=function(e,i,r){var n=t.prototype.once.call(this,e,i,r);return this._updateNeedEvent(e),n},i.removeAll=function(e){t.prototype.removeAll.call(this,e),this._updateNeedEvent()},i.getGroup=function(){return this._assertOnLoadCalled?this._shape.getGroup():0},i.setGroup=function(t){this._assertOnLoadCalled&&this._shape.setGroup(t)},i.addGroup=function(t){this._assertOnLoadCalled&&this._shape.addGroup(t)},i.removeGroup=function(t){this._assertOnLoadCalled&&this._shape.removeGroup(t)},i.getMask=function(){return this._assertOnLoadCalled?this._shape.getMask():0},i.setMask=function(t){this._assertOnLoadCalled&&this._shape.setMask(t)},i.addMask=function(t){this._assertOnLoadCalled&&this._shape.addMask(t)},i.removeMask=function(t){this._assertOnLoadCalled&&this._shape.removeMask(t)},i.onLoad=function(){this._shape=function(t){return function(){if(!D6.INITED){D6.INITED=!0;var t=_._global.CC_PHYSICS_BUILTIN,e=_._global.CC_PHYSICS_CANNON,i=_._global.CC_PHYSICS_AMMO;D6[P6.BOX]=function(t){return new x6.BoxShape(t)},D6[P6.SPHERE]=function(t){return new x6.SphereShape(t)},D6[P6.CAPSULE]=function(e,r,n){return void 0===e&&(e=.5),void 0===r&&(r=2),void 0===n&&(n=1),t||i?new x6.CapsuleShape(e,r,n):(I(9610),k6)},D6[P6.CYLINDER]=function(t,r,n){return void 0===t&&(t=.5),void 0===r&&(r=2),void 0===n&&(n=1),e||i?new x6.CylinderShape(t,r,n):(I(9612),k6)},D6[P6.CONE]=function(t,r,n){return void 0===t&&(t=.5),void 0===r&&(r=1),void 0===n&&(n=1),e||i?new x6.ConeShape(t,r,n):(I(9612),k6)},D6[P6.MESH]=function(){return e||i?new x6.TrimeshShape:(I(9611),k6)},D6[P6.TERRAIN]=function(){return e||i?new x6.TerrainShape:(E("[Physics]: builtin physics system doesn't support cylinder collider"),k6)},D6[P6.SIMPLEX]=function(){return e||i?new x6.SimplexShape:(E("[Physics]: builtin physics system doesn't support simple collider"),k6)},D6[P6.PLANE]=function(){return e||i?new x6.PlaneShape:(E("[Physics]: builtin physics system doesn't support plane collider"),k6)}}}(),D6[t]()}(this.TYPE),this._shape.initialize(this),this.sharedMaterial=null==this._material?V7.instance.defaultMaterial:this._material,this._shape.onLoad()},i.onEnable=function(){this._shape&&this._shape.onEnable()},i.onDisable=function(){this._shape&&this._shape.onDisable()},i.onDestroy=function(){this._shape&&(this._material&&this._material.off("physics_material_update",this._updateMaterial,this),this._shape.onDestroy()),this._boundingSphere&&this._boundingSphere.destroy()},i._updateMaterial=function(){this._shape&&this._shape.setMaterial(this._material)},i._updateNeedEvent=function(t){this.isValid&&(void 0!==t?("onCollisionEnter"!=t&&"onCollisionStay"!=t&&"onCollisionExit"!=t||(this._needCollisionEvent=!0),"onTriggerEnter"!=t&&"onTriggerStay"!=t&&"onTriggerExit"!=t||(this._needTriggerEvent=!0)):(this.hasEventListener("onTriggerEnter")||this.hasEventListener("onTriggerStay")||this.hasEventListener("onTriggerExit")||(this._needTriggerEvent=!1),this.hasEventListener("onCollisionEnter")||this.hasEventListener("onCollisionStay")||this.hasEventListener("onCollisionExit")||(this._needCollisionEvent=!1)))},e}(ir(ds)),l9.Type=P6,l9.Axis=M6,u((s9=u9).prototype,"attachedRigidBody",[j7,Qe,X7,Y7],Object.getOwnPropertyDescriptor(s9.prototype,"attachedRigidBody"),s9.prototype),u(s9.prototype,"sharedMaterial",[q7,K7,Z7,Q7],Object.getOwnPropertyDescriptor(s9.prototype,"sharedMaterial"),s9.prototype),u(s9.prototype,"isTrigger",[J7,$7],Object.getOwnPropertyDescriptor(s9.prototype,"isTrigger"),s9.prototype),u(s9.prototype,"center",[t9,e9,i9],Object.getOwnPropertyDescriptor(s9.prototype,"center"),s9.prototype),a9=u(s9.prototype,"_material",[r9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),o9=u(s9.prototype,"_isTrigger",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),h9=u(s9.prototype,"_center",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cs}}),n9=s9))||n9));T9||(T9=function(e){return t({Collider:e,ColliderComponent:e}),e}({}));var E9,S9,b9,A9,C9,w9,R9,x9,O9,I9,M9,B9,P9,N9,L9,F9,D9,U9,k9,z9,G9,H9,V9,W9,j9,X9,Y9,q9,K9,Z9,Q9,J9,$9,ttt,ett,itt,rtt,ntt,stt,att,ott,htt,ltt,utt,ctt,_tt,dtt,ptt,ftt,mtt,gtt,vtt,ytt,Ttt,Ett,Stt,btt,Att,Ctt,wtt,Rtt,xtt,Ott,Itt,Mtt,Btt,Ptt,Ntt,Ltt,Ftt,Dtt,Utt,ktt,ztt,Gtt,Htt,Vtt,Wtt,jtt,Xtt,Ytt,qtt,Ktt,Ztt,Qtt,Jtt,$tt,tet,eet,iet,ret,net,set,aet,oet,het,uet,cet,_et=function(e){return t({BoxCollider:e,BoxColliderComponent:e}),e}((_9=Ne("cc.BoxCollider"),d9=qe(),p9=We(),f9=pi(Cs),m9=$e(),_9(g9=d9(g9=p9(g9=Ve((u((v9=function(t){function e(){var e;return l(e=t.call(this,P6.BOX)||this,"_size",y9,a(e)),e}return s(e,t),r(e,[{key:"size",get:function(){return this._size},set:function(t){Cs.copy(this._size,t),this._shape&&this.shape.setSize(this._size)}},{key:"shape",get:function(){return this._shape}}]),e}(T9)).prototype,"size",[f9,m9],Object.getOwnPropertyDescriptor(v9.prototype,"size"),v9.prototype),y9=u(v9.prototype,"_size",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cs(1,1,1)}}),g9=v9))||g9)||g9)||g9)||g9)),det=function(e){return t({SphereCollider:e,SphereColliderComponent:e}),e}((E9=Ne("cc.SphereCollider"),S9=qe(),b9=We(),A9=$e(),E9(C9=S9(C9=b9(C9=Ve((u((w9=function(t){function e(){var e;return l(e=t.call(this,P6.SPHERE)||this,"_radius",R9,a(e)),e}return s(e,t),r(e,[{key:"radius",get:function(){return this._radius},set:function(t){this._radius=t,this.shape.setRadius(this._radius)}},{key:"shape",get:function(){return this._shape}}]),e}(T9)).prototype,"radius",[A9],Object.getOwnPropertyDescriptor(w9.prototype,"radius"),w9.prototype),R9=u(w9.prototype,"_radius",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),C9=w9))||C9)||C9)||C9)||C9)),pet=function(e){return t({CapsuleCollider:e,CapsuleColliderComponent:e}),e}((x9=Ne("cc.CapsuleCollider"),O9=qe(),I9=We(),M9=$e(),B9=$e(),P9=pi(M6),N9=$e(),x9(L9=O9(L9=I9(L9=Ve((u((F9=function(t){function e(){var e;return l(e=t.call(this,P6.CAPSULE)||this,"_radius",D9,a(e)),l(e,"_cylinderHeight",U9,a(e)),l(e,"_direction",k9,a(e)),e}s(e,t),r(e,[{key:"radius",get:function(){return this._radius},set:function(t){t<0&&(t=0),this._radius=t,this.shape.setRadius(t)}},{key:"cylinderHeight",get:function(){return this._cylinderHeight},set:function(t){t<0&&(t=0),this._cylinderHeight=t,this.shape.setCylinderHeight(t)}},{key:"direction",get:function(){return this._direction},set:function(t){(t=Math.floor(t))<M6.X_AXIS||t>M6.Z_AXIS||(this._direction=t,this.shape.setDirection(t))}},{key:"height",get:function(){return 2*this._radius+this._cylinderHeight},set:function(t){var e=t-2*this._radius;e<0&&(e=0),this.cylinderHeight=e}},{key:"worldHeight",get:function(){return 2*this._radius*this._getRadiusScale()+this._cylinderHeight*this._getHeightScale()}},{key:"shape",get:function(){return this._shape}}]);var i=e.prototype;return i._getRadiusScale=function(){if(null==this.node)return 1;var t=this.node.worldScale;return this._direction==M6.Y_AXIS?Math.abs(Xr(t.x,t.z)):this._direction==M6.X_AXIS?Math.abs(Xr(t.y,t.z)):Math.abs(Xr(t.x,t.y))},i._getHeightScale=function(){if(null==this.node)return 1;var t=this.node.worldScale;return this._direction==M6.Y_AXIS?Math.abs(t.y):this._direction==M6.X_AXIS?Math.abs(t.x):Math.abs(t.z)},e}(T9)).prototype,"radius",[M9],Object.getOwnPropertyDescriptor(F9.prototype,"radius"),F9.prototype),u(F9.prototype,"cylinderHeight",[B9],Object.getOwnPropertyDescriptor(F9.prototype,"cylinderHeight"),F9.prototype),u(F9.prototype,"direction",[P9,N9],Object.getOwnPropertyDescriptor(F9.prototype,"direction"),F9.prototype),D9=u(F9.prototype,"_radius",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),U9=u(F9.prototype,"_cylinderHeight",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),k9=u(F9.prototype,"_direction",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return M6.Y_AXIS}}),L9=F9))||L9)||L9)||L9)||L9)),fet=function(e){return t({CylinderCollider:e,CylinderColliderComponent:e}),e}((z9=Ne("cc.CylinderCollider"),G9=qe(),H9=We(),V9=$e(),W9=$e(),j9=pi(M6),z9(X9=G9(X9=H9(X9=Ve((u((Y9=function(t){function e(){var e;return l(e=t.call(this,P6.CYLINDER)||this,"_radius",q9,a(e)),l(e,"_height",K9,a(e)),l(e,"_direction",Z9,a(e)),e}return s(e,t),r(e,[{key:"radius",get:function(){return this._radius},set:function(t){this._radius!=t&&(t<0&&(t=0),this._radius=t,this.shape.setRadius(t))}},{key:"height",get:function(){return this._height},set:function(t){this._height!=t&&(t<0&&(t=0),this._height=t,this.shape.setHeight(t))}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!=t&&(t<M6.X_AXIS||t>M6.Z_AXIS||(this._direction=t,this.shape.setDirection(t)))}},{key:"shape",get:function(){return this._shape}}]),e}(T9)).prototype,"radius",[V9],Object.getOwnPropertyDescriptor(Y9.prototype,"radius"),Y9.prototype),u(Y9.prototype,"height",[W9],Object.getOwnPropertyDescriptor(Y9.prototype,"height"),Y9.prototype),u(Y9.prototype,"direction",[j9],Object.getOwnPropertyDescriptor(Y9.prototype,"direction"),Y9.prototype),q9=u(Y9.prototype,"_radius",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),K9=u(Y9.prototype,"_height",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),Z9=u(Y9.prototype,"_direction",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return M6.Y_AXIS}}),X9=Y9))||X9)||X9)||X9)||X9)),met=(t("ConeCollider",(Q9=Ne("cc.ConeCollider"),J9=qe(),$9=We(),ttt=$e(),ett=$e(),itt=pi(M6),Q9(rtt=J9(rtt=$9(rtt=Ve((u((ntt=function(t){function e(){var e;return l(e=t.call(this,P6.CONE)||this,"_radius",stt,a(e)),l(e,"_height",att,a(e)),l(e,"_direction",ott,a(e)),e}return s(e,t),r(e,[{key:"radius",get:function(){return this._radius},set:function(t){this._radius!=t&&(t<0&&(t=0),this._radius=t,this.shape.setRadius(t))}},{key:"height",get:function(){return this._height},set:function(t){this._height!=t&&(t<0&&(t=0),this._height=t,this.shape.setHeight(t))}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!=t&&(t<M6.X_AXIS||t>M6.Z_AXIS||(this._direction=t,this.shape.setDirection(t)))}},{key:"shape",get:function(){return this._shape}}]),e}(T9)).prototype,"radius",[ttt],Object.getOwnPropertyDescriptor(ntt.prototype,"radius"),ntt.prototype),u(ntt.prototype,"height",[ett],Object.getOwnPropertyDescriptor(ntt.prototype,"height"),ntt.prototype),u(ntt.prototype,"direction",[itt],Object.getOwnPropertyDescriptor(ntt.prototype,"direction"),ntt.prototype),stt=u(ntt.prototype,"_radius",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),att=u(ntt.prototype,"_height",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ott=u(ntt.prototype,"_direction",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return M6.Y_AXIS}}),rtt=ntt))||rtt)||rtt)||rtt)||rtt)),function(e){return t({MeshCollider:e,MeshColliderComponent:e}),e}((htt=Ne("cc.MeshCollider"),ltt=qe(),utt=We(),ctt=pi(Bf),htt(_tt=ltt(_tt=utt(_tt=Ve((u((dtt=function(t){function e(){var e;return l(e=t.call(this,P6.MESH)||this,"_mesh",ptt,a(e)),l(e,"_convex",ftt,a(e)),e}return s(e,t),r(e,[{key:"mesh",get:function(){return this._mesh},set:function(t){this._mesh=t,this.shape.setMesh(this._mesh)}},{key:"convex",get:function(){return this._convex},set:function(t){this._convex=t}},{key:"shape",get:function(){return this._shape}}]),e}(T9)).prototype,"mesh",[ctt],Object.getOwnPropertyDescriptor(dtt.prototype,"mesh"),dtt.prototype),u(dtt.prototype,"convex",[Ke],Object.getOwnPropertyDescriptor(dtt.prototype,"convex"),dtt.prototype),ptt=u(dtt.prototype,"_mesh",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ftt=u(dtt.prototype,"_convex",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_tt=dtt))||_tt)||_tt)||_tt)||_tt))),get=t("ConstantForce",(mtt=Ne("cc.ConstantForce"),gtt=qe(),vtt=Le(c9),ytt=We(),Ttt=si(),Ett=$e(),Stt=si(),btt=$e(),Att=si(),Ctt=$e(),wtt=si(),Rtt=$e(),mtt(xtt=gtt(xtt=vtt(xtt=ytt(xtt=De(xtt=Ve((Ntt=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._rigidBody=null,l(e,"_force",Itt,a(e)),l(e,"_localForce",Mtt,a(e)),l(e,"_torque",Btt,a(e)),l(e,"_localTorque",Ptt,a(e)),e._mask=0,e}s(e,t);var i=e.prototype;return i.onLoad=function(){this._rigidBody=this.node.getComponent(c9),this._maskUpdate(this._force,1),this._maskUpdate(this._localForce,2),this._maskUpdate(this._torque,4),this._maskUpdate(this._localTorque,8)},i.lateUpdate=function(){null!=this._rigidBody&&0!=this._mask&&(1&this._mask&&this._rigidBody.applyForce(this._force),2&this._mask&&this._rigidBody.applyLocalForce(this.localForce),4&this._mask&&this._rigidBody.applyTorque(this._torque),8&this._mask&&this._rigidBody.applyLocalTorque(this._localTorque))},i._maskUpdate=function(t,e){t.strictEquals(Cs.ZERO)?this._mask&=~e:this._mask|=e},r(e,[{key:"force",get:function(){return this._force},set:function(t){Cs.copy(this._force,t),this._maskUpdate(this._force,1)}},{key:"localForce",get:function(){return this._localForce},set:function(t){Cs.copy(this._localForce,t),this._maskUpdate(this.localForce,2)}},{key:"torque",get:function(){return this._torque},set:function(t){Cs.copy(this._torque,t),this._maskUpdate(this._torque,4)}},{key:"localTorque",get:function(){return this._localTorque},set:function(t){Cs.copy(this._localTorque,t),this._maskUpdate(this._localTorque,8)}}]),e}(ds),Itt=u((Ott=Ntt).prototype,"_force",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cs}}),Mtt=u(Ott.prototype,"_localForce",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cs}}),Btt=u(Ott.prototype,"_torque",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cs}}),Ptt=u(Ott.prototype,"_localTorque",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cs}}),u(Ott.prototype,"force",[Ttt,Ett],Object.getOwnPropertyDescriptor(Ott.prototype,"force"),Ott.prototype),u(Ott.prototype,"localForce",[Stt,btt],Object.getOwnPropertyDescriptor(Ott.prototype,"localForce"),Ott.prototype),u(Ott.prototype,"torque",[Att,Ctt],Object.getOwnPropertyDescriptor(Ott.prototype,"torque"),Ott.prototype),u(Ott.prototype,"localTorque",[wtt,Rtt],Object.getOwnPropertyDescriptor(Ott.prototype,"localTorque"),Ott.prototype),xtt=Ott))||xtt)||xtt)||xtt)||xtt)||xtt)||xtt)),vet=function(){function t(){this.length=0,this.buffer=new Uint8Array(2048),this._buffView=new DataView(this.buffer.buffer),this._seekPos=0}var e=t.prototype;return e.reserve=function(t){if(!(this.buffer.byteLength>t)){for(var e=this.buffer.byteLength;e<t;)e+=e;for(var i=new Uint8Array(e),r=0;r<this.length;++r)i[r]=this.buffer[r];this.buffer=i,this._buffView=new DataView(this.buffer.buffer)}},e.assign=function(t){this.buffer=t,this.length=t.length,this._seekPos=t.byteOffset,this._buffView=new DataView(t.buffer)},e.writeInt8=function(t){this.reserve(this.length+1),this._buffView.setInt8(this.length,t),this.length+=1},e.writeInt16=function(t){this.reserve(this.length+2),this._buffView.setInt16(this.length,t,!0),this.length+=2},e.writeInt32=function(t){this.reserve(this.length+4),this._buffView.setInt32(this.length,t,!0),this.length+=4},e.writeIntArray=function(t){this.reserve(this.length+4*t.length);for(var e=0;e<t.length;++e)this._buffView.setInt32(this.length+4*e,t[e],!0);this.length+=4*t.length},e.writeFloat=function(t){this.reserve(this.length+4),this._buffView.setFloat32(this.length,t,!0),this.length+=4},e.writeFloatArray=function(t){this.reserve(this.length+4*t.length);for(var e=0;e<t.length;++e)this._buffView.setFloat32(this.length+4*e,t[e],!0);this.length+=4*t.length},e.writeString=function(t){this.reserve(this.length+t.length+4),this._buffView.setInt32(this.length,t.length,!0);for(var e=0;e<t.length;++e)this._buffView.setInt8(this.length+4+e,t.charCodeAt(e));this.length+=t.length+4},e.readInt8=function(){var t=this._buffView.getInt8(this._seekPos);return this._seekPos+=1,t},e.readInt16=function(){var t=this._buffView.getInt16(this._seekPos,!0);return this._seekPos+=2,t},e.readInt=function(){var t=this._buffView.getInt32(this._seekPos,!0);return this._seekPos+=4,t},e.readIntArray=function(t){for(var e=0;e<t.length;++e)t[e]=this._buffView.getInt32(this._seekPos+4*e,!0);return this._seekPos+=4*t.length,t},e.readFloat=function(){var t=this._buffView.getFloat32(this._seekPos,!0);return this._seekPos+=4,t},e.readFloatArray=function(t){for(var e=0;e<t.length;++e)t[e]=this._buffView.getFloat32(this._seekPos+4*e,!0);return this._seekPos+=4*t.length,t},e.readString=function(){for(var t=this.readInt(),e="",i=0;i<t;++i)e+=String.fromCharCode(this.readInt8());return e},t}(),yet=function(){this.slot=0,this.tileSize=1,this.detailMap="",this.normalMap="",this.roughness=1,this.metallic=0},Tet=Ne("cc.TerrainAsset")(Ltt=function(t){function e(){var e;return(e=t.call(this)||this)._data=null,e._tileSize=1,e._blockCount=[1,1],e._weightMapSize=128,e._lightMapSize=128,e._heights=new Uint16Array,e._weights=new Uint8Array,e._layerBuffer=[-1,-1,-1,-1],e._layerInfos=[],e.loaded=!1,e}s(e,t);var i=e.prototype;return i.getLayer=function(t,e,i){var r=4*(e*this.blockCount[0]+t)+i;return t<this.blockCount[0]&&e<this.blockCount[1]&&r<this._layerBuffer.length?this._layerBuffer[r]:-1},i.getHeight=function(t,e){var i=32*this._blockCount[0]+1;return(this._heights[e*i+t]-32768)*(1/512)},i.getVertexCountI=function(){return this._blockCount.length<1?0:32*this._blockCount[0]+1},i.getVertexCountJ=function(){return this._blockCount.length<2?0:32*this._blockCount[1]+1},i._setNativeData=function(t){this._data=t},i._loadNativeData=function(t){var e=new vet;e.assign(t);var i=e.readInt();if(16843025===i)return!0;if(16842753!==i&&16842754!==i&&16842755!==i&&16842756!==i)return!1;this.tileSize=e.readFloat(),e.readIntArray(this._blockCount),this.weightMapSize=e.readInt16(),this.lightMapSize=e.readInt16();var r=e.readInt();this.heights=new Uint16Array(r);for(var n=0;n<this.heights.length;++n)this.heights[n]=e.readInt16();var s=e.readInt();this.weights=new Uint8Array(s);for(var a=0;a<this.weights.length;++a)this.weights[a]=e.readInt8();if(i>=16842754){var o=e.readInt();this.layerBuffer=new Array(o);for(var h=0;h<this.layerBuffer.length;++h)this.layerBuffer[h]=e.readInt16()}if(i>=16842755){var l=e.readInt();this.layerInfos=new Array(l);for(var u=0;u<this.layerInfos.length;++u)this.layerInfos[u]=new yet,this.layerInfos[u].slot=e.readInt(),this.layerInfos[u].tileSize=e.readFloat(),this.layerInfos[u].detailMap=e.readString(),i>=16842756&&(this.layerInfos[u].normalMap=e.readString(),this.layerInfos[u].roughness=e.readFloat(),this.layerInfos[u].metallic=e.readFloat())}return!0},i._exportNativeData=function(){var t=new vet;t.writeInt32(16842756),t.writeFloat(this.tileSize),t.writeIntArray(this._blockCount),t.writeInt16(this.weightMapSize),t.writeInt16(this.lightMapSize),t.writeInt32(this.heights.length);for(var e=0;e<this.heights.length;++e)t.writeInt16(this.heights[e]);t.writeInt32(this.weights.length);for(var i=0;i<this.weights.length;++i)t.writeInt8(this.weights[i]);t.writeInt32(this.layerBuffer.length);for(var r=0;r<this.layerBuffer.length;++r)t.writeInt16(this.layerBuffer[r]);t.writeInt32(this.layerInfos.length);for(var n=0;n<this.layerInfos.length;++n)t.writeInt32(this.layerInfos[n].slot),t.writeFloat(this.layerInfos[n].tileSize),t.writeString(this.layerInfos[n].detailMap),t.writeString(this.layerInfos[n].normalMap),t.writeFloat(this.layerInfos[n].roughness),t.writeFloat(this.layerInfos[n].metallic);return t.buffer},i._exportDefaultNativeData=function(){var t=new vet;return t.writeInt32(16843025),t.buffer},r(e,[{key:"_nativeAsset",get:function(){return this._data.buffer},set:function(t){this._data&&this._data.byteLength===t.byteLength?this._data.set(new Uint8Array(t)):this._data=new Uint8Array(t),this._loadNativeData(this._data),this.loaded=!0,this.emit("load")}},{key:"tileSize",set:function(t){this._tileSize=t},get:function(){return this._tileSize}},{key:"blockCount",set:function(t){this._blockCount=t},get:function(){return this._blockCount}},{key:"lightMapSize",set:function(t){this._lightMapSize=t},get:function(){return this._lightMapSize}},{key:"weightMapSize",set:function(t){this._weightMapSize=t},get:function(){return this._weightMapSize}},{key:"heights",set:function(t){this._heights=t},get:function(){return this._heights}},{key:"weights",set:function(t){this._weights=t},get:function(){return this._weights}},{key:"layerBuffer",set:function(t){this._layerBuffer=t},get:function(){return this._layerBuffer}},{key:"layerInfos",set:function(t){this._layerInfos=t},get:function(){return this._layerInfos}}]),e}(Sr))||Ltt,Eet=(t("TerrainCollider",(Ftt=Ne("cc.TerrainCollider"),Dtt=qe(),Utt=We(),ktt=pi(Tet),Ftt(ztt=Dtt(ztt=Utt(ztt=Ve((u((Gtt=function(t){function e(){var e;return l(e=t.call(this,P6.TERRAIN)||this,"_terrain",Htt,a(e)),e}return s(e,t),r(e,[{key:"terrain",get:function(){return this._terrain},set:function(t){this._terrain=t,this.shape.setTerrain(this._terrain)}},{key:"shape",get:function(){return this._shape}}]),e}(T9)).prototype,"terrain",[ktt],Object.getOwnPropertyDescriptor(Gtt.prototype,"terrain"),Gtt.prototype),Htt=u(Gtt.prototype,"_terrain",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ztt=Gtt))||ztt)||ztt)||ztt)||ztt)),t("SimplexCollider",(Vtt=Ne("cc.SimplexCollider"),Wtt=qe(),jtt=We(),Xtt=pi(B6),Ytt=Ze(),qtt=Ze(),Ktt=Ze(),Vtt(Ztt=Wtt(Ztt=jtt(Ztt=Ve((eet=tet=function(t){function e(){var e;return l(e=t.call(this,P6.SIMPLEX)||this,"_shapeType",Jtt,a(e)),l(e,"_vertices",$tt,a(e)),e}return s(e,t),r(e,[{key:"shapeType",get:function(){return this._shapeType},set:function(t){this._shapeType=t,this.shape.setShapeType(t)}},{key:"vertex0",get:function(){return this._vertices[0]},set:function(t){Cs.copy(this._vertices[0],t),this.updateVertices()}},{key:"vertex1",get:function(){return this._vertices[1]},set:function(t){Cs.copy(this._vertices[1],t),this.updateVertices()}},{key:"vertex2",get:function(){return this._vertices[2]},set:function(t){Cs.copy(this._vertices[2],t),this.updateVertices()}},{key:"vertex3",get:function(){return this._vertices[3]},set:function(t){Cs.copy(this._vertices[3],t),this.updateVertices()}},{key:"shape",get:function(){return this._shape}},{key:"vertices",get:function(){return this._vertices}}]),e.prototype.updateVertices=function(){this.shape.setVertices(this._vertices)},e}(T9),tet.ESimplexType=B6,u((Qtt=eet).prototype,"shapeType",[Xtt],Object.getOwnPropertyDescriptor(Qtt.prototype,"shapeType"),Qtt.prototype),u(Qtt.prototype,"vertex0",[Ke],Object.getOwnPropertyDescriptor(Qtt.prototype,"vertex0"),Qtt.prototype),u(Qtt.prototype,"vertex1",[Ytt],Object.getOwnPropertyDescriptor(Qtt.prototype,"vertex1"),Qtt.prototype),u(Qtt.prototype,"vertex2",[qtt],Object.getOwnPropertyDescriptor(Qtt.prototype,"vertex2"),Qtt.prototype),u(Qtt.prototype,"vertex3",[Ktt],Object.getOwnPropertyDescriptor(Qtt.prototype,"vertex3"),Qtt.prototype),Jtt=u(Qtt.prototype,"_shapeType",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return B6.TETRAHEDRON}}),$tt=u(Qtt.prototype,"_vertices",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[new Cs(0,0,0),new Cs(0,0,1),new Cs(1,0,0),new Cs(0,1,0)]}}),Ztt=Qtt))||Ztt)||Ztt)||Ztt)||Ztt)));Eet||(Eet=t("SimplexCollider",{})),t("PlaneCollider",(iet=Ne("cc.PlaneCollider"),ret=qe(),net=We(),set=pi(Cs),aet=$e(),iet(oet=ret(oet=net(oet=Ve((u((het=function(t){function e(){var e;return l(e=t.call(this,P6.PLANE)||this,"_normal",uet,a(e)),l(e,"_constant",cet,a(e)),e}return s(e,t),r(e,[{key:"normal",get:function(){return this._normal},set:function(t){Cs.copy(this._normal,t),this.shape.setNormal(this._normal)}},{key:"constant",get:function(){return this._constant},set:function(t){this._constant=t,this.shape.setConstant(this._constant)}},{key:"shape",get:function(){return this._shape}}]),e}(T9)).prototype,"normal",[set,aet],Object.getOwnPropertyDescriptor(het.prototype,"normal"),het.prototype),u(het.prototype,"constant",[Ke],Object.getOwnPropertyDescriptor(het.prototype,"constant"),het.prototype),uet=u(het.prototype,"_normal",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cs(0,1,0)}}),cet=u(het.prototype,"_constant",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),oet=het))||oet)||oet)||oet)||oet));var bet,Aet,Cet,wet,Ret,xet,Oet,Iet,Met,Bet,Pet,Net,Let,Fet,Det,Uet,ket,zet,Get,Het,Vet,Wet,jet,Xet,Yet,qet,Ket,Zet,Qet,Jet,$et=t("Constraint",(bet=Ne("cc.Constraint"),Aet=Le(c9),Cet=pi(c9),wet=si(),Ret=pi(c9),xet=si(),Oet=si(),Iet=pi(c9),bet(Met=Aet((Fet=Let=function(t){function e(e){var i;return(i=t.call(this)||this).TYPE=void 0,l(i,"_enableCollision",Pet,a(i)),l(i,"_connectedBody",Net,a(i)),i._constraint=null,i.TYPE=e,i}s(e,t),r(e,[{key:"attachedBody",get:function(){return this.getComponent(c9)}},{key:"connectedBody",get:function(){return this._connectedBody},set:function(t){this._connectedBody=t,this._constraint&&this._constraint.setConnectedBody(t)}},{key:"enableCollision",get:function(){return this._enableCollision},set:function(t){this._enableCollision=t,this._constraint&&this._constraint.setEnableCollision(t)}}]);var i=e.prototype;return i.onLoad=function(){this._constraint=function(t){return function(){if(!q6.INITED){q6.INITED=!0,_._global.CC_PHYSICS_BUILTIN;var t=_._global.CC_PHYSICS_CANNON,e=_._global.CC_PHYSICS_AMMO;q6[N6.POINT_TO_POINT]=function(){return t||e?new x6.PointToPointConstraint:(E("[Physics]: builtin physics system doesn't support point to point constraint"),K6)},q6[N6.HINGE]=function(){return t||e?new x6.HingeConstraint:(E("[Physics]: builtin physics system doesn't support hinge constraint"),K6)},q6[N6.CONE_TWIST]=function(){return t||e?new x6.ConeTwistConstraint:(E("[Physics]: builtin physics system doesn't support cone twist constraint"),K6)}}}(),q6[t]()}(this.TYPE),this._constraint.initialize(this),this._constraint.onLoad()},i.onEnable=function(){this._constraint&&this._constraint.onEnable()},i.onDisable=function(){this._constraint&&this._constraint.onDisable()},i.onDestroy=function(){this._constraint&&this._constraint.onDestroy()},e}(ir(ds)),Let.EConstraintType=N6,u((Bet=Fet).prototype,"attachedBody",[Cet,Qe,wet],Object.getOwnPropertyDescriptor(Bet.prototype,"attachedBody"),Bet.prototype),u(Bet.prototype,"connectedBody",[Ret,xet],Object.getOwnPropertyDescriptor(Bet.prototype,"connectedBody"),Bet.prototype),u(Bet.prototype,"enableCollision",[Oet],Object.getOwnPropertyDescriptor(Bet.prototype,"enableCollision"),Bet.prototype),Pet=u(Bet.prototype,"_enableCollision",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Net=u(Bet.prototype,"_connectedBody",[Iet],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Met=Bet))||Met)||Met));$et||($et=t("Constraint",{})),t("HingeConstraint",Ne("cc.HingeConstraint")(Det=qe()(Det=We()((Vet=function(t){function e(){var e;return l(e=t.call(this,N6.HINGE)||this,"axisA",ket,a(e)),l(e,"axisB",zet,a(e)),l(e,"pivotA",Get,a(e)),l(e,"pivotB",Het,a(e)),e}return s(e,t),e}($et),ket=u((Uet=Vet).prototype,"axisA",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cs}}),zet=u(Uet.prototype,"axisB",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cs}}),Get=u(Uet.prototype,"pivotA",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cs}}),Het=u(Uet.prototype,"pivotB",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cs}}),Det=Uet))||Det)||Det)||Det),t("PointToPointConstraint",(Wet=Ne("cc.PointToPointConstraint"),jet=qe(),Xet=We(),Yet=pi(Cs),qet=pi(Cs),Wet(Ket=jet(Ket=Xet((u((Zet=function(t){function e(){var e;return l(e=t.call(this,N6.POINT_TO_POINT)||this,"_pivotA",Qet,a(e)),l(e,"_pivotB",Jet,a(e)),e}return s(e,t),r(e,[{key:"pivotA",get:function(){return this._pivotA},set:function(t){Cs.copy(this._pivotA,t),this.constraint.setPivotA(this._pivotA)}},{key:"pivotB",get:function(){return this._pivotB},set:function(t){Cs.copy(this._pivotB,t),this.constraint.setPivotB(this._pivotB)}},{key:"constraint",get:function(){return this._constraint}}]),e}($et)).prototype,"pivotA",[Yet],Object.getOwnPropertyDescriptor(Zet.prototype,"pivotA"),Zet.prototype),u(Zet.prototype,"pivotB",[qet],Object.getOwnPropertyDescriptor(Zet.prototype,"pivotB"),Zet.prototype),Qet=u(Zet.prototype,"_pivotA",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cs}}),Jet=u(Zet.prototype,"_pivotB",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cs}}),Ket=Zet))||Ket)||Ket)||Ket)),$s(V7,"PhysicsSystem",[{name:"ins",newName:"instance"}]),$s(V7.prototype,"PhysicsSystem.prototype",[{name:"deltaTime",newName:"fixedTimeStep"},{name:"maxSubStep",newName:"maxSubSteps"}]),ta(V7.prototype,"PhysicsSystem.prototype",[{name:"useFixedTime"},{name:"useCollisionMatrix"},{name:"updateCollisionMatrix"},{name:"resetCollisionMatrix"},{name:"isCollisionGroup"},{name:"setCollisionGroup"}]),$s(T9.prototype,"Collider.prototype",[{name:"attachedRigidbody",newName:"attachedRigidBody"}]),$s(T9,"Collider",[{name:"EColliderType",newName:"Type"},{name:"EAxisDirection",newName:"Axis"}]),$s(_et.prototype,"BoxCollider.prototype",[{name:"boxShape",newName:"shape"}]),$s(det.prototype,"SphereCollider.prototype",[{name:"sphereShape",newName:"shape"}]),$s(pet.prototype,"CapsuleCollider.prototype",[{name:"capsuleShape",newName:"shape"}]),$s(c9.prototype,"RigidBody.prototype",[{name:"rigidBody",newName:"body"}]),$s(c9,"RigidBody",[{name:"ERigidBodyType",newName:"Type"}]),ta(c9.prototype,"RigidBody.prototype",[{name:"fixedRotation"}]),_.RigidBodyComponent=c9,Mt.setClassAlias(c9,"cc.RigidBodyComponent"),_.ColliderComponent=T9,Mt.setClassAlias(T9,"cc.ColliderComponent"),_.BoxColliderComponent=_et,Mt.setClassAlias(_et,"cc.BoxColliderComponent"),_.SphereColliderComponent=det,Mt.setClassAlias(det,"cc.SphereColliderComponent"),Mt.setClassAlias(pet,"cc.CapsuleColliderComponent"),Mt.setClassAlias(met,"cc.MeshColliderComponent"),Mt.setClassAlias(fet,"cc.CylinderColliderComponent"),_.PhysicMaterial=Z6,Mt.setClassAlias(Z6,"cc.PhysicMaterial"),_.PhysicsSystem=V7,_.PhysicsMaterial=Z6,_.PhysicsRayResult=Q6,_.ConstantForce=get;var tit=new F6.Vec3,eit=new F6.Vec3,iit=function(){function t(){this._isEnabled=!1}var e=t.prototype;return e.setAllowSleep=function(t){this.impl.allowSleep=t,this._wakeUpIfSleep()},e.setMass=function(t){this.impl.mass=t,this.impl.updateMassProperties(),this._wakeUpIfSleep()},e.setType=function(t){switch(t){case I6.DYNAMIC:this.impl.type=F6.Body.DYNAMIC,this.impl.updateMassProperties(),this._wakeUpIfSleep();break;case I6.KINEMATIC:this.impl.type=F6.Body.KINEMATIC;break;case I6.STATIC:default:this.impl.type=F6.Body.STATIC}},e.setLinearDamping=function(t){this.impl.linearDamping=t},e.setAngularDamping=function(t){this.impl.angularDamping=t},e.useGravity=function(t){this.impl.useGravity=t,this._wakeUpIfSleep()},e.setLinearFactor=function(t){Cs.copy(this.impl.linearFactor,t),this._wakeUpIfSleep()},e.setAngularFactor=function(t){Cs.copy(this.impl.angularFactor,t);var e=Cs.equals(this.impl.angularFactor,Cs.ZERO);e!=this.impl.fixedRotation&&(this.impl.fixedRotation=e,this.impl.updateMassProperties()),this._wakeUpIfSleep()},e.initialize=function(t){this._rigidBody=t,this._sharedBody=V7.instance.physicsWorld.getSharedBody(this._rigidBody.node,this),this._sharedBody.reference=!0,this._sharedBody.wrappedBody=this},e.onLoad=function(){},e.onEnable=function(){this._isEnabled=!0,this.setMass(this._rigidBody.mass),this.setType(this._rigidBody.type),this.setAllowSleep(this._rigidBody.allowSleep),this.setLinearDamping(this._rigidBody.linearDamping),this.setAngularDamping(this._rigidBody.angularDamping),this.useGravity(this._rigidBody.useGravity),this.setLinearFactor(this._rigidBody.linearFactor),this.setAngularFactor(this._rigidBody.angularFactor),this._sharedBody.enabled=!0},e.onDisable=function(){this._isEnabled=!1,this._sharedBody.enabled=!1},e.onDestroy=function(){this._sharedBody.reference=!1,this._rigidBody=null,this._sharedBody=null},e.clearVelocity=function(){this.impl.velocity.setZero(),this.impl.angularVelocity.setZero()},e.clearForces=function(){this.impl.force.setZero(),this.impl.torque.setZero()},e.clearState=function(){this.clearVelocity(),this.clearForces()},e.wakeUp=function(){return this.impl.wakeUp()},e.sleep=function(){return this.impl.sleep()},e.setSleepThreshold=function(t){this.impl.sleepSpeedLimit=t,this._wakeUpIfSleep()},e.getSleepThreshold=function(){return this.impl.sleepSpeedLimit},e.getLinearVelocity=function(t){return Cs.copy(t,this.impl.velocity),t},e.setLinearVelocity=function(t){this._wakeUpIfSleep(),Cs.copy(this.impl.velocity,t)},e.getAngularVelocity=function(t){return Cs.copy(t,this.impl.angularVelocity),t},e.setAngularVelocity=function(t){this._wakeUpIfSleep(),Cs.copy(this.impl.angularVelocity,t)},e.applyForce=function(t,e){this._sharedBody.syncSceneToPhysics(),this._wakeUpIfSleep(),null==e&&(e=Cs.ZERO),this.impl.applyForce(Cs.copy(tit,t),Cs.copy(eit,e))},e.applyImpulse=function(t,e){this._sharedBody.syncSceneToPhysics(),this._wakeUpIfSleep(),null==e&&(e=Cs.ZERO),this.impl.applyImpulse(Cs.copy(tit,t),Cs.copy(eit,e))},e.applyLocalForce=function(t,e){this._sharedBody.syncSceneToPhysics(),this._wakeUpIfSleep(),null==e&&(e=Cs.ZERO),this.impl.applyLocalForce(Cs.copy(tit,t),Cs.copy(eit,e))},e.applyLocalImpulse=function(t,e){this._sharedBody.syncSceneToPhysics(),this._wakeUpIfSleep(),null==e&&(e=Cs.ZERO),this.impl.applyLocalImpulse(Cs.copy(tit,t),Cs.copy(eit,e))},e.applyTorque=function(t){this._sharedBody.syncSceneToPhysics(),this._wakeUpIfSleep(),Cs.add(this.impl.torque,this.impl.torque,t)},e.applyLocalTorque=function(t){this._sharedBody.syncSceneToPhysics(),this._wakeUpIfSleep(),Cs.copy(tit,t),this.impl.vectorToWorldFrame(tit,tit),Cs.add(this.impl.torque,this.impl.torque,tit)},e.getGroup=function(){return this.impl.collisionFilterGroup},e.setGroup=function(t){this.impl.collisionFilterGroup=t,this._wakeUpIfSleep()},e.addGroup=function(t){this.impl.collisionFilterGroup|=t,this._wakeUpIfSleep()},e.removeGroup=function(t){this.impl.collisionFilterGroup&=~t,this._wakeUpIfSleep()},e.getMask=function(){return this.impl.collisionFilterMask},e.setMask=function(t){this.impl.collisionFilterMask=t,this._wakeUpIfSleep()},e.addMask=function(t){this.impl.collisionFilterMask|=t,this._wakeUpIfSleep()},e.removeMask=function(t){this.impl.collisionFilterMask&=~t,this._wakeUpIfSleep()},e._wakeUpIfSleep=function(){this.impl.isAwake()||this.impl.wakeUp()},r(t,[{key:"isAwake",get:function(){return this.impl.isAwake()}},{key:"isSleepy",get:function(){return this.impl.isSleepy()}},{key:"isSleeping",get:function(){return this.impl.isSleeping()}},{key:"impl",get:function(){return this._sharedBody.body}},{key:"rigidBody",get:function(){return this._rigidBody}},{key:"sharedBody",get:function(){return this._sharedBody}},{key:"isEnabled",get:function(){return this._isEnabled}}]),t}();function rit(t,e){t.__cc_wrapper__=e}function nit(t){return t.__cc_wrapper__}function sit(t,e){t.checkCollisionResponse=!e.queryTrigger,t.collisionFilterGroup=-1,t.collisionFilterMask=e.mask}function ait(t,e){t._assign(e.hitPointWorld,e.distance,nit(e.shape).collider,e.hitNormalWorld)}function oit(t){t.aabbNeedsUpdate=!0,t.updateMassProperties(),t.updateBoundingRadius()}var hit={type:"onTriggerEnter",selfCollider:null,otherCollider:null,impl:null},lit=new F6.Quaternion,uit=new F6.Vec3,cit=new F6.Vec3,_it=function(){function t(){this._offset=new F6.Vec3,this._orient=new F6.Quaternion,this._index=-1,this.onTriggerListener=this._onTrigger.bind(this),this._isBinding=!1}var e=t.prototype;return e.setMaterial=function(e){null==e?this._shape.material=null:(null==t.idToMaterial[e._uuid]&&(t.idToMaterial[e._uuid]=new F6.Material(e._uuid)),this._shape.material=t.idToMaterial[e._uuid],this._shape.material.friction=e.friction,this._shape.material.restitution=e.restitution)},e.setAsTrigger=function(t){this._shape.collisionResponse=!t,this._index>=0&&this._body.updateHasTrigger()},e.setCenter=function(t){this._setCenter(t),this._index>=0&&oit(this._body)},e.setAttachedBody=function(t){if(t){if(this._sharedBody){if(this._sharedBody.wrappedBody==t.body)return;this._sharedBody.reference=!1}this._sharedBody=V7.instance.physicsWorld.getSharedBody(t.node),this._sharedBody.reference=!0}else this._sharedBody&&(this._sharedBody.reference=!1),this._sharedBody=V7.instance.physicsWorld.getSharedBody(this._collider.node),this._sharedBody.reference=!0},e.getAABB=function(t){Ns.copy(lit,this._collider.node.worldRotation),this._shape.calculateWorldAABB(F6.Vec3.ZERO,lit,uit,cit),Cs.subtract(t.halfExtents,cit,uit),Cs.multiplyScalar(t.halfExtents,t.halfExtents,.5),Cs.add(t.center,this._collider.node.worldPosition,this._collider.center)},e.getBoundingSphere=function(t){t.radius=this._shape.boundingSphereRadius,Cs.add(t.center,this._collider.node.worldPosition,this._collider.center)},e.initialize=function(t){this._collider=t,this._isBinding=!0,this.onComponentSet(),rit(this._shape,this),this._shape.addEventListener("cc-trigger",this.onTriggerListener),this._sharedBody=V7.instance.physicsWorld.getSharedBody(this._collider.node),this._sharedBody.reference=!0},e.onComponentSet=function(){},e.onLoad=function(){this.setMaterial(this._collider.sharedMaterial),this.setCenter(this._collider.center),this.setAsTrigger(this._collider.isTrigger)},e.onEnable=function(){this._sharedBody.addShape(this),this._sharedBody.enabled=!0},e.onDisable=function(){this._sharedBody.removeShape(this),this._sharedBody.enabled=!1},e.onDestroy=function(){this._sharedBody.reference=!1,this._shape.removeEventListener("cc-trigger",this.onTriggerListener),delete F6.World.idToShapeMap[this._shape.id],this._sharedBody=null,rit(this._shape,null),this._offset=null,this._orient=null,this._shape=null,this._collider=null,this.onTriggerListener=null},e.getGroup=function(){return this._body.collisionFilterGroup},e.setGroup=function(t){this._body.collisionFilterGroup=t,this._body.isAwake()||this._body.wakeUp()},e.addGroup=function(t){this._body.collisionFilterGroup|=t,this._body.isAwake()||this._body.wakeUp()},e.removeGroup=function(t){this._body.collisionFilterGroup&=~t,this._body.isAwake()||this._body.wakeUp()},e.getMask=function(){return this._body.collisionFilterMask},e.setMask=function(t){this._body.collisionFilterMask=t,this._body.isAwake()||this._body.wakeUp()},e.addMask=function(t){this._body.collisionFilterMask|=t,this._body.isAwake()||this._body.wakeUp()},e.removeMask=function(t){this._body.collisionFilterMask&=~t,this._body.isAwake()||this._body.wakeUp()},e.setScale=function(){this._setCenter(this._collider.center)},e.setIndex=function(t){this._index=t},e.setOffsetAndOrient=function(t,e){Cs.copy(t,this._offset),Ns.copy(e,this._orient),this._offset=t,this._orient=e},e._setCenter=function(t){var e=this._offset;Cs.subtract(e,this._sharedBody.node.worldPosition,this._collider.node.worldPosition),Cs.add(e,e,t),Cs.multiply(e,e,this._collider.node.worldScale)},e._onTrigger=function(t){hit.type=t.event;var e=nit(t.selfShape),i=nit(t.otherShape);e&&e.collider.needTriggerEvent&&(hit.selfCollider=e.collider,hit.otherCollider=i?i.collider:null,hit.impl=t,this._collider.emit(hit.type,hit))},r(t,[{key:"impl",get:function(){return this._shape}},{key:"collider",get:function(){return this._collider}},{key:"attachedRigidBody",get:function(){return this._sharedBody.wrappedBody?this._sharedBody.wrappedBody.rigidBody:null}},{key:"sharedBody",get:function(){return this._sharedBody}},{key:"_body",get:function(){return this._sharedBody.body}}]),t}();_it.idToMaterial={};var dit=function(){function t(t){this.impl=null,this.event=void 0,this.event=t}r(t,[{key:"isBodyA",get:function(){var t=this.event.selfCollider.shape.impl,e=this.impl.bj;return t.body.id==e.id}}]);var e=t.prototype;return e.getLocalPointOnA=function(t){this.impl&&Cs.copy(t,this.impl.rj)},e.getLocalPointOnB=function(t){this.impl&&Cs.copy(t,this.impl.ri)},e.getWorldPointOnA=function(t){this.impl&&Cs.add(t,this.impl.rj,this.impl.bj.position)},e.getWorldPointOnB=function(t){this.impl&&Cs.add(t,this.impl.ri,this.impl.bi.position)},e.getLocalNormalOnB=function(t){this.impl&&Cs.copy(t,this.impl.ni)},e.getWorldNormalOnB=function(t){this.impl&&Cs.transformQuat(t,this.impl.ni,this.impl.bi.quaternion)},t}(),pit=new Cs,fit=new Ns,mit=[],git={type:"onCollisionEnter",selfCollider:null,otherCollider:null,contacts:[],impl:null},vit=function(){function t(t,e){this.node=void 0,this.wrappedWorld=void 0,this.body=void 0,this.shapes=[],this.wrappedBody=null,this.index=-1,this.ref=0,this.onCollidedListener=this.onCollided.bind(this),this.wrappedWorld=e,this.node=t,this.body=new F6.Body,this.body.collisionFilterGroup=V7.PhysicsGroup.DEFAULT,this.body.sleepSpeedLimit=V7.instance.sleepThreshold,this.body.material=this.wrappedWorld.impl.defaultMaterial,this.body.addEventListener("cc-collide",this.onCollidedListener)}t.getSharedBody=function(e,i,r){var n,s=e.uuid;if(t.sharedBodesMap.has(s)?n=t.sharedBodesMap.get(s):(n=new t(e,i),t.sharedBodesMap.set(e.uuid,n)),r){n.wrappedBody=r;var a=r.rigidBody.group,o=V7.instance.collisionMatrix[a];n.body.collisionFilterGroup=a,n.body.collisionFilterMask=o}return n},r(t,[{key:"enabled",set:function(t){t?this.index<0&&(this.index=this.wrappedWorld.bodies.length,this.wrappedWorld.addSharedBody(this),this.syncInitial()):this.index>=0&&(0==this.shapes.length&&null==this.wrappedBody||0==this.shapes.length&&null!=this.wrappedBody&&!this.wrappedBody.isEnabled)&&(this.body.sleep(),this.index=-1,this.wrappedWorld.removeSharedBody(this))}},{key:"reference",set:function(t){t?this.ref++:this.ref--,0==this.ref&&this.destroy()}}]);var e=t.prototype;return e.addShape=function(t){if(this.shapes.indexOf(t)<0){var e=this.body.shapes.length;this.body.addShape(t.impl),this.shapes.push(t),t.setIndex(e);var i=this.body.shapeOffsets[e],r=this.body.shapeOrientations[e];t.setOffsetAndOrient(i,r),this.body.isSleeping()&&this.body.wakeUp()}},e.removeShape=function(t){var e=this.shapes.indexOf(t);e>=0&&(this.shapes.splice(e,1),this.body.removeShape(t.impl),t.setIndex(-1),this.body.isSleeping()&&this.body.wakeUp())},e.syncSceneToPhysics=function(){if(this.node.hasChangedFlags&&(this.body.isSleeping()&&this.body.wakeUp(),Cs.copy(this.body.position,this.node.worldPosition),Ns.copy(this.body.quaternion,this.node.worldRotation),this.body.aabbNeedsUpdate=!0,this.node.hasChangedFlags&Uv.SCALE)){for(var t=0;t<this.shapes.length;t++)this.shapes[t].setScale(this.node.worldScale);oit(this.body)}},e.syncPhysicsToScene=function(){this.body.type!=I6.STATIC&&(this.body.isSleeping()||(Cs.copy(pit,this.body.position),Ns.copy(fit,this.body.quaternion),this.node.worldPosition=pit,this.node.worldRotation=fit))},e.syncInitial=function(){Cs.copy(this.body.position,this.node.worldPosition),Ns.copy(this.body.quaternion,this.node.worldRotation),this.body.aabbNeedsUpdate=!0;for(var t=0;t<this.shapes.length;t++)this.shapes[t].setScale(this.node.worldScale);oit(this.body),this.body.isSleeping()&&this.body.wakeUp()},e.destroy=function(){this.body.removeEventListener("cc-collide",this.onCollidedListener),t.sharedBodesMap.delete(this.node.uuid),delete F6.World.idToBodyMap[this.body.id],this.node=null,this.wrappedWorld=null,this.body=null,this.shapes=null,this.onCollidedListener=null},e.onCollided=function(t){git.type=t.event;var e=nit(t.selfShape),i=nit(t.otherShape);if(e&&e.collider.needCollisionEvent){mit.push.apply(mit,git.contacts),git.contacts.length=0,git.impl=t,git.selfCollider=e.collider,git.otherCollider=i?i.collider:null;var r=0;for(r=0;r<t.contacts.length;r++){var n=t.contacts[r];if(mit.length>0){var s=mit.pop();s.impl=n,git.contacts.push(s)}else{var a=new dit(git);a.impl=n,git.contacts.push(a)}}for(r=0;r<this.shapes.length;r++)this.shapes[r].collider.emit(git.type,git)}},t}();vit.sharedBodesMap=new Map;var yit=function(){var t=e.prototype;function e(){this.bodies=[],this.constraints=[],this._world=void 0,this._raycastResult=new F6.RaycastResult,this._world=new F6.World,this._world.broadphase=new F6.NaiveBroadphase,this._world.solver.iterations=10,this._world.solver.tolerance=1e-4,this._world.defaultContactMaterial.contactEquationStiffness=1e6,this._world.defaultContactMaterial.frictionEquationStiffness=1e6,this._world.defaultContactMaterial.contactEquationRelaxation=3,this._world.defaultContactMaterial.frictionEquationRelaxation=3}return t.setDefaultMaterial=function(t){this._world.defaultMaterial.friction=t.friction,this._world.defaultMaterial.restitution=t.restitution,null!=_it.idToMaterial[t._uuid]&&(_it.idToMaterial[t._uuid]=this._world.defaultMaterial)},t.setAllowSleep=function(t){this._world.allowSleep=t},t.setGravity=function(t){Cs.copy(this._world.gravity,t)},r(e,[{key:"impl",get:function(){return this._world}}]),t.emitEvents=function(){this._world.emitTriggeredEvents(),this._world.emitCollisionEvents()},t.syncSceneToPhysics=function(){for(var t=0;t<this.bodies.length;t++)this.bodies[t].syncSceneToPhysics()},t.step=function(t,e,i){if(0!=this.bodies.length){this._world.step(t,e,i);for(var r=0;r<this.bodies.length;r++)this.bodies[r].syncPhysicsToScene()}},t.raycastClosest=function(t,e,i){Sit(t,e.maxDistance),sit(bit,e);var r=this._world.raycastClosest(Tit,Eit,bit,this._raycastResult);return r&&ait(i,this._raycastResult),r},t.raycast=function(t,e,i,r){return Sit(t,e.maxDistance),sit(bit,e),this._world.raycastAll(Tit,Eit,bit,(function(t){var e=i.add();ait(e,t),r.push(e)}))},t.getSharedBody=function(t,e){return vit.getSharedBody(t,this,e)},t.addSharedBody=function(t){this.bodies.indexOf(t)<0&&(this.bodies.push(t),this._world.addBody(t.body))},t.removeSharedBody=function(t){var e=this.bodies.indexOf(t);e>=0&&(this.bodies.splice(e,1),this._world.remove(t.body))},t.addConstraint=function(t){this.constraints.indexOf(t)<0&&(this.constraints.push(t),this._world.addConstraint(t.impl))},t.removeConstraint=function(t){var e=this.constraints.indexOf(t);e>=0&&(this.constraints.splice(e,1),this._world.removeConstraint(t.impl))},t.updateCollisionMatrix=function(t,e){for(var i=0;i<this.bodies.length;i++){var r=this.bodies[i].body;r.collisionFilterGroup==t&&(r.collisionFilterMask=e)}},e}(),Tit=new F6.Vec3,Eit=new F6.Vec3;function Sit(t,e){Cs.copy(Tit,t.o),t.computeHit(Eit,e)}var bit={checkCollisionResponse:!1,collisionFilterGroup:-1,collisionFilterMask:-1,skipBackFaces:!0},Ait=function(t){function e(){var e;return(e=t.call(this)||this).HALF_EXTENT=void 0,e.HALF_EXTENT=new F6.Vec3(.5,.5,.5),e._shape=new F6.Box(e.HALF_EXTENT.clone()),e}s(e,t),r(e,[{key:"collider",get:function(){return this._collider}},{key:"impl",get:function(){return this._shape}}]);var i=e.prototype;return i.setSize=function(t){Cs.multiplyScalar(this.HALF_EXTENT,t,.5);var e=this.collider.node.worldScale;this.impl.halfExtents.x=this.HALF_EXTENT.x*Math.abs(e.x),this.impl.halfExtents.y=this.HALF_EXTENT.y*Math.abs(e.y),this.impl.halfExtents.z=this.HALF_EXTENT.z*Math.abs(e.z),this.impl.updateConvexPolyhedronRepresentation(),-1!=this._index&&oit(this._body)},i.onLoad=function(){t.prototype.onLoad.call(this),this.setSize(this.collider.size)},i.setScale=function(e){t.prototype.setScale.call(this,e),this.setSize(this.collider.size)},e}(_it),Cit=function(t){s(i,t);var e=i.prototype;function i(e){var i;return void 0===e&&(e=.5),(i=t.call(this)||this)._shape=new F6.Sphere(e),i}return e.setRadius=function(t){var e=function(t){return Math.max(t.x,Math.max(t.y,t.z))}(this.collider.node.worldScale);this.impl.radius=t*Math.abs(e),this.impl.updateBoundingSphereRadius(),-1!=this._index&&oit(this._body)},r(i,[{key:"collider",get:function(){return this._collider}},{key:"impl",get:function(){return this._shape}}]),e.onLoad=function(){t.prototype.onLoad.call(this),this.setRadius(this.collider.radius)},e.setScale=function(e){t.prototype.setScale.call(this,e),this.setRadius(this.collider.radius)},i}(_it),wit=new F6.Vec3,Rit=function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;return i.setMesh=function(t){if(this._isBinding){var e=t;if(null!=this._shape)if(e&&e.renderingSubMeshes.length>0){var i=e.renderingSubMeshes[0].geometricInfo.positions,r=e.renderingSubMeshes[0].geometricInfo.indices;this.updateProperties(i,r)}else this.updateProperties(new Float32Array,new Uint16Array);else if(e&&e.renderingSubMeshes.length>0){var n=e.renderingSubMeshes[0].geometricInfo.positions,s=e.renderingSubMeshes[0].geometricInfo.indices;this._shape=new F6.Trimesh(n,s)}else this._shape=new F6.Trimesh(new Float32Array,new Uint16Array)}},i.onComponentSet=function(){this.setMesh(this.collider.mesh)},i.onLoad=function(){t.prototype.onLoad.call(this),this.setMesh(this.collider.mesh)},i.setScale=function(e){t.prototype.setScale.call(this,e),Cs.copy(wit,e),this.impl.setScale(wit)},i.updateProperties=function(t,e){this.impl.vertices=new Float32Array(t),this.impl.indices=new Int16Array(e),this.impl.normals=new Float32Array(e.length),this.impl.aabb=new F6.AABB,this.impl.edges=[],this.impl.tree=new F6.Octree(new F6.AABB),this.impl.updateEdges(),this.impl.updateNormals(),this.impl.updateAABB(),this.impl.updateBoundingSphereRadius(),this.impl.updateTree(),this.impl.setScale(this.impl.scale),this._index>=0&&oit(this._body)},r(e,[{key:"collider",get:function(){return this._collider}},{key:"impl",get:function(){return this._shape}}]),e}(_it),xit=function(t){s(i,t);var e=i.prototype;function i(e,i,r){var n;return void 0===e&&(e=.5),void 0===i&&(i=2),void 0===r&&(r=M6.Y_AXIS),(n=t.call(this)||this)._shape=new F6.Cylinder(e,e,i,F6.CC_CONFIG.numSegmentsCylinder,r==M6.Y_AXIS),n}return e.setRadius=function(){this.updateProperties(this.collider.radius,this.collider.height,F6.CC_CONFIG.numSegmentsCylinder,this.collider.direction,this.collider.node.worldScale),-1!=this._index&&oit(this._body)},e.setHeight=function(){this.updateProperties(this.collider.radius,this.collider.height,F6.CC_CONFIG.numSegmentsCylinder,this.collider.direction,this.collider.node.worldScale),-1!=this._index&&oit(this._body)},e.setDirection=function(){this.updateProperties(this.collider.radius,this.collider.height,F6.CC_CONFIG.numSegmentsCylinder,this.collider.direction,this.collider.node.worldScale),-1!=this._index&&oit(this._body)},r(i,[{key:"collider",get:function(){return this._collider}},{key:"impl",get:function(){return this._shape}}]),e.onLoad=function(){t.prototype.onLoad.call(this),this.setRadius(this.collider.radius)},e.setScale=function(e){t.prototype.setScale.call(this,e),this.setRadius(this.collider.radius)},e.updateProperties=function(t,e,i,r,n){var s=e,a=t,o=Math.cos,h=Math.sin,l=Math.abs,u=Math.max;1==r?(s=l(n.y)*e,a=u(l(n.x),l(n.z))*t):2==r?(s=l(n.z)*e,a=u(l(n.x),l(n.y))*t):(s=l(n.x)*e,a=u(l(n.y),l(n.z))*t);var c=i,_=s/2,d=[],p=[],f=[],m=2*Math.PI/c;if(1==r){for(var g=[1],v=[0],y=0;y<c;y++){var T=a*o(m*y),E=a*h(m*y);d.push(new F6.Vec3(T,_,E)),d.push(new F6.Vec3(T,-_,E)),y<c-1?(p.push([2*y+2,2*y+3,2*y+1,2*y]),v.push(2*y+2),g.push(2*y+3)):p.push([0,1,2*y+1,2*y]),(c%2==1||y<c/2)&&f.push(new F6.Vec3(o(m*(y+.5)),0,h(m*(y+.5))))}p.push(g);var S=[];for(y=0;y<v.length;y++)S.push(v[v.length-y-1]);p.push(S),f.push(new F6.Vec3(0,1,0))}else if(2==r){var b=[0],A=[1];for(y=0;y<c;y++){var C=a*o(m*y),w=a*h(m*y);d.push(new F6.Vec3(C,w,_)),d.push(new F6.Vec3(C,w,-_)),y<c-1?(p.push([2*y,2*y+1,2*y+3,2*y+2]),b.push(2*y+2),A.push(2*y+3)):p.push([2*y,2*y+1,0,1]),(c%2==1||y<c/2)&&f.push(new F6.Vec3(o(m*(y+.5)),h(m*(y+.5)),0))}for(p.push(b),S=[],y=0;y<A.length;y++)S.push(A[A.length-y-1]);p.push(S),f.push(new F6.Vec3(0,0,1))}else{var R=[0],x=[1];for(y=0;y<c;y++){var O=a*o(m*y),I=a*h(m*y);d.push(new F6.Vec3(_,O,I)),d.push(new F6.Vec3(-_,O,I)),y<c-1?(p.push([2*y,2*y+1,2*y+3,2*y+2]),R.push(2*y+2),x.push(2*y+3)):p.push([2*y,2*y+1,0,1]),(c%2==1||y<c/2)&&f.push(new F6.Vec3(0,o(m*(y+.5)),h(m*(y+.5))))}for(p.push(R),S=[],y=0;y<x.length;y++)S.push(x[x.length-y-1]);p.push(S),f.push(new F6.Vec3(1,0,0))}this.impl.vertices=d,this.impl.faces=p,this.impl.uniqueAxes=f,this.impl.worldVerticesNeedsUpdate=!0,this.impl.worldFaceNormalsNeedsUpdate=!0,this.impl.computeNormals(),this.impl.computeEdges(),this.impl.updateBoundingSphereRadius()},i}(_it),Oit=new Cs,Iit=new Cs,Mit=function(t){s(i,t);var e=i.prototype;function i(e,i,r){var n;return void 0===e&&(e=.5),void 0===i&&(i=1),void 0===r&&(r=M6.Y_AXIS),(n=t.call(this)||this)._shape=new F6.Cylinder(0,e,i,F6.CC_CONFIG.numSegmentsCone,r==M6.Y_AXIS),n}return e.setRadius=function(){this.updateProperties(this.collider.radius,this.collider.height,F6.CC_CONFIG.numSegmentsCone,this.collider.direction,this.collider.node.worldScale),-1!=this._index&&oit(this._body)},e.setHeight=function(){this.updateProperties(this.collider.radius,this.collider.height,F6.CC_CONFIG.numSegmentsCone,this.collider.direction,this.collider.node.worldScale),-1!=this._index&&oit(this._body)},e.setDirection=function(){this.updateProperties(this.collider.radius,this.collider.height,F6.CC_CONFIG.numSegmentsCone,this.collider.direction,this.collider.node.worldScale),-1!=this._index&&oit(this._body)},r(i,[{key:"collider",get:function(){return this._collider}},{key:"impl",get:function(){return this._shape}}]),e.onLoad=function(){t.prototype.onLoad.call(this),this.setRadius(this.collider.radius)},e.setScale=function(e){t.prototype.setScale.call(this,e),this.setRadius(this.collider.radius)},e.updateProperties=function(t,e,i,r,n){var s=e,a=t,o=Math.cos,h=Math.sin,l=Math.abs,u=Math.max;1==r?(s=l(n.y)*e,a=u(l(n.x),l(n.z))*t):2==r?(s=l(n.z)*e,a=u(l(n.x),l(n.y))*t):(s=l(n.x)*e,a=u(l(n.y),l(n.z))*t);var c=i,_=s/2,d=[],p=[],f=[],m=2*Math.PI/c;if(1==r){var g=[];p.push(g),d.push(new F6.Vec3(0,_,0));for(var v=0;v<c;v++){var y=a*o(m*v),T=a*h(m*v);d.push(new F6.Vec3(y,-_,T))}for(v=0;v<c;v++)0!=v&&g.push(v),R=v<c-1?[0,v+2,v+1]:[0,1,v+1],p.push(R),Cs.subtract(Oit,d[0],d[R[1]]),Cs.subtract(Iit,d[R[2]],d[R[1]]),Cs.cross(Oit,Iit,Oit),Oit.normalize(),f.push(new F6.Vec3(Oit.x,Oit.y,Oit.z));f.push(new F6.Vec3(0,-1,0))}else if(2==r){var E=[];for(p.push(E),d.push(new F6.Vec3(0,0,_)),v=0;v<c;v++){var S=a*o(m*v),b=a*h(m*v);d.push(new F6.Vec3(S,b,-_))}for(v=0;v<c;v++)0!=v&&E.push(c-v),R=v<c-1?[0,v+1,v+2]:[0,v+1,1],p.push(R),Cs.subtract(Oit,d[0],d[R[1]]),Cs.subtract(Iit,d[R[2]],d[R[1]]),Cs.cross(Oit,Oit,Iit),Oit.normalize(),f.push(new F6.Vec3(Oit.x,Oit.y,Oit.z));f.push(new F6.Vec3(0,0,-1))}else{var A=[];for(p.push(A),d.push(new F6.Vec3(_,0,0)),v=0;v<c;v++){var C=a*o(m*v),w=a*h(m*v);d.push(new F6.Vec3(-_,C,w))}for(v=0;v<c;v++){var R;0!=v&&A.push(c-v),R=v<c-1?[0,v+1,v+2]:[0,v+1,1],p.push(R),Cs.subtract(Oit,d[0],d[R[1]]),Cs.subtract(Iit,d[R[2]],d[R[1]]),Cs.cross(Oit,Oit,Iit),Oit.normalize(),f.push(new F6.Vec3(Oit.x,Oit.y,Oit.z))}f.push(new F6.Vec3(-1,0,0))}this.impl.vertices=d,this.impl.faces=p,this.impl.uniqueAxes=f,this.impl.worldVerticesNeedsUpdate=!0,this.impl.worldFaceNormalsNeedsUpdate=!0,this.impl.computeNormals(),this.impl.computeEdges(),this.impl.updateBoundingSphereRadius()},i}(_it),Bit=new F6.AABB,Pit=new F6.AABB,Nit=new F6.Transform;F6.Heightfield.prototype.calculateWorldAABB=function(t,e,i,r){var n=Nit,s=Pit;Cs.copy(n.position,t),Ns.copy(n.quaternion,e);var a=this.elementSize,o=this.data;Bit.lowerBound.set(0,0,this.minValue),Bit.upperBound.set((o.length-1)*a,(o[0].length-1)*a,this.maxValue),Bit.toWorldFrame(n,s),i.copy(s.lowerBound),r.copy(s.upperBound)};var Lit,Fit=function(t){s(i,t);var e=i.prototype;function i(){var e;return(e=t.call(this)||this).DATA=void 0,e.OPTIONS=void 0,e._terrainID=void 0,e.DATA=[[]],e.OPTIONS={elementSize:0},e._terrainID="",e}return e.setTerrain=function(t){if(t){if(this._terrainID!=t._uuid){var e=t,i=e.getVertexCountI(),r=e.getVertexCountJ();this._terrainID=e._uuid,this.DATA.length=i-1;for(var n=0;n<i;n++){null==this.DATA[n]&&(this.DATA[n]=[]),this.DATA[n].length=r-1;for(var s=0;s<r;s++)this.DATA[n][s]=e.getHeight(n,r-1-s)}this.OPTIONS.elementSize=e.tileSize,this.updateProperties(this.DATA,this.OPTIONS.elementSize)}}else""!=this._terrainID&&(this._terrainID="",this.DATA.length=1,this.DATA[0]=this.DATA[0]||[],this.DATA[0].length=0,this.OPTIONS.elementSize=0,this.updateProperties(this.DATA,this.OPTIONS.elementSize))},r(i,[{key:"collider",get:function(){return this._collider}},{key:"impl",get:function(){return this._shape}}]),e.onComponentSet=function(){var t=this.collider.terrain;if(t){for(var e=t.getVertexCountI(),i=t.getVertexCountJ(),r=0;r<e;r++){null==this.DATA[r]&&(this.DATA[r]=[]);for(var n=0;n<i;n++)this.DATA[r][n]=t.getHeight(r,i-1-n)}this.OPTIONS.elementSize=t.tileSize,this._terrainID=t._uuid}this._shape=new F6.Heightfield(this.DATA,this.OPTIONS)},e.onLoad=function(){t.prototype.onLoad.call(this),this.setTerrain(this.collider.terrain)},e.updateProperties=function(t,e){var i=this.impl;i.data=t,i.elementSize=e,i.updateMinValue(),i.updateMaxValue(),i.updateBoundingSphereRadius(),i.update(),this._index>=0&&oit(this._body)},e._setCenter=function(t){var e=this.collider.terrain;if(e){Ns.fromEuler(this._orient,-90,0,0);var i=this._offset;Cs.set(i,0,0,(e.getVertexCountJ()-1)*e.tileSize),Cs.add(i,i,t)}},i}(_it),Dit=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).VERTICES=[],e}s(e,t);var i=e.prototype;return i.setShapeType=function(){this._isBinding},i.setVertices=function(t){var e=this.VERTICES.length;if(4==e){for(var i=this._collider.node.worldScale,r=0;r<e;r++)Cs.multiply(this.VERTICES[r],i,t[r]);var n=this.impl;n.computeNormals(),n.computeEdges(),n.updateBoundingSphereRadius()}-1!=this._index&&oit(this._body)},i.onComponentSet=function(){if(this.collider.shapeType==Eet.ESimplexType.TETRAHEDRON){for(var t=0;t<4;t++)this.VERTICES[t]=new F6.Vec3(0,0,0);this._shape=Uit(this.VERTICES)}else Eet.ESimplexType.VERTEX,this._shape=new F6.Particle},i.onLoad=function(){t.prototype.onLoad.call(this),this.collider.updateVertices()},i.setScale=function(e){t.prototype.setScale.call(this,e),this.collider.updateVertices()},r(e,[{key:"collider",get:function(){return this._collider}},{key:"impl",get:function(){return this._shape}}]),e}(_it),Uit=(Lit=[[0,3,2],[0,1,3],[0,2,1],[1,2,3]],function(t){return new F6.ConvexPolyhedron(t,Lit)}),kit=function(t){function e(){var e;return(e=t.call(this)||this)._shape=new F6.Plane,e}s(e,t),r(e,[{key:"collider",get:function(){return this._collider}},{key:"impl",get:function(){return this._shape}}]);var i=e.prototype;return i.setNormal=function(t){Ns.rotationTo(this._orient,Cs.UNIT_Z,t),-1!=this._index&&oit(this._body)},i.setConstant=function(t){Cs.scaleAndAdd(this._offset,this._collider.center,this.collider.normal,t)},i.onLoad=function(){t.prototype.onLoad.call(this),this.setConstant(this.collider.constant),this.setNormal(this.collider.normal)},i._setCenter=function(e){t.prototype._setCenter.call(this,e),this.setConstant(this.collider.constant)},e}(_it);F6.World.staticBody=new F6.Body,F6.World.idToConstraintMap={};var zit,Git=function(){function t(){this._rigidBody=null}var e=t.prototype;return e.setConnectedBody=function(t){this._impl.bodyB=t?t.body.impl:F6.World.staticBody},e.setEnableCollision=function(t){this._impl.collideConnected=t},e.initialize=function(t){this._com=t,this._rigidBody=t.attachedBody,this.onComponentSet(),this.setEnableCollision(t.enableCollision),F6.World.idToConstraintMap[this._impl.id]=this._impl},e.onComponentSet=function(){},e.onLoad=function(){},e.onEnable=function(){this._rigidBody&&this._rigidBody.body.sharedBody.wrappedWorld.addConstraint(this)},e.onDisable=function(){this._rigidBody&&this._rigidBody.body.sharedBody.wrappedWorld.removeConstraint(this)},e.onDestroy=function(){delete F6.World.idToConstraintMap[this._impl.id],this._com=null,this._rigidBody=null,this._impl=null},r(t,[{key:"impl",get:function(){return this._impl}},{key:"constraint",get:function(){return this._com}}]),t}(),Hit=new Cs,Vit=new Cs,Wit=function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;return i.setPivotA=function(t){Cs.multiply(Hit,t,this._com.node.worldScale),Cs.copy(this.impl.pivotA,Hit)},i.setPivotB=function(t){Cs.copy(Hit,t);var e=this.constraint.connectedBody;e?Cs.multiply(Hit,Hit,e.node.worldScale):(Cs.add(Hit,Hit,this._com.node.worldPosition),Cs.multiply(Vit,this.constraint.pivotA,this._com.node.worldScale),Cs.add(Hit,Hit,Vit)),Cs.copy(this.impl.pivotB,Hit)},i.onComponentSet=function(){if(this._rigidBody){var t=this._rigidBody.body.impl,e=this.constraint.connectedBody,i=F6.World.staticBody;e&&(i=e.body.impl),this._impl=new F6.PointToPointConstraint(t,null,i),this.setPivotA(this.constraint.pivotA),this.setPivotB(this.constraint.pivotB)}},r(e,[{key:"impl",get:function(){return this._impl}},{key:"constraint",get:function(){return this._com}}]),e}(Git),jit=new Cs,Xit=new Cs,Yit=function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;return i.setPivotA=function(t){Cs.multiply(jit,t,this._com.node.worldScale),Cs.copy(this.impl.pivotA,jit)},i.setPivotB=function(t){Cs.copy(jit,t);var e=this.constraint.connectedBody;e?Cs.multiply(jit,jit,e.node.worldScale):(Cs.add(jit,jit,this._com.node.worldPosition),Cs.multiply(Xit,this.constraint.pivotA,this._com.node.worldScale),Cs.add(jit,jit,Xit)),Cs.copy(this.impl.pivotB,jit)},i.setAxisA=function(t){Cs.copy(this.impl.axisA,t),Cs.copy(this.impl.equations[3].axisA,t),Cs.copy(this.impl.equations[4].axisA,t)},i.setAxisB=function(t){Cs.copy(this.impl.axisB,t),Cs.copy(this.impl.equations[3].axisB,t),Cs.copy(this.impl.equations[4].axisB,t)},i.onComponentSet=function(){if(this._rigidBody){var t=this._rigidBody.body.impl,e=this.constraint.connectedBody,i=F6.World.staticBody;e&&(i=e.body.impl),this._impl=new F6.HingeConstraint(t,i),this.setPivotA(this.constraint.pivotA),this.setPivotB(this.constraint.pivotB),this.setAxisA(this.constraint.axisA),this.setAxisB(this.constraint.axisB)}},r(e,[{key:"impl",get:function(){return this._impl}},{key:"constraint",get:function(){return this._com}}]),e}(Git);$s(dit.prototype,"IContactEquation.prototype",[{name:"contactA",newName:"getLocalPointOnA",customGetter:function(){var t=new Cs;return dit.prototype.getLocalPointOnA.call(this,t),t}},{name:"contactB",newName:"getLocalPointOnB",customGetter:function(){var t=new Cs;return dit.prototype.getLocalPointOnB.call(this,t),t}},{name:"normal",newName:"getLocalNormalOnB",customGetter:function(){var t=new Cs;return dit.prototype.getLocalNormalOnB.call(this,t),t}}]),zit={PhysicsWorld:yit,RigidBody:iit,BoxShape:Ait,SphereShape:Cit,TrimeshShape:Rit,CylinderShape:xit,ConeShape:Mit,TerrainShape:Fit,SimplexShape:Dit,PlaneShape:kit,PointToPointConstraint:Wit,HingeConstraint:Yit},O6="cannon.js",_._global.CC_PHYSICS_BUILTIN=!1,_._global.CC_PHYSICS_CANNON=!0,_._global.CC_PHYSICS_AMMO=!1,x6=zit,window&&(window.CANNON=F6),F6.CC_CONFIG={numSegmentsCone:12,numSegmentsCylinder:12,ignoreSelfBody:!0},F6.ArrayCollisionMatrix.prototype.reset=function(){for(var t in this.matrix)delete this.matrix[t]};var qit=0,Kit=function(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.paused=!1,this.lock=!1},Zit=function(){function t(){this._hashTargets=new Map,this._arrayTargets=[],this._elementPool=[]}var e=t.prototype;return e._searchElementByTarget=function(t,e){for(var i=0;i<t.length;i++)if(e===t[i].target)return t[i];return null},e._getElement=function(t,e){var i=this._elementPool.pop();return i||(i=new Kit),i.target=t,i.paused=!!e,i},e._putElement=function(t){t.actions.length=0,t.actionIndex=0,t.currentAction=null,t.paused=!1,t.target=null,t.lock=!1,this._elementPool.push(t)},e.addAction=function(t,e,i){if(t&&e){null==e.uuid&&(e.uuid="_TWEEN_UUID_"+qit++);var r=this._hashTargets.get(e);r?r.actions||(r.actions=[]):(r=this._getElement(e,i),this._hashTargets.set(e,r),this._arrayTargets.push(r)),r.target=e,r.actions.push(t),t.startWithTarget(e)}else B(1e3)},e.removeAllActions=function(){for(var t=this._arrayTargets,e=0;e<t.length;e++){var i=t[e];i&&this._putElement(i)}this._arrayTargets.length=0,this._hashTargets=new Map},e.removeAllActionsFromTarget=function(t){if(null!=t){var e=this._hashTargets.get(t);e&&(e.actions.length=0,this._deleteHashElement(e))}},e.removeAction=function(t){if(null!=t){var e=t.getOriginalTarget(),i=this._hashTargets.get(e);if(i)for(var r=0;r<i.actions.length;r++)if(i.actions[r]===t){i.actions.splice(r,1),i.actionIndex>=r&&i.actionIndex--;break}}},e._removeActionByTag=function(t,e,i){for(var r=0,n=e.actions.length;r<n;++r){var s=e.actions[r];if(s&&s.getTag()===t){if(i&&s.getOriginalTarget()!==i)continue;this._removeActionAtIndex(r,e);break}}},e.removeActionByTag=function(t,e){var i=this;t===_.Action.TAG_INVALID&&x(1002);var r=this._hashTargets;if(e){var n=r.get(e);n&&this._removeActionByTag(t,n,e)}else r.forEach((function(e){i._removeActionByTag(t,e)}))},e.getActionByTag=function(t,e){t===_.Action.TAG_INVALID&&x(1004);var i=this._hashTargets.get(e);if(i){if(null!=i.actions)for(var r=0;r<i.actions.length;++r){var n=i.actions[r];if(n&&n.getTag()===t)return n}x(1005,t)}return null},e.getNumberOfRunningActionsInTarget=function(t){var e=this._hashTargets.get(t);return e&&e.actions?e.actions.length:0},e.pauseTarget=function(t){var e=this._hashTargets.get(t);e&&(e.paused=!0)},e.resumeTarget=function(t){var e=this._hashTargets.get(t);e&&(e.paused=!1)},e.pauseAllRunningActions=function(){for(var t=[],e=this._arrayTargets,i=0;i<e.length;i++){var r=e[i];r&&!r.paused&&(r.paused=!0,t.push(r.target))}return t},e.resumeTargets=function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.resumeTarget(t[e])},e.pauseTargets=function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.pauseTarget(t[e])},e.purgeSharedManager=function(){_.director.getScheduler().unscheduleUpdate(this)},e._removeActionAtIndex=function(t,e){e.actions[t],e.actions.splice(t,1),e.actionIndex>=t&&e.actionIndex--,0===e.actions.length&&this._deleteHashElement(e)},e._deleteHashElement=function(t){var e=!1;if(t&&!t.lock&&this._hashTargets.get(t.target)){this._hashTargets.delete(t.target);for(var i=this._arrayTargets,r=0,n=i.length;r<n;r++)if(i[r]===t){i.splice(r,1);break}this._putElement(t),e=!0}return e},e.update=function(t){for(var e,i=this._arrayTargets,r=0;r<i.length;r++){this._currentTarget=i[r];var n=(e=this._currentTarget).target;if(n instanceof Xi&&!n.isValid)this.removeAllActionsFromTarget(n),r--;else{if(!e.paused&&e.actions){for(e.lock=!0,e.actionIndex=0;e.actionIndex<e.actions.length;e.actionIndex++)if(e.currentAction=e.actions[e.actionIndex],e.currentAction){if(e.currentAction.step(t*(e.currentAction._speedMethod?e.currentAction._speed:1)),e.currentAction&&e.currentAction.isDone()){e.currentAction.stop();var s=e.currentAction;e.currentAction=null,this.removeAction(s)}e.currentAction=null}e.lock=!1}0===e.actions.length&&this._deleteHashElement(e)&&r--}}},t}(),Qit=t("TweenSystem",function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).actionMgr=new Zit,e}return s(e,t),e.prototype.postUpdate=function(t){this.actionMgr.update(t)},r(e,[{key:"ActionManager",get:function(){return this.actionMgr}}]),e}(qO));Qit.ID="TWEEN",Qit.instance=void 0,NF.on(PF.EVENT_INIT,(function(){var t=new Qit;Qit.instance=t,NF.registerSystem(Qit.ID,t,100)}));var Jit=function(){function t(){this.originalTarget=null,this.target=null,this.tag=t.TAG_INVALID}var e=t.prototype;return e.clone=function(){var e=new t;return e.originalTarget=null,e.target=null,e.tag=this.tag,e},e.isDone=function(){return!0},e.startWithTarget=function(t){this.originalTarget=t,this.target=t},e.stop=function(){this.target=null},e.step=function(){x(1006)},e.update=function(){x(1007)},e.getTarget=function(){return this.target},e.setTarget=function(t){this.target=t},e.getOriginalTarget=function(){return this.originalTarget},e.setOriginalTarget=function(t){this.originalTarget=t},e.getTag=function(){return this.tag},e.setTag=function(t){this.tag=t},e.reverse=function(){return x(1008),null},e.retain=function(){},e.release=function(){},t}();Jit.TAG_INVALID=-1;var $it=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._duration=0,e._timesForRepeat=1,e}s(e,t);var i=e.prototype;return i.getDuration=function(){return this._duration*(this._timesForRepeat||1)},i.setDuration=function(t){this._duration=t},i.clone=function(){return new e},e}(Jit),trt=(function(t){function e(e,i){var r;return void 0===i&&(i=1),(r=t.call(this)||this)._speed=0,r._innerAction=null,e&&r.initWithAction(e,i),r}s(e,t);var i=e.prototype;i.getSpeed=function(){return this._speed},i.setSpeed=function(t){this._speed=t},i.initWithAction=function(t,e){return t?(this._innerAction=t,this._speed=e,!0):(B(1021),!1)},i.clone=function(){var t=new e;return t.initWithAction(this._innerAction.clone(),this._speed),t},i.startWithTarget=function(t){Jit.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},i.stop=function(){this._innerAction.stop(),Jit.prototype.stop.call(this)},i.step=function(t){this._innerAction.step(t*this._speed)},i.isDone=function(){return this._innerAction.isDone()},i.reverse=function(){return new e(this._innerAction.reverse(),this._speed)},i.setInnerAction=function(t){this._innerAction!==t&&(this._innerAction=t)},i.getInnerAction=function(){return this._innerAction}}(Jit),function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;return i.isDone=function(){return!0},i.step=function(){this.update(1)},i.update=function(){},i.reverse=function(){return this.clone()},i.clone=function(){return new e},e}($it)),ert=function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;return i.update=function(){for(var t=this.target.getComponentsInChildren(Kw),e=0;e<t.length;++e)t[e].enabled=!0},i.reverse=function(){return new irt},i.clone=function(){return new e},e}(trt),irt=function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;return i.update=function(){for(var t=this.target.getComponentsInChildren(Kw),e=0;e<t.length;++e)t[e].enabled=!1},i.reverse=function(){return new ert},i.clone=function(){return new e},e}(trt);!function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;i.update=function(){for(var t=this.target.getComponentsInChildren(Kw),e=0;e<t.length;++e){var i=t[e];i.enabled=!i.enabled}},i.reverse=function(){return new e},i.clone=function(){return new e}}(trt);var rrt=function(t){function e(e){var i;return(i=t.call(this)||this)._isNeedCleanUp=!0,void 0!==e&&i.init(e),i}s(e,t);var i=e.prototype;return i.update=function(){this.target.removeFromParent(),this._isNeedCleanUp&&this.target.destroy()},i.init=function(t){return this._isNeedCleanUp=t,!0},i.reverse=function(){return new e(this._isNeedCleanUp)},i.clone=function(){return new e(this._isNeedCleanUp)},e}(trt),nrt=function(t){function e(e,i,r){var n;return(n=t.call(this)||this)._selectorTarget=null,n._function=null,n._data=null,n.initWithFunction(e,i,r),n}s(e,t);var i=e.prototype;return i.initWithFunction=function(t,e,i){return t&&(this._function=t),e&&(this._selectorTarget=e),void 0!==i&&(this._data=i),!0},i.execute=function(){this._function&&this._function.call(this._selectorTarget,this.target,this._data)},i.update=function(){this.execute()},i.getTargetCallback=function(){return this._selectorTarget},i.setTargetCallback=function(t){t!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=t)},i.clone=function(){var t=new e;return t.initWithFunction(this._function,this._selectorTarget,this._data),t},e}(trt),srt=function(t){function e(e){var i;return(i=t.call(this)||this).MAX_VALUE=2,i._elapsed=0,i._firstTick=!1,i._easeList=[],i._speed=1,i._repeatForever=!1,i._repeatMethod=!1,i._speedMethod=!1,void 0===e||isNaN(e)||i.initWithDuration(e),i}s(e,t);var i=e.prototype;return i.getElapsed=function(){return this._elapsed},i.initWithDuration=function(t){return this._duration=0===t?Ut.FLT_EPSILON:t,this._elapsed=0,this._firstTick=!0,!0},i.isDone=function(){return this._elapsed>=this._duration},i._cloneDecoration=function(t){t._repeatForever=this._repeatForever,t._speed=this._speed,t._timesForRepeat=this._timesForRepeat,t._easeList=this._easeList,t._speedMethod=this._speedMethod,t._repeatMethod=this._repeatMethod},i._reverseEaseList=function(t){if(this._easeList){t._easeList=[];for(var e=0;e<this._easeList.length;e++)t._easeList.push(this._easeList[e])}},i.clone=function(){var t=new e(this._duration);return this._cloneDecoration(t),t},i.easing=function(t){this._easeList?this._easeList.length=0:this._easeList=[];for(var e=0;e<arguments.length;e++)this._easeList.push(arguments[e]);return this},i._computeEaseTime=function(t){return t},i.step=function(t){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=t;var e=this._elapsed/(this._duration>1.192092896e-7?this._duration:1.192092896e-7);e=1>e?e:1,this.update(e>0?e:0),this._repeatMethod&&this._timesForRepeat>1&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},i.startWithTarget=function(t){Jit.prototype.startWithTarget.call(this,t),this._elapsed=0,this._firstTick=!0},i.reverse=function(){return x(1010),this},i.setAmplitudeRate=function(){x(1011)},i.getAmplitudeRate=function(){return x(1012),0},i.speed=function(t){return t<=0?(x(1013),this):(this._speedMethod=!0,this._speed*=t,this)},i.getSpeed=function(){return this._speed},i.setSpeed=function(t){return this._speed=t,this},i.repeat=function(t){return t=Math.round(t),isNaN(t)||t<1?(x(1014),this):(this._repeatMethod=!0,this._timesForRepeat*=t,this)},i.repeatForever=function(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this},e}($it),art=function(t){function e(i){var r;(r=t.call(this)||this)._actions=[],r._split=0,r._last=0,r._reversed=!1;var n=i instanceof Array?i:arguments;if(1===n.length)return B(1019),a(r);var s=n.length-1;if(s>=0&&null==n[s]&&x(1015),s>=0){for(var o,h=n[0],l=1;l<s;l++)n[l]&&(o=h,h=e._actionOneTwo(o,n[l]));r.initWithTwoActions(h,n[s])}return r}s(e,t);var i=e.prototype;return i.initWithTwoActions=function(t,e){if(!t||!e)return B(1025),!1;var i=t._duration,r=e._duration,n=(i*=t._repeatMethod?t._timesForRepeat:1)+(r*=e._repeatMethod?e._timesForRepeat:1);return this.initWithDuration(n),this._actions[0]=t,this._actions[1]=e,!0},i.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),t},i.startWithTarget=function(t){srt.prototype.startWithTarget.call(this,t),this._split=this._actions[0]._duration/this._duration,this._split*=this._actions[0]._repeatMethod?this._actions[0]._timesForRepeat:1,this._last=-1},i.stop=function(){-1!==this._last&&this._actions[this._last].stop(),Jit.prototype.stop.call(this)},i.update=function(t){var e,i,r=0,n=this._split,s=this._actions,a=this._last;(t=this._computeEaseTime(t))<n?(e=0!==n?t/n:1,0===r&&1===a&&this._reversed&&(s[1].update(0),s[1].stop())):(r=1,e=1===n?1:(t-n)/(1-n),-1===a&&(s[0].startWithTarget(this.target),s[0].update(1),s[0].stop()),0===a&&(s[0].update(1),s[0].stop())),i=s[r],a===r&&i.isDone()||(a!==r&&i.startWithTarget(this.target),e*=i._timesForRepeat,i.update(e>1?e%1:e),this._last=r)},i.reverse=function(){var t=e._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t._reversed=!0,t},e}(srt);function ort(t){var e=t instanceof Array?t:arguments;if(1===e.length)return B(1019),null;var i=e.length-1;i>=0&&null==e[i]&&x(1015);var r=null;if(i>=0){r=e[0];for(var n=1;n<=i;n++)e[n]&&(r=art._actionOneTwo(r,e[n]))}return r}art._actionOneTwo=function(t,e){var i=new art;return i.initWithTwoActions(t,e),i};var hrt=function(t){function e(e,i){var r;return(r=t.call(this)||this)._times=0,r._total=0,r._nextDt=0,r._actionInstant=!1,r._innerAction=null,void 0!==i&&r.initWithAction(e,i),r}s(e,t);var i=e.prototype;return i.initWithAction=function(t,e){var i=t._duration*e;return!!this.initWithDuration(i)&&(this._times=e,this._innerAction=t,t instanceof trt&&(this._actionInstant=!0,this._times-=1),this._total=0,!0)},i.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone(),this._times),t},i.startWithTarget=function(t){this._total=0,this._nextDt=this._innerAction._duration/this._duration,srt.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},i.stop=function(){this._innerAction.stop(),Jit.prototype.stop.call(this)},i.update=function(t){t=this._computeEaseTime(t);var e=this._innerAction,i=this._duration,r=this._times,n=this._nextDt;if(t>=n){for(;t>n&&this._total<r;)e.update(1),this._total++,e.stop(),e.startWithTarget(this.target),n+=e._duration/i,this._nextDt=n>1?1:n;t>=1&&this._total<r&&(e.update(1),this._total++),this._actionInstant||(this._total===r?e.stop():e.update(t-(n-e._duration/i)))}else e.update(t*r%1)},i.isDone=function(){return this._total===this._times},i.reverse=function(){var t=new e(this._innerAction.reverse(),this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t},i.setInnerAction=function(t){this._innerAction!==t&&(this._innerAction=t)},i.getInnerAction=function(){return this._innerAction},e}(srt),lrt=function(t){function e(e){var i;return(i=t.call(this)||this)._innerAction=null,e&&i.initWithAction(e),i}s(e,t);var i=e.prototype;return i.initWithAction=function(t){return t?(this._innerAction=t,!0):(B(1026),!1)},i.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone()),t},i.startWithTarget=function(t){srt.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},i.step=function(t){var e=this._innerAction;e.step(t),e.isDone()&&(e.startWithTarget(this.target),e.step(e.getElapsed()-e._duration))},i.isDone=function(){return!1},i.reverse=function(){var t=new e(this._innerAction.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},i.setInnerAction=function(t){this._innerAction!==t&&(this._innerAction=t)},i.getInnerAction=function(){return this._innerAction},e}(srt),urt=function(t){function e(i){var r;(r=t.call(this)||this)._one=null,r._two=null;var n=i instanceof Array?i:arguments;if(1===n.length)return B(1020),a(r);var s=n.length-1;if(s>=0&&null==n[s]&&x(1015),s>=0){for(var o,h=n[0],l=1;l<s;l++)n[l]&&(o=h,h=e._actionOneTwo(o,n[l]));r.initWithTwoActions(h,n[s])}return r}s(e,t);var i=e.prototype;return i.initWithTwoActions=function(t,e){if(!t||!e)return B(1027),!1;var i=!1,r=t._duration,n=e._duration;return this.initWithDuration(Math.max(r,n))&&(this._one=t,this._two=e,r>n?this._two=art._actionOneTwo(e,drt(r-n)):r<n&&(this._one=art._actionOneTwo(t,drt(n-r))),i=!0),i},i.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithTwoActions(this._one.clone(),this._two.clone()),t},i.startWithTarget=function(t){srt.prototype.startWithTarget.call(this,t),this._one.startWithTarget(t),this._two.startWithTarget(t)},i.stop=function(){this._one.stop(),this._two.stop(),Jit.prototype.stop.call(this)},i.update=function(t){t=this._computeEaseTime(t),this._one&&this._one.update(t),this._two&&this._two.update(t)},i.reverse=function(){var t=e._actionOneTwo(this._one.reverse(),this._two.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},e}(srt);function crt(t){var e=t instanceof Array?t:arguments;if(1===e.length)return B(1020),null;e.length>0&&null==e[e.length-1]&&x(1015);for(var i=e[0],r=1;r<e.length;r++)null!=e[r]&&(i=urt._actionOneTwo(i,e[r]));return i}urt._actionOneTwo=function(t,e){var i=new urt;return i.initWithTwoActions(t,e),i};var _rt=function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;return i.update=function(){},i.reverse=function(){var t=new e(this._duration);return this._cloneDecoration(t),this._reverseEaseList(t),t},i.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithDuration(this._duration),t},e}(srt);function drt(t){return new _rt(t)}var prt=function(t){function e(e){var i;return(i=t.call(this)||this)._other=null,e&&i.initWithAction(e),i}s(e,t);var i=e.prototype;return i.initWithAction=function(t){return t?t===this._other?(B(1029),!1):!!srt.prototype.initWithDuration.call(this,t._duration)&&(this._other=t,!0):(B(1028),!1)},i.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithAction(this._other.clone()),t},i.startWithTarget=function(t){srt.prototype.startWithTarget.call(this,t),this._other.startWithTarget(t)},i.update=function(t){t=this._computeEaseTime(t),this._other&&this._other.update(1-t)},i.reverse=function(){return this._other.clone()},i.stop=function(){this._other.stop(),Jit.prototype.stop.call(this)},e}(srt),frt=function(t){function e(e,i,r){var n;if((n=t.call(this)||this)._opts=void 0,n._props=void 0,n._originProps=void 0,null==r)r=Object.create(null);else if(function(t){var e=" [Tween:] ",i=" option is not support in v + 3.0.0";t.delay&&E(e+"delay"+i),t.repeat&&E(e+"repeat"+i),t.repeatDelay&&E(e+"repeatDelay"+i),t.interpolation&&E(e+"interpolation"+i),t.onStop&&E(e+"onStop"+i)}(r),r.easing&&"string"==typeof r.easing&&(r.easing=function(t){var e=t.charAt(0);if(/[A-Z]/.test(e)){var i=(t=t.replace(e,e.toLowerCase())).split("-");if(2==i.length){var r=i[0];if("linear"==r)t="linear";else{var n=i[1];switch(r){case"quadratic":t="quad"+n;break;case"quartic":t="quart"+n;break;case"quintic":t="quint"+n;break;case"sinusoidal":t="sine"+n;break;case"exponential":t="expo"+n;break;case"circular":t="circ"+n;break;default:t=r+n}}}}return t}(r.easing)),r.progress||(r.progress=n.progress),r.easing&&"string"==typeof r.easing){var s=r.easing;r.easing=BG[s],r.easing||I(1031,s)}for(var a in n._opts=r,n._props=Object.create(null),i)if(i.hasOwnProperty(a)){var o=i[a];if(o&&"function"!=typeof o){var h=void 0,l=void 0;void 0!==o.value&&(o.easing||o.progress)&&("string"==typeof o.easing?!(h=h[o.easing])&&I(1031,o.easing):h=o.easing,l=o.progress,o=o.value);var u=Object.create(null);u.value=o,u.easing=h,u.progress=l,n._props[a]=u}}return n._originProps=i,n.initWithDuration(e),n}s(e,t);var i=e.prototype;return i.clone=function(){var t=new e(this._duration,this._originProps,this._opts);return this._cloneDecoration(t),t},i.startWithTarget=function(t){srt.prototype.startWithTarget.call(this,t);var e=!!this._opts.relative,i=this._props;for(var r in i){var n=t[r];if(void 0!==n){var s=i[r],a=s.value;if("number"==typeof n)s.start=n,s.current=n,s.end=e?n+a:a;else if("object"==typeof n)for(var o in null==s.start&&(s.start={},s.current={},s.end={}),a)isNaN(n[o])||(s.start[o]=n[o],s.current[o]=n[o],s.end[o]=e?n[o]+a[o]:a[o])}}this._opts.onStart&&this._opts.onStart(this.target)},i.update=function(t){var e=this.target;if(e){var i=this._props,r=this._opts,n=t;r.easing&&(n=r.easing(t));var s=r.progress;for(var a in i){var o=i[a],h=o.easing?o.easing(t):n,l=o.progress?o.progress:s,u=o.start,c=o.end;if("number"==typeof u)o.current=l(u,c,o.current,h);else if("object"==typeof u)for(var _ in u)o.current[_]=l(u[_],c[_],o.current[_],h);e[a]=o.current}r.onUpdate&&r.onUpdate(this.target,t),1==t&&r.onComplete&&r.onComplete(this.target)}},i.progress=function(t,e,i,r){return t+(e-t)*r},e}(srt),mrt=function(t){function e(e){var i;return(i=t.call(this)||this)._props=void 0,i._props={},void 0!==e&&i.init(e),i}s(e,t);var i=e.prototype;return i.init=function(t){for(var e in t)this._props[e]=t[e];return!0},i.update=function(){var t=this._props,e=this.target;for(var i in t)e[i]=t[i]},i.clone=function(){var t=new e;return t.init(this._props),t},e}(trt),grt=t("Tween",function(){function t(t){this._actions=[],this._finalAction=null,this._target=null,this._tag=Jit.TAG_INVALID,this._target=void 0===t?null:t}var e=t.prototype;return e.tag=function(t){return this._tag=t,this},e.then=function(t){return t instanceof Jit?this._actions.push(t.clone()):this._actions.push(t._union()),this},e.target=function(t){return this._target=t,this},e.start=function(){return this._target?(this._finalAction&&Qit.instance.ActionManager.removeAction(this._finalAction),this._finalAction=this._union(),this._finalAction.setTag(this._tag),Qit.instance.ActionManager.addAction(this._finalAction,this._target,!1),this):(E("Please set target to tween first"),this)},e.stop=function(){return this._finalAction&&Qit.instance.ActionManager.removeAction(this._finalAction),this},e.clone=function(t){var e=this._union();return vrt(t).then(e.clone())},e.union=function(){var t=this._union();return this._actions.length=0,this._actions.push(t),this},e.to=function(t,e,i){(i=i||Object.create(null)).relative=!1;var r=new frt(t,e,i);return this._actions.push(r),this},e.by=function(t,e,i){(i=i||Object.create(null)).relative=!0;var r=new frt(t,e,i);return this._actions.push(r),this},e.set=function(t){var e=new mrt(t);return this._actions.push(e),this},e.delay=function(t){var e=drt(t);return this._actions.push(e),this},e.call=function(t){var e=new nrt(t,void 0,void 0);return this._actions.push(e),this},e.sequence=function(){var e=t._wrappedSequence.apply(t,arguments);return this._actions.push(e),this},e.parallel=function(){var e=t._wrappedParallel.apply(t,arguments);return this._actions.push(e),this},e.repeat=function(e,i){if(e==1/0)return this.repeatForever(i);var r,n=this._actions;return r=i instanceof t?i._union():n.pop(),n.push(function(t,e){return new hrt(t,e)}(r,e)),this},e.repeatForever=function(e){var i,r=this._actions;return i=e instanceof t?e._union():r.pop(),r.push(function(t){return new lrt(t)}(i)),this},e.reverseTime=function(e){var i,r=this._actions;return i=e instanceof t?e._union():r.pop(),r.push(function(t){return new prt(t)}(i)),this},e.hide=function(){var t=new irt;return this._actions.push(t),this},e.show=function(){var t=new ert;return this._actions.push(t),this},e.removeSelf=function(){var t=new rrt(!1);return this._actions.push(t),this},t.stopAll=function(){Qit.instance.ActionManager.removeAllActions()},t.stopAllByTag=function(t,e){Qit.instance.ActionManager.removeActionByTag(t,e)},t.stopAllByTarget=function(t){Qit.instance.ActionManager.removeAllActionsFromTarget(t)},e._union=function(){var t=this._actions;return 1===t.length?t[0]:ort(t)},e._destroy=function(){this.stop()},t._wrappedSequence=function(){var e=t._tmp_args;e.length=0;for(var i=arguments.length,r=0;r<i;r++){var n=e[r]=r<0||arguments.length<=r?void 0:arguments[r];n instanceof t&&(e[r]=n._union())}return ort.apply(ort,e)},t._wrappedParallel=function(){var e=t._tmp_args;e.length=0;for(var i=arguments.length,r=0;r<i;r++){var n=e[r]=r<0||arguments.length<=r?void 0:arguments[r];n instanceof t&&(e[r]=n._union())}return crt.apply(crt,e)},t}());function vrt(t){return new grt(t)}function yrt(t){return E("tweenUtil' is deprecated, please use 'tween' instead "),new grt(t)}grt._tmp_args=[],_.Tween=grt,_.tween=vrt,_.tweenUtil=yrt;var Trt,Ert,Srt,brt,Art,Crt,wrt,Rrt,xrt,Ort,Irt,Mrt,Brt,Prt,Nrt,Lrt,Frt,Drt,Urt,krt,zrt,Grt,Hrt,Vrt,Wrt,jrt,Xrt,Yrt,qrt,Krt,Zrt,Qrt,Jrt,$rt,tnt,ent,int,rnt,nnt,snt,ant,ont,hnt,lnt=new Cs,unt=new Hs;function cnt(t,e,i,r){var n=i.data,s=e.acquireBufferBatch(),a=s.byteOffset>>2,o=i.vertexCount,h=s.indicesOffset,l=s.vertexOffset;s.request(o,i.indicesCount)||(s=e.currBufferBatch,o=0,h=0,l=0);var u=s.vData,c=s.iData;t.getWorldMatrix(unt);for(var _=0;_<o;_++){var d=n[_];Cs.set(lnt,d.x,d.y,0),Cs.transformMat4(lnt,lnt,unt),u[a++]=lnt.x,u[a++]=lnt.y,u[a++]=lnt.z,u[a++]=d.u,u[a++]=d.v,Qs.toArray(u,r,a),a+=4}for(var p=0,f=o/4;p<f;p++){var m=l+4*p;c[h++]=m,c[h++]=m+1,c[h++]=m+2,c[h++]=m+1,c[h++]=m+3,c[h++]=m+2}}!function(t){t[t.SIMPLE=0]="SIMPLE",t[t.SLICED=1]="SLICED",t[t.TILED=2]="TILED",t[t.FILLED=3]="FILLED"}(snt||(snt={})),Ft(snt),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL",t[t.RADIAL=2]="RADIAL"}(ant||(ant={})),Ft(ant),function(t){t[t.CUSTOM=0]="CUSTOM",t[t.TRIMMED=1]="TRIMMED",t[t.RAW=2]="RAW"}(ont||(ont={})),Ft(ont),function(t){t.SPRITE_FRAME_CHANGED="spriteframe-changed"}(hnt||(hnt={}));var _nt,dnt,pnt,fnt,mnt,gnt,vnt,ynt,Tnt,Ent,Snt,bnt,Ant,Cnt,wnt,Rnt,xnt,Ont,Int,Mnt,Bnt,Pnt,Nnt,Lnt,Fnt,Dnt,Unt,knt,znt,Gnt,Hnt,Vnt,Wnt,jnt,Xnt,Ynt,qnt,Knt,Znt,Qnt,Jnt,$nt,tst,est,ist,rst,nst,sst,ast,ost,hst,lst,ust,cst=function(e){return t({Sprite:e,SpriteComponent:e}),e}((Trt=Ne("cc.Sprite"),Ert=qe(),Srt=Fe(110),brt=We(),Art=pi(zx),Crt=si(),wrt=$e(),Rrt=pi(um),xrt=si(),Ort=$e(),Irt=pi(snt),Mrt=si(),Brt=$e(),Prt=pi(ant),Nrt=$e(),Lrt=$e(),Frt=ti(),Drt=$e(),Urt=ti(),krt=$e(),zrt=si(),Grt=$e(),Hrt=pi(ont),Vrt=si(),Wrt=$e(),Trt(jrt=Ert(jrt=Srt(jrt=brt((nnt=rnt=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"_spriteFrame",Yrt,a(e)),l(e,"_type",qrt,a(e)),l(e,"_fillType",Krt,a(e)),l(e,"_sizeMode",Zrt,a(e)),l(e,"_fillCenter",Qrt,a(e)),l(e,"_fillStart",Jrt,a(e)),l(e,"_fillRange",$rt,a(e)),l(e,"_isTrimmedMode",tnt,a(e)),l(e,"_useGrayscale",ent,a(e)),l(e,"_atlas",int,a(e)),e}s(e,t);var i=e.prototype;return i.__preload=function(){this.changeMaterialForDefine(),t.prototype.__preload.call(this),this._spriteFrame&&(this._spriteFrame.on("load",this._markForUpdateUvDirty,this),this._markForUpdateUvDirty())},i.onEnable=function(){t.prototype.onEnable.call(this),this._activateMaterial()},i.onDestroy=function(){this.destroyRenderData(),this._spriteFrame&&this._spriteFrame.off("load"),t.prototype.onDestroy.call(this)},i.changeSpriteFrameFromAtlas=function(t){if(this._atlas){var e=this._atlas.getSpriteFrame(t);this.spriteFrame=e}else console.warn("SpriteAtlas is null.")},i.changeMaterialForDefine=function(){var t;this._spriteFrame&&(t=this._spriteFrame.texture);var e=!1;if(t instanceof np){var i=t.getPixelFormat();e=i===Rd.RGBA_ETC1||i===Rd.RGB_A_PVRTC_4BPPV1||i===Rd.RGB_A_PVRTC_2BPPV1}e&&this.grayscale?this._instanceMaterialType=dF.USE_ALPHA_SEPARATED_AND_GRAY:e?this._instanceMaterialType=dF.USE_ALPHA_SEPARATED:this.grayscale?this._instanceMaterialType=dF.GRAYSCALE:this._instanceMaterialType=dF.ADD_COLOR_AND_TEXTURE,this.updateMaterial()},i._render=function(t){t.commitComp(this,this._spriteFrame,this._assembler,null)},i._canRender=function(){if(!t.prototype._canRender.call(this))return!1;var e=this._spriteFrame;return!(!e||!e.textureLoaded())},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.getRenderMaterial(0),this.markForUpdateRenderData(),this._updateColor())},i._applySpriteSize=function(){if(this._spriteFrame){if(ont.RAW===this._sizeMode){var t=this._spriteFrame.originalSize;this.node._uiProps.uiTransformComp.setContentSize(t)}else if(ont.TRIMMED===this._sizeMode){var e=this._spriteFrame.getRect();this.node._uiProps.uiTransformComp.setContentSize(e.width,e.height)}this._activateMaterial()}},i._resized=function(){},i._activateMaterial=function(){var t=this._spriteFrame,e=this.getRenderMaterial(0);_.game.renderType!==_.game.RENDER_TYPE_CANVAS?(t&&e&&this.markForUpdateRenderData(),this._renderData&&(this._renderData.material=e)):this.markForUpdateRenderData()},i._onTextureLoaded=function(){this.isValid&&(this.changeMaterialForDefine(),this._applySpriteSize())},i._applySpriteFrame=function(t){var e=this._spriteFrame;this._renderData&&(t&&t.off("load",this._markForUpdateUvDirty),e&&e.on("load",this._markForUpdateUvDirty,this),this._renderData.uvDirty||(this._renderData.uvDirty=!t||!e||t.uvHash!==e.uvHash),this._renderDataFlag=this._renderData.uvDirty),e&&(t&&e===t||(e.loaded?this._onTextureLoaded():e.once("load",this._onTextureLoaded,this)))},i._markForUpdateUvDirty=function(){this._renderData&&(this._renderData.uvDirty=!0,this._renderDataFlag=!0)},r(e,[{key:"spriteAtlas",get:function(){return this._atlas},set:function(t){this._atlas!==t&&(this._atlas=t)}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){if(this._spriteFrame!==t){var e=this._spriteFrame;this._spriteFrame=t,this.markForUpdateRenderData(!1),this._applySpriteFrame(e)}}},{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this._flushAssembler())}},{key:"fillType",get:function(){return this._fillType},set:function(t){this._fillType!==t&&(t===ant.RADIAL||this._fillType===ant.RADIAL?(this.destroyRenderData(),this._renderData=null):this._renderData&&this.markForUpdateRenderData(!0)),this._fillType=t,this._flushAssembler()}},{key:"fillCenter",get:function(){return this._fillCenter},set:function(t){this._fillCenter.x=t.x,this._fillCenter.y=t.y,this._type===snt.FILLED&&this._renderData&&this.markForUpdateRenderData()}},{key:"fillStart",get:function(){return this._fillStart},set:function(t){this._fillStart=Ir(t,-1,1),this._type===snt.FILLED&&this._renderData&&(this.markForUpdateRenderData(),this._renderData.uvDirty=!0)}},{key:"fillRange",get:function(){return this._fillRange},set:function(t){this._fillRange=Ir(t,-1,1),this._type===snt.FILLED&&this._renderData&&(this.markForUpdateRenderData(),this._renderData.uvDirty=!0)}},{key:"trim",get:function(){return this._isTrimmedMode},set:function(t){this._isTrimmedMode!==t&&(this._isTrimmedMode=t,this._type===snt.SIMPLE&&this._renderData&&this.markForUpdateRenderData(!0))}},{key:"grayscale",get:function(){return this._useGrayscale},set:function(t){this._useGrayscale!==t&&(this._useGrayscale=t,this._instanceMaterialType=!0===t?dF.GRAYSCALE:dF.ADD_COLOR_AND_TEXTURE,this.updateMaterial())}},{key:"sizeMode",get:function(){return this._sizeMode},set:function(t){this._sizeMode!==t&&(this._sizeMode=t,t!==ont.CUSTOM&&this._applySpriteSize())}}]),e}(fF),rnt.FillType=ant,rnt.Type=snt,rnt.SizeMode=ont,rnt.EventType=hnt,u((Xrt=nnt).prototype,"spriteAtlas",[Art,Crt,wrt],Object.getOwnPropertyDescriptor(Xrt.prototype,"spriteAtlas"),Xrt.prototype),u(Xrt.prototype,"spriteFrame",[Rrt,xrt,Ort],Object.getOwnPropertyDescriptor(Xrt.prototype,"spriteFrame"),Xrt.prototype),u(Xrt.prototype,"type",[Irt,Mrt,Brt],Object.getOwnPropertyDescriptor(Xrt.prototype,"type"),Xrt.prototype),u(Xrt.prototype,"fillType",[Prt,Nrt],Object.getOwnPropertyDescriptor(Xrt.prototype,"fillType"),Xrt.prototype),u(Xrt.prototype,"fillCenter",[Lrt],Object.getOwnPropertyDescriptor(Xrt.prototype,"fillCenter"),Xrt.prototype),u(Xrt.prototype,"fillStart",[Frt,Drt],Object.getOwnPropertyDescriptor(Xrt.prototype,"fillStart"),Xrt.prototype),u(Xrt.prototype,"fillRange",[Urt,krt],Object.getOwnPropertyDescriptor(Xrt.prototype,"fillRange"),Xrt.prototype),u(Xrt.prototype,"trim",[zrt,Grt],Object.getOwnPropertyDescriptor(Xrt.prototype,"trim"),Xrt.prototype),u(Xrt.prototype,"grayscale",[Ke],Object.getOwnPropertyDescriptor(Xrt.prototype,"grayscale"),Xrt.prototype),u(Xrt.prototype,"sizeMode",[Hrt,Vrt,Wrt],Object.getOwnPropertyDescriptor(Xrt.prototype,"sizeMode"),Xrt.prototype),Yrt=u(Xrt.prototype,"_spriteFrame",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qrt=u(Xrt.prototype,"_type",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return snt.SIMPLE}}),Krt=u(Xrt.prototype,"_fillType",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ant.HORIZONTAL}}),Zrt=u(Xrt.prototype,"_sizeMode",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ont.TRIMMED}}),Qrt=u(Xrt.prototype,"_fillCenter",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Es(0,0)}}),Jrt=u(Xrt.prototype,"_fillStart",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$rt=u(Xrt.prototype,"_fillRange",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),tnt=u(Xrt.prototype,"_isTrimmedMode",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ent=u(Xrt.prototype,"_useGrayscale",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),int=u(Xrt.prototype,"_atlas",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jrt=Xrt))||jrt)||jrt)||jrt)||jrt)),_st=new Qs;!function(t){t[t.NONE=0]="NONE",t[t.COLOR=1]="COLOR",t[t.SPRITE=2]="SPRITE",t[t.SCALE=3]="SCALE"}(hst||(hst={})),Ft(hst),function(t){t.NORMAL="normal",t.HOVER="hover",t.PRESSED="pressed",t.DISABLED="disabled"}(lst||(lst={})),function(t){t.CLICK="click"}(ust||(ust={}));var dst,pst,fst,mst,gst,vst,yst,Tst,Est,Sst,bst,Ast,Cst,wst,Rst,xst,Ost,Ist,Mst,Bst,Pst,Nst,Lst,Fst,Dst,Ust,kst,zst,Gst,Hst,Vst,Wst,jst,Xst,Yst,qst,Kst,Zst,Qst,Jst,$st,tat,eat,iat,rat,nat,sat,aat,oat,hat,lat,uat,cat,_at,dat,pat,fat,mat,gat,vat,yat,Tat,Eat,Sat=function(e){return t({Button:e,ButtonComponent:e}),e}((_nt=Ne("cc.Button"),dnt=qe(),pnt=Fe(110),fnt=We(),mnt=Le(Vg),gnt=pi(py),vnt=si(),ynt=$e(),Tnt=si(),Ent=$e(),Snt=pi(hst),bnt=si(),Ant=$e(),Cnt=$e(),wnt=$e(),Rnt=$e(),xnt=$e(),Ont=ei(),Int=ii(),Mnt=$e(),Bnt=$e(),Pnt=pi(um),Nnt=$e(),Lnt=pi(um),Fnt=$e(),Dnt=pi(um),Unt=$e(),knt=pi(um),znt=$e(),Gnt=pi([BP]),Hnt=si(),Vnt=$e(),_nt(Wnt=dnt(Wnt=pnt(Wnt=fnt(Wnt=mnt(Wnt=Ve((ost=ast=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"clickEvents",Xnt,a(e)),l(e,"_interactable",Ynt,a(e)),l(e,"_transition",qnt,a(e)),l(e,"_normalColor",Knt,a(e)),l(e,"_hoverColor",Znt,a(e)),l(e,"_pressedColor",Qnt,a(e)),l(e,"_disabledColor",Jnt,a(e)),l(e,"_normalSprite",$nt,a(e)),l(e,"_hoverSprite",tst,a(e)),l(e,"_pressedSprite",est,a(e)),l(e,"_disabledSprite",ist,a(e)),l(e,"_duration",rst,a(e)),l(e,"_zoomScale",nst,a(e)),l(e,"_target",sst,a(e)),e._pressed=!1,e._hovered=!1,e._fromColor=new Qs,e._toColor=new Qs,e._time=0,e._transitionFinished=!0,e._fromScale=new Cs,e._toScale=new Cs,e._originalScale=null,e._sprite=null,e._targetScale=new Cs,e}s(e,t);var i=e.prototype;return i.__preload=function(){this.target||(this.target=this.node);var t=this.node.getComponent(cst);t&&(this._normalSprite=t.spriteFrame),this._applyTarget(),this._resetState()},i.onEnable=function(){this.node.on(gg.TOUCH_START,this._onTouchBegan,this),this.node.on(gg.TOUCH_MOVE,this._onTouchMove,this),this.node.on(gg.TOUCH_END,this._onTouchEnded,this),this.node.on(gg.TOUCH_CANCEL,this._onTouchCancel,this),this.node.on(gg.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.on(gg.MOUSE_LEAVE,this._onMouseMoveOut,this)},i.onDisable=function(){this._resetState(),this.node.off(gg.TOUCH_START,this._onTouchBegan,this),this.node.off(gg.TOUCH_MOVE,this._onTouchMove,this),this.node.off(gg.TOUCH_END,this._onTouchEnded,this),this.node.off(gg.TOUCH_CANCEL,this._onTouchCancel,this),this.node.off(gg.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.off(gg.MOUSE_LEAVE,this._onMouseMoveOut,this)},i.update=function(t){var e=this.target;if(!this._transitionFinished&&e&&(this._transition===hst.COLOR||this._transition===hst.SCALE)){this._time+=t;var i=1;if(this._duration>0&&(i=this._time/this._duration),i>=1&&(i=1),this._transition===hst.COLOR){var r=e._uiProps.uiComp;Qs.lerp(_st,this._fromColor,this._toColor,i),r&&(r.color=_st)}else this.transition===hst.SCALE&&(e.getScale(this._targetScale),this._targetScale.x=Br(this._fromScale.x,this._toScale.x,i),this._targetScale.y=Br(this._fromScale.y,this._toScale.y,i),e.setScale(this._targetScale));1===i&&(this._transitionFinished=!0)}},i._resizeNodeToTargetNode=function(){this.target&&this.target._uiProps.uiTransformComp},i._resetState=function(){this._pressed=!1,this._hovered=!1;var t=this.target;if(t){var e=t.getComponent(fF);if(e){var i=this._transition;i===hst.COLOR&&this._interactable?e.color=this._normalColor:i===hst.SCALE&&this._originalScale&&t.setScale(this._originalScale),this._transitionFinished=!0}}},i._registerNodeEvent=function(){this.node.on(gg.TOUCH_START,this._onTouchBegan,this),this.node.on(gg.TOUCH_MOVE,this._onTouchMove,this),this.node.on(gg.TOUCH_END,this._onTouchEnded,this),this.node.on(gg.TOUCH_CANCEL,this._onTouchCancel,this),this.node.on(gg.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.on(gg.MOUSE_LEAVE,this._onMouseMoveOut,this)},i._registerTargetEvent=function(t){t.on(gg.TRANSFORM_CHANGED,this._onTargetTransformChanged,this)},i._unregisterNodeEvent=function(){this.node.off(gg.TOUCH_START,this._onTouchBegan,this),this.node.off(gg.TOUCH_MOVE,this._onTouchMove,this),this.node.off(gg.TOUCH_END,this._onTouchEnded,this),this.node.off(gg.TOUCH_CANCEL,this._onTouchCancel,this),this.node.off(gg.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.off(gg.MOUSE_LEAVE,this._onMouseMoveOut,this)},i._unregisterTargetEvent=function(t){t.off(gg.TRANSFORM_CHANGED)},i._getTargetSprite=function(t){var e=null;return t&&(e=t.getComponent(cst)),e},i._applyTarget=function(){this.target&&(this._sprite=this._getTargetSprite(this.target),this._originalScale||(this._originalScale=new Cs),Cs.copy(this._originalScale,this.target.getScale()))},i._onTargetSpriteFrameChanged=function(t){this._transition===hst.SPRITE&&this._setCurrentStateSpriteFrame(t.spriteFrame)},i._setCurrentStateSpriteFrame=function(t){if(t)switch(this._getButtonState()){case lst.NORMAL:this._normalSprite=t;break;case lst.HOVER:this._hoverSprite=t;break;case lst.PRESSED:this._pressedSprite=t;break;case lst.DISABLED:this._disabledSprite=t}},i._onTargetColorChanged=function(t){this._transition===hst.COLOR&&this._setCurrentStateColor(t)},i._setCurrentStateColor=function(t){switch(this._getButtonState()){case lst.NORMAL:this._normalColor=t;break;case lst.HOVER:this._hoverColor=t;break;case lst.PRESSED:this._pressedColor=t;break;case lst.DISABLED:this._disabledColor=t}},i._onTargetTransformChanged=function(t){t|Uv.SCALE&&this._originalScale&&this._transition===hst.SCALE&&this._transitionFinished&&Cs.copy(this._originalScale,this.target.getScale())},i._onTouchBegan=function(t){this._interactable&&this.enabledInHierarchy&&(this._pressed=!0,this._updateState(),t&&(t.propagationStopped=!0))},i._onTouchMove=function(t){if(this._interactable&&this.enabledInHierarchy&&this._pressed){if(!t)return!1;var e=t.touch;if(!e)return!1;var i,r=this.node._uiProps.uiTransformComp.isHit(e.getUILocation());this._transition===hst.SCALE&&this.target&&this._originalScale?r?(Cs.copy(this._fromScale,this._originalScale),Cs.multiplyScalar(this._toScale,this._originalScale,this._zoomScale),this._transitionFinished=!1):(this._time=0,this._transitionFinished=!0,this.target.setScale(this._originalScale)):(i=r?lst.PRESSED:lst.NORMAL,this._applyTransition(i)),t&&(t.propagationStopped=!0)}},i._onTouchEnded=function(t){this._interactable&&this.enabledInHierarchy&&(this._pressed&&(BP.emitEvents(this.clickEvents,t),this.node.emit(ust.CLICK,this)),this._pressed=!1,this._updateState(),t&&(t.propagationStopped=!0))},i._onTouchCancel=function(){this._interactable&&this.enabledInHierarchy&&(this._pressed=!1,this._updateState())},i._onMouseMoveIn=function(){!this._pressed&&this.interactable&&this.enabledInHierarchy&&(this._transition!==hst.SPRITE||this._hoverSprite)&&(this._hovered||(this._hovered=!0,this._updateState()))},i._onMouseMoveOut=function(){this._hovered&&(this._hovered=!1,this._updateState())},i._updateState=function(){var t=this._getButtonState();this._applyTransition(t)},i._getButtonState=function(){var t=lst.NORMAL;return this._interactable?this._pressed?t=lst.PRESSED:this._hovered&&(t=lst.HOVER):t=lst.DISABLED,t.toString()},i._updateColorTransition=function(t){var e,i=this[t+"Color"],r=null===(e=this.target)||void 0===e?void 0:e.getComponent(fF);r&&(t===lst.DISABLED?r.color=i:(this._fromColor=r.color.clone(),this._toColor=i,this._time=0,this._transitionFinished=!1))},i._updateSpriteTransition=function(t){var e=this[t+"Sprite"];this._sprite&&e&&(this._sprite.spriteFrame=e)},i._updateScaleTransition=function(t){this._interactable&&(t===lst.PRESSED?this._zoomUp():this._zoomBack())},i._zoomUp=function(){this._originalScale&&(Cs.copy(this._fromScale,this._originalScale),Cs.multiplyScalar(this._toScale,this._originalScale,this._zoomScale),this._time=0,this._transitionFinished=!1)},i._zoomBack=function(){this.target&&this._originalScale&&(Cs.copy(this._fromScale,this.target.getScale()),Cs.copy(this._toScale,this._originalScale),this._time=0,this._transitionFinished=!1)},i._applyTransition=function(t){var e=this._transition;e===hst.COLOR?this._updateColorTransition(t):e===hst.SPRITE?this._updateSpriteTransition(t):e===hst.SCALE&&this._updateScaleTransition(t)},r(e,[{key:"target",get:function(){return this._target||this.node},set:function(t){this._target!==t&&(this._target&&this._unregisterTargetEvent(this._target),this._target=t,this._applyTarget())}},{key:"interactable",get:function(){return this._interactable},set:function(t){this._interactable=t,this._updateState(),this._interactable||this._resetState()}},{key:"_resizeToTarget",set:function(t){t&&this._resizeNodeToTargetNode()}},{key:"transition",get:function(){return this._transition},set:function(t){this._transition!==t&&(this._transition===hst.COLOR?this._updateColorTransition(lst.NORMAL):this._transition===hst.SPRITE&&this._updateSpriteTransition(lst.NORMAL),this._transition=t,this._updateState())}},{key:"normalColor",get:function(){return this._normalColor},set:function(t){this._normalColor!==t&&(this._normalColor.set(t),this._updateState())}},{key:"pressedColor",get:function(){return this._pressedColor},set:function(t){this._pressedColor!==t&&this._pressedColor.set(t)}},{key:"hoverColor",get:function(){return this._hoverColor},set:function(t){this._hoverColor!==t&&this._hoverColor.set(t)}},{key:"disabledColor",get:function(){return this._disabledColor},set:function(t){this._disabledColor!==t&&(this._disabledColor.set(t),this._updateState())}},{key:"duration",get:function(){return this._duration},set:function(t){this._duration!==t&&(this._duration=t)}},{key:"zoomScale",get:function(){return this._zoomScale},set:function(t){this._zoomScale!==t&&(this._zoomScale=t)}},{key:"normalSprite",get:function(){return this._normalSprite},set:function(t){if(this._normalSprite!==t){this._normalSprite=t;var e=this.node.getComponent(cst);e&&(e.spriteFrame=t),this._updateState()}}},{key:"pressedSprite",get:function(){return this._pressedSprite},set:function(t){this._pressedSprite!==t&&(this._pressedSprite=t,this._updateState())}},{key:"hoverSprite",get:function(){return this._hoverSprite},set:function(t){this._hoverSprite!==t&&(this._hoverSprite=t,this._updateState())}},{key:"disabledSprite",get:function(){return this._disabledSprite},set:function(t){this._disabledSprite!==t&&(this._disabledSprite=t,this._updateState())}}]),e}(ds),ast.Transition=hst,ast.EventType=ust,u((jnt=ost).prototype,"target",[gnt,vnt,ynt],Object.getOwnPropertyDescriptor(jnt.prototype,"target"),jnt.prototype),u(jnt.prototype,"interactable",[Tnt,Ent],Object.getOwnPropertyDescriptor(jnt.prototype,"interactable"),jnt.prototype),u(jnt.prototype,"transition",[Snt,bnt,Ant],Object.getOwnPropertyDescriptor(jnt.prototype,"transition"),jnt.prototype),u(jnt.prototype,"normalColor",[Cnt],Object.getOwnPropertyDescriptor(jnt.prototype,"normalColor"),jnt.prototype),u(jnt.prototype,"pressedColor",[wnt],Object.getOwnPropertyDescriptor(jnt.prototype,"pressedColor"),jnt.prototype),u(jnt.prototype,"hoverColor",[Rnt],Object.getOwnPropertyDescriptor(jnt.prototype,"hoverColor"),jnt.prototype),u(jnt.prototype,"disabledColor",[xnt],Object.getOwnPropertyDescriptor(jnt.prototype,"disabledColor"),jnt.prototype),u(jnt.prototype,"duration",[Ont,Int,Mnt],Object.getOwnPropertyDescriptor(jnt.prototype,"duration"),jnt.prototype),u(jnt.prototype,"zoomScale",[Bnt],Object.getOwnPropertyDescriptor(jnt.prototype,"zoomScale"),jnt.prototype),u(jnt.prototype,"normalSprite",[Pnt,Nnt],Object.getOwnPropertyDescriptor(jnt.prototype,"normalSprite"),jnt.prototype),u(jnt.prototype,"pressedSprite",[Lnt,Fnt],Object.getOwnPropertyDescriptor(jnt.prototype,"pressedSprite"),jnt.prototype),u(jnt.prototype,"hoverSprite",[Dnt,Unt],Object.getOwnPropertyDescriptor(jnt.prototype,"hoverSprite"),jnt.prototype),u(jnt.prototype,"disabledSprite",[knt,znt],Object.getOwnPropertyDescriptor(jnt.prototype,"disabledSprite"),jnt.prototype),Xnt=u(jnt.prototype,"clickEvents",[Gnt,ke,Hnt,Vnt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ynt=u(jnt.prototype,"_interactable",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),qnt=u(jnt.prototype,"_transition",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hst.NONE}}),Knt=u(jnt.prototype,"_normalColor",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Qs.WHITE.clone()}}),Znt=u(jnt.prototype,"_hoverColor",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qs(211,211,211,255)}}),Qnt=u(jnt.prototype,"_pressedColor",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Qs.WHITE.clone()}}),Jnt=u(jnt.prototype,"_disabledColor",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qs(124,124,124,255)}}),$nt=u(jnt.prototype,"_normalSprite",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tst=u(jnt.prototype,"_hoverSprite",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),est=u(jnt.prototype,"_pressedSprite",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ist=u(jnt.prototype,"_disabledSprite",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rst=u(jnt.prototype,"_duration",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),nst=u(jnt.prototype,"_zoomScale",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),sst=u(jnt.prototype,"_target",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Wnt=jnt))||Wnt)||Wnt)||Wnt)||Wnt)||Wnt)||Wnt)),bat=t("CanvasPool",function(){function t(){this.pool=[]}t.getInstance=function(){return dst||(dst=new t),dst};var e=t.prototype;return e.get=function(){var t=this.pool.pop();if(!t){var e=document.createElement("canvas"),i=e.getContext("2d");t={canvas:e,context:i}}return t},e.put=function(t){this.pool.length>=32||this.pool.push(t)},t}()),Aat=Qs.WHITE.clone(),Cat=function(){this.u=0,this.v=0,this.w=0,this.h=0,this.texture=null,this.offsetX=0,this.offsetY=0,this.valid=!1,this.xAdvance=0},wat="rgba(255, 255, 255, "+(1/255).toFixed(3)+")",Rat=function(){function t(t,e){this.image=null,this.labelInfo=void 0,this.char=void 0,this.data=null,this.canvas=null,this.context=null,this.width=0,this.height=0,this.offsetY=0,this.hash=void 0,this.char=t,this.labelInfo=e,this.hash=t.charCodeAt(0)+e.hash}var e=t.prototype;return e.updateRenderData=function(){this._updateProperties(),this._updateTexture()},e.destroy=function(){this.image=null},e._updateProperties=function(){if(this.data=bat.getInstance().get(),this.canvas=this.data.canvas,this.context=this.data.context,this.context){this.context.font=this.labelInfo.fontDesc;var t=rd(this.context,this.char,this.labelInfo.fontDesc),e=2*this.labelInfo.margin+2;this.width=parseFloat(t.toFixed(2))+e,this.height=(1+X_)*this.labelInfo.fontSize+e,this.offsetY=-this.labelInfo.fontSize*X_/2}this.canvas.width!==this.width&&(this.canvas.width=this.width),this.canvas.height!==this.height&&(this.canvas.height=this.height),this.image||(this.image=new Dd),this.image.reset(this.canvas)},e._updateTexture=function(){if(this.context&&this.canvas){var t=this.context,e=this.labelInfo,i=this.canvas.width,r=this.canvas.height;t.textAlign="center",t.textBaseline="alphabetic",t.clearRect(0,0,i,r),t.fillStyle=wat,t.fillRect(0,0,i,r),t.font=e.fontDesc;var n=e.fontSize,s=i/2,a=r/2+n*Y_+0*n,o=e.color;if(t.lineJoin="round",t.fillStyle="rgba("+o.r+", "+o.g+", "+o.b+", 1)",e.isOutlined){var h=e.out||Aat;t.strokeStyle="rgba("+h.r+", "+h.g+", "+h.b+", "+h.a/255+")",t.lineWidth=2*e.margin,t.strokeText(this.char,s,a)}t.fillText(this.char,s,a)}},t}(),xat=function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;return i.initWithSize=function(t,e,i){void 0===i&&(i=Rd.RGBA8888),this.reset({width:t,height:e,format:i}),this.loaded=!0,this.emit("load")},i.drawTextureAt=function(t,e,i){var r=this.getGFXTexture();if(t&&r){var n=this._getGFXDevice();if(n){var s=new vu;s.texOffset.x=e,s.texOffset.y=i,s.texExtent.width=t.width,s.texExtent.height=t.height,n.copyTexImagesToTexture([t.data],r,[s])}else console.warn("Unable to get device")}},e}(pp),Oat=function(){function t(t,e){this._x=0,this._y=0,this._nextY=0,this._width=0,this._height=0,this._halfBleed=0,this._dirty=!1;var i=new xat;i.initWithSize(t,e),this.fontDefDictionary=new cO(i),this._halfBleed=1,this._width=t,this._height=e,NF.on(PF.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)}r(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]);var e=t.prototype;return e.insertLetterTexture=function(t){var e=t.image,i=NF.root.device;if(!e||!this.fontDefDictionary||!i)return null;var r=e.width,n=e.height;if(this._x+r+0>this._width&&(this._x=0,this._y=this._nextY),this._y+n>this._nextY&&(this._nextY=this._y+n+0),this._nextY>this._height)return null;this.fontDefDictionary.texture.drawTextureAt(e,this._x,this._y),this._dirty=!0;var s=new Cat;return s.u=this._x+this._halfBleed,s.v=this._y+this._halfBleed,s.texture=this.fontDefDictionary.texture,s.valid=!0,s.w=t.width-2,s.h=t.height-2,s.xAdvance=s.w,s.offsetY=t.offsetY,this._x+=r+0,this.fontDefDictionary.addLetterDefinitions(t.hash,s),s},e.update=function(){this._dirty&&(this._dirty=!1)},e.reset=function(){this._x=0,this._y=0,this._nextY=0,this.fontDefDictionary.clear()},e.destroy=function(){this.reset(),this.fontDefDictionary&&(this.fontDefDictionary.texture.destroy(),this.fontDefDictionary.texture=null)},e.getTexture=function(){return this.fontDefDictionary.getTexture()},e.beforeSceneLoad=function(){this.clearAllCache()},e.clearAllCache=function(){this.destroy();var t=new xat;t.initWithSize(this._width,this._height),this.fontDefDictionary.texture=t},e.getLetter=function(t){return this.fontDefDictionary.letterDefinitions[t]},e.getLetterDefinitionForChar=function(t,e){var i=t.charCodeAt(0)+e.hash,r=this.fontDefDictionary.letterDefinitions[i];if(!r){var n=new Rat(t,e);n.updateRenderData(),r=this.insertLetterTexture(n),n.destroy()}return r},t}(),Iat={fontAtlas:null,fontSize:0,lineHeight:0,hAlign:0,vAlign:0,hash:"",fontFamily:"",fontDesc:"Arial",color:Qs.WHITE.clone(),isOutlined:!1,out:Qs.WHITE.clone(),margin:0};!function(t){t[t.LEFT=0]="LEFT",t[t.CENTER=1]="CENTER",t[t.RIGHT=2]="RIGHT"}(vat||(vat=t("HorizontalTextAlignment",{}))),Ft(vat),function(t){t[t.TOP=0]="TOP",t[t.CENTER=1]="CENTER",t[t.BOTTOM=2]="BOTTOM"}(yat||(yat=t("VerticalTextAlignment",{}))),Ft(yat),function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.SHRINK=2]="SHRINK",t[t.RESIZE_HEIGHT=3]="RESIZE_HEIGHT"}(Tat||(Tat=t("Overflow",{}))),Ft(Tat),function(t){t[t.NONE=0]="NONE",t[t.BITMAP=1]="BITMAP",t[t.CHAR=2]="CHAR"}(Eat||(Eat=t("CacheMode",{}))),Ft(Eat);var Mat,Bat,Pat,Nat=function(e){return t({Label:e,LabelComponent:e}),e}((pst=Ne("cc.Label"),fst=qe(),mst=Fe(110),gst=We(),vst=si(),yst=$e(),Tst=pi(vat),Est=si(),Sst=$e(),bst=pi(yat),Ast=si(),Cst=$e(),wst=si(),Rst=$e(),xst=si(),Ost=$e(),Ist=si(),Mst=$e(),Bst=pi(Tat),Pst=si(),Nst=$e(),Lst=si(),Fst=$e(),Dst=pi(Jx),Ust=si(),kst=$e(),zst=si(),Gst=$e(),Hst=pi(Eat),Vst=si(),Wst=$e(),jst=si(),Xst=$e(),Yst=si(),qst=$e(),Kst=si(),Zst=$e(),Qst=Ze(),pst(Jst=fst(Jst=mst(Jst=gst((gat=mat=function(t){function e(){var e;return l(e=t.call(this)||this,"_string",tat,a(e)),l(e,"_horizontalAlign",eat,a(e)),l(e,"_verticalAlign",iat,a(e)),l(e,"_actualFontSize",rat,a(e)),l(e,"_fontSize",nat,a(e)),l(e,"_fontFamily",sat,a(e)),l(e,"_lineHeight",aat,a(e)),l(e,"_overflow",oat,a(e)),l(e,"_enableWrapText",hat,a(e)),l(e,"_font",lat,a(e)),l(e,"_isSystemFontUsed",uat,a(e)),e._spacingX=0,l(e,"_isItalic",cat,a(e)),l(e,"_isBold",_at,a(e)),l(e,"_isUnderline",dat,a(e)),l(e,"_underlineHeight",pat,a(e)),l(e,"_cacheMode",fat,a(e)),e._N$file=null,e._texture=null,e._ttfSpriteFrame=null,e._userDefinedFont=null,e._assemblerData=null,e._fontAtlas=null,e._letterTexture=null,e._ttfSpriteFrame=null,e}s(e,t),r(e,[{key:"string",get:function(){return this._string},set:function(t){t+="",this._string!==t&&(this._string=t,this.updateRenderData())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(t){this._horizontalAlign!==t&&(this._horizontalAlign=t,this.updateRenderData())}},{key:"verticalAlign",get:function(){return this._verticalAlign},set:function(t){this._verticalAlign!==t&&(this._verticalAlign=t,this.updateRenderData())}},{key:"actualFontSize",get:function(){return this._actualFontSize},set:function(t){this._actualFontSize=t}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.updateRenderData())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this.updateRenderData())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.updateRenderData())}},{key:"overflow",get:function(){return this._overflow},set:function(t){this._overflow!==t&&(this._overflow=t,this.updateRenderData())}},{key:"enableWrapText",get:function(){return this._enableWrapText},set:function(t){this._enableWrapText!==t&&(this._enableWrapText=t,this.updateRenderData())}},{key:"font",get:function(){return this._font},set:function(t){this._font!==t&&(this._isSystemFontUsed=!t,this._font=t,this._renderData&&(this.destroyRenderData(),this._renderData=null),this._fontAtlas=null,this.updateRenderData(!0))}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this.destroyRenderData(),this._renderData=null,this._isSystemFontUsed=!!t,t&&(this.font=null,this._flushAssembler(),this.updateRenderData()))}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(t){this._cacheMode!==t&&(this._cacheMode===Eat.CHAR&&(this._ttfSpriteFrame=null),this._cacheMode=t,this.updateRenderData(!0))}},{key:"spriteFrame",get:function(){return this._texture}},{key:"isBold",get:function(){return this._isBold},set:function(t){this._isBold!==t&&(this._isBold=t,this.updateRenderData())}},{key:"isItalic",get:function(){return this._isItalic},set:function(t){this._isItalic!==t&&(this._isItalic=t,this.updateRenderData())}},{key:"isUnderline",get:function(){return this._isUnderline},set:function(t){this._isUnderline!==t&&(this._isUnderline=t,this.updateRenderData())}},{key:"underlineHeight",get:function(){return this._underlineHeight},set:function(t){this._underlineHeight!==t&&(this._underlineHeight=t,this.updateRenderData())}},{key:"assemblerData",get:function(){return this._assemblerData}},{key:"fontAtlas",get:function(){return this._fontAtlas},set:function(t){this._fontAtlas=t}},{key:"spacingX",get:function(){return this._spacingX},set:function(t){this._spacingX!==t&&(this._spacingX=t,this.updateRenderData())}},{key:"_bmFontOriginalSize",get:function(){return this._font instanceof _O?this._font.fontSize:-1}}]);var i=e.prototype;return i.onEnable=function(){t.prototype.onEnable.call(this),this._font||this._isSystemFontUsed||(this.useSystemFont=!0),this._isSystemFontUsed&&!this._fontFamily&&(this.fontFamily="Arial"),this.updateRenderData(!0)},i.onDisable=function(){t.prototype.onDisable.call(this)},i.onDestroy=function(){if(this._assembler&&this._assembler.resetAssemblerData&&this._assembler.resetAssemblerData(this._assemblerData),this._assemblerData=null,this._ttfSpriteFrame){var e=this._ttfSpriteFrame.texture;if(e){var i=e;i.image&&i.image.destroy(),e.destroy()}this._ttfSpriteFrame=null}this._letterTexture=null,t.prototype.onDestroy.call(this)},i.updateRenderData=function(t){void 0===t&&(t=!1),this.markForUpdateRenderData(),t&&(this._flushAssembler(),this._applyFontTexture())},i._render=function(t){t.commitComp(this,this._texture,this._assembler,null)},i._updateColor=function(){this._font instanceof _O?t.prototype._updateColor.call(this):this.updateRenderData(!1)},i._canRender=function(){if(!t.prototype._canRender.call(this)||!this._string)return!1;var e=this._font;if(e&&e instanceof _O){var i=e.spriteFrame;if(!i||!i.textureLoaded())return!1}return!0},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.material)},i._applyFontTexture=function(){var t=this,e=this._font;if(e instanceof _O){var i=e.spriteFrame,r=function(){t._texture=i,t._assembler&&t._assembler.updateRenderData(t)};i&&(i.loaded||i.textureLoaded?r():i.once("load",r,this))}else{if(this.cacheMode===Eat.CHAR)this._letterTexture=this._assembler.getAssemblerData(),this._texture=this._letterTexture;else if(!this._ttfSpriteFrame){this._ttfSpriteFrame=new um,this._assemblerData=this._assembler.getAssemblerData();var n=new Dd(this._assemblerData.canvas)._texture;this._ttfSpriteFrame.texture=n}this.cacheMode!==Eat.CHAR&&(this._texture=this._ttfSpriteFrame),this._assembler&&this._assembler.updateRenderData(this)}},e}(fF),mat.HorizontalAlign=vat,mat.VerticalAlign=yat,mat.Overflow=Tat,mat.CacheMode=Eat,mat._canvasPool=bat.getInstance(),u(($st=gat).prototype,"string",[vst,yst,hi],Object.getOwnPropertyDescriptor($st.prototype,"string"),$st.prototype),u($st.prototype,"horizontalAlign",[Tst,Est,Sst],Object.getOwnPropertyDescriptor($st.prototype,"horizontalAlign"),$st.prototype),u($st.prototype,"verticalAlign",[bst,Ast,Cst],Object.getOwnPropertyDescriptor($st.prototype,"verticalAlign"),$st.prototype),u($st.prototype,"fontSize",[wst,Rst],Object.getOwnPropertyDescriptor($st.prototype,"fontSize"),$st.prototype),u($st.prototype,"fontFamily",[xst,Ost],Object.getOwnPropertyDescriptor($st.prototype,"fontFamily"),$st.prototype),u($st.prototype,"lineHeight",[Ist,Mst],Object.getOwnPropertyDescriptor($st.prototype,"lineHeight"),$st.prototype),u($st.prototype,"overflow",[Bst,Pst,Nst],Object.getOwnPropertyDescriptor($st.prototype,"overflow"),$st.prototype),u($st.prototype,"enableWrapText",[Lst,Fst],Object.getOwnPropertyDescriptor($st.prototype,"enableWrapText"),$st.prototype),u($st.prototype,"font",[Dst,Ust,kst],Object.getOwnPropertyDescriptor($st.prototype,"font"),$st.prototype),u($st.prototype,"useSystemFont",[zst,Gst],Object.getOwnPropertyDescriptor($st.prototype,"useSystemFont"),$st.prototype),u($st.prototype,"cacheMode",[Hst,Vst,Wst],Object.getOwnPropertyDescriptor($st.prototype,"cacheMode"),$st.prototype),u($st.prototype,"isBold",[jst,Xst],Object.getOwnPropertyDescriptor($st.prototype,"isBold"),$st.prototype),u($st.prototype,"isItalic",[Yst,qst],Object.getOwnPropertyDescriptor($st.prototype,"isItalic"),$st.prototype),u($st.prototype,"isUnderline",[Kst,Zst],Object.getOwnPropertyDescriptor($st.prototype,"isUnderline"),$st.prototype),u($st.prototype,"underlineHeight",[Qst,Ke],Object.getOwnPropertyDescriptor($st.prototype,"underlineHeight"),$st.prototype),tat=u($st.prototype,"_string",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"label"}}),eat=u($st.prototype,"_horizontalAlign",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return vat.CENTER}}),iat=u($st.prototype,"_verticalAlign",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return yat.CENTER}}),rat=u($st.prototype,"_actualFontSize",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),nat=u($st.prototype,"_fontSize",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),sat=u($st.prototype,"_fontFamily",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Arial"}}),aat=u($st.prototype,"_lineHeight",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),oat=u($st.prototype,"_overflow",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Tat.NONE}}),hat=u($st.prototype,"_enableWrapText",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),lat=u($st.prototype,"_font",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),uat=u($st.prototype,"_isSystemFontUsed",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),cat=u($st.prototype,"_isItalic",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_at=u($st.prototype,"_isBold",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),dat=u($st.prototype,"_isUnderline",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),pat=u($st.prototype,"_underlineHeight",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),fat=u($st.prototype,"_cacheMode",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Eat.NONE}}),Jst=$st))||Jst)||Jst)||Jst)||Jst)),Lat=function(){function t(){}return t.add=function(t){var e=this._tabIndexList;-1===e.indexOf(t)&&e.push(t)},t.remove=function(t){var e=this._tabIndexList,i=e.indexOf(t);-1!==i&&e.splice(i,1)},t.resort=function(){this._tabIndexList.sort((function(t,e){return t._delegate.tabIndex-e._delegate.tabIndex}))},t.next=function(t){var e=this._tabIndexList,i=e.indexOf(t);if(t.setFocus(!1),-1!==i){var r=e[i+1];r&&r._delegate.tabIndex>=0&&r.setFocus(!0)}},t}();Lat._tabIndexList=[],function(t){t[t.DEFAULT=0]="DEFAULT",t[t.DONE=1]="DONE",t[t.SEND=2]="SEND",t[t.SEARCH=3]="SEARCH",t[t.GO=4]="GO",t[t.NEXT=5]="NEXT"}(Mat||(Mat={})),Pt(Mat),function(t){t[t.ANY=0]="ANY",t[t.EMAIL_ADDR=1]="EMAIL_ADDR",t[t.NUMERIC=2]="NUMERIC",t[t.PHONE_NUMBER=3]="PHONE_NUMBER",t[t.URL=4]="URL",t[t.DECIMAL=5]="DECIMAL",t[t.SINGLE_LINE=6]="SINGLE_LINE"}(Bat||(Bat={})),Pt(Bat),function(t){t[t.PASSWORD=0]="PASSWORD",t[t.SENSITIVE=1]="SENSITIVE",t[t.INITIAL_CAPS_WORD=2]="INITIAL_CAPS_WORD",t[t.INITIAL_CAPS_SENTENCE=3]="INITIAL_CAPS_SENTENCE",t[t.INITIAL_CAPS_ALL_CHARACTERS=4]="INITIAL_CAPS_ALL_CHARACTERS",t[t.DEFAULT=5]="DEFAULT"}(Pat||(Pat={})),Pt(Pat);var Fat,Dat,Uat,kat,zat,Gat,Hat,Vat,Wat,jat,Xat,Yat,qat,Kat,Zat,Qat,Jat,$at,tot,eot,iot,rot,not,sot,aot,oot,hot,lot,uot,cot,_ot,dot,pot,fot,mot,got,vot,yot,Tot,Eot,Sot,bot,Aot,Cot,wot,Rot,xot,Oot,Iot,Mot,Bot,Pot,Not,Lot,Fot,Dot,Uot,kot,zot,Got,Hot,Vot=function(){function t(){this._editing=!1,this._delegate=null}var e=t.prototype;return e.init=function(){},e.onEnable=function(){},e.update=function(){},e.onDisable=function(){this._editing&&this.endEditing()},e.clear=function(){this._delegate=null},e.setTabIndex=function(){},e.setSize=function(){},e.setFocus=function(t){t?this.beginEditing():this.endEditing()},e.isFocused=function(){return this._editing},e.beginEditing=function(){},e.endEditing=function(){},t}(),Wot=new Hs,jot=new Hs,Xot=new Cs,Yot=null,qot=0,Kot=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._delegate=null,e._inputMode=-1,e._inputFlag=-1,e._returnType=-1,e.__eventListeners={},e.__fullscreen=!1,e.__autoResize=!1,e.__orientationChanged=void 0,e._edTxt=null,e._isTextArea=!1,e._textLabelFont=null,e._textLabelFontSize=null,e._textLabelFontColor=null,e._textLabelAlign=null,e._placeholderLabelFont=null,e._placeholderLabelFontSize=null,e._placeholderLabelFontColor=null,e._placeholderLabelAlign=null,e._placeholderLineHeight=null,e._placeholderStyleSheet=null,e._domId="EditBoxId_"+ ++qot,e}s(e,t);var i=e.prototype;return i.init=function(t){t&&(this._delegate=t,t.inputMode===Bat.ANY?this._createTextArea():this._createInput(),Lat.add(this),this.setTabIndex(t.tabIndex),this._initStyleSheet(),this._registerEventListeners(),this._addDomToGameContainer(),this.__fullscreen=zO.isAutoFullScreenEnabled(),this.__autoResize=zO._resizeWithBrowserSize)},i.clear=function(){this._removeEventListeners(),this._removeDomFromGameContainer(),Lat.remove(this),Yot===this&&(Yot=null),this._delegate=null},i.update=function(){this._updateMatrix()},i.setTabIndex=function(t){this._edTxt.tabIndex=t,Lat.resort()},i.setSize=function(t,e){var i=this._edTxt;i&&(i.style.width=t+"px",i.style.height=e+"px")},i.beginEditing=function(){Yot&&Yot!==this&&Yot.setFocus(!1),this._editing=!0,Yot=this,this._delegate._editBoxEditingDidBegan(),this._showDom(),this._edTxt.focus()},i.endEditing=function(){this._edTxt.blur()},i._createInput=function(){this._isTextArea=!1,this._edTxt=document.createElement("input")},i._createTextArea=function(){this._isTextArea=!0,this._edTxt=document.createElement("textarea")},i._addDomToGameContainer=function(){_.GAME_VIEW&&this._edTxt?(_.gameView.container.appendChild(this._edTxt),_.gameView.head.appendChild(this._placeholderStyleSheet)):PO.container&&this._edTxt&&(PO.container.appendChild(this._edTxt),document.head.appendChild(this._placeholderStyleSheet))},i._removeDomFromGameContainer=function(){(_.GAME_VIEW?Xt(_.gameView.container,this._edTxt):Xt(PO.container,this._edTxt))&&this._edTxt&&(_.GAME_VIEW?_.gameView.container.removeChild(this._edTxt):PO.container.removeChild(this._edTxt)),(_.GAME_VIEW?Xt(_.gameView.head,this._placeholderStyleSheet):Xt(document.head,this._placeholderStyleSheet))&&(_.GAME_VIEW?_.gameView.head.removeChild(this._placeholderStyleSheet):document.head.removeChild(this._placeholderStyleSheet)),this._edTxt=null,this._placeholderStyleSheet=null},i._showDom=function(){this._updateMaxLength(),this._updateInputType(),this._updateStyleSheet(),this._edTxt&&this._delegate&&(this._edTxt.style.display="",this._delegate._hideLabels()),Jr.isMobile&&this._showDomOnMobile()},i._hideDom=function(){var t=this._edTxt;t&&this._delegate&&(t.style.display="none",this._delegate._showLabels()),Jr.isMobile&&this._hideDomOnMobile()},i._showDomOnMobile=function(){Jr.os===Jr.OS_ANDROID&&(this.__fullscreen&&(zO.enableAutoFullScreen(!1),YO.exitFullScreen()),this.__autoResize&&zO.resizeWithBrowserSize(!1),this._adjustWindowScroll())},i._hideDomOnMobile=function(){var t=this;Jr.os===Jr.OS_ANDROID&&(this.__autoResize&&zO.resizeWithBrowserSize(!0),setTimeout((function(){Yot||t.__fullscreen&&zO.enableAutoFullScreen(!0)}),400)),this._scrollBackWindow()},i._adjustWindowScroll=function(){var t=this;setTimeout((function(){window.scrollY<40&&t._edTxt.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"})}),400)},i._scrollBackWindow=function(){setTimeout((function(){Jr.browserType!==Jr.BROWSER_TYPE_WECHAT||Jr.os!==Jr.OS_IOS?window.scrollTo(0,0):window.top&&window.top.scrollTo(0,0)}),400)},i._updateMatrix=function(){if(this._edTxt){var t=this._delegate.node,e=zO.getScaleX(),i=zO.getScaleY(),r=1,n=1;_.GAME_VIEW&&(r=_.gameView.canvas.width/_.game.canvas.width,n=_.gameView.canvas.height/_.game.canvas.height),e*=r,i*=n;var s=zO.getViewportRect(),a=zO.getDevicePixelRatio();t.getWorldMatrix(Wot);var o=t._uiProps.uiTransformComp;if(o&&Cs.set(Xot,-o.anchorX*o.width,-o.anchorY*o.height,Xot.z),Hs.transform(Wot,Wot,Xot),!t._uiProps.uiTransformComp)return!1;var h=NF.root.ui.getScreen(t._uiProps.uiTransformComp.visibility);if(_.GAME_VIEW&&(h=_.gameView.preview.canvasComp),h){h.node.getWorldRT(jot);var l=jot.m12,u=jot.m13,c=NO.center;jot.m12=c.x-(jot.m00*l+jot.m04*u),jot.m13=c.y-(jot.m01*l+jot.m05*u),Hs.multiply(jot,jot,Wot),e/=a,i/=a;var d=_.GAME_VIEW?_.gameView.container:PO.container,p=jot.m00*e,f=Wot.m01,m=Wot.m04,g=jot.m05*i,v=parseInt(d&&d.style.paddingLeft||"0");v+=s.x*r/a;var y=parseInt(d&&d.style.paddingBottom||"0");y+=s.y/a;var T="matrix("+p+","+-f+","+-m+","+g+","+(jot.m12*e+v)+","+-(jot.m13*i+y)+")";this._edTxt.style.transform=T,this._edTxt.style["-webkit-transform"]=T,this._edTxt.style["transform-origin"]="0px 100% 0px",this._edTxt.style["-webkit-transform-origin"]="0px 100% 0px"}}},i._updateInputType=function(){var t=this._delegate,e=t.inputMode,i=t.inputFlag,r=t.returnType,n=this._edTxt;if(this._inputMode!==e||this._inputFlag!==i||this._returnType!==r){if(this._inputMode=e,this._inputFlag=i,this._returnType=r,this._isTextArea){var s="none";return i===Pat.INITIAL_CAPS_ALL_CHARACTERS?s="uppercase":i===Pat.INITIAL_CAPS_WORD&&(s="capitalize"),void(n.style.textTransform=s)}if(n=n,i===Pat.PASSWORD)return n.type="password",void(n.style.textTransform="none");var a=n.type;e===Bat.EMAIL_ADDR?a="email":e===Bat.NUMERIC||e===Bat.DECIMAL?a="number":e===Bat.PHONE_NUMBER?(a="number",n.pattern="[0-9]*"):e===Bat.URL?a="url":(a="text",r===Mat.SEARCH&&(a="search")),n.type=a;var o="none";i===Pat.INITIAL_CAPS_ALL_CHARACTERS?o="uppercase":i===Pat.INITIAL_CAPS_WORD&&(o="capitalize"),n.style.textTransform=o}},i._updateMaxLength=function(){var t=this._delegate.maxLength;t<0&&(t=65535),this._edTxt.maxLength=t},i._initStyleSheet=function(){if(this._edTxt){var t=this._edTxt;t.style.color="#000000",t.style.border="0px",t.style.background="transparent",t.style.width="100%",t.style.height="100%",t.style.outline="medium",t.style.padding="0",t.style.textTransform="none",t.style.display="none",t.style.position="absolute",t.style.bottom="0px",t.style.left="2px",t.className="cocosEditBox",t.style.fontFamily="Arial",t.id=this._domId,this._isTextArea?(t.style.resize="none",t.style.overflowY="scroll"):((t=t).type="text",t.style["-moz-appearance"]="textfield"),this._placeholderStyleSheet=document.createElement("style")}},i._updateStyleSheet=function(){var t=this._delegate,e=this._edTxt;e&&t&&(e.value=t.string,e.placeholder=t.placeholder,this._updateTextLabel(t.textLabel),this._updatePlaceholderLabel(t.placeholderLabel))},i._updateTextLabel=function(t){if(t){var e=t.font;e=!e||e instanceof _O?t.fontFamily:e._fontFamily;var i=t.fontSize*t.node.scale.y;if((this._textLabelFont!==e||this._textLabelFontSize!==i||this._textLabelFontColor!==t.fontColor||this._textLabelAlign!==t.horizontalAlign)&&(this._textLabelFont=e,this._textLabelFontSize=i,this._textLabelFontColor=t.fontColor,this._textLabelAlign=t.horizontalAlign,this._edTxt)){var r=this._edTxt;switch(r.style.fontSize=i+"px",r.style.color=t.color.toCSS(),r.style.fontFamily=e,t.horizontalAlign){case Nat.HorizontalAlign.LEFT:r.style.textAlign="left";break;case Nat.HorizontalAlign.CENTER:r.style.textAlign="center";break;case Nat.HorizontalAlign.RIGHT:r.style.textAlign="right"}}}},i._updatePlaceholderLabel=function(t){if(t){var e=t.font;e=!e||e instanceof _O?t.fontFamily:t.font._fontFamily;var i=t.fontSize*t.node.scale.y;if(this._placeholderLabelFont!==e||this._placeholderLabelFontSize!==i||this._placeholderLabelFontColor!==t.fontColor||this._placeholderLabelAlign!==t.horizontalAlign||this._placeholderLineHeight!==t.fontSize){this._placeholderLabelFont=e,this._placeholderLabelFontSize=i,this._placeholderLabelFontColor=t.fontColor,this._placeholderLabelAlign=t.horizontalAlign,this._placeholderLineHeight=t.fontSize;var r=this._placeholderStyleSheet,n=t.color.toCSS(),s=t.fontSize,a="";switch(t.horizontalAlign){case Nat.HorizontalAlign.LEFT:a="left";break;case Nat.HorizontalAlign.CENTER:a="center";break;case Nat.HorizontalAlign.RIGHT:a="right"}r.innerHTML="#"+this._domId+"::-webkit-input-placeholder{text-transform: initial;-family: "+e+";font-size: "+i+"px;color: "+n+";line-height: "+s+"px;text-align: "+a+";}#"+this._domId+"::-moz-placeholder{text-transform: initial;-family: "+e+";font-size: "+i+"px;color: "+n+";line-height: "+s+"px;text-align: "+a+";}#"+this._domId+"::-ms-input-placeholder{text-transform: initial;-family: "+e+";font-size: "+i+"px;color: "+n+";line-height: "+s+"px;text-align: "+a+";}",_.sys.browserType===_.sys.BROWSER_TYPE_EDGE&&(r.innerHTML+="#"+this._domId+"::-ms-clear{display: none;}")}}},i._registerEventListeners=function(){if(this._edTxt){var t=this,e=this._edTxt,i=!1,r=this.__eventListeners;r.compositionStart=function(){i=!0},r.compositionEnd=function(){i=!1,t._delegate._editBoxTextChanged(e.value)},r.onInput=function(){if(!i){var r=t._delegate,n=r.maxLength;n>=0&&(e.value=e.value.slice(0,n)),r._editBoxTextChanged(e.value)}},r.onClick=function(){t._editing&&Jr.isMobile&&t._adjustWindowScroll()},r.onKeydown=function(i){i.keyCode===Ut.KEY.enter?(i.propagationStopped=!0,t._delegate._editBoxEditingReturn(),t._isTextArea||e.blur()):i.keyCode===Ut.KEY.tab&&(i.propagationStopped=!0,i.preventDefault(),Lat.next(t))},r.onBlur=function(){Jr.isMobile&&i&&r.compositionEnd(),t._editing=!1,Yot=null,t._hideDom(),t._delegate._editBoxEditingDidEnded()},e.addEventListener("compositionstart",r.compositionStart),e.addEventListener("compositionend",r.compositionEnd),e.addEventListener("input",r.onInput),e.addEventListener("keydown",r.onKeydown),e.addEventListener("blur",r.onBlur),e.addEventListener("touchstart",r.onClick)}},i._removeEventListeners=function(){if(this._edTxt){var t=this._edTxt,e=this.__eventListeners;t.removeEventListener("compositionstart",e.compositionStart),t.removeEventListener("compositionend",e.compositionEnd),t.removeEventListener("input",e.onInput),t.removeEventListener("keydown",e.onKeydown),t.removeEventListener("blur",e.onBlur),t.removeEventListener("touchstart",e.onClick),e.compositionStart=null,e.compositionEnd=null,e.onInput=null,e.onKeydown=null,e.onBlur=null,e.onClick=null}},e}(Vot);!function(t){t.EDITING_DID_BEGAN="editing-did-began",t.EDITING_DID_ENDED="editing-did-ended",t.TEXT_CHANGED="text-changed",t.EDITING_RETURN="editing-return"}(Hot||(Hot={}));var Zot,Qot,Jot,$ot,tht,eht,iht,rht,nht,sht,aht,oht,hht,lht,uht,cht,_ht,dht,pht,fht,mht,ght,vht,yht,Tht,Eht,Sht,bht,Aht,Cht,wht,Rht,xht,Oht,Iht,Mht,Bht,Pht,Nht,Lht,Fht,Dht,Uht=function(e){return t({EditBox:e,EditBoxComponent:e}),e}((Fat=Ne("cc.EditBox"),Dat=qe(),Uat=Fe(100),kat=We(),zat=Le(Vg),Gat=si(),Hat=$e(),Vat=si(),Wat=$e(),jat=pi(Nat),Xat=si(),Yat=$e(),qat=pi(Nat),Kat=si(),Zat=$e(),Qat=pi(um),Jat=si(),$at=$e(),tot=pi(Pat),eot=si(),iot=$e(),rot=pi(Bat),not=si(),sot=$e(),aot=pi(Mat),oot=si(),hot=$e(),lot=si(),uot=$e(),cot=si(),_ot=$e(),dot=pi([BP]),pot=si(),fot=$e(),mot=pi([BP]),got=si(),vot=$e(),yot=pi([BP]),Tot=si(),Eot=$e(),Sot=pi([BP]),bot=si(),Aot=$e(),Fat(Cot=Dat(Cot=Uat(Cot=kat(Cot=zat(Cot=Ve((Got=zot=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"editingDidBegan",Rot,a(e)),l(e,"textChanged",xot,a(e)),l(e,"editingDidEnded",Oot,a(e)),l(e,"editingReturn",Iot,a(e)),e._impl=null,e._background=null,l(e,"_textLabel",Mot,a(e)),l(e,"_placeholderLabel",Bot,a(e)),l(e,"_returnType",Pot,a(e)),l(e,"_string",Not,a(e)),l(e,"_tabIndex",Lot,a(e)),l(e,"_backgroundImage",Fot,a(e)),l(e,"_inputFlag",Dot,a(e)),l(e,"_inputMode",Uot,a(e)),l(e,"_maxLength",kot,a(e)),e._isLabelVisible=!1,e}s(e,t);var i=e.prototype;return i.__preload=function(){this._init()},i.onEnable=function(){this._registerEvent(),this._impl&&this._impl.onEnable()},i.update=function(){this._impl&&this._impl.update()},i.onDisable=function(){this._unregisterEvent(),this._impl&&this._impl.onDisable()},i.onDestroy=function(){this._impl&&this._impl.clear()},i.setFocus=function(){this._impl&&this._impl.setFocus(!0)},i.focus=function(){this._impl&&this._impl.setFocus(!0)},i.blur=function(){this._impl&&this._impl.setFocus(!1)},i.isFocused=function(){return!!this._impl&&this._impl.isFocused()},i._editBoxEditingDidBegan=function(){BP.emitEvents(this.editingDidBegan,this),this.node.emit(Hot.EDITING_DID_BEGAN,this)},i._editBoxEditingDidEnded=function(){BP.emitEvents(this.editingDidEnded,this),this.node.emit(Hot.EDITING_DID_ENDED,this)},i._editBoxTextChanged=function(t){t=this._updateLabelStringStyle(t,!0),this.string=t,BP.emitEvents(this.textChanged,t,this),this.node.emit(Hot.TEXT_CHANGED,this)},i._editBoxEditingReturn=function(){BP.emitEvents(this.editingReturn,this),this.node.emit(Hot.EDITING_RETURN,this)},i._showLabels=function(){this._isLabelVisible=!0,this._updateLabels()},i._hideLabels=function(){this._isLabelVisible=!1,this._textLabel&&(this._textLabel.node.active=!1),this._placeholderLabel&&(this._placeholderLabel.node.active=!1)},i._onTouchBegan=function(t){t.propagationStopped=!0},i._onTouchCancel=function(t){t.propagationStopped=!0},i._onTouchEnded=function(t){this._impl&&this._impl.beginEditing(),t.propagationStopped=!0},i._init=function(){this._createBackgroundSprite(),this._updatePlaceholderLabel(),this._updateTextLabel(),this._isLabelVisible=!0,this.node.on(gg.SIZE_CHANGED,this._resizeChildNodes,this),(this._impl=new e._EditBoxImpl).init(this),this._updateString(this._string),this._syncSize()},i._createBackgroundSprite=function(){this._background||(this._background=this.node.getComponent(cst),this._background||(this._background=this.node.addComponent(cst))),this._background.type=cst.Type.SLICED,this._background.spriteFrame=this._backgroundImage},i._updateTextLabel=function(){var t=this._textLabel;if(!t){var e=this.node.getChildByName("TEXT_LABEL");e||(e=new py("TEXT_LABEL")),(t=e.getComponent(Nat))||(t=e.addComponent(Nat)),e.parent=this.node,this._textLabel=t}this._textLabel.node._uiProps.uiTransformComp.setAnchorPoint(0,1),t.overflow=Nat.Overflow.CLAMP,this._inputMode===Bat.ANY?(t.verticalAlign=yat.TOP,t.enableWrapText=!0):(t.verticalAlign=yat.CENTER,t.enableWrapText=!1),t.string=this._updateLabelStringStyle(this._string)},i._updatePlaceholderLabel=function(){var t=this._placeholderLabel;if(!t){var e=this.node.getChildByName("PLACEHOLDER_LABEL");e||(e=new py("PLACEHOLDER_LABEL")),(t=e.getComponent(Nat))||(t=e.addComponent(Nat)),e.parent=this.node,this._placeholderLabel=t}this._placeholderLabel.node._uiProps.uiTransformComp.setAnchorPoint(0,1),t.overflow=Nat.Overflow.CLAMP,this._inputMode===Bat.ANY?(t.verticalAlign=yat.TOP,t.enableWrapText=!0):(t.verticalAlign=yat.CENTER,t.enableWrapText=!1),t.string=this.placeholder},i._syncSize=function(){var t=this.node._uiProps.uiTransformComp,e=t.contentSize;if(this._background){var i=this._background.node._uiProps.uiTransformComp;i.anchorPoint=t.anchorPoint,i.setContentSize(e)}this._updateLabelPosition(e),this._impl&&this._impl.setSize(e.width,e.height)},i._updateLabels=function(){if(this._isLabelVisible){var t=this._string;this._textLabel&&(this._textLabel.node.active=""!==t),this._placeholderLabel&&(this._placeholderLabel.node.active=""===t)}},i._updateString=function(t){var e=this._textLabel;if(e){var i=t;i&&(i=this._updateLabelStringStyle(i)),e.string=i,this._updateLabels()}},i._updateLabelStringStyle=function(t,e){void 0===e&&(e=!1);var i=this._inputFlag;if(e||i!==Pat.PASSWORD)i===Pat.INITIAL_CAPS_ALL_CHARACTERS?t=t.toUpperCase():i===Pat.INITIAL_CAPS_WORD?t=t.replace(/(?:^|\s)\S/g,(function(t){return t.toUpperCase()})):i===Pat.INITIAL_CAPS_SENTENCE&&(t=function(t){return t.charAt(0).toUpperCase()+t.slice(1)}(t));else{for(var r="",n=t.length,s=0;s<n;++s)r+="";t=r}return t},i._registerEvent=function(){this.node.on(gg.TOUCH_START,this._onTouchBegan,this),this.node.on(gg.TOUCH_END,this._onTouchEnded,this)},i._unregisterEvent=function(){this.node.off(gg.TOUCH_START,this._onTouchBegan,this),this.node.off(gg.TOUCH_END,this._onTouchEnded,this)},i._updateLabelPosition=function(t){var e=this.node._uiProps.uiTransformComp,i=-e.anchorX*e.width,r=-e.anchorY*e.height,n=this._placeholderLabel,s=this._textLabel;s&&(s.node._uiProps.uiTransformComp.setContentSize(t.width-2,t.height),s.node.position=new Cs(i+2,r+t.height,s.node.position.z),s.verticalAlign=this._inputMode===Bat.ANY?yat.TOP:yat.CENTER,s.enableWrapText=this._inputMode===Bat.ANY),n&&(n.node._uiProps.uiTransformComp.setContentSize(t.width-2,t.height),n.lineHeight=t.height,n.node.position=new Cs(i+2,r+t.height,n.node.position.z),n.verticalAlign=this._inputMode===Bat.ANY?yat.TOP:yat.CENTER,n.enableWrapText=this._inputMode===Bat.ANY)},i._resizeChildNodes=function(){var t=this.node._uiProps.uiTransformComp,e=this._textLabel&&this._textLabel.node;e&&(e.position=new Cs(-t.width/2,t.height/2,e.position.z),e._uiProps.uiTransformComp.setContentSize(t.contentSize));var i=this._placeholderLabel&&this._placeholderLabel.node;i&&(i.position=new Cs(-t.width/2,t.height/2,i.position.z),i._uiProps.uiTransformComp.setContentSize(t.contentSize));var r=this._background&&this._background.node;r&&r._uiProps.uiTransformComp.setContentSize(t.contentSize)},r(e,[{key:"string",get:function(){return this._string},set:function(t){this._maxLength>=0&&t.length>=this._maxLength&&(t=t.slice(0,this._maxLength)),this._string=t,this._updateString(t)}},{key:"placeholder",get:function(){return this._placeholderLabel?this._placeholderLabel.string:""},set:function(t){this._placeholderLabel&&(this._placeholderLabel.string=t)}},{key:"textLabel",get:function(){return this._textLabel},set:function(t){this._textLabel!==t&&(this._textLabel=t,this._textLabel&&(this._updateTextLabel(),this._updateLabels()))}},{key:"placeholderLabel",get:function(){return this._placeholderLabel},set:function(t){this._placeholderLabel!==t&&(this._placeholderLabel=t,this._placeholderLabel&&(this._updatePlaceholderLabel(),this._updateLabels()))}},{key:"backgroundImage",get:function(){return this._backgroundImage},set:function(t){this._backgroundImage!==t&&(this._backgroundImage=t,this._createBackgroundSprite())}},{key:"inputFlag",get:function(){return this._inputFlag},set:function(t){this._inputFlag=t,this._updateString(this._string)}},{key:"inputMode",get:function(){return this._inputMode},set:function(t){this._inputMode!==t&&(this._inputMode=t,this._updateTextLabel(),this._updatePlaceholderLabel())}},{key:"returnType",get:function(){return this._returnType},set:function(t){this._returnType=t}},{key:"maxLength",get:function(){return this._maxLength},set:function(t){this._maxLength=t}},{key:"tabIndex",get:function(){return this._tabIndex},set:function(t){this._tabIndex!==t&&(this._tabIndex=t,this._impl&&this._impl.setTabIndex(t))}}]),e}(ds),zot._EditBoxImpl=Vot,zot.KeyboardReturnType=Mat,zot.InputFlag=Pat,zot.InputMode=Bat,zot.EventType=Hot,u((wot=Got).prototype,"string",[Gat,Hat],Object.getOwnPropertyDescriptor(wot.prototype,"string"),wot.prototype),u(wot.prototype,"placeholder",[Vat,Wat],Object.getOwnPropertyDescriptor(wot.prototype,"placeholder"),wot.prototype),u(wot.prototype,"textLabel",[jat,Xat,Yat],Object.getOwnPropertyDescriptor(wot.prototype,"textLabel"),wot.prototype),u(wot.prototype,"placeholderLabel",[qat,Kat,Zat],Object.getOwnPropertyDescriptor(wot.prototype,"placeholderLabel"),wot.prototype),u(wot.prototype,"backgroundImage",[Qat,Jat,$at],Object.getOwnPropertyDescriptor(wot.prototype,"backgroundImage"),wot.prototype),u(wot.prototype,"inputFlag",[tot,eot,iot],Object.getOwnPropertyDescriptor(wot.prototype,"inputFlag"),wot.prototype),u(wot.prototype,"inputMode",[rot,not,sot],Object.getOwnPropertyDescriptor(wot.prototype,"inputMode"),wot.prototype),u(wot.prototype,"returnType",[aot,oot,hot],Object.getOwnPropertyDescriptor(wot.prototype,"returnType"),wot.prototype),u(wot.prototype,"maxLength",[lot,uot],Object.getOwnPropertyDescriptor(wot.prototype,"maxLength"),wot.prototype),u(wot.prototype,"tabIndex",[cot,_ot],Object.getOwnPropertyDescriptor(wot.prototype,"tabIndex"),wot.prototype),Rot=u(wot.prototype,"editingDidBegan",[dot,ke,pot,fot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xot=u(wot.prototype,"textChanged",[mot,ke,got,vot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Oot=u(wot.prototype,"editingDidEnded",[yot,ke,Tot,Eot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Iot=u(wot.prototype,"editingReturn",[Sot,ke,bot,Aot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Mot=u(wot.prototype,"_textLabel",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Bot=u(wot.prototype,"_placeholderLabel",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Pot=u(wot.prototype,"_returnType",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Mat.DEFAULT}}),Not=u(wot.prototype,"_string",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Lot=u(wot.prototype,"_tabIndex",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Fot=u(wot.prototype,"_backgroundImage",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Dot=u(wot.prototype,"_inputFlag",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Pat.DEFAULT}}),Uot=u(wot.prototype,"_inputMode",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Bat.ANY}}),kot=u(wot.prototype,"_maxLength",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),Cot=wot))||Cot)||Cot)||Cot)||Cot)||Cot)||Cot));Jr.isBrowser&&(Uht._EditBoxImpl=Kot);var kht,zht,Ght,Hht,Vht,Wht=gg;!function(t){t[t.NONE=0]="NONE",t[t.HORIZONTAL=1]="HORIZONTAL",t[t.VERTICAL=2]="VERTICAL",t[t.GRID=3]="GRID"}(kht||(kht={})),Ft(kht),function(t){t[t.NONE=0]="NONE",t[t.CONTAINER=1]="CONTAINER",t[t.CHILDREN=2]="CHILDREN"}(zht||(zht={})),Ft(zht),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(Ght||(Ght={})),Ft(Ght),function(t){t[t.BOTTOM_TO_TOP=0]="BOTTOM_TO_TOP",t[t.TOP_TO_BOTTOM=1]="TOP_TO_BOTTOM"}(Hht||(Hht={})),Ft(Hht),function(t){t[t.LEFT_TO_RIGHT=0]="LEFT_TO_RIGHT",t[t.RIGHT_TO_LEFT=1]="RIGHT_TO_LEFT"}(Vht||(Vht={})),Ft(Vht);var jht,Xht,Yht,qht,Kht,Zht,Qht,Jht,$ht,tlt,elt,ilt,rlt,nlt,slt,alt,olt,hlt,llt,ult,clt,_lt,dlt,plt,flt,mlt,glt,vlt=new Cs,ylt=new Cs,Tlt=function(e){return t({Layout:e,LayoutComponent:e}),e}((Zot=Ne("cc.Layout"),Qot=qe(),Jot=Fe(110),$ot=We(),tht=Le(Vg),eht=pi(kht),iht=$e(),rht=pi(zht),nht=$e(),sht=$e(),aht=pi(Ght),oht=$e(),hht=$e(),lht=$e(),uht=$e(),cht=$e(),_ht=$e(),dht=$e(),pht=pi(Hht),fht=$e(),mht=pi(Vht),ght=$e(),vht=$e(),yht=$e(),Zot(Tht=Qot(Tht=Jot(Tht=$ot(Tht=tht(Tht=Ve((Dht=Fht=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"_resizeMode",Sht,a(e)),l(e,"_N$layoutType",bht,a(e)),l(e,"_N$padding",Aht,a(e)),l(e,"_cellSize",Cht,a(e)),l(e,"_startAxis",wht,a(e)),l(e,"_paddingLeft",Rht,a(e)),l(e,"_paddingRight",xht,a(e)),l(e,"_paddingTop",Oht,a(e)),l(e,"_paddingBottom",Iht,a(e)),l(e,"_spacingX",Mht,a(e)),l(e,"_spacingY",Bht,a(e)),l(e,"_verticalDirection",Pht,a(e)),l(e,"_horizontalDirection",Nht,a(e)),l(e,"_affectedByScale",Lht,a(e)),e._layoutSize=new Ys(300,200),e._layoutDirty=!0,e._isAlign=!1,e}s(e,t);var i=e.prototype;return i.updateLayout=function(){this._layoutDirty&&this.node.children.length>0&&(this._doLayout(),this._layoutDirty=!1)},i.onEnable=function(){this._addEventListeners();var t=this.node._uiProps.uiTransformComp;t.contentSize.equals(Ys.ZERO)&&t.setContentSize(this._layoutSize),0!==this._N$padding&&this._migratePaddingData(),this._doLayoutDirty()},i.onDisable=function(){this._removeEventListeners()},i._migratePaddingData=function(){this._paddingLeft=this._N$padding,this._paddingRight=this._N$padding,this._paddingTop=this._N$padding,this._paddingBottom=this._N$padding,this._N$padding=0},i._addEventListeners=function(){NF.on(PF.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.on(Wht.SIZE_CHANGED,this._resized,this),this.node.on(Wht.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.on(Wht.CHILD_ADDED,this._childAdded,this),this.node.on(Wht.CHILD_REMOVED,this._childRemoved,this),this._addChildrenEventListeners()},i._removeEventListeners=function(){NF.off(PF.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.off(Wht.SIZE_CHANGED,this._resized,this),this.node.off(Wht.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.off(Wht.CHILD_ADDED,this._childAdded,this),this.node.off(Wht.CHILD_REMOVED,this._childRemoved,this),this._removeChildrenEventListeners()},i._addChildrenEventListeners=function(){for(var t=this.node.children,e=0;e<t.length;++e){var i=t[e];i.on(Wht.TRANSFORM_CHANGED,this._doScaleDirty,this),i.on(Wht.SIZE_CHANGED,this._doLayoutDirty,this),i.on(Wht.TRANSFORM_CHANGED,this._transformDirty,this),i.on(Wht.ANCHOR_CHANGED,this._doLayoutDirty,this),i.on("active-in-hierarchy-changed",this._doLayoutDirty,this)}},i._removeChildrenEventListeners=function(){for(var t=this.node.children,e=0;e<t.length;++e){var i=t[e];i.off(Wht.TRANSFORM_CHANGED,this._doScaleDirty,this),i.off(Wht.SIZE_CHANGED,this._doLayoutDirty,this),i.off(Wht.TRANSFORM_CHANGED,this._transformDirty,this),i.off(Wht.ANCHOR_CHANGED,this._doLayoutDirty,this),i.off("active-in-hierarchy-changed",this._doLayoutDirty,this)}},i._childAdded=function(t){t.on(Wht.TRANSFORM_CHANGED,this._doScaleDirty,this),t.on(Wht.SIZE_CHANGED,this._doLayoutDirty,this),t.on(Wht.TRANSFORM_CHANGED,this._transformDirty,this),t.on(Wht.ANCHOR_CHANGED,this._doLayoutDirty,this),t.on("active-in-hierarchy-changed",this._doLayoutDirty,this),this._doLayoutDirty()},i._childRemoved=function(t){t.off(Wht.TRANSFORM_CHANGED,this._doScaleDirty,this),t.off(Wht.SIZE_CHANGED,this._doLayoutDirty,this),t.off(Wht.TRANSFORM_CHANGED,this._transformDirty,this),t.off(Wht.ANCHOR_CHANGED,this._doLayoutDirty,this),t.off("active-in-hierarchy-changed",this._doLayoutDirty,this),this._doLayoutDirty()},i._resized=function(){this._layoutSize.set(this.node._uiProps.uiTransformComp.contentSize),this._doLayoutDirty()},i._doLayoutHorizontally=function(t,e,i,r){var n=this.node._uiProps.uiTransformComp,s=n.anchorPoint,a=this.node.children,o=1,h=this._paddingLeft,l=-s.x*t;this._horizontalDirection===Vht.RIGHT_TO_LEFT&&(o=-1,l=(1-s.x)*t,h=this._paddingRight);for(var u=l+o*h-o*this._spacingX,c=0,_=0,d=0,p=0,f=0,m=0,g=0,v=0;v<a.length;++v)a[v].activeInHierarchy&&g++;var y=this._cellSize.width;this._N$layoutType!==kht.GRID&&this._resizeMode===zht.CHILDREN&&(y=(t-(this._paddingLeft+this._paddingRight)-(g-1)*this._spacingX)/g);for(var T=0;T<a.length;++T){var E=a[T],S=E._uiProps.uiTransformComp;if(E.activeInHierarchy&&S){E.getScale(ylt);var b=this._getUsedScaleValue(ylt.x),A=this._getUsedScaleValue(ylt.y);this._resizeMode===zht.CHILDREN&&(S.width=y/b,this._N$layoutType===kht.GRID&&(S.height=this._cellSize.height/A));var C=S.anchorX,w=S.width*b,R=S.height*A;d>_&&(_=d),R>=_&&(d=_,_=R,m=S.anchorY),this._horizontalDirection===Vht.RIGHT_TO_LEFT&&(C=1-S.anchorX),u=u+o*C*w+o*this._spacingX;var x=o*(1-C)*w;if(e){var O=u+x+o*(o>0?this._paddingRight:this._paddingLeft),I=!1;this._horizontalDirection===Vht.LEFT_TO_RIGHT&&O>(1-s.x)*t&&(I=!0);var M=!1;this._horizontalDirection===Vht.RIGHT_TO_LEFT&&O<-s.x*t&&(M=!0),(I||M)&&(R>=_?(0===d&&(d=_),c+=d,d=_):(c+=_,d=R,_=0),u=l+o*(h+C*w),p++)}var B=i(E,S,c,p);t>=w+this._paddingLeft+this._paddingRight&&r&&(E.getPosition(vlt),E.setPosition(u,B,vlt.z));var P=1,N=void 0,L=0===_?R:_;this._verticalDirection===Hht.TOP_TO_BOTTOM?(f=f||n.height,(N=B+(P=-1)*(L*m+this._paddingBottom))<f&&(f=N)):(f=f||-n.height,(N=B+P*(L*m+this._paddingTop))>f&&(f=N)),u+=x}}return f},i._doLayoutVertically=function(t,e,i,r){var n=this.node._uiProps.uiTransformComp,s=n.anchorPoint,a=this.node.children,o=1,h=this._paddingBottom,l=-s.y*t;this._verticalDirection===Hht.TOP_TO_BOTTOM&&(o=-1,l=(1-s.y)*t,h=this._paddingTop);for(var u=l+o*h-o*this._spacingY,c=0,_=0,d=0,p=0,f=0,m=0,g=0,v=0;v<a.length;++v)a[v].activeInHierarchy&&g++;var y=this._cellSize.height;this._N$layoutType!==kht.GRID&&this._resizeMode===zht.CHILDREN&&(y=(t-(this._paddingTop+this._paddingBottom)-(g-1)*this._spacingY)/g);for(var T=0;T<a.length;++T){var E=a[T];if(E){var S=E.getScale(),b=this._getUsedScaleValue(S.x),A=this._getUsedScaleValue(S.y),C=E._uiProps.uiTransformComp;if(E.activeInHierarchy&&C){this._resizeMode===zht.CHILDREN&&(C.height=y/A,this._N$layoutType===kht.GRID&&(C.width=this._cellSize.width/b));var w=C.anchorY,R=C.width*b,x=C.height*A;d>_&&(_=d),R>=_&&(d=_,_=R,m=C.anchorX),this._verticalDirection===Hht.TOP_TO_BOTTOM&&(w=1-C.anchorY),u=u+o*w*x+o*this._spacingY;var O=o*(1-w)*x;if(e){var I=u+O+o*(o>0?this._paddingTop:this._paddingBottom),M=!1;this._verticalDirection===Hht.BOTTOM_TO_TOP&&I>(1-s.y)*t&&(M=!0);var B=!1;this._verticalDirection===Hht.TOP_TO_BOTTOM&&I<-s.y*t&&(B=!0),(M||B)&&(R>=_?(0===d&&(d=_),c+=d,d=_):(c+=_,d=R,_=0),u=l+o*(h+w*x),p++)}var P=i(E,C,c,p);t>=x+(this._paddingTop+this._paddingBottom)&&r&&(E.getPosition(vlt),E.setPosition(P,u,vlt.z));var N=1,L=void 0,F=0===_?R:_;this._horizontalDirection===Vht.RIGHT_TO_LEFT?(N=-1,f=f||n.width,(L=P+N*(F*m+this._paddingLeft))<f&&(f=L)):(f=f||-n.width,(L=P+N*(F*m+this._paddingRight))>f&&(f=L)),u+=O}}}return f},i._doLayoutBasic=function(){for(var t=this.node.children,e=null,i=0;i<t.length;++i){var r=t[i],n=r._uiProps.uiTransformComp;n&&r.activeInHierarchy&&(e?Ks.union(e,e,n.getBoundingBoxToWorld()):e=n.getBoundingBoxToWorld())}if(e){var s=this.node.parent.getComponent(Vg);if(!s)return;Cs.set(vlt,e.x,e.y,0);var a=new Cs;s.convertToNodeSpaceAR(vlt,a),Cs.set(a,a.x-this._paddingLeft,a.y-this._paddingBottom,a.z),Cs.set(vlt,e.x+e.width,e.y+e.height,0);var o=new Cs;s.convertToNodeSpaceAR(vlt,o),Cs.set(o,o.x+this._paddingRight,o.y+this._paddingTop,o.z);var h=_.size(parseFloat((o.x-a.x).toFixed(2)),parseFloat((o.y-a.y).toFixed(2)));this.node.getPosition(vlt);var l=this.node._uiProps.uiTransformComp;if(0!==h.width){var u=(vlt.x-a.x)/h.width;l.anchorX=parseFloat(u.toFixed(2))}if(0!==h.height){var c=(vlt.y-a.y)/h.height;l.anchorY=parseFloat(c.toFixed(2))}l.setContentSize(h)}},i._doLayoutGridAxisHorizontal=function(t,e){var i=this,r=e.width,n=1,s=-t.y*e.height,a=this._paddingBottom;this._verticalDirection===Hht.TOP_TO_BOTTOM&&(n=-1,s=(1-t.y)*e.height,a=this._paddingTop);var o=this,h=function(t,e,r,h){return s+n*(r+e.anchorY*e.height*o._getUsedScaleValue(t.getScale().y)+a+h*i._spacingY)},l=0;if(this._resizeMode===zht.CONTAINER){var u=this._doLayoutHorizontally(r,!0,h,!1);(l=s-u)<0&&(l*=-1),s=-t.y*l,this._verticalDirection===Hht.TOP_TO_BOTTOM&&(n=-1,s=(1-t.y)*l)}this._doLayoutHorizontally(r,!0,h,!0),this._resizeMode===zht.CONTAINER&&this.node._uiProps.uiTransformComp.setContentSize(r,l)},i._doLayoutGridAxisVertical=function(t,e){var i=this,r=e.height,n=1,s=-t.x*e.width,a=this._paddingLeft;this._horizontalDirection===Vht.RIGHT_TO_LEFT&&(n=-1,s=(1-t.x)*e.width,a=this._paddingRight);var o=this,h=function(t,e,r,h){return s+n*(r+e.anchorX*e.width*o._getUsedScaleValue(t.getScale().x)+a+h*i._spacingX)},l=0;if(this._resizeMode===zht.CONTAINER){var u=this._doLayoutVertically(r,!0,h,!1);(l=s-u)<0&&(l*=-1),s=-t.x*l,this._horizontalDirection===Vht.RIGHT_TO_LEFT&&(n=-1,s=(1-t.x)*l)}this._doLayoutVertically(r,!0,h,!0),this._resizeMode===zht.CONTAINER&&this.node._uiProps.uiTransformComp.setContentSize(l,r)},i._doLayoutGrid=function(){var t=this.node._uiProps.uiTransformComp,e=t.anchorPoint,i=t.contentSize;this.startAxis===Ght.HORIZONTAL?this._doLayoutGridAxisHorizontal(e,i):this.startAxis===Ght.VERTICAL&&this._doLayoutGridAxisVertical(e,i)},i._getHorizontalBaseWidth=function(t){var e=0,i=0;if(this._resizeMode===zht.CONTAINER){for(var r=0;r<t.length;++r){var n=t[r];n.getScale(ylt);var s=n._uiProps.uiTransformComp;n.activeInHierarchy&&s&&(i++,e+=s.width*this._getUsedScaleValue(ylt.x))}e+=(i-1)*this._spacingX+this._paddingLeft+this._paddingRight}else e=this.node._uiProps.uiTransformComp.width;return e},i._getVerticalBaseHeight=function(t){var e=0,i=0;if(this._resizeMode===zht.CONTAINER){for(var r=0;r<t.length;++r){var n=t[r];n.getScale(ylt);var s=n._uiProps.uiTransformComp;n.activeInHierarchy&&s&&(i++,e+=s.height*this._getUsedScaleValue(ylt.y))}e+=(i-1)*this._spacingY+this._paddingBottom+this._paddingTop}else e=this.node._uiProps.uiTransformComp.height;return e},i._doLayout=function(){var t=this;if(this._N$layoutType===kht.HORIZONTAL){var e=this._getHorizontalBaseWidth(this.node.children);this._doLayoutHorizontally(e,!1,(function(e){return(t._isAlign?Cs.ZERO:e.position).y}),!0),this._isAlign=!1,this.node._uiProps.uiTransformComp.width=e}else if(this._N$layoutType===kht.VERTICAL){var i=this._getVerticalBaseHeight(this.node.children);this._doLayoutVertically(i,!1,(function(e){return(t._isAlign?Cs.ZERO:e.position).x}),!0),this._isAlign=!1,this.node._uiProps.uiTransformComp.height=i}else this._N$layoutType===kht.NONE?this._resizeMode===zht.CONTAINER&&this._doLayoutBasic():this._N$layoutType===kht.GRID&&this._doLayoutGrid()},i._getUsedScaleValue=function(t){return this._affectedByScale?Math.abs(t):1},i._transformDirty=function(t){t&Uv.POSITION&&this._doLayoutDirty()},i._doLayoutDirty=function(){this._layoutDirty=!0},i._doScaleDirty=function(t){t&Uv.SCALE&&(this._layoutDirty=this._layoutDirty||this._affectedByScale)},r(e,[{key:"type",get:function(){return this._N$layoutType},set:function(t){this._N$layoutType=t,this._isAlign=!0,this._doLayoutDirty()}},{key:"resizeMode",get:function(){return this._resizeMode},set:function(t){this._N$layoutType===kht.NONE&&t===zht.CHILDREN||(this._resizeMode=t,this._doLayoutDirty())}},{key:"cellSize",get:function(){return this._cellSize},set:function(t){this._cellSize!==t&&(this._cellSize.set(t),this._doLayoutDirty())}},{key:"startAxis",get:function(){return this._startAxis},set:function(t){this._startAxis!==t&&(this._startAxis=t,this._doLayoutDirty())}},{key:"paddingLeft",get:function(){return this._paddingLeft},set:function(t){this._paddingLeft!==t&&(this._paddingLeft=t,this._doLayoutDirty())}},{key:"paddingRight",get:function(){return this._paddingRight},set:function(t){this._paddingRight!==t&&(this._paddingRight=t,this._doLayoutDirty())}},{key:"paddingTop",get:function(){return this._paddingTop},set:function(t){this._paddingTop!==t&&(this._paddingTop=t,this._doLayoutDirty())}},{key:"paddingBottom",get:function(){return this._paddingBottom},set:function(t){this._paddingBottom!==t&&(this._paddingBottom=t,this._doLayoutDirty())}},{key:"spacingX",get:function(){return this._spacingX},set:function(t){this._spacingX!==t&&(this._spacingX=t,this._doLayoutDirty())}},{key:"spacingY",get:function(){return this._spacingY},set:function(t){this._spacingY!==t&&(this._spacingY=t,this._doLayoutDirty())}},{key:"verticalDirection",get:function(){return this._verticalDirection},set:function(t){this._verticalDirection!==t&&(this._verticalDirection=t,this._doLayoutDirty())}},{key:"horizontalDirection",get:function(){return this._horizontalDirection},set:function(t){this._horizontalDirection!==t&&(this._horizontalDirection=t,this._doLayoutDirty())}},{key:"padding",get:function(){return this._paddingLeft},set:function(t){this._N$padding=t,this._migratePaddingData(),this._doLayoutDirty()}},{key:"affectedByScale",get:function(){return this._affectedByScale},set:function(t){this._affectedByScale=t,this._doLayoutDirty()}}]),e}(ds),Fht.Type=kht,Fht.VerticalDirection=Hht,Fht.HorizontalDirection=Vht,Fht.ResizeMode=zht,Fht.AxisDirection=Ght,u((Eht=Dht).prototype,"type",[eht,iht],Object.getOwnPropertyDescriptor(Eht.prototype,"type"),Eht.prototype),u(Eht.prototype,"resizeMode",[rht,nht],Object.getOwnPropertyDescriptor(Eht.prototype,"resizeMode"),Eht.prototype),u(Eht.prototype,"cellSize",[sht],Object.getOwnPropertyDescriptor(Eht.prototype,"cellSize"),Eht.prototype),u(Eht.prototype,"startAxis",[aht,oht],Object.getOwnPropertyDescriptor(Eht.prototype,"startAxis"),Eht.prototype),u(Eht.prototype,"paddingLeft",[hht],Object.getOwnPropertyDescriptor(Eht.prototype,"paddingLeft"),Eht.prototype),u(Eht.prototype,"paddingRight",[lht],Object.getOwnPropertyDescriptor(Eht.prototype,"paddingRight"),Eht.prototype),u(Eht.prototype,"paddingTop",[uht],Object.getOwnPropertyDescriptor(Eht.prototype,"paddingTop"),Eht.prototype),u(Eht.prototype,"paddingBottom",[cht],Object.getOwnPropertyDescriptor(Eht.prototype,"paddingBottom"),Eht.prototype),u(Eht.prototype,"spacingX",[_ht],Object.getOwnPropertyDescriptor(Eht.prototype,"spacingX"),Eht.prototype),u(Eht.prototype,"spacingY",[dht],Object.getOwnPropertyDescriptor(Eht.prototype,"spacingY"),Eht.prototype),u(Eht.prototype,"verticalDirection",[pht,fht],Object.getOwnPropertyDescriptor(Eht.prototype,"verticalDirection"),Eht.prototype),u(Eht.prototype,"horizontalDirection",[mht,ght],Object.getOwnPropertyDescriptor(Eht.prototype,"horizontalDirection"),Eht.prototype),u(Eht.prototype,"padding",[vht],Object.getOwnPropertyDescriptor(Eht.prototype,"padding"),Eht.prototype),u(Eht.prototype,"affectedByScale",[yht],Object.getOwnPropertyDescriptor(Eht.prototype,"affectedByScale"),Eht.prototype),Sht=u(Eht.prototype,"_resizeMode",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zht.NONE}}),bht=u(Eht.prototype,"_N$layoutType",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return kht.NONE}}),Aht=u(Eht.prototype,"_N$padding",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Cht=u(Eht.prototype,"_cellSize",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ys(40,40)}}),wht=u(Eht.prototype,"_startAxis",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ght.HORIZONTAL}}),Rht=u(Eht.prototype,"_paddingLeft",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),xht=u(Eht.prototype,"_paddingRight",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Oht=u(Eht.prototype,"_paddingTop",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Iht=u(Eht.prototype,"_paddingBottom",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Mht=u(Eht.prototype,"_spacingX",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Bht=u(Eht.prototype,"_spacingY",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Pht=u(Eht.prototype,"_verticalDirection",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Hht.TOP_TO_BOTTOM}}),Nht=u(Eht.prototype,"_horizontalDirection",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Vht.LEFT_TO_RIGHT}}),Lht=u(Eht.prototype,"_affectedByScale",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Tht=Eht))||Tht)||Tht)||Tht)||Tht)||Tht)||Tht));!function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE"}(jht||(jht={})),Ft(jht),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER"}(Xht||(Xht={})),Ft(Xht),function(t){t[t.PT_CORNER=1]="PT_CORNER",t[t.PT_LEFT=2]="PT_LEFT",t[t.PT_BEVEL=4]="PT_BEVEL",t[t.PT_INNERBEVEL=8]="PT_INNERBEVEL"}(Yht||(Yht={})),Ft(Yht);var Elt,Slt,blt,Alt,Clt,wlt,Rlt,xlt,Olt,Ilt,Mlt,Blt,Plt,Nlt,Llt,Flt,Dlt,Ult,klt,zlt,Glt,Hlt,Vlt,Wlt,jlt,Xlt,Ylt,qlt,Klt=gF.concat([new hu("a_dist",il.R32F)]),Zlt=TF(Klt),Qlt=EF(Klt),Jlt=function(e){return t({Graphics:e,GraphicsComponent:e}),e}((qht=Ne("cc.Graphics"),Kht=qe(),Zht=Fe(110),Qht=We(),Jht=pi(Xht),$ht=$e(),tlt=pi(jht),elt=$e(),ilt=$e(),rlt=$e(),nlt=$e(),slt=Ze(),alt=Ze(),olt=Ze(),qht(hlt=Kht(hlt=Zht(hlt=Qht((glt=mlt=function(t){function e(){var e;return(e=t.call(this)||this).impl=null,e.model=null,l(e,"_lineWidth",ult,a(e)),l(e,"_strokeColor",clt,a(e)),l(e,"_lineJoin",_lt,a(e)),l(e,"_lineCap",dlt,a(e)),l(e,"_fillColor",plt,a(e)),l(e,"_miterLimit",flt,a(e)),e._isDrawing=!1,e._isNeedUploadData=!0,e._instanceMaterialType=dF.ADD_COLOR,e}s(e,t),r(e,[{key:"lineWidth",get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this.impl&&(this.impl.lineWidth=t)}},{key:"lineJoin",get:function(){return this._lineJoin},set:function(t){this._lineJoin=t,this.impl&&(this.impl.lineJoin=t)}},{key:"lineCap",get:function(){return this._lineCap},set:function(t){this._lineCap=t,this.impl&&(this.impl.lineCap=t)}},{key:"strokeColor",get:function(){return this._strokeColor},set:function(t){this.impl&&(this._strokeColor.set(t),this.impl.strokeColor=this._strokeColor)}},{key:"fillColor",get:function(){return this._fillColor},set:function(t){this.impl&&(this._fillColor.set(t),this.impl.fillColor=this._fillColor)}},{key:"miterLimit",get:function(){return this._miterLimit},set:function(t){this._miterLimit=t}},{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateColor(),this.markForUpdateRenderData())}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(){}},{key:"dstBlendFactor",get:function(){return this._dstBlendFactor},set:function(){}}]);var i=e.prototype;return i.onRestore=function(){this.impl||this._flushAssembler()},i.__preload=function(){t.prototype.__preload.call(this),this.impl=this._assembler&&this._assembler.createImpl(this)},i.onLoad=function(){this._sceneGetter=NF.root.ui.getRenderSceneGetter(),this.model=NF.root.createModel(aC),this.model.node=this.model.transform=this.node,this.impl||(this._flushAssembler(),this.impl=this._assembler&&this._assembler.createImpl(this))},i.onEnable=function(){t.prototype.onEnable.call(this),this._updateMtlForGraphics()},i.onDisable=function(){t.prototype.onDisable.call(this),this._detachFromScene()},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._sceneGetter=null,this.model&&(NF.root.destroyModel(this.model),this.model=null),this.impl&&(this._isDrawing=!1,this.impl.clear(),this.impl=null)},i.moveTo=function(t,e){this.impl&&this.impl.moveTo(t,e)},i.lineTo=function(t,e){this.impl&&this.impl.lineTo(t,e)},i.bezierCurveTo=function(t,e,i,r,n,s){this.impl&&this.impl.bezierCurveTo(t,e,i,r,n,s)},i.quadraticCurveTo=function(t,e,i,r){this.impl&&this.impl.quadraticCurveTo(t,e,i,r)},i.arc=function(t,e,i,r,n,s){this.impl&&this.impl.arc(t,e,i,r,n,s)},i.ellipse=function(t,e,i,r){this.impl&&this.impl.ellipse(t,e,i,r)},i.circle=function(t,e,i){this.impl&&this.impl.circle(t,e,i)},i.rect=function(t,e,i,r){this.impl&&this.impl.rect(t,e,i,r)},i.roundRect=function(t,e,i,r,n){this.impl&&this.impl.roundRect(t,e,i,r,n)},i.fillRect=function(t,e,i,r){this.rect(t,e,i,r),this.fill()},i.clear=function(){if(this.impl){if(this.impl.clear(),this._isDrawing=!1,this.model)for(var t=0;t<this.model.subModels.length;t++)this.model.subModels[t].inputAssembler.indexCount=0;this._detachFromScene(),this.markForUpdateRenderData()}},i.close=function(){this.impl&&this.impl.close()},i.stroke=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.stroke(this),this._attachToScene()},i.fill=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.fill(this),this._attachToScene()},i._updateMtlForGraphics=function(){var t;this._customMaterial?t=this.getMaterialInstance(0):(t=wm.get("ui-graphics-material"),this.setMaterial(t,0),(t=this.getMaterialInstance(0)).recompileShaders({USE_LOCAL:!0}))},i.activeSubModel=function(t){if(this.model){if(this.model.subModels.length<=t){var e,i=_.director.root.device,r=i.createBuffer(new Kl(rl.VERTEX|rl.TRANSFER_DST,nl.DEVICE,65535*Qlt,Qlt)),n=i.createBuffer(new Kl(rl.INDEX|rl.TRANSFER_DST,nl.DEVICE,131070*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT));(e=new xf([r],Klt,ol.TRIANGLE_LIST,n)).subMeshIdx=0,this.model.initSubModel(t,e,this.getMaterialInstance(0))}}else console.warn("There is no model in "+this.node.name)},i._uploadData=function(t){var e=this.impl,i=e&&e.getRenderData();if(i&&this.model){var r=this.model.subModels.length,n=i.length;if(n-r>0)for(var s=r;s<n;s++)this.activeSubModel(s);for(var a=this.model.subModels,o=0;o<i.length;o++){var h=i[o],l=a[o].inputAssembler,u=Zlt*Float32Array.BYTES_PER_ELEMENT,c=h.lastFilledVertex*u,_=h.vertexStart*u;if(c!==_){var d=new Float32Array(h.vData.buffer,c,_-c>>2);l.vertexBuffers[0].update(d,c),l.vertexCount=h.vertexStart;var p=new Uint16Array(h.iData.buffer,h.lastFilledIndices*Uint16Array.BYTES_PER_ELEMENT,h.indicesStart-h.lastFilledIndices);l.indexBuffer.update(p,h.lastFilledIndices*Uint16Array.BYTES_PER_ELEMENT),l.indexCount=h.indicesStart,h.lastFilledVertex=h.vertexStart,h.lastFilledIndices=h.indicesStart}}t.removeUploadBuffersFunc(this),this._isNeedUploadData=!1}},i._render=function(t){this._isNeedUploadData&&t.addUploadBuffersFunc(this,this._uploadData),t.commitModel(this,this.model,this.getMaterialInstance(0))},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t)},i._canRender=function(){return!!t.prototype._canRender.call(this)&&!!this.model&&this._isDrawing},i._attachToScene=function(){var t=NF.root.ui.renderScene;this.model&&this.model.scene!==t&&(null!==this.model.scene&&this._detachFromScene(),t.addModel(this.model))},i._detachFromScene=function(){this.model&&this.model.scene&&(this.model.scene.removeModel(this.model),this.model.scene=null)},e}(fF),mlt.LineJoin=Xht,mlt.LineCap=jht,u((llt=glt).prototype,"lineWidth",[Ke],Object.getOwnPropertyDescriptor(llt.prototype,"lineWidth"),llt.prototype),u(llt.prototype,"lineJoin",[Jht,$ht],Object.getOwnPropertyDescriptor(llt.prototype,"lineJoin"),llt.prototype),u(llt.prototype,"lineCap",[tlt,elt],Object.getOwnPropertyDescriptor(llt.prototype,"lineCap"),llt.prototype),u(llt.prototype,"strokeColor",[ilt],Object.getOwnPropertyDescriptor(llt.prototype,"strokeColor"),llt.prototype),u(llt.prototype,"fillColor",[rlt],Object.getOwnPropertyDescriptor(llt.prototype,"fillColor"),llt.prototype),u(llt.prototype,"miterLimit",[nlt],Object.getOwnPropertyDescriptor(llt.prototype,"miterLimit"),llt.prototype),u(llt.prototype,"color",[fi,slt],Object.getOwnPropertyDescriptor(llt.prototype,"color"),llt.prototype),u(llt.prototype,"srcBlendFactor",[fi,alt],Object.getOwnPropertyDescriptor(llt.prototype,"srcBlendFactor"),llt.prototype),u(llt.prototype,"dstBlendFactor",[fi,olt],Object.getOwnPropertyDescriptor(llt.prototype,"dstBlendFactor"),llt.prototype),ult=u(llt.prototype,"_lineWidth",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),clt=u(llt.prototype,"_strokeColor",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Qs.BLACK.clone()}}),_lt=u(llt.prototype,"_lineJoin",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Xht.MITER}}),dlt=u(llt.prototype,"_lineCap",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return jht.BUTT}}),plt=u(llt.prototype,"_fillColor",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Qs.WHITE.clone()}}),flt=u(llt.prototype,"_miterLimit",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),hlt=llt))||hlt)||hlt)||hlt)||hlt)),$lt=new Hs,tut=new Es,eut=new Hs,iut=[];!function(t){t[t.RECT=0]="RECT",t[t.ELLIPSE=1]="ELLIPSE",t[t.GRAPHICS_STENCIL=2]="GRAPHICS_STENCIL",t[t.IMAGE_STENCIL=3]="IMAGE_STENCIL"}(qlt||(qlt={})),Ft(qlt);var rut,nut,sut,aut,out,hut,lut,uut,cut,_ut,dut,put,fut,mut,gut,vut,yut,Tut,Eut,Sut,but,Aut,Cut,wut=function(e){return t({Mask:e,MaskComponent:e}),e}((Elt=Ne("cc.Mask"),Slt=qe(),blt=Fe(110),Alt=We(),Clt=pi(qlt),wlt=si(),Rlt=$e(),xlt=si(),Olt=$e(),Ilt=Ze(),Mlt=pi(um),Blt=Ze(),Plt=Ze(),Nlt=ti(),Llt=Ze(),Flt=Ze(),Dlt=Ze(),Ult=Ze(),Elt(klt=Slt(klt=blt(klt=Alt((Ylt=Xlt=function(t){function e(){var e;return(e=t.call(this)||this)._clearStencilMtl=null,e._clearModel=null,l(e,"_type",Glt,a(e)),l(e,"_inverted",Hlt,a(e)),l(e,"_segments",Vlt,a(e)),l(e,"_spriteFrame",Wlt,a(e)),l(e,"_alphaThreshold",jlt,a(e)),e._graphics=null,e._instanceMaterialType=dF.ADD_COLOR,e}s(e,t),r(e,[{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type!==qlt.IMAGE_STENCIL||this._spriteFrame||this._attachClearModel(),this._type=t,this.markForUpdateRenderData(!1),this._updateMaterial(),this._type!==qlt.IMAGE_STENCIL?(this._spriteFrame=null,this._updateGraphics(),this._renderData&&(this.destroyRenderData(),this._renderData=null)):(this._useRenderData(),this._spriteFrame||this._detachClearModel(),this._graphics&&this._graphics.clear()))}},{key:"inverted",get:function(){return this._inverted},set:function(t){_.game.renderType!==BO.RENDER_TYPE_CANVAS?(this._inverted=t,this.stencilStage=kL.DISABLED,this._graphics&&(this._graphics.stencilStage=kL.DISABLED)):I(4202)}},{key:"segments",get:function(){return this._segments},set:function(t){this._segments!==t&&(this._segments=Ir(t,3,1e4),this._updateGraphics())}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){if(this._spriteFrame!==t){var e=this._spriteFrame;this._spriteFrame=t,this._type===qlt.IMAGE_STENCIL&&(!e&&t?(this._attachClearModel(),this.markForUpdateRenderData()):t||this._detachClearModel())}}},{key:"alphaThreshold",get:function(){return this._alphaThreshold},set:function(t){var e,i;this._alphaThreshold!==t&&(this._alphaThreshold=t,this.type===qlt.IMAGE_STENCIL&&(null===(e=this._graphics)||void 0===e||null===(i=e.getMaterialInstance(0))||void 0===i||i.setProperty("alphaThreshold",this._alphaThreshold)))}},{key:"graphics",get:function(){return this._graphics}},{key:"dstBlendFactor",get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor!==t&&(this._dstBlendFactor=t,this._updateBlendFunc())}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor!==t&&(this._srcBlendFactor=t,this._updateBlendFunc())}},{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this.markForUpdateRenderData())}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(){}}]);var i=e.prototype;return i.onLoad=function(){this._createClearModel(),this._createGraphics(),this._graphics&&this._graphics.onLoad()},i.onEnable=function(){t.prototype.onEnable.call(this),this._type!==qlt.IMAGE_STENCIL&&this._updateGraphics()},i.onRestore=function(){this._createGraphics(),this._updateGraphics()},i.onDisable=function(){t.prototype.onDisable.call(this),this._disableGraphics()},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._clearModel&&NF.root.destroyModel(this._clearModel),this._clearStencilMtl&&this._clearStencilMtl.destroy(),this._removeGraphics()},i.isHit=function(t){var e=this.node._uiProps.uiTransformComp,i=e.contentSize,r=i.width,n=i.height,s=tut;this.node.getWorldMatrix($lt),Hs.invert(eut,$lt),Es.transformMat4(s,t,eut);var a=e.anchorPoint;s.x+=a.x*r,s.y+=a.y*n;var o=!1;if(this.type===qlt.RECT||this.type===qlt.GRAPHICS_STENCIL)o=s.x>=0&&s.y>=0&&s.x<=r&&s.y<=n;else if(this.type===qlt.ELLIPSE){var h=r/2,l=n/2,u=s.x-.5*r,c=s.y-.5*n;o=u*u/(h*h)+c*c/(l*l)<1}return this._inverted&&(o=!o),o},i._render=function(t){t.commitComp(this,null,this._assembler,null)},i._postRender=function(t){this._postAssembler&&t.commitComp(this,null,this._postAssembler,null)},i._nodeStateChange=function(e){t.prototype._nodeStateChange.call(this,e),this._type!==qlt.RECT&&this._type!==qlt.ELLIPSE||this._updateGraphics()},i._canRender=function(){return!!t.prototype._canRender.call(this)&&null!==this._graphics&&(this._type!==qlt.IMAGE_STENCIL||null!==this._spriteFrame)},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this),i=e.PostAssembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t),this._postAssembler!==i&&(this._postAssembler=i),this._useRenderData()},i._createGraphics=function(){if(!this._graphics){var t=this._graphics=new Jlt;t.node=this.node,t.node.getWorldMatrix(),t.lineWidth=0;var e=Qs.WHITE.clone();e.a=0,t.fillColor=e}this._updateMaterial()},i._updateGraphics=function(){if(this._graphics){var t=this.node._uiProps.uiTransformComp,e=this._graphics;e.clear();var i=t.contentSize,r=i.width,n=i.height,s=t.anchorPoint,a=-r*s.x,o=-n*s.y;if(this._type===qlt.RECT)e.rect(a,o,r,n);else if(this._type===qlt.ELLIPSE){for(var h=function(t,e,i){iut.length=0;for(var r=2*Math.PI/i,n=0;n<i;++n)iut.push(new Cs(e.x*Math.cos(r*n)+t.x,e.y*Math.sin(r*n)+t.y,0));return iut}(new Cs(a+r/2,o+n/2,0),new Cs(r/2,n/2,0),this._segments),l=0;l<h.length;++l){var u=h[l];0===l?e.moveTo(u.x,u.y):e.lineTo(u.x,u.y)}e.close()}e.fill()}},i._createClearModel=function(){if(!this._clearModel){var t,e=wm.get("default-clear-stencil");this._clearStencilMtl=new Lg({parent:e,owner:this,subModelIdx:0}),this._clearModel=NF.root.createModel(aC),this._clearModel.name="clear-model",this._clearModel.node=this._clearModel.transform=this.node;var i=EF(mF),r=_.director.root.device,n=r.createBuffer(new Kl(rl.VERTEX|rl.TRANSFER_DST,nl.DEVICE,4*i,i)),s=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);n.update(s);var a=r.createBuffer(new Kl(rl.INDEX|rl.TRANSFER_DST,nl.DEVICE,6*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT)),o=new Uint16Array([0,1,2,2,1,3]);a.update(o),(t=new xf([n],mF,ol.TRIANGLE_LIST,a)).subMeshIdx=0,this._clearModel.initSubModel(0,t,this._clearStencilMtl),(this._type!==qlt.IMAGE_STENCIL||this._spriteFrame)&&this._attachClearModel()}},i._updateMaterial=function(){if(this._graphics){var t,e=this._graphics;e.stencilStage=kL.DISABLED,this._type===qlt.IMAGE_STENCIL?(t=wm.get("ui-alpha-test-material"),e.setMaterial(t,0),(t=e.getMaterialInstance(0)).setProperty("alphaThreshold",this._alphaThreshold)):(t=wm.get("ui-graphics-material"),e.setMaterial(t,0),e.getMaterialInstance(0))}},i._disableGraphics=function(){this._graphics&&this._graphics.onDisable()},i._removeGraphics=function(){this._graphics&&(this._graphics.destroy(),this._graphics._destroyImmediate(),this._graphics=null)},i._useRenderData=function(){this._type!==qlt.IMAGE_STENCIL||this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this.markForUpdateRenderData())},i._attachClearModel=function(){this._clearModel&&NF.root.ui.renderScene.addModel(this._clearModel)},i._detachClearModel=function(){this._clearModel&&NF.root.ui.renderScene.removeModel(this._clearModel)},e}(fF),Xlt.Type=qlt,u((zlt=Ylt).prototype,"type",[Clt,wlt,Rlt],Object.getOwnPropertyDescriptor(zlt.prototype,"type"),zlt.prototype),u(zlt.prototype,"inverted",[xlt,Olt],Object.getOwnPropertyDescriptor(zlt.prototype,"inverted"),zlt.prototype),u(zlt.prototype,"segments",[Ilt],Object.getOwnPropertyDescriptor(zlt.prototype,"segments"),zlt.prototype),u(zlt.prototype,"spriteFrame",[Mlt,Blt],Object.getOwnPropertyDescriptor(zlt.prototype,"spriteFrame"),zlt.prototype),u(zlt.prototype,"alphaThreshold",[Plt,Nlt,ni],Object.getOwnPropertyDescriptor(zlt.prototype,"alphaThreshold"),zlt.prototype),u(zlt.prototype,"dstBlendFactor",[fi,Llt],Object.getOwnPropertyDescriptor(zlt.prototype,"dstBlendFactor"),zlt.prototype),u(zlt.prototype,"srcBlendFactor",[fi,Flt],Object.getOwnPropertyDescriptor(zlt.prototype,"srcBlendFactor"),zlt.prototype),u(zlt.prototype,"color",[fi,Dlt],Object.getOwnPropertyDescriptor(zlt.prototype,"color"),zlt.prototype),u(zlt.prototype,"customMaterial",[fi,Ult],Object.getOwnPropertyDescriptor(zlt.prototype,"customMaterial"),zlt.prototype),Glt=u(zlt.prototype,"_type",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return qlt.RECT}}),Hlt=u(zlt.prototype,"_inverted",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Vlt=u(zlt.prototype,"_segments",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),Wlt=u(zlt.prototype,"_spriteFrame",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jlt=u(zlt.prototype,"_alphaThreshold",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),klt=zlt))||klt)||klt)||klt)||klt));_.Mask=wut,function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL",t[t.FILLED=2]="FILLED"}(Cut||(Cut={})),Pt(Cut);var Rut,xut,Out,Iut,Mut,But,Put,Nut,Lut,Fut,Dut,Uut,kut,zut,Gut,Hut,Vut,Wut,jut,Xut,Yut,qut,Kut,Zut,Qut,Jut,$ut,tct,ect,ict,rct,nct,sct,act,oct,hct,lct,uct,cct,_ct,dct,pct,fct,mct,gct,vct,yct,Tct=function(e){return t({ProgressBar:e,ProgressBarComponent:e}),e}((rut=Ne("cc.ProgressBar"),nut=qe(),sut=Fe(110),aut=We(),out=Le(Vg),hut=pi(cst),lut=$e(),uut=pi(Cut),cut=$e(),_ut=$e(),dut=ti(),put=$e(),fut=$e(),rut(mut=nut(mut=sut(mut=aut(mut=out((Aut=but=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"_barSprite",vut,a(e)),l(e,"_mode",yut,a(e)),l(e,"_totalLength",Tut,a(e)),l(e,"_progress",Eut,a(e)),l(e,"_reverse",Sut,a(e)),e}s(e,t);var i=e.prototype;return i._initBarSprite=function(){if(this._barSprite){var t=this._barSprite.node;if(!t)return;var e=this.node._uiProps.uiTransformComp,i=e.contentSize,r=e.anchorPoint,n=t._uiProps.uiTransformComp.contentSize;if(this._barSprite.fillType===cst.FillType.RADIAL&&(this._mode=Cut.FILLED),this._mode===Cut.HORIZONTAL?this.totalLength=n.width:this._mode===Cut.VERTICAL?this.totalLength=n.height:this.totalLength=this._barSprite.fillRange,t.parent===this.node){var s=-i.width*r.x;t.setPosition(s,0,0)}}},i._updateBarStatus=function(){if(this._barSprite){var t=this._barSprite.node;if(!t)return;var e=t._uiProps.uiTransformComp,i=e.anchorPoint,r=e.contentSize,n=t.getPosition(),s=new Es(0,.5),a=Mr(this._progress),o=this._totalLength*a,h=r,l=0,u=0;switch(this._mode){case Cut.HORIZONTAL:this._reverse&&(s=new Es(1,.5)),h=new Ys(o,r.height),l=this._totalLength,u=r.height;break;case Cut.VERTICAL:s=this._reverse?new Es(.5,1):new Es(.5,0),h=new Ys(r.width,o),l=r.width,u=this._totalLength}if(this._mode===Cut.FILLED)this._barSprite.type!==cst.Type.FILLED?E("ProgressBar FILLED mode only works when barSprite's Type is FILLED!"):(this._reverse&&(o*=-1),this._barSprite.fillRange=o);else if(this._barSprite.type!==cst.Type.FILLED){var c=s.x-i.x,_=s.y-i.y,d=new Cs(l*c,u*_,0);t.setPosition(n.x+d.x,n.y+d.y,n.z),e.setAnchorPoint(s),e.setContentSize(h)}else E("ProgressBar non-FILLED mode only works when barSprite's Type is non-FILLED!")}},r(e,[{key:"barSprite",get:function(){return this._barSprite},set:function(t){this._barSprite!==t&&(this._barSprite=t,this._initBarSprite())}},{key:"mode",get:function(){return this._mode},set:function(t){if(this._mode!==t&&(this._mode=t,this._barSprite)){var e=this._barSprite.node;if(!e)return;var i=e._uiProps.uiTransformComp.contentSize;this._mode===Cut.HORIZONTAL?this.totalLength=i.width:this._mode===Cut.VERTICAL?this.totalLength=i.height:this._mode===Cut.FILLED&&(this.totalLength=this._barSprite.fillRange)}}},{key:"totalLength",get:function(){return this._totalLength},set:function(t){this._mode===Cut.FILLED&&(t=Mr(t)),this._totalLength=t,this._updateBarStatus()}},{key:"progress",get:function(){return this._progress},set:function(t){this._progress!==t&&(this._progress=t,this._updateBarStatus())}},{key:"reverse",get:function(){return this._reverse},set:function(t){this._reverse!==t&&(this._reverse=t,this._barSprite&&(this._barSprite.fillStart=1-this._barSprite.fillStart),this._updateBarStatus())}}]),e}(ds),but.Mode=Cut,u((gut=Aut).prototype,"barSprite",[hut,lut],Object.getOwnPropertyDescriptor(gut.prototype,"barSprite"),gut.prototype),u(gut.prototype,"mode",[uut,cut],Object.getOwnPropertyDescriptor(gut.prototype,"mode"),gut.prototype),u(gut.prototype,"totalLength",[_ut],Object.getOwnPropertyDescriptor(gut.prototype,"totalLength"),gut.prototype),u(gut.prototype,"progress",[dut,ni,put],Object.getOwnPropertyDescriptor(gut.prototype,"progress"),gut.prototype),u(gut.prototype,"reverse",[fut],Object.getOwnPropertyDescriptor(gut.prototype,"reverse"),gut.prototype),vut=u(gut.prototype,"_barSprite",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yut=u(gut.prototype,"_mode",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Cut.HORIZONTAL}}),Tut=u(gut.prototype,"_totalLength",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Eut=u(gut.prototype,"_progress",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),Sut=u(gut.prototype,"_reverse",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),mut=gut))||mut)||mut)||mut)||mut)||mut)),Ect=function(e){return t({LabelOutline:e,LabelOutlineComponent:e}),e}((Rut=Ne("cc.LabelOutline"),xut=qe(),Out=Fe(110),Iut=We(),Mut=Le(Nat),But=$e(),Put=$e(),Rut(Nut=xut(Nut=Out(Nut=Iut(Nut=Mut(Nut=Ve((Uut=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"_color",Fut,a(e)),l(e,"_width",Dut,a(e)),e}s(e,t);var i=e.prototype;return i.onEnable=function(){this._updateRenderData()},i.onDisable=function(){this._updateRenderData()},i._updateRenderData=function(){var t=this.node.getComponent(Nat);t&&t.updateRenderData(!0)},r(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateRenderData())}},{key:"width",get:function(){return this._width},set:function(t){this._width!==t&&(this._width=t,this._updateRenderData())}}]),e}(ds),Fut=u((Lut=Uut).prototype,"_color",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qs(0,0,0,255)}}),Dut=u(Lut.prototype,"_width",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),u(Lut.prototype,"color",[But],Object.getOwnPropertyDescriptor(Lut.prototype,"color"),Lut.prototype),u(Lut.prototype,"width",[Put],Object.getOwnPropertyDescriptor(Lut.prototype,"width"),Lut.prototype),Nut=Lut))||Nut)||Nut)||Nut)||Nut)||Nut)||Nut)),Sct=new vd,bct=new Ot((function(t){if(!_.isValid(t.node))return!1;var e=t.node.getComponent(Ect);return e&&(e.width=0),!0}),20);bct.get=function(t){var e=this._get();e||(e={node:new YP("RICHTEXT_CHILD"),comp:null,lineCount:0,styleIndex:0,imageOffset:"",clickParam:"",clickHandler:""});var i=e.node;i||(i=new YP("RICHTEXT_CHILD"));var r=i.getComponent(Nat);return r||(r=i.addComponent(Nat)),r.string=t,r.horizontalAlign=vat.LEFT,r.verticalAlign=yat.TOP,i.setPosition(0,0,0),i._uiProps.uiTransformComp.setAnchorPoint(.5,.5),{node:i,comp:r,lineCount:0,styleIndex:0,imageOffset:"",clickParam:"",clickHandler:""}};var Act,Cct,wct,Rct,xct,Oct,Ict,Mct,Bct,Pct,Nct,Lct,Fct,Dct,Uct,kct,zct,Gct,Hct,Vct,Wct,jct,Xct,Yct,qct,Kct=function(e){return t({RichText:e,RichTextComponent:e}),e}((kut=Ne("cc.RichText"),zut=qe(),Gut=Fe(110),Hut=We(),Vut=$e(),Wut=pi(vat),jut=$e(),Xut=$e(),Yut=$e(),qut=pi(Jx),Kut=$e(),Zut=$e(),Qut=pi(Eat),Jut=$e(),$ut=$e(),tct=$e(),ect=pi(zx),ict=$e(),rct=$e(),kut(nct=zut(nct=Gut(nct=Hut(nct=Ve((yct=vct=function(t){function e(){var e;return l(e=t.call(this)||this,"_lineHeight",act,a(e)),l(e,"_string",oct,a(e)),l(e,"_horizontalAlign",hct,a(e)),l(e,"_fontSize",lct,a(e)),l(e,"_maxWidth",uct,a(e)),l(e,"_fontFamily",cct,a(e)),l(e,"_font",_ct,a(e)),l(e,"_isSystemFontUsed",dct,a(e)),l(e,"_userDefinedFont",pct,a(e)),l(e,"_cacheMode",fct,a(e)),l(e,"_imageAtlas",mct,a(e)),l(e,"_handleTouchEvent",gct,a(e)),e._textArray=[],e._labelSegments=[],e._labelSegmentsCache=[],e._linesWidth=[],e._lineCount=1,e._labelWidth=0,e._labelHeight=0,e._layoutDirty=!0,e._lineOffsetX=0,e._updateRichTextStatus=void 0,e._updateRichTextStatus=e._updateRichText,e}s(e,t),r(e,[{key:"string",get:function(){return this._string},set:function(t){this._string!==t&&(this._string=t,this._updateRichTextStatus())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(t){this.horizontalAlign!==t&&(this._horizontalAlign=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"font",get:function(){return this._font},set:function(t){this._font!==t&&(this._font=t,this._layoutDirty=!0,this._font?(this.useSystemFont=!1,this._onTTFLoaded()):this.useSystemFont=!0,this._updateRichTextStatus())}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this._isSystemFontUsed=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(t){this._cacheMode!==t&&(this._cacheMode=t,this._updateRichTextStatus())}},{key:"maxWidth",get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"imageAtlas",get:function(){return this._imageAtlas},set:function(t){this._imageAtlas!==t&&(this._imageAtlas=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"handleTouchEvent",get:function(){return this._handleTouchEvent},set:function(t){this._handleTouchEvent!==t&&(this._handleTouchEvent=t,this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners()))}}]);var i=e.prototype;return i.onEnable=function(){this.handleTouchEvent&&this._addEventListeners(),this._updateRichText(),this._activateChildren(!0)},i.onDisable=function(){this.handleTouchEvent&&this._removeEventListeners(),this._activateChildren(!1)},i.start=function(){this._onTTFLoaded(),this.node.on(py.EventType.ANCHOR_CHANGED,this._updateRichTextPosition,this)},i.onRestore=function(){},i.onDestroy=function(){for(var t,e=h(this._labelSegments);!(t=e()).done;){var i=t.value;i.node.removeFromParent(),bct.put(i)}this.node.off(py.EventType.ANCHOR_CHANGED,this._updateRichTextPosition,this)},i._addEventListeners=function(){this.node.on(py.EventType.TOUCH_END,this._onTouchEnded,this)},i._removeEventListeners=function(){this.node.off(py.EventType.TOUCH_END,this._onTouchEnded,this)},i._updateLabelSegmentTextAttributes=function(){var t=this;this._labelSegments.forEach((function(e){t._applyTextAttribute(e)}))},i._createFontLabel=function(t){return bct.get(t,this)},i._onTTFLoaded=function(){var t=this;this._font instanceof hO?this._font._nativeAsset?(this._layoutDirty=!0,this._updateRichText()):$D.postLoadNative(this._font,(function(){t.isValid&&(t._layoutDirty=!0,t._updateRichText())})):(this._layoutDirty=!0,this._updateRichText())},i._measureText=function(t,e){var i=this,r=function(e){var r;return 0===i._labelSegmentsCache.length?(r=i._createFontLabel(e),i._labelSegmentsCache.push(r)):(r=i._labelSegmentsCache[0]).node.getComponent(Nat).string=e,r.styleIndex=t,i._applyTextAttribute(r),r.node._uiProps.uiTransformComp.contentSize.width};return e?r(e):r},i._onTouchEnded=function(t){for(var e,i=this,r=this.node.getComponents(ds),n=function(){var n=e.value,s=n.clickHandler,a=n.clickParam;s&&i._containsTouchLocation(n,t.touch.getUILocation())&&(r.forEach((function(e){var i=e[s];e.enabledInHierarchy&&i&&i.call(e,t,a)})),t.propagationStopped=!0)},s=h(this._labelSegments);!(e=s()).done;)n()},i._containsTouchLocation=function(t,e){var i=t.node.getComponent(Vg);return!!i&&i.getBoundingBoxToWorld().contains(e)},i._resetState=function(){for(var t=this,e=this.node.children,i=function(i){var r=e[i];if(("RICHTEXT_CHILD"===r.name||"RICHTEXT_Image_CHILD"===r.name)&&(r.parent===t.node?r.parent=null:e.splice(i,1),"RICHTEXT_CHILD"===r.name)){var n=t._labelSegments.findIndex((function(t){return t.node===r}));-1!==n&&bct.put(t._labelSegments[n])}},r=e.length-1;r>=0;r--)i(r);e.length=0,this._labelSegments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0},i._activateChildren=function(t){for(var e=this.node.children.length-1;e>=0;e--){var i=this.node.children[e];"RICHTEXT_CHILD"!==i.name&&"RICHTEXT_Image_CHILD"!==i.name||(i.active=t)}},i._addLabelSegment=function(t,e){var i;if(0===this._labelSegmentsCache.length)i=this._createFontLabel(t);else{var r=(i=this._labelSegmentsCache.pop()).node.getComponent(Nat);r&&(r.string=t)}return i.styleIndex=e,i.lineCount=this._lineCount,i.node._uiProps.uiTransformComp.setAnchorPoint(0,0),this._applyTextAttribute(i),this.node.addChild(i.node),this._labelSegments.push(i),i},i._updateRichTextWithMaxWidth=function(t,e,i){var r=e;if(this._lineOffsetX>0&&r+this._lineOffsetX>this._maxWidth)for(var n=0;this._lineOffsetX<=this._maxWidth;){var s=this._getFirstWordLen(t,n,t.length),a=t.substr(n,s),o=this._measureText(i,a);if(!(this._lineOffsetX+o<=this._maxWidth)){if(n>0){var h=t.substr(0,n);this._addLabelSegment(h,i),t=t.substr(n,t.length),r=this._measureText(i,t)}this._updateLineInfo();break}this._lineOffsetX+=o,n+=s}if(r>this._maxWidth)for(var l=sd(t,r,this._maxWidth,this._measureText(i)),u=0;u<l.length;++u){var c=l[u],_=this._addLabelSegment(c,i).node._uiProps.uiTransformComp.contentSize;this._lineOffsetX+=_.width,l.length>1&&u<l.length-1&&this._updateLineInfo()}else this._lineOffsetX+=r,this._addLabelSegment(t,i)},i._isLastComponentCR=function(t){return t.length-1===t.lastIndexOf("\n")},i._updateLineInfo=function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++},i._needsUpdateTextLayout=function(t){if(this._layoutDirty||!this._textArray||!t)return!0;if(this._textArray.length!==t.length)return!0;for(var e=0;e<this._textArray.length;e++){var i=this._textArray[e],r=t[e];if(i.text!==r.text)return!0;var n=i.style,s=r.style;if(n){if(s){if(!!s.outline!=!!n.outline)return!0;if(n.size!==s.size||n.italic!==s.italic||n.isImage!==s.isImage)return!0;if(n.src!==s.src||n.imageAlign!==s.imageAlign||n.imageHeight!==s.imageHeight||n.imageWidth!==s.imageWidth||n.imageOffset!==s.imageOffset)return!0}else if(n.size||n.italic||n.isImage||n.outline)return!0}else if(s&&(s.size||s.italic||s.isImage||s.outline))return!0}return!1},i._addRichTextImageElement=function(t){if(t.style){var e=t.style,i=e.src,r=this._imageAtlas&&i&&this._imageAtlas.getSpriteFrame(i);if(r){var n=new YP("RICHTEXT_Image_CHILD"),s=n.addComponent(cst);switch(e.imageAlign){case"top":n._uiProps.uiTransformComp.setAnchorPoint(0,1);break;case"center":n._uiProps.uiTransformComp.setAnchorPoint(0,.5);break;default:n._uiProps.uiTransformComp.setAnchorPoint(0,0)}s.type=cst.Type.SLICED,s.sizeMode=cst.SizeMode.CUSTOM,s.spriteFrame=r,this.node.addChild(n);var a={node:n,comp:s,lineCount:0,styleIndex:0,imageOffset:e.imageOffset||"",clickParam:"",clickHandler:""};this._labelSegments.push(a);var o=r.rect.clone(),h=1,l=o.width,u=o.height,c=e.imageWidth||0,_=e.imageHeight||0;_>0?(l*=h=_/u,u*=h):(l*=h=this._lineHeight/u,u*=h),c>0&&(l=c),this._maxWidth>0?(this._lineOffsetX+l>this._maxWidth&&this._updateLineInfo(),this._lineOffsetX+=l):(this._lineOffsetX+=l,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),n._uiProps.uiTransformComp.setContentSize(l,u),a.lineCount=this._lineCount,a.clickHandler="",a.clickParam="";var d=e.event;d&&(a.clickHandler=d.click,a.clickParam=d.param)}else I(4400)}},i._updateRichText=function(){if(this.enabledInHierarchy){var t=Sct.parse(this._string);if(!this._needsUpdateTextLayout(t))return this._textArray=t.slice(),void this._updateLabelSegmentTextAttributes();this._textArray=t.slice(),this._resetState();for(var e,i=!1,r=0;r<this._textArray.length;++r){var n=this._textArray[r],s=n.text;if(void 0!==s){if(""===s){if(n.style&&n.style.isNewLine){this._updateLineInfo();continue}if(n.style&&n.style.isImage&&this._imageAtlas){this._addRichTextImageElement(n);continue}}for(var a=s.split("\n"),o=0;o<a.length;++o){var h=a[o];if(""!==h)if(i=!1,this._maxWidth>0){var l=this._measureText(r,h);this._updateRichTextWithMaxWidth(h,l,r),a.length>1&&o<a.length-1&&this._updateLineInfo()}else e=this._addLabelSegment(h,r),this._lineOffsetX+=e.node._uiProps.uiTransformComp.width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX),a.length>1&&o<a.length-1&&this._updateLineInfo();else{if(this._isLastComponentCR(s)&&o===a.length-1)continue;this._updateLineInfo(),i=!0}}}}i||this._linesWidth.push(this._lineOffsetX),this._maxWidth>0&&(this._labelWidth=this._maxWidth),this._labelHeight=(this._lineCount+X_)*this._lineHeight,this.node._uiProps.uiTransformComp.setContentSize(this._labelWidth,this._labelHeight),this._updateRichTextPosition(),this._layoutDirty=!1}},i._getFirstWordLen=function(t,e,i){var r=t.charAt(e);if(ed(r)||id(r))return 1;for(var n=1,s=e+1;s<i&&!id(r=t.charAt(s))&&!ed(r);++s)n++;return n},i._updateRichTextPosition=function(){for(var t=0,e=1,i=this._lineCount,r=this.node._uiProps.uiTransformComp,n=r.anchorX,s=r.anchorY,a=0;a<this._labelSegments.length;++a){var o=this._labelSegments[a],h=o.lineCount;h>e&&(t=0,e=h);var l=this._labelWidth*(.5*this._horizontalAlign-n);switch(this._horizontalAlign){case vat.LEFT:break;case vat.CENTER:l-=this._linesWidth[h-1]/2;break;case vat.RIGHT:l-=this._linesWidth[h-1]}var u=o.node.position;if(o.node.setPosition(t+l,this._lineHeight*(i-h)-this._labelHeight*s,u.z),h===e&&(t+=o.node._uiProps.uiTransformComp.width),o.node.getComponent(cst)){var c=o.node.position.clone(),_=this._lineHeight,d=this._lineHeight*(1+X_);switch(o.node._uiProps.uiTransformComp.anchorY){case 1:c.y+=_+(d-_)/2;break;case.5:c.y+=d/2;break;default:c.y+=(d-_)/2}if(o.imageOffset){var p=o.imageOffset.split(",");if(1===p.length&&p[0]){var f=parseFloat(p[0]);Number.isInteger(f)&&(c.y+=f)}else if(2===p.length){var m=parseFloat(p[0]),g=parseFloat(p[1]);Number.isInteger(m)&&(c.x+=m),Number.isInteger(g)&&(c.y+=g)}}o.node.position=c}var v=o.node.getComponent(Ect);if(v){var y=o.node.position.clone();y.y=y.y-v.width,o.node.position=y}}},i._convertLiteralColorValue=function(t){var e=t.toUpperCase();return Qs[e]?Qs[e]:(new Qs).fromHEX(t)},i._applyTextAttribute=function(t){var e=t.node.getComponent(Nat);if(e){var i,r=t.styleIndex;if(this._textArray[r]&&(i=this._textArray[r].style),i){if(e.color=this._convertLiteralColorValue(i.color||"white"),e.isBold=!!i.bold,e.isItalic=!!i.italic,e.isUnderline=!!i.underline,i.outline){var n=t.node.getComponent(Ect);n||(n=t.node.addComponent(Ect)),n.color=this._convertLiteralColorValue(i.outline.color),n.width=i.outline.width}e.fontSize=i.size||this._fontSize,t.clickHandler="",t.clickParam="";var s=i.event;s&&(t.clickHandler=s.click||"",t.clickParam=s.param||"")}else e.fontSize=this._fontSize;e.cacheMode=this._cacheMode,this._font instanceof Jx&&!this._isSystemFontUsed?e.font=this._font:e.fontFamily=this._fontFamily,e.useSystemFont=this._isSystemFontUsed,e.lineHeight=this._lineHeight,e.updateRenderData(!0)}},e}(zL),vct.HorizontalAlign=vat,vct.VerticalAlign=yat,u((sct=yct).prototype,"string",[hi,Vut],Object.getOwnPropertyDescriptor(sct.prototype,"string"),sct.prototype),u(sct.prototype,"horizontalAlign",[Wut,jut],Object.getOwnPropertyDescriptor(sct.prototype,"horizontalAlign"),sct.prototype),u(sct.prototype,"fontSize",[Xut],Object.getOwnPropertyDescriptor(sct.prototype,"fontSize"),sct.prototype),u(sct.prototype,"fontFamily",[Yut],Object.getOwnPropertyDescriptor(sct.prototype,"fontFamily"),sct.prototype),u(sct.prototype,"font",[qut,Kut],Object.getOwnPropertyDescriptor(sct.prototype,"font"),sct.prototype),u(sct.prototype,"useSystemFont",[Zut],Object.getOwnPropertyDescriptor(sct.prototype,"useSystemFont"),sct.prototype),u(sct.prototype,"cacheMode",[Qut,Jut],Object.getOwnPropertyDescriptor(sct.prototype,"cacheMode"),sct.prototype),u(sct.prototype,"maxWidth",[$ut],Object.getOwnPropertyDescriptor(sct.prototype,"maxWidth"),sct.prototype),u(sct.prototype,"lineHeight",[tct],Object.getOwnPropertyDescriptor(sct.prototype,"lineHeight"),sct.prototype),u(sct.prototype,"imageAtlas",[ect,ict],Object.getOwnPropertyDescriptor(sct.prototype,"imageAtlas"),sct.prototype),u(sct.prototype,"handleTouchEvent",[rct],Object.getOwnPropertyDescriptor(sct.prototype,"handleTouchEvent"),sct.prototype),act=u(sct.prototype,"_lineHeight",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),oct=u(sct.prototype,"_string",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"<color=#00ff00>Rich</color><color=#0fffff>Text</color>"}}),hct=u(sct.prototype,"_horizontalAlign",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return vat.LEFT}}),lct=u(sct.prototype,"_fontSize",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),uct=u(sct.prototype,"_maxWidth",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),cct=u(sct.prototype,"_fontFamily",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Arial"}}),_ct=u(sct.prototype,"_font",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dct=u(sct.prototype,"_isSystemFontUsed",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),pct=u(sct.prototype,"_userDefinedFont",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fct=u(sct.prototype,"_cacheMode",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Eat.NONE}}),mct=u(sct.prototype,"_imageAtlas",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gct=u(sct.prototype,"_handleTouchEvent",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),nct=sct))||nct)||nct)||nct)||nct)||nct)),Zct=new Cs,Qct=new Cs,Jct=new Cs,$ct=new Es,t_t=new Qs;!function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(qct||(qct={})),Ft(qct);var e_t,i_t,r_t,n_t,s_t,a_t,o_t,h_t,l_t,u_t,c_t,__t,d_t,p_t,f_t,m_t,g_t,v_t,y_t,T_t,E_t,S_t,b_t,A_t,C_t,w_t,R_t,x_t,O_t,I_t,M_t,B_t,P_t,N_t,L_t,F_t,D_t,U_t,k_t,z_t,G_t,H_t,V_t,W_t,j_t,X_t,Y_t,q_t,K_t,Z_t=function(e){return t({ScrollBar:e,ScrollBarComponent:e}),e}((Act=Ne("cc.ScrollBar"),Cct=qe(),wct=Fe(110),Rct=We(),xct=Le(Vg),Oct=pi(cst),Ict=si(),Mct=$e(),Bct=pi(qct),Pct=si(),Nct=$e(),Lct=si(),Fct=$e(),Dct=si(),Uct=$e(),Act(kct=Cct(kct=wct(kct=Rct(kct=xct((Yct=Xct=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"_scrollView",Gct,a(e)),l(e,"_handle",Hct,a(e)),l(e,"_direction",Vct,a(e)),l(e,"_enableAutoHide",Wct,a(e)),l(e,"_autoHideTime",jct,a(e)),e._touching=!1,e._opacity=255,e._autoHideRemainingTime=0,e}s(e,t);var i=e.prototype;return i.hide=function(){this._autoHideRemainingTime=0,this._setOpacity(0)},i.show=function(){this._autoHideRemainingTime=this._autoHideTime,this._setOpacity(this._opacity)},i.onScroll=function(t){if(this._scrollView){var e=this._scrollView.content;if(e){var i=e._uiProps.uiTransformComp.contentSize,r=this._scrollView.node._uiProps.uiTransformComp.contentSize,n=this.node._uiProps.uiTransformComp.contentSize;if(!this._conditionalDisableScrollBar(i,r)){this._enableAutoHide&&(this._autoHideRemainingTime=this._autoHideTime,this._setOpacity(this._opacity));var s=0,a=0,o=0,h=0,l=0;this._direction===qct.HORIZONTAL?(s=i.width,a=r.width,l=n.width,o=t.x,h=-this._convertToScrollViewSpace(e).x):this._direction===qct.VERTICAL&&(s=i.height,a=r.height,l=n.height,o=t.y,h=-this._convertToScrollViewSpace(e).y);var u=this._calculateLength(s,a,l,o),c=this._calculatePosition(s,a,l,h,o,u);this._updateLength(u),this._updateHandlerPosition(c)}}}},i.setScrollView=function(t){this._scrollView=t},i.onTouchBegan=function(){this._enableAutoHide&&(this._touching=!0)},i.onTouchEnded=function(){if(this._enableAutoHide&&(this._touching=!1,!(this._autoHideTime<=0))){if(this._scrollView){var t=this._scrollView.content;if(t){var e=t._uiProps.uiTransformComp.contentSize,i=this._scrollView.node._uiProps.uiTransformComp.contentSize;if(this._conditionalDisableScrollBar(e,i))return}}this._autoHideRemainingTime=this._autoHideTime}},i.onEnable=function(){var t=this.node.getComponent(cst);t&&(this._opacity=t.color.a)},i.start=function(){this._enableAutoHide&&this._setOpacity(0)},i.update=function(t){this._processAutoHide(t)},i._convertToScrollViewSpace=function(t){var e=this._scrollView&&this._scrollView.node._uiProps.uiTransformComp,i=t._uiProps.uiTransformComp;if(!e||!i)return Zct;Qct.set(-i.anchorX*i.width,-i.anchorY*i.height,0),i.convertToWorldSpaceAR(Qct,Jct);var r=e.convertToNodeSpaceAR(Jct);return r.x+=e.anchorX*e.width,r.y+=e.anchorY*e.height,r},i._setOpacity=function(t){if(this._handle){var e=this.node.getComponent(cst);e&&(t_t.set(e.color),t_t.a=t,e.color=t_t),(e=this._handle.getComponent(cst))&&(t_t.set(e.color),t_t.a=t,e.color=t_t)}},i._updateHandlerPosition=function(t){if(this._handle){var e=this._fixupHandlerPosition();this._handle.node.setPosition(t.x+e.x,t.y+e.y,e.z)}},i._fixupHandlerPosition=function(){var t=this.node._uiProps.uiTransformComp,e=t.contentSize,i=t.anchorPoint,r=this.handle.node._uiProps.uiTransformComp.contentSize,n=this.handle.node.parent;Cs.set(Qct,-e.width*i.x,-e.height*i.y,0);var s=this.node._uiProps.uiTransformComp.convertToWorldSpaceAR(Qct,Jct),a=new Cs;return n._uiProps.uiTransformComp.convertToNodeSpaceAR(s,a),this.direction===qct.HORIZONTAL?a=new Cs(a.x,a.y+(e.height-r.height)/2,0):this.direction===qct.VERTICAL&&(a=new Cs(a.x+(e.width-r.width)/2,a.y,0)),this.handle.node.setPosition(a),a},i._conditionalDisableScrollBar=function(t,e){return t.width<=e.width&&this._direction===qct.HORIZONTAL||t.height<=e.height&&this._direction===qct.VERTICAL},i._calculateLength=function(t,e,i,r){var n=t;return r&&(n+=20*(r>0?r:-r)),i*(e/n)},i._calculatePosition=function(t,e,i,r,n,s){var a=t-e;n&&(a+=Math.abs(n));var o=0;a&&(o=Mr(o=r/a));var h=(i-s)*o;return this._direction===qct.VERTICAL?new Cs(0,h,0):new Cs(h,0,0)},i._updateLength=function(t){if(this._handle){var e=this._handle.node._uiProps.uiTransformComp,i=e.contentSize,r=e.anchorPoint;r.x===$ct.x&&r.y===$ct.y||e.setAnchorPoint($ct),this._direction===qct.HORIZONTAL?e.setContentSize(t,i.height):e.setContentSize(i.width,t)}},i._processAutoHide=function(t){if(this._enableAutoHide&&!(this._autoHideRemainingTime<=0)&&!this._touching&&(this._autoHideRemainingTime-=t,this._autoHideRemainingTime<=this._autoHideTime)){this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime);var e=this._opacity*(this._autoHideRemainingTime/this._autoHideTime);this._setOpacity(e)}},r(e,[{key:"handle",get:function(){return this._handle},set:function(t){this._handle!==t&&(this._handle=t,this.onScroll(Zct))}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this.onScroll(new Cs))}},{key:"enableAutoHide",get:function(){return this._enableAutoHide},set:function(t){this._enableAutoHide!==t&&(this._enableAutoHide=t,this._enableAutoHide&&this._setOpacity(0))}},{key:"autoHideTime",get:function(){return this._autoHideTime},set:function(t){this._autoHideTime!==t&&(this._autoHideTime=t)}}]),e}(ds),Xct.Direction=qct,u((zct=Yct).prototype,"handle",[Oct,Ict,Mct],Object.getOwnPropertyDescriptor(zct.prototype,"handle"),zct.prototype),u(zct.prototype,"direction",[Bct,Pct,Nct],Object.getOwnPropertyDescriptor(zct.prototype,"direction"),zct.prototype),u(zct.prototype,"enableAutoHide",[Lct,Fct],Object.getOwnPropertyDescriptor(zct.prototype,"enableAutoHide"),zct.prototype),u(zct.prototype,"autoHideTime",[Dct,Uct],Object.getOwnPropertyDescriptor(zct.prototype,"autoHideTime"),zct.prototype),Gct=u(zct.prototype,"_scrollView",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Hct=u(zct.prototype,"_handle",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Vct=u(zct.prototype,"_direction",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return qct.HORIZONTAL}}),Wct=u(zct.prototype,"_enableAutoHide",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),jct=u(zct.prototype,"_autoHideTime",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),kct=zct))||kct)||kct)||kct)||kct)||kct)),Q_t=t("ViewGroup",Ne("cc.ViewGroup")(e_t=Fe(110)(e_t=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e}(ds))||e_t)||e_t);_.ViewGroup=Q_t;var J_t,$_t=new Cs,tdt=new Cs,edt=new Cs,idt=new Es,rdt=new Es,ndt=function(){return(new Date).getMilliseconds()},sdt={"scroll-to-top":0,"scroll-to-bottom":1,"scroll-to-left":2,"scroll-to-right":3,scrolling:4,"bounce-bottom":6,"bounce-left":7,"bounce-right":8,"bounce-top":5,"scroll-ended":9,"touch-up":10,"scroll-ended-with-threshold":11,"scroll-began":12};!function(t){t.SCROLL_TO_TOP="scroll-to-top",t.SCROLL_TO_BOTTOM="scroll-to-bottom",t.SCROLL_TO_LEFT="scroll-to-left",t.SCROLL_TO_RIGHT="scroll-to-right",t.SCROLL_BEGAN="scroll-began",t.SCROLL_ENDED="scroll-ended",t.BOUNCE_TOP="bounce-top",t.BOUNCE_BOTTOM="bounce-bottom",t.BOUNCE_LEFT="bounce-left",t.BOUNCE_RIGHT="bounce-right",t.SCROLLING="scrolling",t.SCROLL_ENG_WITH_THRESHOLD="scroll-ended-with-threshold",t.TOUCH_UP="touch-up"}(J_t||(J_t={}));var adt,odt,hdt,ldt,udt,cdt,_dt,ddt,pdt,fdt,mdt,gdt,vdt,ydt,Tdt,Edt,Sdt,bdt,Adt,Cdt,wdt,Rdt,xdt=function(e){return t({ScrollView:e,ScrollViewComponent:e}),e}((i_t=Ne("cc.ScrollView"),r_t=qe(),n_t=Fe(110),s_t=We(),a_t=Le(Vg),o_t=ti(),h_t=si(),l_t=$e(),u_t=ti(),c_t=si(),__t=$e(),d_t=si(),p_t=$e(),f_t=si(),m_t=$e(),g_t=pi(py),v_t=si(),y_t=$e(),T_t=si(),E_t=$e(),S_t=pi(Z_t),b_t=si(),A_t=$e(),C_t=si(),w_t=$e(),R_t=pi(Z_t),x_t=si(),O_t=$e(),I_t=si(),M_t=$e(),B_t=pi([BP]),P_t=si(),N_t=$e(),i_t(L_t=r_t(L_t=n_t(L_t=s_t(L_t=a_t((K_t=q_t=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"bounceDuration",D_t,a(e)),l(e,"brake",U_t,a(e)),l(e,"elastic",k_t,a(e)),l(e,"inertia",z_t,a(e)),l(e,"horizontal",G_t,a(e)),l(e,"vertical",H_t,a(e)),l(e,"cancelInnerEvents",V_t,a(e)),l(e,"scrollEvents",W_t,a(e)),e._autoScrolling=!1,e._scrolling=!1,l(e,"_content",j_t,a(e)),l(e,"_horizontalScrollBar",X_t,a(e)),l(e,"_verticalScrollBar",Y_t,a(e)),e._topBoundary=0,e._bottomBoundary=0,e._leftBoundary=0,e._rightBoundary=0,e._touchMoveDisplacements=[],e._touchMoveTimeDeltas=[],e._touchMovePreviousTimestamp=0,e._touchMoved=!1,e._autoScrollAttenuate=!1,e._autoScrollStartPosition=new Cs,e._autoScrollTargetDelta=new Cs,e._autoScrollTotalTime=0,e._autoScrollAccumulatedTime=0,e._autoScrollCurrentlyOutOfBoundary=!1,e._autoScrollBraking=!1,e._autoScrollBrakingStartPosition=new Cs,e._outOfBoundaryAmount=new Cs,e._outOfBoundaryAmountDirty=!0,e._stopMouseWheel=!1,e._mouseWheelEventElapsedTime=0,e._isScrollEndedWithThresholdEventFired=!1,e._scrollEventEmitMask=0,e._isBouncing=!1,e._contentPos=new Cs,e._deltaPos=new Cs,e}s(e,t);var i=e.prototype;return i.scrollToBottom=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new Es(0,0),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i,!0)},i.scrollToTop=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new Es(0,1),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToLeft=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new Es(0,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToRight=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new Es(1,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToTopLeft=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new Es(0,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToTopRight=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new Es(1,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToBottomLeft=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new Es(0,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToBottomRight=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new Es(1,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToOffset=function(t,e,i){void 0===i&&(i=!0);var r=this.getMaxScrollOffset(),n=new Es(0,0);0===r.x?n.x=0:n.x=t.x/r.x,0===r.y?n.y=1:n.y=(r.y-t.y)/r.y,this.scrollTo(n,e,i)},i.getScrollOffset=function(){var t=this._getContentTopBoundary()-this._topBoundary,e=this._getContentLeftBoundary()-this._leftBoundary;return new Cs(e,t,0)},i.getMaxScrollOffset=function(){if(!this._content||!this.view)return $_t;var t=this._content._uiProps.uiTransformComp.contentSize,e=t.width-this.view.width,i=t.height-this.view.height;return new Cs(e=e>=0?e:0,i=i>=0?i:0,0)},i.scrollToPercentHorizontal=function(t,e,i){var r=this._calculateMovePercentDelta({anchor:new Es(t,0),applyToHorizontal:!0,applyToVertical:!1});e?this._startAutoScroll(r,e,!1!==i):this._moveContent(r)},i.scrollTo=function(t,e,i){var r=this._calculateMovePercentDelta({anchor:new Es(t),applyToHorizontal:!0,applyToVertical:!0});e?this._startAutoScroll(r,e,i):this._moveContent(r)},i.scrollToPercentVertical=function(t,e,i){var r=this._calculateMovePercentDelta({anchor:new Es(0,t),applyToHorizontal:!1,applyToVertical:!0});e?this._startAutoScroll(r,e,i):this._moveContent(r)},i.stopAutoScroll=function(){this._autoScrolling=!1,this._autoScrollAccumulatedTime=this._autoScrollTotalTime},i.setContentPosition=function(t){if(this._content){var e=this.getContentPosition();Math.abs(t.x-e.x)<1e-4&&Math.abs(t.y-e.y)<1e-4||(this._content.setPosition(t),this._outOfBoundaryAmountDirty=!0)}},i.getContentPosition=function(){return this._content?(this._contentPos.set(this._content.position),this._contentPos):$_t},i.isScrolling=function(){return this._scrolling},i.isAutoScrolling=function(){return this._autoScrolling},i.getScrollEndedEventTiming=function(){return 1e-4},i.start=function(){this._calculateBoundary(),this._content&&NF.once(PF.EVENT_BEFORE_DRAW,this._adjustContentOutOfBoundary,this)},i.onEnable=function(){this._registerEvent(),this._content&&(this._content.on(py.EventType.SIZE_CHANGED,this._calculateBoundary,this),this._content.on(py.EventType.TRANSFORM_CHANGED,this._scaleChanged,this),this.view&&(this.view.node.on(py.EventType.TRANSFORM_CHANGED,this._scaleChanged,this),this.view.node.on(py.EventType.SIZE_CHANGED,this._calculateBoundary,this))),this._calculateBoundary(),this._updateScrollBarState()},i.update=function(t){this._autoScrolling&&this._processAutoScrolling(t)},i.onDisable=function(){this._unregisterEvent(),this._content&&(this._content.off(py.EventType.SIZE_CHANGED,this._calculateBoundary,this),this._content.off(py.EventType.TRANSFORM_CHANGED,this._scaleChanged,this),this.view&&(this.view.node.off(py.EventType.TRANSFORM_CHANGED,this._scaleChanged,this),this.view.node.off(py.EventType.SIZE_CHANGED,this._calculateBoundary,this))),this._hideScrollBar(),this.stopAutoScroll()},i._registerEvent=function(){this.node.on(py.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.on(py.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.on(py.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.on(py.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.on(py.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},i._unregisterEvent=function(){this.node.off(py.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.off(py.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.off(py.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.off(py.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.off(py.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},i._onMouseWheel=function(t,e){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)){var i=new Cs,r=t.getScrollY();this.vertical?i.set(0,-.1*r,0):this.horizontal&&i.set(-.1*r,0,0),this._mouseWheelEventElapsedTime=0,this._processDeltaMove(i),this._stopMouseWheel||(this._handlePressLogic(),this.schedule(this._checkMouseWheel,1/60,NaN,0),this._stopMouseWheel=!0),this._stopPropagationIfTargetIsMe(t)}},i._onTouchBegan=function(t,e){this.enabledInHierarchy&&this._content&&(this._hasNestedViewGroup(t,e)||(this._handlePressLogic(),this._touchMoved=!1,this._stopPropagationIfTargetIsMe(t)))},i._onTouchMoved=function(t,e){if(this.enabledInHierarchy&&this._content&&!this._hasNestedViewGroup(t,e)){var i=t.touch;if(this._handleMoveLogic(i),this.cancelInnerEvents){var r=i.getUILocation(idt);if(r.subtract(i.getUIStartLocation(rdt)),r.length()>7&&!this._touchMoved&&t.target!==this.node){var n=new Yg(t.getTouches(),t.bubbles);n.type=py.EventType.TOUCH_CANCEL,n.touch=t.touch,n.simulate=!0,t.target.dispatchEvent(n),this._touchMoved=!0}this._stopPropagationIfTargetIsMe(t)}}},i._onTouchEnded=function(t,e){if(this.enabledInHierarchy&&this._content&&t&&!this._hasNestedViewGroup(t,e)){this._dispatchEvent(J_t.TOUCH_UP);var i=t.touch;this._handleReleaseLogic(i),this._touchMoved?t.propagationStopped=!0:this._stopPropagationIfTargetIsMe(t)}},i._onTouchCancelled=function(t,e){if(this.enabledInHierarchy&&this._content&&!this._hasNestedViewGroup(t,e)){if(t&&!t.simulate){var i=t.touch;this._handleReleaseLogic(i)}this._stopPropagationIfTargetIsMe(t)}},i._calculateBoundary=function(){if(this._content&&this.view){var t=this._content.getComponent(Tlt);t&&t.enabledInHierarchy&&t.updateLayout();var e=this.view,i=e.width*e.anchorX,r=e.height*e.anchorY;this._leftBoundary=-i,this._bottomBoundary=-r,this._rightBoundary=this._leftBoundary+e.width,this._topBoundary=this._bottomBoundary+e.height,this._moveContentToTopLeft(e.contentSize)}},i._hasNestedViewGroup=function(t,e){if(t&&t.eventPhase===Gi.CAPTURING_PHASE){if(e)for(var i,r=h(e);!(i=r()).done;){var n=i.value;if(this.node===n)return!(!t.target||!t.target.getComponent(Q_t));if(n.getComponent(Q_t))return!0}return!1}},i._startInertiaScroll=function(t){var e=new Cs(t);e.multiplyScalar(.7),this._startAttenuatingAutoScroll(e,t)},i._calculateAttenuatedFactor=function(t){return this.brake<=0?1-this.brake:(1-this.brake)*(1/(1+14e-6*t+t*t*8e-9))},i._startAttenuatingAutoScroll=function(t,e){var i=new Cs(t);if(i.normalize(),this._content&&this.view){var r=this._content._uiProps.uiTransformComp.contentSize,n=this.view.contentSize,s=r.width-n.width,a=r.height-n.height,o=this._calculateAttenuatedFactor(s),h=this._calculateAttenuatedFactor(a);i.x=i.x*s*(1-this.brake)*o,i.y=i.y*a*h*(1-this.brake),i.z=0}var l=t.length(),u=i.length()/l;if(i.add(t),this.brake>0&&u>7){u=Math.sqrt(u);var c=new Cs(t);c.multiplyScalar(u),i.set(c),i.add(t)}var _=this._calculateAutoScrollTimeByInitialSpeed(e.length());this.brake>0&&u>3&&(_*=u=3),0===this.brake&&u>1&&(_*=u),this._startAutoScroll(i,_,!0)},i._calculateAutoScrollTimeByInitialSpeed=function(t){return Math.sqrt(Math.sqrt(t/5))},i._startAutoScroll=function(t,e,i){void 0===i&&(i=!1);var r=this._flattenVectorByDirection(t);this._autoScrolling=!0,this._autoScrollTargetDelta=r,this._autoScrollAttenuate=i,Cs.copy(this._autoScrollStartPosition,this.getContentPosition()),this._autoScrollTotalTime=e,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._isScrollEndedWithThresholdEventFired=!1,this._autoScrollBrakingStartPosition=new Cs,this._getHowMuchOutOfBoundary().equals($_t,1e-4)||(this._autoScrollCurrentlyOutOfBoundary=!0)},i._calculateTouchMoveVelocity=function(){var t=0;if((t=this._touchMoveTimeDeltas.reduce((function(t,e){return t+e}),t))<=0||t>=.5)return new Cs;var e=new Cs;return e=this._touchMoveDisplacements.reduce((function(t,e){return t.add(e),t}),e),new Cs(e.x*(1-this.brake)/t,e.y*(1-this.brake)/t,0)},i._flattenVectorByDirection=function(t){var e=t;return e.x=this.horizontal?e.x:0,e.y=this.vertical?e.y:0,e},i._moveContent=function(t,e){var i=this._flattenVectorByDirection(t);tdt.set(this.getContentPosition()),tdt.add(i),tdt.set(1e-4*Math.floor(1e4*tdt.x),1e-4*Math.floor(1e4*tdt.y),tdt.z),this.setContentPosition(tdt);var r=this._getHowMuchOutOfBoundary();this._updateScrollBar(r),this.elastic&&e&&this._startBounceBackIfNeeded()},i._getContentLeftBoundary=function(){if(!this._content)return-1;var t=this.getContentPosition(),e=this._content._uiProps.uiTransformComp;return t.x-e.anchorX*e.width},i._getContentRightBoundary=function(){if(!this._content)return-1;var t=this._content._uiProps.uiTransformComp;return this._getContentLeftBoundary()+t.width},i._getContentTopBoundary=function(){if(!this._content)return-1;var t=this._content._uiProps.uiTransformComp;return this._getContentBottomBoundary()+t.height},i._getContentBottomBoundary=function(){if(!this._content)return-1;var t=this.getContentPosition(),e=this._content._uiProps.uiTransformComp;return t.y-e.anchorY*e.height},i._getHowMuchOutOfBoundary=function(t){if((t=t||new Cs).equals($_t,1e-4)&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var e=new Cs;return this._getContentLeftBoundary()+t.x>this._leftBoundary?e.x=this._leftBoundary-(this._getContentLeftBoundary()+t.x):this._getContentRightBoundary()+t.x<this._rightBoundary&&(e.x=this._rightBoundary-(this._getContentRightBoundary()+t.x)),this._getContentTopBoundary()+t.y<this._topBoundary?e.y=this._topBoundary-(this._getContentTopBoundary()+t.y):this._getContentBottomBoundary()+t.y>this._bottomBoundary&&(e.y=this._bottomBoundary-(this._getContentBottomBoundary()+t.y)),t.equals($_t,1e-4)&&(this._outOfBoundaryAmount=e,this._outOfBoundaryAmountDirty=!1),this._clampDelta(e)},i._updateScrollBar=function(t){this._horizontalScrollBar&&this._horizontalScrollBar.onScroll(t),this.verticalScrollBar&&this.verticalScrollBar.onScroll(t)},i._onScrollBarTouchBegan=function(){this._horizontalScrollBar&&this._horizontalScrollBar.onTouchBegan(),this.verticalScrollBar&&this.verticalScrollBar.onTouchBegan()},i._onScrollBarTouchEnded=function(){this._horizontalScrollBar&&this._horizontalScrollBar.onTouchEnded(),this.verticalScrollBar&&this.verticalScrollBar.onTouchEnded()},i._dispatchEvent=function(t){if(t===J_t.SCROLL_ENDED)this._scrollEventEmitMask=0;else if(t===J_t.SCROLL_TO_TOP||t===J_t.SCROLL_TO_BOTTOM||t===J_t.SCROLL_TO_LEFT||t===J_t.SCROLL_TO_RIGHT){var e=1<<sdt[t];if(this._scrollEventEmitMask&e)return;this._scrollEventEmitMask|=e}BP.emitEvents(this.scrollEvents,this,sdt[t]),this.node.emit(t,this)},i._adjustContentOutOfBoundary=function(){if(this._content&&(this._outOfBoundaryAmountDirty=!0,this._isOutOfBoundary())){var t=this._getHowMuchOutOfBoundary();tdt.set(this.getContentPosition()),tdt.add(t),this._content.setPosition(tdt),this._updateScrollBar($_t)}},i._hideScrollBar=function(){this._horizontalScrollBar&&this._horizontalScrollBar.hide(),this._verticalScrollBar&&this._verticalScrollBar.hide()},i._updateScrollBarState=function(){if(this._content&&this.view){var t=this.view,e=this._content._uiProps.uiTransformComp;this.verticalScrollBar&&(e.height<t.height?this.verticalScrollBar.hide():this.verticalScrollBar.show()),this.horizontalScrollBar&&(e.width<t.width?this.horizontalScrollBar.hide():this.horizontalScrollBar.show())}},i._stopPropagationIfTargetIsMe=function(t){t.eventPhase===Gi.AT_TARGET&&t.target===this.node&&(t.propagationStopped=!0)},i._processDeltaMove=function(t){this._scrollChildren(t),this._gatherTouchMove(t)},i._handleMoveLogic=function(t){this._deltaPos.set(this._getLocalAxisAlignDelta(t)),this._processDeltaMove(this._deltaPos)},i._handleReleaseLogic=function(t){this._deltaPos.set(this._getLocalAxisAlignDelta(t)),this._gatherTouchMove(this._deltaPos),this._processInertiaScroll(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent(J_t.SCROLL_ENDED))},i._getLocalAxisAlignDelta=function(t){var e=this.node._uiProps.uiTransformComp,i=new Cs;return e&&(t.getUILocation(idt),t.getUIPreviousLocation(rdt),tdt.set(idt.x,idt.y,0),edt.set(rdt.x,rdt.y,0),e.convertToNodeSpaceAR(tdt,tdt),e.convertToNodeSpaceAR(edt,edt),Cs.subtract(i,tdt,edt)),i},i._scrollChildren=function(t){var e,i,r=t=this._clampDelta(t);if(this.elastic&&(e=this._getHowMuchOutOfBoundary(),r.x*=0===e.x?1:.5,r.y*=0===e.y?1:.5),this.elastic||(e=this._getHowMuchOutOfBoundary(r),r.add(e)),this._content){var n=this._content._uiProps.uiTransformComp,s=n.anchorX,a=n.anchorY,o=n.width,h=n.height,l=this._content.position||$_t;r.y>0?l.y-a*h+r.y>=this._bottomBoundary&&(i=J_t.SCROLL_TO_BOTTOM):r.y<0&&l.y-a*h+h+r.y<=this._topBoundary&&(i=J_t.SCROLL_TO_TOP),r.x<0?l.x-s*o+o+r.x<=this._rightBoundary&&(i=J_t.SCROLL_TO_RIGHT):r.x>0&&l.x-s*o+r.x>=this._leftBoundary&&(i=J_t.SCROLL_TO_LEFT)}this._moveContent(r,!1),0===r.x&&0===r.y||(this._scrolling||(this._scrolling=!0,this._dispatchEvent(J_t.SCROLL_BEGAN)),this._dispatchEvent(J_t.SCROLLING)),i&&i.length>0&&this._dispatchEvent(i)},i._handlePressLogic=function(){this._autoScrolling&&this._dispatchEvent(J_t.SCROLL_ENDED),this._autoScrolling=!1,this._isBouncing=!1,this._touchMovePreviousTimestamp=ndt(),this._touchMoveDisplacements.length=0,this._touchMoveTimeDeltas.length=0,this._onScrollBarTouchBegan()},i._clampDelta=function(t){if(this._content&&this.view){var e=this.view.contentSize,i=this._content._uiProps.uiTransformComp;i.width<e.width&&(t.x=0),i.height<e.height&&(t.y=0)}return t},i._gatherTouchMove=function(t){var e=t.clone();for(this._clampDelta(e);this._touchMoveDisplacements.length>=5;)this._touchMoveDisplacements.shift(),this._touchMoveTimeDeltas.shift();this._touchMoveDisplacements.push(e);var i=ndt();this._touchMoveTimeDeltas.push((i-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=i},i._startBounceBackIfNeeded=function(){if(!this.elastic)return!1;var t=this._getHowMuchOutOfBoundary();if((t=this._clampDelta(t)).equals($_t,1e-4))return!1;var e=Math.max(this.bounceDuration,0);return this._startAutoScroll(t,e,!0),this._isBouncing||(t.y>0&&this._dispatchEvent(J_t.BOUNCE_TOP),t.y<0&&this._dispatchEvent(J_t.BOUNCE_BOTTOM),t.x>0&&this._dispatchEvent(J_t.BOUNCE_RIGHT),t.x<0&&this._dispatchEvent(J_t.BOUNCE_LEFT),this._isBouncing=!0),!0},i._processInertiaScroll=function(){if(!this._startBounceBackIfNeeded()&&this.inertia){var t=this._calculateTouchMoveVelocity();!t.equals(tdt,1e-4)&&this.brake<1&&this._startInertiaScroll(t)}this._onScrollBarTouchEnded()},i._isOutOfBoundary=function(){return!this._getHowMuchOutOfBoundary().equals($_t,1e-4)},i._isNecessaryAutoScrollBrake=function(){if(this._autoScrollBraking)return!0;if(this._isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this.getContentPosition(),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},i._processAutoScrolling=function(t){var e=this._isNecessaryAutoScrollBrake(),i=e?.05:1;this._autoScrollAccumulatedTime+=t*(1/i);var r,n=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);this._autoScrollAttenuate&&(r=n,n=(r-=1)*r*r*r*r+1);var s=new Cs(this._autoScrollTargetDelta);s.multiplyScalar(n);var a=new Cs(this._autoScrollStartPosition);a.add(s);var o=Math.abs(n-1)<=1e-4;if(Math.abs(n-1)<=this.getScrollEndedEventTiming()&&!this._isScrollEndedWithThresholdEventFired&&(this._dispatchEvent(J_t.SCROLL_ENG_WITH_THRESHOLD),this._isScrollEndedWithThresholdEventFired=!0),this.elastic){var h=new Cs(a);h.subtract(this._autoScrollBrakingStartPosition),e&&h.multiplyScalar(i),a.set(this._autoScrollBrakingStartPosition),a.add(h)}else{var l=new Cs(a);l.subtract(this.getContentPosition());var u=this._getHowMuchOutOfBoundary(l);u.equals($_t,1e-4)||(a.add(u),o=!0)}o&&(this._autoScrolling=!1);var c=new Cs(a);c.subtract(this.getContentPosition()),this._moveContent(this._clampDelta(c),o),this._dispatchEvent(J_t.SCROLLING),this._autoScrolling||(this._isBouncing=!1,this._scrolling=!1,this._dispatchEvent(J_t.SCROLL_ENDED))},i._checkMouseWheel=function(t){if(!this._getHowMuchOutOfBoundary().equals($_t,1e-4))return this._processInertiaScroll(),this.unschedule(this._checkMouseWheel),this._dispatchEvent(J_t.SCROLL_ENDED),void(this._stopMouseWheel=!1);this._mouseWheelEventElapsedTime+=t,this._mouseWheelEventElapsedTime>.1&&(this._onScrollBarTouchEnded(),this.unschedule(this._checkMouseWheel),this._dispatchEvent(J_t.SCROLL_ENDED),this._stopMouseWheel=!1)},i._calculateMovePercentDelta=function(t){var e=t.anchor,i=t.applyToHorizontal,r=t.applyToVertical;this._calculateBoundary(),e.clampf(new Es(0,0),new Es(1,1));var n=this._getContentBottomBoundary()-this._bottomBoundary;n=-n;var s=this._getContentLeftBoundary()-this._leftBoundary;s=-s;var a=new Cs;if(this._content&&this.view){var o=0,h=this._content._uiProps.uiTransformComp.contentSize,l=this.view.contentSize;i&&(o=h.width-l.width,a.x=s-o*e.x),r&&(o=h.height-l.height,a.y=n-o*e.y)}return a},i._moveContentToTopLeft=function(t){var e=this._getContentBottomBoundary()-this._bottomBoundary;e=-e;var i=new Cs,r=0,n=this._getContentLeftBoundary()-this._leftBoundary;if(n=-n,this._content){var s=this._content._uiProps.uiTransformComp.contentSize;s.height<t.height&&(r=s.height-t.height,i.y=e-r),s.width<t.width&&(r=s.width-t.width,i.x=n)}this._updateScrollBarState(),this._moveContent(i),this._adjustContentOutOfBoundary()},i._scaleChanged=function(t){t===Uv.SCALE&&this._calculateBoundary()},r(e,[{key:"content",get:function(){return this._content},set:function(t){if(this._content!==t){var e=t&&t.parent&&t.parent._uiProps.uiTransformComp;!t||t&&e?(this._content=t,this._calculateBoundary()):x(4302)}}},{key:"horizontalScrollBar",get:function(){return this._horizontalScrollBar},set:function(t){this._horizontalScrollBar!==t&&(this._horizontalScrollBar=t,this._horizontalScrollBar&&(this._horizontalScrollBar.setScrollView(this),this._updateScrollBar($_t)))}},{key:"verticalScrollBar",get:function(){return this._verticalScrollBar},set:function(t){this._verticalScrollBar!==t&&(this._verticalScrollBar=t,this._verticalScrollBar&&(this._verticalScrollBar.setScrollView(this),this._updateScrollBar($_t)))}},{key:"view",get:function(){var t=this._content&&this._content.parent;return t?t._uiProps.uiTransformComp:null}}]),e}(Q_t),q_t.EventType=J_t,D_t=u((F_t=K_t).prototype,"bounceDuration",[ke,o_t,h_t,l_t],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),U_t=u(F_t.prototype,"brake",[ke,u_t,c_t,__t],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),k_t=u(F_t.prototype,"elastic",[ke,d_t,p_t],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),z_t=u(F_t.prototype,"inertia",[ke,f_t,m_t],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),u(F_t.prototype,"content",[g_t,v_t,y_t],Object.getOwnPropertyDescriptor(F_t.prototype,"content"),F_t.prototype),G_t=u(F_t.prototype,"horizontal",[ke,T_t,E_t],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),u(F_t.prototype,"horizontalScrollBar",[S_t,b_t,A_t],Object.getOwnPropertyDescriptor(F_t.prototype,"horizontalScrollBar"),F_t.prototype),H_t=u(F_t.prototype,"vertical",[ke,C_t,w_t],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),u(F_t.prototype,"verticalScrollBar",[R_t,x_t,O_t],Object.getOwnPropertyDescriptor(F_t.prototype,"verticalScrollBar"),F_t.prototype),V_t=u(F_t.prototype,"cancelInnerEvents",[ke,I_t,M_t],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),W_t=u(F_t.prototype,"scrollEvents",[B_t,ke,P_t,N_t],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),j_t=u(F_t.prototype,"_content",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X_t=u(F_t.prototype,"_horizontalScrollBar",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y_t=u(F_t.prototype,"_verticalScrollBar",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L_t=F_t))||L_t)||L_t)||L_t)||L_t)||L_t)),Odt=new Cs;!function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical"}(Rdt||(Rdt={})),Ft(Rdt);var Idt,Mdt,Bdt,Pdt,Ndt,Ldt,Fdt,Ddt,Udt,kdt,zdt,Gdt,Hdt,Vdt,Wdt,jdt,Xdt,Ydt,qdt,Kdt,Zdt=function(e){return t({Slider:e,SliderComponent:e}),e}((adt=Ne("cc.Slider"),odt=qe(),hdt=Fe(110),ldt=We(),udt=Le(Vg),cdt=pi(cst),_dt=$e(),ddt=pi(Rdt),pdt=$e(),fdt=ti(),mdt=$e(),gdt=pi([BP]),vdt=$e(),adt(ydt=odt(ydt=hdt(ydt=ldt(ydt=udt((wdt=Cdt=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"slideEvents",Edt,a(e)),l(e,"_handle",Sdt,a(e)),l(e,"_direction",bdt,a(e)),l(e,"_progress",Adt,a(e)),e._offset=new Cs,e._dragging=!1,e._touchHandle=!1,e._handleLocalPos=new Cs,e._touchPos=new Cs,e}s(e,t);var i=e.prototype;return i.__preload=function(){this._updateHandlePosition()},i.onEnable=function(){this._updateHandlePosition(),this.node.on(gg.TOUCH_START,this._onTouchBegan,this),this.node.on(gg.TOUCH_MOVE,this._onTouchMoved,this),this.node.on(gg.TOUCH_END,this._onTouchEnded,this),this.node.on(gg.TOUCH_CANCEL,this._onTouchCancelled,this),this._handle&&this._handle.isValid&&(this._handle.node.on(gg.TOUCH_START,this._onHandleDragStart,this),this._handle.node.on(gg.TOUCH_MOVE,this._onTouchMoved,this),this._handle.node.on(gg.TOUCH_END,this._onTouchEnded,this))},i.onDisable=function(){this.node.off(gg.TOUCH_START,this._onTouchBegan,this),this.node.off(gg.TOUCH_MOVE,this._onTouchMoved,this),this.node.off(gg.TOUCH_END,this._onTouchEnded,this),this.node.off(gg.TOUCH_CANCEL,this._onTouchCancelled,this),this._handle&&this._handle.isValid&&(this._handle.node.off(gg.TOUCH_START,this._onHandleDragStart,this),this._handle.node.off(gg.TOUCH_MOVE,this._onTouchMoved,this),this._handle.node.off(gg.TOUCH_END,this._onTouchEnded,this))},i._onHandleDragStart=function(t){if(t&&this._handle&&this._handle.node._uiProps.uiTransformComp){this._dragging=!0,this._touchHandle=!0;var e=t.touch.getUILocation();Cs.set(this._touchPos,e.x,e.y,0),this._handle.node._uiProps.uiTransformComp.convertToNodeSpaceAR(this._touchPos,this._offset),t.propagationStopped=!0}},i._onTouchBegan=function(t){this._handle&&t&&(this._dragging=!0,this._touchHandle||this._handleSliderLogic(t.touch),t.propagationStopped=!0)},i._onTouchMoved=function(t){this._dragging&&t&&(this._handleSliderLogic(t.touch),t.propagationStopped=!0)},i._onTouchEnded=function(t){this._dragging=!1,this._touchHandle=!1,this._offset=new Cs,t&&(t.propagationStopped=!0)},i._onTouchCancelled=function(t){this._dragging=!1,t&&(t.propagationStopped=!0)},i._handleSliderLogic=function(t){this._updateProgress(t),this._emitSlideEvent()},i._emitSlideEvent=function(){BP.emitEvents(this.slideEvents,this),this.node.emit("slide",this)},i._updateProgress=function(t){if(this._handle&&t){var e=t.getUILocation();Cs.set(this._touchPos,e.x,e.y,0);var i=this.node._uiProps.uiTransformComp,r=i.convertToNodeSpaceAR(this._touchPos,Odt);this.direction===Rdt.Horizontal?this.progress=Mr(.5+(r.x-this._offset.x)/i.width):this.progress=Mr(.5+(r.y-this._offset.y)/i.height)}},i._updateHandlePosition=function(){if(this._handle){this._handleLocalPos.set(this._handle.node.getPosition());var t=this.node._uiProps.uiTransformComp;this._direction===Rdt.Horizontal?this._handleLocalPos.x=-t.width*t.anchorX+this.progress*t.width:this._handleLocalPos.y=-t.height*t.anchorY+this.progress*t.height,this._handle.node.setPosition(this._handleLocalPos)}},i._changeLayout=function(){var t=this.node._uiProps.uiTransformComp,e=t.contentSize;if(t.setContentSize(e.height,e.width),this._handle){var i=this._handle.node.position;this._direction===Rdt.Horizontal?this._handle.node.setPosition(i.x,0,i.z):this._handle.node.setPosition(0,i.y,i.z),this._updateHandlePosition()}},r(e,[{key:"handle",get:function(){return this._handle},set:function(t){this._handle!==t&&(this._handle=t)}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this._changeLayout())}},{key:"progress",get:function(){return this._progress},set:function(t){this._progress!==t&&(this._progress=t,this._updateHandlePosition())}}]),e}(ds),Cdt.Direction=Rdt,u((Tdt=wdt).prototype,"handle",[cdt,_dt],Object.getOwnPropertyDescriptor(Tdt.prototype,"handle"),Tdt.prototype),u(Tdt.prototype,"direction",[ddt,pdt],Object.getOwnPropertyDescriptor(Tdt.prototype,"direction"),Tdt.prototype),u(Tdt.prototype,"progress",[ni,fdt,mdt],Object.getOwnPropertyDescriptor(Tdt.prototype,"progress"),Tdt.prototype),Edt=u(Tdt.prototype,"slideEvents",[gdt,ke,vdt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Sdt=u(Tdt.prototype,"_handle",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bdt=u(Tdt.prototype,"_direction",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Rdt.Horizontal}}),Adt=u(Tdt.prototype,"_progress",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),ydt=Tdt))||ydt)||ydt)||ydt)||ydt)||ydt));function Qdt(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return Object.assign.apply(Object,[{}].concat(e))}!function(t){t.TOGGLE="toggle"}(Kdt||(Kdt={}));var Jdt,$dt,tpt,ept,ipt,rpt,npt,spt,apt,opt,hpt,lpt,upt,cpt,_pt,dpt,ppt,fpt,mpt,gpt,vpt,ypt,Tpt,Ept,Spt,bpt,Apt,Cpt,wpt,Rpt,xpt,Opt,Ipt,Mpt=function(e){return t({Toggle:e,ToggleComponent:e}),e}((Idt=Ne("cc.Toggle"),Mdt=qe(),Bdt=Fe(110),Pdt=We(),Ndt=Le(Vg),Ldt=si(),Fdt=$e(),Ddt=pi(cst),Udt=si(),kdt=$e(),zdt=pi([BP]),Gdt=$e(),Idt(Hdt=Mdt(Hdt=Bdt(Hdt=Pdt(Hdt=Ndt((qdt=Ydt=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"checkEvents",Wdt,a(e)),l(e,"_isChecked",jdt,a(e)),l(e,"_checkMark",Xdt,a(e)),e}s(e,t);var i=e.prototype;return i._internalToggle=function(){this.isChecked=!this.isChecked},i._set=function(t,e){if(void 0===e&&(e=!0),this._isChecked!=t){this._isChecked=t;var i=this._toggleContainer;i&&i.enabled&&this.enabled&&(t||!i.anyTogglesChecked()&&!i.allowSwitchOff)&&(this._isChecked=!0,i.notifyToggleCheck(this,e)),this.playEffect(),e&&this._emitToggleEvents()}},i.playEffect=function(){this._checkMark&&(this._checkMark.node.active=this._isChecked)},i.setIsCheckedWithoutNotify=function(t){this._set(t,!1)},i.onEnable=function(){t.prototype.onEnable.call(this),this.playEffect(),this.node.on(e.EventType.CLICK,this._internalToggle,this)},i.onDisable=function(){t.prototype.onDisable.call(this),this.node.off(e.EventType.CLICK,this._internalToggle,this)},i.OnDestroy=function(){var t=this._toggleContainer;t&&t.ensureValidState()},i._emitToggleEvents=function(){this.node.emit(e.EventType.TOGGLE,this),this.checkEvents&&BP.emitEvents(this.checkEvents,this)},r(e,[{key:"isChecked",get:function(){return this._isChecked},set:function(t){this._set(t)}},{key:"checkMark",get:function(){return this._checkMark},set:function(t){this._checkMark!==t&&(this._checkMark=t)}},{key:"_resizeToTarget",set:function(t){t&&this._resizeNodeToTargetNode()}},{key:"_toggleContainer",get:function(){var t=this.node.parent;return _.Node.isNode(t)?t.getComponent("cc.ToggleContainer"):null}}]),e}(Sat),Ydt.EventType=Qdt(Kdt,ust),u((Vdt=qdt).prototype,"isChecked",[Ldt,Fdt],Object.getOwnPropertyDescriptor(Vdt.prototype,"isChecked"),Vdt.prototype),u(Vdt.prototype,"checkMark",[Ddt,Udt,kdt],Object.getOwnPropertyDescriptor(Vdt.prototype,"checkMark"),Vdt.prototype),Wdt=u(Vdt.prototype,"checkEvents",[zdt,ke,Gdt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),jdt=u(Vdt.prototype,"_isChecked",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Xdt=u(Vdt.prototype,"_checkMark",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Hdt=Vdt))||Hdt)||Hdt)||Hdt)||Hdt)||Hdt)),Bpt=function(e){return t({ToggleContainer:e,ToggleContainerComponent:e}),e}((Jdt=Ne("cc.ToggleContainer"),$dt=qe(),tpt=Fe(110),ept=We(),ipt=$e(),rpt=pi([BP]),npt=$e(),Jdt(spt=$dt(spt=tpt(spt=ept(spt=Ve((lpt=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"_allowSwitchOff",opt,a(e)),l(e,"checkEvents",hpt,a(e)),e}s(e,t);var i=e.prototype;return i.start=function(){this.ensureValidState()},i.activeToggles=function(){return this.toggleItems.filter((function(t){return t.isChecked}))},i.anyTogglesChecked=function(){return!!this.toggleItems.find((function(t){return t.isChecked}))},i.notifyToggleCheck=function(t,e){if(void 0===e&&(e=!0),this.enabledInHierarchy){for(var i=0;i<this.toggleItems.length;i++){var r=this.toggleItems[i];r!==t&&(e?r.isChecked=!1:r.setIsCheckedWithoutNotify(!1))}this.checkEvents&&_.Component.EventHandler.emitEvents(this.checkEvents,t)}},i.ensureValidState=function(){var t=this.toggleItems;if(!this._allowSwitchOff&&!this.anyTogglesChecked()&&0!==t.length){var e=t[0];e.isChecked=!0,this.notifyToggleCheck(e)}var i=this.activeToggles();if(i.length>1)for(var r=i[0],n=0;n<i.length;++n){var s=i[n];s!==r&&(s.isChecked=!1)}},r(e,[{key:"allowSwitchOff",get:function(){return this._allowSwitchOff},set:function(t){this._allowSwitchOff=t}},{key:"toggleItems",get:function(){return this.node.children.map((function(t){var e=t.getComponent("cc.Toggle");if(e&&e.enabled)return e})).filter(Boolean)}}]),e}(ds),opt=u((apt=lpt).prototype,"_allowSwitchOff",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),u(apt.prototype,"allowSwitchOff",[ipt],Object.getOwnPropertyDescriptor(apt.prototype,"allowSwitchOff"),apt.prototype),hpt=u(apt.prototype,"checkEvents",[rpt,ke,npt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),spt=apt))||spt)||spt)||spt)||spt)||spt)),Ppt=function(e){return t({UIMeshRenderer:e,UIModelComponent:e}),e}(Ne("cc.UIMeshRenderer")(upt=qe()(upt=Fe(110)(upt=We()(upt=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._models=null,e._modelComponent=null,e}s(e,t);var i=e.prototype;return i.onLoad=function(){this.node._uiProps.uiTransformComp||this.node.addComponent("cc.UITransform"),this._modelComponent=this.getComponent("cc.RenderableComponent"),this._modelComponent?(this._modelComponent._sceneGetter=NF.root.ui.getRenderSceneGetter(),this._models=this._modelComponent._collectModels()):console.warn("node '"+(this.node&&this.node.name)+"' doesn't have any renderable component")},i.onEnable=function(){t.prototype.onEnable.call(this),this._modelComponent&&this._modelComponent._attachToScene()},i.onDisable=function(){t.prototype.onDisable.call(this),this._modelComponent&&this._modelComponent._detachFromScene()},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._modelComponent=this.getComponent("cc.RenderableComponent"),this._modelComponent&&(this._modelComponent._sceneGetter=null,_.isValid(this._modelComponent,!0)&&this._modelComponent._attachToScene(),this._models=null)},i.updateAssembler=function(t){if(this._models){for(var e,i=h(this._models);!(e=i()).done;){var r=e.value;t.commitModel.call(t,this,r,this._modelComponent.material)}return!0}return!1},i.update=function(){this._fitUIRenderQueue()},i._fitUIRenderQueue=function(){if(this._modelComponent)for(var t=this._modelComponent.sharedMaterials.length,e=0;e<t;e++){var i=this._modelComponent.getMaterialInstance(e);if(null!=i)for(var r=i.passes,n=r.length,s=0;s<n;s++){var a=r[s];a._priority=mp.MAX-11,a.blendState.targets[0].blend||i.overridePipelineStates({blendState:{targets:[{blend:!0}]}},s)}}},r(e,[{key:"modelComponent",get:function(){return this._modelComponent}}]),e}(zL))||upt)||upt)||upt)||upt),Npt=new Qs;!function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(Ipt||(Ipt={})),Ft(Ipt);var Lpt,Fpt,Dpt,Upt,kpt,zpt,Gpt,Hpt,Vpt,Wpt,jpt,Xpt,Ypt,qpt,Kpt,Zpt,Qpt,Jpt,$pt,tft,eft,ift,rft,nft,sft,aft,oft,hft,lft,uft,cft,_ft,dft,pft,fft,mft,gft,vft,yft,Tft,Eft,Sft,bft,Aft,Cft,wft=function(e){return t({PageViewIndicator:e,PageViewIndicatorComponent:e}),e}((cpt=Ne("cc.PageViewIndicator"),_pt=qe(),dpt=Fe(110),ppt=We(),fpt=pi(um),mpt=$e(),gpt=pi(Ipt),vpt=$e(),ypt=pi(Ys),Tpt=$e(),Ept=$e(),cpt(Spt=_pt(Spt=dpt(Spt=ppt((Opt=xpt=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"spacing",Apt,a(e)),l(e,"_spriteFrame",Cpt,a(e)),l(e,"_direction",wpt,a(e)),l(e,"_cellSize",Rpt,a(e)),e._layout=null,e._pageView=null,e._indicators=[],e}s(e,t);var i=e.prototype;return i.onLoad=function(){this._updateLayout()},i.setPageView=function(t){this._pageView=t,this._refresh()},i._updateLayout=function(){this._layout=this.getComponent(Tlt),this._layout||(this._layout=this.addComponent(Tlt));var t=this._layout;this.direction===Ipt.HORIZONTAL?(t.type=Tlt.Type.HORIZONTAL,t.spacingX=this.spacing):this.direction===Ipt.VERTICAL&&(t.type=Tlt.Type.VERTICAL,t.spacingY=this.spacing),t.resizeMode=Tlt.ResizeMode.CONTAINER},i._createIndicator=function(){var t=new py,e=t.addComponent(cst);return e.spriteFrame=this.spriteFrame,e.sizeMode=cst.SizeMode.CUSTOM,t.parent=this.node,t._uiProps.uiTransformComp.setContentSize(this._cellSize),t},i._changedState=function(){var t=this._indicators;if(0!==t.length&&this._pageView){var e=this._pageView.curPageIdx;if(!(e>=t.length)){for(var i=0;i<t.length;++i){var r=t[i];if(r._uiProps.uiComp){var n=r._uiProps.uiComp;Npt.set(n.color),Npt.a=127.5,n.color=Npt}}if(t[e]._uiProps.uiComp){var s=t[e]._uiProps.uiComp;Npt.set(s.color),Npt.a=255,s.color=Npt}}}},i._refresh=function(){if(this._pageView){var t=this._indicators,e=this._pageView.getPages();if(e.length!==t.length){var i=0;if(e.length>t.length)for(i=0;i<e.length;++i)t[i]||(t[i]=this._createIndicator());else for(i=t.length-e.length;i>0;--i){var r=t[i-1];this.node.removeChild(r),t.splice(i-1,1)}this._layout&&this._layout.enabledInHierarchy&&this._layout.updateLayout(),this._changedState()}}},r(e,[{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){this._spriteFrame!==t&&(this._spriteFrame=t)}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t)}},{key:"cellSize",get:function(){return this._cellSize},set:function(t){this._cellSize!==t&&(this._cellSize=t)}}]),e}(ds),xpt.Direction=Ipt,u((bpt=Opt).prototype,"spriteFrame",[fpt,mpt],Object.getOwnPropertyDescriptor(bpt.prototype,"spriteFrame"),bpt.prototype),u(bpt.prototype,"direction",[gpt,vpt],Object.getOwnPropertyDescriptor(bpt.prototype,"direction"),bpt.prototype),u(bpt.prototype,"cellSize",[ypt,Tpt],Object.getOwnPropertyDescriptor(bpt.prototype,"cellSize"),bpt.prototype),Apt=u(bpt.prototype,"spacing",[ke,Ept],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Cpt=u(bpt.prototype,"_spriteFrame",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wpt=u(bpt.prototype,"_direction",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ipt.HORIZONTAL}}),Rpt=u(bpt.prototype,"_cellSize",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ys(20,20)}}),Spt=bpt))||Spt)||Spt)||Spt)||Spt)),Rft=new Es;!function(t){t[t.Unified=0]="Unified",t[t.Free=1]="Free"}(bft||(bft={})),Ft(bft),function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical"}(Aft||(Aft={})),Ft(Aft),function(t){t.PAGE_TURNING="page-turning"}(Cft||(Cft={}));var xft,Oft,Ift,Mft,Bft,Pft,Nft,Lft,Fft,Dft,Uft,kft,zft=function(e){return t({PageView:e,PageViewComponent:e}),e}((Lpt=Ne("cc.PageView"),Fpt=qe(),Dpt=Fe(110),Upt=We(),kpt=pi(bft),zpt=$e(),Gpt=pi(Aft),Hpt=$e(),Vpt=ti(),Wpt=$e(),jpt=ti(),Xpt=$e(),Ypt=pi(wft),qpt=$e(),Kpt=$e(),Zpt=pi(Z_t),Qpt=Ze(),Jpt=pi(Z_t),$pt=Ze(),tft=Ze(),eft=Ze(),ift=Ze(),rft=pi([BP]),nft=Ze(),sft=pi([BP]),aft=$e(),Lpt(oft=Fpt(oft=Dpt(oft=Upt((Sft=Eft=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"autoPageTurningThreshold",lft,a(e)),l(e,"horizontal",uft,a(e)),l(e,"vertical",cft,a(e)),l(e,"cancelInnerEvents",_ft,a(e)),l(e,"scrollEvents",dft,a(e)),l(e,"pageTurningSpeed",pft,a(e)),l(e,"pageEvents",fft,a(e)),l(e,"_sizeMode",mft,a(e)),l(e,"_direction",gft,a(e)),l(e,"_scrollThreshold",vft,a(e)),l(e,"_pageTurningEventTiming",yft,a(e)),l(e,"_indicator",Tft,a(e)),e._curPageIdx=0,e._lastPageIdx=0,e._pages=[],e._initContentPos=new Cs,e._scrollCenterOffsetX=[],e._scrollCenterOffsetY=[],e._touchBeganPosition=new Cs,e._touchEndPosition=new Cs,e}s(e,t);var i=e.prototype;return i.onEnable=function(){t.prototype.onEnable.call(this),this.node.on(gg.SIZE_CHANGED,this._updateAllPagesSize,this),this.node.on(e.EventType.SCROLL_ENG_WITH_THRESHOLD,this._dispatchPageTurningEvent,this)},i.onDisable=function(){t.prototype.onDisable.call(this),this.node.off(gg.SIZE_CHANGED,this._updateAllPagesSize,this),this.node.off(e.EventType.SCROLL_ENG_WITH_THRESHOLD,this._dispatchPageTurningEvent,this)},i.onLoad=function(){this._initPages(),this.indicator&&this.indicator.setPageView(this)},i.getCurrentPageIndex=function(){return this._curPageIdx},i.setCurrentPageIndex=function(t){this.scrollToPage(t,1)},i.getPages=function(){return this._pages},i.addPage=function(t){t&&-1===this._pages.indexOf(t)&&this.content&&(t._uiProps.uiTransformComp?(this.content.addChild(t),this._pages.push(t),this._updatePageView()):x(4301))},i.insertPage=function(t,e){if(!(e<0)&&t&&-1===this._pages.indexOf(t)&&this.content)if(e>=this._pages.length)this.addPage(t);else{if(!t._uiProps.uiTransformComp)return void x(4301);this._pages.splice(e,0,t),this.content.insertChild(t,e),this._updatePageView()}},i.removePage=function(t){if(t&&this.content){var e=this._pages.indexOf(t);-1!==e?this.removePageAtIndex(e):I(4300,t.name)}},i.removePageAtIndex=function(t){var e=this._pages;if(!(t<0||t>=e.length)){var i=e[t];i&&this.content&&(this.content.removeChild(i),e.splice(t,1),this._updatePageView())}},i.removeAllPages=function(){if(this.content){for(var t=this._pages,e=0,i=t.length;e<i;e++)this.content.removeChild(t[e]);this._pages.length=0,this._updatePageView()}},i.scrollToPage=function(t,e){void 0===e&&(e=.3),t<0||t>=this._pages.length||(this._curPageIdx=t,this.scrollToOffset(this._moveOffsetValue(t),e,!0),this.indicator&&this.indicator._changedState())},i.getScrollEndedEventTiming=function(){return this.pageTurningEventTiming},i._updatePageView=function(){if(this.content){var t=this.content.getComponent(Tlt);t&&t.enabled&&t.updateLayout();var e=this._pages.length;this._curPageIdx>=e&&(this._curPageIdx=0===e?0:e-1,this._lastPageIdx=this._curPageIdx);for(var i=this._initContentPos,r=0;r<e;++r){var n=this._pages[r].position;this.direction===Aft.Horizontal?this._scrollCenterOffsetX[r]=Math.abs(i.x+n.x):this._scrollCenterOffsetY[r]=Math.abs(i.y+n.y)}this.indicator&&this.indicator._refresh()}},i._updateAllPagesSize=function(){var t=this.view;if(this.content&&t&&this._sizeMode===bft.Unified)for(var e=this._pages,i=t.contentSize,r=0,n=e.length;r<n;r++)e[r]._uiProps.uiTransformComp.setContentSize(i)},i._handleReleaseLogic=function(){this._autoScrollToPage(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent(e.EventType.SCROLL_ENDED))},i._onTouchBegan=function(e,i){e.touch.getUILocation(Rft),Cs.set(this._touchBeganPosition,Rft.x,Rft.y,0),t.prototype._onTouchBegan.call(this,e,i)},i._onTouchMoved=function(e,i){t.prototype._onTouchMoved.call(this,e,i)},i._onTouchEnded=function(e,i){e.touch.getUILocation(Rft),Cs.set(this._touchEndPosition,Rft.x,Rft.y,0),t.prototype._onTouchEnded.call(this,e,i)},i._onTouchCancelled=function(e,i){e.touch.getUILocation(Rft),Cs.set(this._touchEndPosition,Rft.x,Rft.y,0),t.prototype._onTouchCancelled.call(this,e,i)},i._onMouseWheel=function(){},i._syncScrollDirection=function(){this.horizontal=this.direction===Aft.Horizontal,this.vertical=this.direction===Aft.Vertical},i._syncSizeMode=function(){var t=this.view;if(this.content&&t){var e=this.content.getComponent(Tlt);if(e){if(this._sizeMode===bft.Free&&this._pages.length>0){var i=this._pages[0]._uiProps.uiTransformComp,r=this._pages[this._pages.length-1]._uiProps.uiTransformComp;this.direction===Aft.Horizontal?(e.paddingLeft=(t.width-i.width)/2,e.paddingRight=(t.width-r.width)/2):this.direction===Aft.Vertical&&(e.paddingTop=(t.height-i.height)/2,e.paddingBottom=(t.height-r.height)/2)}e.updateLayout()}}},i._initPages=function(){if(this.content){this._initContentPos=this.content.position;for(var t=this.content.children,e=0;e<t.length;++e){var i=t[e];this._pages.indexOf(i)>=0||this._pages.push(i)}this._syncScrollDirection(),this._syncSizeMode(),this._updatePageView()}},i._dispatchPageTurningEvent=function(){this._lastPageIdx!==this._curPageIdx&&(this._lastPageIdx=this._curPageIdx,BP.emitEvents(this.pageEvents,this,Cft.PAGE_TURNING),this.node.emit(Cft.PAGE_TURNING,this))},i._isQuicklyScrollable=function(t){if(this.direction===Aft.Horizontal){if(Math.abs(t.x)>this.autoPageTurningThreshold)return!0}else if(this.direction===Aft.Vertical&&Math.abs(t.y)>this.autoPageTurningThreshold)return!0;return!1},i._moveOffsetValue=function(t){var e=new Cs;if(this._sizeMode===bft.Free)this.direction===Aft.Horizontal?e.x=this._scrollCenterOffsetX[t]:this.direction===Aft.Vertical&&(e.y=this._scrollCenterOffsetY[t]);else{var i=this.view;if(!i)return e;this.direction===Aft.Horizontal?e.x=t*i.width:this.direction===Aft.Vertical&&(e.y=t*i.height)}return e},i._getDragDirection=function(t){return this._direction===Aft.Horizontal?0===t.x?0:t.x>0?1:-1:0===t.y?0:t.y<0?1:-1},i._isScrollable=function(t,e,i){if(this._sizeMode===bft.Free){var r=0,n=0;if(this.direction===Aft.Horizontal)return r=this._scrollCenterOffsetX[e],n=this._scrollCenterOffsetX[i],Math.abs(t.x)>=Math.abs(r-n)*this.scrollThreshold;if(this.direction===Aft.Vertical)return r=this._scrollCenterOffsetY[e],n=this._scrollCenterOffsetY[i],Math.abs(t.y)>=Math.abs(r-n)*this.scrollThreshold}else{var s=this.view;if(!s)return;if(this.direction===Aft.Horizontal)return Math.abs(t.x)>=s.width*this.scrollThreshold;if(this.direction===Aft.Vertical)return Math.abs(t.y)>=s.height*this.scrollThreshold}},i._autoScrollToPage=function(){if(this._startBounceBackIfNeeded()){var t=this._getHowMuchOutOfBoundary();((t=this._clampDelta(t)).x>0||t.y<0)&&(this._curPageIdx=0===this._pages.length?0:this._pages.length-1),(t.x<0||t.y>0)&&(this._curPageIdx=0),this.indicator&&this.indicator._changedState()}else{var e=new Cs;Cs.subtract(e,this._touchBeganPosition,this._touchEndPosition);var i=this._curPageIdx,r=i+this._getDragDirection(e),n=this.pageTurningSpeed*Math.abs(i-r);if(r<this._pages.length){if(this._isScrollable(e,i,r))return void this.scrollToPage(r,n);var s=this._calculateTouchMoveVelocity();if(this._isQuicklyScrollable(s))return void this.scrollToPage(r,n)}this.scrollToPage(i,n)}},r(e,[{key:"sizeMode",get:function(){return this._sizeMode},set:function(t){this._sizeMode!==t&&(this._sizeMode=t,this._syncSizeMode())}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this._syncScrollDirection())}},{key:"scrollThreshold",get:function(){return this._scrollThreshold},set:function(t){this._scrollThreshold!==t&&(this._scrollThreshold=t)}},{key:"pageTurningEventTiming",get:function(){return this._pageTurningEventTiming},set:function(t){this._pageTurningEventTiming!==t&&(this._pageTurningEventTiming=t)}},{key:"indicator",get:function(){return this._indicator},set:function(t){this._indicator!==t&&(this._indicator=t,this.indicator&&this.indicator.setPageView(this))}},{key:"curPageIdx",get:function(){return this._curPageIdx}},{key:"verticalScrollBar",get:function(){return t.prototype.verticalScrollBar},set:function(t){this.verticalScrollBar=t}},{key:"horizontalScrollBar",get:function(){return t.prototype.horizontalScrollBar},set:function(t){this.horizontalScrollBar=t}}]),e}(xdt),Eft.SizeMode=bft,Eft.Direction=Aft,Eft.EventType=Qdt(Cft,J_t),u((hft=Sft).prototype,"sizeMode",[kpt,zpt],Object.getOwnPropertyDescriptor(hft.prototype,"sizeMode"),hft.prototype),u(hft.prototype,"direction",[Gpt,Hpt],Object.getOwnPropertyDescriptor(hft.prototype,"direction"),hft.prototype),u(hft.prototype,"scrollThreshold",[ni,Vpt,Wpt],Object.getOwnPropertyDescriptor(hft.prototype,"scrollThreshold"),hft.prototype),u(hft.prototype,"pageTurningEventTiming",[ni,jpt,Xpt],Object.getOwnPropertyDescriptor(hft.prototype,"pageTurningEventTiming"),hft.prototype),u(hft.prototype,"indicator",[Ypt,qpt],Object.getOwnPropertyDescriptor(hft.prototype,"indicator"),hft.prototype),lft=u(hft.prototype,"autoPageTurningThreshold",[ke,Kpt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),u(hft.prototype,"verticalScrollBar",[Zpt,fi,Qpt],Object.getOwnPropertyDescriptor(hft.prototype,"verticalScrollBar"),hft.prototype),u(hft.prototype,"horizontalScrollBar",[Jpt,fi,$pt],Object.getOwnPropertyDescriptor(hft.prototype,"horizontalScrollBar"),hft.prototype),uft=u(hft.prototype,"horizontal",[fi,ke,tft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),cft=u(hft.prototype,"vertical",[fi,ke,eft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),_ft=u(hft.prototype,"cancelInnerEvents",[fi,ke,ift],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),dft=u(hft.prototype,"scrollEvents",[rft,ke,fi,nft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),pft=u(hft.prototype,"pageTurningSpeed",[ke,Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),fft=u(hft.prototype,"pageEvents",[sft,ke,aft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mft=u(hft.prototype,"_sizeMode",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return bft.Unified}}),gft=u(hft.prototype,"_direction",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Aft.Horizontal}}),vft=u(hft.prototype,"_scrollThreshold",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),yft=u(hft.prototype,"_pageTurningEventTiming",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),Tft=u(hft.prototype,"_indicator",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oft=hft))||oft)||oft)||oft)||oft)),Gft=function(e){return t({UIStaticBatch:e,UIStaticBatchComponent:e}),e}((xft=Ne("cc.UIStaticBatch"),Oft=qe(),Ift=We(),Mft=Fe(110),Bft=Ze(),Pft=Ze(),Nft=Ze(),xft(Lft=Oft(Lft=Ift(Lft=Mft((u((Fft=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._init=!1,e._meshBuffer=null,e._dirty=!0,e._lastMeshBuffer=null,e._uiDrawBatchList=[],e}s(e,t);var i=e.prototype;return i.onLoad=function(){var t=this._getUI();if(t){var e=vF,i=new bF(t);i.initialize(e,this._arrivalMaxBuffer),this._meshBuffer=i}},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._clearData(),this._meshBuffer&&(this._meshBuffer.destroy(),this._meshBuffer=null)},i.updateAssembler=function(t){this._dirty&&(t.finishMergeBatches(),this._lastMeshBuffer=t.currBufferBatch,t.currBufferBatch=this._meshBuffer,t.currStaticRoot=this),this._init&&(t.finishMergeBatches(),t.commitStaticBatch(this))},i.postUpdateAssembler=function(t){this._dirty&&(t.finishMergeBatches(),t.currBufferBatch=this._lastMeshBuffer,t.currStaticRoot=null,this._dirty=!1,this._init=!0,this.node._static=!0,this._meshBuffer.uploadBuffers())},i.markAsDirty=function(){this._getUI()&&(this.node._static=!1,this._dirty=!0,this._init=!1,this._clearData())},i._requireDrawBatch=function(){var t=new wF;return t.isStatic=!0,this._uiDrawBatchList.push(t),t},i._clearData=function(){if(this._meshBuffer){this._meshBuffer.reset();for(var t=this._getUI(),e=0;e<this._uiDrawBatchList.length;e++)this._uiDrawBatchList[e].destroy(t)}this._uiDrawBatchList.length=0,this._init=!1},i._getUI=function(){return NF.root&&NF.root.ui?NF.root.ui:(I(9301),null)},i._arrivalMaxBuffer=function(){I(9300)},r(e,[{key:"dstBlendFactor",get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor!==t&&(this._dstBlendFactor=t,this._updateBlendFunc())}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor!==t&&(this._srcBlendFactor=t,this._updateBlendFunc())}},{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateColor(),this.markForUpdateRenderData())}},{key:"drawBatchList",get:function(){return this._uiDrawBatchList}}]),e}(fF)).prototype,"dstBlendFactor",[fi,Bft],Object.getOwnPropertyDescriptor(Fft.prototype,"dstBlendFactor"),Fft.prototype),u(Fft.prototype,"srcBlendFactor",[fi,Pft],Object.getOwnPropertyDescriptor(Fft.prototype,"srcBlendFactor"),Fft.prototype),u(Fft.prototype,"color",[fi,Nft],Object.getOwnPropertyDescriptor(Fft.prototype,"color"),Fft.prototype),Lft=Fft))||Lft)||Lft)||Lft)||Lft)),Hft=function(e){return t({UIOpacity:e,UIOpacityComponent:e}),e}(Ne("cc.UIOpacity")(Dft=qe()(Dft=Fe(110)(Dft=We()(Dft=Ve((u((Uft=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"_opacity",kft,a(e)),e}s(e,t);var i=e.prototype;return i.onEnable=function(){this.node._uiProps.opacity=this._opacity/255},i.onDisable=function(){this.node._uiProps.opacity=1},r(e,[{key:"opacity",get:function(){return this._opacity},set:function(t){this._opacity!==t&&(t=Zt(t,0,255),this._opacity=t,this.node._uiProps.opacity=t/255)}}]),e}(ds)).prototype,"opacity",[Ke],Object.getOwnPropertyDescriptor(Uft.prototype,"opacity"),Uft.prototype),kft=u(Uft.prototype,"_opacity",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),Dft=Uft))||Dft)||Dft)||Dft)||Dft)||Dft),Vft=new Cs,Wft=new Es,jft=new Cs,Xft=new Cs(1,1,1);function Yft(t,e){var i,r=e.target,n=jft,s=Xft;r?hL(t,i=r,n,s):i=t.parent;var a=oL(i),o=i instanceof XP||!i.getComponent(Vg),h=o?Wft:i.getComponent(Vg).anchorPoint,l=o;t.getPosition(Vft);var u=t._uiProps.uiTransformComp,c=Vft.x,_=Vft.y,d=u.anchorPoint,p=t.getScale();if(e.alignFlags&sL.HORIZONTAL){var f=0,m=0,g=a.width;l?(f=NO.left.x,m=NO.right.x):m=(f=-h.x*g)+g,f+=e.isAbsoluteLeft?e.left:e.left*g,m-=e.isAbsoluteRight?e.right:e.right*g,r&&(f+=n.x,f*=s.x,m+=n.x,m*=s.x);var v=0,y=d.x,T=p.x;if(T<0&&(y=1-y,T=-T),e.isStretchWidth)v=m-f,0!==T&&(u.width=v/T),c=f+y*v;else if(v=u.width*T,e.isAlignHorizontalCenter){var E=e.isAbsoluteHorizontalCenter?e.horizontalCenter:e.horizontalCenter*g,S=(.5-h.x)*a.width;r&&(E*=s.x,S+=n.x,S*=s.x),c=S+(y-.5)*v+E}else c=e.isAlignLeft?f+y*v:m+(y-1)*v;e._lastSize.width=v}if(e.alignFlags&sL.VERTICAL){var b=0,A=0,C=a.height;l?(A=NO.bottom.y,b=NO.top.y):b=(A=-h.y*C)+C,A+=e.isAbsoluteBottom?e.bottom:e.bottom*C,b-=e.isAbsoluteTop?e.top:e.top*C,r&&(A+=n.y,A*=s.y,b+=n.y,b*=s.y);var w=0,R=d.y,x=p.y;if(x<0&&(R=1-R,x=-x),e.isStretchHeight)w=b-A,0!==x&&(u.height=w/x),_=A+R*w;else if(w=u.height*x,e.isAlignVerticalCenter){var O=e.isAbsoluteVerticalCenter?e.verticalCenter:e.verticalCenter*C,I=(.5-h.y)*a.height;r&&(O*=s.y,I+=n.y,I*=s.y),_=I+(R-.5)*w+O}else _=e.isAlignBottom?A+R*w:b+(R-1)*w;e._lastSize.height=w}t.setPosition(c,_,Vft.z),Cs.set(e._lastPos,c,_,Vft.z)}function qft(){var t=NF.getScene();if(t){if(Qft.isAligning=!0,Qft._nodesOrderDirty)Zft.length=0,function t(e){var i=e.getComponent(PL);if(i)if(Yft(e,i),i.alignMode===nL.ONCE)i.enabled=!1;else{if(!_.isValid(e,!0))return;Zft.push(i)}for(var r,n=h(e.children);!(r=n()).done;){var s=r.value;s.active&&t(s)}}(t),Qft._nodesOrderDirty=!1;else{var e=null,i=Qft._activeWidgetsIterator;for(i.i=0;i.i<Zft.length;++i.i)(e=Zft[i.i])._dirty&&(Yft(e.node,e),e._dirty=!1)}Qft.isAligning=!1}}var Kft,Zft=[],Qft=t("widgetManager",_._widgetManager={isAligning:!1,_nodesOrderDirty:!1,_activeWidgetsIterator:new It.MutableForwardIterator(Zft),animationState:null,init:function(){NF.on(PF.EVENT_AFTER_UPDATE,qft);var t=this.onResized.bind(this);FO.instance.on("canvas-resize",t),window.addEventListener("orientationchange",t)},add:function(){this._nodesOrderDirty=!0},remove:function(t){this._activeWidgetsIterator.remove(t)},onResized:function(){var t=NF.getScene();t&&this.refreshWidgetOnResized(t)},refreshWidgetOnResized:function(t){var e=py.isNode(t)&&t.getComponent(PL);e&&e.enabled&&(e.alignMode===nL.ON_WINDOW_RESIZE||e.alignMode===nL.ALWAYS)&&e.setDirty();for(var i,r=h(t.children);!(i=r()).done;){var n=i.value;this.refreshWidgetOnResized(n)}},updateOffsetsToStayPut:function(t,e){function i(t,e){return Math.abs(t-e)>1e-10?e:t}var r=t.node,n=r.parent;if(n){var s=new Cs,a=new Cs(1,1,1);if(t.target&&hL(r,n=t.target,s,a),!e)return;var o=n._uiProps&&n._uiProps.uiTransformComp,h=o?o.anchorPoint:Wft,l=r._uiProps.uiTransformComp,u=oL(n),c=l.anchorPoint,_=r.getPosition(),d=sL,p=r.getScale(),f=0;if(e&d.LEFT){var m=-h.x*u.width;m+=s.x,m*=a.x,f=_.x-c.x*l.width*p.x-m,t.isAbsoluteLeft||(f/=u.width),f/=a.x,t.left=i(t.left,f)}if(e&d.RIGHT){var g=(1-h.x)*u.width;g+=s.x,f=(g*=a.x)-(_.x+(1-c.x)*l.width*p.x),t.isAbsoluteRight||(f/=u.width),f/=a.x,t.right=i(t.right,f)}if(e&d.TOP){var v=(1-h.y)*u.height;v+=s.y,f=(v*=a.y)-(_.y+(1-c.y)*l.height*p.y),t.isAbsoluteTop||(f/=u.height),f/=a.y,t.top=i(t.top,f)}if(e&d.BOT){var y=-h.y*u.height;y+=s.y,y*=a.y,f=_.y-c.y*l.height*p.y-y,t.isAbsoluteBottom||(f/=u.height),f/=a.y,t.bottom=i(t.bottom,f)}}},updateAlignment:function t(e){var i=e.parent;i&&py.isNode(i)&&t(i);var r=e.getComponent(PL);r&&i&&Yft(e,r)},AlignMode:nL,AlignFlags:sL});NF.on(PF.EVENT_INIT,(function(){Qft.init()}));var Jft,$ft,tmt,emt,imt,rmt,nmt,smt,amt,omt,hmt,lmt,umt,cmt,_mt,dmt,pmt,fmt,mmt,gmt,vmt=function(e){return t({SafeArea:e,SafeAreaComponent:e}),e}(Ne("cc.SafeArea")(Kft=qe()(Kft=Fe(110)(Kft=Ve(Kft=We()(Kft=Le(PL)(Kft=function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;return i.onEnable=function(){this.updateArea(),zO.on("canvas-resize",this.updateArea,this)},i.onDisable=function(){zO.off("canvas-resize",this.updateArea,this)},i.updateArea=function(){var t=this.node.getComponent(PL),e=this.node.getComponent(Vg);if(t&&e){t.updateAlignment();var i=this.node.position.clone(),r=e.anchorPoint.clone();t.isAlignTop=t.isAlignBottom=t.isAlignLeft=t.isAlignRight=!0;var n=_.winSize.width,s=_.winSize.height,a=Jr.getSafeAreaRect();t.top=s-a.y-a.height,t.bottom=a.y,t.left=a.x,t.right=n-a.x-a.width,t.updateAlignment();var o=this.node.position.clone(),h=r.x-(o.x-i.x)/e.width,l=r.y-(o.y-i.y)/e.height;e.setAnchorPoint(h,l),Qft.add(t)}},e}(ds))||Kft)||Kft)||Kft)||Kft)||Kft)||Kft),ymt=function(e){return t({UICoordinateTracker:e,UICoordinateTrackerComponent:e}),e}((Jft=Ne("cc.UICoordinateTracker"),$ft=qe(),tmt=We(),emt=Fe(110),imt=pi(py),rmt=$e(),nmt=pi(BM),smt=$e(),amt=$e(),omt=$e(),hmt=pi([BP]),lmt=$e(),Jft(umt=$ft(umt=tmt(umt=emt((u((cmt=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"syncEvents",_mt,a(e)),l(e,"_target",dmt,a(e)),l(e,"_camera",pmt,a(e)),l(e,"_useScale",fmt,a(e)),l(e,"_distance",mmt,a(e)),e._transformPos=new Cs,e._viewPos=new Cs,e._canMove=!0,e._lastWPos=new Cs,e._lastCameraPos=new Cs,e}s(e,t);var i=e.prototype;return i.onEnable=function(){this._checkCanMove()},i.update=function(){var t=this.node.worldPosition,e=this._camera;if(this._canMove&&e&&e.camera&&(!this._lastWPos.equals(t)||!this._lastCameraPos.equals(e.node.worldPosition))&&(this._lastWPos.set(t),this._lastCameraPos.set(e.node.worldPosition),e.camera.update(),e.convertToUINode(t,this._target,this._transformPos),this._useScale&&Cs.transformMat4(this._viewPos,this.node.worldPosition,e.camera.matView),this.syncEvents.length>0)){var i=this._distance/Math.abs(this._viewPos.z);BP.emitEvents(this.syncEvents,this._transformPos,i)}},i._checkCanMove=function(){this._canMove=!(!this._camera||!this._target)},r(e,[{key:"target",get:function(){return this._target},set:function(t){this._target!==t&&(this._target=t,this._checkCanMove())}},{key:"camera",get:function(){return this._camera},set:function(t){this._camera!==t&&(this._camera=t,this._checkCanMove())}},{key:"useScale",get:function(){return this._useScale},set:function(t){this._useScale!==t&&(this._useScale=t)}},{key:"distance",get:function(){return this._distance},set:function(t){this._distance!==t&&(this._distance=t)}}]),e}(ds)).prototype,"target",[imt,rmt],Object.getOwnPropertyDescriptor(cmt.prototype,"target"),cmt.prototype),u(cmt.prototype,"camera",[nmt,smt],Object.getOwnPropertyDescriptor(cmt.prototype,"camera"),cmt.prototype),u(cmt.prototype,"useScale",[amt],Object.getOwnPropertyDescriptor(cmt.prototype,"useScale"),cmt.prototype),u(cmt.prototype,"distance",[omt],Object.getOwnPropertyDescriptor(cmt.prototype,"distance"),cmt.prototype),_mt=u(cmt.prototype,"syncEvents",[hmt,ke,lmt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),dmt=u(cmt.prototype,"_target",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pmt=u(cmt.prototype,"_camera",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fmt=u(cmt.prototype,"_useScale",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),mmt=u(cmt.prototype,"_distance",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),umt=cmt))||umt)||umt)||umt)||umt)),Tmt=[gg.TOUCH_START,gg.TOUCH_END,gg.TOUCH_MOVE,gg.MOUSE_DOWN,gg.MOUSE_MOVE,gg.MOUSE_UP,gg.MOUSE_ENTER,gg.MOUSE_LEAVE,gg.MOUSE_WHEEL];function Emt(t){t.propagationStopped=!0}var Smt,bmt,Amt,Cmt,wmt,Rmt,xmt,Omt,Imt,Mmt,Bmt,Pmt,Nmt,Lmt,Fmt,Dmt,Umt,kmt,zmt,Gmt,Hmt,Vmt,Wmt,jmt,Xmt,Ymt=function(e){return t({BlockInputEvents:e,BlockInputEventsComponent:e}),e}(Ne("cc.BlockInputEvents")(gmt=qe()(gmt=We()(gmt=function(t){function e(){return t.apply(this,arguments)||this}s(e,t);var i=e.prototype;return i.onEnable=function(){for(var t=0;t<Tmt.length;t++)this.node.on(Tmt[t],Emt,this)},i.onDisable=function(){for(var t=0;t<Tmt.length;t++)this.node.off(Tmt[t],Emt,this)},e}(ds))||gmt)||gmt)||gmt),qmt=t("LabelShadow",(Smt=Ne("cc.LabelShadow"),bmt=qe(),Amt=Fe(110),Cmt=We(),wmt=Le(Nat),Rmt=$e(),xmt=$e(),Omt=$e(),Smt(Imt=bmt(Imt=Amt(Imt=Cmt(Imt=wmt(Imt=Ve((Lmt=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return l(e=t.call.apply(t,[this].concat(r))||this,"_color",Bmt,a(e)),l(e,"_offset",Pmt,a(e)),l(e,"_blur",Nmt,a(e)),e}s(e,t);var i=e.prototype;return i.onEnable=function(){this._updateRenderData()},i.onDisable=function(){this._updateRenderData()},i._updateRenderData=function(){var t=this.node.getComponent(Nat);t&&t.updateRenderData(!0)},r(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateRenderData())}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset=t,this._updateRenderData()}},{key:"blur",get:function(){return this._blur},set:function(t){this._blur=t,this._updateRenderData()}}]),e}(ds),Bmt=u((Mmt=Lmt).prototype,"_color",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qs(0,0,0,255)}}),Pmt=u(Mmt.prototype,"_offset",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Es(2,2)}}),Nmt=u(Mmt.prototype,"_blur",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),u(Mmt.prototype,"color",[Rmt],Object.getOwnPropertyDescriptor(Mmt.prototype,"color"),Mmt.prototype),u(Mmt.prototype,"offset",[xmt],Object.getOwnPropertyDescriptor(Mmt.prototype,"offset"),Mmt.prototype),u(Mmt.prototype,"blur",[Omt],Object.getOwnPropertyDescriptor(Mmt.prototype,"blur"),Mmt.prototype),Imt=Mmt))||Imt)||Imt)||Imt)||Imt)||Imt)||Imt)),Kmt=t("SubContextView",(Fmt=Ne("cc.SubContextView"),Dmt=qe(),Umt=Fe(110),kmt=Le(Vg),zmt=We(),Gmt=$e(),Hmt=$e(),Fmt(Vmt=Dmt(Vmt=Umt(Vmt=kmt(Vmt=zmt((u((Wmt=function(t){function e(){var e;return l(e=t.call(this)||this,"_fps",jmt,a(e)),e._sprite=void 0,e._imageAsset=void 0,e._updatedTime=0,e._updateInterval=0,e._openDataContext=void 0,e._content=void 0,l(e,"_designResolutionSize",Xmt,a(e)),e._content=new YP("content"),e._sprite=null,e._imageAsset=new Dd,e._openDataContext=null,e._updatedTime=performance.now(),e}s(e,t),r(e,[{key:"designResolutionSize",get:function(){return this._designResolutionSize},set:function(){}},{key:"fps",get:function(){return this._fps},set:function(t){this._fps!==t&&(this._fps=t,this._updateInterval=1e3/t)}}]);var i=e.prototype;return i.onLoad=function(){window.__globalAdapter&&__globalAdapter.getOpenDataContext?(this._updateInterval=1e3/this._fps,this._openDataContext=__globalAdapter.getOpenDataContext(),this._initSharedCanvas(),this._initContentNode(),this._updateSubContextView()):this.enabled=!1},i.onEnable=function(){this._registerNodeEvent()},i.onDisable=function(){this._unregisterNodeEvent()},i._initSharedCanvas=function(){if(this._openDataContext){var t=this._openDataContext.canvas;t.width=this._designResolutionSize.width,t.height=this._designResolutionSize.height}},i._initContentNode=function(){if(this._openDataContext){var t=this._openDataContext.canvas,e=this._imageAsset;if(e.reset(t),e._texture.create(t.width,t.height),this._sprite=this._content.getComponent(cst),this._sprite||(this._sprite=this._content.addComponent(cst)),this._sprite.spriteFrame)this._sprite.spriteFrame.texture=this._imageAsset._texture;else{var i=new um;i.texture=this._imageAsset._texture,this._sprite.spriteFrame=i}this._content.parent=this.node}},i._updateSubContextView=function(){if(this._openDataContext&&__globalAdapter&&__globalAdapter.getSystemInfoSync){var t=this.node.getComponent(Vg),e=this._content.getComponent(Vg),i=t.width/e.width,r=t.height/e.height,n=i>r?r:i;e.width=e.width*n,e.height=e.height*n;var s=__globalAdapter.getSystemInfoSync(),a=e.getBoundingBoxToWorld(),o=zO.getVisibleSize(),h=s.screenWidth*(a.x/o.width),l=s.screenHeight*(a.y/o.height),u=s.screenWidth*(a.width/o.width),c=s.screenHeight*(a.height/o.height);this._openDataContext.postMessage({fromEngine:!0,type:"engine",event:"viewport",x:h,y:l,width:u,height:c})}},i._updateSubContextTexture=function(){var t=this._imageAsset;if(t&&this._openDataContext&&!(t.width<=0||t.height<=0)){var e=this._openDataContext.canvas;t.reset(e),(e.width>t.width||e.height>t.height)&&this._imageAsset._texture.create(e.width,e.height),this._imageAsset._texture.uploadData(e)}},i._registerNodeEvent=function(){this.node.on(py.EventType.TRANSFORM_CHANGED,this._updateSubContextView,this),this.node.on(py.EventType.SIZE_CHANGED,this._updateSubContextView,this)},i._unregisterNodeEvent=function(){this.node.off(py.EventType.TRANSFORM_CHANGED,this._updateSubContextView,this),this.node.off(py.EventType.SIZE_CHANGED,this._updateSubContextView,this)},i.update=function(t){void 0===t?this._updateSubContextTexture():performance.now()-this._updatedTime>=this._updateInterval&&(this._updatedTime+=this._updateInterval,this._updateSubContextTexture())},e}(ds)).prototype,"designResolutionSize",[Gmt],Object.getOwnPropertyDescriptor(Wmt.prototype,"designResolutionSize"),Wmt.prototype),u(Wmt.prototype,"fps",[Hmt],Object.getOwnPropertyDescriptor(Wmt.prototype,"fps"),Wmt.prototype),jmt=u(Wmt.prototype,"_fps",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),Xmt=u(Wmt.prototype,"_designResolutionSize",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ys(640,960)}}),Vmt=Wmt))||Vmt)||Vmt)||Vmt)||Vmt)||Vmt));_.SubContextView=Kmt;var Zmt=function(t,e,i){this.i=void 0,this.x=void 0,this.y=void 0,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=t,this.x=e,this.y=i};function Qmt(t,e,i,r,n){var s=0,a=null;if(n===function(t,e,i,r){for(var n=0,s=e,a=i-r;s<i;s+=r)n+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return n}(t,e,i,r)>0)for(s=e;s<i;s+=r)a=fgt(s,t[s],t[s+1],a);else for(s=i-r;s>=e;s-=r)a=fgt(s,t[s],t[s+1],a);return a&&cgt(a,a.next)&&(mgt(a),a=a.next),a}function Jmt(t,e){if(void 0===e&&(e=null),!t)return t;e||(e=t);var i=t,r=!1;do{if(r=!1,i.steiner||!cgt(i,i.next)&&0!==ugt(i.prev,i,i.next))i=i.next;else{if(mgt(i),(i=e=i.prev)===i.next)return null;r=!0}}while(r||i!==e);return e}function $mt(t,e,i,r,n,s,a){if(void 0===a&&(a=0),t){!a&&s&&function(t,e,i,r){var n=t;do{null===n.z&&(n.z=agt(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e=0,i=null,r=null,n=null,s=null,a=0,o=0,h=0,l=1;do{for(i=t,t=null,s=null,a=0;i;){for(a++,r=i,o=0,e=0;e<l&&(o++,r=r.nextZ);e++);for(h=l;o>0||h>0&&r;)0===o?(n=r,r=r.nextZ,h--):0!==h&&r?i.z<=r.z?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,h--):(n=i,i=i.nextZ,o--),s?s.nextZ=n:t=n,n.prevZ=s,s=n;i=r}s.nextZ=null,l*=2}while(a>1)}(n)}(t,r,n,s);for(var o=t,h=null,l=null;t.prev!==t.next;)if(h=t.prev,l=t.next,s?egt(t,r,n,s):tgt(t))e.push(h.i/i),e.push(t.i/i),e.push(l.i/i),mgt(t),t=l.next,o=l.next;else if((t=l)===o){a?1===a?$mt(t=igt(t,e,i),e,i,r,n,s,2):2===a&&rgt(t,e,i,r,n,s):$mt(Jmt(t),e,i,r,n,s,1);break}}}function tgt(t){var e=t.prev,i=t,r=t.next;if(ugt(e,i,r)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(hgt(e.x,e.y,i.x,i.y,r.x,r.y,n.x,n.y)&&ugt(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function egt(t,e,i,r){var n=t.prev,s=t,a=t.next;if(ugt(n,s,a)>=0)return!1;for(var o=n.x<s.x?n.x<a.x?n.x:a.x:s.x<a.x?s.x:a.x,h=n.y<s.y?n.y<a.y?n.y:a.y:s.y<a.y?s.y:a.y,l=n.x>s.x?n.x>a.x?n.x:a.x:s.x>a.x?s.x:a.x,u=n.y>s.y?n.y>a.y?n.y:a.y:s.y>a.y?s.y:a.y,c=agt(o,h,e,i,r),_=agt(l,u,e,i,r),d=t.nextZ;d&&d.z<=_;){if(d!==t.prev&&d!==t.next&&hgt(n.x,n.y,s.x,s.y,a.x,a.y,d.x,d.y)&&ugt(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(d=t.prevZ;d&&d.z>=c;){if(d!==t.prev&&d!==t.next&&hgt(n.x,n.y,s.x,s.y,a.x,a.y,d.x,d.y)&&ugt(d.prev,d,d.next)>=0)return!1;d=d.prevZ}return!0}function igt(t,e,i){var r=t;do{var n=r.prev,s=r.next.next;!cgt(n,s)&&_gt(n,r,r.next,s)&&dgt(n,s)&&dgt(s,n)&&(e.push(n.i/i),e.push(r.i/i),e.push(s.i/i),mgt(r),mgt(r.next),r=t=s),r=r.next}while(r!==t);return r}function rgt(t,e,i,r,n,s){var a=t;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&lgt(a,o)){var h=pgt(a,o);return a=Jmt(a,a.next),h=Jmt(h,h.next),$mt(a,e,i,r,n,s),void $mt(h,e,i,r,n,s)}o=o.next}a=a.next}while(a!==t)}function ngt(t,e){return t.x-e.x}function sgt(t,e){if(e=function(t,e){var i=e,r=t.x,n=t.y,s=-1/0,a=null;do{if(n<=i.y&&n>=i.next.y){var o=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=r&&o>s){if(s=o,o===r){if(n===i.y)return i;if(n===i.next.y)return i.next}a=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!a)return null;if(r===s)return a.prev;var h,l=a,u=a.x,c=a.y,_=1/0;for(i=a.next;i!==l;)r>=i.x&&i.x>=u&&hgt(n<c?r:s,n,u,c,n<c?s:r,n,i.x,i.y)&&((h=Math.abs(n-i.y)/(r-i.x))<_||h===_&&i.x>a.x)&&dgt(i,t)&&(a=i,_=h),i=i.next;return a}(t,e)){var i=pgt(e,t);Jmt(i,i.next)}}function agt(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)/n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)/n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ogt(t){var e=t,i=t;do{e.x<i.x&&(i=e),e=e.next}while(e!==t);return i}function hgt(t,e,i,r,n,s,a,o){return(n-a)*(e-o)-(t-a)*(s-o)>=0&&(t-a)*(r-o)-(i-a)*(e-o)>=0&&(i-a)*(s-o)-(n-a)*(r-o)>=0}function lgt(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&_gt(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&dgt(t,e)&&dgt(e,t)&&function(t,e){var i=t,r=!1,n=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}(t,e)}function ugt(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function cgt(t,e){return t.x===e.x&&t.y===e.y}function _gt(t,e,i,r){return!!(cgt(t,e)&&cgt(i,r)||cgt(t,r)&&cgt(i,e))||ugt(t,e,i)>0!=ugt(t,e,r)>0&&ugt(i,r,t)>0!=ugt(i,r,e)>0}function dgt(t,e){return ugt(t.prev,t,t.next)<0?ugt(t,e,t.next)>=0&&ugt(t,t.prev,e)>=0:ugt(t,e,t.prev)<0||ugt(t,t.next,e)<0}function pgt(t,e){var i=new Zmt(t.i,t.x,t.y),r=new Zmt(e.i,e.x,e.y),n=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function fgt(t,e,i,r){var n=new Zmt(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function mgt(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ggt(t,e,i){i=i||3;var r=e?e.length:0,n=r?e[0]*i:t.length,s=Qmt(t,0,n,i,!0),a=[];if(!s)return a;var o=0,h=0,l=0,u=0,c=0,_=0,d=0;if(r&&(s=function(t,e,i,r){var n,s=[],a=0,o=null;for(a=0,n=e.length;a<n;a++)(o=Qmt(t,e[a]*r,a<n-1?e[a+1]*r:t.length,r,!1))&&(o===o.next&&(o.steiner=!0),s.push(ogt(o)));if(s.sort(ngt),!i)return i;for(a=0;a<s.length;a++)sgt(s[a],i),i=Jmt(i,i.next);return i}(t,e,s,i)),t.length>80*i){o=l=t[0],h=u=t[1];for(var p=i;p<n;p+=i)(c=t[p])<o&&(o=c),(_=t[p+1])<h&&(h=_),c>l&&(l=c),_>u&&(u=_);d=Math.max(l-o,u-h)}return $mt(s,a,i,o,h,d),a}var vgt=Math.PI,ygt=Math.min,Tgt=Math.max,Egt=Math.cos,Sgt=Math.sin,bgt=Math.abs,Agt=Math.sign,Cgt=.5522847493;function wgt(t,e,i,r,n){t.moveTo(e-r,i),t.bezierCurveTo(e-r,i+n*Cgt,e-r*Cgt,i+n,e,i+n),t.bezierCurveTo(e+r*Cgt,i+n,e+r,i+n*Cgt,e+r,i),t.bezierCurveTo(e+r,i-n*Cgt,e+r*Cgt,i-n,e,i-n),t.bezierCurveTo(e-r*Cgt,i-n,e-r,i-n*Cgt,e-r,i),t.close()}for(var Rgt=function(t){function e(e,i){var r;return(r=t.call(this,e,i)||this).dx=0,r.dy=0,r.dmx=0,r.dmy=0,r.flags=0,r.len=0,r.reset(),r}return s(e,t),e.prototype.reset=function(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0},e}(Es),xgt=function(){function t(){this.closed=!1,this.bevel=0,this.complex=!0,this.points=[],this.reset()}return t.prototype.reset=function(){this.closed=!1,this.bevel=0,this.complex=!0,this.points?this.points.length=0:this.points=[]},t}(),Ogt=function(){function t(){this.dataOffset=0,this.updatePathOffset=!1,this.pathLength=0,this.pathOffset=0,this.paths=[],this.tessTol=.25,this.distTol=.01,this.fillColor=Qs.WHITE.clone(),this.lineCap=jht.BUTT,this.strokeColor=Qs.BLACK.clone(),this.lineJoin=Xht.MITER,this.lineWidth=0,this.pointsOffset=0,this._commandX=0,this._commandY=0,this._points=[],this._renderDataList=[],this._curPath=null}var e=t.prototype;return e.moveTo=function(t,e){this.updatePathOffset&&(this.pathOffset=this.pathLength,this.updatePathOffset=!1),this._addPath(),this.addPoint(t,e,Yht.PT_CORNER),this._commandX=t,this._commandY=e},e.lineTo=function(t,e){this.addPoint(t,e,Yht.PT_CORNER),this._commandX=t,this._commandY=e},e.bezierCurveTo=function(t,e,i,r,n,s){var a=this._curPath,o=a.points[a.points.length-1];o&&(o.x!==t||o.y!==e||i!==n||r!==s?(function t(e,i,r,n,s,a,o,h,l,u,c){var _,d,p,f,m,g,v,y,T,E,S,b,A,C,w,R;u>10||(m=.5*(a+h),g=.5*(o+l),v=.5*((_=.5*(i+n))+(p=.5*(n+a))),y=.5*((d=.5*(r+s))+(f=.5*(s+o))),((w=bgt((n-h)*(C=l-r)-(s-l)*(A=h-i)))+(R=bgt((a-h)*C-(o-l)*A)))*(w+R)<e.tessTol*(A*A+C*C)?e.addPoint(h,l,0===c?c|Yht.PT_BEVEL:c):(t(e,i,r,_,d,v,y,S=.5*(v+(T=.5*(p+m))),b=.5*(y+(E=.5*(f+g))),u+1,0),t(e,S,b,T,E,m,g,h,l,u+1,c)))}(this,o.x,o.y,t,e,i,r,n,s,0,Yht.PT_CORNER),this._commandX=n,this._commandY=s):this.lineTo(n,s))},e.quadraticCurveTo=function(t,e,i,r){var n=this._commandX,s=this._commandY;this.bezierCurveTo(n+2/3*(t-n),s+2/3*(e-s),i+2/3*(t-i),r+2/3*(e-r),i,r)},e.arc=function(t,e,i,r,n,s){!function(t,e,i,r,n,s,a){var o,h,l=0,u=0,c=0,_=0,d=0,p=0,f=0,m=0,g=0,v=0,y=0,T=0,E=0,S=0;if(u=s-n,a=a||!1)if(bgt(u)>=2*vgt)u=2*vgt;else for(;u<0;)u+=2*vgt;else if(bgt(u)>=2*vgt)u=2*-vgt;else for(;u>0;)u-=2*vgt;for(h=0|Tgt(1,ygt(bgt(u)/(.5*vgt)+.5,5)),c=bgt(4/3*(1-Egt(o=u/h/2))/Sgt(o)),a||(c=-c),S=0;S<=h;S++)p=e+(_=Egt(l=n+u*(S/h)))*r,f=i+(d=Sgt(l))*r,m=-d*r*c,g=_*r*c,0===S?t.moveTo(p,f):t.bezierCurveTo(v+T,y+E,p-m,f-g,p,f),v=p,y=f,T=m,E=g}(this,t,e,i,r,n,s)},e.ellipse=function(t,e,i,r){wgt(this,t,e,i,r),this._curPath.complex=!1},e.circle=function(t,e,i){wgt(this,t,e,i,i),this._curPath.complex=!1},e.rect=function(t,e,i,r){this.moveTo(t,e),this.lineTo(t+i,e),this.lineTo(t+i,e+r),this.lineTo(t,e+r),this.close(),this._curPath.complex=!1},e.roundRect=function(t,e,i,r,n){!function(t,e,i,r,n,s){if(s<.1)t.rect(e,i,r,n);else{var a=ygt(s,.5*bgt(r))*Agt(r),o=ygt(s,.5*bgt(n))*Agt(n);t.moveTo(e,i+o),t.lineTo(e,i+n-o),t.bezierCurveTo(e,i+n-o*(1-Cgt),e+a*(1-Cgt),i+n,e+a,i+n),t.lineTo(e+r-a,i+n),t.bezierCurveTo(e+r-a*(1-Cgt),i+n,e+r,i+n-o*(1-Cgt),e+r,i+n-o),t.lineTo(e+r,i+o),t.bezierCurveTo(e+r,i+o*(1-Cgt),e+r-a*(1-Cgt),i,e+r-a,i),t.lineTo(e+a,i),t.bezierCurveTo(e+a*(1-Cgt),i,e,i+o*(1-Cgt),e,i+o),t.close()}}(this,t,e,i,r,n),this._curPath.complex=!1},e.clear=function(){this.pathLength=0,this.pathOffset=0,this.pointsOffset=0,this.dataOffset=0,this._curPath=null,this.paths.length=0,this._points.length=0;for(var t=this._renderDataList,e=0,i=t.length;e<i;e++){var r=t[e];r&&cw.remove(r)}this._renderDataList.length=0},e.close=function(){this._curPath.closed=!0},e.requestRenderData=function(){var t=cw.add();return this._renderDataList.push(t),t},e.getRenderData=function(){return 0===this._renderDataList.length&&this.requestRenderData(),this._renderDataList},e.addPoint=function(t,e,i){var r=this._curPath;if(r){var n=this._points,s=r.points,a=n[this.pointsOffset++];a?(a.x=t,a.y=e):(a=new Rgt(t,e),n.push(a)),a.flags=i,s.push(a)}},e._addPath=function(){var t=this.pathLength,e=this.paths[t];return e?e.reset():(e=new xgt,this.paths.push(e)),this.pathLength++,this._curPath=e,e},t}(),Igt=Math.PI,Mgt=Math.min,Bgt=Math.max,Pgt=Math.ceil,Ngt=Math.acos,Lgt=Math.cos,Fgt=Math.sin,Dgt=Math.atan2,Ugt=null,kgt=null,zgt=new Qs,Ggt=[],Hgt=0;Hgt<4;Hgt++)Ggt.push(new Cs);function Vgt(t,e,i){return t<e?e:t>i?i:t}var Wgt={useModel:!0,createImpl:function(){return new Ogt},updateRenderData:function(){},fillBuffers:function(){},renderIA:function(){},getRenderData:function(t,e){if(!kgt)return null;var i=kgt.getRenderData(),r=i[kgt.dataOffset];if(!r)return null;var n=r,s=n?n.vertexStart+e:0;return(s>65535||3*s>131070)&&(++kgt.dataOffset,kgt.dataOffset<i.length?r=i[kgt.dataOffset]:(r=kgt.requestRenderData(),i[kgt.dataOffset]=r),n=r),n&&n.vertexCount<s&&n.request(e,3*e),r},stroke:function(t){Qs.copy(zgt,t.strokeColor),t.impl&&(this._flattenPaths(t.impl),this._expandStroke(t),t.impl.updatePathOffset=!0,this.end(t))},fill:function(t){Qs.copy(zgt,t.fillColor),this._expandFill(t),t.impl&&(t.impl.updatePathOffset=!0),this.end(t)},end:function(t){t.markForUpdateRenderData()},_expandStroke:function(t){var e=.5*t.lineWidth,i=t.lineCap,r=t.lineJoin,n=t.miterLimit;if(kgt=t.impl){var s=function(t,e,i){var r=2*Ngt(t/(t+i));return Bgt(2,Pgt(e/r))}(e,Igt,kgt.tessTol);this._calculateJoins(kgt,e,r,n);for(var a=kgt.paths,o=0,h=kgt.pathOffset,l=kgt.pathLength;h<l;h++){var u=a[h],c=u.points.length;r===Xht.ROUND?o+=2*(c+u.bevel*(s+2)+1):o+=2*(c+5*u.bevel+1),u.closed||(i===jht.ROUND?o+=2*(2*s+2):o+=12)}var _=Ugt=this.getRenderData(t,o);if(_){for(var d=_.vData,p=_.iData,f=kgt.pathOffset,m=kgt.pathLength;f<m;f++){var g=a[f],v=g.points,y=v.length,T=_.vertexStart,E=void 0,S=void 0,b=0,A=0,C=g.closed;if(C?(E=v[y-1],S=v[0],b=0,A=y):(E=v[0],S=v[1],b=1,A=y-1),S=S||E,!C){var w=new Rgt(S.x,S.y);w.subtract(E),w.normalize();var R=w.x,x=w.y;i===jht.BUTT?this._buttCapStart(E,R,x,e,0):i===jht.SQUARE?this._buttCapStart(E,R,x,e,e):i===jht.ROUND&&this._roundCapStart(E,R,x,e,s)}for(var O=b;O<A;++O)r===Xht.ROUND?this._roundJoin(E,S,e,e,s):0!=(S.flags&(Yht.PT_BEVEL|Yht.PT_INNERBEVEL))?this._bevelJoin(E,S,e,e):(this._vSet(S.x+S.dmx*e,S.y+S.dmy*e,1),this._vSet(S.x-S.dmx*e,S.y-S.dmy*e,-1)),E=S,S=v[O+1];if(C){var I=8*T;this._vSet(d[I],d[I+1],1),this._vSet(d[I+8],d[I+8+1],-1)}else{var M=new Rgt(S.x,S.y);M.subtract(E),M.normalize();var B=M.x,P=M.y;i===jht.BUTT?this._buttCapEnd(S,B,P,e,0):i===jht.SQUARE?this._buttCapEnd(S,B,P,e,e):i===jht.ROUND&&this._roundCapEnd(S,B,P,e,s)}for(var N=_.indicesStart,L=T+2,F=_.vertexStart;L<F;L++)p[N++]=L-2,p[N++]=L-1,p[N++]=L;_.indicesStart=N}Ugt=null,kgt=null}}},_expandFill:function(t){if(kgt=t.impl){for(var e=kgt.paths,i=0,r=kgt.pathOffset,n=kgt.pathLength;r<n;r++)i+=e[r].points.length;var s=Ugt=this.getRenderData(t,i);if(s){for(var a=s,o=a.vData,h=a.iData,l=kgt.pathOffset,u=kgt.pathLength;l<u;l++){var c=e[l],_=c.points,d=_.length;if(0!==d){for(var p=s.vertexStart,f=0;f<d;++f)this._vSet(_[f].x,_[f].y);var m=s.indicesStart;if(c.complex){for(var g=[],v=p,y=s.vertexStart;v<y;v++){var T=8*v;g.push(o[T++]),g.push(o[T++]),g.push(o[T++])}var E=ggt(g,null,3);if(!E||0===E.length)continue;for(var S=0,b=E.length;S<b;S++)h[m++]=E[S]+p}else for(var A=p,C=p+2,w=a.vertexStart;C<w;C++)h[m++]=A,h[m++]=C-1,h[m++]=C;a.indicesStart=m}}Ugt=null,kgt=null}}},_calculateJoins:function(t,e,i,r){var n=0;e>0&&(n=1/e);for(var s=t.paths,a=t.pathOffset,o=t.pathLength;a<o;a++){var h=s[a],l=h.points,u=l.length,c=l[u-1],_=l[0];h.bevel=0;for(var d=0;d<u;d++){var p,f,m=c.dy,g=-c.dx,v=_.dy,y=-_.dx;if(_.dmx=.5*(m+v),_.dmy=.5*(g+y),(p=_.dmx*_.dmx+_.dmy*_.dmy)>1e-6){var T=1/p;T>600&&(T=600),_.dmx*=T,_.dmy*=T}_.dx*c.dy-c.dx*_.dy>0&&(_.flags|=Yht.PT_LEFT),p*(f=Bgt(11,Mgt(c.len,_.len)*n))*f<1&&(_.flags|=Yht.PT_INNERBEVEL),_.flags&Yht.PT_CORNER&&(p*r*r<1||i===Xht.BEVEL||i===Xht.ROUND)&&(_.flags|=Yht.PT_BEVEL),0!=(_.flags&(Yht.PT_BEVEL|Yht.PT_INNERBEVEL))&&h.bevel++,c=_,_=l[d+1]}}},_flattenPaths:function(t){for(var e=t.paths,i=t.pathOffset,r=t.pathLength;i<r;i++){var n=e[i],s=n.points,a=s[s.length-1],o=s[0];s.length>2&&a.equals(o)&&(n.closed=!0,s.pop(),a=s[s.length-1]);for(var h=0,l=s.length;h<l;h++){var u=new Rgt(o.x,o.y);u.subtract(a),a.len=u.length(),(u.x||u.y)&&u.normalize(),a.dx=u.x,a.dy=u.y,a=o,o=s[h+1]}}},_chooseBevel:function(t,e,i,r){var n=i.x,s=i.y,a=0,o=0,h=0,l=0;return 0!==t?(a=n+e.dy*r,o=s-e.dx*r,h=n+i.dy*r,l=s-i.dx*r):(a=h=n+i.dmx*r,o=l=s+i.dmy*r),[a,o,h,l]},_buttCapStart:function(t,e,i,r,n){var s=t.x-e*n,a=t.y-i*n,o=i,h=-e;this._vSet(s+o*r,a+h*r,1),this._vSet(s-o*r,a-h*r,-1)},_buttCapEnd:function(t,e,i,r,n){var s=t.x+e*n,a=t.y+i*n,o=i,h=-e;this._vSet(s+o*r,a+h*r,1),this._vSet(s-o*r,a-h*r,-1)},_roundCapStart:function(t,e,i,r,n){for(var s=t.x,a=t.y,o=i,h=-e,l=0;l<n;l++){var u=l/(n-1)*Igt,c=Lgt(u)*r,_=Fgt(u)*r;this._vSet(s-o*c-e*_,a-h*c-i*_,1),this._vSet(s,a,0)}this._vSet(s+o*r,a+h*r,1),this._vSet(s-o*r,a-h*r,-1)},_roundCapEnd:function(t,e,i,r,n){var s=t.x,a=t.y,o=i,h=-e;this._vSet(s+o*r,a+h*r,1),this._vSet(s-o*r,a-h*r,-1);for(var l=0;l<n;l++){var u=l/(n-1)*Igt,c=Lgt(u)*r,_=Fgt(u)*r;this._vSet(s,a,0),this._vSet(s-o*c+e*_,a-h*c+i*_,1)}},_roundJoin:function(t,e,i,r,n){var s=t.dy,a=-t.dx,o=e.dy,h=-e.dx,l=e.x,u=e.y;if(0!=(e.flags&Yht.PT_LEFT)){var c=this._chooseBevel(e.flags&Yht.PT_INNERBEVEL,t,e,i),_=c[0],d=c[1],p=c[2],f=c[3],m=Dgt(-a,-s),g=Dgt(-h,-o);g>m&&(g-=2*Igt),this._vSet(_,d,1),this._vSet(l-s*r,e.y-a*r,-1);for(var v=Vgt(Pgt((m-g)/Igt)*n,2,n),y=0;y<v;y++){var T=m+y/(v-1)*(g-m),E=l+Lgt(T)*r,S=u+Fgt(T)*r;this._vSet(l,u,0),this._vSet(E,S,-1)}this._vSet(p,f,1),this._vSet(l-o*r,u-h*r,-1)}else{var b=this._chooseBevel(e.flags&Yht.PT_INNERBEVEL,t,e,-r),A=b[0],C=b[1],w=b[2],R=b[3],x=Dgt(a,s),O=Dgt(h,o);O<x&&(O+=2*Igt),this._vSet(l+s*r,u+a*r,1),this._vSet(A,C,-1);for(var I=Vgt(Pgt((O-x)/Igt)*n,2,n),M=0;M<I;M++){var B=x+M/(I-1)*(O-x),P=l+Lgt(B)*i,N=u+Fgt(B)*i;this._vSet(P,N,1),this._vSet(l,u,0)}this._vSet(l+o*r,u+h*r,1),this._vSet(w,R,-1)}},_bevelJoin:function(t,e,i,r){var n=0,s=0,a=0,o=0,h=0,l=0,u=0,c=0,_=t.dy,d=-t.dx,p=e.dy,f=-e.dx;if(e.flags&Yht.PT_LEFT){var m=this._chooseBevel(e.flags&Yht.PT_INNERBEVEL,t,e,i);h=m[0],l=m[1],u=m[2],c=m[3],this._vSet(h,l,1),this._vSet(e.x-_*r,e.y-d*r,-1),this._vSet(u,c,1),this._vSet(e.x-p*r,e.y-f*r,-1)}else{var g=this._chooseBevel(e.flags&Yht.PT_INNERBEVEL,t,e,-r);n=g[0],s=g[1],a=g[2],o=g[3],this._vSet(e.x+_*i,e.y+d*i,1),this._vSet(n,s,-1),this._vSet(e.x+p*i,e.y+f*i,1),this._vSet(a,o,-1)}},_vSet:function(t,e,i){if(void 0===i&&(i=0),Ugt){var r=Ugt,n=8*r.vertexStart,s=r.vData;s[n++]=t,s[n++]=e,s[n++]=0,Qs.toArray(s,zgt,n),n+=4,s[n++]=i,r.vertexStart++}}},jgt=t("graphicsAssembler",{getAssembler:function(){return Wgt}});Jlt.Assembler=jgt;var Xgt=function(){this.char="",this.valid=!0,this.x=0,this.y=0,this.line=0,this.hash=""},Ygt=new Ks,qgt=null,Kgt=null,Zgt=[],Qgt=[],Jgt=[],$gt=[],tvt=new Ys,evt=new Ys,ivt=new Es,rvt=null,nvt=0,svt=0,avt=0,ovt=0,hvt=0,lvt=1,uvt=null,cvt="",_vt=0,dvt=0,pvt=0,fvt=0,mvt=0,gvt=0,vvt=0,yvt=!1,Tvt=0,Evt=0,Svt=0,bvt={updateRenderData:function(t){t.renderData&&t.renderData.vertDirty&&qgt!==t&&(Kgt=(qgt=t).node._uiProps.uiTransformComp,this._updateFontFamily(t),this._updateProperties(t),this._updateLabelInfo(t),this._updateContent(),qgt.actualFontSize=_vt,Kgt.setContentSize(evt),qgt.renderData.vertDirty=qgt.renderData.uvDirty=!1,qgt=null,this._resetProperties())},_updateFontScale:function(){lvt=_vt/dvt},_updateFontFamily:function(t){var e=t.font;uvt=e.spriteFrame,rvt=e.fntConfig,Iat.fontAtlas=e.fontDefDictionary},_updateLabelInfo:function(){Iat.hash="",Iat.margin=0},_updateProperties:function(t){cvt=t.string.toString(),_vt=t.fontSize,dvt=rvt?rvt.fontSize:t.fontSize,pvt=t.horizontalAlign,fvt=t.verticalAlign,mvt=t.spacingX,vvt=t.overflow,gvt=t._lineHeight;var e=Kgt.contentSize;evt.width=e.width,evt.height=e.height,vvt===Tat.NONE?(yvt=!1,evt.width+=2*Iat.margin,evt.height+=2*Iat.margin):vvt===Tat.RESIZE_HEIGHT?(yvt=!0,evt.height+=2*Iat.margin):yvt=t.enableWrapText,Iat.lineHeight=gvt,Iat.fontSize=_vt,this._setupBMFontOverflowMetrics()},_resetProperties:function(){rvt=null,uvt=null,Iat.hash="",Iat.margin=0},_updateContent:function(){this._updateFontScale(),this._computeHorizontalKerningForText(),this._alignText()},_computeHorizontalKerningForText:function(){for(var t=cvt,e=t.length,i=rvt.kerningDict,r=Zgt,n=-1,s=0;s<e;++s){var a=t.charCodeAt(s),o=i[n<<16|65535&a]||0;r[s]=s<e-1?o:0,n=a}},_multilineTextWrap:function(t){for(var e=cvt.length,i=0,r=0,n=0,s=0,a=0,o=0,h=0,l=null,u=0;u<e;){var c=cvt.charAt(u);if("\n"!==c){for(var _=t(cvt,u,e),d=o,p=h,f=a,m=r,g=!1,v=0;v<_;++v){var y=u+v;if("\r"!==(c=cvt.charAt(y)))if(l=Iat.fontAtlas.getLetterDefinitionForChar(c,Iat)){var T=m+l.offsetX*lvt-Iat.margin;if(yvt&&Svt>0&&r>0&&T+l.w*lvt>Svt&&!id(c)){Jgt.push(a),a=0,i++,r=0,n-=gvt*this._getFontScale()+0,g=!0;break}ivt.x=T,ivt.y=n-l.offsetY*lvt,this._recordLetterInfo(ivt,c,y,i),y+1<Zgt.length&&y<e-1&&(m+=Zgt[y+1]),m+=l.xAdvance*lvt+mvt,f=ivt.x+l.w*lvt,d<ivt.y&&(d=ivt.y),p>ivt.y-l.h*lvt&&(p=ivt.y-l.h*lvt)}else this._recordPlaceholderInfo(y,c),console.log("Can't find letter definition in texture atlas "+rvt.atlasName+" for letter:"+c);else this._recordPlaceholderInfo(y,c)}g||(r=m,o<d&&(o=d),h>p&&(h=p),s<(a=f)&&(s=a),u+=_)}else Jgt.push(a),a=0,i++,r=0,n-=gvt*this._getFontScale()+0,this._recordPlaceholderInfo(u,c),u++}return Jgt.push(a),svt=(nvt=i+1)*gvt*this._getFontScale(),nvt>1&&(svt+=0*(nvt-1)),evt.width=Tvt,evt.height=Evt,Tvt<=0&&(evt.width=parseFloat(s.toFixed(2))+2*Iat.margin),Evt<=0&&(evt.height=parseFloat(svt.toFixed(2))+2*Iat.margin),ovt=evt.height,hvt=0,o>0&&(ovt=evt.height+o),h<-svt&&(hvt=svt+h),!0},_getFirstCharLen:function(){return 1},_getFontScale:function(){return vvt===Tat.SHRINK?lvt:1},_getFirstWordLen:function(t,e,i){var r=t.charAt(e);if(ed(r)||"\n"===r||id(r))return 1;var n=1,s=Iat.fontAtlas.getLetterDefinitionForChar(r,Iat);if(!s)return n;for(var a=s.xAdvance*lvt+mvt,o=e+1;o<i&&(r=t.charAt(o),s=Iat.fontAtlas.getLetterDefinitionForChar(r,Iat));++o){if(a+s.offsetX*lvt+s.w*lvt>Svt&&!id(r)&&Svt>0)return n;if(a+=s.xAdvance*lvt+mvt,"\n"===r||id(r)||ed(r))break;n++}return n},_multilineTextWrapByWord:function(){return this._multilineTextWrap(this._getFirstWordLen)},_multilineTextWrapByChar:function(){return this._multilineTextWrap(this._getFirstCharLen)},_recordPlaceholderInfo:function(t,e){if(t>=Qgt.length){var i=new Xgt;Qgt.push(i)}Qgt[t].char=e,Qgt[t].hash=e.charCodeAt(0)+Iat.hash,Qgt[t].valid=!1},_recordLetterInfo:function(t,e,i,r){if(i>=Qgt.length){var n=new Xgt;Qgt.push(n)}var s=e.charCodeAt(0)+Iat.hash;Qgt[i].line=r,Qgt[i].char=e,Qgt[i].hash=s,Qgt[i].valid=Iat.fontAtlas.getLetter(s).valid,Qgt[i].x=t.x,Qgt[i].y=t.y},_alignText:function(){svt=0,Jgt.length=0,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),vvt===Tat.SHRINK&&_vt>0&&this._isVerticalClamp()&&this._shrinkLabelToContentSize(this._isVerticalClamp),this._updateQuads()||vvt===Tat.SHRINK&&this._shrinkLabelToContentSize(this._isHorizontalClamp)},_scaleFontSizeDown:function(t){var e=!0;t||(t=.1,e=!1),_vt=t,e&&this._updateContent()},_shrinkLabelToContentSize:function(t){for(var e=0,i=0|_vt,r=0;e<i;){var n=r=e+i+1>>1;if(n<=0)break;lvt=n/dvt,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),t()?i=r-1:e=r}e>=0&&this._scaleFontSizeDown(e)},_isVerticalClamp:function(){return svt>evt.height},_isHorizontalClamp:function(){for(var t=!1,e=0,i=cvt.length;e<i;++e){var r=Qgt[e];if(r.valid){var n=Iat.fontAtlas.getLetterDefinitionForChar(r.char,Iat);if(!n)continue;var s=r.x+n.w/2*lvt,a=r.line;if(Tvt>0)if(yvt){if(Jgt[a]>evt.width&&(s>evt.width||s<0)){t=!0;break}}else if(s>evt.width){t=!0;break}}}return t},_isHorizontalClamped:function(t,e){var i=Jgt[e],r=t>evt.width||t<0;return yvt?i>evt.width&&r:r},_updateQuads:function(){if(!qgt)return!1;var t=uvt?uvt.texture:Iat.fontAtlas.getTexture(),e=qgt.renderData;e.dataLength=e.vertexCount=e.indicesCount=0;for(var i=Kgt.anchorPoint,r=evt,n=i.x*r.width,s=i.y*r.height,a=!0,o=0,h=cvt.length;o<h;++o){var l=Qgt[o];if(l.valid){var u=Iat.fontAtlas.getLetter(l.hash);if(u){Ygt.height=u.h,Ygt.width=u.w,Ygt.x=u.u,Ygt.y=u.v;var c=l.y+avt;if(Evt>0){if(c>ovt){var _=c-ovt;Ygt.y+=_,Ygt.height-=_,c-=_}c-u.h*lvt<hvt&&vvt===Tat.CLAMP&&(Ygt.height=c<hvt?0:(c-hvt)/lvt)}var d=l.line,p=l.x+u.w/2*lvt+$gt[d];if(Tvt>0&&this._isHorizontalClamped(p,d))if(vvt===Tat.CLAMP)Ygt.width=0;else if(vvt===Tat.SHRINK){if(evt.width>u.w){a=!1;break}Ygt.width=0}if(Ygt.height>0&&Ygt.width>0){var f=this._determineRect(),m=l.x+$gt[l.line];this.appendQuad(qgt,t,Ygt,f,m-n,c-s,lvt)}}else console.warn("Can't find letter in this bitmap-font")}}return a},appendQuad:function(){},_determineRect:function(){var t=uvt.isRotated(),e=uvt.getOriginalSize(),i=uvt.getRect(),r=uvt.getOffset(),n=r.x+(e.width-i.width)/2,s=r.y-(e.height-i.height)/2;if(t){var a=Ygt.x;Ygt.x=i.x+i.height-Ygt.y-Ygt.height-s,Ygt.y=a+i.y-n,Ygt.y<0&&(Ygt.height=Ygt.height+s)}else Ygt.x+=i.x-n,Ygt.y+=i.y+s;return t},_computeAlignmentOffset:function(){switch($gt.length=0,pvt){case vat.LEFT:for(var t=0;t<nvt;++t)$gt.push(0);break;case vat.CENTER:for(var e=0,i=Jgt.length;e<i;e++)$gt.push((evt.width-Jgt[e])/2);break;case vat.RIGHT:for(var r=0,n=Jgt.length;r<n;r++)$gt.push(evt.width-Jgt[r])}if(avt=evt.height,fvt!==yat.TOP){var s=evt.height-svt+gvt*this._getFontScale()-dvt*lvt;fvt===yat.BOTTOM?avt-=s:avt-=s/2}},_setupBMFontOverflowMetrics:function(){var t=evt.width,e=evt.height;vvt===Tat.RESIZE_HEIGHT&&(e=0),vvt===Tat.NONE&&(t=0,e=0),Tvt=t,Evt=e,tvt.width=t,tvt.height=e,Svt=t}},Avt={createData:function(t){return t.requestRenderData()},fillBuffers:function(t,e){cnt(t.node,e,t.renderData,t.color)},appendQuad:function(t,e,i,r,n,s,a){var o=t.renderData;if(o){var h=o.dataLength;o.dataLength+=4,o.vertexCount=o.dataLength,o.indicesCount=o.dataLength/2*3;var l=o.data,u=e.width,c=e.height,_=i.width,d=i.height,p=0,f=0,m=0,g=0;r?(p=i.x/u,g=(i.x+d)/u,f=(i.y+_)/c,m=i.y/c,l[h].u=p,l[h].v=m,l[h+1].u=p,l[h+1].v=f,l[h+2].u=g,l[h+2].v=m,l[h+3].u=g,l[h+3].v=f):(p=i.x/u,g=(i.x+_)/u,f=(i.y+d)/c,m=i.y/c,l[h].u=p,l[h].v=f,l[h+1].u=g,l[h+1].v=f,l[h+2].u=p,l[h+2].v=m,l[h+3].u=g,l[h+3].v=m),l[h].x=n,l[h].y=s-d*a,l[h+1].x=n+_*a,l[h+1].y=s-d*a,l[h+2].x=n,l[h+2].y=s,l[h+3].x=n+_*a,l[h+3].y=s}}};_t(Avt,bvt);var Cvt=null,wvt=dt(bvt,{getAssemblerData:function(){return Cvt||(Cvt=new Oat(1024,1024)),Cvt.getTexture()},_updateFontFamily:function(t){Iat.fontAtlas=Cvt,Iat.fontFamily=this._getFontFamily(t);var e=t.getComponent(Ect);e&&e.enabled?(Iat.isOutlined=!0,Iat.margin=e.width,Iat.out=e.color.clone(),Iat.out.a=e.color.a*t.color.a/255):(Iat.isOutlined=!1,Iat.margin=0)},_getFontFamily:function(t){var e="Arial";return t.useSystemFont?e=t.fontFamily||"Arial":t.font&&(t.font._nativeAsset?e=t.font._nativeAsset:$D.postLoadNative(t.font,(function(){t.isValid&&(e=t.font._nativeAsset||"Arial",t.updateRenderData(!0))}))),e},_updateLabelInfo:function(t){Iat.fontDesc=this._getFontDesc(),Iat.color=t.color,Iat.hash=function(t){var e=t.color.toHEX(),i="";return t.isOutlined&&t.margin>0&&(i=i+t.margin+t.out.toHEX()),""+t.fontSize+t.fontFamily+e+i}(Iat)},_getFontDesc:function(){return Iat.fontSize.toString()+"px "+Iat.fontFamily},_computeHorizontalKerningForText:function(){},_determineRect:function(){return!1}}),Rvt=new Qs(255,255,255,255),xvt={createData:function(t){return t.requestRenderData()},fillBuffers:function(t,e){if(t.renderData){var i=t.node;Rvt.a=t.color.a,cnt(i,e,t.renderData,Rvt)}},appendQuad:Avt.appendQuad};_t(xvt,wvt);var Ovt=Nat.Overflow,Ivt=null,Mvt=null,Bvt=null,Pvt="",Nvt="",Lvt=0,Fvt=0,Dvt=[],Uvt=new Ys,kvt=0,zvt=0,Gvt=0,Hvt=new Qs,Vvt="",Wvt=Ovt.NONE,jvt=!1,Xvt=null,Yvt=Qs.BLACK.clone(),qvt=null,Kvt=Qs.BLACK.clone(),Zvt=new Ks,Qvt=Ys.ZERO.clone(),Jvt=Ys.ZERO.clone(),$vt=Es.ZERO.clone(),tyt=Es.ZERO.clone(),eyt=0,iyt=0,ryt=!1,nyt=!1,syt=!1,ayt=["left","center","right"],oyt={getAssemblerData:function(){return Nat._canvasPool.get()},resetAssemblerData:function(t){t&&Nat._canvasPool.put(t)},updateRenderData:function(t){if(t.renderData&&t.renderData.vertDirty){var e=t.node._uiProps.uiTransformComp;this._updateFontFamily(t),this._updateProperties(t,e),this._calculateLabelFont(),this._updateLabelDimensions(),this._updateTexture(),t.actualFontSize=Lvt,e.setContentSize(Uvt),this.updateVertexData(t),t.markForUpdateRenderData(!1),Ivt=null,Mvt=null,Bvt=null}},updateVertexData:function(){},_updateFontFamily:function(t){t.useSystemFont?Vvt=t.fontFamily||"Arial":t.font?t.font._nativeAsset?Vvt=t.font._nativeAsset:($D.postLoadNative(t.font,(function(){t.isValid&&(Vvt=t.font._nativeAsset||"Arial",t.updateRenderData(!0))})),Vvt="Arial"):Vvt="Arial"},_updateProperties:function(t,e){var i=t.assemblerData;i&&(Ivt=i.context,Mvt=i.canvas,Bvt=t.spriteFrame,Nvt=t.string.toString(),Lvt=t.fontSize,Fvt=Lvt,Wvt=t.overflow,Uvt.width=e.width,Uvt.height=e.height,Jvt=e.contentSize,iyt=t.underlineHeight,kvt=t.lineHeight,zvt=t.horizontalAlign,Gvt=t.verticalAlign,Hvt=t.color,ryt=t.isBold,nyt=t.isItalic,syt=t.isUnderline,jvt=Wvt!==Ovt.NONE&&(Wvt===Ovt.RESIZE_HEIGHT||t.enableWrapText),(Xvt=(Xvt=Ect&&t.getComponent(Ect))&&Xvt.enabled&&Xvt.width>0?Xvt:null)&&Yvt.set(Xvt.color),(qvt=(qvt=qmt&&t.getComponent(qmt))&&qvt.enabled?qvt:null)&&Kvt.set(qvt.color),this._updatePaddingRect())},_updatePaddingRect:function(){var t=0,e=0,i=0,r=0,n=0;if(Qvt.width=Qvt.height=0,Xvt&&(t=e=i=r=n=Xvt.width,Qvt.width=Qvt.height=2*n),qvt){var s=qvt.blur+n,a=qvt.offset.x,o=qvt.offset.y;i=Math.max(i,-a+s),r=Math.max(r,a+s),t=Math.max(t,o+s),e=Math.max(e,-o+s)}if(nyt){var h=Fvt*Math.tan(.20943951);r+=h,Qvt.width+=h}Zvt.x=i,Zvt.y=t,Zvt.width=i+r,Zvt.height=t+e},_calculateFillTextStartPosition:function(){var t=0;zvt===vat.RIGHT?t=Uvt.width-Zvt.width:zvt===vat.CENTER&&(t=(Uvt.width-Zvt.width)/2);var e=this._getLineHeight()*(Dvt.length-1),i=Lvt*(1-X_/2);if(Gvt!==yat.TOP){var r=e+Zvt.height+Lvt-Uvt.height;Gvt===yat.BOTTOM?i-=r+=X_/2*Lvt:i-=r/2}return i+=0*Lvt,$vt.set(t+Zvt.x,i+Zvt.y)},_updateTexture:function(){if(Ivt&&Mvt){Ivt.clearRect(0,0,Mvt.width,Mvt.height),Ivt.font=Pvt,this._calculateFillTextStartPosition();var t=this._getLineHeight();Ivt.lineJoin="round",Ivt.fillStyle="rgba("+Hvt.r+", "+Hvt.g+", "+Hvt.b+", 1)";var e,i=$vt.x,r=0;this._drawTextEffect($vt,t);for(var n=0;n<Dvt.length;++n)r=$vt.y+n*t,Xvt&&Ivt.strokeText(Dvt[n],i,r),Ivt.fillText(Dvt[n],i,r);qvt&&(Ivt.shadowColor="transparent"),Bvt&&(e=Bvt instanceof um?Bvt.texture:Bvt,0!==Mvt.width&&0!==Mvt.height&&(e.reset({width:Mvt.width,height:Mvt.height,mipmapLevel:1}),e.uploadData(Mvt),_.director.root&&_.director.root.ui&&_.director.root.ui._releaseDescriptorSetCache(e.getHash())))}},_setupOutline:function(){Ivt.strokeStyle="rgba("+Yvt.r+", "+Yvt.g+", "+Yvt.b+", "+Yvt.a/255+")",Ivt.lineWidth=2*Xvt.width},_setupShadow:function(){Ivt.shadowColor="rgba("+Kvt.r+", "+Kvt.g+", "+Kvt.b+", "+Kvt.a/255+")",Ivt.shadowBlur=qvt.blur,Ivt.shadowOffsetX=qvt.offset.x,Ivt.shadowOffsetY=-qvt.offset.y},_drawTextEffect:function(t,e){if(qvt||Xvt||syt){var i=Dvt.length>1&&qvt,r=this._measureText(Ivt,Pvt),n=0,s=0;qvt&&this._setupShadow(),Xvt&&this._setupOutline();for(var a=0;a<Dvt.length;++a)n=t.x,s=t.y+a*e,i&&(Xvt&&Ivt.strokeText(Dvt[a],n,s),Ivt.fillText(Dvt[a],n,s)),syt&&(eyt=r(Dvt[a]),zvt===vat.RIGHT?tyt.x=t.x-eyt:zvt===vat.CENTER?tyt.x=t.x-eyt/2:tyt.x=t.x,tyt.y=s+Fvt/8,Ivt.fillRect(tyt.x,tyt.y,eyt,iyt));i&&(Ivt.shadowColor="transparent")}},_updateLabelDimensions:function(){Uvt.width=Math.min(Uvt.width,2048),Uvt.height=Math.min(Uvt.height,2048);var t=!1;Mvt.width!==Uvt.width&&(Mvt.width=Uvt.width,t=!0),Mvt.height!==Uvt.height&&(Mvt.height=Uvt.height,t=!0),t&&(Ivt.font=Pvt),Ivt.textAlign=ayt[zvt],Ivt.textBaseline="alphabetic"},_getFontDesc:function(){var t=Lvt.toString()+"px ";return t+=Vvt,ryt&&(t="bold "+t),nyt&&(t="italic "+t),t},_getLineHeight:function(){return 0|(0===kvt?Lvt:kvt*Lvt/Fvt)},_calculateParagraphLength:function(t,e){for(var i,r=[],n=h(t);!(i=n()).done;){var s=rd(e,i.value,Pvt);r.push(s)}return r},_measureText:function(t,e){return function(i){return rd(t,i,e)}},_calculateShrinkFont:function(t){if(Ivt){var e=this._calculateParagraphLength(t,Ivt),i=0,r=0,n=0;if(jvt){var s=Jvt.width,a=Jvt.height;if(s<0||a<0)return;r=a+1;for(var o=0,h=0|Lvt+1,l=0;o<h;){if((l=o+h+1>>1)<=0){x(4003);break}Lvt=l,Pvt=this._getFontDesc(),Ivt.font=Pvt;var u=this._getLineHeight();for(r=0,i=0;i<t.length;++i){var c=rd(Ivt,t[i],Pvt);r+=sd(t[i],c,s,this._measureText(Ivt,Pvt)).length*u}r>a?h=l-1:o=l}0===o?x(4003):(Lvt=o,Pvt=this._getFontDesc(),Ivt.font=Pvt)}else{for(r=t.length*this._getLineHeight(),i=0;i<t.length;++i)n<e[i]&&(n=e[i]);var _=(Uvt.width-Zvt.width)/n,d=Uvt.height/r;Lvt=Fvt*Math.min(1,_,d)|0,Pvt=this._getFontDesc(),Ivt.font=Pvt}}},_calculateWrapText:function(t){if(jvt&&Ivt){Dvt=[];for(var e=Jvt.width,i=0;i<t.length;++i){var r=rd(Ivt,t[i],Pvt),n=sd(t[i],r,e,this._measureText(Ivt,Pvt));Dvt=Dvt.concat(n)}}},_calculateLabelFont:function(){if(Ivt){var t=Nvt.split("\n");switch(Dvt=t,Pvt=this._getFontDesc(),Ivt.font=Pvt,Wvt){case Ovt.NONE:for(var e=0,i=0,r=0;r<t.length;++r){var n=rd(Ivt,t[r],Pvt);e=e>n?e:n}i=(Dvt.length+X_)*this._getLineHeight();var s=parseFloat(e.toFixed(2)),a=parseFloat(i.toFixed(2));Uvt.width=s+Zvt.width,Uvt.height=a+Zvt.height,Jvt.width=s+Qvt.width,Jvt.height=a+Qvt.height;break;case Ovt.SHRINK:this._calculateShrinkFont(t),this._calculateWrapText(t);break;case Ovt.CLAMP:this._calculateWrapText(t);break;case Ovt.RESIZE_HEIGHT:this._calculateWrapText(t);var o=(Dvt.length+X_)*this._getLineHeight();Uvt.height=o+Zvt.height,Jvt.height=o+Qvt.height}}}},hyt=Qs.WHITE.clone(),lyt={createData:function(t){var e=t.requestRenderData();e.dataLength=4,e.vertexCount=4,e.indicesCount=6;var i=e.vData=new Float32Array(36);i[3]=i[21]=i[22]=i[31]=0,i[4]=i[12]=i[13]=i[30]=1;for(var r=5,n=0;n<4;n++)Qs.toArray(i,hyt,r),r+=9;return e},fillBuffers:function(t,e){var i=t.renderData,r=i.data,n=t.node,s=e.acquireBufferBatch(),a=s.byteOffset>>2,o=s.indicesOffset,h=s.vertexOffset;s.request()||(s=e.currBufferBatch,o=0,h=0);var l=s.vData,u=s.iData,c=i.vData,_=r[0],d=r[3];n.updateWorldTransform();var p=n._pos,f=n._rot,m=n._scale,g=_.x*m.x,v=d.x*m.x,y=_.y*m.y,T=d.y*m.y,E=f.x,S=f.y,b=f.z,A=f.w,C=E*S,w=b*A,R=E*E-S*S,x=A*A-b*b,O=x+R,I=2*(C-w),M=x-R,B=2*(C+w),P=p.x,N=p.y;c[0]=O*g+I*y+P,c[1]=M*y+B*g+N,c[9]=O*v+I*y+P,c[10]=M*y+B*v+N,c[18]=O*g+I*T+P,c[19]=M*T+B*g+N,c[27]=O*v+I*T+P,c[28]=M*T+B*v+N,l.set(c,a),u[o++]=h,u[o++]=h+1,u[o++]=h+2,u[o++]=h+2,u[o++]=h+1,u[o++]=h+3},updateVertexData:function(t){var e=t.renderData;if(e){var i=t.node._uiProps.uiTransformComp,r=i.width,n=i.height,s=i.anchorX*r,a=i.anchorY*n,o=e.data;o[0].x=-s,o[0].y=-a,o[3].x=r-s,o[3].y=n-a}}};_t(lyt,oyt);var uyt=t("labelAssembler",{getAssembler:function(t){var e=lyt;return t.font instanceof _O?e=Avt:t.cacheMode===Nat.CacheMode.CHAR&&(e=xvt),e}});Nat.Assembler=uyt;var cyt=cst.FillType,_yt=new Hs,dyt={useModel:!1,updateRenderData:function(t){var e=t.spriteFrame,i=t.renderData;if(i&&e){var r=i.uvDirty,n=i.vertDirty;if(!r&&!n)return;var s=t.fillStart,a=t.fillRange;a<0&&(s+=a,a=-a),a=(a=(a=s+a)>1?1:a)<0?0:a;var o=(s=(s=s>1?1:s)<0?0:s)+(a=(a-=s)<0?0:a);o=o>1?1:o,r&&this.updateUVs(t,s,o),n&&(this.updateVertexData&&this.updateVertexData(t,s,o),this.updateWorldVertexData(t))}},updateUVs:function(t,e,i){var r=t.spriteFrame,n=t.renderData,s=n.data,a=r.width,o=r.height,h=r.getRect(),l=0,u=0,c=0,_=0,d=0,p=0,f=0,m=0,g=0,v=0;switch(r.isRotated()?(l=h.x/a,u=(h.y+h.width)/o,c=d=l,f=g=(h.x+h.height)/a,p=v=u,_=m=h.y/o):(l=h.x/a,u=(h.y+h.height)/o,c=f=l,d=g=(h.x+h.width)/a,_=p=u,m=v=h.y/o),t.fillType){case cyt.HORIZONTAL:s[0].u=c+(d-c)*e,s[0].v=_+(p-_)*e,s[1].u=c+(d-c)*i,s[1].v=_+(p-_)*i,s[2].u=f+(g-f)*e,s[2].v=m+(v-m)*e,s[3].u=f+(g-f)*i,s[3].v=m+(v-m)*i;break;case cyt.VERTICAL:s[0].u=c+(f-c)*e,s[0].v=_+(m-_)*e,s[1].u=d+(g-d)*e,s[1].v=p+(v-p)*e,s[2].u=c+(f-c)*i,s[2].v=_+(m-_)*i,s[3].u=d+(g-d)*i,s[3].v=p+(v-p)*i;break;default:B(2626)}n.uvDirty=!1},updateVertexData:function(t,e,i){var r=t.renderData,n=r.data,s=t.node._uiProps.uiTransformComp,a=s.width,o=s.height,h=s.anchorX*a,l=s.anchorY*o,u=-h,c=-l,_=a-h,d=o-l,p=0;switch(t.fillType){case cyt.HORIZONTAL:p=u+(_-u)*i,u+=(_-u)*e,_=p;break;case cyt.VERTICAL:p=c+(d-c)*i,c+=(d-c)*e,d=p;break;default:B(2626)}n[4].x=u,n[4].y=c,n[5].x=_,n[5].y=c,n[6].x=u,n[6].y=d,n[7].x=_,n[7].y=d,r.vertDirty=!1},createData:function(t){var e=t.requestRenderData();e.dataLength=8,e.vertexCount=4,e.indicesCount=6;for(var i,r=h(e.data);!(i=r()).done;)i.value.z=0;return e},updateWorldVertexData:function(t){var e=t.node,i=t.renderData.data;e.getWorldMatrix(_yt);for(var r=0;r<4;r++){var n=i[r+4],s=i[r];Cs.transformMat4(s,n,_yt)}},fillBuffers:function(t,e){t.node.hasChangedFlags&&this.updateWorldVertexData(t),t.node,function(t,e,i,r){var n=i.data,s=e.acquireBufferBatch(),a=s.byteOffset>>2,o=i.vertexCount,h=s.indicesOffset,l=s.vertexOffset;s.request(o,i.indicesCount)||(s=e.currBufferBatch,o=0,h=0,l=0);for(var u=s.vData,c=0;c<o;c++){var _=n[c];u[a++]=_.x,u[a++]=_.y,u[a++]=_.z,u[a++]=_.u,u[a++]=_.v,Qs.toArray(u,r,a),a+=4}var d=s.iData;d[h++]=l,d[h++]=l+1,d[h++]=l+2,d[h++]=l+1,d[h++]=l+3,d[h++]=l+2}(0,e,t.renderData,t.color)}},pyt=2*Math.PI,fyt=[new Es,new Es,new Es,new Es],myt=new Array(4),gyt=new Array(8),vyt=[new Es,new Es,new Es,new Es],yyt=[new Es,new Es,new Es,new Es],Tyt=new Es,Eyt=[new Es,new Es,new Es,new Es];function Syt(t,e,i,r,n,s,a){var o=Math.sin(s);o=Math.abs(o)>1e-6?o:0;var h=Math.cos(s),l=0,u=0;if(0!==(h=Math.abs(h)>1e-6?h:0)){if(l=o/h,(t-n.x)*h>0){var c=n.y+l*(t-n.x);a[0].x=t,a[0].y=c}if((e-n.x)*h>0){var _=n.y+l*(e-n.x);a[2].x=e,a[2].y=_}}if(0!==o){if(u=h/o,(r-n.y)*o>0){var d=n.x+u*(r-n.y);a[3].x=d,a[3].y=r}if((i-n.y)*o>0){var p=n.x+u*(i-n.y);a[1].x=p,a[1].y=i}}}function byt(t,e){var i=e.x-t.x,r=e.y-t.y;if(0===i&&0===r)return 0;if(0===i)return r>0?.5*Math.PI:1.5*Math.PI;var n=Math.atan(r/i);return i<0&&(n+=Math.PI),n}function Ayt(t,e,i,r,n){var s=myt,a=s[0],o=s[1],h=s[2],l=s[3];t[e].x=i.x,t[e].y=i.y,t[e+1].x=r.x,t[e+1].y=r.y,t[e+2].x=n.x,t[e+2].y=n.y,Cyt((i.x-a)/(h-a),(i.y-o)/(l-o),t,e),Cyt((r.x-a)/(h-a),(r.y-o)/(l-o),t,e+1),Cyt((n.x-a)/(h-a),(n.y-o)/(l-o),t,e+2)}function Cyt(t,e,i,r){var n=gyt,s=n[0]+(n[2]-n[0])*t,a=n[4]+(n[6]-n[4])*t,o=n[1]+(n[3]-n[1])*t,h=n[5]+(n[7]-n[5])*t,l=i[r];l.u=s+(a-s)*e,l.v=o+(h-o)*e}for(var wyt={useModel:!1,createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t.spriteFrame,i=t.renderData;if(i&&e&&(i.vertDirty||i.uvDirty)){var r=i.data,n=t.fillStart,s=t.fillRange;for(s<0&&(n+=s,s=-s);n>=1;)n-=1;for(;n<0;)n+=1;var a=(n*=pyt)+(s*=pyt);!function(t){var e=t.node._uiProps.uiTransformComp,i=e.width,r=e.height,n=e.anchorX*i,s=e.anchorY*r,a=-n,o=-s,l=i-n,u=r-s,c=myt;c[0]=a,c[1]=o,c[2]=l,c[3]=u;var _=t.fillCenter,d=Tyt.x=Math.min(Math.max(0,_.x),1)*(l-a)+a,p=Tyt.y=Math.min(Math.max(0,_.y),1)*(u-o)+o;fyt[0].x=fyt[3].x=a,fyt[1].x=fyt[2].x=l,fyt[0].y=fyt[1].y=o,fyt[2].y=fyt[3].y=u;for(var f,m=h(Eyt);!(f=m()).done;){var g=f.value;Es.set(g,0,0)}d!==c[0]&&Es.set(Eyt[0],3,0),d!==c[2]&&Es.set(Eyt[2],1,2),p!==c[1]&&Es.set(Eyt[1],0,1),p!==c[3]&&Es.set(Eyt[3],2,3)}(t),function(t){var e=t.width,i=t.height,r=t.getRect(),n=0,s=0,a=0,o=0,h=gyt;t.isRotated()?(n=r.x/e,s=(r.x+r.height)/e,a=r.y/i,o=(r.y+r.width)/i,h[0]=h[2]=n,h[4]=h[6]=s,h[3]=h[7]=o,h[1]=h[5]=a):(n=r.x/e,s=(r.x+r.width)/e,a=r.y/i,o=(r.y+r.height)/i,h[0]=h[4]=n,h[2]=h[6]=s,h[1]=h[3]=o,h[5]=h[7]=a)}(e),Syt(myt[0],myt[2],myt[1],myt[3],Tyt,n,vyt),Syt(myt[0],myt[2],myt[1],myt[3],Tyt,n+s,yyt);for(var o=0,l=0;l<4;++l){var u=Eyt[l];if(u)if(s>=pyt)i.dataLength=o+3,Ayt(r,o,Tyt,fyt[u.x],fyt[u.y]),o+=3;else{var c=byt(Tyt,fyt[u.x]),_=byt(Tyt,fyt[u.y]);_<c&&(_+=pyt),c-=pyt,_-=pyt;for(var d=0;d<3;++d)c>=a||(c>=n?(i.dataLength=o+3,Ayt(r,o,Tyt,fyt[u.x],_>=a?yyt[l]:fyt[u.y]),o+=3):_<=n||(_<=a?(i.dataLength=o+3,Ayt(r,o,Tyt,vyt[l],fyt[u.y]),o+=3):(i.dataLength=o+3,Ayt(r,o,Tyt,vyt[l],yyt[l]),o+=3))),c+=pyt,_+=pyt}}i.indicesCount=i.vertexCount=o,i.vertDirty=i.uvDirty=!1}},fillBuffers:function(t,e){!function(t,e,i,r){var n=i.data,s=e.acquireBufferBatch(),a=s.byteOffset>>2,o=i.vertexCount,h=s.indicesOffset,l=s.vertexOffset;s.request(o,i.indicesCount)||(s=e.currBufferBatch,o=0,h=0,l=0);var u=s.vData;t.getWorldMatrix(unt);for(var c=0;c<o;c++){var _=n[c];Cs.set(lnt,_.x,_.y,0),Cs.transformMat4(lnt,lnt,unt),u[a++]=lnt.x,u[a++]=lnt.y,u[a++]=lnt.z,u[a++]=_.u,u[a++]=_.v,Qs.toArray(u,r,a),a+=4}for(var d=s.iData,p=0;p<i.dataLength;p++)d[h+p]=l+p}(t.node,e,t.renderData,t.color)}},Ryt=[],xyt=0;xyt<4;xyt++)Ryt.push(new Cs);for(var Oyt={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.vertexCount=4,e.indicesCount=6,e.vData=new Float32Array(36),e},updateRenderData:function(t){var e=t.spriteFrame,i=t.renderData;i&&e&&(i.vertDirty&&this.updateVertexData(t),i.uvDirty&&this.updateUvs(t))},fillBuffers:function(t,e){if(null!==t){var i=t.renderData.data,r=t.node,n=e.acquireBufferBatch(),s=n.byteOffset>>2,a=n.indicesOffset,o=n.vertexOffset;n.request()||(n=e.currBufferBatch,s=0,a=0,o=0);var h=n.vData,l=n.iData,u=t.renderData.vData,c=i[0],_=i[3],d=r.worldMatrix,p=d.m00,f=d.m01,m=d.m04,g=d.m05,v=d.m12,y=d.m13,T=c.x,E=_.x,S=c.y,b=_.y,A=p*T,C=p*E,w=f*T,R=f*E,x=m*S,O=m*b,I=g*S,M=g*b;u[0]=A+x+v,u[1]=w+I+y,u[9]=C+x+v,u[10]=R+I+y,u[18]=A+O+v,u[19]=w+M+y,u[27]=C+O+v,u[28]=R+M+y,h.set(u,s),l[a++]=o,l[a++]=o+1,l[a++]=o+2,l[a++]=o+2,l[a++]=o+1,l[a++]=o+3}},updateVertexData:function(t){var e=t.renderData;if(e){var i=t.node._uiProps.uiTransformComp,r=e.data,n=i.width,s=i.height,a=i.anchorX*n,o=i.anchorY*s,h=0,l=0,u=0,c=0;if(t.trim)h=-a,l=-o,u=n-a,c=s-o;else{var _=t.spriteFrame,d=_.getOriginalSize(),p=_.getRect(),f=d.width,m=d.height,g=p.width,v=p.height,y=_.getOffset(),T=n/f,E=s/m,S=y.x+(f-g)/2,b=y.x-(f-g)/2;h=S*T-a,l=(y.y+(m-v)/2)*E-o,u=n+b*T-a,c=s+(y.y-(m-v)/2)*E-o}r[0].x=h,r[0].y=l,r[0].z=0,r[3].x=u,r[3].y=c,r[3].z=0,e.vertDirty=!1}},updateUvs:function(t){var e=t.renderData,i=e.vData,r=t.spriteFrame.uv;i[3]=r[0],i[4]=r[1],i[12]=r[2],i[13]=r[3],i[21]=r[4],i[22]=r[5],i[30]=r[6],i[31]=r[7],e.uvDirty=!1},updateColor:function(t){for(var e=t.renderData.vData,i=5,r=t.color,n=r.r/255,s=r.g/255,a=r.b/255,o=r.a/255,h=0;h<4;h++)e[i]=n,e[i+1]=s,e[i+2]=a,e[i+3]=o,i+=9}},Iyt=new Cs,Myt=new Hs,Byt={useModel:!1,createData:function(t){var e=t.requestRenderData();return e.dataLength=20,e.vertexCount=16,e.indicesCount=54,e},updateRenderData:function(t){var e=t.spriteFrame,i=t.renderData;i&&e&&i.vertDirty&&(this.updateVertexData(t),this.updateWorldVertexData(t))},updateVertexData:function(t){var e=t.renderData,i=e.data,r=t.node._uiProps.uiTransformComp,n=r.width,s=r.height,a=r.anchorX*n,o=r.anchorY*s,h=t.spriteFrame,l=h.insetLeft,u=h.insetRight,c=h.insetTop,_=h.insetBottom,d=n-l-u,p=s-c-_,f=n/(l+u),m=s/(c+_);f=isNaN(f)||f>1?1:f,m=isNaN(m)||m>1?1:m,d=d<0?0:d,p=p<0?0:p,i[0].x=-a,i[0].y=-o,i[1].x=l*f-a,i[1].y=_*m-o,i[2].x=i[1].x+d,i[2].y=i[1].y+p,i[3].x=n-a,i[3].y=s-o,e.vertDirty=!1},fillBuffers:function(t,e){t.node.hasChangedFlags&&this.updateWorldVertexData(t);var i=e.acquireBufferBatch(),r=t.renderData,n=r.data,s=i.byteOffset>>2,a=r.vertexCount,o=i.indicesOffset,h=i.vertexOffset,l=t.spriteFrame.uvSliced;i.request(a,r.indicesCount)||(i=e.currBufferBatch,s=0,o=0,h=0);for(var u=i.vData,c=i.iData,_=4;_<20;++_){var d=n[_],p=l[_-4];u[s++]=d.x,u[s++]=d.y,u[s++]=d.z,u[s++]=p.u,u[s++]=p.v,Qs.toArray(u,t.color,s),s+=4}for(var f=0;f<3;++f)for(var m=0;m<3;++m){var g=h+4*f+m;c[o++]=g,c[o++]=g+1,c[o++]=g+4,c[o++]=g+1,c[o++]=g+5,c[o++]=g+4}},updateWorldVertexData:function(t){var e=t.node,i=t.renderData.data;e.getWorldMatrix(Myt);for(var r=0;r<4;++r)for(var n=i[r],s=0;s<4;++s){var a=i[s],o=i[4+4*r+s];Cs.set(Iyt,a.x,n.y,0),Cs.transformMat4(o,Iyt,Myt)}}},Pyt=[],Nyt=0;Nyt<4;Nyt++)Pyt.push(new Cs);var Lyt={useModel:!1,createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t.renderData,i=t.spriteFrame;if(i&&e&&(e.uvDirty||e.vertDirty)){var r=t.node._uiProps.uiTransformComp,n=Math.abs(r.width),s=Math.abs(r.height),a=i.getRect(),o=i.insetLeft,h=i.insetRight,l=a.width-o-h,u=i.insetTop,c=i.insetBottom,_=a.height-u-c;this.sizableWidth=n-o-h,this.sizableHeight=s-u-c,this.sizableWidth=this.sizableWidth>0?this.sizableWidth:0,this.sizableHeight=this.sizableHeight>0?this.sizableHeight:0,this.hRepeat=0===l?this.sizableWidth:this.sizableWidth/l,this.vRepeat=0===_?this.sizableHeight:this.sizableHeight/_,this.row=Math.ceil(this.vRepeat+2),this.col=Math.ceil(this.hRepeat+2),e.dataLength=Math.max(8,this.row+1,this.col+1),this.updateVerts(t),e.vertexCount=this.row*this.col*4,e.indicesCount=this.row*this.col*6,e.uvDirty=!1,e.vertDirty=!1}},fillBuffers:function(t,e){var i,r=t.node,n=t.renderData,s=e.acquireBufferBatch(),a=s.indicesOffset,o=s.byteOffset>>2,h=s.vertexOffset,l=n.vertexCount,u=n.indicesCount,c=s.vData,_=s.iData;s.request(l,u)||(s=e.currBufferBatch,o=0,a=0,h=0);var d=t.spriteFrame,p=d.isRotated(),f=d.uv,m=null===(i=t.spriteFrame)||void 0===i?void 0:i.uvSliced,g=d.getRect(),v=d.insetLeft,y=d.insetRight,T=g.width-v-y,E=d.insetTop,S=d.insetBottom,b=g.height-E-S,A=r.worldMatrix;this.fillVertices(c,o,A,this.row,this.col,n.data);for(var C=0,w=0,R=0,x=this.row;R<x;++R){w=this.sizableHeight>b?this.sizableHeight>=R*b?1:this.vRepeat%1:this.vRepeat;for(var O=0,I=this.col;O<I;++O){C=this.sizableWidth>T?this.sizableWidth>=O*T?1:this.hRepeat%1:this.hRepeat;var M=o+3,B=M+1;p?(c[M]=f[0],c[B]=f[1],c[M+9]=f[0],c[B+9]=f[1]+(f[7]-f[1])*C,c[M+18]=f[0]+(f[6]-f[0])*w,c[B+18]=f[1],c[M+27]=c[M+18],c[B+27]=c[B+9]):(0===O?c[M]=f[0]:O>0&&O<this.col-1?c[M]=m[1].u:O===this.col-1&&(c[M]=m[2].u),0===R?c[B]=m[0].v:R>0&&R<this.row-1?c[B]=m[4].v:R===this.row-1&&(c[B]=m[8].v),0===O||O>0&&O<this.col-1?c[M+9]=m[1].u+(m[2].u-m[1].u)*C:O===this.col-1&&(c[M+9]=m[3].u),0===R?c[B+9]=m[0].v:R>0&&R<this.row-1?c[B+9]=m[4].v:R===this.row-1&&(c[B+9]=m[8].v),0===O?c[M+18]=f[0]:O>0&&O<this.col-1?c[M+18]=m[1].u:O===this.col-1&&(c[M+18]=m[2].u),0===R||R>0&&R<this.row-1?c[B+18]=m[4].v+(m[8].v-m[4].v)*w:R===this.row-1&&(c[B+18]=m[12].v),c[M+27]=c[M+9],c[B+27]=c[B+18]),Qs.toArray(c,t.color,B+1),Qs.toArray(c,t.color,B+9+1),Qs.toArray(c,t.color,B+18+1),Qs.toArray(c,t.color,B+27+1),o+=36}}for(var P=0;P<u;P+=6)_[a++]=h,_[a++]=h+1,_[a++]=h+2,_[a++]=h+1,_[a++]=h+3,_[a++]=h+2,h+=4},fillVertices:function(t,e,i,r,n,s){for(var a=0,o=0,h=0,l=0,u=0,c=r;u<c;++u){h=s[u].y,l=s[u+1].y;for(var _=0,d=n;_<d;++_){a=s[_].x,o=s[_+1].x,Cs.set(Pyt[0],a,h,0),Cs.set(Pyt[1],o,h,0),Cs.set(Pyt[2],a,l,0),Cs.set(Pyt[3],o,l,0);for(var p=0;p<4;p++){var f=Pyt[p];Cs.transformMat4(f,f,i);var m=9*p;t[e+m]=f.x,t[e+m+1]=f.y,t[e+m+2]=f.z}e+=36}}},updateVerts:function(t){var e,i,r,n=t.node._uiProps.uiTransformComp,s=null===(e=t.renderData)||void 0===e?void 0:e.data,a=t.spriteFrame,o=a.getRect(),h=Math.abs(n.width),l=Math.abs(n.height),u=n.anchorX*h,c=n.anchorY*l,_=a.insetLeft,d=a.insetRight,p=o.width-_-d,f=a.insetTop,m=a.insetBottom,g=o.height-f-m,v=n.width/(_+d)>1?1:n.width/(_+d),y=n.height/(f+m)>1?1:n.height/(f+m);i=p>0?Math.floor(1e3*this.sizableWidth)/1e3%p==0?p:this.sizableWidth%p:this.sizableWidth,r=g>0?Math.floor(1e3*this.sizableHeight)/1e3%g==0?g:this.sizableHeight%g:this.sizableHeight;for(var T=0;T<=this.col;T++)0===T?s[T].x=-u:T>0&&T<this.col?1===T?s[T].x=_*v+Math.min(p,this.sizableWidth)-u:p>0?T===this.col-1?s[T].x=_+i+p*(T-2)-u:s[T].x=_+Math.min(p,this.sizableWidth)+p*(T-2)-u:s[T].x=_+this.sizableWidth-u:T===this.col&&(s[T].x=Math.min(_+this.sizableWidth+d,h)-u);for(var E=0;E<=this.row;E++)0===E?s[E].y=-c:E>0&&E<this.row?1===E?s[E].y=m*y+Math.min(g,this.sizableHeight)-c:g>0?E===this.row-1?s[E].y=m+r+(E-2)*g-c:s[E].y=m+Math.min(g,this.sizableHeight)+(E-2)*g-c:s[E].y=m+this.sizableHeight-c:E===this.row&&(s[E].y=Math.min(m+this.sizableHeight+f,l)-c)}},Fyt=cst.Type,Dyt=cst.FillType,Uyt=t("spriteAssembler",{getAssembler:function(t){var e=Oyt,i=t;switch(i.type){case Fyt.SLICED:e=Byt;break;case Fyt.TILED:e=Lyt;break;case Fyt.FILLED:e=i.fillType===Dyt.RADIAL?wyt:dyt}return e}});cst.Assembler=Uyt;var kyt,zyt=pF.sharedManager,Gyt={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.vertexCount=4,e.indicesCount=6,e.vData=new Float32Array(36),e},updateRenderData:function(t){t.type===qlt.IMAGE_STENCIL&&(Oyt.updateRenderData(t),Oyt.updateColor(t))},fillBuffers:function(t,e){(t.type!==qlt.IMAGE_STENCIL||t.spriteFrame)&&(zyt.pushMask(t),e.finishMergeBatches(),function(t,e){zyt.clear(),e.commitModel(t,t._clearModel,t._clearStencilMtl)}(t,e),function(t,e){if(zyt.enterLevel(),t.type===qlt.IMAGE_STENCIL){Oyt.fillBuffers(t,e);var i=t.graphics.getMaterialInstance(0);e.forceMergeBatches(i,t.spriteFrame,t.graphics)}else t.graphics.updateAssembler(e)}(t,e),zyt.enableMask())}},Hyt={fillBuffers:function(){zyt.exitMask()}},Vyt={getAssembler:function(){return Gyt}},Wyt={getAssembler:function(){return Hyt}};wut.Assembler=Vyt,wut.PostAssembler=Wyt;var jyt=t("UIReorderComponent",Ne("cc.UIReorderComponent")(kyt=function(){I(1408,"UIReorderComponent")})||kyt);_.UIReorderComponent=jyt,_.ButtonComponent=Sat,Mt.setClassAlias(Sat,"cc.ButtonComponent"),_.EditBoxComponent=Uht,Mt.setClassAlias(Uht,"cc.EditBoxComponent"),_.LayoutComponent=Tlt,Mt.setClassAlias(Tlt,"cc.LayoutComponent"),_.MaskComponent=wut,Mt.setClassAlias(wut,"cc.MaskComponent"),_.LabelComponent=Nat,Mt.setClassAlias(Nat,"cc.LabelComponent"),_.LabelOutlineComponent=Ect,Mt.setClassAlias(Ect,"cc.LabelOutlineComponent"),_.ProgressBarComponent=Tct,Mt.setClassAlias(Tct,"cc.ProgressBarComponent"),_.RichTextComponent=Kct,Mt.setClassAlias(Kct,"cc.RichTextComponent"),_.ScrollViewComponent=xdt,Mt.setClassAlias(xdt,"cc.ScrollViewComponent"),_.ScrollBarComponent=Z_t,Mt.setClassAlias(Z_t,"cc.ScrollBarComponent"),_.SliderComponent=Zdt,Mt.setClassAlias(Zdt,"cc.SliderComponent"),_.SpriteComponent=cst,Mt.setClassAlias(cst,"cc.SpriteComponent"),_.ToggleComponent=Mpt,Mt.setClassAlias(Mpt,"cc.ToggleComponent"),_.ToggleContainerComponent=Bpt,Mt.setClassAlias(Bpt,"cc.ToggleContainerComponent"),_.UIModelComponent=Ppt,Mt.setClassAlias(Ppt,"cc.UIModelComponent"),_.WidgetComponent=PL,Mt.setClassAlias(PL,"cc.WidgetComponent"),_.GraphicsComponent=Jlt,Mt.setClassAlias(Jlt,"cc.GraphicsComponent"),_.PageViewComponent=zft,Mt.setClassAlias(zft,"cc.PageViewComponent"),_.PageViewIndicatorComponent=wft,Mt.setClassAlias(wft,"cc.PageViewIndicatorComponent"),Mt.setClassAlias(Gft,"cc.UIStaticBatchComponent"),Mt.setClassAlias(Hft,"cc.UIOpacityComponent"),_.SafeAreaComponent=vmt,Mt.setClassAlias(vmt,"cc.SafeAreaComponent"),Mt.setClassAlias(ymt,"cc.UICoordinateTrackerComponent"),_.BlockInputEventsComponent=Ymt,Mt.setClassAlias(Ymt,"cc.BlockInputEventsComponent"),_.UI={MeshBuffer:bF,UIVertexFormat:SF,spriteAssembler:Uyt,graphicsAssembler:jgt,labelAssembler:uyt}}}}));
